; /* /bitrix/js/calendar/cal-core.min.js?151131647668360*/
; /* /bitrix/js/calendar/cal-dialogs.min.js?151131647653075*/
; /* /bitrix/js/calendar/cal-week.min.js?151131647612995*/
; /* /bitrix/js/calendar/cal-events.min.js?151131647613013*/
; /* /bitrix/js/calendar/cal-controlls.min.js?151131647670330*/

; /* Start:"a:4:{s:4:"full";s:51:"/bitrix/js/calendar/cal-core.min.js?151131647668360";s:6:"source";s:31:"/bitrix/js/calendar/cal-core.js";s:3:"min";s:35:"/bitrix/js/calendar/cal-core.min.js";s:3:"map";s:35:"/bitrix/js/calendar/cal-core.map.js";}"*/
function JCEC(e){this.arConfig=e;top.BXCRES={};this.dayLength=864e5;this.id=e.id;this.pCalCnt=BX(this.id+"_bxcal");this.dragDrop=new ECDragDropControl({calendar:this});this.arEvents=[];this.arAttendees={};this.arSections=e.sections;this.sectionsIds=e.sectionsIds;this.type=e.type;this.bSuperpose=e.bSuperpose||false;this.bTasks=e.bTasks||false;this.userId=e.userId;this.userName=e.userName;this.ownerId=e.ownerId||false;this.sectionControlsDOMId=e.sectionControlsDOMId;this.PERM=e.perm;this.permEx=e.permEx;this.settings=e.settings;this.userSettings=e.userSettings;this.pathToUser=e.pathToUser;this.bIntranet=!!e.bIntranet;this.allowMeetings=!!e.bSocNet&&this.bIntranet;this.allowReminders=!!e.bSocNet&&this.bIntranet;this.days=e.days;this.bReadOnly=!!e.readOnly;this.bAnonym=!!e.bAnonym;this.canAddToSuperpose=e.canAddToSuperpose&&!this.bAnonym;this.startupEvent=e.startupEvent;this.accessColors=e.accessColors;this.initMonth=e.init_month;this.initYear=e.init_year;this.weekHolidays=e.week_holidays;this.yearHolidays=e.year_holidays;this.yearWorkdays=e.year_workdays;this.new_section_access=e.new_section_access||{};this.bExtranet=!!e.bExtranet;this.Colors=e.arCalColors;this.bAMPM=e.bAMPM;this.bWideDate=e.bWideDate;this.weekStart=e.week_start;this.weekDays=e.week_days;this.lastSection=e.lastSection;this.requests={};this.DATE_FORMAT=BX.date.convertBitrixFormat(BX.message("FORMAT_DATE"));this.DATETIME_FORMAT=BX.date.convertBitrixFormat(BX.message("FORMAT_DATETIME"));if(this.DATETIME_FORMAT.substr(0,this.DATE_FORMAT.length)==this.DATE_FORMAT)this.TIME_FORMAT=BX.util.trim(this.DATETIME_FORMAT.substr(this.DATE_FORMAT.length));else this.TIME_FORMAT=BX.date.convertBitrixFormat(this.bAMPM?"H:MI:SS T":"HH:MI:SS");this.TIME_FORMAT_SHORT=this.TIME_FORMAT.replace(":s","");this.bCalDAV=!!e.bCalDAV;if(this.bCalDAV)this.arConnections=e.connections;this.arSectionsInd={};this.oActiveSections={};this.dayHeight=100;this.darkColor="#E6E6E6";this.brightColor="#000000";this.arMenuItems={};this.arNames={};this.HandleAccessNames(e.accessNames);var t,i,s,n;this.activeSectionsCount=0;for(t in this.arSections){if(this.arSections.hasOwnProperty(t)){n=this.arSections[t];if(n.EXPORT&&!n.EXPORT.ALLOW)n.EXPORT=false;if(!n.TEXT_COLOR)n.TEXT_COLOR="";i=n.ID;if(this.bCalDAV&&n.CAL_DAV_CAL&&n.CAL_DAV_CON&&this.arConnections&&this.arConnections.length>0){for(s in this.arConnections){if(this.arConnections.hasOwnProperty(s)&&this.arConnections[s].id==n.CAL_DAV_CON){n["~CAL_DAV_LAST_SYNC"]=this.arConnections[s].last_result;break}}}this.arSectionsInd[i]=t;if(n.ACTIVE!=="N")this.oActiveSections[i]=true;if(n.ACTIVE!=="N"&&this.IsCurrentViewSect(n))this.activeSectionsCount++;if(!this.lastSection&&n.PERM&&n.PERM.add&&n.ACTIVE!=="N")this.lastSection=parseInt(i)}}this.bOnunload=false;this.actionUrl=e.page;this.path=e.path;this.bUser=this.type=="user";this.meetingRooms=e.meetingRooms||[];this.allowResMeeting=!!e.allowResMeeting;this.allowVideoMeeting=!!e.allowVideoMeeting;this.bUseMR=this.bIntranet&&(this.allowResMeeting||this.allowVideoMeeting)&&this.meetingRooms.length>0;if(this.bTasks){this.taskBgColor="#F5B39A";this.taskTextColor="#000000";BX.addCustomEvent("onCalendarPopupTaskAdded",BX.delegate(this.OnTaskChanged,this));BX.addCustomEvent("onCalendarPopupTaskChanged",BX.delegate(this.OnTaskChanged,this));BX.addCustomEvent("onCalendarPopupTaskDeleted",BX.delegate(this.OnTaskKilled,this));this.oActiveSections.tasks=true}for(t in e.hiddenSections){if(e.hiddenSections.hasOwnProperty(t)){this.oActiveSections[e.hiddenSections[t]]=false}}this.typeAccess=this.PERM.access?e.TYPE_ACCESS||{}:null;this.Init()}JCEC.prototype={Init:function(){this.DaysTitleCont=BX(this.id+"_days_title");this.DaysGridCont=BX(this.id+"_days_grid");DenyDragEx(this.DaysGridCont);this.maxEventCount=3;this.activeDateDays={};this._bScelTableSixRows=false;this.oDate=new Date;this.currentDate={date:this.oDate.getDate(),day:this.ConvertDayIndex(this.oDate.getDay()),month:this.oDate.getMonth(),year:this.oDate.getFullYear()};this.activeDate=BX.clone(this.currentDate);if(this.initMonth&&this.initYear){this.activeDate.month=this.initMonth-1;this.activeDate.year=this.initYear}this.activeDate.week=this.GetWeekByDate(this.activeDate);this.arLoadedMonth={};this.arLoadedMonth[this.activeDate.month+"."+this.activeDate.year]=true;this.arLoadedEventsId={};this.arLoadedParentId={};this.Event=new window.JSECEvent(this);this.arConfig.attendees=[];this.HandleEvents(this.arConfig.events,this.arConfig.attendees);var e,t=this;this.selectDaysMode=false;this.selectDaysStartObj=false;this.selectDaysEndObj=false;this.curTimeSelection={};this.curDayTSelection={};this.week_holidays={};for(e=0;e<this.weekHolidays.length;e++)this.week_holidays[this.weekHolidays[e]]=true;this.year_holidays={};for(e in this.yearHolidays)this.year_holidays[this.yearHolidays[e]]=true;this.year_workdays={};for(e in this.yearWorkdays)this.year_workdays[this.yearWorkdays[e]]=true;window.onbeforeunload=function(){t.bOnunload=true};BX.addCustomEvent("onPopupClose",BX.proxy(this._OnPopupCloseHandler,this));this.BuildSectionBlock();this.Selector=new ECMonthSelector(this);this.ColorPicker=new ECColorPicker({});this.BuildButtonsCont();this.pCalCnt.className="bxcal";this.InitTabControl();setTimeout(function(){BX.bind(window,"resize",BX.proxy(t.OnResize,t))},200);if(this.arConfig.syncInfo&&typeof this.arConfig.syncInfo==="object")new ECSyncPannel(this);if(this.arConfig.showNewEventDialog&&!this.bReadOnly)setTimeout(function(){t.ShowEditEventPopup({bChooseMR:t.arConfig.bChooseMR})},1e3)},InitTabControl:function(){this.Tabs={};this.InitTab({id:"month",tabContId:this.id+"_tab_month",bodyContId:this.id+"_scel_table_month"});this.InitTab({id:"week",tabContId:this.id+"_tab_week",bodyContId:this.id+"_scel_table_week",daysCount:7});this.InitTab({id:"day",tabContId:this.id+"_tab_day",bodyContId:this.id+"_scel_table_day",daysCount:1});this.SetTab(this.userSettings.tabId,true)},InitTab:function(e){var t=BX(e.tabContId);if(!t)return;var i=this;t.onclick=function(){i.SetTab(e.id)};this.Tabs[e.id]={id:e.id,pTabCont:t,bodyContId:e.bodyContId,daysCount:e.daysCount||false,needRefresh:false,setActiveDate:false}},SetTab:function(e,t,i){var s=this,n=this.Tabs[e];if(e==this.activeTabId)return;var a=this.activeTabId,o="";if(!n.bLoaded||t){n.pBodyCont=BX(n.bodyContId);BX.bind(n.pBodyCont,"click",BX.proxy(this.EventClick,this));DenyDragEx(n.pBodyCont)}if(this.activeTabId){BX.removeClass(this.Tabs[this.activeTabId].pTabCont,"bxec-tab-div-act");this.Tabs[this.activeTabId].pBodyCont.style.display="none"}BX.addClass(n.pTabCont,"bxec-tab-div-act");this.activeTabId=e;this.Selector.ChangeMode(e);if(!n.bLoaded||t){var r=this.activeDate,l=this.currentDate,h,c,d,u;if(r.month&&r.month!=l.month||r.year&&r.year!=l.year){h=1;c=0;d=r.month;u=r.year}else{var f=a=="day"&&r?r:l;c=this.GetWeekByDate(f);h=f.date;d=f.month;u=f.year}switch(e){case"month":setTimeout(BX.delegate(this.BuildDaysTitle,this),0);this.SetMonth(d,u);break;case"week":this.BuildWeekDaysTable();this.SetWeek(c,d,u);break;case"day":this.BuildSingleDayTable();if(!i||i.bSetDay!==false)this.SetDay(h,d,u);break}n.bLoaded=true}else if(!i||i.bSetDay!==false){if(a=="day"&&e=="week")n.setActiveDate=true;if(n.needRefresh){if(e=="month")this.DisplayEventsMonth(true);else setTimeout(function(){s.ReBuildEvents(e)},20)}else if(n.setActiveDate){switch(e){case"month":this.SetMonth(this.activeDate.month,this.activeDate.year);break;case"week":this.SetWeek(this.GetWeekByDate(this.activeDate),this.activeDate.month,this.activeDate.year);break;case"day":this.SetDay(1,this.activeDate.month,this.activeDate.year);break}}}if(this.startupEvent&&!this.startupEvent.viewed)this.ShowStartUpEvent();n.needRefresh=false;n.setActiveDate=false;this.Selector.Show(e);n.pBodyCont.style.display=o;n.bLoaded=true;if(this._bScelTableSixRows){if(this.activeTabId=="month")BX.addClass(this.pCalCnt,"BXECSceleton-six-rows");else BX.removeClass(this.pCalCnt,"BXECSceleton-six-rows")}if(!t)BX.userOptions.save("calendar","user_settings","tabId",e)},GetWeekByDate:function(e){var t=new Date;t.setFullYear(e.year,e.month,1);var i=this.GetWeekDayByInd(t.getDay());var s=this.GetWeekDayOffset(i)-1;var n=e.date+s;var a=Math.floor(n/7);return a},SetTabNeedRefresh:function(e,t){var i,s;for(i in this.Tabs){s=this.Tabs[i];if(typeof s!="object"||s.id==e)continue;if(!t&&s.needRefresh===false)s.needRefresh=true;else if(t&&s.setActiveDate===false)s.setActiveDate=true}},BuildButtonsCont:function(){this.ButtonsCont=BX(this.id+"_buttons_cont");var e=false,t=this;if(!this.bReadOnly){var i=this.ButtonsCont.appendChild(BX.create("SPAN",{props:{className:"bxec-add-but",title:EC_MESS.AddNewEvent}})),s=i.appendChild(BX.create("I")),n=i.appendChild(BX.create("SPAN",{props:{},html:EC_MESS.Add})),a=i.appendChild(BX.create("A",{props:{href:"javascript: void(0);",className:"bxec-add-more"}}));e=true;s.onclick=n.onclick=BX.proxy(this.ShowEditEventPopup,this);var o=[];o.push({text:EC_MESS.Event,title:EC_MESS.AddNewEvent,className:"bxec-menu-add-event",onclick:function(){t.ClosePopupMenu();t.ShowEditEventPopup()}});if(this.bTasks){o.push({text:EC_MESS.NewTask,title:EC_MESS.NewTaskTitle,className:"bxec-menu-add-task",onclick:function(){t.ClosePopupMenu();t.Event.Edit({bTasks:true})}})}if(this.type=="user"&&this.userId==this.ownerId||this.permEx.section_edit){o.push({text:EC_MESS.NewSect,title:EC_MESS.NewSectTitle,className:"bxec-menu-add-sect",onclick:function(){t.ClosePopupMenu();t.ShowSectionDialog()}})}if(this.bCalDAV&&this.type=="user"&&this.userId==this.ownerId){o.push({text:EC_MESS.NewExtSect,title:EC_MESS.NewExtSectTitle,className:"bxec-menu-add-sect-ex",onclick:function(){t.ClosePopupMenu();t.ShowExternalDialog({})}})}a.onclick=function(){BX.PopupMenu.show("bxec_add_menu"+t.id,a,o,{events:{onPopupClose:function(){BX.removeClass(this.bindElement,"bxec-add-more-over")}},offsetLeft:-(i.offsetWidth-15)});BX.addClass(a,"bxec-add-more-over")}}if(!this.bAnonym){if(e)this.ButtonsCont.appendChild(BX.create("SPAN",{props:{className:"bxec-but-sep"}}));this.ButtonsCont.appendChild(BX.create("SPAN",{props:{className:"bxec-settings-but",title:EC_MESS.Settings},events:{click:BX.proxy(this.ShowSetDialog,this)}}))}this.accessSettingsWrap=BX(this.id+"-access-settings-wrap");if(this.accessSettingsWrap&&this.type!=="group"&&this.type!=="user"&&!this.bAnonym){var t=this;this.accessSettingsWrap.style.display="block";this.accessSettingsLink=BX(this.id+"-access-settings");if(this.PERM.access){BX.bind(this.accessSettingsLink,"click",function(){t.ShowSetDialog({tabId:t.id+"set-tab-2"})})}else{new BX.CHint({parent:this.accessSettingsLink,hint:EC_MESS.accessSettingsWarn});BX.bind(this.accessSettingsLink,"click",function(){alert(EC_MESS.accessSettingsWarn)})}}},ClosePopupMenu:function(){if(BX.PopupMenu&&BX.PopupMenu.currentItem&&BX.PopupMenu.currentItem.popupWindow)BX.PopupMenu.currentItem.popupWindow.close()},SetView:function(e){if(!bxInt(e.week)&&e.week!==0)e.week=this.activeDate.week;if(!bxInt(e.date))e.date=this.activeDate.date;switch(this.activeTabId){case"month":return this.SetMonth(e.month,e.year);case"week":return this.SetWeek(e.week,e.month,e.year);case"day":return this.SetDay(e.date||1,e.month,e.year)}},SetMonth:function(e,t){if(!this.arLoadedMonth[e+"."+t]){return this.LoadEvents(e,t)}var i=this.activeDate.month!=e||this.activeDate.year!=t;this.activeDate.month=e;this.activeDate.year=t;if(!this.activeDate.week)this.activeDate.week=0;if(i)this.SetTabNeedRefresh("month",true);this.Selector.OnChange(t,e);this.BuildDaysGrid(e,t)},BuildDaysTitle:function(){var e,t,i=this.DaysTitleCont.offsetWidth/7;i=Math.round(i*10)/10;for(e=0;e<7;e++){t=this.DaysTitleCont.childNodes[e];t.style.width=i+"px";if(e==6)t.style.width=Math.abs(i-2)+"px"}this.DaysTitleCont.style.visibility="visible"},BuildDaysGrid:function(e,t){BX.cleanNode(this.DaysGridCont);var i=new Date;i.setFullYear(t,e,1);this.dragDrop.Reset();this.activeDateDays=[];this.activeDateObjDays=[];this.arWeeks=[];this.oDaysGridTable=BX.create("TABLE",{props:{className:"bxec-days-grid-table",cellPadding:0,cellSpacing:0}});if(this.GetWeekStart()!=this.GetWeekDayByInd(i.getDay()))this.BuildPrevMonthDays(this.GetWeekDayByInd(i.getDay()),e,t);var s;while(i.getMonth()==e){s=i.getDate();this.BuildDayCell(s,this.GetWeekDayByInd(i.getDay()),true,e,t);i.setDate(s+1)}this.BuildNextMonthDays(this.GetWeekDayByInd(i.getDay()),e,t);this.DaysGridCont.appendChild(this.oDaysGridTable);var n=this.oDaysGridTable.rows.length;if(n==6&&!this._bScelTableSixRows){this._bScelTableSixRows=true;BX.addClass(this.pCalCnt,"BXECSceleton-six-rows")}else if(this.pCalCnt&&this._bScelTableSixRows&&n<6){this._bScelTableSixRows=false;BX.removeClass(this.pCalCnt,"BXECSceleton-six-rows")}this.BuildEventHolder()},BuildPrevMonthDays:function(e,t,i){var s,n=this.GetWeekDayOffset(e),a=new Date;a.setFullYear(i,t,1);a.setDate(a.getDate()-n);for(s=0;s<n;s++){this.BuildDayCell(a.getDate(),this.GetWeekDayByInd(a.getDay()),false,a.getMonth(),a.getFullYear());a.setDate(a.getDate()+1)}},BuildNextMonthDays:function(e,t,i){if(this.GetWeekStart()!=e){var s,n=this.GetWeekDayOffset(e);var a=new Date;a.setFullYear(i,t+1,1);for(s=n;s<7;s++){this.BuildDayCell(a.getDate(),this.GetWeekDayByInd(a.getDay()),false,a.getMonth(),a.getFullYear());a.setDate(a.getDate()+1)}}},BuildDayCell:function(e,t,i,s,n){var a,o,r=this;if(this.GetWeekStart()==t)this._curRow=this.oDaysGridTable.insertRow(-1);var l=this.activeDateDays.length;var h=(this.week_holidays[{MO:0,TU:1,WE:2,TH:3,FR:4,SA:5,SU:6}[t]]||this.year_holidays[e+"."+s])&&!this.year_workdays[e+"."+s];o="bxec-day";if(!i&&!h)o+=" bxec-day-past";else if(!i)o+=" bxec-day-past-hol";else if(h)o+=" bxec-holiday";if(e==this.currentDate.date&&s==this.currentDate.month&&n==this.currentDate.year)o+=" bxec-current-day";a=this._curRow.insertCell(-1);a.id="bxec_ind_"+l;a.className=o;var c=a.appendChild(BX.create("DIV",{props:{className:"bxc-day"},style:{height:this.dayHeight+"px"}})),d=c.appendChild(BX.create("DIV",{props:{className:"bxc-day-title"}})),u=d.appendChild(BX.create("A",{props:{href:"javascript:void(0)",className:"bxc-day-link",title:EC_MESS.GoToDay,id:"bxec-day-lnk-"+l},html:e}));this.dragDrop.RegisterDay(c);u.onmousedown=function(e){return BX.PreventDefault(e)};u.onclick=function(e){var t=r.activeDateDays[this.id.substr("bxec-day-lnk-".length)];r.SetTab("day",false,{bSetDay:false});r.SetDay(t.getDate(),t.getMonth(),t.getFullYear());return BX.PreventDefault(e)};if(this.GetWeekDayOffset(t)==6)a.style.borderRight="0px";if(!this.bReadOnly){a.onmouseover=function(){r.oDayOnMouseOver(this)};a.onmousedown=function(){r.oDayOnMouseDown(this)};a.onmouseup=function(){r.oDayOnMouseUp(this)}}this.activeDateDays.push(new Date(n,s,e));this.activeDateObjDays.push({pDiv:a,pDayCont:c,arEvents:{begining:[],all:[]}})},oDayOnMouseOver:function(e){if(this.selectDaysMode){this.selectDaysEndObj=e;this.SelectDays()}},oDayOnMouseDown:function(e){this.selectDaysMode=true;this.selectDaysStartObj=this.selectDaysEndObj=e;if(e.className.indexOf("bxec-day-selected")==-1)return this.SelectDays();this.selectDaysMode=false;this.DeSelectDays();this.CloseAddEventDialog()},oDayOnMouseUp:function(e){if(!this.selectDaysMode)return;this.selectDaysEndObj=e;this.SelectDays();this.ShowAddEventDialog();this.selectDaysMode=false},oDayOnDoubleClick:function(e){},oDayOnContextMenu:function(e){},RefreshEventsOnWeeks:function(e){for(var t=0,i=e.length;t<i;t++)this.RefreshEventsOnWeek(e[t])},RefreshEventsOnWeek:function(e){var t=e*7,i=(e+1)*7,s,n,a,o,r,l,h,c,d=[],u=0;for(r=0;r<this.maxEventCount;r++)d[r]=0;for(n=t;n<i;n++){s=this.activeDateObjDays[n];if(!s)continue;s.arEvents.hidden=[];o=s.arEvents.begining;c=[];if(o.length>0){o.sort(function(e,t){if(t.daysCount==e.daysCount&&e.daysCount==1)return e.oEvent.DT_FROM_TS-t.oEvent.DT_FROM_TS;return t.daysCount-e.daysCount});e:for(a=0;a<o.length;a++){l=o[a];if(!l)continue;if(!this.arEvents[l.oEvent.ind]){s.arEvents.begining=o=BX.util.deleteFromArray(o,a);l=o[a];if(!l)continue}for(r=0;r<this.maxEventCount;r++){if(d[r]-u<=0){d[r]=u+l.daysCount;this.ShowEventOnLevel(l.oEvent.oParts[l.partInd],r,e);continue e}}c[l.oEvent.ID]=true;s.arEvents.hidden.push(l)}}h=s.arEvents.all;for(var f=0;f<h.length;f++){l=h[f];if(!l||c[l.oEvent.ID])continue;if(!this.arEvents[l.oEvent.ind]){s.arEvents.all=h=BX.util.deleteFromArray(h,f);l=h[f];if(!l)continue}if(l.oEvent.oParts&&l.partInd!=undefined&&l.oEvent.oParts[l.partInd]&&l.oEvent.oParts[l.partInd].style.display=="none")s.arEvents.hidden.push(l)}this.ShowMoreEventsSelect(s);u++}},ShowEventOnLevel:function(e,t,i){if(!this.arWeeks[i])this.arWeeks[i]={top:parseInt(this.oDaysGridTable.rows[i].cells[0].offsetTop)+22};var s=this.arWeeks[i].top+t*18;e.style.display="block";e.style.top=s+"px"},ShowMoreEventsSelect:function(e){var t=e.arEvents.hidden;if(t.length<=0){if(e.pMoreDiv)e.pMoreDiv.style.display="none";return}if(!e.pMoreDiv)e.pMoreDiv=e.pDayCont.appendChild(BX.create("DIV",{props:{className:"bxc-day-more"}}));var i=this,s,n,a,o=[];for(s=0;s<t.length;s++){n=t[s];a=n.oEvent.oParts[n.partInd];a.style.display="none";if(!n.oEvent.pMoreDivs)n.oEvent.pMoreDivs=[];n.oEvent.pMoreDivs.push(e.pMoreDiv);o.push({pDiv:a,oEvent:n.oEvent})}BX.adjust(e.pMoreDiv,{style:{display:"block"},html:EC_MESS.MoreEvents+" ("+o.length+" "+EC_MESS.Item+")"});e.pMoreDiv.onmousedown=function(e){if(!e)e=window.event;BX.PreventDefault(e)};e.pMoreDiv.onclick=function(){i.ShowMoreEventsWin({Events:o,id:e.pDiv.id,pDay:e.pDiv,pSelect:e.pMoreDiv})}},SelectDays:function(){if(!this.arSelectedDays)this.arSelectedDays=[];this.bInvertedDaysSelection=false;if(this.arSelectedDays.length>0)this.DeSelectDays();if(!this.selectDaysStartObj||!this.selectDaysEndObj)return;var e=this.GetDayIndexByElement(this.selectDaysStartObj),t=this.GetDayIndexByElement(this.selectDaysEndObj),i,s,n;if(e>t){n=t;t=e;e=n;this.bInvertedDaysSelection=true}for(s=e;s<=t;s++){i=this.activeDateObjDays[s];if(!i||!i.pDiv)continue;BX.addClass(i.pDiv,"bxec-day-selected");this.arSelectedDays.push(i.pDiv)}},GetDayIndexByElement:function(e){return parseInt(e.id.substr(9))},GetDayByIndex:function(e){return this.activeDateObjDays[e]},DeSelectDays:function(){if(!this.arSelectedDays)return;var e,t;for(e=0,t=this.arSelectedDays.length;e<t;e++)BX.removeClass(this.arSelectedDays[e],"bxec-day-selected");this.arSelectedDays=[]},DisplayError:function(e,t){var i=this;setTimeout(function(){if(!i.bOnunload){alert(e||"[Event Calendar] Error!");if(t)BX.reload()}},200)},BuildSectionBlock:function(){this.oSections={};var e=this.sectionControlsDOMId&&(this.pSidebar=BX(this.sectionControlsDOMId));this.pSectCont=BX(this.id+"_sect_cont");if(!this.pSectCont)return;if(e){if(this.pSidebar.firstChild)this.pSidebar.insertBefore(this.pSectCont,this.pSidebar.firstChild);else this.pSidebar.appendChild(this.pSectCont);BX.addClass(this.pSectCont,"bxec-sect-cont-side")}else{BX.addClass(this.pSectCont,"bxec-sect-cont-top")}var t=this;if(this.arSections.length<1&&this.bReadOnly){this.pSectCont.style.display="none";return}this.pSectCont.style.display="block";this.pOwnerSectCont=BX(this.id+"sections");if(this.pOwnerSectCont){this.pOwnerSectCont.onmouseover=function(){if(t._sect_over_timeout){clearInterval(t._sect_over_timeout)}BX.addClass(t.pOwnerSectCont,"bxec-hover")};this.pOwnerSectCont.onmouseout=function(){t._sect_over_timeout=setTimeout(function(){BX.removeClass(t.pOwnerSectCont,"bxec-hover")},100)}}this.pOwnerSectBlock=BX(this.id+"sections-cont");if(!this.pOwnerSectBlock)return;BX.cleanNode(this.pOwnerSectBlock);this.pOwnerSectBlock.style.display="";this.pSPSectCont=BX(this.id+"sp-sections");if(this.bSuperpose){this.pSPSectCont.onmouseover=function(){if(t._sect_over_timeout){clearInterval(t._sect_over_timeout)}BX.addClass(t.pSPSectCont,"bxec-hover")};this.pSPSectCont.onmouseout=function(){t._sect_over_timeout=setTimeout(function(){BX.removeClass(t.pSPSectCont,"bxec-hover")},100)};this.pSpSectBlock=BX(this.id+"sp-sections-cont");var i=BX(this.id+"-manage-superpose");i.onclick=function(){t.ShowSuperposeDialog()}}this.BuildSectionElements();var s=BX(this.id+"-add-section");if(this.Personal()||this.permEx.section_edit){if(s)s.onclick=function(){t.ShowSectionDialog()}}else{if(s)BX.cleanNode(s,true)}},BuildSectionElements:function(){var e=false,t=false,i,s;for(i=0;i<this.arSections.length;i++){s=this.arSections[i];if(!s.DOM)s.DOM={};if(s.ACTIVE!=="N"){if(!this.bSuperpose||s.CAL_TYPE==this.type&&s.OWNER_ID==this.ownerId){if(s.DOM.pEl)this.BuildSectionMenu(s.ID);else this.BuildSectionElement(s,this.oActiveSections[s.ID]);if(!e)e=true}if(this.bSuperpose&&!this.bAnonym){if(s.SUPERPOSED){if(s.DOM.pSPEl)this.BuildSectionMenu(s.ID,true);else this.BuildSectionElement(s,this.oActiveSections[s.ID],true)}else if(!s.SUPERPOSED&&s.DOM.pSPEl){if(s.DOM.pSPEl.parentNode)s.DOM.pSPEl.parentNode.removeChild(s.DOM.pSPEl);var n="bxec-sect-sp-"+s.ID;if(this.arMenuItems[n]){if(BX.PopupMenu.Data[n]){BX.PopupMenu.Data[n].popupWindow.destroy();BX.PopupMenu.Data[n]=false}this.arMenuItems[n]=null;delete this.arMenuItems[n]}s.DOM.pSPEl=s.DOM.pSPWrap=s.DOM.pSPText=null;delete s.DOM.pSPEl;delete s.DOM.pSPWrap;delete s.DOM.pSPText}if(s.SUPERPOSED&&!t)t=true}}}if(this.bTasks&&!this.oSections["tasks"]){e=true;this.BuildSectionElement({ID:"tasks",CAL_TYPE:"user",COLOR:this.taskBgColor,CREATED_BY:this.userId,DESCRIPTION:EC_MESS.MyTasks,DOM:{},NAME:EC_MESS.MyTasks,OWNER_ID:this.userId,PERM:{},SORT:100,SUPERPOSED:false,TEXT_COLOR:this.taskTextColor},this.oActiveSections.tasks)}if(this.pSPSectCont)this.pSPSectCont.style.display=t?"":"none";this.pOwnerSectCont.style.display=e?"":"none";return true},BuildSectionElement:function(e,t,i){i=!!i;if(!e.DOM)e.DOM={};var s=this.bCalDAV&&e.CAL_DAV_CAL&&e.CAL_DAV_CON&&e["~CAL_DAV_LAST_SYNC"],n=this.bTasks&&e.ID=="tasks",a=this.pOwnerSectBlock;if(i){a=this.pSpSectBlock}else{if(n){a=BX(this.id+"tasks-sections-cont")}else{if(!this.pSectSubCont)this.pSectSubCont=this.pOwnerSectBlock.appendChild(BX.create("DIV"));a=this.pSectSubCont}}e.bDark=this.ColorIsDark(e.COLOR);var o=this,r=[],l="bxec-sect-"+(i?"sp-":"")+e.ID,h=a.appendChild(BX.create("DIV",{props:{id:"el-"+l,className:"bxec-sect-el"}})),c=h.appendChild(BX.create("DIV",{props:{className:"bxec-sect-el-wrap"+(n?" bxec-task-el-wrap":"")}}));c.appendChild(BX.create("SPAN",{props:{className:"bxec-spr bxec-checkbox"}}));if(n)c.appendChild(BX.create("SPAN",{props:{className:"bxec-spr bxec-tasks-sect"}}));if(s){if(e["~CAL_DAV_LAST_SYNC"].indexOf("[200]")>=0)e.DOM.pStatus=c.appendChild(BX.create("SPAN",{props:{className:"bxec-spr bxec-cal-dav-google"}}));else e.DOM.pStatus=c.appendChild(BX.create("SPAN",{props:{className:"bxec-spr bxec-cal-dav-google-fail",title:EC_MESS.SyncError+": "+e["~CAL_DAV_LAST_SYNC"]}}))}var d=c.appendChild(BX.create("DIV",{text:e.NAME,props:{className:"bxc-sect-text-wrap"}})),u=h.appendChild(BX.create("A",{props:{id:l,href:"javascript: void(0);",className:"bxec-spr bxec-sect-menu",hidefocus:true}}));u.onclick=function(e){o.ShowCPopup(this.id,this);return BX.PreventDefault(e)};if(i){e.DOM.pSPEl=h;e.DOM.pSPWrap=c;e.DOM.pSPText=d}else{e.DOM.pEl=h;e.DOM.pWrap=c;e.DOM.pText=d}h.onclick=function(){o.ShowCalendar(e,this.className.indexOf("bxec-sect-el-checked")==-1)};this.oSections[e["ID"]]=e;this.oActiveSections[e["ID"]]=t;this.BuildSectionMenu(e["ID"],i);this.ShowCalendar(e,t,true)},BuildSectionMenu:function(sectionId,bSuperpose){var el=this.oSections[sectionId];if(!el||this.bTasks&&el.ID=="tasks")return false;if(!el.PERM)el.PERM={};var _this=this,menu=[],isGoogle=el.CAL_DAV_CAL&&el.CAL_DAV_CON,isFirstExchange=this.arConfig.bExchange&&el.IS_EXCHANGE&&el.DAV_EXCH_CAL=="calendar_"+el.OWNER_ID,pEl=bSuperpose?el.DOM.pSPEl:el.DOM.pEl,menuId="bxec-sect-"+(bSuperpose?"sp-":"")+el.ID;if(BX.PopupMenu.Data[menuId]&&BX.PopupMenu.Data[menuId].popupWindow){BX.PopupMenu.Data[menuId].popupWindow.destroy();BX.PopupMenu.Data[menuId]=false}if(el.LINK){menu.push({text:EC_MESS.OpenCalendar,href:el.LINK,className:"bxec-menu-sect-add2sp"})}if(el.PERM.edit_section&&this.permEx.section_edit&&!bSuperpose){menu.push({text:EC_MESS.Edit,title:EC_MESS.EditCalendarTitle,className:"bxec-menu-sect-edit",onclick:function(){_this.CloseCPopup();_this.ShowSectionDialog(el)}})}if(!el.SUPERPOSED&&this.canAddToSuperpose){menu.push({text:EC_MESS.CalAdd2SP,title:EC_MESS.CalAdd2SPTitle,className:"bxec-menu-sect-add2sp",onclick:function(){_this.CloseCPopup();_this.SetSuperposed(el,true)}})}else if(el.SUPERPOSED){menu.push({text:EC_MESS.CalHide,title:EC_MESS.CalHideTitle,className:"bxec-menu-sect-del-from-sp",onclick:function(){_this.CloseCPopup();_this.SetSuperposed(el,false)}})}if(el.OUTLOOK_JS&&!isGoogle&&!BX.browser.IsMac()){menu.push({text:EC_MESS.ConnectToOutlook,title:EC_MESS.ConnectToOutlookTitle,className:"bxec-menu-sect-outlook",onclick:function(){_this.CloseCPopup();if(!window.jsOutlookUtils)BX.loadScript("/bitrix/js/calendar/outlook.js",function(){try{eval(el.OUTLOOK_JS)}catch(e){}});else try{eval(el.OUTLOOK_JS)}catch(e){}}})}if(el.EXPORT&&el.EXPORT.ALLOW){menu.push({text:EC_MESS.Export,title:EC_MESS.ExportTitle,className:"bxec-menu-sect-export",onclick:function(){_this.CloseCPopup();_this.ShowExportDialog(el)}})}if(el.PERM.edit_section&&this.permEx.section_edit&&!isGoogle&&!bSuperpose&&!isFirstExchange){menu.push({text:EC_MESS.Delete,title:EC_MESS.DelCalendarTitle,className:"bxec-menu-sect-del",onclick:function(){_this.CloseCPopup();_this.DeleteSection(el)}})}if(el.PERM.edit_section&&isGoogle&&!bSuperpose){menu.push({text:EC_MESS.Refresh,className:"bxec-menu-sect-edit",onclick:function(){_this.CloseCPopup();_this.bSyncGoogle=true;_this.Event.ReloadAll()}});menu.push({text:EC_MESS.Adjust,title:EC_MESS.CalDavDialogTitle,className:"bxec-menu-sect-edit",onclick:function(){_this.CloseCPopup();_this.ShowExternalDialog({})}});menu.push({text:EC_MESS.googleHide,className:"bxec-menu-sect-del",onclick:function(){_this.CloseCPopup();_this.HideCalDavSection(el);_this.Event.ReloadAll()}})}this.arMenuItems[menuId]=menu;if(menu.length>0){pEl.onmouseover=function(){if(_this["_sect_el_over_timeout"+this.id]){clearInterval(_this["_sect_el_over_timeout"+this.id])}BX.addClass(pEl,"bxec-sect-el-hover")};pEl.onmouseout=function(){_this["_sect_el_over_timeout"+this.id]=setTimeout(function(){BX.removeClass(pEl,"bxec-sect-el-hover")},100)}}else{pEl.onmouseover=BX.False;pEl.onmouseout=BX.False}},ShowCPopup:function(e,t){if(this.arMenuItems[e]){BX.PopupMenu.show(e,t,this.arMenuItems[e],{events:{onPopupClose:function(){BX.removeClass(this.bindElement,"bxec-menu-over")}}});BX.addClass(t,"bxec-menu-over")}},CloseCPopup:function(){BX.PopupMenu.currentItem.popupWindow.close()},ColorIsDark:function(e){if(!e)return false;if(e.charAt(0)=="#")e=e.substring(1,7);var t=parseInt(e.substring(0,2),16),i=parseInt(e.substring(2,4),16),s=parseInt(e.substring(4,6),16),n=(t*.8+i+s*.2)/510*100;return n<50},AppendCalendarHint:function(e,t){if(e.oHint&&e.oHint.Destroy)e.oHint.Destroy();var i;if(t&&e.SP_PARAMS)i="<b>"+e.SP_PARAMS.GROUP_TITLE+" > "+e.SP_PARAMS.NAME+" > "+e.NAME+"</b>";else i="<b>"+e.NAME+"</b>";var s=e.DESCRIPTION.length,n=350;if(s>0){if(s<n)i+="<br>"+e.DESCRIPTION;else i+="<br>"+e.DESCRIPTION.substr(0,n)+"..."}e.oHint=new BX.CHintSimple({parent:e._pElement,hint:i})},ShowCalendar:function(e,t,i){if(!e)return;if(t){if(e.DOM.pEl){e.DOM.pEl.style.backgroundColor=e.COLOR;BX.addClass(e.DOM.pEl,"bxec-sect-el-checked")}var s=e.TEXT_COLOR;if(!s)s=e.bDark?this.darkColor:this.brightColor;if(e.DOM.pText)e.DOM.pText.style.color=s;if(e.DOM.pSPEl){BX.addClass(e.DOM.pSPEl,"bxec-sect-el-checked");e.DOM.pSPEl.style.backgroundColor=e.COLOR}if(e.DOM.pSPText)e.DOM.pSPText.style.color=s}else{if(e.DOM.pEl){BX.removeClass(e.DOM.pEl,"bxec-sect-el-checked");e.DOM.pEl.style.backgroundColor="transparent"}if(e.DOM.pText)e.DOM.pText.style.color="#484848";if(e.DOM.pSPEl){BX.removeClass(e.DOM.pSPEl,"bxec-sect-el-checked");e.DOM.pSPEl.style.backgroundColor="transparent"}if(e.DOM.pSPText)e.DOM.pSPText.style.color="#484848"}this.oActiveSections[e.ID]=e.bShowed=!!t;if(!i){this.SetTabNeedRefresh(this.activeTabId);this.Event.ReloadAll()}},SaveSection:function(){var e=this.oSectDialog,t=e.CAL.oSect;e.CAL.DOM.Name.value=BX.util.trim(e.CAL.DOM.Name.value);if(e.CAL.DOM.Name.value==""){alert(EC_MESS.CalenNameErr);this.bEditCalDialogOver=true;return false}var i=this.GetReqData("section_edit",{name:e.CAL.DOM.Name.value,desc:e.CAL.DOM.Desc.value,color:e.CAL.Color,text_color:e.CAL.TextColor});if(e.CAL.Access)i.access=e.CAL.Access.GetValues();if(t.ID)i.id=bxInt(t.ID);if(e.CAL.DOM.Exch)i.is_exchange=e.CAL.DOM.Exch.checked?"Y":"N";if(e.CAL.DOM.ExpAllow.checked){i["export"]="Y";i.exp_set=e.CAL.DOM.ExpSet?e.CAL.DOM.ExpSet.value:"all"}var s=this;this.Request({postData:i,errorText:EC_MESS.CalenSaveErr,handler:function(e){if(e&&e.calendar&&e.calendar.ID){if(e.accessNames)s.HandleAccessNames(e.accessNames);s.SaveSectionClientSide(e.calendar);return true}return false}});return true},SaveSectionClientSide:function(e){if(e.EXPORT&&!e.EXPORT.ALLOW)e.EXPORT=false;this.arSPSections=null;if(typeof this.arSectionsInd[e.ID]=="undefined"){this.arSections.push(e);this.arSectionsInd[e.ID]=this.arSections.length-1;this.BuildSectionElement(e,true);this.SaveLastSection(e.ID);if(this.bSuperpose&&this.oSectDialog.CAL.DOM.add2SP)this.SetSuperposed(e,!this.oSectDialog||this.oSectDialog.CAL.DOM.add2SP.checked)}else{var t,i=this.arSections[this.arSectionsInd[e.ID]],s=i.COLOR,n=i.TEXT_COLOR,a=!i||e.COLOR!=s||e.TEXT_COLOR!=n;if(!i)return;for(t in e){if(e.hasOwnProperty(t))i[t]=e[t]}i.DOM.pText.innerHTML=BX.util.htmlspecialchars(i.NAME);if(i.DOM.pSPText)i.DOM.pSPText.innerHTML=BX.util.htmlspecialchars(i.NAME);i.bDark=this.ColorIsDark(i.COLOR);this.BuildSectionMenu(e.ID);if(i.DOM.pSPEl)this.BuildSectionMenu(e.ID,true);if(a)this.UpdateSectionColor(i,s,n);this.ShowCalendar(i,i.bShowed,true)}},HideCalDavSection:function(e){if(e.ID&&confirm(EC_MESS.googleHideConfirm)){var t=this;this.Request({getData:this.GetReqData("section_caldav_hide",{id:e.ID}),handler:function(i){if(i.refreshView)BX.reload();return i.result?t.DeleteSectionClientSide(e):false}})}},DeleteSection:function(e){if(!e.ID||!confirm(EC_MESS.DelCalendarConfirm))return false;var t=this;this.Request({getData:this.GetReqData("section_delete",{id:e.ID}),errorText:EC_MESS.DelCalendarErr,handler:function(i){return i.result?t.DeleteSectionClientSide(e):false}});return true},DeleteSectionClientSide:function(e){BX.cleanNode(e.DOM.pEl,true);if(e.DOM.pSPEl)BX.cleanNode(e.DOM.pSPEl,true);var t;for(t=0;t<this.arSections.length;t++){if(this.arSections[t].ID==e.ID){this.arSections=BX.util.deleteFromArray(this.arSections,t);break}}this.arSPSections=null;delete this.oActiveSections[e.ID];delete this.oSections[e.ID];this.Event.ReloadAll()},UpdateSectionColor:function(e,t,i){if(!e)return;var s=e.COLOR,n=e.TEXT_COLOR?e.TEXT_COLOR:e.bDark?this.darkColor:this.brightColor;e.DOM.pEl.style.backgroundColor=s;e.DOM.pText.style.color=n;var a,o,r=[["oTLParts","week"],["oTLParts","day"],["oDaysT","week"],["oDaysT","day"]],l,h=this.arEvents.length,c,d,u,f,p;for(l=0;l<h;l++){c=this.arEvents[l];if(!c)continue;a=!c.displayColor||!t||c.displayColor===t;o=!c.displayTextColor||!i||c.displayTextColor===i;if(c.SECT_ID!=e.ID||!a&&!o)continue;u=c.oParts.length;for(d=0;d<u;d++){if(a)c.oParts[d].style.backgroundColor=s;if(o)c.oParts[d].style.color=n}u=r.length;for(d=0;d<u;d++){if(c[r[d][0]]&&c[r[d][0]][r[d][1]]){p=c[r[d][0]][r[d][1]];if(typeof p=="object"&&p.nodeType){if(a)p.style.backgroundColor=s;if(o)p.style.color=n}else{for(f=0;f<p.length;f++){if(a)p[f].style.backgroundColor=s;if(o)p[f].style.color=n}}}}if(a)c.displayColor=s}},ShowAllCalendars:function(e,t){var i=t?this.arSPCalendarsShow:this.arSections;var s,n=i.length;for(s=0;s<n;s++){el=i[s];this.ShowCalendar(el,e,true,!t)}this.Event.ReloadAll()},CheckCalBarGlobChecker:function(e,t){var i=t?"CalBarGlobCheckerSP":"CalBarGlobChecker";if(e=="none"){this[i].pWnd.className="bxec-cal-bar-none";this[i].pWnd.title=""}else if(e){this[i].flag=false;this[i].pWnd.className="bxec-iconkit bxec-cal-bar-check";

this[i].pWnd.title=EC_MESS.DeSelectAll}else{this[i].flag=true;this[i].pWnd.className="bxec-iconkit bxec-cal-bar-uncheck";this[i].pWnd.title=EC_MESS.SelectAll}},SetSuperposed:function(e,t){if(e)e.SUPERPOSED=!!t;var i=this,s,n=[];for(s=0;s<this.arSections.length;s++){if(this.arSections[s].SUPERPOSED)n.push(parseInt(this.arSections[s].ID))}this.Request({getData:this.GetReqData("set_superposed",{sect:n,trackedUser:e&&e.CAL_TYPE=="user"?e.OWNER_ID:0}),errorText:EC_MESS.AppendSPCalendarErr,handler:function(e){if(e.result){if(!i.bSuperpose&&i.canAddToSuperpose)return BX.reload();return i.BuildSectionElements()}return false}})},GetReqData:function(e,t){if(!t)t={};if(e)t.action=e;t.sessid=BX.bitrix_sessid();t.bx_event_calendar_request="Y";t.reqId=Math.round(Math.random()*1e6);return t},GetCenterWindowPos:function(e,t){if(!e)e=400;if(!t)t=300;var i=BX.GetWindowSize(document);var s=bxInt(bxInt(i.scrollTop)+(i.innerHeight-t)/2-30);var n=bxInt(bxInt(i.scrollLeft)+(i.innerWidth-e)/2-30);return{top:s,left:n}},ShowStartUpEvent:function(){var e=this,t,i,s=false;for(i=0;i<this.arEvents.length;i++){t=this.arEvents[i];if(this.startupEvent.ID==t.ID||this.startupEvent.PARENT_ID==t.PARENT_ID&&t["~TYPE"]!="tasks"){if(this.startupEvent.EDIT){setTimeout(function(){e.Event.Edit({oEvent:t})},1e3);break}else{if(!s)s=t;if(this.startupEvent.RRULE&&this.startupEvent["~CURRENT_DATE"]&&this.FormatDate(BX.parseDate(t.DATE_FROM))==this.startupEvent["~CURRENT_DATE"]){s=t;break}}}}if(s){setTimeout(function(){e.Event.View(s)},1e3)}this.startupEvent.viewed=true},SaveSettings:function(){var e=this.oSetDialog;if(e.CAL.inPersonal){this.userSettings.blink=e.CAL.DOM.Blink.checked?1:0;this.userSettings.showDeclined=e.CAL.DOM.ShowDeclined.checked?1:0;this.userSettings.meetSection=e.CAL.DOM.SectSelect.value}this.userSettings.showMuted=e.CAL.DOM.ShowMuted.checked?1:0;this.userSettings.denyBusyInvitation=e.CAL.DOM.denyBusyInvitation.checked?1:0;if(e.CAL.DOM.TimezoneSelect)this.arConfig.userTimezoneName=e.CAL.DOM.TimezoneSelect.value;var t=this.GetReqData("save_settings",{user_settings:this.userSettings,user_timezone_name:this.arConfig.userTimezoneName});if(this.PERM.access){t.type_access=e.CAL.Access.GetValues();e.CAL.Access.SetSelected(this.typeAccess);this.settings.work_time_start=e.CAL.DOM.WorkTimeStart.value;this.settings.work_time_end=e.CAL.DOM.WorkTimeEnd.value;this.settings.week_holidays=[];for(var i=0,s=e.CAL.DOM.WeekHolidays.options.length;i<s;i++)if(e.CAL.DOM.WeekHolidays.options[i].selected)this.settings.week_holidays.push(e.CAL.DOM.WeekHolidays.options[i].value);this.settings.year_holidays=e.CAL.DOM.YearHolidays.value;this.settings.year_workdays=e.CAL.DOM.YearWorkdays.value;t.settings=this.settings}this.Request({postData:t,handler:function(){BX.reload()}})},ClearPersonalSettings:function(){this.Request({postData:this.GetReqData("save_settings",{clear_all:1}),handler:function(){BX.reload()}})},GetUserHref:function(e){return this.pathToUser.replace(/#user_id#/gi,e)},GetUserProfileLink:function(e,t,i,s,n){var a;if(i.type=="ext"){a="";if(i.email)a=BX.util.htmlspecialchars(i.email);else if(i.name)a=BX.util.htmlspecialchars(i.name);return a}else{var o=this.arConfig.pathToUser.toLowerCase();o=o.replace("#user_id#",e);s=s?' class="'+s+'"':"";if(!t)return o;a=BX.util.htmlspecialchars(i.name);if(n)a+=' <span style="font-weight: normal !important;">('+EC_MESS.Host+")</span>";return"<a"+s+' href="'+o+'" target="_blank" title="'+EC_MESS.UserProfile+": "+BX.util.htmlspecialchars(i.name)+'" >'+a+"</a>"}},Day:function(e){return this.days[{MO:0,TU:1,WE:2,TH:3,FR:4,SA:5,SU:6}[e]]},GetWeekDayByInd:function(e){return["SU","MO","TU","WE","TH","FR","SA"][e]},ConvertDayIndex:function(e){if(e==0)return 6;return e-1},Request:function(e){if(!e.url)e.url=this.actionUrl;if(e.bIter!==false)e.bIter=true;if(!e.postData&&!e.getData)e.getData=this.GetReqData();var t;if(!e.errorText)t=false;var i=e.getData?e.getData.reqId:e.postData.reqId;e.reqId=i;var s=this,n=0,a;if(e.handler){a=function(t){var a=function(){if(s.requests[i].status!=="canceled"){var o=t.toLowerCase().indexOf("bx_event_calendar_action_error");if(!t||t.length<=0||o!=-1){var r="";if(o>=0){var l=o+"BX_EVENT_CALENDAR_ACTION_ERROR:".length,h=t.indexOf("-->",l);r=t.substr(l,h-l)}if(e.onerror&&typeof e.onerror=="function")e.onerror();return s.DisplayError(r||e.errorText||"")}s.requests[i].status="complete";var c=e.handler(s.GetRequestRes(i),t);if(c===false&&++n<20&&e.bIter)setTimeout(a,5);else s.ClearRequestRes(i)}};setTimeout(a,50)}}else{a=BX.DoNothing()}this.requests[e.reqId]={status:"sent",xhr:e.postData?BX.ajax.post(e.url,e.postData,a):BX.ajax.get(e.url,e.getData,a)};return e},CancelRequest:function(e){if(this.requests[e]&&this.requests[e].status=="sent")this.requests[e].status="canceled"},GetRequestRes:function(e){if(top.BXCRES&&typeof top.BXCRES[e]!="undefined")return top.BXCRES[e];return{}},ClearRequestRes:function(e){if(top.BXCRES){top.BXCRES[e]=null;delete top.BXCRES[e]}},ExtendUserSearchInput:function(){if(!window.SonetTCJsUtils)return;var e=this;if(!SonetTCJsUtils.EC__GetRealPos)SonetTCJsUtils.EC__GetRealPos=SonetTCJsUtils.GetRealPos;SonetTCJsUtils.GetRealPos=function(t){var i=SonetTCJsUtils.EC__GetRealPos(t);if(e.oSuperposeDialog&&e.oSuperposeDialog.bShow){scrollTop=e.oSuperposeDialog.oCont.scrollTop;i.top=bxInt(i.top)-scrollTop;i.bottom=bxInt(i.bottom)-scrollTop}return i}},ParseLocation:function(e,t){if(!e)e="";var i={mrid:false,mrevid:false,str:e};if(e.length>5&&e.substr(0,5)=="ECMR_"){var s=e.split("_");if(s.length>=2){if(!isNaN(parseInt(s[1]))&&parseInt(s[1])>0)i.mrid=parseInt(s[1]);if(!isNaN(parseInt(s[2]))&&parseInt(s[2])>0)i.mrevid=parseInt(s[2])}}if(i.mrid&&t===true){for(var n=0,a=this.meetingRooms.length;n<a;n++){if(this.meetingRooms[n].ID==i.mrid){i.mrind=n;i.MR=this.meetingRooms[n];break}}}return i},OnResize:function(e){if(this._resizeTimeout)this._resizeTimeout=clearTimeout(this._resizeTimeout);var t=this;if(e!==false){this._resizeTimeout=setTimeout(function(){t.OnResize(false)},e||200)}else{switch(this.activeTabId){case"month":setTimeout(BX.delegate(this.BuildDaysTitle,this),100);break;case"week":case"day":this.ResizeTabTitle(this.Tabs[this.activeTabId]);break}this.bJustRedraw=true;this.SetView({month:this.activeDate.month,year:this.activeDate.year});setTimeout(function(){t.bJustRedraw=false},500)}},_OnPopupCloseHandler:function(e){if(e&&e.popupContainer&&e.popupContainer.id&&e.popupContainer.id.indexOf("timeman")!==-1){this.OnResize()}BX.removeCustomEvent("onPopupClose",BX.proxy(this._OnPopupCloseHandler,this))},CreateStrut:function(e){return BX.create("DIV",{style:{width:e+"px",height:"1px"}})},CheckMouseInCont:function(e,t,i){var s=BX.pos(e),n=BX.GetWindowScrollPos(),a=t.clientX+n.scrollLeft,o=t.clientY+n.scrollTop;if(typeof i=="undefined")i=0;return a>=s.left-i&&a<=s.right+i&&o<=s.bottom+i&&o>=s.top-i},SaveCalDavConnections:function(e,t){var i=[],s,n;for(s=0;s<this.arConnections.length;s++){n=this.arConnections[s];var a={};for(var o in n.sections){if(!n.sections.hasOwnProperty(o))continue;a[o]=n.sections[o].checked?"Y":"N"}i.push({id:n.id||0,name:n.name,link:n.link,user_name:n.user_name,pass:typeof n.pass=="undefined"?"bxec_not_modify_pass":n.pass,del:n.del?"Y":"N",del_calendars:n.pDelCalendars.checked?"Y":"N",sections:a})}this.Request({postData:this.GetReqData("connections_edit",{connections:i}),handler:function(){setTimeout(function(){if(e&&typeof e=="function")e(true)},100)},onerror:function(){if(t&&typeof t=="function")t()}});return true},IsDavCalendar:function(e){return this.oSections[e]&&(this.oSections[e].IS_EXCHANGE||this.oSections[e].CAL_DAV_CON)},Section:function(e){var t={};if(this.arSectionsInd[e]&&this.arSections[this.arSectionsInd[e]])t=this.arSections[this.arSectionsInd[e]];return t},CanDo:function(e,t){var i=this.Section(t);return i.ID&&i.PERM[e]},DefaultAction:function(e){if(typeof e=="undefined"&&!this.bDoDefault){this.bDoDefault=true;return false}if(e===false)this.bDoDefault=false;return true},OnTaskChanged:function(){if(!this.oActiveSections["tasks"])return this.ShowCalendar(this.oSections["tasks"],true);this.Event.ReloadAll()},OnTaskKilled:function(e){for(var t=0,i=this.arEvents.length;t<i;t++){if(this.arEvents[t]["~TYPE"]=="tasks"&&this.arEvents[t].ID==e){this.Event.UnDisplay(this.arEvents[t]);break}}},HandleAccessNames:function(e){for(var t in e){if(e.hasOwnProperty(t))this.arNames[t]=e[t]}},GetAccessName:function(e){return this.arNames[e]||e},GetMeetingSection:function(){if(this.userSettings.meetSection&&this.oSections[this.userSettings.meetSection]&&this.oSections[this.userSettings.meetSection].ACTIVE!=="N"){return this.userSettings.meetSection}return this.arSections[0]["ID"]},CheckMeetingRoom:function(e,t){this.Request({postData:this.GetReqData("check_meeting_room",e),handler:function(e){if(e){if(t&&typeof t=="function")t(e.check);return true}}})},AddGroupMembers:function(){var e=this,t={};this.Request({postData:this.GetReqData("get_group_members",t),handler:function(t){if(t){if(t.users)BX.onCustomEvent(e,"onGetGroupMembers",[t.users]);return true}}})},ItsYou:function(e){if(e==this.userId)return'<span class="bxc-it-is-you"> ('+EC_MESS.ItIsYou+")</span>";return""},Personal:function(){return this.type=="user"&&this.ownerId==this.userId},GetFreeDialogColor:function(){var e=this.Colors[0],t,i={},s;for(t in this.Colors)i[this.Colors[t]]=true;for(t in this.arSections){s=this.arSections[t].COLOR;if(i[s])i[s]=false}for(t in i){if(i[t]){e=t;break}}return e},FormatDate:function(e){return BX.date.format(this.DATE_FORMAT,e.getTime()/1e3)},FormatTime:function(e,t){return BX.date.format(t===true?this.TIME_FORMAT:this.TIME_FORMAT_SHORT,e.getTime()/1e3)},FormatDateTime:function(e){return BX.date.format(this.DATETIME_FORMAT,e.getTime()/1e3)},ParseDate:function(e,t){var i=false;var s=BX.message("FORMAT_DATETIME");e=BX.util.trim(e);if(t!==false)s=s.replace(":SS","");if(BX.type.isNotEmptyString(e)){var n="";for(l=1;l<=12;l++){n=n+"|"+BX.message("MON_"+l)}var a=new RegExp("([0-9]+|[a-z]+"+n+")","ig");var o=e.match(a),r=BX.message("FORMAT_DATE").match(/(DD|MI|MMMM|MM|M|YYYY)/gi),l,h,c=[],d=[],u={};if(!o)return null;if(o.length>r.length){r=s.match(/(DD|MI|MMMM|MM|M|YYYY|HH|H|SS|TT|T|GG|G)/gi)}for(l=0,h=o.length;l<h;l++){if(BX.util.trim(o[l])!=""){c[c.length]=o[l]}}for(l=0,h=r.length;l<h;l++){if(BX.util.trim(r[l])!=""){d[d.length]=r[l]}}var f=BX.util.array_search("MMMM",d);if(f>0){c[f]=BX.getNumMonth(c[f]);d[f]="MM"}else{f=BX.util.array_search("M",d);if(f>0){c[f]=BX.getNumMonth(c[f]);d[f]="MM"}}for(l=0,h=d.length;l<h;l++){var p=d[l].toUpperCase();u[p]=p=="T"||p=="TT"?c[l]:parseInt(c[l],10)}if(u["DD"]>0&&u["MM"]>0&&u["YYYY"]>0){var v=new Date;if(i){v.setUTCDate(1);v.setUTCFullYear(u["YYYY"]);v.setUTCMonth(u["MM"]-1);v.setUTCDate(u["DD"]);v.setUTCHours(0,0,0)}else{v.setDate(1);v.setFullYear(u["YYYY"]);v.setMonth(u["MM"]-1);v.setDate(u["DD"]);v.setHours(0,0,0)}if((!isNaN(u["HH"])||!isNaN(u["GG"])||!isNaN(u["H"])||!isNaN(u["G"]))&&!isNaN(u["MI"])){if(!isNaN(u["H"])||!isNaN(u["G"])){var C=(u["T"]||u["TT"]||"am").toUpperCase()=="PM";var D=parseInt(u["H"]||u["G"]||0,10);if(C){u["HH"]=D+(D==12?0:12)}else{u["HH"]=D<12?D:0}}else{u["HH"]=parseInt(u["HH"]||u["GG"]||0,10)}if(isNaN(u["SS"]))u["SS"]=0;if(i){v.setUTCHours(u["HH"],u["MI"],u["SS"])}else{v.setHours(u["HH"],u["MI"],u["SS"])}}return v}}return null},FormatTimeByNum:function(e,t){var i="";if(t==undefined)t="00";else{t=parseInt(t,10);if(isNaN(t))t="00";else{if(t>59)t=59;t=t<10?"0"+t.toString():t.toString()}}e=parseInt(e,10);if(e>24)e=24;if(isNaN(e))e=0;if(this.bAMPM){var s="am";if(e==0){e=12}else if(e==12){s="pm"}else if(e>12){s="pm";e-=12}i=e.toString()+":"+t.toString()+" "+s}else{i=(e<10?"0":"")+e.toString()+":"+t.toString()}return i},ParseTime:function(e){var t,i,s;e=BX.util.trim(e);e=e.toLowerCase();if(this.bAMPM){var n="pm";if(e.indexOf("am")!=-1)n="am";e=e.replace(/[^\d:]/gi,"");s=e.split(":");t=parseInt(s[0]||0,10);i=parseInt(s[1]||0,10);if(t==12){if(n=="am")t=0;else t=12}else if(t!=0){if(n=="pm"&&t<12){t+=12}}}else{s=e.split(":");t=s[0]||0;i=s[1]||0;if(t.toString().length>2)t=parseInt(t.toString().substr(0,2));i=parseInt(i)}if(isNaN(t)||t>24)t=0;if(isNaN(i)||i>60)i=0;return{h:t,m:i}},CheckType:function(e,t){return this.type==e&&this.ownerId==t},CheckSectionsCount:function(){var e;for(e=0;e<this.arSections.length;e++){if(this.arSections[e].PERM.edit_section&&this.IsCurrentViewSect(this.arSections[e]))return true}return false},GetWeekStart:function(){return this.weekStart},GetWeekDayOffset:function(e){if(!this.weekDayOffsetIndex){this.weekDayOffsetIndex={};for(var t=0;t<this.weekDays.length;t++)this.weekDayOffsetIndex[this.weekDays[t][2]]=t}return this.weekDayOffsetIndex[e]},SaveLastSection:function(e){this.lastSection=parseInt(e);BX.userOptions.save("calendar","last_section",this.type+"_"+this.ownerId,this.lastSection)},GetLastSection:function(){return this.lastSection}};window.bxInt=function(e){return parseInt(e,10)};window.bxIntEx=function(e){e=parseInt(e,10);if(isNaN(e))e=0;return e};window.bxSpCh=function(e){if(!e)return"";e=e.replace(/script_>/g,"script>");e=e.replace(/&/g,"&amp;");e=e.replace(/"/g,"&quot;");e=e.replace(/</g,"&lt;");e=e.replace(/>/g,"&gt;");return e};window.bxSpChBack=function(e){if(!e)return"";e=e.replace(/&lt;/g,"<");e=e.replace(/&gt;/g,">");e=e.replace(/&quot;/g,'"');e=e.replace(/&amp;/g,"&");e=e.replace(/script_>/g,"script>");return e};window.EnterAndNotTextArea=function(e,t){if(e.keyCode==13){var i=e.target||e.srcElement;if(i&&i.nodeName&&i.nodeName.toLowerCase()!="textarea"&&i.id.indexOf(t)==-1){BX.PreventDefault(e);return true}}return false};function bxGetDateFromTS(e,t){var i=new Date(e);if(!t){var s=i.getHours()||0,n=i.getMinutes()||0;i={date:i.getDate(),month:i.getMonth()+1,year:i.getFullYear(),bTime:!!(s||n),oDate:i};if(i.bTime){i.hour=s;i.min=n}}return i}window.bxFormatDate=function(e,t,i){var s=BX.message("FORMAT_DATE");s=s.replace(/YY(YY)?/gi,i);s=s.replace(/MMMM/gi,BX.message("MONTH_"+Number(t)));s=s.replace(/MM/gi,zeroInt(t));s=s.replace(/M/gi,BX.message("MON_"+Number(t)));s=s.replace(/DD/gi,zeroInt(e));return s};window.zeroInt=function(e){e=bxInt(e);if(isNaN(e))e=0;return e<10?"0"+e.toString():e.toString()};window.DenyDragEx=function(e){e.style.MozUserSelect="none";e.ondrag=BX.False;e.ondragstart=BX.False;e.onselectstart=BX.False};JCEC.prototype.GetCurrentSections=function(){var e,t=[],i=[],s=[];for(e in this.oActiveSections){if(this.oActiveSections.hasOwnProperty(e)){if(e!="tasks"){e=parseInt(e);if(e<0||isNaN(e))continue}if(this.oActiveSections[e]){if(this.arSectionsInd[e]&&this.arSections[this.arSectionsInd[e]]&&this.arSections[this.arSectionsInd[e]].SUPERPOSED)t.push(e);else i.push(e)}else{s.push(e)}}}return{superposed:t,active:i,hidden:s}};JCEC.prototype.LoadEvents=function(e,t,s){if(e==undefined)e=this.activeDate.month;if(t==undefined)t=this.activeDate.year;if(s==undefined)s={};var n,a,o=this,r=this.GetCurrentSections();var l=this.Request({getData:this.GetReqData("load_events",{month:parseInt(e,10)+1,year:t,usecl:"Y",active_sect:r.active,hidden_sect:r.hidden,sup_sect:r.superposed,cal_dav_data_sync:this.bSyncGoogle?"Y":"N"}),errorText:EC_MESS.LoadEventsErr,handler:function(h){if(o.loadEventsLastRequestId){if(o.loadEventsLastRequestId==l.reqId){o.loadEventsLastRequestId=false}else{o.CancelRequest(o.loadEventsLastRequestId)}}var c=o.GetCurrentSections();if(!o.CompareArrays(r.superposed,c.superposed)||!o.CompareArrays(r.active,c.active)||!o.CompareArrays(r.hidden,c.hidden)){return}if(o.bCalDAV&&o.bSyncGoogle&&h.connections&&h.connections.length>0){o.arConnections=h.connections;for(a in o.arSections){if(o.arSections.hasOwnProperty(a)){n=o.arSections[a];if(n.CAL_DAV_CAL&&n.CAL_DAV_CON&&n.DOM.pStatus){for(i in o.arConnections){if(o.arConnections.hasOwnProperty(i)&&o.arConnections[i].id==n.CAL_DAV_CON){n["~CAL_DAV_LAST_SYNC"]=o.arConnections[i].last_result;if(n["~CAL_DAV_LAST_SYNC"].indexOf("[200]")>=0){n.DOM.pStatus.className="bxec-spr bxec-cal-dav-google";n.DOM.pStatus.title=""}else{n.DOM.pStatus.className="bxec-spr bxec-cal-dav-google-fail";n.DOM.pStatus.title=EC_MESS.SyncError+": "+el["~CAL_DAV_LAST_SYNC"]}break}}}}}}o.bSyncGoogle=false;o.HandleLoadedEvents({events:h.events,attendees:h.attendees,month:e,year:t,Params:s})}});this.loadEventsLastRequestId=l.reqId};JCEC.prototype.HandleLoadedEvents=function(e){this.HandleEvents(e.events,e.attendees);this.arLoadedMonth[e.month+"."+e.year]=true;if(!e.Params)e.Params={};if(isNaN(bxInt(e.Params.month)))e.Params.month=e.month;if(isNaN(bxInt(e.Params.year)))e.Params.year=e.year;this.SetView(e.Params)};JCEC.prototype.HandleEvents=function(e,t){var i,s,n,a,o;if(e&&e.length){for(i=0;i<e.length;i++){s=this.Event.PreHandle(e[i]);a=this.Event.SmartId(s);if(!s.ID)continue;if(this.arLoadedEventsId[a])continue;this.arEvents.push(s);this.arLoadedEventsId[a]=true}}if(t){for(i in t){o=parseInt(i,10);n=t[i];if(!isNaN(o)&&n&&n.length)this.arAttendees[o]=n}}};JCEC.prototype.HandleAccessibility=function(e){var t,i;if(e){for(i in e){if(e.hasOwnProperty(i)&&e[i].length>0){for(t=0;t<e[i].length;t++){e[i][t]=this.Event.PreHandle(e[i][t])}}}}return e};JCEC.prototype.FilterAccessibility=function(e,t,i){return e};JCEC.prototype.BuildEventHolder=function(){if(this.EventHolderCont){BX.cleanNode(this.EventHolderCont,true);this.EventHolderCont=null}this.EventHolderCont=this.DaysGridCont.appendChild(BX.create("DIV",{props:{className:"bxec-event-holder"}}));var e=this;var t=this.oDaysGridTable.rows[0].cells[0];setTimeout(function(){e.arCellCoords={};for(var i=0;i<7;i++){e.arCellCoords[i]={left:bxInt(e.oDaysGridTable.rows[0].cells[i].offsetLeft),width:bxInt(e.oDaysGridTable.rows[0].cells[i].offsetWidth)}}e.dayCellHeight=parseInt(t.offsetHeight);e.dayCellWidth=parseInt(t.offsetWidth);e.DisplayEventsMonth()},10)};JCEC.prototype.EventClick=function(e){if(!e)e=window.event;var t,i,s,n,a=e.target||e.srcElement;while(a){if(a.getAttribute){t=parseInt(a.getAttribute("data-bx-event-ind"));i=a.getAttribute("data-bx-event-action");if(i)s=i;if(!isNaN(t)&&this.arEvents[t]){n=this.arEvents[t];if(!s||s=="view"){this.Event.View(n)}else if(s=="edit"){this.Event.Edit({oEvent:n})}else if(s=="del"){if(this.Event.IsAttendee(n)&&!this.Event.IsHost(n)){if(n.MEETING_STATUS!="N"){this.Event.SetMeetingStatus(false,{eventId:bxInt(n.ID),comment:""})}}else if(n["~TYPE"]!="tasks"){this.Event.Delete(n)}}if(this.MoreEventsWin)this.MoreEventsWin.close();break}}a=a.parentNode}};JCEC.prototype.DisplayEventsMonth=function(e){var t;if(e||this.bJustRedraw){BX.cleanNode(this.EventHolderCont);for(t=0;t<this.activeDateObjDays.length;t++)this.activeDateObjDays[t].arEvents={begining:[],all:[]}}else{this.activeFirst=this.activeDateDays[0].getTime();this.activeLast=this.activeDateDays[this.activeDateDays.length-1].getTime()}for(t=0;t<this.arEvents.length;t++){if(this.arEvents[t])this.HandleEventMonth(this.arEvents[t],t)}this.RefreshEventsOnWeeks([0,1,2,3,4,5])};JCEC.prototype.HandleEventMonth=function(e,t,i){var s,n,a,o;e=this.HandleEventCommon(e,t);if(!e)return;e.oParts=[];e.oWeeks=[];if(!i){s=bxGetDateFromTS(e.DT_FROM_TS);n=bxGetDateFromTS(e.DT_TO_TS);if(s.bTime&&!n.bTime)n=bxGetDateFromTS(e.DT_TO_TS-60*60*24);s={date:s.date,month:s.month-1,year:s.year};n={date:n.date,month:n.month-1,year:n.year};a=new Date(s.year,s.month,s.date).getTime();o=new Date(n.year,n.month,n.date).getTime()}else{s=i.d_from;n=i.d_to;a=i._d_from;o=i._d_to}if(a>o||o<this.activeFirst||a>this.activeLast)return;var r={real_from:s,real_to:n,from:a,to:o,real_from_t:a,real_to_t:o};if(a<this.activeFirst&&o<this.activeLast){r.from=this.activeFirst}else if(a>this.activeFirst&&o>this.activeLast){r.to=this.activeLast}else if(a<this.activeFirst&&o>this.activeLast){r.from=this.activeFirst;r.to=this.activeLast}e.display=true;var l=e.DT_TO_TS+(e.DT_SKIP_TIME=="Y"?this.dayLength:3e5)<(new Date).getTime();e.bMuted=this.userSettings.showMuted&&l;this.DisplayEvent_M(r,e);if(!l)this.Event.Blink(e,true,true)};JCEC.prototype.HandleEventCommon=function(e,t){if((!this.userSettings.showDeclined||e.CREATED_BY!==this.userId)&&e.MEETING_STATUS=="N"&&(!this.startupEvent||this.startupEvent&&this.startupEvent.ID!=e.ID))return false;if(!e.oParts)e.oParts=[];if(!e.oWeeks)e.oWeeks=[];e.ind=t;e=this.Event.SetColor(e);return e};JCEC.prototype.DisplayEvent_M=function(e,t){var i,s,n,a,o={partDaysCount:0},r=false,l=false;for(s=0,n=this.activeDateDays.length;s<n;s++){i=this.activeDateDays[s];a=this.GetWeekDayOffset(this.GetWeekDayByInd(i.getDay()));if(i.getTime()==e.from){r=true;o={left:this.arCellCoords[a].left+1,arInit:e,dayIndex:s,partDaysCount:0}}o.partDaysCount++;if(!r)continue;this.activeDateObjDays[s].arEvents.all.push({oEvent:t,partInd:t.oParts.length,daysCount:o.partDaysCount});if(a==6){l=i.getTime()==e.to;o.width=this.arCellCoords[a].left+this.arCellCoords[a].width-o.left-3;o.bEnd=l&&e.to==e.real_to_t;this.BuildEventDiv(o,t);if(l)break}if(!l&&a==0&&i.getTime()!=e.from)o={left:this.arCellCoords[0].left+1,arInit:e,dayIndex:s,partDaysCount:1};if(i.getTime()==e.to){l=true;o.width=this.arCellCoords[a].left+this.arCellCoords[a].width-o.left-3;o.bEnd=true;this.BuildEventDiv(o,t);break}}};JCEC.prototype.BuildEventDiv=function(e,t){if(parseInt(e.width)<=0)return;var i,s,n;this.activeDateObjDays[e.dayIndex].arEvents.begining.push({oEvent:t,partInd:t.oParts.length,daysCount:e.partDaysCount});var a=this.Event.IsTask(t),o=this.Event.IsCrm(t);var r="bxec-event";if(t.bMuted)r+=" bxec-event-muted";i=BX.create("DIV",{props:{className:r},style:{left:e.left+"px",width:bxInt(e.width)+"px",minWidth:bxInt(e.width)+"px",display:"none",backgroundColor:t.displayColor,color:t.displayTextColor}});s=i.appendChild(BX.create("TABLE"));n=s.insertRow(-1);var l=this;if(t.oParts.length>0||e.arInit.real_from_t<e.arInit.from)BX.adjust(n.insertCell(-1),{props:{className:"bxec-event-ar"},html:"<i></i>"});var h,c=this.Event.IsMeeting(t),d=this.Event.GetQuestIcon(t),u=n.insertCell(-1),f="";if(c)f='<i class="bxc-e-meeting"></i>';if(a)f='<i class="bxc-e-task"></i>';if(o&&!a)f='<i class="bxc-e-crm"></i>';u.innerHTML='<div class="bxec-event-title">'+f+'<span class="bxec-event-label"'+this.Event.GetLabelStyle(t)+">"+d+BX.util.htmlspecialchars(t.NAME)+"</span></div>";this.Event.BuildActions({cont:u,oEvent:t,evCont:i});if(!e.bEnd)BX.adjust(n.insertCell(-1),{props:{className:"bxec-event-ar"},html:"<b></b>"});i.onmouseover=function(){l.HighlightEvent_M(t,this)};i.onmouseout=function(){l.HighlightEvent_M(t,this,true)};i.ondblclick=function(){l.Event.View(t)};i.setAttribute("data-bx-event-ind",t.ind);this.dragDrop.RegisterEvent(i,t,"month");t.oWeeks.push({dayIndex:e.dayIndex,bEnd:e.bEnd});t.oParts.push(i);if((e.dayIndex+1)%7==0){h=bxInt(e.width)}else{h=(8-(e.dayIndex+1)%7)*(bxInt(e.width)-1)}if(h>this.DaysTitleCont.offsetWidth)h=this.DaysTitleCont.offsetWidth-10;u.firstChild.style.maxWidth=h+"px";this.EventHolderCont.appendChild(i)};JCEC.prototype.HighlightEvent_M=function(e,t,i){if(!e||!e.oParts||e.oParts.length==0)return;var s,n,a=i?BX.removeClass:BX.addClass;for(s=0,n=e.oParts.length;s<n;s++)a(e.oParts[s],"bxec-event-over");if(t)a(t,"bxec-event-over");if(e.pMoreDivs)for(s=0,n=e.pMoreDivs.length;s<n;s++)a(e.pMoreDivs[s],"bxec-event-over")};JCEC.prototype.GetEventWeeks=function(e){var t,i,s=[],n,a;for(n=0,a=e.oParts.length;n<a;n++){t=e.oWeeks[n].dayIndex;for(i=0;i<6;i++){if(t>=i*7&&t<(i+1)*7){s.push(i);break}}}return s};JCEC.prototype.BuildWeekEventHolder=function(){if(this._bBETimeOut)clearTimeout(this._bBETimeOut);var e=this;this._bBETimeOut=setTimeout(function(){var t=e.Tabs[e.activeTabId||e.userSettings.tabId];if(!t.pEventHolder)t.pEventHolder=t.pBodyCont.rows[0].cells[0].firstChild;if(e.bJustRedraw)e.ReBuildEvents(t.id);else e.DisplayWeekEvents(t)},0)};JCEC.prototype.DisplayWeekEvents=function(e){BX.cleanNode(e.pEventHolder);for(var t=0,i=this.arEvents.length;t<i;t++)if(this.arEvents[t])this.HandleWeekEvent({Tab:e,Event:this.arEvents[t],ind:t});this.RefreshEventsInDayT(e);this.ArrangeEventsInTL(e)};JCEC.prototype.ReBuildEvents=function(e){var t=this.Tabs[e],i=t.pTimelineCont,s,n,a,o;BX.cleanNode(t.pEventHolder);for(n=0;n<t.daysCount;n++){o=t.arDays[n];o.TLine={};o.Events={begining:[],hidden:[],all:[]};o.EventsCount=0}a=i.childNodes.length;n=0;while(n<a){s=i.childNodes[n];if(s.className.toString().indexOf("bxec-tl-event")==-1){n++;continue}i.removeChild(s);a=i.childNodes.length}this.DisplayWeekEvents(t)};JCEC.prototype.HandleWeekEvent=function(e){var t=this.HandleEventCommon(e.Event,e.ind);if(!t)return;if(!t.oDaysT)t.oDaysT={};if(!t.oTLParts)t.oTLParts={};t.oTLParts[e.Tab.id]=[];var i=t.DT_FROM_TS,s=t.DT_TO_TS,n=bxGetDateFromTS(i),a=bxGetDateFromTS(s);if(s<e.Tab.activeFirst||i>e.Tab.activeLast)return;if(t.DT_SKIP_TIME!="Y"&&s==e.Tab.activeFirst&&s!==i)return;if(n.bTime&&!a.bTime)s-=1e3;var o={real_from:n,real_to:a,from:i,to:s,real_from_t:i,real_to_t:s};if(i<e.Tab.activeFirst&&s<=e.Tab.activeLast){o.from=e.Tab.activeFirst}else if(i>=e.Tab.activeFirst&&s>e.Tab.activeLast){o.to=e.Tab.activeLast}else if(i<e.Tab.activeFirst&&s>e.Tab.activeLast){o.from=e.Tab.activeFirst;o.to=e.Tab.activeLast}t.display=true;var r=t.DT_TO_TS+(t.DT_SKIP_TIME=="Y"?this.dayLength:3e5)<(new Date).getTime();t.bMuted=this.userSettings.showMuted&&r;if(e.Event.DT_SKIP_TIME=="Y")this.DisplayEvent_DT(o,t,e.Tab);else this.DisplayEventOnTimeline(o,t,e.Tab);if(!r)this.Event.Blink(t,true,true)};JCEC.prototype.DisplayEvent_DT=function(e,t,i){var s=this,n=false,a=this.ConvertDayIndex(new Date(e.from).getDay()),o=this.ConvertDayIndex(new Date(e.to).getDay()),r={oEvent:t,daysCount:o-a+1},l,h,d=this.Event.IsTask(t),u=this.Event.IsCrm(t),f="",p,v;for(p=0;p<i.daysCount;p++){v=i.arDays[p];if(v.day==a){l=v;h=v;n=true;v.Events.begining.push(r)}if(!n)continue;v.Events.all.push(r);v.EventsCount++;if(v.day==o){h=v;break}}if(l&&h){var C=bxInt(l.pWnd.offsetLeft)+2,D=bxInt(h.pWnd.offsetLeft)+bxInt(h.pWnd.offsetWidth),E=D-C-5,S=BX.create("DIV",{props:{className:"bxec-event"},style:{left:C.toString()+"px",width:E.toString()+"px",backgroundColor:t.displayColor,color:t.displayTextColor}}),y=S.appendChild(BX.create("TABLE")),b=y.insertRow(-1);t.oDaysT[i.id]=S;S.setAttribute("data-bx-event-ind",t.ind);if(t.bMuted)BX.addClass(S,"bxec-event-muted");if(e.real_from_t<e.from){c=b.insertCell(-1);c.innerHTML='<img class="bxec-iconkit" src="/bitrix/images/1.gif">';c.className="bxec-event-ar-l"}if(this.Event.IsMeeting(t))f='<i class="bxc-e-meeting"></i>';if(d)f='<i class="bxc-e-task"></i>';if(u&&!d)f='<i class="bxc-e-crm"></i>';var m=this.Event.GetQuestIcon(t),T=b.insertCell(-1);T.innerHTML='<div class="bxec-event-title">'+f+'<span class="bxec-event-label"'+this.Event.GetLabelStyle(t)+">"+m+BX.util.htmlspecialchars(t.NAME)+"</span></div>";this.Event.BuildActions({cont:T,oEvent:t,evCont:S});S.onmouseover=function(){s.HighlightEvent_DT(this)};S.onmouseout=function(){s.HighlightEvent_DT(this,true)};S.ondblclick=function(){s.Event.View(t)};this.dragDrop.RegisterEvent(S,t,"week_title");i.pEventHolder.appendChild(S)}};JCEC.prototype.DisplayEventOnTimeline=function(e,t,i){if(e.from==e.to){e.to+=60*1e3}var s=false,n=new Date(e.from),a=new Date(e.to),o=this.ConvertDayIndex(n.getDay()),r=this.ConvertDayIndex(a.getDay()),l=n.getHours()||0,h=n.getMinutes()||0,c=a.getHours(),d=a.getMinutes(),u,f,p,v;if(parseInt(t.DT_LENGTH)>0){if(!a){c=23;d=59}else if(e.from==e.to){if(d==59){c++;d=0}else{d++}}else{if(d==0&&c==0){if(r>o){r--;c=23;d=59}else{d=1}}else if(d==0&&c>0){c--;d=59}else if(d>1){d--}}}for(p=0;p<i.daysCount;p++){v=i.arDays[p];if(v.day==o){u=v;f=v;s=true}if(!s)continue;if(v.day==r){f=v;break}}if(u&&f){this._SetTimeEvent(u,l,h,{oEvent:t,bStart:true,arInit:e});this._SetTimeEvent(f,c,d,{oEvent:t,bStart:false,arInit:e})}};JCEC.prototype._SetTimeEvent=function(e,t,i,s){if(!e.TLine)e.TLine={};t=bxInt(t);i=bxInt(i);if(!e.TLine[t])e.TLine[t]={};if(!e.TLine[t][i])e.TLine[t][i]=[];e.TLine[t][i].push(s)};JCEC.prototype.HighlightEvent_DT=function(e,t){var i=t?BX.removeClass:BX.addClass;i(e,"bxec-event-over")};JCEC.prototype.RefreshEventsInDayT=function(e){var t=[],i=0,s=3,a,o,r,l,h,c,d,u,f;for(l=0;l<s;l++)t[l]=0;for(o=0;o<e.daysCount;o++){a=e.arDays[o];r=a.Events.begining;n=r.length;u=[];if(n>0){r.sort(function(e,t){return t.daysCount-e.daysCount});e:for(k=0;k<n;k++){h=r[k];if(!h)continue;if(!this.arEvents[h.oEvent.ind]){a.Events.begining=r=BX.util.deleteFromArray(r,k);h=r[k];if(!h)continue}for(l=0;l<s;l++){if(t[l]-i<=0){t[l]=i+h.daysCount;f=21+l*18;h.oEvent.oDaysT[e.id].style.top=(21+l*18).toString()+"px";continue e}}u[h.oEvent.ID]=true;a.Events.hidden.push(h)}}c=a.Events.all;for(var p=0,v=c.length;p<v;p++){h=c[p];if(!h||u[h.oEvent.ID])continue;if(!this.arEvents[h.oEvent.ind]){a.Events.all=c=BX.util.deleteFromArray(c,p);h=c[p];if(!h)continue}d=h.oEvent.oDaysT[e.id].style.display;if(d&&d.toLowerCase()=="none")a.Events.hidden.push(h)}this.ShowMoreEventsSelectWeek(a,e.id);i++}};JCEC.prototype.ShowMoreEventsSelectWeek=function(e,t){var i=this,s=e.Events.hidden,n=s.length,a=[],o=e.pMoreEvents.firstChild,r,l,h;if(n<=0){o.style.display="none";return}for(r=0;r<n;r++){l=s[r];h=l.oEvent.oDaysT[t];h.style.display="none";a.push({pDiv:h,oEvent:l.oEvent})}o.style.display="block";o.innerHTML=EC_MESS.MoreEvents+" ("+n+" "+EC_MESS.Item+")";o.onmousedown=function(e){if(!e)e=window.event;BX.PreventDefault(e)};o.onclick=function(){i.ShowMoreEventsWin({Events:a,id:"day_t_"+t+e.day,pDay:e.pWnd,mode:"day_t",pSelect:o})}};JCEC.prototype.ArrangeEventsInTL=function(e){try{var t=false,i,s,n,a,o,r=0,l,h,c,d,u,f,p={},v=0,C,D,E,S;for(D=0;D<e.daysCount;D++){C=e.arDays[D];h=[];if(v>0){if(!C.TLine)C.TLine={};for(o in p){if(p[o]&&typeof p[o]=="object"&&p[o].oEvent){if(!C.TLine["0"])C.TLine["0"]={};if(!C.TLine["0"]["0"])C.TLine["0"]["0"]=[];C.TLine["0"]["0"].push({oEvent:p[o].oEvent,bStart:true,dontClose:false,arInit:p[o].arInit})}}}if(!t&&!C.TLine)continue;f=true;if(C.TLine){for(i=0;i<=23;i++){if(!C.TLine[i]&&i!=23)continue;for(s=0;s<60;s++){E=C.TLine[i]&&C.TLine[i][s]?C.TLine[i][s]:false;if(i==23&&s==59){if(E===false)E=[];for(o in p){if(p[o]&&typeof p[o]=="object"&&p[o].oEvent){E.push({oEvent:p[o].oEvent,bStart:false,dontClose:true,arInit:p[o].arInit})}}}if(!E)continue;for(n=0;n<E.length;n++){S=E[n];if(S.bStart){p[S.oEvent.ID]=S;v++;if(f)h.push([]);c=h[h.length-1];u=false;f=false;if(c.length>1){for(M=0,I=c.length;M<I;M++){d=c[M];if(!d.bFilled){u=M;break}}}l={bFilled:true,evId:S.oEvent.ID,h_f:i,m_f:s};if(u!==false){l.arEvents=c[u].arEvents;c[u]=l}else{c.push(l)}}else{f=true;if(!S.dontClose){p[S.oEvent.ID]=false;v--}for(M=0;M<c.length;M++){d=c[M];if(d.bFilled&&d.evId==S.oEvent.ID){d.bFilled=false;a=this.BuildEventDiv_TL({Tab:e,dayInd:D,from:{h:d.h_f,m:d.m_f},to:{h:i,m:s},oEvent:S.oEvent,arInit:S.arInit,lastPart:!S.dontClose});if(!d.arEvents)d.arEvents=[a];else d.arEvents.push(a)}if(d.bFilled&&f)f=false}}}}}}var y=e.pTimelineTable.rows[0].cells[D+1],b,m,T,g,_,M,I,x,B,O=y.offsetWidth-15;for(m=0,T=h.length;m<T;m++){b=h[m];g=b.length;_=Math.round((O-g)/g);for(M=0;M<b.length;M++){d=b[M];if(M==0){x=_;r=bxInt(d.arEvents[0].style.left);I=false}else{r+=_+1;I=r;if(M==b.length-1)x=O-(_+1)*(b.length-1)-1;else x=_}for(n=0;n<d.arEvents.length;n++){B=d.arEvents[n];B.style.width=x+"px";B.style.minWidth=x+"px";if(I!==false)B.style.left=I+"px"}}}}}catch(n){}};JCEC.prototype.BuildEventDiv_TL=function(e){var t=this,i=e.oEvent,s=this.Event.IsTask(i),n=this.Event.IsCrm(i),a=e.from.m,o=e.to.m,r="",l=Math.floor((e.from.h+a/60)*2),h=Math.floor((e.to.h+o/60)*2),c=e.Tab.pTimelineTable.rows[l].cells[this.__ConvertCellIndex(l,e.dayInd+1,true)],d=e.Tab.pTimelineTable.rows[h].cells[this.__ConvertCellIndex(h,e.dayInd+1,true)],u=bxInt(c.offsetTop)+1,f=bxInt(d.offsetTop)-1,p=bxInt(c.offsetLeft)+2,v=BX.create("DIV",{props:{className:"bxec-tl-event"+(i.bMuted?" bxec-event-muted":"")},style:{left:p+"px",backgroundColor:i.displayColor,color:i.displayTextColor},events:{mouseover:function(s){t.HighlightEvent_TL(i,this,false,e.Tab.id,s||window.event)},mouseout:function(s){t.HighlightEvent_TL(i,this,true,e.Tab.id,s||window.event)},dblclick:function(){t.Event.View(i)}}
});v.setAttribute("data-bx-event-ind",i.ind);v.setAttribute("data-bx-original-width","");v.setAttribute("data-bx-original-height","");i._eventViewed=false;i._contentSpan=false;if(this.Event.IsMeeting(i))r='<i class="bxc-e-meeting"></i>';if(s)r='<i class="bxc-e-task"></i>';if(n&&!s)r='<i class="bxc-e-crm"></i>';var C=e.arInit.real_from,D=e.arInit.real_to,E=this.Event.GetQuestIcon(i),S=r+E+"<u "+this.Event.GetLabelStyle(i)+">"+BX.util.htmlspecialchars(i.NAME)+"</u><br />",y=this.FormatTimeByNum(C.hour,C.min),b=this.FormatTimeByNum(D.hour,D.min);if(a!=30&&a!=0)u+=Math.round((a>30?a-30:a)*40/60)-1;if(o!=30&&o!=0)f+=Math.round((o>30?o-30:o)*40/60)+2;var m=f-u;if(m<=17)m=17;v.style.top=u+"px";v.style.height=m+"px";if(C.year==D.year&&C.month==D.month&&C.date==D.date)S+=y+" &mdash; "+b;else S+=bxFormatDate(C.date,C.month,C.year)+" "+y+" &mdash; "+bxFormatDate(D.date,D.month,D.year)+" "+b;v.appendChild(BX.create("DIV",{children:[BX.create("SPAN",{props:{className:"bxec-cnt-sp"},html:S})]}));this.Event.BuildActions({cont:v,oEvent:i,evCont:v,bTimeline:true});if(e.lastPart){var T=v.appendChild(BX.create("DIV",{props:{className:"bxec-tl-event-resizer-cnt"}}));this.dragDrop.RegisterTimelineEventResizer(T,v,i,e.Tab.id)}e.Tab.pTimelineCont.appendChild(v);if(!i.oTLParts[e.Tab.id])i.oTLParts[e.Tab.id]=[];i.oTLParts[e.Tab.id].push(v);this.dragDrop.RegisterTimelineEvent(v,i,e.Tab.id);return v};JCEC.prototype.HighlightEvent_TL=function(e,t,i,s,n){var a=this;var o=t.getAttribute("data-bx-original-width");var r=t.getAttribute("data-bx-original-height");if(!i&&!e._eventViewed){if(this._highlightIntKeypWnd==t&&this._highlightInt)return;if(this._highlightInt)clearInterval(this._highlightInt);if(!o){o=parseInt(t.style.width);t.setAttribute("data-bx-original-width",o)}if(!r){r=parseInt(t.style.height);t.setAttribute("data-bx-original-height",r)}e._contentSpan=BX.findChild(t,{className:"bxec-cnt-sp"},true);var l=0,h=o,c=parseInt(e._contentSpan.offsetWidth)+20,d=r,u=parseInt(e._contentSpan.offsetHeight)+30;if(c<=60)c=60;if(u<=55)u=55;if(c-h>0||u-d>0){this._highlightIntKeypWnd=t;this._highlightInt=setInterval(function(){var i=c-h<=0,s=u-d<=0;if(i&&s){e._eventViewed=true;return clearInterval(a._highlightInt)}l+=12;if(!i){h+=l;if(h>c)h=c+2;t.style.width=h+"px"}if(!s){d+=l;if(d>u)d=u+2;t.style.height=d+"px"}},5)}}else{if(this.CheckMouseInCont(t,n,-2))return true;this._highlightIntKeypWnd=false;if(this._highlightInt)clearInterval(this._highlightInt);this._highlightInt=false;if(o){t.style.width=o+"px";e._eventViewed=false}if(r){t.style.height=r+"px";e._eventViewed=false}}if(i){BX.removeClass(t,"bxec-tl-ev-hlt");BX.removeClass(t,"bxec-tl-ev-hlt-s")}else{BX.addClass(t,"bxec-tl-ev-hlt")}if(e.oTLParts&&e.oTLParts[s]){var f=e.oTLParts[s],p=f.length,v,C,D;for(v=0;v<p;v++){if(f[v]==t)continue;if(i){BX.removeClass(f[v],"bxec-tl-ev-hlt");BX.removeClass(f[v],"bxec-tl-ev-hlt-s");C=f[v].getAttribute("data-bx-original-width");D=f[v].getAttribute("data-bx-original-height");if(C)f[v].style.width=C+"px";if(D)f[v].style.height=D+"px"}else{BX.addClass(f[v],"bxec-tl-ev-hlt-s")}}}};JCEC.prototype.ShowMoreEventsWin=function(e){var t=this;if(this.MoreEventsWin){this.MoreEventsWin.close();this.MoreEventsWin.destroy();this.MoreEventsWin=null;return}this.MoreEventsWin=BX.PopupWindowManager.create(this.id+"bxc-month-sel"+e.id,e.pSelect,{autoHide:true,closeByEsc:true,offsetTop:-1,offsetLeft:1,lightShadow:true,content:BX.create("DIV",{props:{id:"bxc-more-"+this.id+e.id,className:"bxec-more-event-popup"}})});BX.addCustomEvent(this.MoreEventsWin,"onPopupClose",function(){if(t.MoreEventsWin&&t.MoreEventsWin.destroy)t.MoreEventsWin.destroy()});var i=BX("bxc-more-"+this.id+e.id),s,n,a;BX.bind(i,"click",BX.proxy(this.EventClick,this));i.innerHTML="";for(a=0;a<e.Events.length;a++){n=e.Events[a].pDiv;s=n.cloneNode(true);BX.addClass(s,"bxec-event-static");s.onmouseover=n.onmouseover;s.onmouseout=n.onmouseout;s.ondblclick=n.ondblclick;i.appendChild(s);this.dragDrop.RegisterEvent(s,e.Events[a].oEvent,"month")}this.MoreEventsWin.show(true)};JCEC.prototype.GetUsableDateTime=function(e,t){var i=(t||10)*60*1e3;e=Math.ceil(e/i)*i;return new Date(e)};JCEC.prototype.CompareArrays=function(e,t){var s=true;if(e.length!==t.length){s=false}else{for(i=0;i<e.length;i++){if(e[i]!==t[i]){s=false;break}}}return s};
/* End */
;
; /* Start:"a:4:{s:4:"full";s:54:"/bitrix/js/calendar/cal-dialogs.min.js?151131647653075";s:6:"source";s:34:"/bitrix/js/calendar/cal-dialogs.js";s:3:"min";s:38:"/bitrix/js/calendar/cal-dialogs.min.js";s:3:"map";s:38:"/bitrix/js/calendar/cal-dialogs.map.js";}"*/
JCEC.prototype.ShowAddEventDialog=function(e){var t=this;if(this.bReadOnly)return;if(!this.CheckSectionsCount())return alert(EC_MESS.NoCalendarsAlert);var i=this.oAddEventDialog;var o=BX(this.id+"-bitrix24-limit");if(!i){i=new BX.PopupWindow("BXCAddEvent"+this.id,null,{overlay:{opacity:10},autoHide:true,closeByEsc:true,zIndex:0,offsetLeft:0,offsetTop:0,draggable:true,bindOnResize:false,titleBar:EC_MESS.NewEvent,closeIcon:{right:"12px",top:"10px"},className:"bxc-popup-window",buttons:o?[new BX.PopupWindowButton({text:EC_MESS.Close,events:{click:function(){t.CloseAddEventDialog(true)}}})]:[new BX.PopupWindowButton({text:EC_MESS.Edit,title:EC_MESS.GoExtTitle,events:{click:function(){t.OpenExFromSimple()}}}),new BX.PopupWindowButton({text:EC_MESS.Add,className:"popup-window-button-accept",events:{click:function(){var e=BX.date.convertBitrixFormat(i.CAL.selectTime?BX.message("FORMAT_DATETIME"):BX.message("FORMAT_DATE")),o=i.CAL.Params.from,n=i.CAL.Params.to,a={name:i.CAL.DOM.Name.value,desc:"",calendar:i.CAL.DOM.SectSelect.value,date_from:BX.date.format(e,o.getTime()/1e3),date_to:BX.date.format(e,n.getTime()/1e3),default_tz:i.CAL.DOM.DefTimezone.value,skip_time:i.CAL.selectTime?"N":"Y"};if(i.CAL.DOM.Accessibility)a.accessibility=i.CAL.DOM.Accessibility.value;t.Event.Save(a);if(!t.arConfig.userTimezoneName){t.arConfig.userTimezoneName=i.CAL.DOM.DefTimezone.value}t.CloseAddEventDialog(true)}}}),new BX.PopupWindowButtonLink({text:EC_MESS.Close,className:"popup-window-button-link-cancel",events:{click:function(){t.CloseAddEventDialog(true)}}})],content:BX("bxec_add_ed_"+this.id),events:{}});i.CAL={DOM:{Name:BX(this.id+"_add_ed_name"),PeriodText:BX(this.id+"_add_ed_per_text"),SectSelect:BX(this.id+"_add_ed_calend_sel"),Warn:BX(this.id+"_add_sect_sel_warn"),DefTimezone:BX("event-simple-tz-def"+this.id),DefTimezoneWrap:BX("event-simple-tz-def-wrap"+this.id)}};this.oAddEventDialog=i;if(!o){new BX.CHint({parent:BX("event-tz-simple-def-tip"+this.id),hint:EC_MESS.eventTzDefHint});if(this.bIntranet&&(this.Personal()||this.type!="user")){i.CAL.DOM.Accessibility=BX(this.id+"_add_ed_acc");if(i.CAL.DOM.Accessibility&&BX.browser.IsIE())i.CAL.DOM.Accessibility.style.width="250px"}i.CAL.DOM.SectSelect.onchange=function(){t.SaveLastSection(this.value);i.CAL.DOM.Warn.style.display=t.oActiveSections[i.CAL.DOM.SectSelect.value]?"none":"block"}}BX.addCustomEvent(i,"onPopupClose",BX.proxy(this.CloseAddEventDialog,this))}if(o){i.show();return}var n,a,s,l,r,c,d="",C="";i.CAL.DOM.Name.value="";this.BuildSectionSelect(i.CAL.DOM.SectSelect,this.GetLastSection());i.CAL.DOM.Warn.style.display=t.oActiveSections[i.CAL.DOM.SectSelect.value]?"none":"block";i.CAL.DOM.DefTimezoneWrap.style.display="none";i.CAL.selectTime=this.selectTimeMode&&(!this.selectDaysMode&&!this.selectDayTMode);if(this.selectDaysMode){var p=parseInt(this.selectDaysStartObj.id.substr(9)),u=parseInt(this.selectDaysEndObj.id.substr(9));if(p>u){l=u;u=p;p=l}n=this.activeDateDays[p];a=this.activeDateDays[u]}else if(this.selectTimeMode){s=this.curTimeSelection;n=new Date(s.sDay.year,s.sDay.month,s.sDay.date,s.sHour,s.sMin);a=new Date(s.eDay.year,s.eDay.month,s.eDay.date,s.eHour,s.eMin);if(n.getTime()>a.getTime()){l=n;n=a;a=l}if(this.arConfig.userTimezoneName){i.CAL.DOM.DefTimezoneWrap.style.display="none";i.CAL.DOM.DefTimezone.value=this.arConfig.userTimezoneName}else{i.CAL.DOM.DefTimezoneWrap.style.display="";i.CAL.DOM.DefTimezone.value=this.arConfig.userTimezoneDefault||""}}else if(this.selectDayTMode){r=this.curDayTSelection;n=new Date(r.sDay.year,r.sDay.month,r.sDay.date);a=new Date(r.eDay.year,r.eDay.month,r.eDay.date)}else return;var D=this.ConvertDayIndex(n.getDay()),E=this.ConvertDayIndex(a.getDay());if(n.getTime()==a.getTime()){c=this.days[D][0]+" "+bxFormatDate(n.getDate(),n.getMonth()+1,n.getFullYear())}else{var h=n.getDate(),f=n.getMonth()+1,v=n.getFullYear(),S=n.getHours(),A=n.getMinutes(),_=a.getDate(),L=a.getMonth()+1,g=a.getFullYear(),m=a.getHours(),M=a.getMinutes(),b=!(S==m&&S==0&&A==M&&A==0);if(b){d=this.FormatTimeByNum(S,A);C=this.FormatTimeByNum(m,M)}if(f==L&&v==g&&h==_&&b)c=this.days[D][0]+" "+bxFormatDate(h,f,v)+", "+d+" &mdash; "+C;else c=this.days[D][0]+" "+bxFormatDate(h,f,v)+" "+d+" &mdash; "+this.days[E][0]+" "+bxFormatDate(_,L,g)+" "+C}i.CAL.DOM.PeriodText.innerHTML=c;i.CAL.Params={from:n,to:a,time_f:d||"",time_t:C||""};setTimeout(function(){BX.focus(i.CAL.DOM.Name)},500);if(this.bIntranet&&(this.Personal()||this.type!="user"))i.CAL.DOM.Accessibility.value="busy";var B=this.GetAddDialogPosition();if(B){i.popupContainer.style.top=B.top+"px";i.popupContainer.style.left=B.left+"px"}i.show()};JCEC.prototype.OpenExFromSimple=function(e){this.CloseAddEventDialog(true);if(!e)return this.ShowEditEventPopup({bExFromSimple:true});var t=this.oAddEventDialog,i=this.oEditEventDialog.oController,o=t.CAL.Params.from,n=t.CAL.Params.to;i._FromDateValue=i.pFromDate.value=bxFormatDate(o.getDate(),o.getMonth()+1,o.getFullYear());i.pToDate.value=bxFormatDate(n.getDate(),n.getMonth()+1,n.getFullYear());var a=!!(t.CAL.Params.time_f||t.CAL.Params.time_t);i.pFullDay.checked=!a;if(a){i._FromTimeValue=i.pFromTime.value=t.CAL.Params.time_f;i.pToTime.value=t.CAL.Params.time_t||""}else{if(i.pFromDate.value==i.pToDate.value){var s=this.ParseDate(BX.util.trim(i.pFromDate.value)+" "+BX.util.trim(i.pFromTime.value),true);if(s){var l=new Date(s.getTime()+36e5);i.pToDate.value=this.FormatDate(l);i.pToTime.value=this.FormatTime(l)}}else{i.pToTime.value=i.pFromTime.value}}i.FullDay(false,a);if(!this.arConfig.userTimezoneName&&t.CAL.DOM.DefTimezone.value){i.pDefTimezone.value=t.CAL.DOM.DefTimezone.value}i.pName.value=t.CAL.DOM.Name.value;if(this.bIntranet&&i.pAccessibility&&t.CAL.DOM.Accessibility)i.pAccessibility.value=t.CAL.DOM.Accessibility.value;if(t.CAL.DOM.SectSelect.value){i.pSectSelect.value=t.CAL.DOM.SectSelect.value;if(i.pSectSelect.onchange)i.pSectSelect.onchange()}};JCEC.prototype.CloseAddEventDialog=function(e){if(!this.oAddEventDialog)return;switch(this.activeTabId){case"month":this.DeSelectDays();break;case"week":this.DeSelectTime(this.activeTabId);this.DeSelectDaysT();break;case"day":break}if(e===true)this.oAddEventDialog.close()};JCEC.prototype.GetAddDialogPosition=function(){if(this.activeTabId=="month"){var e=this.arSelectedDays[this.bInvertedDaysSelection?0:this.arSelectedDays.length-1];if(!e)return false;var t=BX.pos(e);t.top+=parseInt(this.dayCellHeight/2)+20;t.left+=parseInt(this.dayCellWidth/2)+20;t.right=t.left;t.bottom=t.top;t=BX.align(t,360,180);return t}else{return false}};JCEC.prototype.CreateEditEventPopup=function(e){var t=this,i=BX.create("DIV");var o=new BX.PopupWindow("BXCEditEvent"+this.id,null,{overlay:{opacity:10},autoHide:false,closeByEsc:true,zIndex:-100,offsetLeft:0,offsetTop:0,draggable:true,titleBar:EC_MESS.NewEvent,contentColor:"white",contentNoPaddings:true,closeIcon:{right:"12px",top:"10px"},className:"bxc-popup-tabed bxc-popup-window",buttons:[new BX.PopupWindowButton({text:EC_MESS.Delete,id:this.id+"ed-del-button",events:{click:function(){if(t.Event.Delete(o.CAL.oEvent))t.CloseEditEventDialog(true)}}}),new BX.PopupWindowButton({text:EC_MESS.Save,id:this.id+"ed-save-button",className:"popup-window-button-accept",events:{click:function(){t.oEditEventDialog.oController.SaveForm({callback:function(){t.CloseEditEventDialog(true)}})}}}),new BX.PopupWindowButtonLink({text:EC_MESS.Close,className:"popup-window-button-link-cancel",events:{click:function(){t.CloseEditEventDialog(true)}}})],content:i,events:{}});BX.addCustomEvent(o,"onPopupClose",BX.proxy(this.CloseEditEventDialog,this));o.CAL={DOM:{content:i,Title:o.titleBar.firstChild,DelBut:BX(this.id+"ed-del-button"),SaveBut:BX(this.id+"ed-save-button")}};BX.addClass(o.CAL.DOM.Title,"bxce-dialog-title");this.oEditEventDialog=o};JCEC.prototype.ShowEditEventPopup=function(e){if(!this.oEditEventDialog)this.CreateEditEventPopup();if(this.showDialogRequest||this.oEditEventDialog.bShowed)return;if(window.LHEPostForm&&window.LHEPostForm.unsetHandler&&LHEPostForm.getHandler(this.id+"_event_editor")){window.LHEPostForm.unsetHandler(this.id+"_event_editor")}if(!e)e={};var t=this,i,o=this.oEditEventDialog;o.bExFromSimple=!!e.bExFromSimple;o.CAL.oEvent=e.oEvent||{};i=o.CAL.oEvent&&o.CAL.oEvent.ID?o.CAL.oEvent.ID:0;if(i){o.CAL.DOM.DelBut.style.display="";o.CAL.DOM.Title.innerHTML=EC_MESS.EditEvent}else{o.CAL.DOM.DelBut.style.display="none";o.CAL.DOM.Title.innerHTML=EC_MESS.NewEvent}this.showDialogRequest=true;BX.ajax.get(this.actionUrl,this.GetReqData("get_edit_event_dialog",{event_id:i,js_id:this.id}),function(e){if(t.showDialogRequest){BX.removeClass(o.popupContainer.firstChild,"bxc-popup-window-loader");t.showDialogRequest=false;o.CAL.DOM.content.innerHTML=BX.util.trim(e)}});BX.addClass(o.popupContainer.firstChild,"bxc-popup-window-loader");o.CAL.DOM.content.innerHTML='<div class="bxec-popup" style="width: 750px; height: 300px;"><div class="bxce-popup-loader"><div class="bxce-loader-curtain"></div></div></div>';t.oEditEventDialog.show();var n=0;function a(){o.CAL.DOM.pTabs=BX(t.id+"_edit_tabs");n++;if(!o.CAL.DOM.pTabs){if(n<10)return setTimeout(a,100);else return}if(!o.CAL.DOM.pTabs){if(!BX(t.id+"-bitrix24-limit")){t.oEditEventDialog.close();t.Event.ReloadAll()}else{o.CAL.DOM.DelBut.style.display="none";o.CAL.DOM.SaveBut.style.display="none"}n=0;return}t.ChargePopupTabs(o,t.id+"ed-tab-");if(window.__ATTENDEES_ACC)o.CAL.oEvent["~ATTENDEES"]=window.__ATTENDEES_ACC;o.oController=new EditEventPopupController({form:document.forms.event_edit_form,oEC:t,oEvent:o.CAL.oEvent,id:t.id,editorContId:"bx_cal_editor_cont_"+t.id,LHEJsObjName:"pLHEEvDesc",LHEId:"LHEEvDesc",WDControllerCID:window.__UPLOAD_WEBDAV_ELEMENT_CID,arFiles:window.__UPLOAD_WEBDAV_ELEMENT_VALUE,Title:o.CAL.DOM.Title,userTimezoneName:t.arConfig.userTimezoneName,userTimezoneDefault:t.arConfig.userTimezoneDefault});if(window.editEventDestinationFormName){BxEditEventGridSetLinkName(window.editEventDestinationFormName);BX.bind(BX("event-grid-dest-input"),"keyup",BxEditEventGridSearch);BX.bind(BX("event-grid-dest-input"),"keydown",BxEditEventGridSearchBefore);BX.bind(BX("event-grid-dest-add-link"),"click",function(e){BX.SocNetLogDestination.openDialog(editEventDestinationFormName);BX.PreventDefault(e)});BX.bind(BX("event-grid-dest-cont"),"click",function(e){BX.SocNetLogDestination.openDialog(editEventDestinationFormName);BX.PreventDefault(e)})}BX.removeCustomEvent("onAjaxSuccessFinish",a);if(o.bExFromSimple)t.OpenExFromSimple(true)}BX.addCustomEvent("onAjaxSuccessFinish",a)};JCEC.prototype.CloseEditEventDialog=function(e){if(this.oEditEventDialog){if(e===true){if(this.oEditEventDialog.oController&&this.oEditEventDialog.oController.Location&&this.oEditEventDialog.oController.Location.oPopup)this.oEditEventDialog.oController.Location.oPopup.destroy();this.oEditEventDialog.close()}if(this.oEditEventDialog.oController)this.oEditEventDialog.oController.DestroyDestinationControls();this.showDialogRequest=false;this.OnResize()}};JCEC.prototype.CreateViewEventPopup=function(){var e=this,t=BX.create("DIV"),i=new BX.PopupWindow("BXCViewEvent"+this.id,null,{overlay:{opacity:10},autoHide:false,closeByEsc:true,zIndex:-100,offsetLeft:0,offsetTop:0,draggable:true,titleBar:EC_MESS.ViewingEvent,contentColor:"white",contentNoPaddings:true,closeIcon:{right:"12px",top:"10px"},className:"bxc-popup-tabed bxc-popup-window",buttons:[new BX.PopupWindowButton({text:EC_MESS.Delete,id:this.id+"_viewev_del_but",events:{click:function(){if(e.Event.Delete(i.CAL.oEvent))e.CloseViewDialog(true)}}}),new BX.PopupWindowButton({text:EC_MESS.Edit,id:this.id+"_viewev_edit_but",events:{click:function(){e.ShowEditEventPopup({oEvent:i.CAL.oEvent});e.CloseViewDialog(true)}}}),new BX.PopupWindowButton({text:EC_MESS.Close,className:"popup-window-button-accept",events:{click:function(){e.CloseViewDialog(true)}}})],content:t,events:{}});BX.addCustomEvent(i,"onPopupClose",BX.proxy(this.CloseViewDialog,this));i.CAL={DOM:{content:t,TITLE:i.titleBar.firstChild,delBut:BX(this.id+"_viewev_del_but"),editBut:BX(this.id+"_viewev_edit_but")}};BX.addClass(i.CAL.DOM.TITLE,"bxce-dialog-title");BX.bind(i.CAL.DOM.content,"click",function(t){var o=t.target||t.srcElement;if(o&&o.parentNode){var n=o.getAttribute("data-bx-more-users");if(!!n){var a=BX(n);if(a)BX.addClass(a,"bx-cal-view-att-cont-full");return}var s=o.getAttribute("data-bx-set-status")||o.parentNode.getAttribute("data-bx-set-status");if(!!s){if(e.Event.SetMeetingStatus(s=="Y")){i.close()}return BX.PreventDefault(t||window.event)}}});this.oViewEventDialog=i};JCEC.prototype.ShowViewEventPopup=function(e){if(!this.oViewEventDialog)this.CreateViewEventPopup();var t=this,i=this.oViewEventDialog,o=e.ID;BX.addCustomEvent("OnUCFeedChanged",BX.proxy(function(){this.AdjustOverlay(this.oViewEventDialog)},this));if(i.adjustInterval)clearInterval(i.adjustInterval);i.adjustInterval=setInterval(function(){t.AdjustOverlay(i,false)},1e3);i.CAL.DOM.delBut.style.display="none";i.CAL.DOM.editBut.style.display="none";BX.addClass(i.popupContainer.firstChild,"bxc-popup-window-loader");i.CAL.DOM.content.innerHTML='<div class="bxec-popup" style="width: 700px; height: 200px;"><div class="bxce-popup-loader"><div class="bxce-loader-curtain"></div></div></div>';t.oViewEventDialog.show();var n=0,a=0;i.CAL.oEvent=e;BX.ajax.get(this.actionUrl,this.GetReqData("get_view_event_dialog",{event_id:o,js_id:this.id,section_name:this.oSections[e.SECT_ID]?this.oSections[e.SECT_ID].NAME:"",date_from:e.DATE_FROM,date_from_offset:e.TZ_OFFSET_FROM}),s);function s(a){i.CAL.DOM.content.innerHTML=a;i.CAL.DOM.pTabs=BX(t.id+"_viewev_tabs");n++;if(!i.CAL.DOM.pTabs&&n<10)return setTimeout(function(){s(a)},100);if(!i.CAL.DOM.pTabs){if(!BX(t.id+"-bitrix24-limit")){t.oViewEventDialog.close();t.Event.ReloadAll()}n=0;return}t.ChargePopupTabs(i,t.id+"view-tab-");BX.removeClass(i.popupContainer.firstChild,"bxc-popup-window-loader");i.CAL.DOM.TITLE.innerHTML=EC_MESS.ViewingEvent+": "+BX.util.htmlspecialchars(e.NAME);if(e.PRIVATE_EVENT&&!t.Personal()){i.CAL.DOM.delBut.style.display="none";i.CAL.DOM.editBut.style.display="none"}else if(t.bIntranet&&t.Event.IsHost(e)&&t.Event.CanDo(e,"edit")){i.CAL.DOM.delBut.style.display="";i.CAL.DOM.editBut.style.display=""}else if(t.bIntranet&&t.Event.IsAttendee(e)){i.CAL.DOM.delBut.style.display="none";i.CAL.DOM.editBut.style.display="none"}else{if(t.Event.CanDo(e,"edit")){i.CAL.DOM.delBut.style.display="";i.CAL.DOM.editBut.style.display=""}else{i.CAL.DOM.delBut.style.display="none";i.CAL.DOM.editBut.style.display="none"}}i.CAL.DOM.pViewTzHint=BX("bxec-view-tz-hint"+t.id);if(i.CAL.DOM.pViewTzHint){new BX.CHint({parent:i.CAL.DOM.pViewTzHint,hint:i.CAL.DOM.pViewTzHint.getAttribute("data-bx-hint")})}BX.viewElementBind("bx-cal-view-files-"+t.id+o,{showTitle:true},function(e){return BX.type.isElementNode(e)&&(e.getAttribute("data-bx-viewer")||e.getAttribute("data-bx-image"))});i.CAL.DOM.commentWrap=BX(t.id+"comments-cont");l(i.CAL.DOM.commentWrap.querySelector(".feed-com-avatar img"))}function l(e){a++;if(e){var o=parseInt(BX.style(e,"width"));if(o>90&&a<20){return setTimeout(function(){l(e)},100)}}t.comAni=new BX.easing({duration:200,start:{opacity:0},finish:{opacity:100},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(e){i.CAL.DOM.commentWrap.style.opacity=e.opacity/100},complete:BX.proxy(function(){i.CAL.DOM.commentWrap.style.opacity=null;t.comAni=null},this)});t.comAni.animate()}};JCEC.prototype.AdjustOverlay=function(e,t){if(t===false){if(e&&e.overlay&&e.resizeOverlay){e.resizeOverlay()}}else{setTimeout(function(){if(e&&e.overlay&&e.resizeOverlay)e.resizeOverlay()},200)}};JCEC.prototype.CloseViewDialog=function(e){BX.removeCustomEvent("OnUCFeedChanged",BX.proxy(function(){this.AdjustOverlay(this.oViewEventDialog)},this));if(this.oViewEventDialog.adjustInterval)this.oViewEventDialog.adjustInterval=clearInterval(this.oViewEventDialog.adjustInterval);if(e===true)this.oViewEventDialog.close();this.OnResize()};JCEC.prototype.CreateSectDialog=function(){var e=this;var t=new BX.PopupWindow("BXCSection"+this.id,null,{overlay:{opacity:10},autoHide:false,closeByEsc:true,zIndex:-100,offsetLeft:0,offsetTop:0,draggable:true,titleBar:EC_MESS.NewCalenTitle,closeIcon:{right:"12px",top:"10px"},className:"bxc-popup-tabed bxc-popup-window",contentColor:"white",contentNoPaddings:true,buttons:[new BX.PopupWindowButton({text:EC_MESS.googleHide,id:this.id+"_bxec_cal_hide_but",events:{click:function(){e.HideCalDavSection(t.CAL.oSect);e.Event.ReloadAll();e.CloseSectDialog(true)}}}),new BX.PopupWindowButton({text:EC_MESS.DelSect,id:this.id+"_bxec_cal_del_but",events:{click:function(){if(e.DeleteSection(t.CAL.oSect))e.CloseSectDialog(true)}}}),new BX.PopupWindowButton({text:EC_MESS.Save,className:"popup-window-button-accept",events:{click:function(){if(e.SaveSection()){e.CloseSectDialog(true)}}}}),new BX.PopupWindowButtonLink({text:EC_MESS.Close,className:"popup-window-button-link-cancel",events:{click:function(){e.CloseSectDialog(true)}}})],content:BX("bxec_sect_d_"+this.id),events:{}});BX.addCustomEvent(t,"onPopupClose",BX.proxy(this.CloseSectDialog,this));t.CAL={DOM:{Title:t.titleBar.firstChild,pTabs:BX(this.id+"_editsect_tabs"),Name:BX(this.id+"_edcal_name"),Desc:BX(this.id+"_edcal_desc"),ExpAllow:BX(this.id+"_bxec_cal_exp_allow"),delBut:BX(this.id+"_bxec_cal_del_but"),hideBut:BX(this.id+"_bxec_cal_hide_but")}};BX.addClass(t.CAL.DOM.Title,"bxce-dialog-title");t.CAL.Access=new ECCalendarAccess({bind:"calendar_section",GetAccessName:BX.proxy(this.GetAccessName,this),pCont:BX(this.id+"access-values-cont"),pLink:BX(this.id+"access-link")});t.CAL.ColorControl=this.InitColorDialogControl("sect",function(e,i){t.CAL.Color=e;t.CAL.TextColor=i});if(this.arConfig.bExchange&&this.Personal())t.CAL.DOM.Exch=BX(this.id+"_bxec_cal_exch");this.ChargePopupTabs(t,this.id+"sect-tab-");this.oSectDialog=t;if(this.bSuperpose&&this.Personal()){t.CAL.DOM.add2SPCont=BX(this.id+"_bxec_cal_add2sp_cont");t.CAL.DOM.add2SP=BX(this.id+"_bxec_cal_add2sp")}t.CAL.DOM.ExpAllow.onclick=function(){e._AllowCalendarExportHandler(this.checked)}};JCEC.prototype.ShowSectionDialog=function(e){if(!this.oSectDialog)this.CreateSectDialog();var t=this.oSectDialog;t.show();this.SetPopupTab(0,t);if(!e){e={PERM:{access:true,add:true,edit:true,edit_section:true,view_full:true,view_time:true,view_title:true}};t.CAL.bNew=true;t.CAL.DOM.Title.innerHTML=EC_MESS.NewCalenTitle;t.CAL.DOM.delBut.style.display="none";t.CAL.DOM.hideBut.style.display="none";e.COLOR=this.GetFreeDialogColor();t.CAL.DOM.ExpAllow.checked=true;this._AllowCalendarExportHandler(true);if(t.CAL.DOM.ExpSet)t.CAL.DOM.ExpSet.value="all";if(this.bSuperpose&&this.Personal()){t.CAL.DOM.add2SP.checked=true;t.CAL.DOM.add2SPCont.style.display=BX.browser.IsIE()?"inline":"table-row"}if(this.arConfig.bExchange&&this.Personal()){t.CAL.DOM.Exch.disabled=false;t.CAL.DOM.Exch.checked=true}e.ACCESS=this.new_section_access}else{if(this.arConfig.bExchange&&this.Personal()){t.CAL.DOM.Exch.checked=!!e.IS_EXCHANGE;t.CAL.DOM.Exch.disabled=true}t.CAL.bNew=false;t.CAL.DOM.Title.innerHTML=EC_MESS.EditCalenTitle;t.CAL.DOM.delBut.style.display="";t.CAL.DOM.hideBut.style.display="none";if(e.CAL_DAV_CAL&&e.CAL_DAV_CON){t.CAL.DOM.delBut.style.display="none";t.CAL.DOM.hideBut.style.display=""}if(!e.COLOR)e.COLOR=this.arConfig.arCalColors[0];t.CAL.DOM.ExpAllow.checked=e.EXPORT||false;this._AllowCalendarExportHandler(e.EXPORT);if(e.EXPORT)t.CAL.DOM.ExpSet.value=e.EXPORT_SET||"all";if(this.bSuperpose&&this.Personal())t.CAL.DOM.add2SPCont.style.display="none"}t.CAL.ColorControl.Set(e.COLOR,e.TEXT_COLOR);this.ShowPopupTab(t.CAL.Tabs[1],e.PERM.access);if(e.PERM.access){if(this.type=="user"&&this.Personal()&&e.ACCESS["U"+this.ownerId])delete e.ACCESS["U"+this.ownerId];else if(this.type=="group"&&e.ACCESS["SG"+this.ownerId+"_A"])delete e.ACCESS["SG"+this.ownerId+"_A"];t.CAL.Access.SetSelected(e.ACCESS)}t.CAL.oSect=e;this.bEditCalDialogOver=false;t.CAL.DOM.Name.value=e.NAME||"";t.CAL.DOM.Desc.value=e.DESCRIPTION||"";BX.focus(t.CAL.DOM.Name)};JCEC.prototype.CloseSectDialog=function(e){if(e===true)this.oSectDialog.close()};JCEC.prototype._AllowCalendarExportHandler=function(e){if(!this.oSectDialog.CAL.DOM.ExpDiv)this.oSectDialog.CAL.DOM.ExpDiv=BX(this.id+"_bxec_calen_exp_div");if(!this.oSectDialog.CAL.DOM.ExpSet&&e)this.oSectDialog.CAL.DOM.ExpSet=BX(this.id+"_bxec_calen_exp_set");this.oSectDialog.CAL.DOM.ExpDiv.style.display=e?"block":"none"};JCEC.prototype.CreateExportDialog=function(){var e=this;var t=new BX.PopupWindow("BXCExportDialog"+this.id,null,{overlay:{opacity:10},autoHide:false,closeByEsc:true,zIndex:-100,offsetLeft:0,offsetTop:0,draggable:true,titleBar:" ",closeIcon:{right:"12px",top:"10px"},className:"bxc-popup-window",buttons:[new BX.PopupWindowButton({text:EC_MESS.Close,className:"popup-window-button-accept",events:{click:function(){e.CloseExportDialog(true)}}})],content:BX("bxec_excal_"+this.id)});BX.addCustomEvent(t,"onPopupClose",BX.proxy(this.CloseExportDialog,this));t.CAL={DOM:{Title:t.titleBar.firstChild,Link:BX(this.id+"_excal_link"),NoticeLink:BX(this.id+"_excal_link_outlook"),Text:BX(this.id+"_excal_text"),Warn:BX(this.id+"_excal_warning")}};t.CAL.DOM.NoticeLink.onclick=function(){this.parentNode.className=""};this.oExportDialog=t};JCEC.prototype.ShowExportDialog=function(e){if(e&&e.EXPORT&&!e.EXPORT.ALLOW)return;if(!this.oExportDialog)this.CreateExportDialog();var t=this.oExportDialog;t.show();t.CAL.DOM.NoticeLink.parentNode.className="bxec-excal-notice-hide";t.CAL.DOM.Warn.className="bxec-export-warning-hidden";var i=this.path;i+=i.indexOf("?")>=0?"&":"?";if(e){t.CAL.DOM.Title.innerHTML=EC_MESS.ExpDialTitle;t.CAL.DOM.Text.innerHTML=EC_MESS.ExpText;i+="action=export"+e.EXPORT.LINK}var o="webcal"+i.substr(i.indexOf("://"));t.CAL.DOM.Link.onclick=function(e){window.location.href=o;BX.PreventDefault(e)};t.CAL.DOM.Link.href=i;t.CAL.DOM.Link.innerHTML=i;BX.ajax.get(i+"&check=Y","",function(e){setTimeout(function(){BX.closeWait(t.CAL.DOM.Title);if(!e||e.length<=0||e.toUpperCase().indexOf("BEGIN:VCALENDAR")==-1)t.CAL.DOM.Warn.className="bxec-export-warning"},300)})};JCEC.prototype.CloseExportDialog=function(e){if(e===true)this.oExportDialog.close()};JCEC.prototype.CreateSuperposeDialog=function(){var e=this;var t=new BX.PopupWindow("BXCSuperpose"+this.id,null,{overlay:{opacity:10},autoHide:false,closeByEsc:true,zIndex:-100,offsetLeft:0,offsetTop:0,draggable:true,titleBar:EC_MESS.SPCalendars,closeIcon:{right:"12px",top:"10px"},className:"bxc-popup-window",buttons:[new BX.PopupWindowButton({text:EC_MESS.Save,className:"popup-window-button-accept",events:{click:function(){e.SPD_SaveSuperposed();e.CloseSuperposeDialog(true)}}}),new BX.PopupWindowButtonLink({text:EC_MESS.Close,className:"popup-window-button-link-cancel",events:{click:function(){e.CloseSuperposeDialog(true)}}})],content:BX("bxec_superpose_"+this.id),events:{}});BX.addCustomEvent(t,"onPopupClose",BX.proxy(this.CloseSuperposeDialog,this));t.CAL={DOM:{UserCntInner:BX("bxec_sp_type_user_cont_"+this.id),GroupCnt:BX("bxec_sp_type_group_"+this.id),GroupCntInner:BX("bxec_sp_type_group_cont_"+this.id),CommonCnt:BX("bxec_sp_type_common_"+this.id),DelAllUsersLink:BX("bxec_sp_dell_all_sp_"+this.id),UserSearchCont:BX(this.id+"_sp_user_search_input_cont"),NotFoundNotice:BX(this.id+"_sp_user_nf_notice"),arCat:{}},arSect:{},arGroups:{},arCals:{},curTrackedUsers:{}};BX.addCustomEvent(window,"onUserSelectorOnChange",function(e){t.CAL.curTrackedUsers=e});t.CAL.DOM.AddUsersLinkCont=BX(this.id+"_user_control_link_sp");t.CAL.DOM.AddUsersLinkCont.onclick=function(i){if(BX.PopupMenu&&BX.PopupMenu.currentItem)BX.PopupMenu.currentItem.popupWindow.close();if(!i)i=window.event;if(!t.CAL.DOM.SelectUserPopup){t.CAL.DOM.SelectUserPopup=BX.PopupWindowManager.create("bxc-user-popup-sp",t.CAL.DOM.AddUsersLinkCont,{offsetTop:1,autoHide:true,closeByEsc:true,content:BX("BXCalUserSelectSP_selector_content"),className:"bxc-popup-user-select",buttons:[new BX.PopupWindowButton({text:EC_MESS.Add,events:{click:function(){t.CAL.DOM.SelectUserPopup.close();var i=[],o;for(o in t.CAL.curTrackedUsers)if(t.CAL.curTrackedUsers[o]&&o>0&&parseInt(o)==o)i.push(o);e.Request({postData:e.GetReqData("spcal_user_cals",{users:i}),errorText:EC_MESS.CalenSaveErr,handler:function(i){if(i){if(i.sections){if(!e.arSPSections)e.arSPSections=[];e.SPD_BuildSections(e.arSPSections.concat(i.sections),true);for(var o=0;o<e.arSections.length;o++){if(e.arSections[o].ID&&t.CAL.arSect[e.arSections[o].ID])t.CAL.arSect[e.arSections[o].ID].pCh.checked=!!e.arSections[o].SUPERPOSED}}else{e.oSupDialog.CAL.DOM.NotFoundNotice.style.visibility="visible";setTimeout(function(){e.oSupDialog.CAL.DOM.NotFoundNotice.style.visibility="hidden"},4e3)}return true}return false}})}}}),new BX.PopupWindowButtonLink({text:EC_MESS.Close,className:"popup-window-button-link-cancel",events:{click:function(){t.CAL.DOM.SelectUserPopup.close()}}})]})}t.CAL.curTrackedUsers={};t.CAL.DOM.SelectUserPopup.show();BX.PreventDefault(i)};this.oSupDialog=t};JCEC.prototype.SPD_BuildSections=function(e,t){var i=this,o=this.oSupDialog,n,a,s,l,r,c,d,C,p,u;BX.cleanNode(o.CAL.DOM.UserCntInner);BX.cleanNode(o.CAL.DOM.GroupCntInner);BX.cleanNode(o.CAL.DOM.CommonCnt);if(!this.arSPSections)this.arSPSections=[];for(l in e){r=e[l];if(!r.ID)return;if(r.CAL_TYPE=="user"){c=o.CAL.DOM.UserCntInner}else if(r.CAL_TYPE=="group"){c=o.CAL.DOM.GroupCntInner;o.CAL.DOM.GroupCnt.style.display="block"}else{c=o.CAL.DOM.CommonCnt;o.CAL.DOM.CommonCnt.style.display="block"}C=r.CAL_TYPE+r.OWNER_ID;if(!o.CAL.DOM.arCat[C]||!BX.isNodeInDom(o.CAL.DOM.arCat[C].pCat)){if(r.CAL_TYPE=="user"||r.CAL_TYPE=="group")p=r.OWNER_NAME;else p=r.TYPE_NAME;n=c.appendChild(BX.create("DIV",{props:{className:"bxc-spd-cat"}}));a=n.appendChild(BX.create("DIV",{props:{className:"bxc-spd-cat-title"},html:'<span class="bxc-spd-cat-plus"></span><span class="bxc-spd-cat-title-inner">'+BX.util.htmlspecialchars(p)+"</span>"}));pCatSections=n.appendChild(BX.create("DIV",{props:{className:"bxc-spd-cat-sections"}}));a.onclick=function(){BX.toggleClass(this.parentNode,"bxc-spd-cat-collapsed")};if(r.CAL_TYPE=="user"&&r.OWNER_ID!=this.userId){a.appendChild(BX.create("A",{props:{href:"javascript:void(0);",className:"bxc-spd-del-cat",title:EC_MESS.DeleteDynSPGroupTitle},text:EC_MESS.DeleteDynSPGroup,events:{click:function(e){i.SPD_DelTrackingUser(this.getAttribute("bx-data"),this);return BX.PreventDefault(e)}}})).setAttribute("bx-data",r.OWNER_ID)}o.CAL.DOM.arCat[C]={pCat:n,pTitle:a,pSections:pCatSections}}u=this.id+"spd-sect"+r.ID;d=BX.create("DIV",{props:{className:"bxc-spd-sect-cont"}});s=d.appendChild(BX.create("SPAN",{props:{className:"bxc-spd-sect-check"}})).appendChild(BX.create("INPUT",{props:{type:"checkbox",id:u}}));pLabel=d.appendChild(BX.create("SPAN",{props:{className:"bxc-spd-sect-label"},html:'<label for="'+u+'"><span>'+BX.util.htmlspecialchars(r.NAME)+"</span></label>"}));o.CAL.DOM.arCat[C].pSections.appendChild(d);o.CAL.arSect[r.ID]={pCh:s,pItem:d,oSect:r};if(t){var D=false;for(l in this.arSPSections){if(this.arSPSections.hasOwnProperty(l)){if(this.arSPSections[l].CAL_TYPE==r.CAL_TYPE&&this.arSPSections[l].OWNER_ID==r.OWNER_ID){D=true;break}}}if(!D)this.arSPSections.push(r)}}};JCEC.prototype.SPD_SaveSuperposed=function(){var e,t;for(e in this.oSupDialog.CAL.arSect){t=this.oSupDialog.CAL.arSect[e];if(t.pCh.checked){if(this.arSectionsInd[e]&&this.arSections[this.arSectionsInd[e]]){this.arSections[this.arSectionsInd[e]].SUPERPOSED=true}else if(!this.arSectionsInd[e]){t.oSect.SUPERPOSED=true;this.arSections.push(t.oSect);this.arSectionsInd[t.oSect.ID]=this.arSections.length-1}}else{if(this.arSectionsInd[e]&&this.arSections[this.arSectionsInd[e]]){this.arSections[this.arSectionsInd[e]].SUPERPOSED=false}}}this.SetSuperposed()};JCEC.prototype.SPD_DelTrackingUser=function(e,t){var i=BX.findParent(t,{className:"bxc-spd-cat"});if(i)i.parentNode.removeChild(i);var o,n;for(o in this.oSupDialog.CAL.arSect){if(this.oSupDialog.CAL.arSect.hasOwnProperty(o)){n=this.oSupDialog.CAL.arSect[o];if(n&&n.oSect&&n.oSect.CAL_TYPE=="user"&&n.oSect.OWNER_ID==e)n.pCh.checked=false}}var a=[];for(o in this.arSPSections){if(this.arSPSections.hasOwnProperty(o)){n=this.arSPSections[o];if(n.CAL_TYPE!="user"||n.OWNER_ID!=e)a.push(n)}}this.arSPSections=a;this.SPD_SaveSuperposed();this.Request({postData:this.GetReqData("spcal_del_user",{userId:parseInt(e)}),handler:function(e){if(e)return true}})};JCEC.prototype.ShowSuperposeDialog=function(){var e=this;if(!this.arSPSections){return this.Request({getData:e.GetReqData("get_superposed"),handler:function(t){if(t){e.arSPSections=t.sections||[];return e.ShowSuperposeDialog()}return false}})}if(!this.oSupDialog)this.CreateSuperposeDialog();if(this.arSPSections)this.SPD_BuildSections(this.arSPSections,false);var t=this.oSupDialog;t.show();for(var i=0;i<this.arSections.length;i++){if(this.arSections[i].ID&&t.CAL.arSect[this.arSections[i].ID])t.CAL.arSect[this.arSections[i].ID].pCh.checked=!!this.arSections[i].SUPERPOSED}};JCEC.prototype.CloseSuperposeDialog=function(e){this.arSPSections=null;if(e===true)this.oSupDialog.close()};JCEC.prototype.BuildSectionSelect=function(e,t){e.options.length=0;var i,o,n,a;e.parentNode.className="bxec-cal-sel-cel";for(i=0;i<this.arSections.length;i++){n=this.arSections[i];if(n.PERM.edit_section&&this.IsCurrentViewSect(n)&&n.ACTIVE!=="N"){a=t==n.ID;o=new Option(n.NAME,n.ID,a,a);e.options.add(o);if(!BX.browser.IsIE())o.style.backgroundColor=n.COLOR}}if(e.options.length<=0)e.parentNode.className="bxec-cal-sel-cel-empty"};JCEC.prototype.IsCurrentViewSect=function(e){return e.CAL_TYPE==this.type&&e.OWNER_ID==this.ownerId};JCEC.prototype.CreateSetDialog=function(){var e=this;var t=new BX.PopupWindow("BXCSettings"+this.id,null,{overlay:{opacity:10},autoHide:false,closeByEsc:true,zIndex:-100,offsetLeft:0,offsetTop:0,draggable:true,titleBar:this.PERM.access?EC_MESS.Settings:EC_MESS.UserSettings,closeIcon:{right:"12px",top:"10px"},className:"bxc-popup-tabed bxc-popup-window",contentColor:"white",contentNoPaddings:true,buttons:[new BX.PopupWindowButton({text:EC_MESS.Save,className:"popup-window-button-accept",events:{click:function(){e.CloseSetDialog(true);e.SaveSettings()}}}),new BX.PopupWindowButtonLink({text:EC_MESS.Close,className:"popup-window-button-link-cancel",events:{click:function(){e.CloseSetDialog(true)}}})],content:BX("bxec_uset_"+this.id)});BX.addCustomEvent(t,"onPopupClose",BX.proxy(this.CloseSetDialog,this));t.CAL={inPersonal:this.type=="user"&&this.ownerId==this.userId,DOM:{pTabs:BX(this.id+"_set_tabs"),ShowMuted:BX(this.id+"_show_muted"),denyBusyInvitation:BX(this.id+"_deny_busy_invitation")}};if(t.CAL.inPersonal){t.CAL.DOM.SectSelect=BX(this.id+"_set_sect_sel");t.CAL.DOM.Blink=BX(this.id+"_uset_blink");t.CAL.DOM.ShowDeclined=BX(this.id+"_show_declined");t.CAL.DOM.TimezoneSelect=BX(this.id+"_set_tz_sel")}if(this.PERM.access){t.CAL.Access=new ECCalendarAccess({bind:"calendar_type",GetAccessName:BX.proxy(this.GetAccessName,this),pCont:BX(this.id+"type-access-values-cont"),pLink:BX(this.id+"type-access-link")});t.CAL.DOM.WorkTimeStart=BX(this.id+"work_time_start");t.CAL.DOM.WorkTimeEnd=BX(this.id+"work_time_end");t.CAL.DOM.WeekHolidays=BX(this.id+"week_holidays");t.CAL.DOM.YearHolidays=BX(this.id+"year_holidays");t.CAL.DOM.YearWorkdays=BX(this.id+"year_workdays");t.CAL.DOM.WeekStart=BX(this.id+"week_start")}if(this.bSuperpose){t.CAL.DOM.ManageSuperpose=BX(this.id+"-set-manage-sp");t.CAL.DOM.ManageSuperpose.onclick=function(){e.ShowSuperposeDialog()}}t.CAL.DOM.ManageCalDav=BX(this.id+"_manage_caldav");if(t.CAL.DOM.ManageCalDav)t.CAL.DOM.ManageCalDav.onclick=function(){e.ShowExternalDialog()};t.CAL.DOM.UsetClearAll=BX(this.id+"_uset_clear");if(t.CAL.DOM.UsetClearAll)t.CAL.DOM.UsetClearAll.onclick=function(){if(confirm(EC_MESS.ClearUserSetConf)){e.CloseSetDialog(true);e.ClearPersonalSettings()}};this.ChargePopupTabs(t,this.id+"set-tab-");if(!this.PERM.access&&t.CAL.DOM.pTabs)t.CAL.DOM.pTabs.style.display="none";this.oSetDialog=t};JCEC.prototype.ShowSetDialog=function(e){
if(!this.oSetDialog)this.CreateSetDialog();var t=this.oSetDialog;t.show();if(!e||typeof e!="object")e={};this.SetPopupTab(e.tabId||0,t);if(t.CAL.inPersonal){t.CAL.DOM.SectSelect.options.length=0;var i,o,n,a=!this.userSettings.meetSection;t.CAL.DOM.SectSelect.options.add(new Option(" - "+EC_MESS.FirstInList+" - ",0,a,a));for(i=0;i<this.arSections.length;i++){n=this.arSections[i];if(n.CAL_TYPE=="user"&&n.OWNER_ID==this.userId&&n.ACTIVE!=="N"){a=this.userSettings.meetSection==n.ID;o=new Option(n.NAME,n.ID,a,a);o.style.backgroundColor=n.COLOR;t.CAL.DOM.SectSelect.options.add(o)}}t.CAL.DOM.Blink.checked=!!this.userSettings.blink;t.CAL.DOM.ShowDeclined.checked=!!this.userSettings.showDeclined}if(t.CAL.DOM.TimezoneSelect){t.CAL.DOM.TimezoneSelect.value=this.arConfig.userTimezoneName||""}t.CAL.DOM.ShowMuted.checked=!!this.userSettings.showMuted;if(t.CAL.DOM.denyBusyInvitation)t.CAL.DOM.denyBusyInvitation.checked=!!this.userSettings.denyBusyInvitation;if(this.PERM.access){t.CAL.Access.SetSelected(this.typeAccess);t.CAL.DOM.WorkTimeStart.value=this.settings.work_time_start;t.CAL.DOM.WorkTimeEnd.value=this.settings.work_time_end;for(i=0;i<t.CAL.DOM.WeekHolidays.options.length;i++){t.CAL.DOM.WeekHolidays.options[i].selected=BX.util.in_array(t.CAL.DOM.WeekHolidays.options[i].value,this.settings.week_holidays)}t.CAL.DOM.YearHolidays.value=this.settings.year_holidays;t.CAL.DOM.YearWorkdays.value=this.settings.year_workdays;t.CAL.DOM.WeekStart.value=this.settings.week_start}};JCEC.prototype.CloseSetDialog=function(e){if(e===true)this.oSetDialog.close()};JCEC.prototype.CreateExternalDialog=function(){var e=this;var t=new BX.PopupWindow("BXCExternalDialog"+this.id,null,{overlay:{opacity:10},autoHide:false,closeByEsc:true,zIndex:-95,offsetLeft:0,offsetTop:0,draggable:true,titleBar:EC_MESS.CalDavDialogTitle,closeIcon:{right:"12px",top:"10px"},className:"bxc-popup-window bxc-popup-window-white",contentColor:"white",contentNoPaddings:true,buttons:[new BX.PopupWindowButton({text:EC_MESS.AddCalDav,events:{click:function(){var i=t.CAL.arConnections.length;t.CAL.arConnections.push({bNew:true,name:EC_MESS.NewExCalendar,link:"",user_name:""});e.ExternalCalDialogDisplayConnection(t.CAL.arConnections[i],i);e.ExternalCalDialogEditConnection(i)}}}),new BX.PopupWindowButton({text:EC_MESS.Save,className:"popup-window-button-accept",events:{click:function(){if(t.CAL.bLockClosing)return alert(EC_MESS.CalDavConWait);if(t.CAL.curEditedConInd!==false&&t.CAL.arConnections[t.CAL.curEditedConInd])e.ExternalCalDialogSaveConnectionData(t.CAL.curEditedConInd);e.arConnections=t.CAL.arConnections;t.CAL.bLockClosing=true;e.SaveCalDavConnections(function(i){t.CAL.bLockClosing=false;if(i){e.CloseExternalDialog(true);window.location=window.location}},function(){t.CAL.bLockClosing=false})}}}),new BX.PopupWindowButtonLink({text:EC_MESS.Close,className:"popup-window-button-link-cancel",events:{click:function(){e.CloseExternalDialog(true)}}})],content:BX("bxec_cdav_"+this.id)});BX.addCustomEvent(t,"onPopupClose",BX.proxy(this.CloseExternalDialog,this));t.CAL={DOM:{List:BX(this.id+"_bxec_dav_list"),EditConDiv:BX(this.id+"_bxec_dav_new"),EditName:BX(this.id+"_bxec_dav_name"),EditLink:BX(this.id+"_bxec_dav_link"),UserName:BX(this.id+"_bxec_dav_username"),Pass:BX(this.id+"_bxec_dav_password"),UserNameCont:BX(this.id+"_bxec_dav_username_cont"),PassCont:BX(this.id+"_bxec_dav_password_cont"),SectionsCont:BX(this.id+"_bxec_dav_sections_cont"),Sections:BX(this.id+"_bxec_dav_sections")}};this.oExternalDialog=t};JCEC.prototype.ShowExternalDialog=function(){if(!this.oExternalDialog)this.CreateExternalDialog();var e=this.oExternalDialog,t;e.show();e.CAL.curEditedConInd=false;BX.cleanNode(e.CAL.DOM.List);e.CAL.arConnections=BX.clone(this.arConnections);for(t=0;t<this.arConnections.length;t++){this.ExternalCalDialogDisplayConnection(e.CAL.arConnections[t],t)}if(this.arConnections.length==0){t=e.CAL.arConnections.length;e.CAL.arConnections.push({bNew:true,name:EC_MESS.NewExCalendar,link:"",user_name:""});this.ExternalCalDialogDisplayConnection(e.CAL.arConnections[t],t);this.ExternalCalDialogEditConnection(t)}else{this.ExternalCalDialogEditConnection(0)}};JCEC.prototype.CloseExternalDialog=function(e){if(e===true)this.oExternalDialog.close()};JCEC.prototype.ExternalCalDialogEditConnection=function(e){var t=this.oExternalDialog,i=t.CAL.arConnections[e];for(var o in t.CAL.arConnections){if(t.CAL.arConnections[o]&&o!=e&&BX.hasClass(t.CAL.arConnections[o].pConDiv,"bxec-dav-item-edited")){if(t.CAL.DOM.EditConDiv.parentNode==t.CAL.arConnections[o].pConDiv)this.ExternalCalDialogSaveConnectionData(o);BX.removeClass(t.CAL.arConnections[o].pConDiv,"bxec-dav-item-edited")}}if(i.del||t.CAL.curEditedConInd===e)return;if(t.CAL.curEditedConInd!==false&&t.CAL.arConnections[t.CAL.curEditedConInd]){this.ExternalCalDialogSaveConnectionData(t.CAL.curEditedConInd);BX.removeClass(t.CAL.arConnections[t.CAL.curEditedConInd].pConDiv,"bxec-dav-item-edited")}if(i.account_type=="caldav_google_oauth"){t.CAL.DOM.UserNameCont.style.display="none";t.CAL.DOM.PassCont.style.display="none";t.CAL.DOM.SectionsCont.style.display="";t.CAL.DOM.EditName.disabled="disabled";t.CAL.DOM.EditLink.disabled="disabled"}else{t.CAL.DOM.EditName.disabled="";t.CAL.DOM.EditLink.disabled="";t.CAL.DOM.UserNameCont.style.display="";t.CAL.DOM.PassCont.style.display=""}t.CAL.curEditedConInd=e;t.CAL.DOM.EditName.value=i.name;t.CAL.DOM.EditLink.value=i.link;t.CAL.DOM.UserName.value=i.user_name;i.sections={};BX.cleanNode(t.CAL.DOM.Sections);var n,a,s,l;for(n=0;n<this.arSections.length;n++){if(this.arSections[n]&&this.arSections[n].CAL_DAV_CON==i.id){a=this.arSections[n].ID;s=t.CAL.DOM.Sections.appendChild(BX.create("DIV",{props:{className:"bxec-dav-sect"}}));i.sections[a]=s.appendChild(BX.create("SPAN",{props:{className:"bxec-dav-sect-check"}})).appendChild(BX.create("INPUT",{props:{type:"checkbox",id:a,checked:this.arSections[n].ACTIVE=="Y"}}));s.appendChild(BX.create("SPAN",{props:{className:"bxc-spd-sect-label"},html:'<label for="'+a+'"><span>'+BX.util.htmlspecialchars(this.arSections[n].NAME)+"</span></label>"}))}}if(i.account_type!=="caldav_google_oauth"){if(i.id>0)this.ExD_CheckPass();else t.CAL.DOM.Pass.value="";setTimeout(function(){BX.focus(t.CAL.DOM.EditLink)},100);t.CAL.DOM.EditName.onkeyup=t.CAL.DOM.EditName.onfocus=t.CAL.DOM.EditName.onblur=function(){if(t.CAL.changeNameTimeout)clearTimeout(t.CAL.changeNameTimeout);t.CAL.changeNameTimeout=setTimeout(function(){if(t.CAL.curEditedConInd!==false&&t.CAL.arConnections[t.CAL.curEditedConInd]){var e=t.CAL.DOM.EditName.value;if(e.length>25)e=e.substr(0,23)+"...";t.CAL.arConnections[t.CAL.curEditedConInd].pText.innerHTML=BX.util.htmlspecialchars(e);t.CAL.arConnections[t.CAL.curEditedConInd].pText.title=t.CAL.DOM.EditName.value}},50)}}i.pConDiv.appendChild(t.CAL.DOM.EditConDiv);BX.addClass(i.pConDiv,"bxec-dav-item-edited")};JCEC.prototype.ExternalCalDialogDisplayConnection=function(e,t){var i=this,o=this.oExternalDialog,n=o.CAL.DOM.List.appendChild(BX.create("DIV",{props:{id:"bxec_dav_con_"+t,className:"bxec-dav-item"+(t%2==0?"":" bxec-dav-item-1")}})),a=n.appendChild(BX.create("DIV",{props:{className:"bxec-dav-item-name"}})),s=a.appendChild(BX.create("IMG",{props:{src:"/bitrix/images/1.gif",className:"bxec-dav-item-status"}})),l=a.appendChild(BX.create("SPAN",{text:e.name})),r=a.appendChild(BX.create("SPAN",{text:""})),c=a.appendChild(BX.create("A",{props:{href:"javascript: void(0);",className:"bxec-dav-edit"},text:EC_MESS.CalDavEdit})),d=a.appendChild(BX.create("A",{props:{href:"javascript: void(0);",className:"bxec-dav-col"},text:EC_MESS.CalDavCollapse})),C=a.appendChild(BX.create("A",{props:{href:"javascript: void(0);",className:"bxec-dav-del"},text:EC_MESS.CalDavDel})),p=a.appendChild(BX.create("A",{props:{href:"javascript: void(0);",className:"bxec-dav-rest"},text:EC_MESS.CalDavRestore})),u=a.appendChild(BX.create("DIV",{props:{className:"bxec-dav-del-cal"},children:[BX.create("LABEL",{props:{htmlFor:"bxec_dav_con_del_cal_"+t},text:EC_MESS.DelConCalendars})]})),D=u.appendChild(BX.create("INPUT",{props:{type:"checkbox",id:"bxec_dav_con_del_cal_"+t,checked:true}}));if(e.id>0){var E="bxec-dav-item-status",h;if(e.last_result.indexOf("[200]")>=0){E+=" bxec-dav-ok";h=EC_MESS.SyncOk+". "+EC_MESS.SyncDate+": "+e.sync_date}else{E+=" bxec-dav-error";h=EC_MESS.SyncError+": "+e.last_result+". "+EC_MESS.SyncDate+": "+e.sync_date}s.className=E;s.title=h;var f,v=0;for(f=0;f<this.arSections.length;f++){if(this.arSections[f]&&this.arSections[f].CAL_DAV_CON==e.id)v++}r.innerHTML=" ("+v+")";o.CAL.DOM.SectionsCont.style.display=""}else{o.CAL.DOM.SectionsCont.style.display="none"}n.onmouseover=function(){BX.addClass(this,"bxec-dav-item-over")};n.onmouseout=function(){BX.removeClass(this,"bxec-dav-item-over")};n.onclick=function(){t=parseInt(this.id.substr("bxec_dav_con_".length));i.ExternalCalDialogEditConnection(t)};d.onclick=function(e){var t=parseInt(this.parentNode.parentNode.id.substr("bxec_dav_con_".length));if(o.CAL.arConnections[t]){i.ExternalCalDialogSaveConnectionData(t);BX.removeClass(o.CAL.arConnections[t].pConDiv,"bxec-dav-item-edited");i.oExternalDialog.curEditedConInd=false}return BX.PreventDefault(e)};C.onclick=function(e){var t=parseInt(this.parentNode.parentNode.id.substr("bxec_dav_con_".length));if(o.CAL.arConnections[t]){o.CAL.arConnections[t].del=true;BX.removeClass(o.CAL.arConnections[t].pConDiv,"bxec-dav-item-edited");BX.addClass(o.CAL.arConnections[t].pConDiv,"bxec-dav-item-deleted");i.ExternalCalDialogSaveConnectionData(t);i.oExternalDialog.curEditedConInd=false}return BX.PreventDefault(e)};p.onclick=function(e){var t=parseInt(this.parentNode.parentNode.id.substr("bxec_dav_con_".length));if(o.CAL.arConnections[t]){o.CAL.arConnections[t].del=false;BX.removeClass(o.CAL.arConnections[t].pConDiv,"bxec-dav-item-deleted")}return BX.PreventDefault(e)};c.onclick=function(e){var t=parseInt(this.parentNode.parentNode.id.substr("bxec_dav_con_".length));i.ExternalCalDialogEditConnection(t);return BX.PreventDefault(e)};e.pConDiv=n;e.pText=l;e.pDelCalendars=D};JCEC.prototype.ExternalCalDialogSaveConnectionData=function(e){var t=this.oExternalDialog,i=t.CAL.arConnections[e];i.name=t.CAL.DOM.EditName.value;i.link=t.CAL.DOM.EditLink.value;i.user_name=t.CAL.DOM.UserName.value;i.pass="bxec_not_modify_pass";if(t.CAL.DOM.Pass.type.toLowerCase()=="password"&&t.CAL.DOM.Pass.title!=EC_MESS.CalDavNoChange)i.pass=t.CAL.DOM.Pass.value};JCEC.prototype.ExD_CheckPass=function(){var e=this.oExternalDialog;if(!BX.browser.IsIE()){e.CAL.DOM.Pass.type="text";e.CAL.DOM.Pass.value=EC_MESS.CalDavNoChange}else{e.CAL.DOM.Pass.value=""}e.CAL.DOM.Pass.title=EC_MESS.CalDavNoChange;e.CAL.DOM.Pass.className="bxec-dav-no-change";e.CAL.DOM.Pass.onfocus=e.CAL.DOM.Pass.onmousedown=function(){if(!BX.browser.IsIE())this.type="password";this.value="";this.title="";this.className="";this.onfocus=this.onmousedown=null;BX.focus(this)}};JCEC.prototype.CreateMobileSyncDialog=function(){var e=this;var t=new BX.PopupWindow("BXCMobileHelp"+this.id,null,{overlay:{opacity:10},autoHide:false,closeByEsc:true,zIndex:-100,offsetLeft:0,offsetTop:0,draggable:true,titleBar:" ",closeIcon:{right:"12px",top:"10px"},className:"bxc-popup-window",buttons:[new BX.PopupWindowButton({text:EC_MESS.Close,className:"popup-window-button-accept",events:{click:function(){e.CloseMobileSyncDialog(true)}}})],content:BX("bxec_mobile_"+this.id)});BX.addCustomEvent(t,"onPopupClose",BX.proxy(this.CloseMobileSyncDialog,this));t.CAL={DOM:{title:t.titleBar.firstChild,iPhoneSyncInfo:BX("bxec-sync-iphone-"+this.id),macosxSyncInfo:BX("bxec-sync-mac-"+this.id),androidSyncInfo:BX("bxec-sync-android-"+this.id)}};this.oMobileDialog=t};JCEC.prototype.ShowMobileSyncDialog=function(e,t){t="all";if(!this.oMobileDialog)this.CreateMobileSyncDialog();var i=this.oMobileDialog;i.show();i.CAL.DOM.iPhoneSyncInfo.style.display="none";i.CAL.DOM.macosxSyncInfo.style.display="none";i.CAL.DOM.androidSyncInfo.style.display="none";var o=[],n;if(e=="iphone"){i.CAL.DOM.title.innerHTML=EC_MESS.SyncTitleIphone;i.CAL.DOM.iPhoneSyncInfo.style.display="block";o=o.concat(BX.findChildren(i.CAL.DOM.iPhoneSyncInfo,{tagName:"SPAN",className:"bxec-link"},true));for(n=0;n<o.length;n++)if(o[n]&&o[n].nodeName){o[n].innerHTML=this.arConfig.caldav_link_all}}else if(e=="macosx"){i.CAL.DOM.title.innerHTML=EC_MESS.SyncTitleMacOSX;i.CAL.DOM.macosxSyncInfo.style.display="block";o=BX.findChildren(i.CAL.DOM.macosxSyncInfo,{tagName:"SPAN",className:"bxec-link"},true);for(n=0;n<o.length;n++){if(o[n]&&o[n].nodeName){o[n].innerHTML=this.arConfig.caldav_link_all.replace(/^https?:\/\//gi,"")}}}else if(e=="android"){i.CAL.DOM.title.innerHTML=EC_MESS.SyncTitleAndroid;i.CAL.DOM.androidSyncInfo.style.display="block"}i.CAL.calendarId=t;if(e=="iphone"||e=="macosx"){o=o.concat(BX.findChildren(i.CAL.DOM.iPhoneAllCont,{tagName:"SPAN",className:"bxec-link"},true));for(n=0;n<o.length;n++)if(o[n]&&o[n].nodeName)o[n].innerHTML=this.arConfig.caldav_link_all}};JCEC.prototype.CloseMobileSyncDialog=function(e){if(e===true)this.oMobileDialog.close()};JCEC.prototype.ChargePopupTabs=function(e,t){if(!e||!e.CAL||!e.CAL.DOM||!e.CAL.DOM.pTabs)return;e.CAL.Tabs=[];e.CAL.activeTab=false;var i,o=this;for(var n in e.CAL.DOM.pTabs.childNodes){i=e.CAL.DOM.pTabs.childNodes[n];if(i.nodeType=="1"&&i.className&&i.className.indexOf("popup-window-tab")!=-1){e.CAL.Tabs.push({tab:i,cont:BX(i.id+"-cont"),showed:i.style.display!="none"});i.onclick=function(){o.SetPopupTab(parseInt(this.id.substr(t.length)),e)}}}};JCEC.prototype.ShowPopupTab=function(e,t){e.tab.style.display=t?"":"none";e.cont.style.display=t?"":"none";e.showed=!!t};JCEC.prototype.SetPopupTab=function(e,t){var i,o,n=t.CAL.Tabs;if(isNaN(parseInt(e))||parseInt(e)!==e){for(i in n){if(n.hasOwnProperty(i)&&n[i].tab.id==e){e=i;break}}}e=parseInt(e);if(n&&t.CAL.activeTab!==e&&!n[e].bDisabled){for(i in n){if(n.hasOwnProperty(i)){o=n[i];if(!o||!o.cont)continue;if(i==e){BX.addClass(o.cont,"popup-window-tab-content-selected");BX.addClass(o.tab,"popup-window-tab-selected")}else{BX.removeClass(o.cont,"popup-window-tab-content-selected");BX.removeClass(o.tab,"popup-window-tab-selected")}BX.onCustomEvent(o,"OnSetTab",[o,i==e])}}t.CAL.activeTab=e;this.AdjustOverlay(t)}};JCEC.prototype.InitColorDialogControl=function(e,t){var i=this,o=this.id+"-"+e,n=BX(o+"-color-cont"),a=BX(o+"-color-inp"),s=BX(o+"-text-color-inp");function l(e,o,n){if(!o||n&&(o=="#FFFFFF"||o=="#000000"))o=i.ColorIsDark(e)?"#FFFFFF":"#000000";try{a.value=e;a.style.backgroundColor=e;a.style.color=o}catch(s){e=this.arConfig.arCalColors[0];a.style.color="#000000"}if(t&&typeof t=="function")t(e,o)}n.onclick=function(e){if(!e)e=window.event;var t=e.target||e.srcElement;if(t&&t.nodeName&&t.nodeName.toLowerCase()=="a"){var n=parseInt(t.id.substr((o+"-color-").length),10);if(i.arConfig.arCalColors[n])l(i.arConfig.arCalColors[n])}};a.onblur=a.onkeyup=function(){l(this.value)};a.onclick=function(){i.ColorPicker.Open({pWnd:this,key:e,id:o+"-bg",onSelect:function(e){l(e,a.style.color,true)}})};s.onclick=function(){i.ColorPicker.Open({pWnd:this,key:e,id:o+"-text",onSelect:function(e){l(a.value,e,false)}})};return{Set:l}};JCEC.prototype.ShowConfirmDeleteDialog=function(e){var t=this;var i=this.oConfirmDeleteDialog;if(i){i.destroy()}var o=BX.create("DIV");i=new BX.PopupWindow("BXCConfirmDelete"+this.id,null,{overlay:{opacity:10},autoHide:true,closeByEsc:true,zIndex:0,offsetLeft:0,offsetTop:0,draggable:true,bindOnResize:false,titleBar:EC_MESS.EC_DEL_REC_EVENT,closeIcon:{right:"12px",top:"10px"},className:"bxc-popup-window",buttons:[new BX.PopupWindowButtonLink({text:EC_MESS.Close,className:"popup-window-button-link-cancel",events:{click:function(){if(t.oConfirmDeleteDialog){t.oConfirmDeleteDialog.close()}}}})],content:o,events:{}});i.CAL={butThis:new BX.PopupWindowButton({text:EC_MESS.EC_REC_EV_ONLY_THIS_EVENT,events:{click:function(){if(t.Event.IsRecursive(e)){t.Event.ExcludeRecursionDate(e,e.DATE_FROM)}else if(e.RECURRENCE_ID){t.Event.Delete(e,true,{recursionMode:"this"})}if(t.oConfirmDeleteDialog){t.oConfirmDeleteDialog.close()}}}}),butNext:new BX.PopupWindowButton({text:EC_MESS.EC_REC_EV_NEXT,events:{click:function(){if(t.Event.IsRecursive(e)&&e.DT_FROM_TS===Math.floor(t.ParseDate(e["~DATE_FROM"]).getTime()/1e3)*1e3&&!e.RECURRENCE_ID){t.Event.DeleteAllReccurent(e,true)}else{t.Event.CutOffRecursiveEvent(e,e.DATE_FROM)}if(t.oConfirmDeleteDialog){t.oConfirmDeleteDialog.close()}if(t.oEditEventDialog){t.oEditEventDialog.close()}}}}),butAll:new BX.PopupWindowButton({text:EC_MESS.EC_REC_EV_ALL,events:{click:function(){t.Event.DeleteAllReccurent(e,true);if(t.oConfirmDeleteDialog){t.oConfirmDeleteDialog.close()}if(t.oEditEventDialog){t.oEditEventDialog.close()}}}}),DOM:{content:o}};o.appendChild(i.CAL.butThis.buttonNode);o.appendChild(i.CAL.butNext.buttonNode);o.appendChild(i.CAL.butAll.buttonNode);this.oConfirmDeleteDialog=i;i.show()};JCEC.prototype.ShowConfirmEditDialog=function(e,t){var i=this;var o=this.oConfirmEditDialog;if(o){o.destroy()}var n=BX.create("DIV");o=new BX.PopupWindow("BXCConfirmEdit"+this.id,null,{overlay:{opacity:10},autoHide:true,closeByEsc:true,zIndex:0,offsetLeft:0,offsetTop:0,draggable:true,bindOnResize:false,titleBar:EC_MESS.EC_EDIT_REC_EVENT,closeIcon:{right:"12px",top:"10px"},className:"bxc-popup-window",buttons:[new BX.PopupWindowButtonLink({text:EC_MESS.Close,className:"popup-window-button-link-cancel",events:{click:function(){if(i.oConfirmEditDialog){i.oConfirmEditDialog.close()}}}})],content:n,events:{}});o.CAL={butThis:new BX.PopupWindowButton({text:EC_MESS.EC_REC_EV_ONLY_THIS_EVENT,events:{click:function(){t.params.recurentEventEditMode="this";i.oEditEventDialog.oController.SaveForm(t.params,true);if(i.oConfirmEditDialog){i.oConfirmEditDialog.close()}if(i.oEditEventDialog){i.oEditEventDialog.close()}}}}),butNext:new BX.PopupWindowButton({text:EC_MESS.EC_REC_EV_NEXT,events:{click:function(){t.params.recurentEventEditMode="next";if(i.oEditEventDialog.oController.Reinvite&&o.CAL.DOM.reiviteInp){i.oEditEventDialog.oController.Reinvite.checked=o.CAL.DOM.reiviteInp.checked}i.oEditEventDialog.oController.SaveForm(t.params,true);if(i.oConfirmEditDialog){i.oConfirmEditDialog.close()}if(i.oEditEventDialog){i.oEditEventDialog.close()}}}}),butAll:new BX.PopupWindowButton({text:EC_MESS.EC_REC_EV_ALL,events:{click:function(){t.params.recurentEventEditMode="all";i.oEditEventDialog.oController.SaveForm(t.params,true);if(i.oConfirmEditDialog){i.oConfirmEditDialog.close()}if(i.oEditEventDialog){i.oEditEventDialog.close()}}}}),DOM:{content:n}};n.appendChild(o.CAL.butThis.buttonNode);n.appendChild(o.CAL.butNext.buttonNode);n.appendChild(o.CAL.butAll.buttonNode);if(e.IS_MEETING&&e.MEETING){o.CAL.DOM.reiviteCont=n.appendChild(BX.create("DIV",{props:{className:"bxec-row-reinvite"}}));o.CAL.DOM.reiviteInp=o.CAL.DOM.reiviteCont.appendChild(BX.create("INPUT",{props:{type:"checkbox",value:"Y",name:"confirm_meeting_reinvite",checked:this.oEditEventDialog.oController.Reinvite.checked,id:"reinvite-inp"+this.id}}));o.CAL.DOM.reiviteCont.appendChild(BX.create("LABEL",{attrs:{"for":"reinvite-inp"+this.id},text:EC_MESS.EC_REINVITE}))}this.oConfirmEditDialog=o;o.show()};JCEC.prototype.ShowConfirmDeclineDialog=function(e,t){var i=this;var o=this.oConfirmDeclineDialog;if(o){o.destroy()}var n=BX.create("DIV");o=new BX.PopupWindow("BXCConfirmDecline"+this.id,null,{overlay:{opacity:10},autoHide:true,closeByEsc:true,zIndex:0,offsetLeft:0,offsetTop:0,draggable:true,bindOnResize:false,titleBar:EC_MESS.EC_DECLINE_REC_EVENT,closeIcon:{right:"12px",top:"10px"},className:"bxc-popup-window",buttons:[new BX.PopupWindowButtonLink({text:EC_MESS.Close,className:"popup-window-button-link-cancel",events:{click:function(){if(i.oConfirmDeclineDialog){i.oConfirmDeclineDialog.close()}}}})],content:n,events:{}});o.CAL={butThis:new BX.PopupWindowButton({text:EC_MESS.EC_D_REC_EV_ONLY_THIS_EVENT,events:{click:function(){i.Event.SetMeetingStatus(false,{confirmed:true,reccurentMode:"this",currentDateFrom:i.oViewEventDialog.CAL.oEvent.DATE_FROM});if(i.oConfirmDeclineDialog){i.oConfirmDeclineDialog.close()}if(i.oViewEventDialog){i.oViewEventDialog.close()}}}}),butNext:new BX.PopupWindowButton({text:EC_MESS.EC_D_REC_EV_NEXT,events:{click:function(){i.Event.SetMeetingStatus(false,{confirmed:true,reccurentMode:"next",currentDateFrom:i.oViewEventDialog.CAL.oEvent.DATE_FROM});if(i.oConfirmDeclineDialog){i.oConfirmDeclineDialog.close()}if(i.oViewEventDialog){i.oViewEventDialog.close()}}}}),butAll:new BX.PopupWindowButton({text:EC_MESS.EC_D_REC_EV_ALL,events:{click:function(){i.Event.SetMeetingStatus(false,{confirmed:true,reccurentMode:"all",currentDateFrom:i.oViewEventDialog.CAL.oEvent.DATE_FROM});if(i.oConfirmDeclineDialog){i.oConfirmDeclineDialog.close()}if(i.oViewEventDialog){i.oViewEventDialog.close()}}}}),DOM:{content:n}};n.appendChild(o.CAL.butThis.buttonNode);n.appendChild(o.CAL.butNext.buttonNode);n.appendChild(o.CAL.butAll.buttonNode);this.oConfirmDeclineDialog=o;o.show()};
/* End */
;
; /* Start:"a:4:{s:4:"full";s:51:"/bitrix/js/calendar/cal-week.min.js?151131647612995";s:6:"source";s:31:"/bitrix/js/calendar/cal-week.js";s:3:"min";s:35:"/bitrix/js/calendar/cal-week.min.js";s:3:"map";s:35:"/bitrix/js/calendar/cal-week.map.js";}"*/
JCEC.prototype.BuildWeekDaysTable=function(){var e=this.Tabs["week"],t=e.pBodyCont.rows[0],i=e.pBodyCont.rows[1],s=e.pBodyCont.rows[2],o,a;for(o=0;o<7;o++){t.insertCell(o+1);a=i.insertCell(o+1);a.innerHTML='<div class="bxec-wdv-more-ev">&nbsp;</div>'}s.cells[0].colSpan="9";e.pTimelineCont=s.cells[0].firstChild;this.ResizeTabTitle(e)};JCEC.prototype.ResizeTabTitle=function(e){var t=bxInt(e.pBodyCont.parentNode.offsetWidth)-40-16,i,s;if(e.id=="week"){e.dayColWidth=Math.round(t/7);e.arDayColWidth=[];i=t-e.dayColWidth*7;for(s=0;s<7;s++){e.arDayColWidth[s]=e.dayColWidth;if(i<0){e.arDayColWidth[s]--;i++}else if(i>0){e.arDayColWidth[s]++;i--}}}else if(e.id=="day"){e.dayColWidth=t;e.arDayColWidth=[e.dayColWidth]}};JCEC.prototype.FillWeekDaysTitle=function(e){this.dragDrop.Reset();var t=this.Tabs[e.tabId],i=t.pBodyCont,s=i.rows[0],o=i.rows[1],a=e.startDate,r=[],l=this,n,d,c,h,y,T,m,f,C,p,u,D,b;t.curDay=false;for(n=1;n<=e.count;n++){y=this.ConvertDayIndex(a.getDay());T=a.getDate();m=a.getMonth();f=a.getFullYear();c=this.days[y][1]+", "+a.getDate();h=this.days[y][0]+", "+a.getDate()+" "+this.arConfig.month_r[m]+" "+f;u=s.cells[n];D=o.cells[n];u.setAttribute("data-bx-day-ind",n-1);D.setAttribute("data-bx-day-ind",n-1);b=BX.create("A",{props:{className:"bxec-day-link",href:"javascript:void(0)",title:EC_MESS.GoToDay},html:c});BX.cleanNode(u);u.style.width=t.arDayColWidth[n-1]-2+"px";u.appendChild(this.CreateStrut(t.arDayColWidth[n-1]-2));u.appendChild(b);b.onmousedown=function(e){return BX.PreventDefault(e)};b.onclick=function(e){var i=t.arDays[this.parentNode.cellIndex-1];l.SetTab("day",false,{bSetDay:false});l.SetDay(i.date,i.month,i.year);return BX.PreventDefault(e)};u.title=h;p=(this.week_holidays[y]||this.year_holidays[T+"."+m])&&!this.year_workdays[T+"."+m];C=T==this.currentDate.date&&m==this.currentDate.month&&f==this.currentDate.year;d="";if(C||p){if(C){d="bxec-cur-day";t.curDay={cellInd:n}}if(p)d+=" bxec-hol-day"}u.className=D.className=d;r.push({day:y,date:T,month:m,year:f,bHoliday:p,bCurDay:C,pWnd:u,pMoreEvents:D,Events:{begining:[],hidden:[],all:[]},EventsCount:0});if(!this.bReadOnly){u.onmousedown=D.onmousedown=function(){l.DayTitleOnMouseDown(this,e.tabId)};u.onmouseup=D.onmouseup=function(t){if(!l.dragDrop.IsDragDropNow()){l.DayTitleOnMouseUp(this,e.tabId);BX.PreventDefault(t)}};u.onmouseover=D.onmouseover=function(){l.DayTitleOnMouseOver(this,e.tabId)}}a.setDate(a.getDate()+1);if(n==1)t.activeFirst=new Date(f,m,T).getTime();if(n==e.count)t.activeLast=new Date(f,m,T,23,59).getTime();this.dragDrop.RegisterTitleDay(u,D,t.id)}return r};JCEC.prototype.BuildTimelineGrid=function(e,t){var i=BX.create("TABLE",{props:{className:"bxec-wdv-timeline-tbl"}}),s="",o="",a=this,r=e.id,l,n,d,c,h,y,T,m,f,C,p=this.arConfig.workTime[0].split("."),u=this.arConfig.workTime[1].split("."),D=bxIntEx(p[0]),b=bxIntEx(p[1]),w=bxIntEx(u[0]),v=bxIntEx(u[1]);e.arDays=t;if(e.pTimelineCont)BX.cleanNode(e.pTimelineCont);for(l=0;l<24;l++){f=l<D+1&&b==30||l>=w&&v==0||l>w||l<D;C=l>=w&&v==30||l<D||l>=w;s=f?" bxec-wdv-hol-row":"";o=C?" bxec-wdv-hol-row":"";d=i.insertRow(-1);d.className="bxec-half-time-row1"+s;h=d.insertCell(-1);h.innerHTML=this.FormatTimeByNum(l);h.rowSpan="2";h.className="bxec-time";c=i.insertRow(-1);c.className="bxec-half-time-row2"+o;for(n=0;n<e.daysCount;n++){y=d.insertCell(-1);if(l==0){y.style.width=e.arDayColWidth[n]-2+"px";y.appendChild(this.CreateStrut(e.arDayColWidth[n]-2))}T=c.insertCell(-1);if(!this.bReadOnly){y.onmousedown=T.onmousedown=function(){a.TimeCellOnMouseDown(this,r)};y.onmouseup=T.onmouseup=function(){a.TimeCellOnMouseUp(this,r)};y.onmouseover=T.onmouseover=function(){a.TimeCellOnMouseOver(this,r)}}m=t[n];if(!m.bHoliday&&!m.bCurDay)continue;if(m.bHoliday){BX.addClass(y,"bxec-time-hol-c1");BX.addClass(T,"bxec-time-hol-c2")}if(m.bCurDay){BX.addClass(y,"bxec-time-cur-c1");BX.addClass(T,"bxec-time-cur-c2")}}}i.rows[0].cells[0].appendChild(this.CreateStrut(40));if(BX.browser.IsIE()){setTimeout(function(){try{var t=i.rows[0].cells[i.rows[0].cells.length-1];var s=e.pBodyCont.rows[0].cells[e.pBodyCont.rows[0].cells.length-2];if(t.offsetLeft-s.offsetLeft>2)t.style.width=e.dayColWidth+50+"px"}catch(o){}},500)}e.pTimelineTable=i;e.pTimelineCont.appendChild(i);i.parentNode.style.width="100%";setTimeout(function(){e.pTimelineCont.scrollTop=40*bxInt(D);if(e.id=="week"){var t=3;if(BX.browser.IsChrome()||BX.browser.IsSafari())t=6;i.style.width=e.pBodyCont.offsetWidth-t+"px";i.parentNode.style.width=e.pBodyCont.offsetWidth-t+"px"}},0);if(e.curDay)setTimeout(function(){a.ShowCurTimePointer(r)},100);else this.HideCurTimePointer(r);this.dragDrop.RegisterTimeline(e.pTimelineCont,e);this.BuildWeekEventHolder()};JCEC.prototype.TimeCellOnMouseOver=function(e,t){if(this.selectTimeMode){this.selectTimeEndObj=e;this.SelectTime(t)}};JCEC.prototype.TimeCellOnMouseDown=function(e,t){this.selectTimeMode=true;this.selectTimeStartObj=this.selectTimeEndObj=e;if(e.className.indexOf("bxec-time-selected")==-1)return this.SelectTime(t);this.selectTimeMode=false;this.DeSelectTime(t);this.CloseAddEventDialog()};JCEC.prototype.TimeCellOnMouseUp=function(){if(!this.selectTimeMode)return;this.ShowAddEventDialog();this.selectTimeMode=false};JCEC.prototype.DayTitleOnMouseOver=function(e,t){if(this.selectTimeMode&&!this.selectDayTMode){var i=this.__GetRelativeCell(e);this.selectTimeEndObj=this.Tabs[t].pTimelineTable.rows[i.rowInd].cells[i.cellInd];this.SelectTime(t);return}if(this.selectDayTMode){this.selectDayTEndObj=e;this.SelectDaysT(t)}};JCEC.prototype.DayTitleOnMouseDown=function(e,t){this.selectDayTMode=true;this.selectDayTStartObj=this.selectDayTEndObj=e;if(e.className.indexOf("bxec-day-t-selected")==-1){if(this.arSelectedTime&&this.arSelectedTime.length>0)this.SelectTime(t);this.SelectDaysT(t);return}this.selectDayTMode=false;this.DeSelectDaysT();this.CloseAddEventDialog()};JCEC.prototype.DayTitleOnMouseUp=function(e,t){if(this.selectTimeMode&&!this.selectDayTMode){var i=this.__GetRelativeCell(e);this.selectTimeEndObj=this.Tabs[t].pTimelineTable.rows[i.rowInd].cells[i.cellInd];this.TimeCellOnMouseOver(this.selectTimeEndObj,t);this.TimeCellOnMouseUp(this.selectTimeEndObj,t);return}if(!this.selectDayTMode)return;this.ShowAddEventDialog();this.selectDayTMode=false};JCEC.prototype.__GetRelativeCell=function(e){var t=e.cellIndex,i=0;if(t>this.__ConvertCellIndex(this.selectTimeStartObj.parentNode.rowIndex,this.selectTimeStartObj.cellIndex)){t--;i=47}return{cellInd:t,rowInd:i}};JCEC.prototype.SelectDaysT=function(e){if(!this.arSelectedDaysT)this.arSelectedDaysT=[];if(!this.selectDayTStartObj||!this.selectDayTEndObj)return;if(this.arSelectedDaysT.length>0)this.DeSelectDaysT();var t=this.Tabs[e],i=this.selectDayTStartObj,s=this.selectDayTEndObj,o=i.cellIndex,a=s.cellIndex,r=t.pBodyCont,l=r.rows[0],n=r.rows[1],d;if(o>a){i=this.selectDayTEndObj;s=this.selectDayTStartObj;o=i.cellIndex;a=s.cellIndex}this.curDayTSelection={sDay:t.arDays[o-1],eDay:t.arDays[a-1]};for(d=o;d<=a;d++){c1=l.cells[d];c2=n.cells[d];BX.addClass(c1,"bxec-day-t-selected");BX.addClass(c2,"bxec-day-t-selected");this.arSelectedDaysT.push({pCell1:c1,pCell2:c2})}};JCEC.prototype.DeSelectDaysT=function(){if(!this.arSelectedDaysT)return;var e,t;for(e=0,t=this.arSelectedDaysT.length;e<t;e++){BX.removeClass(this.arSelectedDaysT[e].pCell1,"bxec-day-t-selected");BX.removeClass(this.arSelectedDaysT[e].pCell2,"bxec-day-t-selected")}this.arSelectedDaysT=[]};JCEC.prototype.SelectTime=function(e){if(!this.arSelectedTime)this.arSelectedTime=[];if(!this.selectTimeStartObj||!this.selectTimeEndObj)return;if(this.arSelectedTime.length>0)this.DeSelectTime(e);var t=this.Tabs[e],i=this.selectTimeStartObj,s=i.parentNode.rowIndex,o=this.__ConvertCellIndex(s,i.cellIndex),a=this.selectTimeEndObj,r=a.parentNode.rowIndex,l=this.__ConvertCellIndex(r,a.cellIndex),n={sDay:t.arDays[o-1],eDay:t.arDays[l-1],sTime:s/2,eTime:r/2+.5},d,c,h,y,T,m,f;if(s>r&&o==l||o>l){n.sTime+=.5;n.eTime-=.5}n.sHour=Math.floor(n.sTime);n.eHour=Math.floor(n.eTime);n.sMin=(n.sTime-n.sHour)*60;n.eMin=(n.eTime-n.eHour)*60;this.curTimeSelection=n;if(o==l){this._SelectTime({sRow:s,eRow:r,col:o,bShowNotifier:true,tabId:e,oDays:n})}else{if(o<l){c=o;h=l;m=s;f=r}else{c=l;h=o;m=r;f=s;_d=n.sDay;n.sDay=n.eDay;n.eDay=_d;_t=n.sTime;n.sTime=n.eTime;n.eTime=_t}for(d=c;d<=h;d++){y=d==c?m:0;T=d==h?f:47;this._SelectTime({sRow:y,eRow:T,col:d,bShowNotifier:d==c,tabId:e,oDays:n})}}};JCEC.prototype._SelectTime=function(e){var t=this.Tabs[e.tabId].pTimelineTable,i=Math.min(e.eRow,e.sRow),s=Math.max(e.eRow,e.sRow),o,a;for(o=i;o<=s;o++){a=t.rows[o].cells[this.__ConvertCellIndex(o,e.col,true)];BX.addClass(a,"bxec-time-selected");this.arSelectedTime.push({pCell:a})}if(e.bShowNotifier){if(i==e.eRow&&e.eRow!=e.sRow){var r=e.oDays.sDay;e.oDays.sDay=e.oDays.eDay;e.oDays.eDay=r;var l=e.oDays.sTime;e.oDays.sTime=e.oDays.eTime;e.oDays.eTime=l}this.ShowSelectTimeNotifier({tabId:e.tabId,rowInd:i,colInd:e.col,oDays:e.oDays})}};JCEC.prototype.__ConvertCellIndex=function(e,t,i){if(e/2!==Math.round(e/2))t+=i?-1:1;return t};JCEC.prototype.DeSelectTime=function(e){if(!this.arSelectedTime)return;var t,i;for(t=0,i=this.arSelectedTime.length;t<i;t++)BX.removeClass(this.arSelectedTime[t].pCell,"bxec-time-selected");this.HideSelectTimeNotifier({tabId:e});this.arSelectedTime=[]};JCEC.prototype.ShowSelectTimeNotifier=function(e,t){var i=this.Tabs[e.tabId],s=i.pTimelineTable,o=s.rows[e.rowInd].cells[this.__ConvertCellIndex(e.rowInd,e.colInd,true)],a=bxInt(o.offsetLeft),r=bxInt(o.offsetTop),l=Math.floor(e.oDays.sTime),n=Math.floor(e.oDays.eTime),d=(e.oDays.sTime-l)*60,c=(e.oDays.eTime-n)*60,h=e.oDays.sDay,y=e.oDays.eDay,T=-19,m=15,f,C,p;if(n==24)n="00";if(!i.pSTNotifier)i.pSTNotifier=s.parentNode.appendChild(BX.create("DIV",{props:{className:"bxec-st-notifier"}}));C=this.FormatTimeByNum(l,d);p=this.FormatTimeByNum(n,c);if(e.oDays.sDay==e.oDays.eDay)f="<nobr>"+C+" - "+p+"</nobr>";else f="<nobr>"+bxFormatDate(h.date,h.month+1,h.year)+" "+C+" - "+bxFormatDate(y.date,y.month+1,y.year)+" "+p+"</nobr>";if(bxInt(l)<=0)T=20;i.pSTNotifier.innerHTML='<img class="bxec-iconkit" src="/bitrix/images/1.gif">'+f;i.pSTNotifier.style.left=a+m+"px";i.pSTNotifier.style.top=r+T+"px";i.pSTNotifier.style.display="block"};JCEC.prototype.HideSelectTimeNotifier=function(e){var t=this.Tabs[e.tabId];if(!t.pSTNotifier)return;t.pSTNotifier.style.display="none"};JCEC.prototype.BuildSingleDayTable=function(){var e=this.Tabs["day"],t=e.pBodyCont,i=t.rows[0],s=t.rows[1],o=t.rows[2],a;i.insertCell(1);a=s.insertCell(1);a.innerHTML='<div class="bxec-wdv-more-ev">&nbsp;</div>';o.cells[0].colSpan="3";e.pTimelineCont=o.cells[0].firstChild;this.ResizeTabTitle(e)};JCEC.prototype.ShowCurTimePointer=function(e){var t=this,i=this.Tabs[e];if(!i.oCurTimePointer)this.CreateCurTimePointer(e);function s(){var e=new Date,s=bxInt(e.getHours()),o=bxInt(e.getMinutes()),a=i.pTimelineTable.rows[s*2].cells[1],r=a.offsetTop+Math.round(a.offsetHeight*2*o/6)/10-(BX.browser.IsSafari()?3:4);i.oCurTimePointer.pWnd.style.top=r+"px";i.oCurTimePointer.pWnd.title=EC_MESS.CurTime+" - "+t.FormatTimeByNum(s,o)}var o=i.oCurTimePointer,a=i.pTimelineTable.rows[0].cells[i.curDay.cellInd];if(!a)return;i.pTimelineCont.appendChild(o.pWnd);o.pWnd.style.display="block";o.pWnd.style.left=bxInt(a.offsetLeft)+"px";o.pWnd.style.width=bxInt(a.offsetWidth)+"px";o.interval=setInterval(s,6e4);s()};JCEC.prototype.CreateCurTimePointer=function(e){this.Tabs[e].oCurTimePointer={pWnd:BX.create("DIV",{props:{className:"bxec-time-pointer"},html:'<img class="bxec-iconkit" src="/bitrix/images/1.gif">'})}};JCEC.prototype.HideCurTimePointer=function(e){var t=this.Tabs[e];if(!t.oCurTimePointer)return;if(t.oCurTimePointer.interval)clearInterval(t.oCurTimePointer.interval);t.oCurTimePointer.pWnd.style.display="none"};JCEC.prototype.SetWeek=function(e,t,i){var s=this.Selector.OnChange(i,t,e),o=s.monthTo,a=s.yearTo,r=this.GetWeekByDate({date:s.dateTo,month:s.monthTo,year:s.yearTo});if(!this.arLoadedMonth[o+"."+a])return this.LoadEvents(o,a,{week:e,month:t,year:i});var l=(new Date).getTime();if(l>=s.weekStartDate.getTime()&&l<=s.weekEndDate.getTime()){o=this.currentDate.month;a=this.currentDate.year;r=this.GetWeekByDate(this.currentDate)}var n=this.activeDate.month!=o||this.activeDate.year!=a;this.activeDate.week=r;this.activeDate.month=o;this.activeDate.year=a;if(n)this.SetTabNeedRefresh("week",true);this.BuildTimelineGrid(this.Tabs["week"],this.FillWeekDaysTitle({tabId:"week",count:7,startDate:s.weekStartDate}))};JCEC.prototype.SetDay=function(e,t,i){var s=this.Selector.OnChange(i,t,false,e),o=s.month,a=s.year;if(!this.arLoadedMonth[o+"."+a])return this.LoadEvents(o,a,{date:e,month:t,year:i});var r=this.activeDate.month!=s.month||this.activeDate.year!=s.year;this.activeDate.date=s.date;this.activeDate.month=s.month;this.activeDate.year=s.year;if(r)this.SetTabNeedRefresh("day",true);var l=this.FillWeekDaysTitle({tabId:"day",count:1,startDate:s.oDate});this.BuildTimelineGrid(this.Tabs["day"],l)};
/* End */
;
; /* Start:"a:4:{s:4:"full";s:53:"/bitrix/js/calendar/cal-events.min.js?151131647613013";s:6:"source";s:33:"/bitrix/js/calendar/cal-events.js";s:3:"min";s:37:"/bitrix/js/calendar/cal-events.min.js";s:3:"map";s:37:"/bitrix/js/calendar/cal-events.map.js";}"*/
(function(e){e.JSECEvent=function(e){this.oEC=e};JSECEvent.prototype={Get:function(e){for(i=0,l=this.oEC.arEvents.length;i<l;i++)if(this.oEC.arEvents[i].ID==e)return this.oEC.arEvents[i]},IsMeeting:function(e){return this.oEC.allowMeetings&&e&&!!e.IS_MEETING},Attendees:function(e){var t={};if(e&&e.ID&&this.oEC.arAttendees[e.ID])t=this.oEC.arAttendees[e.ID];return t},View:function(t){if(t)this.oEC.HighlightEvent_M(t,false,true);this.oEC.DefaultAction();BX.onCustomEvent(this.oEC,"onBeforeCalendarEventView",[this.oEC,t]);if(this.oEC.DefaultAction()){if(t["~TYPE"]=="tasks"&&e.taskIFramePopup&&t.ID>0)taskIFramePopup.view(parseInt(t.ID));else this.oEC.ShowViewEventPopup(t);BX.onCustomEvent(this.oEC,"onAfterCalendarEventView",[this.oEC,t])}},Edit:function(t){if(t.oEvent)this.oEC.HighlightEvent_M(t.oEvent,false,true);this.oEC.DefaultAction();BX.onCustomEvent(this.oEC,"onBeforeCalendarEventEdit",[this.oEC,t]);if(this.oEC.DefaultAction()){if((!t.oEvent&&t.bTasks||t.oEvent&&t.oEvent["~TYPE"]=="tasks"&&t.oEvent.ID>0)&&e.taskIFramePopup){if(t.oEvent)taskIFramePopup.edit(parseInt(t.oEvent.ID));else taskIFramePopup.add()}else this.oEC.ShowEditEventPopup(t);BX.onCustomEvent(this.oEC,"onAfterCalendarEventView",[this.oEC,t])}},DeleteAllReccurent:function(e,t){if(this.IsRecursive(e)||e.RECURRENCE_ID){var i,s={},n,o=[];for(n=0;n<this.oEC.arEvents.length;n++){i=this.oEC.arEvents[n];if(i.ID!=e.ID&&i.RECURRENCE_ID!=e.ID&&i.ID!=e.RECURRENCE_ID&&(i.RECURRENCE_ID!=e.RECURRENCE_ID||!i.RECURRENCE_ID)){s[this.SmartId(i)]=true;o.push(i)}else{this.Blink(this.oEC.arEvents[n],false)}}this.oEC.arEvents=o;this.oEC.arLoadedEventsId=s}this.Display();return this.Delete(e,t,{recursionMode:"all"})},Delete:function(e,t,i){if(e)this.oEC.HighlightEvent_M(e,false,true);if(!i)i={};if(!e||!e.ID)return false;this.oEC.DefaultAction();BX.onCustomEvent(this.oEC,"onBeforeCalendarEventDelete",[this.oEC,e]);if(this.oEC.DefaultAction()){if(e["~TYPE"]=="tasks"){}else{if((this.IsRecursive(e)||e.RECURRENCE_ID)&&!t){this.oEC.ShowConfirmDeleteDialog(e);return false}else{t=!!t;if(this.IsAttendee(e)&&!this.IsHost(e)){t=true;if(!confirm(EC_MESS.DeclineConfirm))return false}if(this.IsHost(e)&&!t){t=true;if(!confirm(EC_MESS.DelMeetingConfirm))return false}if((!e.IS_MEETING||this.IsHost(e))&&!t){if(!confirm(EC_MESS.DelEventConfirm))return false}var s=this;if(this.IsAttendee(e)&&!this.IsHost(e)){return this.SetMeetingStatus(true,{eventId:bxInt(e.ID),comment:""})}else{this.oEC.Request({postData:this.oEC.GetReqData("delete",{id:bxInt(e.ID),name:e.NAME,calendar:bxInt(e.SECT_ID),rec_mode:i.recursionMode||false}),errorText:EC_MESS.DelEventError,handler:function(t){if(t){s.UnDisplay(e)}}})}BX.onCustomEvent(this.oEC,"onAfterCalendarEventDelete",[this.oEC])}}}return true},SetColor:function(e){var t,i=this,s=e.SECT_ID,n,o;function a(e){var t={};if(i.oEC.arSectionsInd[e]&&i.oEC.arSections[i.oEC.arSectionsInd[e]])t=i.oEC.arSections[i.oEC.arSectionsInd[e]];if(!t.TEXT_COLOR&&t.COLOR)t.TEXT_COLOR=i.oEC.ColorIsDark(t.COLOR)?"#FFFFFF":"#000000";return t}if(e["~TYPE"]=="tasks"){n=this.oEC.taskBgColor;o=this.oEC.taskTextColor}else{if(e.USER_MEETING&&!this.IsHost(e)){n=e.USER_MEETING.COLOR;o=e.USER_MEETING.TEXT_COLOR;if(!n)n=e.COLOR;if(!o)o=e.TEXT_COLOR;if(!n){t=a(s);if(t.COLOR){n=this.oEC.oSections[s].COLOR;o=this.oEC.oSections[s].TEXT_COLOR}}if((!n||!o)&&this.oEC.arSections.length){s=this.oEC.GetMeetingSection();t=a(s);if(s){if(!n&&t.COLOR)n=t.COLOR;if(!o&&t.TEXT_COLOR)o=t.TEXT_COLOR}}}else if(s){n=e.COLOR;o=e.TEXT_COLOR;t=a(s);if(!n&&t.COLOR)n=t.COLOR;if(!o&&t.TEXT_COLOR)o=t.TEXT_COLOR}}if(!n)n="#CEE669";e.displayColor=n;e.bDark=this.oEC.ColorIsDark(n);if(!o)o=e.bDark?"#FFFFFF":"#000000";e.displayTextColor=o;return e},SaveUserFields:function(e,t){if(e&&e.event_id&&t>0){e.event_id.value=parseInt(t);var i=this.oEC.GetReqData("").reqId;var s=this;if(e.reqId)e.reqId.value=i;BX.ajax.submit(e,function(){var e=top.BXCRES[i];if(e&&e["refresh"])s.ReloadAll(false)})}},GetQuestIcon:function(e){if(!this.IsBlinked(e))return"";return'<b title="'+EC_MESS.NotConfirmed+'" class="bxec-stat-q">?</b>'},IsTask:function(e){return e["~TYPE"]=="tasks"},IsHost:function(e,t){if(!t)t=this.oEC.userId;return e.IS_MEETING&&(e.MEETING_STATUS=="H"||e.ID==e.PARENT_ID&&t==e.MEETING_HOST)},IsAttendee:function(e,t){if(!t)t=this.oEC.userId;if(e.IS_MEETING){return true}return false},IsCrm:function(e){return e.UF_CRM_CAL_EVENT&&e.UF_CRM_CAL_EVENT!=""},IsBlinked:function(e){return e.IS_MEETING&&e.MEETING_STATUS=="Q"},IsRecursive:function(e){return!!e.RRULE},Blink:function(e,t,i){if(e&&e.display&&e.OWNER_ID==this.oEC.userId){if(i)t=this.IsBlinked(e);if(e._blinkInterval)e._blinkInterval=!!clearInterval(e._blinkInterval);if(t&&this.oEC.userSettings.blink){var s=this;e._blinkInterval=setInterval(function(){s.BlinkInterval(e)},600)}else if(!t){var n,o="bxec-event-blink";if(e.oParts){for(n=0;n<e.oParts.length;n++){if(e.oParts[n])BX.removeClass(e.oParts[n],o)}}if(e.oDaysT){if(e.oDaysT.week)BX.removeClass(e.oDaysT.week,o);if(e.oDaysT.day)BX.removeClass(e.oDaysT.day,o)}if(e.oTLParts){if(e.oTLParts.week){for(n=0;n<e.oTLParts.week.length;n++){if(e.oTLParts.week[n])BX.removeClass(e.oTLParts.week[n],o)}}if(e.oTLParts.day){for(n=0;n<e.oTLParts.day.length;n++){if(e.oTLParts.day[n])BX.removeClass(e.oTLParts.day[n],o)}}}}}},BlinkInterval:function(e){if(!this.oEC.userSettings.blink)return this.Blink(e,false,false);var t,i,s="bxec-event-blink",n=this.oEC.activeTabId;if(n=="month"){if(e.oParts){i=e.oParts.length;for(t=0;t<i;t++)if(e.oParts[t])BX.toggleClass(e.oParts[t],s)}}else{if(e.oDaysT&&e.oTLParts){if(e.oDaysT[n])BX.toggleClass(e.oDaysT[n],s);if(e.oTLParts[n]){i=e.oTLParts[n].length;for(t=0;t<i;t++)if(e.oTLParts[n][t])BX.toggleClass(e.oTLParts[n][t],s)}}}},SetMeetingStatus:function(e,t){var i={},s,n=t&&t.eventId?t.eventId:0;if(typeof t=="undefined")t={};if(!n&&this.oEC.oViewEventDialog){i=this.oEC.oViewEventDialog.CAL.oEvent;n=i.ID}s=parseInt(t.parentId||i.PARENT_ID);if(!t.eventId)t.eventId=n;if(!e&&!t.confirmed){if(this.IsRecursive(i)){this.oEC.ShowConfirmDeclineDialog(i);return false}else if(!confirm(EC_MESS.DeclineConfirm)){return false}}var o=this;this.oEC.Request({postData:this.oEC.GetReqData("set_meeting_status",{event_id:parseInt(t.eventId),parent_id:s,status:e?"Y":"N",reccurent_mode:t.reccurentMode||false,current_date_from:t.currentDateFrom||false}),handler:function(s){if(s){if(!o.oEC.userSettings.showDeclined&&!o.IsHost(i)&&!e&&!t.reccurentMode){o.UnDisplay(o.Get(t.eventId))}if(e||t.reccurentMode){o.ReloadAll(false)}}return true}});return true},SmartId:function(e){var t=e.PARENT_ID||e.ID;if(this.IsRecursive(e))t+="|"+e.DT_FROM_TS;if(e["~TYPE"]=="tasks")t+="|"+"task";return t},ReloadAll:function(e){if(this._reloadTimeout)clearTimeout(this._reloadTimeout);var t=this;this.oEC.arLoadedEventsId={};this.oEC.arLoadedParentId={};this.oEC.arLoadedMonth={};this.oEC.arEvents=[];this.oEC.SetTabNeedRefresh("month",true);this.oEC.SetTabNeedRefresh("week",true);this.oEC.SetTabNeedRefresh("day",true);if(e===false)this.oEC.LoadEvents();else this._reloadTimeout=setTimeout(function(){t.oEC.LoadEvents()},600)},Save:function(e){var t=parseInt(this.oEC.activeDate.month,10),i=this.oEC.activeDate.year;var s=this.oEC.GetReqData("edit_event",{id:e.id||0,name:e.name,desc:e.desc||"",date_from:e.date_from,date_to:e.date_to,default_tz:e.default_tz,sections:[e.calendar],location:e.location||{OLD:"",NEW:"",CHANGED:""},month:t+1,year:i,skip_time:e.skip_time||"N"});this.oEC.arLoadedMonth={};if(e.RRULE&&e.RRULE)s.rrule=e.RRULE;if(e.remind)s.remind=[{type:e.remind_type,count:e.remind_count}];if(this.oEC.allowMeetings){s.is_meeting=e.isMeeting||"";if(e.isMeeting){s.meeting=e.meeting||{};if(e.guests)s.guest=e.guests.length>0?e.guests:[0]}}s.color=e.color||"";s.text_color=e.text_color||"";if(e.accessibility)s.accessibility=e.accessibility;if(e.importance)s.importance=e.importance;if(e.private_event)s.private_event=e.private_event;var n=this;this.oEC.Request({postData:s,errorText:EC_MESS.EventSaveError,handler:function(s){if(s.id&&e.UFForm)n.SaveUserFields(e.UFForm,s.id);if(s.eventIds&&s.eventIds.length>0){for(var o=0;o<s.eventIds.length;o++){n.UnDisplay(s.eventIds[o],false)}}n.oEC.HandleEvents(s.events,s.attendees);n.oEC.arLoadedMonth[t+"."+i]=true;n.Display();return true}})},Display:function(){this.oEC.SetTabNeedRefresh(this.oEC.activeTabId);if(this.oEC.activeTabId=="month"){this.oEC.DisplayEventsMonth(true)}else{this.oEC.DeSelectTime(this.oEC.activeTabId);this.oEC.ReBuildEvents(this.oEC.activeTabId)}},UnDisplay:function(e,t){var i;if(typeof e=="object"&&e.ID)i=e.ID;else if(e>0)i=e;var s,n={},o,a=[];for(o=0;o<this.oEC.arEvents.length;o++){s=this.oEC.arEvents[o];if(s&&(s.ID!=i||s["~TYPE"]=="tasks")){n[this.SmartId(s)]=true;a.push(s)}else this.Blink(this.oEC.arEvents[o],false)}this.oEC.arEvents=a;this.oEC.arLoadedEventsId=n;if(t!==false)this.Display()},SetMeetingParams:function(e){var t=this.oEC.oEditEventDialog;var i=this.oEC.GetReqData("set_meeting_params",{event_id:t.CAL.oEvent.ID,accessibility:t.CAL.DOM.Accessibility.value});if(this.oEC.allowReminders&&t.CAL.DOM.RemCheck.checked){var s=t.CAL.DOM.RemCount.value||"";s=s.replace(/,/g,".");s=s.replace(/[^\d|\.]/g,"");i.remind=[{type:t.CAL.DOM.RemType.value,count:s}]}this.oEC.Request({postData:i,handler:function(e){t.CAL.oEvent.USER_MEETING.REMIND=i.remind||[];t.CAL.oEvent.USER_MEETING.ACCESSIBILITY=i.accessibility}});if(e.callback&&typeof e.callback=="function")e.callback()},CanDo:function(e,t,i){if(!e)return false;if(!i)i=this.oEC.userId;if(t=="edit"||t=="delete"){if(this.bReadOnly)return false;if(!e["IS_MEETING"]&&e.MEETING&&e.MEETING.ORGANIZER)return false;if(e.SECT_ID){var s=this.oEC.oSections[e.SECT_ID];if(s){if(s.SUPERPOSED&&(s.OWNER_ID!=this.oEC.ownerId||s.CAL_TYPE!=this.oEC.type)){return false}if(s.CAL_DAV_CAL&&s.CAL_DAV_CAL.indexOf("@virtual/events/")!==-1){return false}if(s.PERM)return!!s.PERM.edit}}}return false},BuildActions:function(e){var t,i=e.oEvent,s=i["~TYPE"]=="tasks",n=0,o=BX.create("DIV",{props:{className:"bxec-event-actions"}}),a=o.appendChild(BX.create("DIV",{props:{className:e.bTimeline?"bxec-icon-cont-tl":"bxec-icon-cont"}}));if((!this.IsMeeting(i)||this.IsMeeting(i)&&this.IsHost(i))&&(this.CanDo(i,"edit")||s&&i.CAN_EDIT)&&(!i.PRIVATE_EVENT||this.oEC.Personal())){t=a.appendChild(BX.create("I",{props:{className:"bxec-event-but bxec-ev-edit-icon",title:s?EC_MESS.TaskEdit:EC_MESS.EditEvent}}));t.setAttribute("data-bx-event-action","edit");n++;if(this.IsAttendee(i)&&!this.IsHost(i)){if(i.MEETING_STATUS!="N"){t=a.appendChild(BX.create("I",{props:{className:"bxec-event-but bxec-ev-del-icon",title:EC_MESS.DelEncounter}}));t.setAttribute("data-bx-event-action","del");n++}}else if(!s){t=a.appendChild(BX.create("I",{props:{className:"bxec-event-but bxec-ev-del-icon",title:EC_MESS.DelEvent}}));t.setAttribute("data-bx-event-action","del");n++}}if(n!=2){a.style.height="18px";a.style.width=18*n+"px";a.style.left="-"+18*n+"px"}e.cont.appendChild(o)},GetLabelStyle:function(e){var t="",i=e.IMPORTANCE;if(i&&i!="normal")t=' style="'+(i=="high"?"font-weight: bold;":"color: #535353;")+'"';return t},PreHandle:function(e){if(e.DATE_FROM&&e.DATE_TO){e.dateFrom=BX.parseDate(e.DATE_FROM);e.dateTo=BX.parseDate(e.DATE_TO);if(e.dateFrom&&e.dateTo){e.DT_FROM_TS=Math.floor(e.dateFrom.getTime()/1e3)*1e3;e.DT_TO_TS=Math.floor(e.dateTo.getTime()/1e3)*1e3;if(e.DT_SKIP_TIME!=="Y"){e.DT_FROM_TS-=(e["~USER_OFFSET_FROM"]||0)*1e3;e.DT_TO_TS-=(e["~USER_OFFSET_TO"]||0)*1e3}}}return e},CutOffRecursiveEvent:function(e,t){var i=this;var s=Math.floor(this.oEC.ParseDate(t).getTime()/1e3)*1e3;t=this.oEC.FormatDate(new Date(s-this.oEC.dayLength));if(e.RRULE){e.RRULE.UNTIL=t;e.RRULE["~UNTIL"]=t}var n,o={},a,r=[];if(this.IsRecursive(e)){for(a=0;a<this.oEC.arEvents.length;a++){n=this.oEC.arEvents[a];if(n&&(n.ID!==e.ID||n.DT_FROM_TS<s||n["~TYPE"]=="tasks")){o[this.SmartId(n)]=true;r.push(n)}else{this.Blink(this.oEC.arEvents[a],false)}}this.oEC.arEvents=r;this.oEC.arLoadedEventsId=o}else{for(a=0;a<this.oEC.arEvents.length;a++){n=this.oEC.arEvents[a];if(n&&(n.ID!==e.ID||n.DT_FROM_TS<s||n["~TYPE"]=="tasks")){o[this.SmartId(n)]=true;r.push(n)}else{this.Blink(this.oEC.arEvents[a],false)}}this.oEC.arEvents=r;this.oEC.arLoadedEventsId=o}this.oEC.Request({postData:this.oEC.GetReqData("change_recurcive_event_until",{event_id:parseInt(e.ID),until_date:t}),handler:function(){i.ReloadAll(false);return true}});this.Display()},ExcludeRecursionDate:function(e,t){var i=this;var s=Math.floor(this.oEC.ParseDate(t).getTime()/1e3)*1e3;var n,o={},a,r=[];for(a=0;a<this.oEC.arEvents.length;a++){n=this.oEC.arEvents[a];if(n&&(n.ID!==e.ID||n.DT_FROM_TS!=s||n["~TYPE"]=="tasks")){o[this.SmartId(n)]=true;r.push(n)}else{this.Blink(this.oEC.arEvents[a],false)}}this.oEC.arEvents=r;this.oEC.arLoadedEventsId=o;this.oEC.Request({postData:this.oEC.GetReqData("exclude_recursion_date",{event_id:parseInt(e.ID),exclude_date:t}),handler:function(){i.ReloadAll(false);return true}});this.Display()}}})(window);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:56:"/bitrix/js/calendar/cal-controlls.min.js?151131647670330";s:6:"source";s:36:"/bitrix/js/calendar/cal-controlls.js";s:3:"min";s:40:"/bitrix/js/calendar/cal-controlls.min.js";s:3:"map";s:40:"/bitrix/js/calendar/cal-controlls.map.js";}"*/
var ECUserControll=function(e){this.oEC=e.oEC;var t=this;this.count=0;this.countAgr=0;this.countDec=0;this.bEditMode=e.view!==true;this.pAttendeesCont=e.AttendeesCont;this.pAttendeesList=e.AttendeesList;this.pParamsCont=e.AdditionalParams;this.pSummary=e.SummaryCont;this.pCount=this.pSummary.appendChild(BX.create("A",{props:{className:"bxc-count",href:"javascript:void(0)"}}));this.pCountArg=this.pSummary.appendChild(BX.create("A",{props:{className:"bxc-count-agr",href:"javascript:void(0)"}}));this.pCountDec=this.pSummary.appendChild(BX.create("A",{props:{className:"bxc-count-dec",href:"javascript:void(0)"}}));this.pCount.onclick=function(){t.ListMode("all")};this.pCountArg.onclick=function(){t.ListMode("agree")};this.pCountDec.onclick=function(){t.ListMode("decline")};this._getFromDate=e.fromDateGetter&&typeof e.fromDateGetter=="function"?e.fromDateGetter:function(){return false};this._getToDate=e.toDateGetter&&typeof e.toDateGetter=="function"?e.toDateGetter:function(){return false};this._getEventId=e.eventIdGetter&&typeof e.eventIdGetter=="function"?e.eventIdGetter:function(){return false};this.ListMode("all");this.Attendees={};if(this.bEditMode){this.pLinkCont=e.AddLinkCont;var i=this.pLinkCont.appendChild(BX.create("I")),n=this.pLinkCont.appendChild(BX.create("SPAN",{text:EC_MESS.AddAttendees}));i.onclick=n.onclick=BX.proxy(this.OpenSelectUser,this);var s=[{text:EC_MESS.AddGuestsDef,onclick:BX.proxy(this.OpenSelectUser,this)}];if(!this.oEC.bExtranet&&this.oEC.type=="group")s.push({text:EC_MESS.AddGroupMemb,title:EC_MESS.AddGroupMembTitle,onclick:BX.proxy(this.oEC.AddGroupMembers,this.oEC)});if(s.length>1){pMore=this.pLinkCont.appendChild(BX.create("A",{props:{href:"javascript: void(0);",className:"bxec-add-more"}}));pMore.onclick=function(){BX.PopupMenu.show("bxec_add_guest_menu",t.pLinkCont,s,{events:{onPopupClose:function(){BX.removeClass(pMore,"bxec-add-more-over")}}});BX.addClass(pMore,"bxec-add-more-over")}}BX.addCustomEvent(window,"onUserSelectorOnChange",BX.proxy(this.UserOnChange,this))}};ECUserControll.prototype={SetValues:function(e){var t,i=e.length,n;BX.cleanNode(this.pAttendeesList);this.Attendees={};this.count=0;this.countAgr=0;this.countDec=0;for(t=0;t<i;t++){n=e[t];n.key=n.id||n.email;if(n&&n.key&&!this.Attendees[n.key])this.DisplayAttendee(n)}if(this.bEditMode){this.DisableUserOnChange(true,true);O_BXCalUserSelect.setSelected(e)}this.UpdateCount()},GetValues:function(){return this.Attendees},SetEmpty:function(e){if(this.bEmpty===e)return;BX.onCustomEvent(this,"SetEmpty",[e]);if(e){BX.addClass(this.pAttendeesCont,"bxc-att-empty");if(this.pParamsCont)this.pParamsCont.style.display="none"}else{BX.removeClass(this.pAttendeesCont,"bxc-att-empty");if(this.pParamsCont)this.pParamsCont.style.display=""}this.bEmpty=e},UpdateCount:function(){this.pCount.innerHTML=EC_MESS.AttSumm+" - "+(parseInt(this.count)||0);if(this.countAgr>0){this.pCountArg.innerHTML=EC_MESS.AttAgr+" - "+parseInt(this.countAgr);this.pCountArg.style.display=""}else{this.pCountArg.style.display="none"}if(this.countDec>0){this.pCountDec.innerHTML=EC_MESS.AttDec+" - "+parseInt(this.countDec);this.pCountDec.style.display=""}else{this.pCountDec.style.display="none"}this.SetEmpty(this.count==0)},OpenSelectUser:function(e){if(BX.PopupMenu&&BX.PopupMenu.currentItem)BX.PopupMenu.currentItem.popupWindow.close();if(!e)e=window.event;if(!this.SelectUserPopup){var t=this;this.SelectUserPopup=BX.PopupWindowManager.create("bxc-user-popup",this.pLinkCont,{offsetTop:1,autoHide:true,closeByEsc:true,content:BX("BXCalUserSelect_selector_content"),className:"bxc-popup-user-select",buttons:[new BX.PopupWindowButton({text:EC_MESS.Add,events:{click:function(){t.SelectUserPopup.close();for(var e in t.selectedUsers){if(t.selectedUsers.hasOwnProperty(e)){e=parseInt(e);if(!isNaN(e)&&e>0){if(!t.Attendees[e]&&t.selectedUsers[e]){t.selectedUsers[e].key=e;t.DisplayAttendee(t.selectedUsers[e])}else if(t.Attendees[e]&&!t.selectedUsers[e]){t.RemoveAttendee(e,false)}}}}BX.onCustomEvent(t,"UserOnChange");t.UpdateCount()}}}),new BX.PopupWindowButtonLink({text:EC_MESS.Close,className:"popup-window-button-link-cancel",events:{click:function(){t.SelectUserPopup.close()}}})]})}if(this.bEditMode){this.selectedUsers={};var i=[],n;for(n in this.Attendees){if(this.Attendees[n]&&this.Attendees[n].type!="ext")i.push(this.Attendees[n].User)}O_BXCalUserSelect.setSelected(i)}this.SelectUserPopup.show();BX.PreventDefault(e)},AddByEmail:function(e){var t=this;if(BX.PopupMenu&&BX.PopupMenu.currentItem)BX.PopupMenu.currentItem.popupWindow.close();if(!e)e=window.event;if(!this.EmailPopup){var i=BX.create("DIV",{props:{className:"bxc-email-cont"},html:'<label class="bxc-email-label">'+EC_MESS.UserEmail+":</label>"});this.pEmailValue=i.appendChild(BX.create("INPUT",{props:{className:"bxc-email-input"}}));this.EmailPopup=BX.PopupWindowManager.create("bxc-user-popup-email",this.pLinkCont,{offsetTop:1,autoHide:true,content:i,className:"bxc-popup-user-select-email",closeIcon:{right:"12px",top:"5px"},closeByEsc:true,buttons:[new BX.PopupWindowButton({text:EC_MESS.Add,className:"popup-window-button-accept",events:{click:function(){var e=BX.util.trim(t.pEmailValue.value);if(e!=""&&!t.Attendees[e]){var i={name:e,key:e,type:"ext",status:"Y"};t.DisplayAttendee(i);t.UpdateCount()}t.EmailPopup.close()}}}),new BX.PopupWindowButtonLink({text:EC_MESS.Close,className:"popup-window-button-link-cancel",events:{click:function(){t.EmailPopup.close()}}})]})}this.EmailPopup.show();setTimeout(function(){BX.focus(t.pEmailValue)},50);BX.PreventDefault(e)},DisableUserOnChange:function(e,t){this.bDisableUserOnChange=e===true;if(t)setTimeout(BX.proxy(this.DisableUserOnChange,this),300)},UserOnChange:function(e){if(this.bDisableUserOnChange)return;this.selectedUsers=e},DisplayAttendee:function(e,t){this.count++;if(e.status=="Y")this.countAgr++;else if(e.status=="N")this.countDec++;else e.status="Q";if(t&&e.id&&this.Attendees[e.id]){}else{var i=this,n=false,s=e.status.toLowerCase(),o=this.pAttendeesList.appendChild(BX.create("SPAN",{props:{className:"bxc-attendee-row bxc-att-row-"+s}})),a=o.appendChild(BX.create("I",{props:{className:"bxc-stat-"+s,title:EC_MESS["GuestStatus_"+s]+(e.desc?" - "+e.desc:"")}}));if(e.type=="ext")pName=o.appendChild(BX.create("span",{props:{className:"bxc-name"},text:e.name||e.email}));else pName=o.appendChild(BX.create("A",{props:{href:this.oEC.GetUserHref(e.id),className:"bxc-name"},text:e.name}));if(this.bEditMode&&e.type!="ext")n=o.appendChild(BX.create("SPAN",{props:{className:"bxc-busy"}}));o.appendChild(BX.create("SPAN",{props:{className:"bxc-comma"},html:","}));if(this.bEditMode){o.appendChild(BX.create("A",{props:{id:"bxc-att-key-"+e.key,href:"javascript:void(0)",title:EC_MESS.Delete,className:"bxc-del-att"}})).onclick=function(e){i.RemoveAttendee(this.id.substr("bxc-att-key-".length));return BX.PreventDefault(e||window.event)}}this.Attendees[e.key]={User:e,pRow:o,pBusyCont:n}}},RemoveAttendee:function(e,t){t=t!==false;if(this.Attendees[e]){this.Attendees[e].pRow.parentNode.removeChild(this.Attendees[e].pRow);if(this.Attendees[e].User.status=="Y")this.countAgr--;if(this.Attendees[e].User.status=="N")this.countDec--;this.count--;this.Attendees[e]=null;delete this.Attendees[e];if(this.bEditMode){var i=[];for(k in this.Attendees){if(this.Attendees[k]&&this.Attendees[k].type!="ext")i.push(this.Attendees[k].User)}this.DisableUserOnChange(true,true);if(t)O_BXCalUserSelect.setSelected(i)}}this.UpdateCount()},ListMode:function(e){if(this.mode==e)return;if(this.mode){BX.removeClass(this.pAttendeesList,"bxc-users-mode-"+this.mode);BX.removeClass(this.pSummary,"bxc-users-mode-"+this.mode)}this.mode=e;BX.addClass(this.pAttendeesList,"bxc-users-mode-"+this.mode);BX.addClass(this.pSummary,"bxc-users-mode-"+this.mode)}};var ECSyncPannel=function(e){this.oEC=e;if(!this.oEC.arConfig.syncInfo)return;this.Display();if(!window.jsOutlookUtils)return BX.loadScript("/bitrix/js/calendar/outlook.js")};ECSyncPannel.prototype={Display:function(){var e=this,t;this.syncList=[{id:"google",label:EC_MESS.syncGoogle,className:"bxec-sect-access-for-google",active:!!this.oEC.arConfig.syncInfo.google.active,connected:!!this.oEC.arConfig.syncInfo.google.connected,syncDate:this.oEC.arConfig.syncInfo.google.syncDate,connectHandler:function(t){BX.util.popup(e.oEC.arConfig.googleCalDavStatus.authLink,500,600);return BX.PreventDefault(t||window.event)},disconnectHandler:function(t){e.DisconnectGoogle(t);return BX.PreventDefault(t||window.event)}},{id:"macosx",className:"bxec-sect-access-for-macosx",label:EC_MESS.syncMac,active:!!this.oEC.arConfig.syncInfo.macosx.active,connected:!!this.oEC.arConfig.syncInfo.macosx.connected,syncDate:this.oEC.arConfig.syncInfo.macosx.syncDate,connectHandler:function(t){e.ConnectMacOSX();return BX.PreventDefault(t||window.event)},disconnectHandler:function(t){e.DisconnectMacOSX();return BX.PreventDefault(t||window.event)}},{id:"iphone",className:"bxec-sect-access-for-iphone",label:EC_MESS.syncIphone,active:!!this.oEC.arConfig.syncInfo.iphone.active,connected:!!this.oEC.arConfig.syncInfo.iphone.connected,syncDate:this.oEC.arConfig.syncInfo.iphone.syncDate,connectHandler:function(t){e.ConnectIphone();return BX.PreventDefault(t||window.event)},disconnectHandler:function(t){e.DisconnectIphone();return BX.PreventDefault(t||window.event)}},{id:"android",className:"bxec-sect-access-for-android",label:EC_MESS.syncAndroid,active:!!this.oEC.arConfig.syncInfo.android.active,connected:!!this.oEC.arConfig.syncInfo.android.connected,syncDate:this.oEC.arConfig.syncInfo.android.syncDate,connectHandler:function(t){e.ConnectAndroid();return BX.PreventDefault(t||window.event)},disconnectHandler:function(t){e.DisconnectAndroid();return BX.PreventDefault(t||window.event)}},{id:"outlook",className:"bxec-sect-access-for-outlook",label:EC_MESS.syncOutlook,active:!!this.oEC.arConfig.syncInfo.outlook.active&&!BX.browser.IsMac(),connected:!!this.oEC.arConfig.syncInfo.outlook.connected,syncDate:this.oEC.arConfig.syncInfo.outlook.syncDate,connectHandler:function(t){e.ConnectOutlook();return BX.PreventDefault(t||window.event)},disconnectHandler:function(t){e.DisconnectOutlook();return BX.PreventDefault(t||window.event)}},{id:"office365",className:"bxec-sect-access-for-office365",label:EC_MESS.syncOffice365,active:!!this.oEC.arConfig.syncInfo.office365.active,connected:!!this.oEC.arConfig.syncInfo.office365.connected,syncDate:this.oEC.arConfig.syncInfo.office365.syncDate},{id:"exchange",className:"bxec-sect-access-for-exchange",label:EC_MESS.syncExchange,active:!!this.oEC.arConfig.syncInfo.exchange.active,connected:!!this.oEC.arConfig.syncInfo.exchange.connected,syncDate:this.oEC.arConfig.syncInfo.exchange.syncDate,connectHandler:function(t){e.ConnectExchange();return BX.PreventDefault(t||window.event)},disconnectHandler:function(t){e.DisconnectExchange();return BX.PreventDefault(t||window.event)}}];this.pWrap=BX(this.oEC.id+"-sync-inner-wrap");BX.cleanNode(this.pWrap);this.brightMode=true;var i=0;var n=0;for(t=0;t<this.syncList.length;t++){if(this.syncList[t].active){if(this.syncList[t].connected){this.brightMode=false;i++}else{n++}}}if(this.brightMode){for(t=0;t<this.syncList.length;t++){this.BuildSyncItem(this.syncList[t])}}else{for(t=0;t<this.syncList.length;t++){if(this.syncList[t].connected)this.BuildSyncItem(this.syncList[t])}this.showMoreLink=this.pWrap.appendChild(BX.create("DIV",{props:{className:"bxec-sect-access-view-all"}})).appendChild(BX.create("A",{props:{href:""},text:EC_MESS.connectMore.replace(/#COUNT#/gi,n)}));BX.bind(this.showMoreLink,"click",function(t){e.showMoreLink.style.display="none";e.hiddenWrap.style.height=n*41+"px";if(!e.hideMoreLink){e.hideMoreLink=e.pWrap.appendChild(BX.create("DIV",{props:{className:"bxec-sect-access-view-all"}})).appendChild(BX.create("A",{props:{href:""},text:EC_MESS.showLess}));BX.bind(e.hideMoreLink,"click",function(t){e.hideMoreLink.style.display="none";e.showMoreLink.style.display="";e.hiddenWrap.style.height=0;return BX.PreventDefault(t||window.event)})}else{e.hideMoreLink.style.display=""}return BX.PreventDefault(t||window.event)});this.hiddenWrap=this.pWrap.appendChild(BX.create("DIV",{props:{className:"bxec-sect-access-hidden-wrap"}}));for(t=0;t<this.syncList.length;t++){if(!this.syncList[t].connected)this.BuildSyncItem(this.syncList[t],this.hiddenWrap)}}},SyncSectionWithOutlook:function(id){var oSect=this.oEC.oSections[id];if(oSect&&oSect.OUTLOOK_JS&&oSect.OUTLOOK_JS.length>0)try{eval(oSect.OUTLOOK_JS)}catch(e){}},DisconnectGoogle:function(e){if(confirm(EC_MESS.googleDisconnectConfirm)){var t,i=null,n=this;for(t=0;t<this.oEC.arConnections.length;t++){i=this.oEC.arConnections[t];if(i.account_type=="caldav_google_oauth"){break}}if(i&&i.id){this.oEC.Request({postData:this.oEC.GetReqData("disconnect_google",{connectionId:i.id}),handler:function(){window.location=window.location}})}}return BX.PreventDefault(e||window.event)},ConnectOutlook:function(){var e=0,t=this,i,n,s,o;for(i=0;i<this.oEC.arSections.length;i++){n=this.oEC.arSections[i];if(n.ACTIVE!=="N"&&this.oEC.IsCurrentViewSect(n)&&n.OUTLOOK_JS){e++;s=n}}if(e==1&&s){this.SyncSectionWithOutlook(s.ID)}else{var a=this.GetSyncItem("outlook");if(!this.outlookPopup){a.popupCont=BX.create("DIV",{props:{className:"bxec-sync-popup-wrap"}});for(i=0;i<this.oEC.arSections.length;i++){n=this.oEC.arSections[i];if(this.oEC.IsCurrentViewSect(n)&&n.OUTLOOK_JS){o=a.popupCont.appendChild(BX.create("DIV",{props:{id:"ecpp_"+n.ID,className:"bxec-sync-popup-item"+(n.bDark?" bxec-dark":"")},style:{backgroundColor:n.COLOR},text:n.NAME}));o.onclick=function(){t.SyncSectionWithOutlook(this.id.substr("ecpp_".length))}}}this.outlookPopup=BX.PopupWindowManager.create(this.oEC.id+"-outlook-sync-popup",a.pConnectLink,{autoHide:true,closeByEsc:true,offsetTop:-1,offsetLeft:1,lightShadow:true,content:a.popupCont})}this.outlookPopup.show(true);BX.addCustomEvent(this.outlookPopup,"onPopupClose",function(){if(t.outlookPopup&&t.outlookPopup.destroy){t.outlookPopup.destroy();t.outlookPopup=null}})}},ConnectIphone:function(){this.oEC.ShowMobileSyncDialog("iphone")},ConnectMacOSX:function(){this.oEC.ShowMobileSyncDialog("macosx")},ConnectAndroid:function(){this.oEC.ShowMobileSyncDialog("android")},DisconnectIphone:function(){this.oEC.Request({postData:this.oEC.GetReqData("clear_sync_info",{sync_type:"iphone"})});var e=this.GetSyncItem("iphone");if(e&&e.pDisconnectLink){var t=this;this.ShowInfoPopup(e.pDisconnectLink,EC_MESS.disconnectIphone,function(){t.oEC.arConfig.syncInfo.iphone.connected=false;t.oEC.arConfig.syncInfo.iphone.syncDate=false;t.Display()})}},DisconnectMacOSX:function(){this.oEC.Request({postData:this.oEC.GetReqData("clear_sync_info",{sync_type:"mac"})});var e=this.GetSyncItem("macosx");if(e&&e.pDisconnectLink){var t=this;this.ShowInfoPopup(e.pDisconnectLink,EC_MESS.disconnectMac,function(){t.oEC.arConfig.syncInfo.macosx.connected=false;t.oEC.arConfig.syncInfo.macosx.syncDate=false;t.Display()})}},DisconnectAndroid:function(){this.oEC.Request({postData:this.oEC.GetReqData("clear_sync_info",{sync_type:"android"})});var e=this.GetSyncItem("android");if(e&&e.pDisconnectLink){var t=this;this.ShowInfoPopup(e.pDisconnectLink,EC_MESS.disconnectAndroid,function(){t.oEC.arConfig.syncInfo.android.connected=false;t.oEC.arConfig.syncInfo.android.syncDate=false;t.Display()})}},DisconnectOutlook:function(){this.oEC.Request({postData:this.oEC.GetReqData("clear_sync_info",{sync_type:"outlook"})});var e=this.GetSyncItem("outlook");if(e&&e.pDisconnectLink){var t=this;this.ShowInfoPopup(e.pDisconnectLink,EC_MESS.disconnectOutlook,function(){t.oEC.arConfig.syncInfo.outlook.connected=false;t.oEC.arConfig.syncInfo.outlook.syncDate=false;t.Display()})}},ShowInfoPopup:function(e,t,i){var n=BX.PopupWindowManager.create(this.oEC.id+"-disconnect-popup",e,{autoHide:true,closeByEsc:true,offsetTop:-1,offsetLeft:1,lightShadow:true,content:BX.create("DIV",{props:{className:"bxec-disconnect-popup-wrap"},html:t})});n.show(true);function s(){if(i&&typeof i=="function")i();if(n&&n.destroy){BX.removeCustomEvent(n,"onPopupClose",s);n.destroy();n=null}}BX.addCustomEvent(n,"onPopupClose",s)},ConnectExchange:function(){var e=this.GetSyncItem("exchange");if(e&&e.pConnectLink){this.ShowInfoPopup(e.pConnectLink,EC_MESS.connectExchange)}},DisconnectExchange:function(){var e=this.GetSyncItem("exchange");if(e&&e.pDisconnectLink){this.ShowInfoPopup(e.pDisconnectLink,EC_MESS.disconnectExchange)}},SyncExchange:function(){this.oEC.Request({postData:this.oEC.GetReqData("exchange_sync"),handler:function(e){var t=e.result;setTimeout(function(){if(t===true)top.window.location=top.window.location;else if(t===false)alert(EC_MESS.ExchNoSync)},100)}})},BuildSyncItem:function(e,t){if(!t)t=this.pWrap;if(e.active){e.pOuter=t.appendChild(BX.create("DIV",{props:{className:"bxec-sect-access-el "+(e.className||"")}}));e.pInner=e.pOuter.appendChild(BX.create("DIV",{props:{className:"bxec-sect-access-el-block"}}));if(!e.connected&&e.connectHandler){e.pConnectLink=e.pInner.appendChild(BX.create("A",{props:{className:"bxec-sect-access-connect-link"},text:EC_MESS.syncConnect}));BX.bind(e.pConnectLink,"click",e.connectHandler)}e.pIcon=e.pInner.appendChild(BX.create("DIV",{props:{className:"bxec-sect-access-icon"}}));e.pTextWrap=e.pInner.appendChild(BX.create("DIV",{props:{className:"bxec-sect-access-text-wrap"},text:e.label}));if(!this.brightMode||e.connected)BX.addClass(e.pOuter,"bxec-sect-access-connected");if(e.connected){e.pInner.appendChild(BX.create("DIV",{props:{className:"bxec-sect-access-allowed-icon"}}));e.pInfoCont=e.pOuter.appendChild(BX.create("DIV",{props:{className:"bxec-sect-access-block-info bxec-sect-access-el-block-active"}}));var i=e.pInfoCont.appendChild(BX.create("TABLE",{props:{className:"bxec-sect-access-el-table"}}));var n=i.insertRow(-1);BX.adjust(n.insertCell(-1),{props:{className:"bxec-sect-access-status"},html:EC_MESS.syncOk});var s=BX.adjust(n.insertCell(-1),{style:{textAlign:"right"}});if(e.syncDate){e.pSyncDate=s.appendChild(BX.create("DIV",{props:{className:"bxec-sect-access-status-time"}}));e.pSyncDate.innerHTML=e.syncDate}if(e.disconnectHandler){e.pDisconnectLink=s.appendChild(BX.create("SPAN",{props:{className:"bxec-sect-access-disconnect-link"},html:EC_MESS.syncDisconnect}));BX.bind(e.pDisconnectLink,"click",e.disconnectHandler)}if(e.id=="exchange"&&this.oEC.arConfig.bExchange){e.pTextWrap.style.cursor="pointer";e.pTextWrap.title=EC_MESS.syncExchangeTitle;BX.bind(e.pTextWrap,"click",BX.proxy(this.SyncExchange,this))}}}},GetSyncItem:function(e){var t;for(t=0;t<this.syncList.length;t++){if(this.syncList[t].active&&this.syncList[t].id==e){return this.syncList[t]}}}};var ECMonthSelector=function(e){this.oEC=e;this.Build();this.content={month:"",week:"",day:""}};ECMonthSelector.prototype={Build:function(){var e=this;this.pPrev=BX(this.oEC.id+"selector-prev");this.pNext=BX(this.oEC.id+"selector-next");this.pCont=BX(this.oEC.id+"selector-cont");this.pContInner=BX(this.oEC.id+"selector-cont-inner");this.pPrev.onclick=function(){e.ChangeValue(false)};this.pNext.onclick=function(){e.ChangeValue(true)}},ChangeMode:function(e){this.mode=e||this.oEC.activeTabId;if(this.mode=="month"){this.pCont.className="bxec-sel-but";this.pCont.onclick=BX.proxy(this.ShowMonthPopup,this)}else{this.pCont.className="bxec-sel-text";this.pCont.onclick=BX.False}},OnChange:function(e,t,i,n){t=parseInt(t,10);e=parseInt(e);var s,o;this.pNext.style.marginLeft=this.mode=="month"&&BX.browser.IsIE()&&!BX.browser.IsIE9()?"10px":"";if(this.mode=="month"){if(t<0||t>11)return alert("Error! Incorrect month");this.content.month=this.oEC.arConfig.month[t]+",&nbsp;"+e+'<span class="bxec-sel-but-arr">'}else if(this.mode=="week"){var a=new Date;a.setFullYear(e,t,1);o=this.oEC.GetWeekDayOffset(this.oEC.GetWeekDayByInd(a.getDay()));if(o>0)a.setDate(a.getDate()-o);if(i!=0)a.setDate(a.getDate()+7*i);var r=new Date(a.getTime());r.setDate(r.getDate()+6);var c,h=this.oEC.arConfig.month_r,l=a.getDate(),d=a.getMonth(),p=a.getFullYear(),u=r.getDate(),f=r.getMonth(),E=r.getFullYear();if(d==f)c=l+"&nbsp;-&nbsp;"+u+"&nbsp;"+h[d]+"&nbsp;"+p;else if(p==E)c=l+"&nbsp;"+h[d]+"&nbsp;-&nbsp;"+u+"&nbsp;"+h[f]+"&nbsp;"+p;else c=l+"&nbsp;"+h[d]+"&nbsp;"+p+"&nbsp;-&nbsp;"+u+"&nbsp;"+h[f]+"&nbsp;"+E;this.content.week="<nobr>"+c+"</nobr>";s={dateFrom:l,monthFrom:d,yearFrom:p,weekStartDate:a,monthTo:f,yearTo:E,dateTo:u,weekEndDate:r}}else if(this.mode=="day"){var C=new Date;C.setFullYear(e,t,n);day=this.oEC.ConvertDayIndex(C.getDay());n=C.getDate(),t=C.getMonth(),e=C.getFullYear();this.content.day="<nobr>"+this.oEC.arConfig.days[day][0]+",&nbsp;"+n+"&nbsp;"+this.oEC.arConfig.month_r[t]+"&nbsp;"+e+"</nobr>";s={date:n,month:t,year:e,oDate:C}}this.Show(this.mode);return s},Show:function(e){this.pContInner.innerHTML=this.content[e]},ChangeValue:function(e){var t=e?1:-1;this.oEC.bJustRedraw=false;if(this.mode=="month"){var i=bxInt(this.oEC.activeDate.month)+t;var n=this.oEC.activeDate.year;if(i<0){i+=12;n--}else if(i>11){i-=12;n++}this.oEC.SetMonth(i,n)}else if(this.mode=="week"){this.oEC.SetWeek(this.oEC.activeDate.week+t,this.oEC.activeDate.month,this.oEC.activeDate.year)}else if(this.mode=="day"){this.oEC.SetDay(this.oEC.activeDate.date+t,this.oEC.activeDate.month,this.oEC.activeDate.year)}},ShowMonthPopup:function(){if(!this.oMonthWin){var e=this;this.oMonthWin=new BX.PopupWindow(this.oEC.id+"bxc-month-sel",this.pCont,{overlay:{opacity:1},autoHide:true,offsetTop:1,offsetLeft:0,lightShadow:true,contentColor:"white",contentNoPaddings:true,content:BX("bxec_month_win_"+this.oEC.id)});this.oMonthWin.CAL={DOM:{Year:BX(this.oEC.id+"md-year"),MonthList:BX(this.oEC.id+"md-month-list")},curYear:parseInt(this.oEC.activeDate.year)};this.oMonthWin.CAL.DOM.Year.innerHTML=this.oMonthWin.CAL.curYear;BX(this.oEC.id+"md-selector-prev").onclick=function(){e.oMonthWin.CAL.DOM.Year.innerHTML=--e.oMonthWin.CAL.curYear};BX(this.oEC.id+"md-selector-next").onclick=function(){e.oMonthWin.CAL.DOM.Year.innerHTML=++e.oMonthWin.CAL.curYear};var t,i,n,s=[0,4,8,1,5,9,2,6,10,3,7,11];for(t=0;t<12;t++){i=s[t];n=this.oMonthWin.CAL.DOM.MonthList.appendChild(BX.create("DIV",{props:{id:"bxec_ms_m_"+s[t],className:"bxec-month-div"+(s[t]==this.oEC.activeDate.month?" bxec-month-act":"")+" bxec-"+this.GetSeason(s[t])},html:"<span>"+this.oEC.arConfig.month[s[t]]+"</span>",events:{click:function(){e.oEC.bJustRedraw=false;BX.removeClass(e.oMonthWin.CAL.DOM.curMonth,"bxec-month-act");BX.addClass(this,"bxec-month-act");e.oMonthWin.CAL.DOM.curMonth=this;e.oEC.SetMonth(parseInt(this.id.substr("bxec_ms_m_".length)),e.oMonthWin.CAL.curYear);e.oMonthWin.close()}}}));if(s[t]==this.oEC.activeDate.month)this.oMonthWin.CAL.DOM.curMonth=n}}this.oMonthWin.show()},GetSeason:function(e){switch(e){case 11:case 0:case 1:return"winter";case 2:case 3:case 4:return"spring";case 5:case 6:case 7:return"summer";case 8:case 9:case 10:return"autumn"}}};var ECCalendarAccess=function(e){BX.Access.Init();if(!window.EC_MESS)EC_MESS={};this.bind=e.bind;this.GetAccessName=e.GetAccessName;this.pTbl=e.pCont.appendChild(BX.create("TABLE",{props:{className:"bxc-access-tbl"}}));this.pSel=BX("bxec-"+this.bind);var t=this;this.delTitle=e.delTitle||EC_MESS.Delete;this.noAccessRights=e.noAccessRights||EC_MESS.NoAccessRights;this.inputName=e.inputName||false;e.pLink.onclick=function(){BX.Access.ShowForm({callback:BX.proxy(t.InsertRights,t),bind:t.bind})}};ECCalendarAccess.prototype={InsertRights:function(e){var t,i;for(t in e)for(i in e[t])this.InsertAccessRow(BX.Access.GetProviderName(t)+" "+e[t][i].name,i)},InsertAccessRow:function(e,t,i){var n=this,s,o,a,r;if(this.pTbl.rows[0]&&this.pTbl.rows[0].cells[0]&&this.pTbl.rows[0].cells[0].className.indexOf("bxc-access-no-vals")!=-1)this.DeleteRow(0);s=this.pTbl.insertRow(-1);o=BX.adjust(s.insertCell(-1),{props:{className:"bxc-access-c-l"},html:e+":"});a=BX.adjust(s.insertCell(-1),{props:{className:"bxc-access-c-r"}});r=a.appendChild(this.pSel.cloneNode(true));r.id="BXEC_ACCESS_"+t;if(i)r.value=i;pDel=a.appendChild(BX.create("A",{props:{className:"access-delete",href:"javascript:void(0)",title:this.delTitle},events:{click:function(){n.DeleteRow(this.parentNode.parentNode.rowIndex)}}}));if(this.inputName){r.name=this.inputName+"["+t+"]"}},DeleteRow:function(e){if(this.pTbl.rows[e])this.pTbl.deleteRow(e)},GetValues:function(){var e,t,i={},n=this.pTbl.getElementsByTagName("SELECT"),s,o=n.length;for(s=0;s<o;s++){e=n[s].id.substr("BXEC_ACCESS_".length);t=n[s].value;i[e]=t}return i},SetSelected:function(e){if(!e)e={};while(this.pTbl.rows[0])this.pTbl.deleteRow(0);var t,i={};for(t in e){this.InsertAccessRow(this.GetTitleByCode(t),t,e[t]);i[t]=true}if(this.pTbl.rows.length<=0)BX.adjust(this.pTbl.insertRow(-1).insertCell(-1),{props:{className:"bxc-access-no-vals",colSpan:2},html:"<span>"+this.noAccessRights+"</span>"});BX.Access.SetSelected(i,this.bind)},GetTitleByCode:function(e){return this.GetAccessName(e)}};function ECColorPicker(e){this.bOpened=false;this.zIndex=5e3;this.id="";this.Popups={};this.Conts={}}ECColorPicker.prototype={Create:function(){var e=this;var t=document.body.appendChild(BX.create("DIV",{props:{className:"ec-colpick-cont"},style:{zIndex:this.zIndex}}));var i=["#3AD0FF","#A6DC00","#FF5C5A","#B47153","#2FC7F7","#04B4AB","#FFA801","#5CD1DF","#6E54D1","#29AD49","#FE5957","#DAA187","#78D4F1","#43DAD2","#EECE8F","#AEE5EC","#FF0000","#FFFF00","#00FF00","#00FFFF","#0000FF","#FF00FF","#FFFFFF","#EBEBEB","#E1E1E1","#D7D7D7","#CCCCCC","#C2C2C2","#B7B7B7","#ACACAC","#A0A0A0","#959595","#EE1D24","#FFF100","#00A650","#00AEEF","#2F3192","#ED008C","#898989","#7D7D7D","#707070","#626262","#555","#464646","#363636","#262626","#111","#000000","#F7977A","#FBAD82","#FDC68C","#FFF799","#C6DF9C","#A4D49D","#81CA9D","#7BCDC9","#6CCFF7","#7CA6D8","#8293CA","#8881BE","#A286BD","#BC8CBF","#F49BC1","#F5999D","#F16C4D","#F68E54","#FBAF5A","#FFF467","#ACD372","#7DC473","#39B778","#16BCB4","#00BFF3","#438CCB","#5573B7","#5E5CA7","#855FA8","#A763A9","#EF6EA8","#F16D7E","#EE1D24","#F16522","#F7941D","#FFF100","#8FC63D","#37B44A","#00A650","#00A99E","#00AEEF","#0072BC","#0054A5","#2F3192","#652C91","#91278F","#ED008C","#EE105A","#9D0A0F","#A1410D","#A36209","#ABA000","#588528","#197B30","#007236","#00736A","#0076A4","#004A80","#003370","#1D1363","#450E61","#62055F","#9E005C","#9D0039","#790000","#7B3000","#7C4900","#827A00","#3E6617","#045F20","#005824","#005951","#005B7E","#003562","#002056","#0C004B","#30004A","#4B0048","#7A0045","#7A0026"],n,s,o,a=BX.create("TABLE",{props:{className:"ec-colpic-tbl"}}),r,c=i.length;n=a.insertRow(-1);s=n.insertCell(-1);s.colSpan=8;var h=s.appendChild(BX.create("SPAN",{props:{className:"ec-colpic-def-but"},text:EC_MESS.DefaultColor}));h.onmouseover=function(){this.className="ec-colpic-def-but ec-colpic-def-but-over";o.style.backgroundColor="#FF0000"};h.onmouseout=function(){this.className="ec-colpic-def-but"};h.onmousedown=function(t){e.Select("#FF0000")};o=n.insertCell(-1);o.colSpan=8;o.className="ec-color-inp-cell";o.style.backgroundColor=i[38];for(r=0;r<c;r++){if(Math.round(r/16)==r/16)n=a.insertRow(-1);s=n.insertCell(-1);s.innerHTML="&nbsp;";s.className="ec-col-cell";s.style.backgroundColor=i[r];s.id="lhe_color_id__"+r;s.onmouseover=function(e){this.className="ec-col-cell ec-col-cell-over";o.style.backgroundColor=i[this.id.substring("lhe_color_id__".length)]};s.onmouseout=function(e){this.className="ec-col-cell"};s.onmousedown=function(t){var n=this.id.substring("lhe_color_id__".length);e.Select(i[n])}}t.appendChild(a);this.Conts[this.id]=t},Open:function(e){this.id=e.id+Math.round(Math.random()*1e6);this.key=e.key;this.OnSelect=e.onSelect;if(!this.Conts[this.id])this.Create();if(!this.Popups[this.id]){this.Popups[this.id]=BX.PopupWindowManager.create("bxc-color-popup"+this.id,e.pWnd,{autoHide:true,offsetTop:1,offsetLeft:0,lightShadow:true,content:this.Conts[this.id]})}this.Popups[this.id].show()},Close:function(){this.Popups[this.id].close();this.Popups[this.id].destroy()},OnKeyPress:function(e){if(!e)e=window.event;if(e.keyCode==27)this.Close()},Select:function(e){if(this.OnSelect&&typeof this.OnSelect=="function")this.OnSelect(e);this.Close()}};window.BxEditEventGridSetLinkName=function(e){var t=BX("event-grid-dest-add-link");if(t)t.innerHTML=BX.SocNetLogDestination.getSelectedCount(e)>0?BX.message("BX_FPD_LINK_2"):BX.message("BX_FPD_LINK_1")};window.BxEditEventGridSelectCallback=function(e,t,i){var n=t;prefix="S";if(t=="sonetgroups")prefix="SG";else if(t=="groups"){prefix="UA";n="all-users"}else if(t=="users")prefix="U";else if(t=="department")prefix="DR";BX("event-grid-dest-item").appendChild(BX.create("span",{attrs:{"data-id":e.id},props:{className:"event-grid-dest event-grid-dest-"+n},children:[BX.create("input",{attrs:{type:"hidden",name:"EVENT_DESTINATION["+prefix+"][]",value:e.id}}),BX.create("span",{props:{className:"event-grid-dest-text"},html:e.name}),BX.create("span",{props:{className:"feed-event-del-but"},attrs:{"data-item-id":e.id,"data-item-type":t}})]}));BX.onCustomEvent("OnDestinationAddNewItem",[e]);BX("event-grid-dest-input").value="";BxEditEventGridSetLinkName(editEventDestinationFormName)};window.BxEditEventGridUnSelectCallback=function(e,t,i){var n=BX.findChildren(BX("event-grid-dest-item"),{attribute:{"data-id":""+e.id+""}},true);if(n!=null){for(var s=0;s<n.length;s++)BX.remove(n[s])}BX.onCustomEvent("OnDestinationUnselect");BX("event-grid-dest-input").value="";BxEditEventGridSetLinkName(editEventDestinationFormName)};window.BxEditEventGridOpenDialogCallback=function(){BX.style(BX("event-grid-dest-input-box"),"display","inline-block");BX.style(BX("event-grid-dest-add-link"),"display","none");BX.focus(BX("event-grid-dest-input"))};window.BxEditEventGridCloseDialogCallback=function(){if(!BX.SocNetLogDestination.isOpenSearch()&&BX("event-grid-dest-input").value.length<=0){BX.style(BX("event-grid-dest-input-box"),"display","none");BX.style(BX("event-grid-dest-add-link"),"display","inline-block");BxEditEventGridDisableBackspace()}};window.BxEditEventGridCloseSearchCallback=function(){if(!BX.SocNetLogDestination.isOpenSearch()&&BX("event-grid-dest-input").value.length>0){BX.style(BX("event-grid-dest-input-box"),"display","none");BX.style(BX("event-grid-dest-add-link"),"display","inline-block");BX("event-grid-dest-input").value="";BxEditEventGridDisableBackspace()}};window.BxEditEventGridDisableBackspace=function(e){if(BX.SocNetLogDestination.backspaceDisable||BX.SocNetLogDestination.backspaceDisable!=null)BX.unbind(window,"keydown",BX.SocNetLogDestination.backspaceDisable);BX.bind(window,"keydown",BX.SocNetLogDestination.backspaceDisable=function(e){if(e.keyCode==8){BX.PreventDefault(e);return false}});setTimeout(function(){BX.unbind(window,"keydown",BX.SocNetLogDestination.backspaceDisable);BX.SocNetLogDestination.backspaceDisable=null},5e3)};window.BxEditEventGridSearchBefore=function(e){return BX.SocNetLogDestination.searchBeforeHandler(e,{formName:editEventDestinationFormName,inputId:"event-grid-dest-input"})};window.BxEditEventGridSearch=function(e){return BX.SocNetLogDestination.searchHandler(e,{formName:editEventDestinationFormName,inputId:"event-grid-dest-input",linkId:"event-grid-dest-add-link",sendAjax:true})};(function(e){e.EditEventPopupController=function(e){this.config=e;this.id=this.config.id;this.oEC=this.config.oEC;this.oEvent=this.config.oEvent;this.Form=this.config.form;this.Init()};e.EditEventPopupController.prototype={Init:function(){this.InitDateTimeControls();var t=this,i=this.oEC.id+"_event_editor",n=e["BXHtmlEditor"].Get(i);if(n&&n.IsShown()){this.CustomizeHtmlEditor(n)}else{BX.addCustomEvent(e["BXHtmlEditor"],"OnEditorCreated",function(e){if(e.id==i){t.CustomizeHtmlEditor(e)}})}if(this.oEC.allowMeetings)this.InitDestinationControls();this.FillFormFields()},SaveForm:function(e,t){var i,n,s=this,o=parseInt(this.oEC.activeDate.month,10),a=this.oEC.activeDate.year,r=this.oEC.actionUrl,c=Math.round(Math.random()*1e6);r+=r.indexOf("?")==-1?"?":"&";r+="action=edit_event&bx_event_calendar_request=Y&sessid="+BX.bitrix_sessid()+"&reqId="+c;

this.Form.action=r;if(BX.util.trim(this.pFromTime.value)!=""||BX.util.trim(this.pFromDate.value)!=""){i=this.oEC.ParseDate(BX.util.trim(this.pFromDate.value)+(this.pFullDay.checked?"":" "+BX.util.trim(this.pFromTime.value)))}if(BX.util.trim(this.pToTime.value)!=""||BX.util.trim(this.pToDate.value)!=""){n=this.oEC.ParseDate(BX.util.trim(this.pToDate.value)+(this.pFullDay.checked?"":" "+BX.util.trim(this.pToTime.value)))}if(e.recurentEventEditMode){BX("event-current-date-from"+this.id).value=this.oEvent.DATE_FROM;BX("event-rec-edit-mode"+this.id).value=e.recurentEventEditMode}else{BX("event-current-date-from"+this.id).value="";BX("event-rec-edit-mode"+this.id).value=""}BX("event-location-old"+this.id).value=this.Loc.OLD||false;BX("event-location-new"+this.id).value=this.Loc.NEW;if(this.Loc.NEW.substr(0,5)=="ECMR_"&&this.RepeatCheck.checked){alert(EC_MESS.reservePeriodWarn);return false}if(!this.CheckUserAccessibility()){alert(EC_MESS.EC_BUSY_ALERT);return}if(this.Loc.NEW.substr(0,5)=="ECMR_"&&!e.bLocationChecked){if(n&&this.pFullDay.checked){n=new Date(n.getTime()+864e5)}if(i&&n){this.oEC.CheckMeetingRoom({id:this.oEvent.ID||0,from:s.oEC.FormatDateTime(i),to:s.oEC.FormatDateTime(n),location_new:this.Loc.NEW,location_old:this.Loc.OLD||false},function(t){if(!t)return alert(EC_MESS.MRReserveErr);if(t=="reserved")return alert(EC_MESS.MRNotReservedErr);e.bLocationChecked=true;s.SaveForm(e)});return false}}if(i&&BX.util.trim(this.pFromTime.value)!="")this.pFromTime.value=this.oEC.FormatTime(i,true);if(n&&BX.util.trim(this.pToTime.value)!="")this.pToTime.value=this.oEC.FormatTime(n,true);BX("event-id"+this.id).value=this.oEvent.ID||0;BX("event-month"+this.id).value=o+1;BX("event-year"+this.id).value=a;if(this.RepeatCheck.checked){var h=this.RepeatSelect.value;if(this.RepeatDiapTo.value==EC_MESS.NoLimits)this.RepeatDiapTo.value="";if(h=="WEEKLY"){var l=[],d;for(d=0;d<7;d++)if(this.RepeatWeekDaysCh[d].checked)l.push(this.RepeatWeekDaysCh[d].value);if(l.length==0)this.RepeatSelect.value="NONE";else BX("event-rrule-byday"+this.id).value=l.join(",")}}if(this.oEvent.ID&&this.oEC.Event.IsRecursive(this.oEvent)&&!t){if(this.CheckForSignificantChanges()){this.oEC.ShowConfirmEditDialog(this.oEvent,{params:e});return false}}BX.ajax.submit(this.Form,function(){if(e.recurentEventEditMode){s.oEC.Event.ReloadAll(false)}else{var t=top.BXCRES[c];if(t){if(t.eventIds&&t.eventIds.length>0){for(var i=0;i<t.eventIds.length;i++){s.oEC.Event.UnDisplay(t.eventIds[i],false)}}s.oEC.HandleEvents(t.events,t.attendees);s.oEC.arLoadedMonth[o+"."+a]=true;s.oEC.Event.Display()}}});var p=this.pSectSelect.value,u=s.oEC.oSections&&s.oEC.oSections[p]?s.oEC.oSections[p]:{},f=this.TextColor,E=this.Color;if(!u.COLOR||u.COLOR&&u.COLOR.toLowerCase()!=E.toLowerCase())BX(this.id+"_bxec_color").value=E;if(!u.TEXT_COLOR||u.TEXT_COLOR&&u.TEXT_COLOR.toLowerCase()!=f.toLowerCase())BX(this.id+"_bxec_text_color").value=f;if(!this.oEC.arConfig.userTimezoneName){this.config.userTimezoneName=this.oEC.arConfig.userTimezoneName=this.pDefTimezone.value}if(e.callback)e.callback()},CheckUserAccessibility:function(){var e,t=true;if(this.plannerData){for(e in this.plannerData.entries){if(this.plannerData.entries.hasOwnProperty(e)&&this.plannerData.entries[e].id&&this.plannerData.entries[e].status!="h"&&this.plannerData.entries[e].strictStatus&&!this.plannerData.entries[e].currentStatus){t=false;break}}}return t},CheckForSignificantChanges:function(){var e=false;if(!e&&this.oEvent.NAME!==this.Form.name.value)e=true;if(!e&&this.oEvent.DESCRIPTION!==this.Form.desc.value)e=true;if(!e&&this.oEvent.LOCATION!==this.Loc.NEW)e=true;if(!e&&this.oEvent.displayColor!==this.Color)e=true;if(!e&&this.oEvent.displayTextColor!==this.TextColor)e=true;if(!e&&this.oEvent.DT_SKIP_TIME=="Y"!=this.Form.skip_time.checked)e=true;if(!e){var t=this.pFromDate.value,i=this.pToDate.value;if(this.oEvent.DT_SKIP_TIME!="Y"){if(!e&&(this.oEvent.TZ_FROM!=this.Form.tz_from.value||this.oEvent.TZ_TO!=this.Form.tz_to.value))e=true;t+=" "+this.pFromTime.value;i+=" "+this.pToTime.value;if(!e){var n=this.oEC.ParseDate(this.oEvent["~DATE_FROM"]),s=this.oEC.ParseDate(this.oEvent["~DATE_TO"]),o=this.oEC.ParseDate(t),a=this.oEC.ParseDate(i);if(!n||!s||!o||!a)e=true;if(!e&&Math.abs(n.getTime()-o.getTime())>1e3||Math.abs(s.getTime()-a.getTime())>1e3)e=true}}else{if(!e&&(this.oEvent["~DATE_FROM"]!=t||this.oEvent["~DATE_TO"]!=i))e=true}}if(!e&&this.plannerData){var r,c={},h=0;if(this.oEvent.IS_MEETING&&this.oEvent["~ATTENDEES"]){for(r in this.oEvent["~ATTENDEES"]){if(this.oEvent["~ATTENDEES"].hasOwnProperty(r)&&this.oEvent["~ATTENDEES"][r]["USER_ID"]){c[this.oEvent["~ATTENDEES"][r]["USER_ID"]]=true;h++}}}for(r in this.plannerData.entries){if(this.plannerData.entries.hasOwnProperty(r)&&this.plannerData.entries[r].type=="user"&&this.plannerData.entries[r].id){if(c[this.plannerData.entries[r].id]){c[this.plannerData.entries[r].id]="+"}else{e=true;break}}}if(!e&&c){for(r in c){if(c.hasOwnProperty(r)&&c[r]!=="+"){e=true;break}}}}if(!e&&this.oEvent.RRULE.FREQ!=this.RepeatSelect.value)e=true;if(!e&&this.oEvent.RRULE.INTERVAL!=this.RepeatCount.value)e=true;if(!e&&this.oEvent.RRULE.FREQ=="WEEKLY"&&this.oEvent.RRULE.BYDAY){var l=[];for(r in this.oEvent.RRULE.BYDAY){if(this.oEvent.RRULE.BYDAY.hasOwnProperty(r)){l.push(this.oEvent.RRULE.BYDAY[r])}}if(l.join(",")!=BX("event-rrule-byday"+this.id).value)e=true}return e},InitDestinationControls:function(){BX.addCustomEvent("OnDestinationAddNewItem",BX.proxy(this.CheckPlannerState,this));BX.addCustomEvent("OnDestinationUnselect",BX.proxy(this.CheckPlannerState,this));BX.addCustomEvent("OnSetTab",BX.proxy(this.OnPlannerTabShow,this));this.pMeetingParams=BX("event-grid-meeting-params"+this.id);this.pDestValuesCont=BX("event-grid-dest-item");this.pPlannerCont=BX("event-grid-planner-cont"+this.id);this.plannerId=this.id+"_Planner";BX.addCustomEvent("OnCalendarPlannerSelectorChanged",BX.proxy(this.OnCalendarPlannerSelectorChanged,this));BX.addCustomEvent("OnCalendarPlannerScaleChanged",BX.proxy(this.OnCalendarPlannerScaleChanged,this));BX.bind(this.pDestValuesCont,"click",function(e){var t=e.target||e.srcElement;if(t.className=="feed-event-del-but"){BX.SocNetLogDestination.deleteItem(t.getAttribute("data-item-id"),t.getAttribute("data-item-type"),editEventDestinationFormName);BX.PreventDefault(e)}});BX.bind(this.pDestValuesCont,"mouseover",function(e){var t=e.target||e.srcElement;if(t.className=="feed-event-del-but")BX.addClass(t.parentNode,"event-grid-dest-hover")});BX.bind(this.pDestValuesCont,"mouseout",function(e){var t=e.target||e.srcElement;if(t.className=="feed-event-del-but")BX.removeClass(t.parentNode,"event-grid-dest-hover")});if(this.oEvent.IS_MEETING){this.pMeetingParams.style.display="block"}this.AddMeetTextLink=BX(this.id+"_add_meet_text");this.HideMeetTextLink=BX(this.id+"_hide_meet_text");this.MeetTextCont=BX(this.id+"_meet_text_cont");this.MeetText=BX(this.id+"_meeting_text");this.OpenMeeting=BX(this.id+"_ed_open_meeting");this.NotifyStatus=BX(this.id+"_ed_notify_status");this.Reinvite=BX(this.id+"_ed_reivite");this.ReinviteCont=BX(this.id+"_ed_reivite_cont");if(this.oEvent.IS_MEETING){this.OpenMeeting.checked=!!(this.oEvent.MEETING&&this.oEvent.MEETING.OPEN);this.NotifyStatus.checked=!!(this.oEvent.MEETING&&this.oEvent.MEETING.NOTIFY);this.Reinvite.checked=this.oEvent.MEETING.REINVITE===true}this.AddMeetTextLink.parentNode.style.display="none"},OnCalendarPlannerSelectorChanged:function(e){this.pFromDate.value=this.oEC.FormatDate(e.dateFrom);this.pFromTime.value=this.oEC.FormatTime(e.dateFrom);this.pToDate.value=this.oEC.FormatDate(e.dateTo);this.pToTime.value=this.oEC.FormatTime(e.dateTo);this.pFullDay.checked=!!e.fullDay;this.FullDay(false,!e.fullDay)},OnCalendarPlannerScaleChanged:function(e){this.UpdatePlanner({entrieIds:e.entrieIds,entries:e.entries,from:e.from,to:e.to,location:this.Loc&&this.Loc.NEW?this.Loc.NEW:"",roomEventId:this.Loc&&this.Loc.OLD_mrevid?parseInt(this.Loc.OLD_mrevid):"",focusSelector:e.focusSelector===true})},DestroyDestinationControls:function(){BX.removeCustomEvent("OnDestinationAddNewItem",BX.proxy(this.CheckPlannerState,this));BX.removeCustomEvent("OnDestinationUnselect",BX.proxy(this.CheckPlannerState,this));BX.removeCustomEvent("OnCalendarPlannerSelectorChanged",BX.proxy(this.OnCalendarPlannerSelectorChanged,this));BX.removeCustomEvent("OnCalendarPlannerScaleChanged",BX.proxy(this.OnCalendarPlannerScaleChanged,this));BX.removeCustomEvent("OnSetTab",BX.proxy(this.OnPlannerTabShow,this));BX.onCustomEvent("OnCalendarPlannerDoUninstall",[{plannerId:this.plannerId}])},OnPlannerTabShow:function(e,t){if(t&&e.tab==BX(this.id+"ed-tab-2")){var i="",n=this.oEC.ParseLocation(this.Loc.NEW,true);if(n.mrid)i=this.Loc.NEW;if(this.plannerLoadedTimezone!==this.pFromTz.value||this.plannerLoadedlocation!==i){this.CheckPlannerState()}else{this.RefreshPlannerState()}}},CheckPlannerState:function(){var e,t={codes:[]},i=this.oEC.ParseDate(BX.util.trim(this.pFromDate.value)),n=this.oEC.ParseDate(BX.util.trim(this.pToDate.value)),s=this.pDestValuesCont.getElementsByTagName("INPUT"),o=this.oEC.ParseLocation(this.Loc.NEW,true),a=o.mrind==undefined?false:o.mrind;for(e=0;e<s.length;e++){t.codes.push(s[e].value)}if(o.mrid)t.location=this.Loc.NEW;t.locationMrind=a;if(this.Loc&&this.Loc.OLD_mrevid)t.roomEventId=this.Loc.OLD_mrevid;if(i&&n&&i.getTime&&n.getTime&&i.getTime()<=n.getTime()&&(t.location||t.codes.length>0)){t.from=BX.date.format(this.oEC.DATE_FORMAT,(i.getTime()-this.oEC.dayLength*3)/1e3);t.to=BX.date.format(this.oEC.DATE_FORMAT,(n.getTime()+this.oEC.dayLength*10)/1e3);this.UpdatePlanner(t)}else if(this.pPlannerCont&&BX.hasClass(this.pPlannerCont,"event-grid-planner-cont-shown")){this.HidePlanner()}},UpdatePlanner:function(e){if(!e)e={};this.plannerLoadedTimezone=e.tzFrom||this.pFromTz.value;this.plannerLoadedlocation=e.location||"";var t=this,i=e.eventId||this.oEvent.ID||0,n=!i||!this.oEvent||!this.oEvent.IS_MEETING;this.oEC.Request({getData:this.oEC.GetReqData("update_planner",{codes:e.codes||[],cur_event_id:i,date_from:e.dateFrom||e.from||"",date_to:e.dateTo||e.to||"",timezone:this.plannerLoadedTimezone,location:this.plannerLoadedlocation,roomEventId:e.roomEventId||"",entries:e.entrieIds||false,add_cur_user_to_list:n?"Y":"N"}),handler:function(i){var n=!!(e.entries||i.entries&&i.entries.length>0),s=BX.hasClass(t.pPlannerCont,"event-grid-planner-cont-shown");if(n){var o={show:n&&!s};if(e.entries){i.entries=e.entries;o.scaleFrom=e.from;o.scaleTo=e.to}o.loadedDataFrom=e.from;o.loadedDataTo=e.to;o.data={entries:i.entries,accessibility:i.accessibility};o.focusSelector=e.focusSelector==undefined?false:e.focusSelector;t.ShowPlannerAnimation();t.RefreshPlannerState(o)}else if(!n&&s){t.HidePlanner()}}})},RefreshPlannerState:function(e){if(!e||typeof e!=="object")e={};this.plannerData=e.data;var t,i,n=this.pFullDay.checked,s={},o,a,r,c,h=this.pPlannerCont&&BX.hasClass(this.pPlannerCont,"event-grid-planner-cont-shown");if(e.focusSelector==undefined)e.focusSelector=true;if(n){t=this.oEC.ParseDate(BX.util.trim(this.pFromDate.value));i=this.oEC.ParseDate(BX.util.trim(this.pToDate.value))||t}else{t=this.oEC.ParseDate(BX.util.trim(this.pFromDate.value)+" "+BX.util.trim(this.pFromTime.value));if(this.pToDate.value=="")this.pToDate.value=this.pFromDate.value;i=this.oEC.ParseDate(BX.util.trim(this.pToDate.value)+" "+BX.util.trim(this.pToTime.value))}if(t&&i&&t.getTime&&i.getTime&&t.getTime()<=i.getTime()){if(!h&&!e.data){this.CheckPlannerState()}else{if(e.show){BX.addClass(this.pPlannerCont,"event-grid-planner-cont-shown");this.pMeetingParams.style.display="block";a=this.pPlannerCont.offsetWidth-8;if(!h&&e.show){e.focusSelector=true}}if(n){r=new Date(t.getTime());r=e.scaleFrom||new Date(r.getTime()-this.oEC.dayLength*3);c=e.scaleTo||new Date(r.getTime()+this.oEC.dayLength*10);s.scaleType="1day";s.scaleDateFrom=r;s.scaleDateTo=c;s.adjustCellWidth=false}else{s.changeFromFullDay={scaleType:"1hour",timelineCellWidth:40};s.shownScaleTimeFrom=parseInt(this.config.workTimeStart);s.shownScaleTimeTo=parseInt(this.config.workTimeEnd)}s.entriesListWidth=170;s.width=a;var l=false;if(this.RepeatCheck.checked){l={FREQ:this.RepeatSelect.value,INTERVAL:this.RepeatCount.value,UNTIL:this.RepeatDiapTo.value};if(l.UNTIL==EC_MESS.NoLimits)l.UNTIL="";if(l.FREQ=="WEEKLY"){l.WEEK_DAYS=[];for(o=0;o<7;o++){if(this.RepeatWeekDaysCh[o].checked){l.WEEK_DAYS.push(this.RepeatWeekDaysCh[o].value)}}if(!l.WEEK_DAYS.length){l=false}}}BX.onCustomEvent("OnCalendarPlannerDoUpdate",[{plannerId:this.plannerId,config:s,focusSelector:e.focusSelector,selector:{from:t,to:i,fullDay:!!this.pFullDay.checked,RRULE:l,animation:true,updateScaleLimits:true},data:e.data||false,loadedDataFrom:e.loadedDataFrom,loadedDataTo:e.loadedDataTo,show:!!e.show}])}}else if(h){this.HidePlanner()}},HidePlanner:function(){var e=this;this.pPlannerCont.style.opacity=1;this.pPlannerCont.style.display="";this.pPlannerCont.style.height=this.pPlannerCont.offsetHeight+"px";this.pPlannerCont.style.overflow="hidden";BX.onCustomEvent("OnCalendarPlannerDoUpdate",[{plannerId:this.plannerId,hide:true}]);this.pMeetingParams.style.display="none";new BX.easing({duration:600,start:{opacity:100,height:parseInt(this.pPlannerCont.offsetHeight),padding:14},finish:{opacity:0,height:0,padding:0},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:function(t){e.pPlannerCont.style.opacity=t.opacity/100;e.pPlannerCont.style.height=t.height+"px"},complete:function(){e.pPlannerCont.removeAttribute("style");BX.removeClass(e.pPlannerCont,"event-grid-planner-cont-shown")}}).animate()},ShowPlannerAnimation:function(){var e=this;this.pPlannerCont.style.opacity=0;this.pPlannerCont.style.display="";new BX.easing({duration:300,start:{opacity:0},finish:{opacity:100},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:function(t){e.pPlannerCont.style.opacity=t.opacity/100},complete:function(){e.pPlannerCont.removeAttribute("style")}}).animate()},InitDateTimeControls:function(){this.pFromToCont=BX("feed-cal-from-to-cont"+this.id);this.pFromDate=BX("feed-cal-event-from"+this.id);this.pToDate=BX("feed-cal-event-to"+this.id);this.pFromTime=BX("feed_cal_event_from_time"+this.id);this.pToTime=BX("feed_cal_event_to_time"+this.id);this.pFullDay=BX("event-full-day"+this.id);this.pDefTimezone=BX("event-tz-def"+this.id);this.pDefTimezoneWrap=BX("event-tz-def-wrap"+this.id);this.pDefTimezone.onchange=BX.proxy(this.DefaultTimezoneOnChange,this);this.pFromTz=BX("event-tz-from"+this.id);this.pToTz=BX("event-tz-to"+this.id);this.pTzOuterCont=BX("event-tz-cont-outer"+this.id);this.pTzSwitch=BX("event-tz-switch"+this.id);this.pTzCont=BX("event-tz-cont"+this.id);this.pTzInnerCont=BX("event-tz-inner-cont"+this.id);this.pTzSwitch.onclick=BX.proxy(this.TimezoneSwitch,this);this.pFromTz.onchange=BX.proxy(this.TimezoneFromOnChange,this);this.pToTz.onchange=BX.proxy(this.TimezoneToOnChange,this);new BX.CHint({parent:BX("event-tz-tip"+this.id),hint:EC_MESS.eventTzHint});new BX.CHint({parent:BX("event-tz-def-tip"+this.id),hint:EC_MESS.eventTzDefHint});this.pReminderCont=BX("feed-cal-reminder-cont"+this.id);this.pReminder=BX("event-reminder"+this.id);this.pRemType=BX("event_remind_type"+this.id);this.pRemCount=BX("event_remind_count"+this.id);this.pFullDay.onclick=BX.proxy(this.FullDay,this);this.pReminder.onclick=BX.proxy(this.Reminder,this);var t=this;this.pFromDate.onclick=function(){BX.calendar({node:this.parentNode,field:this,bTime:false})};this.pToDate.onclick=function(){BX.calendar({node:this.parentNode,field:this,bTime:false})};this.pFromDate.onchange=function(){if(t._FromDateValue){var e=BX.parseDate(t._FromDateValue),i=BX.parseDate(t.pFromDate.value),n=BX.parseDate(t.pToDate.value);if(i&&e){var s=n.getTime()-e.getTime();if(s<0)s=0;n=new Date(i.getTime()+s);if(n)t.pToDate.value=bxFormatDate(n.getDate(),n.getMonth()+1,n.getFullYear())}}t._FromDateValue=t.pFromDate.value};this.pFromTime.parentNode.onclick=this.pFromTime.onclick=e["bxShowClock_"+"feed_cal_event_from_time"+t.id];this.pToTime.parentNode.onclick=this.pToTime.onclick=e["bxShowClock_"+"feed_cal_event_to_time"+t.id];this.pFromTime.onchange=function(){var e=t.oEC.ParseDate(BX.util.trim(t.pFromDate.value)+" "+BX.util.trim(t.pFromTime.value));if(t.pToDate.value=="")t.pToDate.value=t.pFromDate.value;var i=t.oEC.ParseDate(BX.util.trim(t.pToDate.value)+" "+BX.util.trim(t.pToTime.value));if(t._FromTimeValue){var n=t.oEC.ParseDate(BX.util.trim(t.pFromDate.value)+" "+t._FromTimeValue);var s=i.getTime()-n.getTime();if(s<0)s=36e5;var o=new Date(e.getTime()+s);t.pToDate.value=t.oEC.FormatDate(o);t.pToTime.value=t.oEC.FormatTime(o)}t._FromTimeValue=t.pFromTime.value};var i,n;if(this.oEvent.ID){this.pFullDay.checked=this.bFullDay=this.oEvent.DT_SKIP_TIME=="Y";this.pFullDay.onclick();i=BX.parseDate(this.oEvent["~DATE_FROM"]||this.oEvent.DATE_FROM);n=BX.parseDate(this.oEvent["~DATE_TO"]||this.oEvent.DATE_TO);this.pFromDate.value=this.oEC.FormatDate(i);this.pToDate.value=this.oEC.FormatDate(n);if(this.oEvent.DT_SKIP_TIME!=="Y"){this.pFromTime.value=this.oEC.FormatTime(i);this.pToTime.value=this.oEC.FormatTime(n);this.pFromTz.value=this.oEvent.TZ_FROM||"";this.pToTz.value=this.oEvent.TZ_TO||"";if(this.oEvent.TZ_TO!==this.oEvent.TZ_FROM||this.oEvent.TZ_TO!==this.config.userTimezoneName||parseInt(this.oEvent["~USER_OFFSET_FROM"])>0||parseInt(this.oEvent["~USER_OFFSET_TO"])>0){this.pTzCont.style.height=this.pTzInnerCont.offsetHeight+"px";BX.addClass(this.pTzOuterCont,"bxec-timezone-outer-wrap-opened")}}if(this.oEvent.REMIND&&this.oEvent.REMIND.length>0){this.pReminder.checked=true;this.pRemType.value=this.oEvent.REMIND[0].type;this.pRemCount.value=this.oEvent.REMIND[0].count;this.Reminder(false,true)}else{this.pReminder.checked=false;this.pRemType.value="min";this.pRemCount.value="15";this.Reminder(false,false)}if(this.config.userTimezoneName){this.pDefTimezoneWrap.style.display="none"}else{this.pDefTimezoneWrap.style.display="";this.pDefTimezone.value=this.config.userTimezoneDefault||""}}else{i=this.oEC.GetUsableDateTime((new Date).getTime(),15);n=this.oEC.GetUsableDateTime(i.getTime()+36e5,15);this.pFromDate.value=this.oEC.FormatDate(i);this.pFromTime.value=this.oEC.FormatTime(i);this.pToDate.value=this.oEC.FormatDate(n);this.pToTime.value=this.oEC.FormatTime(n);if(this.config.userTimezoneName){this.pDefTimezoneWrap.style.display="none";this.pDefTimezone.value=this.config.userTimezoneName;this.pFromTz.value=this.pToTz.value=this.config.userTimezoneName}else{this.pDefTimezoneWrap.style.display="";this.pFromTz.value=this.pToTz.value=this.pDefTimezone.value=this.config.userTimezoneDefault||""}this.pFullDay.checked=false;this.FullDay(false,true);this.pReminder.checked=true;this.pRemType.value="min";this.pRemCount.value="15";this.Reminder(false,true)}this.linkFromToTz=this.pFromTz.value==this.pToTz.value;this.linkFromToDefaultTz=this.pFromTz.value==this.pToTz.value&&this.pFromTz.value==this.pDefTimezone.value;this._FromTimeValue=this.pFromTime.value;this._FromDateValue=this.pFromDate.value},FillFormFields:function(){var e=this;this.pName=BX(this.id+"_edit_ed_name");this.pName.value=this.oEvent.NAME||"";this.Title=this.config.Title;this.pName.onkeydown=this.pName.onchange=function(){if(this._titleTimeout)clearTimeout(this._titleTimeout);this._titleTimeout=setTimeout(function(){var t=BX.util.htmlspecialchars(e.pName.value);e.Title.innerHTML=(e.oEvent.ID?EC_MESS.EditEvent:EC_MESS.NewEvent)+(t!=""?": "+t:"")},20)};this.Location=new BXInputPopup({id:this.id+"loc_1",values:this.oEC.bUseMR?this.oEC.meetingRooms:false,input:BX(this.id+"_planner_location1"),defaultValue:EC_MESS.SelectMR,openTitle:EC_MESS.OpenMRPage,className:"calendar-inp calendar-inp-time",noMRclassName:"calendar-inp calendar-inp-time"});this.Loc={};BX.addCustomEvent(this.Location,"onInputPopupChanged",BX.proxy(this.LocationOnChange,this));if(this.oEvent.ID){var t=BX.util.htmlspecialcharsback(this.oEvent.LOCATION);this.Loc.OLD=t;this.Loc.NEW=t;var i=this.oEC.ParseLocation(t,true);if(i.mrid&&i.mrevid){this.Location.Set(i.mrind,"");this.Loc.OLD_mrid=i.mrid;this.Loc.OLD_mrevid=i.mrevid}else{this.Location.Set(false,t)}}else{this.Location.Set(false,"")}this.pAccessibility=BX(this.id+"_bxec_accessibility");if(this.pAccessibility)this.pAccessibility.value=this.oEvent.ACCESSIBILITY||"busy";this.pPrivate=BX(this.id+"_bxec_private");if(this.pPrivate)this.pPrivate.checked=this.oEvent.PRIVATE_EVENT||false;this.pImportance=BX(this.id+"_bxec_importance");if(this.pImportance)this.pImportance.value=this.oEvent.IMPORTANCE||"normal";this.pSectSelect=BX(this.id+"_edit_ed_calend_sel");var n=this.oEvent.SECT_ID||this.oEC.GetLastSection();if(!this.oEC.oSections[n]){n=this.oEC.arSections[0].ID;this.oEC.SaveLastSection(n)}this.oEC.BuildSectionSelect(this.pSectSelect,n);this.pSectSelect.onchange=function(){var t=this.value;if(e.oEC.oSections[t]){e.oEC.SaveLastSection(t);e.ColorControl.Set(e.oEC.oSections[t].COLOR,e.oEC.oSections[t].TEXT_COLOR)}};this.RepeatCheck=BX(this.id+"_edit_ed_rep_check");this.RepeatSelect=BX(this.id+"_edit_ed_rep_sel");this.RepeatCont=BX(this.id+"_edit_ed_rep_cont");this.RepeatPhrase1=BX(this.id+"_edit_ed_rep_phrase1");this.RepeatPhrase2=BX(this.id+"_edit_ed_rep_phrase2");this.RepeatWeekDays=BX(this.id+"_edit_ed_rep_week_days");this.RepeatCount=BX(this.id+"_edit_ed_rep_count");this.RepeatEndsOnNever=BX(this.id+"edit-ev-rep-endson-never");this.RepeatEndsOnCount=BX(this.id+"edit-ev-rep-endson-count");this.RepeatEndsOnUntil=BX(this.id+"edit-ev-rep-endson-until");this.RepeatDiapTo=BX(this.id+"edit-ev-rep-diap-to");this.RepeatCountInp=BX(this.id+"edit-ev-rep-endson-count-input");this.RepeatSelect.onchange=function(){e.RepeatSelectOnChange(this.value)};this.RepeatCount.onmousedown=function(){e.bEditEventDialogOver=true};this.RepeatCheck.onclick=function(){if(this.checked)BX.addClass(e.RepeatCont,"bxec-popup-row-repeat-show");else BX.removeClass(e.RepeatCont,"bxec-popup-row-repeat-show")};BX.bind(this.RepeatEndsOnNever,"change",BX.proxy(this.EndsOnChange,this));BX.bind(this.RepeatEndsOnCount,"change",BX.proxy(this.EndsOnChange,this));BX.bind(this.RepeatEndsOnUntil,"change",BX.proxy(this.EndsOnChange,this));BX.bind(this.RepeatDiapTo,"click",BX.proxy(function(){this.RepeatEndsOnUntil.checked="checked";BX.calendar({node:this.RepeatDiapTo,field:this.RepeatDiapTo,bTime:false});BX.focus(this.RepeatDiapTo);this.EndsOnChange()},this));BX.bind(this.RepeatCountInp,"click",BX.proxy(function(){this.RepeatEndsOnCount.checked="checked";BX.focus(this.RepeatCountInp);this.EndsOnChange()},this));if(this.oEC.Event.IsRecursive(this.oEvent)){this.RepeatCheck.checked=true;this.RepeatSelect.value=this.oEvent.RRULE.FREQ}else{this.RepeatCheck.checked=false}this.RepeatCheck.onclick();this.RepeatSelect.onchange();this.ColorControl=this.oEC.InitColorDialogControl("event",function(t,i){e.Color=t;e.TextColor=i});if(!this.oEvent.displayColor&&this.oEC.oSections[n])this.oEvent.displayColor=this.oEC.oSections[n].COLOR;if(!this.oEvent.displayTextColor&&this.oEC.oSections[n])this.oEvent.displayTextColor=this.oEC.oSections[n].TEXT_COLOR;if(this.oEvent.displayColor)this.ColorControl.Set(this.oEvent.displayColor,this.oEvent.displayTextColor);else if(this.oEC.oSections[n])this.ColorControl.Set(this.oEC.oSections[n].COLOR,this.oEC.oSections[n].TEXT_COLOR)},EndsOnChange:function(){if(this.RepeatEndsOnNever.checked){this.RepeatCountInp.value="";this.RepeatDiapTo.value=""}else if(this.RepeatEndsOnCount.checked){this.RepeatDiapTo.value="";if(!this.RepeatCountInp.value)this.RepeatCountInp.value=this.RepeatCountInp.placeholder;BX.focus(this.RepeatCountInp);this.RepeatCountInp.select()}else{this.RepeatCountInp.value="";BX.focus(this.RepeatDiapTo);this.RepeatDiapTo.select()}},LocationOnChange:function(e,t,i){this.Loc.NEW=t===false?i||"":"ECMR_"+this.oEC.meetingRooms[t].ID},RepeatSelectOnChange:function(e){var t,i,n;e=e.toUpperCase();if(e=="NONE"){}else{this.RepeatPhrase2.innerHTML=EC_MESS.DeDot;if(e=="WEEKLY"){this.RepeatPhrase1.innerHTML=EC_MESS.EveryF;this.RepeatPhrase2.innerHTML+=EC_MESS.WeekP;this.RepeatWeekDays.style.display=e=="WEEKLY"?"inline-block":"none";i={};if(!this.RepeatWeekDaysCh){this.RepeatWeekDaysCh=[];for(t=0;t<7;t++)this.RepeatWeekDaysCh[t]=BX(this.id+"bxec_week_day_"+t)}if(this.oEvent&&this.oEvent.ID&&this.oEvent.RRULE&&this.oEvent.RRULE.BYDAY){i=this.oEvent.RRULE.BYDAY}else{n=BX.parseDate(this.pFromDate.value);if(!n)n=bxGetDateFromTS(this.oEvent.DT_FROM_TS);if(n)i[this.oEC.GetWeekDayByInd(n.getDay())]=true}for(t=0;t<7;t++)this.RepeatWeekDaysCh[t].checked=!!i[this.RepeatWeekDaysCh[t].value]}else{if(e=="YEARLY")this.RepeatPhrase1.innerHTML=EC_MESS.EveryN;else this.RepeatPhrase1.innerHTML=EC_MESS.EveryM;if(e=="DAILY")this.RepeatPhrase2.innerHTML+=EC_MESS.DayP;else if(e=="MONTHLY")this.RepeatPhrase2.innerHTML+=EC_MESS.MonthP;else if(e=="YEARLY")this.RepeatPhrase2.innerHTML+=EC_MESS.YearP;this.RepeatWeekDays.style.display="none"}var s=this.oEvent&&this.oEC.Event.IsRecursive(this.oEvent);this.RepeatCount.value=!this.oEvent.ID||!s?1:this.oEvent.RRULE.INTERVAL;if(!this.oEvent.ID||!s){this.RepeatEndsOnNever.checked=true}else{if(this.oEvent.RRULE&&this.oEvent.RRULE.COUNT>0){this.RepeatCountInp.value=parseInt(this.oEvent.RRULE.COUNT);this.RepeatEndsOnCount.checked=true}else if(this.oEvent.RRULE&&this.oEvent.RRULE["~UNTIL"]){this.RepeatDiapTo.value=this.oEvent.RRULE["~UNTIL"];this.RepeatEndsOnUntil.checked=true}else{this.RepeatEndsOnNever.checked=true}this.EndsOnChange()}}},CustomizeHtmlEditor:function(e){if(e.toolbar.controls&&e.toolbar.controls.spoiler){BX.remove(e.toolbar.controls.spoiler.pCont)}},FullDay:function(e,t){if(t==undefined)t=!this.bFullDay;if(t&&this.pFromDate.value!==""&&this.pFromTime.value===""&&this.pToDate.value!==""&&this.pToTime.value===""){var i=BX.parseDate(this.pFromDate.value),n=BX.parseDate(this.pToDate.value),s=i.getTime()===n.getTime();if(i){i.setHours(12);i.setMinutes(0);this.pFromTime.value=this.oEC.FormatTime(i)}if(n){n.setHours(s?13:12);n.setMinutes(0);this.pToTime.value=this.oEC.FormatTime(n)}this.UpdateAccessibility()}if(t&&this.config.userTimezoneName&&(this.pFromTz.value==""||this.pToTz.value=="")){this.pFromTz.value=this.pToTz.value=this.pDefTimezone.value=this.config.userTimezoneName}if(t){BX.removeClass(this.pFromToCont,"feed-cal-full-day")}else{BX.addClass(this.pFromToCont,"feed-cal-full-day")}this.bFullDay=t},Reminder:function(e,t){if(t==undefined)t=!this.bReminder;this.pReminderCont.className=t?"bxec-reminder":"bxec-reminder-collapsed";this.bReminder=t},TimezoneSwitch:function(){if(this.pTzCont.offsetHeight>0){this.pTzCont.style.height=0;BX.removeClass(this.pTzOuterCont,"bxec-timezone-outer-wrap-opened")}else{this.pTzCont.style.height=this.pTzInnerCont.offsetHeight+"px";BX.addClass(this.pTzOuterCont,"bxec-timezone-outer-wrap-opened")}},DefaultTimezoneOnChange:function(){var e=this.pDefTimezone.value;BX.userOptions.save("calendar","timezone_name","timezone_name",e);if(this.linkFromToDefaultTz)this.pToTz.value=this.pFromTz.value=this.pDefTimezone.value},TimezoneFromOnChange:function(){if(this.linkFromToTz)this.pToTz.value=this.pFromTz.value;this.linkFromToDefaultTz=false},TimezoneToOnChange:function(){this.linkFromToTz=false;this.linkFromToDefaultTz=false},UpdateAccessibility:function(e){var t=this;if(e!==false){if(this.updateAccessibilityTimeout)this.updateAccessibilityTimeout=clearTimeout(this.updateAccessibilityTimeout);this.updateAccessibilityTimeout=setTimeout(function(){t.UpdateAccessibility(false)},500);return}},ParseDateFromTo:function(){var e=this.pFromDate.value,t=this.pToDate.value;if(!this.pFullDay.checked){e+=" "+this.pFromTime.value;t+=" "+this.pToTime.value}return{from:this.oEC.ParseDate(e),to:this.oEC.ParseDate(t)}}};e.ECDragDropControl=function(e){this.oEC=e.calendar;this.enabled=true};e.ECDragDropControl.prototype={Reset:function(){jsDD.Reset()},RegisterDay:function(e){if(!this.enabled)return;var t=this;jsDD.registerDest(e);e.onbxdestdragfinish=function(i,n,s){if(t.oDiv){var o=parseInt(t.oDiv.getAttribute("data-bx-event-ind")),a=new Date(t.oEC.activeDateDays[t.oEC.GetDayIndexByElement(e.parentNode)].getTime());if(!isNaN(o)&&t.oEC.arEvents[o])t.MoveEventToNewDate(t.oEC.arEvents[o],a,"day");BX.removeClass(e,"bxc-day-drag")}t.OnDragFinish();return true};e.onbxdestdraghover=function(i,n,s){if(t.oDiv)BX.addClass(e,"bxc-day-drag")};e.onbxdestdraghout=function(i,n,s){if(t.oDiv)BX.removeClass(e,"bxc-day-drag")}},RegisterTitleDay:function(e,t,i){if(!this.enabled)return;var n=this;jsDD.registerDest(e);jsDD.registerDest(t);e.onbxdestdragfinish=t.onbxdestdragfinish=function(s,o,a){if(n.oDiv){var r=parseInt(n.oDiv.getAttribute("data-bx-event-ind")),c=parseInt(e.getAttribute("data-bx-day-ind")),h=n.oEC.Tabs[i].arDays[c],l=new Date;l.setFullYear(h.year,h.month,h.date);if(!isNaN(r)&&n.oEC.arEvents[r])n.MoveEventToNewDate(n.oEC.arEvents[r],l,"day")}BX.removeClass(e,"bxc-day-drag");BX.removeClass(t,"bxc-day-drag");n.OnDragFinish();return true};e.onbxdestdraghover=t.onbxdestdraghover=function(i,n,s){BX.addClass(e,"bxc-day-drag");BX.addClass(t,"bxc-day-drag")};e.onbxdestdraghout=t.onbxdestdraghout=function(i,n,s){BX.removeClass(e,"bxc-day-drag");BX.removeClass(t,"bxc-day-drag")}},RegisterTimeline:function(e,t){if(!this.enabled)return;var i=this;jsDD.registerDest(e);e.onbxdestdragfinish=function(n,s,o){if(i.oDiv){var a=parseInt(i.oDiv.getAttribute("data-bx-event-ind"));if(isNaN(a)||!i.oEC.arEvents[a])return;var r=i.oEC.arEvents[a];if(n.getAttribute("data-bx-event-resizer")=="Y"){var c=parseInt(i.oDiv.getAttribute("data-bx-original-height"),10),h=i.oDiv.offsetHeight-c,l=parseInt((h-1)/40*3600);i.ResizeEventTimeline(r,l)}else{var d=i.oDiv.getAttribute("data-bx-day-index");if(d!=undefined&&t.arDays[d]){var p=t.arDays[d],u=parseInt(i.oDiv.style.top,10)-BX.pos(e).top+e.scrollTop,f=Math.max((u-1)/42*60,0);f=Math.round(f/10)*10;var E=parseInt(f/60,10),C=Math.max(f-E*60,0),m=new Date;m.setFullYear(p.year,p.month,p.date);m.setHours(E);m.setMinutes(C);m.setSeconds(0);if(i.oDiv.getAttribute("data-bx-title-event")){r.DT_SKIP_TIME="N";i.MoveEventToNewDate(r,m,"timeline",36e5)}else i.MoveEventToNewDate(r,m,"timeline")}}}i.OnDragFinish();return true};e.onbxdestdraghover=function(n,s,o){i.timeLineEventOver=true;i.PrepareTimelineDaysPos(e,t);BX.addClass(e,"bxec-timeline-div-drag")};e.onbxdestdraghout=function(t,n,s){i.ClearTimeline(e)};e.onbxdestdragstop=function(t,n,s){i.ClearTimeline(e)}},ClearTimeline:function(e){this.timeLineEventOver=false;BX.removeClass(e,"bxec-timeline-div-drag");jsDD.current_dest_index=false},GetTimelinePos:function(e){return e.__bxpos},PrepareTimelineDaysPos:function(e,t){this.timeLinePos=this.GetTimelinePos(e);var i=t.pTimelineTable.rows[0];var n,s,o;this.arDays=[];for(var s=1;s<i.cells.length;s++){n=i.cells[s];o=BX.pos(n);o._left=o.left-this.timeLinePos[0];o._right=o.right-this.timeLinePos[0];this.arDays.push(o)}if(!this.activeDayDrop){this.activeDayDrop=BX.create("DIV",{props:{className:"bxec-timeline-active-day-drag-selector"}});this.activeDayDrop.style.height=parseInt(t.pTimelineTable.offsetHeight,10)+"px"}if(this.activeDayDrop.parentNode!=e)e.appendChild(this.activeDayDrop);if(!this.timelineDragOverlay){this.timelineDragOverlay=BX.create("DIV",{props:{className:"bxec-timeline-drag-overlay"}});this.timelineDragOverlay.style.height=parseInt(t.pTimelineTable.offsetHeight,10)+"px"}if(this.timelineDragOverlay.parentNode!=e)e.appendChild(this.timelineDragOverlay)},CheckTimelineOverPos:function(e,t){if(this.timeLineEventOver){this.activeDayDrop.style.display="block";var i,n=this.arDays.length;for(i=0;i<n;i++){if(e>=this.arDays[i].left&&e<=this.arDays[i].right){this.activeDayDrop.style.left=this.arDays[i]._left-1+"px";this.activeDayDrop.style.width=this.arDays[i].width-1+"px";this.oDiv.style.width=this.arDays[i].width-5+"px";this.oDiv.style.left=this.arDays[i].left+1+"px";this.oDiv.style.top=t-10+"px";this.oDiv.setAttribute("data-bx-day-index",i);break}}}else{if(this.activeDayDrop)this.activeDayDrop.style.display="none"}},RegisterEvent:function(e,t,i){if(!this.enabled)return;

var n=t["~TYPE"]=="tasks"||!this.oEC.Event.CanDo(t,"edit");if(this.oEC.Event.IsMeeting(t)&&!this.oEC.Event.IsHost(t))n=true;if(t.PRIVATE_EVENT&&!this.oEC.Personal())n=true;var s=this;jsDD.registerObject(e);e.setAttribute("data-bx-title-event",true);e.onbxdragstart=function(){if(n){s.oDiv=null;document.body.style.cursor="default";s.ShowDenyNotice(e,t)}else{s.oDiv=e.cloneNode(true);s.oDiv.className="bxec-event bxec-event-drag";document.body.appendChild(s.oDiv);s.oDiv.style.top="-1000px";s.oDiv.style.left="-1000px";var i=s.oEC.MoreEventsWin;if(i){i.close();i.destroy();i=null}}};e.onbxdrag=function(e,t){if(s.oDiv){s.oDiv.style.left=e-20+"px";s.oDiv.style.top=t-10+"px";if(i=="week_title"){s.CheckTimelineOverPos(e,t)}}};e.onbxdragstop=function(e,t){if(s.oDiv){setTimeout(function(){if(s.oDiv&&s.oDiv.parentNode){s.oDiv.parentNode.removeChild(s.oDiv);s.oDiv=null}},100)}s.OnDragFinish()};e.onbxdragfinish=function(e,t,i){s.OnDragFinish();return true}},RegisterTimelineEvent:function(e,t,i){if(!this.enabled)return;var n=t["~TYPE"]=="tasks"||!this.oEC.Event.CanDo(t,"edit");if(this.oEC.Event.IsMeeting(t)&&!this.oEC.Event.IsHost(t))n=true;if(t.PRIVATE_EVENT&&!this.oEC.Personal())n=true;var s=this;jsDD.registerObject(e);e.onbxdragstart=function(){if(n){s.oDiv=null;document.body.style.cursor="default";s.ShowDenyNotice(e,t)}else{s.oDiv=e.cloneNode(true);s.oDiv.className="bxec-tl-event bxec-event-drag";document.body.appendChild(s.oDiv);s.oDiv.style.top="-1000px";s.oDiv.style.left="-1000px"}};e.onbxdrag=function(e,t){if(!s.oDiv)return;if(s.timeLineEventOver){var i,n=s.arDays.length;for(i=0;i<n;i++){if(e>=s.arDays[i].left&&e<=s.arDays[i].right){s.oDiv.style.width=s.arDays[i].width-15+"px";s.oDiv.style.left=s.arDays[i].left+1+"px";s.oDiv.style.top=t-10+"px";s.oDiv.setAttribute("data-bx-day-index",i);break}}}};e.onbxdragstop=function(e,t){s.OnDragFinish();if(!s.oDiv)return;setTimeout(function(){if(s.oDiv&&s.oDiv.parentNode){s.oDiv.parentNode.removeChild(s.oDiv);s.oDiv=null}},100)};e.onbxdragfinish=function(e,t,i){s.OnDragFinish()}},RegisterTimelineEventResizer:function(t,i,n,s){if(!this.enabled)return;var o=n["~TYPE"]=="tasks"||!this.oEC.Event.CanDo(n,"edit");t.setAttribute("data-bx-event-resizer","Y");BX.bind(t,"mousedown",function(t){var n=BX.GetWindowSize();t=t||e.event;a.timelineResize={oDiv:i,startY:t.clientY+n.scrollTop,height:parseInt(i.offsetHeight)}});var a=this;jsDD.registerObject(t);t.onbxdragstart=function(){if(o){a.oDiv=null;document.body.style.cursor="default";a.ShowDenyNotice(t,n);return}document.body.style.cursor="s-resize";a.oDiv=i;BX.removeClass(a.oDiv,"bxec-tl-ev-hlt")};t.onbxdrag=function(e,t){if(a.oDiv&&a.timeLineEventOver){var i=a.timelineResize.height+t-a.timelineResize.startY+5;if(i<=0)i=5;a.timelineResize.oDiv.style.height=i+"px"}};t.onbxdragstop=function(e,t){a.OnDragFinish();if(!a.oDiv)return};t.onbxdragfinish=function(e,t,i){a.OnDragFinish()}},ResizeEventTimeline:function(e,t){var i=[],n=this;e.DT_LENGTH=Math.max(parseInt(e.DT_LENGTH,10)+t,0);e.DT_LENGTH=Math.round(e.DT_LENGTH/600)*600;e.dateTo.setTime(e.dateFrom.getTime()+e.DT_LENGTH*1e3);e.DATE_TO=this.oEC.FormatDateTime(e.dateTo);if(this.oEC.Event.IsMeeting(e)){e["~ATTENDEES"].forEach(function(e){i.push(e["USER_ID"])})}var s=e.TZ_FROM!=this.oEC.arConfig.userTimezoneName||e.TZ_TO!=this.oEC.arConfig.userTimezoneName;this.oEC.Request({postData:this.oEC.GetReqData("move_event_to_date",{id:e.ID,current_date_from:e.DATE_FROM,recursive:this.oEC.Event.IsRecursive(e)?"Y":"N",is_meeting:this.oEC.Event.IsMeeting(e)?"Y":"N",attendees:i,date_from:e.DATE_FROM,date_to:e.DATE_TO,section:e.SECT_ID,skip_time:e.DT_SKIP_TIME,timezone:s?this.oEC.arConfig.userTimezoneName:e.TZ_FROM,set_timezone:s?"Y":"N"}),errorText:EC_MESS.EventSaveError,handler:function(t){if(t.reload||n.oEC.Event.IsRecursive(e))n.oEC.Event.ReloadAll(false);return true}});this.oEC.Event.PreHandle(e);this.oEC.Event.Display()},MoveEventToNewDate:function(e,t,i,n){var s=[],o=this,a=864e5,r;if(i=="day"&&e.DT_SKIP_TIME=="N"){t.setHours(e.dateFrom.getHours()||0);t.setMinutes(e.dateFrom.getMinutes()||0)}if(n){r=new Date(t.getTime()+n)}else if(e.DT_SKIP_TIME=="N"){r=new Date(t.getTime()+e.DT_LENGTH*1e3)}else if(e.DT_SKIP_TIME=="Y"){r=new Date(t.getTime()+e.DT_LENGTH*1e3-a)}var c=e.DATE_FROM;e.DATE_FROM=e.DT_SKIP_TIME=="Y"?this.oEC.FormatDate(t):this.oEC.FormatDateTime(t);e.DATE_TO=e.DT_SKIP_TIME=="Y"?this.oEC.FormatDate(r):this.oEC.FormatDateTime(r);if(this.oEC.Event.IsMeeting(e)){e["~ATTENDEES"].forEach(function(e){s.push(e["USER_ID"])})}var h=e.TZ_FROM!=this.oEC.arConfig.userTimezoneName||e.TZ_TO!=this.oEC.arConfig.userTimezoneName;this.oEC.Request({postData:this.oEC.GetReqData("move_event_to_date",{id:e.ID,current_date_from:c,recursive:this.oEC.Event.IsRecursive(e)?"Y":"N",is_meeting:this.oEC.Event.IsMeeting(e)?"Y":"N",attendees:s,date_from:e.DATE_FROM,date_to:e.DATE_TO,section:e.SECT_ID,skip_time:e.DT_SKIP_TIME,timezone:h?this.oEC.arConfig.userTimezoneName:e.TZ_FROM,set_timezone:h?"Y":"N"}),errorText:EC_MESS.EventSaveError,handler:function(t){if(t.reload||o.oEC.Event.IsRecursive(e))o.oEC.Event.ReloadAll(false);if(o.oEC.Event.IsMeeting(e)&&t.busy_warning){alert(EC_MESS.EC_BUSY_ALERT)}return true}});if(e.DT_SKIP_TIME=="N"){e["~USER_OFFSET_FROM"]=0;e["~USER_OFFSET_TO"]=0;e.TZ_FROM=e.TZ_TO=this.oEC.arConfig.userTimezoneName}if(n!=undefined)e.DT_LENGTH=parseInt(n,10)/1e3;this.oEC.Event.PreHandle(e);this.oEC.Event.Display()},ShowDenyNotice:function(e,t){if(!this.pNotice)this.pNotice=document.body.appendChild(BX.create("DIV",{props:{className:"bxec-event-drag-deny-notice"}}));if(this.bNoticeShown)this.HideDenyNotice();if(t["~TYPE"]=="tasks")this.pNotice.innerHTML=EC_MESS.ddDenyTask;else this.pNotice.innerHTML=EC_MESS.ddDenyEvent;var i=BX.align(e,250,50,"top");this.pNotice.style.left=i.left+"px";this.pNotice.style.top=i.top+"px";this.pNotice.style.display="block";this.bNoticeShown=true;BX.bind(document,"mouseup",BX.proxy(this.HideDenyNotice,this))},HideDenyNotice:function(){if(this.bNoticeShown){this.bNoticeShown=false;if(this.pNotice)this.pNotice.style.display="none";BX.unbind(document,"mouseup",BX.proxy(this.HideDenyNotice,this))}},OnDragFinish:function(){},IsDragDropNow:function(){return jsDD.bStarted}}})(window);
/* End */
;
//# sourceMappingURL=kernel_calendar.map.js