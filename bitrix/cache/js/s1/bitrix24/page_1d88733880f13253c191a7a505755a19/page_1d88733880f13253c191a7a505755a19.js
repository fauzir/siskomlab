
; /* Start:"a:4:{s:4:"full";s:97:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/script.min.js?151131647237595";s:6:"source";s:77:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/script.js";s:3:"min";s:81:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/script.min.js";s:3:"map";s:81:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/script.map.js";}"*/
BX.namespace("BX.Main");if(typeof BX.Main.interfaceButtons==="undefined"){BX.Main.interfaceButtons=function(t,e){this.classItem="main-buttons-item";this.classItemSublink="main-buttons-item-sublink";this.classItemText="main-buttons-item-text";this.classItemCounter="main-buttons-item-counter";this.classItemIcon="main-buttons-item-icon";this.classItemMore="main-buttons-item-more";this.classOnDrag="main-buttons-drag";this.classDropzone="main-buttons-submenu-dropzone";this.classSeporator="main-buttons-submenu-separator";this.classHiddenLabel="main-buttons-hidden-label";this.classSubmenuItem="main-buttons-submenu-item";this.classItemDisabled="main-buttons-disabled";this.classItemOver="over";this.classItemActive="main-buttons-item-active";this.classSubmenu="main-buttons-submenu";this.classSecret="secret";this.classItemLocked="locked";this.submenuIdPrefix="main_buttons_popup_";this.submenuWindowIdPrefix="menu-popup-";this.classSettingMenuItem="main-buttons-submenu-setting";this.classEditState="main-buttons-edit";this.classEditItemButton="main-buttons-item-edit-button";this.classDragItemButton="main-buttons-item-drag-button";this.classSettingsApplyButton="main-buttons-submenu-settings-apply";this.classSettingsResetButton="main-buttons-submenu-settings-reset";this.classSetHome="main-buttons-set-home";this.classSetHide="main-buttons-set-hide";this.classManage="main-buttons-manage";this.classContainer="main-buttons";this.classSubmenuNoHiddenItem="main-buttons-submenu-item-no-hidden";this.classDefaultSubmenuItem="menu-popup-item";this.classInner="main-buttons-inner-container";this.listContainer=null;this.pinContainer=null;this.dragItem=null;this.overItem=null;this.moreButton=null;this.messages=null;this.licenseParams=null;this.isSubmenuShown=false;this.isSubmenuShownOnDragStart=false;this.isSettingsEnabled=true;this.containerId=e.containerId;this.tmp={};this.init(t,e);return{getItemById:BX.delegate(this.getItemById,this),getAllItems:BX.delegate(this.getAllItems,this),getHiddenItems:BX.delegate(this.getHiddenItems,this),getVisibleItems:BX.delegate(this.getVisibleItems,this),getDisabledItems:BX.delegate(this.getDisabledItems,this),getMoreButton:BX.delegate(this.getMoreButton,this),adjustMoreButtonPosition:BX.delegate(this.adjustMoreButtonPosition,this),showSubmenu:BX.delegate(this.showSubmenu,this),closeSubmenu:BX.delegate(this.closeSubmenu,this),refreshSubmenu:BX.delegate(this.refreshSubmenu,this),getCurrentSettings:BX.delegate(this.getCurrentSettings,this),saveSettings:BX.delegate(this.saveSettings,this),setCounterValueByItemId:BX.delegate(this.setCounterValueByItemId,this),getCounterValueByItemId:BX.delegate(this.getCounterValueByItemId,this),updateCounter:BX.delegate(this.updateCounter,this),getActive:BX.delegate(this.getActive,this),isEditEnabled:BX.delegate(this.isEditEnabled,this),isActiveInMoreMenu:BX.delegate(this.isActiveInMoreMenu,this),isSettingsEnabled:this.isSettingsEnabled,classes:{item:this.classItem,itemText:this.classItemText,itemCounter:this.classItemCounter,itemIcon:this.classItemIcon,itemDisabled:this.classItemDisabled,itemOver:this.classItemOver,itemActive:this.classItemActive,itemLocked:this.classItemLocked,submenu:this.classSubmenu,submenuItem:this.classSubmenuItem,containerOnDrag:this.classOnDrag,classSettingMenuItem:this.classSettingMenuItem},itemsContainer:this.listContainer,itemsContainerId:this.listContainer.id}};BX.Main.interfaceButtons.prototype={init:function(t,e){this.listContainer=BX(this.getId());if(!BX.type.isPlainObject(e)){throw"BX.MainButtons: params is not Object"}if(!("containerId"in e)||!BX.type.isNotEmptyString(e.containerId)){throw"BX.MainButtons: containerId not set in params"}if(!BX.type.isDomNode(this.listContainer)){throw"BX.MainButtons: #"+e.containerId+" is not dom node"}if("classes"in e&&BX.type.isPlainObject(e.classes)){this.setCustomClasses(e.classes)}if("messages"in e&&BX.type.isPlainObject(e.messages)){this.setMessages(e.messages)}if("licenseWindow"in e&&BX.type.isPlainObject(e.licenseWindow)){this.setLicenseWindowParams(e.licenseWindow)}if("disableSettings"in e&&e.disableSettings==="true"){this.isSettingsEnabled=false;this.visibleControlMoreButton()}this.moreButton=this.getMoreButton();if(this.isSettingsEnabled){this.dragAndDropInit()}this.adjustMoreButtonPosition();this.bindOnClickOnMoreButton();this.bindOnScrollWindow();this.setContainerHeight();BX.bind(this.getContainer(),"click",BX.delegate(this._onDocumentClick,this));BX.addCustomEvent("onPullEvent-main",BX.delegate(this._onPush,this));this.updateMoreButtonCounter();if(this.isActiveInMoreMenu()){this.activateItem(this.moreButton)}var s=this.getVisibleItems();var i=BX.type.isArray(s)&&s.length>0?s[0]:null;var n=BX.Buttons.Utils.getByTag(i,"a");if(!BX.type.isDomNode(n)){return}var a=n.getAttribute("href");if(a.charAt(0)==="?"){a=n.pathname+n.search}if(!this.lastHomeLink){this.lastHomeLink=a}this.bindOnResizeFrame()},_onDocumentClick:function(t){var e=this.getItem(t);var s,i,n,a,o,u;if(this.isDragButton(t.target)){t.preventDefault();t.stopPropagation()}if(BX.type.isDomNode(e)){if(!this.isSublink(t.target)){s=this.dataValue(e,"onclick");if(BX.type.isNotEmptyString(s)){t.preventDefault();this.execScript(s)}}if(this.isSettings(e)){this.enableEdit();BX.hide(this.getSettingsButton());BX.show(this.getSettingsApplyButton())}if(this.isApplySettingsButton(e)){t.preventDefault();t.stopPropagation();this.disableEdit();BX.show(this.getSettingsButton());BX.hide(this.getSettingsApplyButton())}if(this.isResetSettingsButton(e)){this.resetSettings()}if(this.isLocked(e)){t.preventDefault();this.showLicenseWindow()}if(this.isEditButton(t.target)){var r,h;t.preventDefault();t.stopPropagation();if(this.isSubmenuItem(e)){e=this.getItemAlias(e)}try{r=JSON.parse(BX.data(e,"item"))}catch(l){}h=this.getItemEditMenu();if(h&&h.popupWindow.isShown()&&this.lastEditNode===e){h.popupWindow.close()}else{this.showItemEditMenu(r,t.target)}this.lastEditNode=e}if(this.isSetHide(e)){o=this.getVisibleItems();u=BX.type.isArray(o)?o.length:null;a=this.editItemData.ID.replace(this.listContainer.id+"_","");i=this.getItemById(a);n=this.getItemAlias(i);i=this.isVisibleItem(i)?i:n;if(this.isDisabled(n)){this.enableItem(n)}else if(!this.isDisabled(n)&&u>2){this.disableItem(n)}if(u===2){BX.onCustomEvent(window,"BX.Main.InterfaceButtons:onHideLastVisibleItem",[i,this])}this.refreshSubmenu();this.saveSettings();this.adjustMoreButtonPosition();if(this.isEditEnabled()){this.enableEdit();BX.hide(this.getSettingsButton());BX.show(this.getSettingsApplyButton())}this.editMenu.popupWindow.close()}if(this.isSetHome(e)){a=this.editItemData.ID.replace(this.listContainer.id+"_","");i=this.getItemById(a);n=this.getItemAlias(i);if(this.isDisabled(n)){this.enableItem(n)}this.listContainer.insertBefore(i,BX.firstChild(this.listContainer));this.adjustMoreButtonPosition();this.refreshSubmenu();this.saveSettings();if(this.isEditEnabled()){this.enableEdit();BX.hide(this.getSettingsButton());BX.show(this.getSettingsApplyButton())}this.editMenu.popupWindow.close()}}if(this.isEditEnabled()){this.getSubmenu().popupWindow.setAutoHide(false)}},isActiveInMoreMenu:function(){var t=this.getHiddenItems();var e=this.getDisabledItems();var s=t.concat(e);return s.some(function(t){var e;try{e=JSON.parse(BX.data(t,"item"))}catch(s){}return BX.type.isPlainObject(e)&&("IS_ACTIVE"in e&&e.IS_ACTIVE===true||e.IS_ACTIVE==="true"||e.IS_ACTIVE==="Y")},this)},_onPush:function(t,e){if(t==="user_counter"&&e&&BX.message("SITE_ID")in e){var s=e[BX.message("SITE_ID")];for(var i in s){if(s.hasOwnProperty(i)){this.updateCounter(i,s[i])}}}},bindOnScrollWindow:function(){BX.bind(window,"scroll",BX.delegate(this._onScroll,this))},getActive:function(){var t=this.getAllItems();var e,s;var i=null;if(BX.type.isArray(t)){t.forEach(function(t){try{e=JSON.parse(BX.data(t,"item"))}catch(s){e=null}if(BX.type.isPlainObject(e)&&"IS_ACTIVE"in e&&(e.IS_ACTIVE===true||e.IS_ACTIVE==="true"||e.IS_ACTIVE==="Y")){i=e}},this)}if(BX.type.isPlainObject(i)){s=BX(i.ID);if(BX.type.isDomNode(s)){i.NODE=s}else{i.NODE=null}}return i},isSetHome:function(t){return BX.hasClass(t,this.classSetHome)},isSetHide:function(t){return BX.hasClass(t,this.classSetHide)},getSettingsButton:function(){return BX.Buttons.Utils.getByClass(this.getSubmenuContainer(),this.classSettingMenuItem)},getSettingsApplyButton:function(){return BX.Buttons.Utils.getByClass(this.getSubmenuContainer(),this.classSettingsApplyButton)},isApplySettingsButton:function(t){return BX.hasClass(t,this.classSettingsApplyButton)},enableEdit:function(){var t=this.getSubmenu();if(t&&"popupWindow"in t){t.popupWindow.setAutoHide(false)}BX.addClass(this.listContainer,this.classEditState);BX.addClass(this.getSubmenuContainer(),this.classEditState);this.isEditEnabledState=true},disableEdit:function(){var t=this.getSubmenu();if(t&&"popupWindow"in t){t.popupWindow.setAutoHide(true)}BX.removeClass(this.listContainer,this.classEditState);BX.removeClass(this.getSubmenuContainer(),this.classEditState);this.isEditEnabledState=false},isEditEnabled:function(){return this.isEditEnabledState},showItemEditMenu:function(t,e){if(BX.type.isPlainObject(t)&&"ID"in t){var s=[this.listContainer.id,"_edit_item"].join("");var i=BX.PopupMenu.getMenuById(s);if(i){BX.PopupMenu.destroy(s)}i=this.createItemEditMenu(t,s,e);i.popupWindow.show()}},getContainer:function(){if(!BX.type.isDomNode(this.container)){this.container=BX(this.containerId).parentNode}return this.container},getItemEditMenu:function(){return BX.PopupMenu.getMenuById([this.listContainer.id,"_edit_item"].join(""))},createItemEditMenu:function(t,e,s){var i;var n=[{text:this.message("MIB_SET_HOME"),className:"main-buttons-set-home menu-popup-no-icon"}];var a=t.ID.replace(this.listContainer.id+"_","");var o=this.getItemById(a);if(this.isDisabled(o)){n.push({text:this.message("MIB_SET_SHOW"),className:"main-buttons-set-hide menu-popup-no-icon"})}else{n.push({text:this.message("MIB_SET_HIDE"),className:"main-buttons-set-hide menu-popup-no-icon"})}var u=BX.pos(s);var r={menuId:e,anchor:s,menuItems:n,settings:{autoHide:true,offsetTop:0,offsetLeft:u.width/2,zIndex:20,angle:{position:"top",offset:u.width/2}}};i=BX.PopupMenu.create(r.menuId,r.anchor,r.menuItems,r.settings);if(this.isVisibleItem(o)){t.NODE=o}else{t.NODE=this.getItemAlias(o)}this.editItemData=t;if("menuItems"in i&&BX.type.isArray(i.menuItems)){i.menuItems.forEach(function(t){BX.bind(t.layout.item,"click",BX.delegate(this._onDocumentClick,this))},this)}BX.onCustomEvent(window,"BX.Main.InterfaceButtons:onBeforeCreateEditMenu",[i,t,this]);this.editMenu=i;return i},setHome:function(){var t=this.getVisibleItems();var e=BX.type.isArray(t)&&t.length>0?t[0]:null;var s=BX.Buttons.Utils.getByTag(e,"a");if(!BX.type.isDomNode(s)){return}var i=s.getAttribute("href");if(i.charAt(0)==="?"){i=s.pathname+s.search}if(!this.lastHomeLink){this.lastHomeLink=i}if(this.lastHomeLink!==i){BX.userOptions.save("ui",this.listContainer.id,"firstPageLink",i);BX.onCustomEvent("BX.Main.InterfaceButtons:onFirstItemChange",[i,e])}this.lastHomeLink=i},isEditButton:function(t){return BX.hasClass(t,this.classEditItemButton)},isDragButton:function(t){return BX.hasClass(t,this.classDragItemButton)},isResetSettingsButton:function(t){return BX.hasClass(t,this.classSettingsResetButton)},getContainerHeight:function(){var t=this.getAllItems().map(function(t){var e=getComputedStyle(t);return BX.height(t)+parseInt(e.marginTop)+parseInt(e.marginBottom)});return Math.max.apply(Math,t)},setContainerHeight:function(){var t=this.getContainerHeight();BX.height(this.listContainer,t)},setLicenseWindowParams:function(t){this.licenseParams=t||{}},message:function(t){var e;try{e=this.messages[t]}catch(s){e=""}return e},setCustomClasses:function(t){if(!BX.type.isPlainObject(t)){return}this.classItem=t.item||this.classItem;this.classItemSublink=t.itemSublink||this.classItemSublink;this.classItemText=t.itemText||this.classItemText;this.classItemCounter=t.itemCounter||this.classItemCounter;this.classItemIcon=t.itemIcon||this.classItemIcon;this.classItemMore=t.itemMore||this.classItemMore;this.classItemOver=t.itemOver||this.classItemOver;this.classItemActive=t.itemActive||this.classItemActive;this.classItemDisabled=t.itemDisabled||this.classItemDisabled;this.classOnDrag=t.onDrag||this.classOnDrag;this.classDropzone=t.dropzone||this.classDropzone;this.classSeporator=t.separator||this.classSeporator;this.classSubmenuItem=t.submenuItem||this.classSubmenuItem;this.classSubmenu=t.submenu||this.classSubmenu;this.classSecret=t.secret||this.classSecret;this.classItemLocked=t.itemLocked||this.classItemLocked},setMessages:function(t){if(!BX.type.isPlainObject(t)){return}this.messages=t},makeFullItemId:function(t){if(!BX.type.isNotEmptyString(t)){return}return[this.listContainer.id,t.replace("-","_")].join("_")},getItemById:function(t){var e=null;var s;if(BX.type.isNotEmptyString(t)){s=this.makeFullItemId(t);e=BX.Buttons.Utils.getBySelector(this.listContainer,"#"+s)}return e},getItemCounterObject:function(t){var e=null;if(BX.type.isDomNode(t)){e=BX.Buttons.Utils.getByClass(t,this.classItemCounter)}return e},setCounterValue:function(t,e){var s=this.getItemCounterObject(t);if(BX.type.isDomNode(s)){s.innerText=e>99?"99+":e>0?e:"";t.dataset.counter=e}this.updateMoreButtonCounter()},updateCounter:function(t,e){var s,i,n;var a=null;var o=this.getAllItems();if(BX.type.isArray(o)){o.forEach(function(e){try{i=JSON.parse(BX.data(e,"item"))}catch(s){i={}}if(BX.type.isPlainObject(i)&&"COUNTER_ID"in i&&i.COUNTER_ID===t){a=e}},this)}s=this.getItemCounterObject(a);if(BX.type.isDomNode(s)){a=this.getItem(s);s.innerText=e>99?"99+":e>0?e:"";a.dataset.counter=e}n=this.getItemAlias(a);if(BX.type.isDomNode(n)){s=this.getItemCounterObject(n);if(BX.type.isDomNode(s)){s.innerText=e>99?"99+":e>0?e:"";n.dataset.counter=e}}this.updateMoreButtonCounter()},setCounterValueByItemId:function(t,e){var s=e!==null?parseFloat(e):null;var i,n;if(!BX.type.isNotEmptyString(t)){throw"Bad first arg. Need string as item id"}if(s!==null&&!BX.type.isNumber(s)){throw"Bad two arg. Need number counter value - Integer, Float or string with number"}i=this.getItemById(t);if(!BX.type.isDomNode(i)){console.info("Not found node with id #"+t);return}n=this.getItemAlias(i);this.setCounterValue(i,s);this.setCounterValue(n,s)},getCounterValueByItemId:function(t){var e,s;var i=NaN;if(!BX.type.isNotEmptyString(t)){throw"Bad first arg. Need string item id"}else{e=this.getItemById(t);i=this.dataValue(e,"counter");i=parseFloat(i);if(!BX.type.isNumber(i)){s=this.getItemCounterObject(e);i=parseFloat(s.innerText)}}return i},setMoreButtonCounter:function(t){var e=this.getItemCounterObject(this.moreButton);var s=t>99?"99+":t>0?t:"";s=parseInt(s);s=BX.type.isNumber(s)?s:"";e.innerText=s},bindOnClickOnMoreButton:function(){BX.bind(this.moreButton,"click",BX.delegate(this._onClickMoreButton,this))},bindOnResizeFrame:function(){window.frames["maininterfacebuttonstmpframe-"+this.getId()].onresize=BX.throttle(this._onResizeHandler,20,this)},getId:function(){return BX.Buttons.Utils.getByClass(this.getContainer(),this.classInner).id},getAllItems:function(){return BX.Buttons.Utils.getByClass(this.listContainer,this.classItem,true)},getVisibleItems:function(){var t=this.getAllItems();var e=this;var s=[];if(t&&t.length){s=t.filter(function(t){return e.isVisibleItem(t)&&!e.isDisabled(t)})}return s},getHiddenItems:function(){var t=this.getAllItems();var e=[];var s=this;if(t&&t.length){e=t.filter(function(t){return!s.isVisibleItem(t)&&!s.isDisabled(t)})}return e},getDisabledItems:function(){return this.getAllItems().filter(function(t){return this.isDisabled(t)},this)},getMoreButton:function(){var t=null;this.getAllItems().forEach(function(e){!t&&BX.hasClass(e,this.classItemMore)&&(t=e)},this);return t},getLastVisibleItem:function(){var t=this.getVisibleItems();var e=null;if(BX.type.isArray(t)&&t.length){e=t[t.length-1]}if(!BX.type.isDomNode(e)){e=null}return e},adjustMoreButtonPosition:function(){var t=this.getLastVisibleItem();var e=this.isMoreButton(t);if(!e){this.listContainer.insertBefore(this.moreButton,t)}this.updateMoreButtonCounter()},getSubmenuId:function(t){var e="";if(BX.type.isDomNode(this.listContainer)&&BX.type.isNotEmptyString(this.listContainer.id)){e=this.submenuIdPrefix+this.listContainer.id}if(t){e=this.submenuWindowIdPrefix+e}return e},getSubmenuItemText:function(t){var e,s,i;if(!BX.type.isDomNode(t)){return null}e=this.findChildrenByClassName(t,this.classItemText);s=this.findChildrenByClassName(t,this.classItemCounter);if(BX.type.isDomNode(s)&&BX.type.isDomNode(e)){s.dataset.counter=this.dataValue(t,"counter");i=e.outerHTML+s.outerHTML}else{e=this.dataValue(t,"text");s=this.dataValue(t,"counter");i=e}return i},getLockedClass:function(t){var e="";if(BX.type.isDomNode(t)&&this.isLocked(t)){e=this.classItemLocked}return e},getSubmenuItems:function(){var t=this.getAllItems();var e=this.getHiddenItems();var s=this.getDisabledItems();var i=[];var n,a;if(t.length){t.forEach(function(t){if(e.indexOf(t)===-1&&s.indexOf(t)===-1){i.push({text:this.getSubmenuItemText(t),href:this.dataValue(t,"url"),title:t.getAttribute("title"),className:[this.classSubmenuItem,this.getIconClass(t),this.classSecret,this.getAliasLink(t),this.getLockedClass(t)].join(" ")})}},this)}if(e.length){e.forEach(function(t){try{n=JSON.parse(this.dataValue(t,"item"))}catch(e){n=null}a=[this.classSubmenuItem,this.getIconClass(t),this.getAliasLink(t),this.getLockedClass(t)];if(BX.type.isPlainObject(n)&&("IS_ACTIVE"in n&&n.IS_ACTIVE===true||n.IS_ACTIVE==="true"||n.IS_ACTIVE==="Y")){a.push(this.classItemActive)}i.push({text:this.getSubmenuItemText(t),href:this.dataValue(t,"url"),title:t.getAttribute("title"),className:a.join(" ")})},this)}if(this.isSettingsEnabled){i.push({text:"<span>"+this.message("MIB_HIDDEN")+"</span>",className:[this.classSeporator,this.classSubmenuItem,this.classHiddenLabel].join(" ")});if(!s.length){i.push({text:"<span>"+this.message("MIB_NO_HIDDEN")+"</span>",className:[this.classSubmenuItem,this.classSubmenuNoHiddenItem].join(" ")})}if(s.length){s.forEach(function(t){try{n=JSON.parse(this.dataValue(t,"item"))}catch(e){n=null}a=[this.classSubmenuItem,this.classItemDisabled,this.getIconClass(t),this.getAliasLink(t),this.getLockedClass(t)];if(BX.type.isPlainObject(n)&&("IS_ACTIVE"in n&&n.IS_ACTIVE===true||n.IS_ACTIVE==="true"||n.IS_ACTIVE==="Y")){a.push(this.classItemActive)}i.push({text:this.getSubmenuItemText(t),href:this.dataValue(t,"url"),title:t.getAttribute("title"),className:a.join(" ")})},this)}i.push({text:"<span>"+this.message("MIB_MANAGE")+"</span>",className:[this.classSeporator,this.classSubmenuItem,this.classHiddenLabel,this.classManage].join(" ")});i.push({text:this.message("MIB_SETTING_MENU_ITEM"),className:[this.classSettingMenuItem,this.classSubmenuItem].join(" ")});i.push({text:this.message("MIB_APPLY_SETTING_MENU_ITEM"),className:[this.classSettingsApplyButton,this.classSubmenuItem].join(" ")});i.push({text:this.message("MIB_RESET_SETTINGS"),className:[this.classSettingsResetButton,this.classSubmenuItem].join(" ")})}return i},getSubmenuArgs:function(){var t=this.getSubmenuId();var e=this.moreButton;var s=BX.pos(e);var i=this.getSubmenuItems();var n={autoHide:true,offsetLeft:s.width/2-80,angle:{position:"top",offset:100},zIndex:20,events:{onPopupClose:BX.delegate(this._onSubmenuClose,this)}};return[t,e,i,n]},visibleControlMoreButton:function(){var t=this.getHiddenItems();if(!t.length||t.length===1&&this.isMoreButton(t[0])){this.getMoreButton().style.display="none"}else{this.getMoreButton().style.display=""}},createSubmenu:function(){var t=BX.PopupMenu.create.apply(BX.PopupMenu,this.getSubmenuArgs());if(this.isSettingsEnabled){this.dragAndDropInitInSubmenu()}t.menuItems.forEach(function(t){BX.bind(t.layout.item,"click",BX.delegate(this._onDocumentClick,this))},this);return t},showSubmenu:function(){var t=this.getSubmenu();if(t!==null){t.popupWindow.show()}else{this.destroySubmenu();t=this.createSubmenu();t.popupWindow.show()}this.setSubmenuShown(true);this.activateItem(this.moreButton);if(this.isEditEnabled()){t.popupWindow.setAutoHide(false)}},closeSubmenu:function(){var t=this.getSubmenu();if(t===null){return}t.popupWindow.close();if(!this.isActiveInMoreMenu()){this.deactivateItem(this.moreButton)}this.setSubmenuShown(false)},getSubmenu:function(){return BX.PopupMenu.getMenuById(this.getSubmenuId())},destroySubmenu:function(){BX.PopupMenu.destroy(this.getSubmenuId())},refreshSubmenu:function(){var t=this.getSubmenu();var e;if(t===null){return}e=this.getSubmenuArgs();if(BX.type.isArray(e)){this.destroySubmenu();this.createSubmenu();this.showSubmenu()}},setSubmenuShown:function(t){this.isSubmenuShown=false;if(BX.type.isBoolean(t)){this.isSubmenuShown=t}},activateItem:function(t){if(!BX.type.isDomNode(t)){return}if(!BX.hasClass(t,this.classItemActive)){BX.addClass(t,this.classItemActive)}},deactivateItem:function(t){if(!BX.type.isDomNode(t)){return}if(BX.hasClass(t,this.classItemActive)){BX.removeClass(t,this.classItemActive)}},getCurrentSettings:function(){var t={};this.getAllItems().forEach(function(e,s){t[e.id]={sort:s,isDisabled:this.isDisabled(e)}},this);return t},saveSettings:function(){var t=this.getCurrentSettings();var e="settings";var s;if(!BX.type.isPlainObject(t)){return}if(BX.type.isDomNode(this.listContainer)){if("id"in this.listContainer){s=this.listContainer.id;t=JSON.stringify(t);BX.userOptions.save("ui",s,e,t);this.setHome()}}},resetSettings:function(){var t=null;var e=BX.PopupWindowManager.create(this.listContainer.id+"_reset_popup",null,{content:this.message("MIB_RESET_ALERT"),autoHide:false,overlay:true,closeByEsc:true,closeIcon:true,draggable:{restrict:true},titleBar:this.message("MIB_RESET_SETTINGS"),buttons:[t=new BX.PopupWindowButton({text:this.message("MIB_RESET_BUTTON"),className:"popup-window-button-create",events:{click:function(){if(BX.hasClass(t.buttonNode,"popup-window-button-wait")){return}BX.addClass(t.buttonNode,"popup-window-button-wait");this.handleResetSettings(function(s){if(s){BX.removeClass(t.buttonNode,"popup-window-button-wait");e.setContent(s)}else{var i="settings";BX.userOptions.save("ui",this.listContainer.id,i,JSON.stringify({}));BX.userOptions.save("ui",this.listContainer.id,"firstPageLink","");window.location.reload()}}.bind(this))}.bind(this)}}),new BX.PopupWindowButtonLink({text:this.message("MIB_CANCEL_BUTTON"),className:"popup-window-button-link-cancel",events:{click:function(){this.popupWindow.close()}}})]});e.show()},handleResetSettings:function(t){var e=[];BX.onCustomEvent("BX.Main.InterfaceButtons:onBeforeResetMenu",[e,this]);var s=new BX.Promise;var i=s;for(var n=0;n<e.length;n++){s=s.then(e[n])}s.then(function(e){t(null,e)},function(e){t(e,null)});i.fulfill()},moveButtonAlias:function(t){var e,s;if(!t||!this.dragItem){return}e=this.getItemAlias(this.dragItem);s=this.getItemAlias(t);if(this.isListItem(e)){if(!s){this.listContainer.appendChild(e)}else{this.listContainer.insertBefore(e,s)}}},moveButton:function(t){var e;if(!BX.type.isDomNode(t)||!BX.type.isDomNode(this.dragItem)){return}if(this.isListItem(t)){if(this.isDisabled(this.dragItem)){this.dragItem.dataset.disabled="false"}if(BX.type.isDomNode(t)){this.listContainer.insertBefore(this.dragItem,t)}else{this.listContainer.appendChild(this.dragItem)}}if(this.isSubmenuItem(t)){if(this.isDisabled(this.dragItem)&&!this.isDisabled(t)){this.enableItem(this.dragItem)}e=this.getSubmenuContainer();e.insertBefore(this.dragItem,t)}},getSubmenuContainer:function(){var t=this.getSubmenu();var e=null;if(t!==null){e=t.itemsContainer}return e},findNextSiblingByClass:function(t,e){var s=t;for(;!!t;t=t.nextElementSibling){if(e){if(BX.hasClass(t,e)&&t!==s){return t}}else{return null}}},findParentByClassName:function(t,e){for(;t&&t!==document;t=t.parentNode){if(e){if(BX.hasClass(t,e)){return t}}else{return null}}},findChildrenByClassName:function(t,e){var s=null;if(BX.type.isDomNode(t)&&BX.type.isNotEmptyString(e)){s=BX.Buttons.Utils.getByClass(t,e)}return s},dragAndDropInit:function(){this.getAllItems().forEach(function(t,e){if(!this.isSeparator(t)&&!this.isSettings(t)&&!this.isApplySettingsButton(t)&&!this.isResetSettingsButton(t)){t.setAttribute("draggable","true");t.setAttribute("tabindex","-1");t.dataset.link="item"+e;BX.bind(t,"dragstart",BX.delegate(this._onDragStart,this));BX.bind(t,"dragend",BX.delegate(this._onDragEnd,this));BX.bind(t,"dragenter",BX.delegate(this._onDragEnter,this));BX.bind(t,"dragover",BX.delegate(this._onDragOver,this));BX.bind(t,"dragleave",BX.delegate(this._onDragLeave,this));BX.bind(t,"drop",BX.delegate(this._onDrop,this))}BX.bind(t,"mouseover",BX.delegate(this._onMouse,this));BX.bind(t,"mouseout",BX.delegate(this._onMouse,this))},this)},dragAndDropInitInSubmenu:function(){var t=this.getSubmenu();var e=t.menuItems;e.forEach(function(t){if(!this.isSeparator(t.layout.item)&&!this.isSettings(t.layout.item)&&!this.isApplySettingsButton(t.layout.item)&&!this.isResetSettingsButton(t.layout.item)){t.layout.item.draggable=true;t.layout.item.dataset.sortable=true;BX.bind(t.layout.item,"dragstart",BX.delegate(this._onDragStart,this));BX.bind(t.layout.item,"dragenter",BX.delegate(this._onDragEnter,this));BX.bind(t.layout.item,"dragover",BX.delegate(this._onDragOver,this));BX.bind(t.layout.item,"dragleave",BX.delegate(this._onDragLeave,this));BX.bind(t.layout.item,"dragend",BX.delegate(this._onDragEnd,this));BX.bind(t.layout.item,"drop",BX.delegate(this._onDrop,this))}if(BX.hasClass(t.layout.item,this.classHiddenLabel)&&!BX.hasClass(t.layout.item,this.classManage)){BX.bind(t.layout.item,"dragover",BX.delegate(this._onDragOver,this))}},this)},getItem:function(t){if(!BX.type.isDomNode(t)){if(!t||!BX.type.isDomNode(t.target)){return null}}else{t={target:t}}var e=this.findParentByClassName(t.target,this.classItem);if(!BX.type.isDomNode(e)){e=this.findParentByClassName(t.target,this.classDefaultSubmenuItem)}return e},setOpacity:function(t){if(!BX.type.isDomNode(t)){return}BX.style(t,"opacity",".1")},unsetOpacity:function(t){if(!BX.type.isDomNode(t)){return}BX.style(t,"opacity","1")},setDragStyles:function(){BX.addClass(this.listContainer,this.classOnDrag);BX.addClass(BX(this.getSubmenuId(true)),this.classOnDrag);this.setOpacity(this.dragItem)},unsetDragStyles:function(){var t=this.getSubmenu();this.getAllItems().forEach(function(t){this.unsetOpacity(t);BX.removeClass(t,"over")},this);if(t&&"menuItems"in t&&BX.type.isArray(t.menuItems)&&t.menuItems.length){t.menuItems.forEach(function(t){this.unsetOpacity(t);BX.removeClass(t.layout.item,"over")},this)}BX.removeClass(this.listContainer,this.classOnDrag);BX.removeClass(BX(this.getSubmenuId(true)),this.classOnDrag)},getIconClass:function(t){var e="";if(BX.type.isDomNode(t)&&"dataset"in t&&"class"in t.dataset&&BX.type.isNotEmptyString(t.dataset.class)){e=t.dataset.class}return e},disableItem:function(t){var e=this.getItemAlias(t);if(t&&"dataset"in t){t.dataset.disabled="true";if(e){e.dataset.disabled="true"}}},enableItem:function(t){var e;if(!BX.type.isDomNode(t)){return}if(this.isSubmenuItem(t)){BX.removeClass(t,this.classItemDisabled);e=this.getItemAlias(t);if(BX.type.isDomNode(e)){e.dataset.disabled="false"}}},getAliasLink:function(t){return this.dataValue(t,"link")||""},getItemAlias:function(t){var e=null;if(!BX.type.isDomNode(t)){return e}var s=this.getAllItems();var i=this.isSubmenuItem(t);var n=this.isListItem(t);if(!i&&!n){return e}if(i){s.forEach(function(s){BX.hasClass(t,this.getAliasLink(s))&&(e=s)},this)}if(n){e=BX.Buttons.Utils.getByClass(document,this.getAliasLink(t))}return e},hideItem:function(t){!!t&&BX.addClass(t,this.classSecret)},showItem:function(t){!!t&&BX.removeClass(t,this.classSecret)},fakeDragItem:function(){var t=null;if(!BX.type.isDomNode(this.dragItem)||!BX.type.isDomNode(this.overItem)){return}if(this.isDragToSubmenu()){t=this.getItemAlias(this.dragItem);if(t!==this.dragItem){this.listContainer.appendChild(this.dragItem);this.dragItem=t;this.showItem(this.dragItem);this.adjustMoreButtonPosition();this.updateSubmenuItems();this.tmp.moved=false;this.tmp.movetToSubmenu=true;this.setOpacity(this.dragItem)}}if(this.isDragToList()&&!this.tmp.movetToSubmenu){t=this.getItemAlias(this.dragItem);if(t!==this.dragItem){this.hideItem(this.dragItem);this.dragItem=t;this.adjustMoreButtonPosition();this.updateSubmenuItems();this.setOpacity(this.dragItem)}}this.tmp.movetToSubmenu=false},updateSubmenuItems:function(){var t=this.getHiddenItems();var e=this.getDisabledItems();var s=this;var i=[];var n,a,o;n=this.getSubmenu();if(n===null){return}a=n.menuItems;if(!BX.type.isArray(a)||!a.length){return}i=e.concat(t);a.forEach(function(t){o=[].some.call(i,function(e){return BX.hasClass(t.layout.item,s.dataValue(e,"link"))||s.isDisabled(t.layout.item)||s.isSeparator(t.layout.item)||s.isDropzone(t.layout.item)});if(o||(s.isSettings(t.layout.item)||s.isApplySettingsButton(t.layout.item)||s.isResetSettingsButton(t.layout.item)||s.isNotHiddenItem(t.layout.item)||s.isSeparator(t.layout.item)||t.layout.item===s.dragItem)&&!s.isMoreButton(t.layout.item)){s.showItem(t.layout.item)}else{s.hideItem(t.layout.item)}})},isNotHiddenItem:function(t){return BX.hasClass(t,this.classSubmenuNoHiddenItem)},getNotHidden:function(){return BX.Buttons.Utils.getByClass(this.getSubmenuContainer(),this.classSubmenuNoHiddenItem)},setOverStyles:function(t){if(BX.type.isDomNode(t)&&!BX.hasClass(t,this.classItemOver)){BX.addClass(t,this.classItemOver)}},unsetOverStyles:function(t){if(BX.type.isDomNode(t)&&BX.hasClass(t,this.classItemOver)){BX.removeClass(t,this.classItemOver)}},dataValue:function(t,e){var s="";var i;if(BX.type.isDomNode(t)){i=BX.data(t,e);if(typeof i!=="undefined"){s=i}}return s},execScript:function(script){if(BX.type.isNotEmptyString(script)){eval(script)}},showLicenseWindow:function(){var t;if(!B24.licenseInfoPopup){return}t=B24.licenseInfoPopup;t.init({B24_LICENSE_BUTTON_TEXT:this.message("MIB_LICENSE_BUY_BUTTON"),B24_TRIAL_BUTTON_TEXT:this.message("MIB_LICENSE_TRIAL_BUTTON"),IS_FULL_DEMO_EXISTS:this.licenseParams.isFullDemoExists,HOST_NAME:this.licenseParams.hostname,AJAX_URL:this.licenseParams.ajaxUrl,LICENSE_ALL_PATH:this.licenseParams.licenseAllPath,LICENSE_DEMO_PATH:this.licenseParams.licenseDemoPath,FEATURE_GROUP_NAME:this.licenseParams.featureGroupName,AJAX_ACTIONS_URL:this.licenseParams.ajaxActionsUrl,B24_FEATURE_TRIAL_SUCCESS_TEXT:this.message("MIB_LICENSE_WINDOW_TRIAL_SUCCESS_TEXT")});t.show("main-buttons",this.message("MIB_LICENSE_WINDOW_HEADER_TEXT"),this.message("MIB_LICENSE_WINDOW_TEXT"))},_onDragStart:function(t){var e=this.getVisibleItems();var s=BX.type.isArray(e)?e.length:null;this.dragItem=this.getItem(t);if(!BX.type.isDomNode(this.dragItem)){return}if(s===2&&this.isListItem(this.dragItem)){t.preventDefault();BX.onCustomEvent(window,"BX.Main.InterfaceButtons:onHideLastVisibleItem",[this.dragItem,this]);return}if(this.isMoreButton(this.dragItem)||this.isSeparator(this.dragItem)||this.isNotHiddenItem(this.dragItem)){t.preventDefault();return}this.isSubmenuShownOnDragStart=!!this.isSubmenuShown;if(this.isListItem(this.dragItem)){this.showSubmenu()}this.setDragStyles();if(!this.isEditEnabled()){this.enableEdit()}},_onDragEnd:function(t){t.preventDefault();var e=this.getItem(t);var s,i;if(!BX.type.isDomNode(e)){return}this.unsetDragStyles();if(!this.isSubmenuShownOnDragStart){this.refreshSubmenu();if(!this.isEditEnabled()){this.closeSubmenu()}}else{this.refreshSubmenu()}s=BX.findNextSibling(this.dragItem,BX.delegate(function(t){return this.isVisibleItem(t)},this));i=BX.findPreviousSibling(this.dragItem,BX.delegate(function(t){return this.isVisibleItem(t)},this));if(BX.type.isDomNode(i)&&(BX.hasClass(i,this.classHiddenLabel)||this.isDisabled(i)&&this.isSubmenuItem(i))||(BX.type.isDomNode(s)&&BX.hasClass(s,this.classManage)||this.isDisabled(s)&&this.isSubmenuItem(s))){this.disableItem(this.dragItem);this.refreshSubmenu()}if(this.isEditEnabled()){this.enableEdit();BX.show(this.getSettingsApplyButton());BX.hide(this.getSettingsButton())}else{this.disableEdit();

BX.hide(this.getSettingsApplyButton());BX.show(this.getSettingsButton())}this.updateMoreButtonCounter();this.saveSettings();this.dragItem=null;this.overItem=null;this.tmp.moved=false},updateMoreButtonCounter:function(){var t,e,s,i;t=this.getHiddenItems();i=this.getDisabledItems();t=t.concat(i);e=0;if(BX.type.isArray(t)){t.forEach(function(t){e+=parseInt(this.dataValue(t,"counter"))||0},this)}if(BX.type.isNumber(e)){this.setMoreButtonCounter(e)}},_onDragEnter:function(t){var e=this.getItem(t);if(BX.type.isDomNode(e)&&this.isNotHiddenItem(e)){this.setOverStyles(e)}},_onDragOver:function(t){t.preventDefault();var e=null;this.overItem=this.getItem(t);if(!BX.type.isDomNode(this.overItem)||!BX.type.isDomNode(this.dragItem)||this.overItem===this.dragItem||this.isNotHiddenItem(this.overItem)){return}this.fakeDragItem();if(this.isNext(t)&&this.isGoodPosition(t)&&!this.isMoreButton(this.overItem)){e=this.findNextSiblingByClass(this.overItem,this.classItem);if(this.isMoreButton(e)&&!this.tmp.moved){e=e.previousElementSibling;this.tmp.moved=true}if(!BX.type.isDomNode(e)){e=this.findNextSiblingByClass(this.overItem,this.classSubmenuItem)}if(BX.type.isDomNode(e)){this.moveButton(e);this.moveButtonAlias(e);this.adjustMoreButtonPosition();this.updateSubmenuItems()}}if(!this.isNext(t)&&this.isGoodPosition(t)&&!this.isMoreButton(this.overItem)||!this.isGoodPosition(t)&&this.isMoreButton(this.overItem)&&this.getVisibleItems().length===1){this.moveButton(this.overItem);this.moveButtonAlias(this.overItem);this.adjustMoreButtonPosition();this.updateSubmenuItems()}},_onDragLeave:function(t){var e=this.getItem(t);if(BX.type.isDomNode(e)){this.unsetOverStyles(t.target)}},_onDrop:function(t){var e=this.getItem(t);if(!BX.type.isDomNode(e)){return}if(this.isNotHiddenItem(e)||this.isDisabled(e)){this.disableItem(this.dragItem);this.adjustMoreButtonPosition()}this.unsetDragStyles();t.preventDefault()},getIndex:function(t,e){return[].indexOf.call(t||[],e)},_onSubmenuClose:function(){this.setSubmenuShown(false);if(this.isEditEnabled()){this.activateItem(this.moreButton)}else{if(!this.isActiveInMoreMenu()){this.deactivateItem(this.moreButton)}}},_onResizeHandler:function(){this.adjustMoreButtonPosition();this.updateSubmenuItems();if(!this.isSettingsEnabled){this.visibleControlMoreButton()}},_onClickMoreButton:function(t){t.preventDefault();this.showSubmenu()},_onMouse:function(t){var e=this.getItem(t);if(t.type==="mouseover"&&!BX.hasClass(e,this.classItemOver)){BX.addClass(e,this.classItemOver)}if(t.type==="mouseout"&&BX.hasClass(e,this.classItemOver)){BX.removeClass(e,this.classItemOver)}},getSettingsResetButton:function(){return BX.Buttons.Utils.getByClass(this.getSubmenuContainer(),this.classSettingsResetButton)},_onScroll:function(){if(BX.style(this.pinContainer,"position")==="fixed"){this.closeSubmenu()}},isDisabled:function(t){var e=false;if(BX.type.isDomNode(t)){e=this.dataValue(t,"disabled")==="true"||BX.hasClass(t,this.classItemDisabled)}return e},isSettings:function(t){var e=false;if(BX.type.isDomNode(t)){e=BX.hasClass(t,this.classSettingMenuItem)}return e},isLocked:function(t){var e=false;if(BX.type.isDomNode(t)){e=this.dataValue(t,"locked")==="true"||BX.hasClass(t,this.classItemLocked)}return e},isDropzone:function(t){return BX.hasClass(t,this.classDropzone)},isNext:function(t){var e=this.dragItem.getBoundingClientRect();var s=this.overItem.getBoundingClientRect();var i=getComputedStyle(this.dragItem);var n=parseInt(i.marginRight.replace("px",""));var a=null;if(this.isListItem(this.overItem)){a=t.clientX>s.left-n&&t.clientX>e.right}if(this.isSubmenuItem(this.overItem)){a=t.clientY>e.top}return a},isGoodPosition:function(t){var e=this.overItem;var s,i;if(!BX.type.isDomNode(e)){return false}s=e.getBoundingClientRect();if(this.isListItem(e)){i=this.isNext(t)&&t.clientX>=s.left+s.width/2||!this.isNext(t)&&t.clientX<=s.left+s.width/2}if(this.isSubmenuItem(e)){i=this.isNext(t)&&t.clientY>=s.top+s.height/2||!this.isNext(t)&&t.clientY<=s.top+s.height/2}return i},isSubmenuItem:function(t){return BX.hasClass(t,this.classSubmenuItem)},isVisibleItem:function(t){if(!BX.type.isDomNode(t)){return false}return t.offsetTop===0},isMoreButton:function(t){var e=false;if(BX.type.isDomNode(t)&&BX.hasClass(t,this.classItemMore)){e=true}return e},isListItem:function(t){var e=false;if(BX.type.isDomNode(t)&&BX.hasClass(t,this.classItem)){e=true}return e},isSublink:function(t){var e=false;if(BX.type.isDomNode(t)){e=BX.hasClass(t,this.classItemSublink)}return e},isSeparator:function(t){var e=false;if(BX.type.isDomNode(t)){e=BX.hasClass(t,this.classSeporator)}return e},isDragToSubmenu:function(){return!this.isSubmenuItem(this.dragItem)&&this.isSubmenuItem(this.overItem)},isDragToList:function(){return this.isSubmenuItem(this.dragItem)&&!this.isSubmenuItem(this.overItem)}}}if(typeof BX.Main.interfaceButtonsManager==="undefined"){BX.Main.interfaceButtonsManager={data:{},init:function(t){var e=null;if(!BX.type.isPlainObject(t)||!("containerId"in t)){throw"BX.Main.interfaceButtonsManager: containerId not set in params Object"}e=BX(t.containerId);if(BX.type.isDomNode(e)){this.data[t.containerId]=new BX.Main.interfaceButtons(e,t)}else{BX(BX.delegate(function(){e=BX(t.containerId);if(!BX.type.isDomNode(e)){throw"BX.Main.interfaceButtonsManager: container is not dom node"}this.data[t.containerId]=new BX.Main.interfaceButtons(e,t)},this))}},getById:function(t){var e=null;if(BX.type.isString(t)&&BX.type.isNotEmptyString(t)){try{e=this.data[t]}catch(s){}}return e},getObjects:function(){return this.data}}}
/* End */
;
; /* Start:"a:4:{s:4:"full";s:94:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.min.js?1511316472575";s:6:"source";s:76:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.js";s:3:"min";s:80:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.min.js";s:3:"map";s:80:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Buttons");BX.Buttons.Utils={getByClass:function(e,t,l){var n=[];if(t){n=(e||document.body).getElementsByClassName(t);if(!l){n=n.length?n[0]:null}else{n=[].slice.call(n)}}return n},getByTag:function(e,t,l){var n=[];if(t){n=(e||document.body).getElementsByTagName(t);if(!l){n=n.length?n[0]:null}else{n=[].slice.call(n)}}return n},getBySelector:function(e,t,l){var n=[];if(t){if(!l){n=(e||document.body).querySelector(t)}else{n=(e||document.body).querySelectorAll(t);n=[].slice.call(n)}}return n}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:98:"/bitrix/components/bitrix/crm.entity.counter.panel/templates/.default/script.min.js?15113164781267";s:6:"source";s:79:"/bitrix/components/bitrix/crm.entity.counter.panel/templates/.default/script.js";s:3:"min";s:83:"/bitrix/components/bitrix/crm.entity.counter.panel/templates/.default/script.min.js";s:3:"map";s:83:"/bitrix/components/bitrix/crm.entity.counter.panel/templates/.default/script.map.js";}"*/
if(typeof BX.CrmEntityCounterPanel==="undefined"){BX.CrmEntityCounterPanel=function(){this._id="";this._settings={};this._container=null;this._itemClickHandler=BX.delegate(this.onItemClick,this)};BX.CrmEntityCounterPanel.prototype={initialize:function(t,n){this._id=BX.type.isNotEmptyString(t)?t:BX.util.getRandomString(4);this._settings=n?n:{};this._container=BX(this.getSetting("containerId",""));if(!BX.type.isElementNode(this._container)){throw"BX.CrmEntityCounterPanel: Could not find container."}var e=this._container.querySelectorAll("a.crm-counter-container");for(var i=0,r=e.length;i<r;i++){BX.bind(e[i],"click",this._itemClickHandler)}},getId:function(){return this._id},getSetting:function(t,n){return this._settings.hasOwnProperty(t)?this._settings[t]:n},onItemClick:function(t){var n=BX.findParent(BX.getEventTarget(t),{tagName:"A",className:"crm-counter-container"});if(n){var e=n.getAttribute("data-type-id");if(BX.type.isNotEmptyString(e)){var i={counterTypeId:e,cancel:false};BX.onCustomEvent(window,"BX.CrmEntityCounterPanel:applyFilter",[this,i]);if(i.cancel){return BX.PreventDefault(t)}}}return true}};BX.CrmEntityCounterPanel.create=function(t,n){var e=new BX.CrmEntityCounterPanel;e.initialize(t,n);return e}}
/* End */
;
; /* Start:"a:4:{s:4:"full";s:92:"/bitrix/components/bitrix/crm.widget_panel/templates/.default/script.min.js?1511316478167003";s:6:"source";s:71:"/bitrix/components/bitrix/crm.widget_panel/templates/.default/script.js";s:3:"min";s:75:"/bitrix/components/bitrix/crm.widget_panel/templates/.default/script.min.js";s:3:"map";s:75:"/bitrix/components/bitrix/crm.widget_panel/templates/.default/script.map.js";}"*/
if(typeof BX.CrmWidget==="undefined"){BX.CrmWidget=function(){this._id="";this._settings=null;this._entityTypeName="";this._typeName="";this._serviceUrl="";this._title="";this._prefix="";this._heightInPixel=0;this._widthInPercent=0;this._layout="";this._config=null;this._configEditor=null;this._data={};this._container=null;this._wrapper=null;this._headerWrapper=null;this._contentWrapper=null;this._settingButton=null;this._hasLayout=false;this._cell=null;this._settingButtonClickHandler=BX.delegate(this.onSettingButtonClick,this);this._isSettingMenuShown=false;this._settingMenuId="";this._settingMenu=null;this._settingMenuHandler=BX.delegate(this.onSettingMenuItemClick,this)};BX.CrmWidget.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"";this._settings=e?e:{};this._entityTypeName=this.getSetting("entityTypeName","");this._cell=this.getSetting("cell",null);this._config=this.getSetting("config","");this._typeName=BX.type.isNotEmptyString(this._config["typeName"])?this._config["typeName"]:"";if(this._typeName===""){throw"CrmWidget: The type name is not found."}this._data=this.getSetting("data",{});if(!BX.type.isArray(this._data["items"])){this._data["items"]=[]}this._prefix=this.getSetting("prefix","");var i=this.getSetting("containerId","");this._container=BX(i!==""?i:this._prefix+"_"+"container");this._heightInPixel=parseInt(this.getSetting("heightInPixel",0));if(this._heightInPixel<=0){this._heightInPixel=BX.CrmWidgetLayoutHeight.full}this._widthInPercent=parseInt(this.getSetting("widthInPercent",0));if(this._widthInPercent<=0){this._widthInPercent=100}this._layout=BX.type.isNotEmptyString(this._config["layout"])?this._config["layout"]:"";this.doInitialize()},doInitialize:function(){},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getId:function(){return this._id},getTypeName:function(){return this._typeName},getEntityTypeName:function(){return this._entityTypeName},getTitle:function(){return BX.type.isNotEmptyString(this._config["title"])?this._config["title"]:""},getMessage:function(t){var e=BX.CrmWidget.messages;return e.hasOwnProperty(t)?e[t]:t},getContainer:function(){return this._container},setContainer:function(t){this._container=t},getWrapper:function(){return this._wrapper},getPanel:function(){return this._cell?this._cell.getPanel():null},getCell:function(){return this._cell},getRow:function(){return this._cell?this._cell.getRow():null},getIndex:function(){return this._cell?this._cell.getWidgetIndex(this):-1},getNextSibling:function(){return this._cell?this._cell.getNextWidget(this):null},getConfig:function(){return this._config},getPeriodDescription:function(){var t=BX.type.isPlainObject(this._config["filter"])?this._config["filter"]:null;if(!t){return""}var e=BX.CrmWidgetConfigPeriodEditor.create("",{config:t});return!e.isEmpty()?e.getDescription():""},getHeight:function(){return BX.CrmWidgetLayoutHeight.undifined},getData:function(){return this._data},setData:function(t){this._data=t},refresh:function(){this.clearLayout();this.layout();var t=this.getPanel();if(t){t.processWidgetRefresh(this)}},invalidate:function(){},prepareHeader:function(t,e){var i=BX.create("DIV",{attrs:{className:"crm-widget-head"}});if(e&&typeof e["settings"]!=="undefined"){i.appendChild(e["settings"])}var n=BX.create("SPAN",{attrs:{className:"crm-widget-title-container"},children:[BX.create("SPAN",{attrs:{className:"crm-widget-title-inner"},children:[BX.create("SPAN",{attrs:{className:"crm-widget-title",title:t},text:t})]})]});i.appendChild(n);if(e&&typeof e["edit"]!=="undefined"){n.appendChild(e["edit"])}return i},prepareButtons:function(){return{settings:BX.create("SPAN",{attrs:{className:"crm-widget-settings"}})}},renderHeader:function(t){this._headerWrapper=BX.create("DIV",{attrs:{className:"crm-widget-head"}});if(BX.type.isElementNode(t)){t.appendChild(this._headerWrapper)}else{this._wrapper.appendChild(this._headerWrapper)}this._settingButton=BX.create("SPAN",{attrs:{className:"crm-widget-settings"}});this._headerWrapper.appendChild(this._settingButton);var e=this.getTitle();if(e===""){e=this.getMessage("untitled")}this._headerWrapper.appendChild(BX.create("SPAN",{attrs:{className:"crm-widget-title-container"},children:[BX.create("SPAN",{attrs:{className:"crm-widget-title-inner"},children:[BX.create("SPAN",{attrs:{className:"crm-widget-title",title:e},text:e}),this._editButton]})]}))},renderContent:function(){},renderLayout:function(){this.renderHeader();this.renderContent()},layout:function(){if(this._hasLayout){return}if(!this._container){throw"CrmWidget: Could not find container."}this._wrapper=BX.create("DIV",{attrs:{className:"crm-widget"}});this._wrapper.setAttribute("data-widget-id",this._id);var t=this.getNextSibling();var e=t!==null?t.getWrapper():null;if(e===null){this._container.appendChild(this._wrapper)}else{this._container.insertBefore(this._wrapper,e)}this.renderLayout();if(this._settingButton){BX.bind(this._settingButton,"click",this._settingButtonClickHandler)}this._hasLayout=true},clearLayout:function(){if(!this._hasLayout){return}this.innerClearLayout();if(this._settingButton){BX.unbind(this._settingButton,"click",this._settingButtonClickHandler);this._settingButton=null}if(this._container){try{this._container.removeChild(this._wrapper)}catch(t){}}this._wrapper=null;this._hasLayout=false},innerClearLayout:function(){},remove:function(){if(!window.confirm(this.getMessage("removalConfirmation").replace(/#TITLE#/gi,this.getTitle()))){return false}this.clearLayout();this.undock();return true},dock:function(t,e){t.addWidget(this,e);this._cell=t},undock:function(){if(this._cell){this._cell.removeWidget(this);this._cell=null}},processConfigSave:function(){var t=this.getPanel();if(!t||!this._configEditor){return}this._configEditor.saveConfig();this._config=this._configEditor.getConfig();t.saveConfig(BX.delegate(this.onAfterConfigSave,this))},onAfterConfigSave:function(){BX.CrmWidgetManager.getCurrent().prepareWidgetData(this)},ensureConfigEditorCreated:function(){if(!this._configEditor){this._configEditor=BX.CrmWidgetConfigEditor.create(this._id+"_config",{widget:this,config:this._config,entityTypeName:this._entityTypeName})}},onSettingButtonClick:function(){if(!this._isSettingMenuShown){this.openSettingMenu()}else{this.closeSettingMenu()}},openSettingMenu:function(){if(this._isSettingMenuShown){return}this._settingMenuId=this._id+"_menu";if(typeof BX.PopupMenu.Data[this._settingMenuId]!=="undefined"){BX.PopupMenu.Data[this._settingMenuId].popupWindow.destroy();delete BX.PopupMenu.Data[this._settingMenuId]}this._settingMenu=BX.PopupMenu.create(this._settingMenuId,this._settingButton,[{id:"configure",text:this.getMessage("menuItemConfigure"),onclick:this._settingMenuHandler},{id:"remove",text:this.getMessage("menuItemRemove"),onclick:this._settingMenuHandler}],{autoHide:true,offsetLeft:-21,offsetTop:-11,angle:{position:"top",offset:42},events:{onPopupClose:BX.delegate(this.onSettingMenuClose,this)}});this._settingMenu.popupWindow.show();this._isSettingMenuShown=true},closeSettingMenu:function(){if(this._settingMenu&&this._settingMenu.popupWindow){this._settingMenu.popupWindow.close()}},onSettingMenuClose:function(){this._settingMenu=null;if(typeof BX.PopupMenu.Data[this._settingMenuId]!=="undefined"){BX.PopupMenu.Data[this._settingMenuId].popupWindow.destroy();delete BX.PopupMenu.Data[this._settingMenuId]}this._isSettingMenuShown=false},onSettingMenuItemClick:function(t,e){if(e.id==="configure"){this.openConfigDialog()}else if(e.id==="remove"){var i=this.getPanel();if(i){i.processWidgetRemoval(this)}}this.closeSettingMenu()},openConfigDialog:function(){this.ensureConfigEditorCreated();this._configEditor.openDialog()},scrollIntoView:function(){if(this._hasLayout&&this._container){this._container.scrollIntoView(true)}}};if(typeof BX.CrmWidget.messages==="undefined"){BX.CrmWidget.messages={}}BX.CrmWidget.create=function(t,e){var i=new BX.CrmWidget;i.initialize(t,e);return i}}if(typeof BX.CrmFunnelWidget==="undefined"){BX.CrmFunnelWidget=function(){this._chart=null;BX.CrmFunnelWidget.superclass.constructor.apply(this)};BX.extend(BX.CrmFunnelWidget,BX.CrmWidget);BX.CrmFunnelWidget.prototype.doInitialize=function(){};BX.CrmFunnelWidget.prototype.renderContent=function(){if(!AmCharts.isReady){if(BX.CrmWidgetPanel.isAjaxMode){AmCharts.handleLoad()}else{AmCharts.ready(BX.delegate(this.renderContent,this));return}}this._contentWrapper=BX.create("DIV",{attrs:{id:this._prefix+"_"+"content_wrapper",className:"crm-widget-content"}});this._wrapper.appendChild(this._contentWrapper);if(this._heightInPixel>0){this._contentWrapper.style.height=this._heightInPixel+"px"}var t=this.getPeriodDescription();if(t!==""){this._contentWrapper.appendChild(BX.create("SPAN",{attrs:{className:"crm-widget-content-period"},children:[BX.create("SPAN",{html:this.getMessage("periodCaption")+": "+t})]}))}var e=BX.create("DIV",{attrs:{id:this._prefix+"_chart_wrapper"}});this._contentWrapper.appendChild(e);if(this._heightInPixel>0){e.style.height=this._heightInPixel-40+"px"}var i=BX.type.isNotEmptyString(this._data["valueField"])?this._data["valueField"]:"";var n=BX.type.isNotEmptyString(this._data["titleField"])?this._data["titleField"]:"";var r=BX.type.isArray(this._data["items"])?this._data["items"]:[];for(var s=0;s<r.length;s++){var o=BX.type.isNotEmptyString(r[s][n])?r[s][n]:"";if(o!==""){r[s]["BALLOON_TEXT"]=BX.util.htmlspecialchars(o)}}this._chart=AmCharts.makeChart(e.id,{type:"funnel",theme:"none",titleField:n,valueField:i,dataProvider:r,labelPosition:"right",depth3D:160,angle:16,outlineAlpha:2,outlineColor:"#FFFFFF",outlineThickness:2,startY:-400,marginRight:240,marginLeft:10,balloon:{fixedPosition:true}});this._chart.balloonText="<div>[[BALLOON_TEXT]]</div>"};BX.CrmFunnelWidget.prototype.innerClearLayout=function(){if(this._chart){this._chart.clear();this._chart=null}};BX.CrmFunnelWidget.prototype.ensureConfigEditorCreated=function(){if(!this._configEditor){this._configEditor=BX.CrmWidgetManager.getCurrent().createConfigEditor(this._entityTypeName,this._typeName,this._id+"_config",{widget:this,config:this._config,enableTitle:true,entityTypeName:this._entityTypeName})}};BX.CrmFunnelWidget.prototype.getHeight=function(){return BX.CrmWidgetLayoutHeight.full};BX.CrmFunnelWidget.prototype.invalidate=function(){if(this._chart){this._chart.invalidateSize()}};BX.CrmFunnelWidget.create=function(t,e){var i=new BX.CrmFunnelWidget;i.initialize(t,e);return i}}if(typeof BX.CrmPieWidget==="undefined"){BX.CrmPieWidget=function(){this._chart=null;BX.CrmPieWidget.superclass.constructor.apply(this)};BX.extend(BX.CrmPieWidget,BX.CrmWidget);BX.CrmPieWidget.prototype.getTitle=function(){var t=BX.type.isNotEmptyString(this._config["title"])?this._config["title"]:"";if(t===""&&BX.type.isArray(this._config["configs"])&&this._config["configs"].length>0&&BX.type.isNotEmptyString(this._config["configs"][0]["title"])){t=this._config["configs"][0]["title"]}return t};BX.CrmPieWidget.prototype.renderContent=function(){if(!AmCharts.isReady){if(BX.CrmWidgetPanel.isAjaxMode){AmCharts.handleLoad()}else{AmCharts.ready(BX.delegate(this.renderContent,this));return}}this._contentWrapper=BX.create("DIV",{attrs:{id:this._prefix+"_"+"content_wrapper",className:"crm-widget-content"}});this._wrapper.appendChild(this._contentWrapper);if(this._heightInPixel>0){this._contentWrapper.style.height=this._heightInPixel+"px"}var t=this.getPeriodDescription();if(t!==""){this._contentWrapper.appendChild(BX.create("SPAN",{attrs:{className:"crm-widget-content-period"},children:[BX.create("SPAN",{html:this.getMessage("periodCaption")+": "+t})]}))}var e=BX.create("DIV",{attrs:{id:this._prefix+"_chart_wrapper"}});this._contentWrapper.appendChild(e);if(this._heightInPixel>0){e.style.height=this._heightInPixel-40+"px"}this._chart=AmCharts.makeChart(e.id,{type:"pie",theme:"none",titleField:BX.type.isNotEmptyString(this._data["titleField"])?this._data["titleField"]:"",valueField:BX.type.isNotEmptyString(this._data["valueField"])?this._data["valueField"]:"",dataProvider:BX.type.isArray(this._data["items"])?this._data["items"]:[],labelsEnabled:false,depth3D:15,angle:30,outlineAlpha:.4,outlineColor:"#FFFFFF",outlineThickness:1,legend:{markerType:"circle",position:"right",marginRight:10,autoMargins:false}})};BX.CrmPieWidget.prototype.innerClearLayout=function(){if(this._chart){this._chart.clear();this._chart=null}};BX.CrmPieWidget.prototype.ensureConfigEditorCreated=function(){if(!this._configEditor){this._configEditor=BX.CrmWidgetManager.getCurrent().createConfigEditor(this._entityTypeName,this._typeName,this._id+"_config",{widget:this,config:this._config,entityTypeName:this._entityTypeName})}};BX.CrmPieWidget.prototype.getHeight=function(){return BX.CrmWidgetLayoutHeight.full};BX.CrmPieWidget.prototype.invalidate=function(){if(this._chart){this._chart.invalidateSize()}};BX.CrmPieWidget.create=function(t,e){var i=new BX.CrmPieWidget;i.initialize(t,e);return i}}if(typeof BX.CrmCustomWidget==="undefined"){BX.CrmCustomWidget=function(){BX.CrmCustomWidget.superclass.constructor.apply(this)};BX.extend(BX.CrmCustomWidget,BX.CrmWidget);BX.CrmCustomWidget.prototype.renderLayout=function(){var t,e,i,n,r;var s=this.prepareButtons();this._settingButton=s["settings"];BX.addClass(this._wrapper,"crm-widget-number");var o=BX.type.isArray(this._data["items"])&&this._data["items"].length>0?this._data["items"][0]:null;if(!o){return}i=typeof o["display"]!=="undefined"?o["display"]:{};n=BX.CrmWidgetColorScheme.getInfo(BX.type.isNotEmptyString(i["colorScheme"])?i["colorScheme"]:"");if(n){this._wrapper.style.backgroundColor=n["color"]}this._headerWrapper=this.prepareHeader(BX.type.isNotEmptyString(o["title"])?o["title"]:this.getMessage("untitled"),s);this._wrapper.appendChild(this._headerWrapper);this._contentWrapper=BX.create("DIV",{attrs:{id:this._prefix+"_"+"content_wrapper",className:"crm-widget-content"}});this._wrapper.appendChild(this._contentWrapper);if(o["html"]){r=BX.create("DIV",{html:o["html"]})}else{t=BX.util.htmlspecialchars(o["text"]);e=BX.type.isNotEmptyString(o["url"])?BX.util.htmlspecialchars(o["url"]):"";r=e!==""?BX.create("A",{attrs:{className:"crm-widget-content-text"},props:{href:e},html:t,style:{fontSize:"48px",lineHeight:"56px",opacity:1}}):BX.create("SPAN",{attrs:{className:"crm-widget-content-text"},html:t,style:{fontSize:"48px",lineHeight:"56px",opacity:1}})}this._contentWrapper.appendChild(BX.create("DIV",{attrs:{className:"crm-widget-content-amt"},children:[r]}));this.ajustFontSize(this._wrapper.querySelectorAll(".crm-widget-content-text"));this._widowResizeHandler=BX.throttle(BX.delegate(this.onWidowResize,this),300);BX.bind(window,"resize",this._widowResizeHandler)};BX.CrmCustomWidget.prototype.innerClearLayout=function(){BX.unbind(window,"resize",this._widowResizeHandler);this._widowResizeHandler=null};BX.CrmCustomWidget.prototype.openConfigDialog=function(){var t=BX.type.isArray(this._data["items"])&&this._data["items"].length>0?this._data["items"][0]:null;if(!t){return}var e=BX.type.isNotEmptyString(t["url"])?t["url"]:"";if(e)window.location.href=e};BX.CrmCustomWidget.prototype.getHeight=function(){return BX.CrmWidgetLayoutHeight.half};BX.CrmCustomWidget.prototype.onWidowResize=function(t){if(this._hasLayout&&this._wrapper){this.ajustFontSize(this._wrapper.querySelectorAll(".crm-widget-content-text"))}};BX.CrmCustomWidget.prototype.ajustFontSize=function(t){var e=0;var i=0;var n=true;var r=true;var s=0;if(!t)return;for(var o=0;o<t.length;o++){e=parseInt(BX.style(t[o],"font-size"));if(!s)s=72;else s=53;n=t[o].offsetWidth>t[o].parentNode.offsetWidth-20;r=t[o].offsetWidth<t[o].parentNode.offsetWidth-20;while(t[o].offsetWidth>t[o].parentNode.offsetWidth-20&&n){e-=2;t[o].style.fontSize=e+"px";t[o].style.lineHeight=e+8+"px";r=false}while(t[o].offsetWidth<t[o].parentNode.offsetWidth-20&&e<s&&r){e+=2;t[o].style.fontSize=e+"px";t[o].style.lineHeight=e+8+"px";n=false}if(!i&&o>0)i=e;if(o>0)i=Math.min(i,e)}for(var a=0;a<t.length;a++){t[a].style.opacity=1;if(a>0){t[a].style.fontSize=i+"px";t[a].style.lineHeight=i+8+"px"}}};BX.CrmCustomWidget.create=function(t,e){var i=new BX.CrmCustomWidget;i.initialize(t,e);return i}}if(typeof BX.CrmGraphWidget==="undefined"){BX.CrmGraphWidget=function(){this._chart=null;this._chartWrapper=null;this._maxGraphCount=0;BX.CrmGraphWidget.superclass.constructor.apply(this)};BX.extend(BX.CrmGraphWidget,BX.CrmWidget);BX.CrmGraphWidget.prototype.doInitialize=function(){var t=this.getPanel();if(t){this._maxGraphCount=t.getMaxGraphCount()}};BX.CrmGraphWidget.prototype.prepareGraphSettings=function(t){var e={title:t["title"],valueField:t["selectField"],balloonText:"[[title]]: [[value]]"};var i=typeof t["display"]!=="undefined"?t["display"]:{};var n=typeof i["graph"]!=="undefined"?i["graph"]:{};var r=this._typeName;if(BX.type.isNotEmptyString(n["type"])){r=t["display"]["type"]}if(BX.type.isNotEmptyString(n["clustered"])){e["clustered"]=n["clustered"]==="Y"}var s=BX.CrmWidgetColorScheme.getInfo(BX.type.isNotEmptyString(i["colorScheme"])?i["colorScheme"]:"");if(s){e["lineColor"]=s["color"]}if(r==="bar"){e["type"]="column";e["fillAlphas"]=1}else{e["type"]="smoothedLine";e["lineThickness"]=2;e["bullet"]="round";e["bulletSize"]=7;e["bulletBorderAlpha"]=1}return e};BX.CrmGraphWidget.prototype.renderContent=function(){if(!AmCharts.isReady){if(BX.CrmWidgetPanel.isAjaxMode){AmCharts.handleLoad()}else{AmCharts.ready(BX.delegate(this.renderContent,this));return}}this._contentWrapper=BX.create("DIV",{attrs:{id:this._prefix+"_"+"content_wrapper",className:"crm-widget-content"}});this._wrapper.appendChild(this._contentWrapper);if(this._heightInPixel>0){this._contentWrapper.style.height=this._heightInPixel+"px";this._contentWrapper.style.overflow="visible"}var t=this.getPeriodDescription();if(t!==""){this._contentWrapper.appendChild(BX.create("SPAN",{attrs:{className:"crm-widget-content-period"},children:[BX.create("SPAN",{html:this.getMessage("periodCaption")+": "+t})]}))}var e=BX.type.isArray(this._data["items"])&&this._data["items"].length>0?this._data["items"][0]:{};var i=[];var n=BX.type.isArray(e["graphs"])?e["graphs"]:null;if(n){var r=this._maxGraphCount>0&&n.length<this._maxGraphCount?n.length:this._maxGraphCount;for(var s=0;s<r;s++){i.push(this.prepareGraphSettings(n[s]))}}else{i.push(this.prepareGraphSettings(e))}var o=BX.type.isArray(e["values"])?e["values"]:[];var a=BX.type.isNotEmptyString(e["groupField"])?e["groupField"]:"";var h={type:"serial",theme:"none",marginLeft:20,dataProvider:o,graphs:i,dataDateFormat:this._data["dateFormat"],categoryField:a,legend:{useGraphSettings:true,equalWidths:false,position:"bottom"},chartCursor:{enabled:true,oneBalloonOnly:true,categoryBalloonEnabled:true,categoryBalloonColor:"#000000"}};var l=BX.type.isPlainObject(this._config["format"])?this._config["format"]:{};if(BX.type.isNotEmptyString(l["isCurrency"])&&l["isCurrency"]==="Y"){var g=this.getPanel().getCurrencyFormat();if(BX.type.isPlainObject(g)){h["numberFormatter"]={decimalSeparator:g["DEC_POINT"],thousandsSeparator:g["THOUSANDS_SEP"]}}}if(this._typeName==="bar"&&i.length>0){var d={id:"v1",axisAlpha:.3,gridAlpha:0};if(BX.type.isNotEmptyString(this._config["enableStack"])&&this._config["enableStack"]==="Y"){d["stackType"]="regular"}if(BX.type.isNotEmptyString(this._config["integersOnly"])&&this._config["integersOnly"]==="Y"){d["integersOnly"]=true}h["valueAxes"]=[d]}if(a==="DATE"){var c=[];var p=[];for(var u=1;u<=12;u++){c.push(BX.message["MONTH_"+u.toString()]);p.push(BX.message["MON_"+u.toString()])}AmCharts.monthNames=c;AmCharts.shortMonthNames=p;var f=BX.message("FORMAT_DATE");var _=f.indexOf("D")<f.indexOf("M")?"DD MMM":"MMM DD";h["chartCursor"]["categoryBalloonDateFormat"]=_;h["categoryAxis"]={parseDates:true,minPeriod:"DD",dateFormats:[{period:"fff",format:"JJ:NN:SS"},{period:"ss",format:"JJ:NN:SS"},{period:"mm",format:"JJ:NN"},{period:"hh",format:"JJ:NN"},{period:"DD",format:_},{period:"WW",format:_},{period:"MM",format:"MMM"},{period:"YYYY",format:"YYYY"}]}}else if(a==="USER"){h["categoryAxis"]={labelRotation:o.length<5?0:45}}this._chartWrapper=BX.create("DIV",{attrs:{id:this._prefix+"_chart_wrapper"}});this._contentWrapper.appendChild(this._chartWrapper);if(this._heightInPixel>0){this._chartWrapper.style.height=this._heightInPixel-40+"px"}this._chart=AmCharts.makeChart(this._chartWrapper.id,h)};BX.CrmGraphWidget.prototype.innerClearLayout=function(){if(this._chart){this._chart.clear();this._chart=null}};BX.CrmGraphWidget.prototype.ensureConfigEditorCreated=function(){if(!this._configEditor){this._configEditor=BX.CrmWidgetManager.getCurrent().createConfigEditor(this._entityTypeName,this._typeName,this._id+"_config",{widget:this,config:this._config,enableTitle:true,maxGraphCount:this.getMaxGraphCount(),entityTypeName:this.getEntityTypeName()})}};BX.CrmGraphWidget.prototype.getHeight=function(){return BX.CrmWidgetLayoutHeight.full};BX.CrmGraphWidget.prototype.invalidate=function(){if(this._chart){this._chart.invalidateSize()}};BX.CrmGraphWidget.prototype.getMaxGraphCount=function(){return this._maxGraphCount};BX.CrmGraphWidget.create=function(t,e){var i=new BX.CrmGraphWidget;i.initialize(t,e);return i}}if(typeof BX.CrmRatingWidget==="undefined"){BX.CrmRatingWidget=function(){BX.CrmRatingWidget.superclass.constructor.apply(this)};BX.extend(BX.CrmRatingWidget,BX.CrmWidget);BX.CrmRatingWidget.prototype.renderContent=function(){BX.addClass(this._wrapper,"crm-widget-rating");this._contentWrapper=BX.create("DIV",{attrs:{id:this._prefix+"_"+"content_wrapper",className:"crm-widget-content"}});this._wrapper.appendChild(this._contentWrapper);var t=BX.create("DIV",{attrs:{className:"crm-widget-content-rating"}});this._contentWrapper.appendChild(t);var e=this.getPeriodDescription();if(e!==""){this._contentWrapper.appendChild(BX.create("SPAN",{attrs:{className:"crm-widget-content-period"},children:[BX.create("SPAN",{html:this.getMessage("periodCaption")+": "+e})]}))}var i=BX.type.isArray(this._data["items"])&&this._data["items"].length>0?this._data["items"][0]:{};var n=parseInt(i["nomineeId"]);var r=BX.type.isArray(i["positions"])?i["positions"]:[];var s;var o=-1;for(s=0;s<r.length;s++){if(parseInt(r[s]["id"])===n){o=s;break}}var a;if(o>=0){var h=r[o];a=BX.type.isNotEmptyString(h["legendType"])&&h["legendType"]==="html"?h["legend"]:BX.util.htmlspecialchars(h["legend"]);t.appendChild(BX.create("DIV",{attrs:{className:"crm-widget-rating-position"},children:[BX.create("DIV",{attrs:{className:"crm-widget-rating-position-inner"},children:[BX.create("SPAN",{attrs:{className:"crm-widget-rating-pl"},text:this.getMessage("nomineeRatingPosition").replace("#POSITION#",h["value"])}),BX.create("SPAN",{attrs:{className:"crm-widget-rating-result"},children:[BX.create("SPAN",{html:BX.util.htmlspecialchars(this.getMessage("legend")).replace("#LEGEND#",a)})]})]})]}))}var l=BX.create("DIV",{attrs:{className:"crm-widget-rating-positions"}});t.appendChild(l);for(s=0;s<r.length;s++){var g=r[s];var d=parseInt(g["id"]);if(d===n){continue}a=BX.type.isNotEmptyString(g["legendType"])&&g["legendType"]==="html"?g["legend"]:BX.util.htmlspecialchars(g["legend"]);l.appendChild(BX.create("DIV",{attrs:{className:"crm-widget-rating-position"},children:[this.getMessage("ratingPosition").replace("#POSITION#",g["value"]),BX.create("SPAN",{attrs:{className:"crm-widget-rating-result"},children:[BX.create("SPAN",{html:BX.util.htmlspecialchars(this.getMessage("legend")).replace("#LEGEND#",a)})]})]}))}};BX.CrmRatingWidget.prototype.ensureConfigEditorCreated=function(){if(!this._configEditor){this._configEditor=BX.CrmWidgetManager.getCurrent().createConfigEditor(this._entityTypeName,this._typeName,this._id+"_config",{widget:this,config:this._config,entityTypeName:this.getEntityTypeName()})}};BX.CrmRatingWidget.prototype.getHeight=function(){return BX.CrmWidgetLayoutHeight.half};BX.CrmRatingWidget.create=function(t,e){var i=new BX.CrmRatingWidget;i.initialize(t,e);return i}}if(typeof BX.CrmNumericWidget==="undefined"){BX.CrmNumericWidget=function(){BX.CrmNumericWidget.superclass.constructor.apply(this);this._widowResizeHandler=null};BX.extend(BX.CrmNumericWidget,BX.CrmWidget);BX.CrmNumericWidget.prototype.doInitialize=function(){};BX.CrmNumericWidget.prototype.getTitle=function(){var t=BX.type.isNotEmptyString(this._config["title"])?this._config["title"]:"";if(BX.type.isArray(this._data["items"])&&this._data["items"].length>0&&BX.type.isNotEmptyString(this._data["items"][0]["title"])){t=this._data["items"][0]["title"]}return t};BX.CrmNumericWidget.prototype.renderLayout=function(){var t,e,i,n,r;var s=this.prepareButtons();this._settingButton=s["settings"];var o=this.getPeriodDescription();if(this._layout==="tiled"){BX.addClass(this._wrapper,"crm-widget-total");var a,h,l;if(BX.type.isArray(this._data["items"])){if(this._data["items"].length>0){a=this._data["items"][0]}if(this._data["items"].length>1){h=this._data["items"][1]}if(this._data["items"].length>2){l=this._data["items"][2]}}if(!a){return}i=typeof a["display"]!=="undefined"?a["display"]:{};n=BX.CrmWidgetColorScheme.getInfo(BX.type.isNotEmptyString(i["colorScheme"])?i["colorScheme"]:"");var g=BX.create("DIV",{attrs:{className:"crm-widget-total-top"}});if(n){g.style.backgroundColor=n["color"]}this._wrapper.appendChild(g);this._headerWrapper=this.prepareHeader(BX.type.isNotEmptyString(a["title"])?a["title"]:this.getMessage("untitled"),s);g.appendChild(this._headerWrapper);this._contentWrapper=BX.create("DIV",{attrs:{id:this._prefix+"_"+"content_wrapper",className:"crm-widget-content"}});if(o!==""){this._contentWrapper.appendChild(BX.create("SPAN",{attrs:{className:"crm-widget-content-period"},children:[BX.create("SPAN",{html:this.getMessage("periodCaption")+": "+o})]}))}t=this.prepareItemHtml(a);e=BX.type.isNotEmptyString(a["url"])?a["url"]:"";r=e!==""?BX.create("A",{attrs:{className:"crm-widget-content-text"},props:{href:e},html:t,style:{fontSize:"48px",lineHeight:"56px",opacity:1}}):BX.create("SPAN",{attrs:{className:"crm-widget-content-text"},html:t,style:{fontSize:"48px",lineHeight:"56px",opacity:1}});this._contentWrapper.appendChild(BX.create("DIV",{attrs:{className:"crm-widget-content-amt"},children:[r]}));g.appendChild(this._contentWrapper);var d=BX.create("DIV",{attrs:{className:"crm-widget-total-bottom"}});this._wrapper.appendChild(d);var c=BX.create("DIV",{attrs:{className:"crm-widget-total-left"}});d.appendChild(c);if(h){i=typeof h["display"]!=="undefined"?h["display"]:{};n=BX.CrmWidgetColorScheme.getInfo(BX.type.isNotEmptyString(i["colorScheme"])?i["colorScheme"]:"");if(n){c.style.backgroundColor=n["color"]}var p=this.prepareHeader(BX.type.isNotEmptyString(h["title"])?h["title"]:this.getMessage("untitled"));c.appendChild(p);t=this.prepareItemHtml(h);e=BX.type.isNotEmptyString(h["url"])?h["url"]:"";r=e!==""?BX.create("A",{attrs:{className:"crm-widget-content-text"},props:{href:e},html:t,style:{fontSize:"48px",lineHeight:"56px",opacity:1}}):BX.create("SPAN",{attrs:{className:"crm-widget-content-text"},html:t,style:{fontSize:"48px",lineHeight:"56px",opacity:1}});var u=BX.create("DIV",{attrs:{className:"crm-widget-content"},children:[BX.create("DIV",{attrs:{className:"crm-widget-content-amt"},children:[r]})]});c.appendChild(u)}var f=BX.create("DIV",{attrs:{className:"crm-widget-total-right"}});d.appendChild(f);if(l){i=typeof l["display"]!=="undefined"?l["display"]:{};n=BX.CrmWidgetColorScheme.getInfo(BX.type.isNotEmptyString(i["colorScheme"])?i["colorScheme"]:"");if(n){f.style.backgroundColor=n["color"]}var _=this.prepareHeader(BX.type.isNotEmptyString(l["title"])?l["title"]:this.getMessage("untitled"));f.appendChild(_);t=this.prepareItemHtml(l);e=BX.type.isNotEmptyString(l["url"])?l["url"]:"";r=e!==""?BX.create("A",{attrs:{className:"crm-widget-content-text"},props:{href:e},html:t,style:{fontSize:"48px",lineHeight:"56px",opacity:1}}):BX.create("SPAN",{attrs:{className:"crm-widget-content-text"},html:t,style:{fontSize:"48px",lineHeight:"56px",opacity:1}});var m=BX.create("DIV",{attrs:{className:"crm-widget-content"},children:[BX.create("DIV",{attrs:{className:"crm-widget-content-amt"},children:[r]})]});f.appendChild(m)}}else{BX.addClass(this._wrapper,"crm-widget-number");var C=BX.type.isArray(this._data["items"])&&this._data["items"].length>0?this._data["items"][0]:null;if(!C){return}i=typeof C["display"]!=="undefined"?C["display"]:{};n=BX.CrmWidgetColorScheme.getInfo(BX.type.isNotEmptyString(i["colorScheme"])?i["colorScheme"]:"");if(n){this._wrapper.style.backgroundColor=n["color"]}this._headerWrapper=this.prepareHeader(BX.type.isNotEmptyString(C["title"])?C["title"]:this.getMessage("untitled"),s);this._wrapper.appendChild(this._headerWrapper);this._contentWrapper=BX.create("DIV",{attrs:{id:this._prefix+"_"+"content_wrapper",className:"crm-widget-content"}});this._wrapper.appendChild(this._contentWrapper);t=this.prepareItemHtml(C);e=BX.type.isNotEmptyString(C["url"])?C["url"]:"";r=e!==""?BX.create("A",{attrs:{className:"crm-widget-content-text"},props:{href:e},html:t,style:{fontSize:"48px",lineHeight:"56px",opacity:1}}):BX.create("SPAN",{attrs:{className:"crm-widget-content-text"},html:t,style:{fontSize:"48px",lineHeight:"56px",opacity:1}});if(o!==""){this._contentWrapper.appendChild(BX.create("SPAN",{attrs:{className:"crm-widget-content-period"},children:[BX.create("SPAN",{html:this.getMessage("periodCaption")+": "+o})]}))}this._contentWrapper.appendChild(BX.create("DIV",{attrs:{className:"crm-widget-content-amt"},children:[r]}))}this.ajustFontSize(this._wrapper.querySelectorAll(".crm-widget-content-text"));this._widowResizeHandler=BX.throttle(BX.delegate(this.onWidowResize,this),300);BX.bind(window,"resize",this._widowResizeHandler)};BX.CrmNumericWidget.prototype.prepareItemHtml=function(t){var e="";if(BX.type.isNotEmptyString(t["html"])){e=t["html"]}else if(BX.type.isNotEmptyString(t["text"])){e=BX.util.htmlspecialchars(t["text"])}else if(BX.type.isNotEmptyString(t["value"])){var i=t["value"];var n=typeof t["format"]!=="undefined"?t["format"]:{};if(BX.type.isNotEmptyString(n["isPercent"])&&n["isPercent"]==="Y"){i+="%"}e=BX.util.htmlspecialchars(i)}return e};BX.CrmNumericWidget.prototype.innerClearLayout=function(){BX.unbind(window,"resize",this._widowResizeHandler);this._widowResizeHandler=null};BX.CrmNumericWidget.prototype.ensureConfigEditorCreated=function(){if(!this._configEditor){this._configEditor=BX.CrmWidgetManager.getCurrent().createConfigEditor(this._entityTypeName,this._typeName,this._id+"_config",{widget:this,config:this._config,entityTypeName:this.getEntityTypeName()})}};BX.CrmNumericWidget.prototype.getHeight=function(){return this._layout==="tiled"?BX.CrmWidgetLayoutHeight.full:BX.CrmWidgetLayoutHeight.half};BX.CrmNumericWidget.prototype.onWidowResize=function(t){if(this._hasLayout&&this._wrapper){this.ajustFontSize(this._wrapper.querySelectorAll(".crm-widget-content-text"))}};BX.CrmNumericWidget.prototype.ajustFontSize=function(t){var e=0;var i=0;var n=true;var r=true;var s=0;if(!t)return;for(var o=0;o<t.length;o++){e=parseInt(BX.style(t[o],"font-size"));if(!s)s=72;else s=53;n=t[o].offsetWidth>t[o].parentNode.offsetWidth-20;r=t[o].offsetWidth<t[o].parentNode.offsetWidth-20;while(t[o].offsetWidth>t[o].parentNode.offsetWidth-20&&n){e-=2;t[o].style.fontSize=e+"px";t[o].style.lineHeight=e+8+"px";r=false}while(t[o].offsetWidth<t[o].parentNode.offsetWidth-20&&e<s&&r){e+=2;t[o].style.fontSize=e+"px";t[o].style.lineHeight=e+8+"px";n=false}if(!i&&o>0)i=e;if(o>0)i=Math.min(i,e)}for(var a=0;a<t.length;a++){t[a].style.opacity=1;if(a>0){t[a].style.fontSize=i+"px";t[a].style.lineHeight=i+8+"px"}}};BX.CrmNumericWidget.create=function(t,e){var i=new BX.CrmNumericWidget;i.initialize(t,e);return i}}if(typeof BX.CrmWidgetConfigEditor==="undefined"){BX.CrmWidgetConfigEditor=function(){this._id="";this._settings=null;this._entityTypeName="";this._widget=null;this._config=null;this._enableTitle=false;this._dlg=null;this._container=null;this._leadingWrapper=null;this._titleEditor=null;this._period=null;

this._extraEditors=null};BX.CrmWidgetConfigEditor.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"";this._settings=e?e:{};this._entityTypeName=this.getSetting("entityTypeName","");this._widget=this.getSetting("widget");if(!this._widget){throw"BX.CrmWidgetConfigEditor: Could not find widget parameter."}this._config=this.getSetting("config");if(!this._config){throw"BX.CrmWidgetConfigEditor: Could not find config parameter."}this._enableTitle=this.getSetting("enableTitle",false);this._extraEditors=this.getSetting("extraEditors");if(!BX.type.isArray(this._extraEditors)){this._extraEditors=[]}this.doInitialize()},doInitialize:function(){},getId:function(){return this._id},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getMessage:function(t){var e=BX.CrmWidgetConfigEditor.messages;return e.hasOwnProperty(t)?e[t]:t},getEntityTypeName:function(){return this._entityTypeName},openDialog:function(){if(this._dlg){return}var t=this._id;this._dlg=new BX.PopupWindow(t,null,{autoHide:false,draggable:true,bindOptions:{forceBindPosition:false},closeByEsc:false,closeIcon:{top:"10px",right:"15px"},zIndex:0,titleBar:this.getMessage("dialogTitle")+" ("+BX.CrmEntityType.getCaptionByName(this._entityTypeName).toLowerCase()+")",content:this.prepareDialogContent(),buttons:[new BX.PopupWindowButton({text:this.getMessage("dialogSaveButton"),className:"popup-window-button-accept",events:{click:BX.delegate(this.onDialogAcceptButtonClick,this)}}),new BX.PopupWindowButtonLink({text:this.getMessage("dialogCancelButton"),className:"popup-window-button-link-cancel",events:{click:BX.delegate(this.onDialogCancelButtonClick,this)}})],events:{onPopupShow:BX.delegate(this.onDialogShow,this),onPopupClose:BX.delegate(this.onDialogClose,this),onPopupDestroy:BX.delegate(this.onDialogDestroy,this)}});this._dlg.show()},closeDialog:function(){if(this._dlg){this._dlg.close()}},prepareDialogContent:function(){this._container=BX.create("DIV",{});this._leadingWrapper=BX.create("DIV",{attrs:{className:"container-item"}});this._container.appendChild(this._leadingWrapper);if(this._enableTitle){this._titleEditor=BX.CrmWidgetConfigTitleEditor.create(this._id,{config:this._config,backgroundColor:"#b0b6bc",enableBackgroundColorChange:false});this._titleEditor.prepareLayout(this._leadingWrapper)}var t=BX.type.isPlainObject(this._config["filter"])?this._config["filter"]:{};this._period=BX.CrmWidgetConfigPeriodEditor.create(this._id+"_period",{isNested:true,config:t});this._period.prepareLayout(this._leadingWrapper);var e=BX.type.isPlainObject(t["extras"])?t["extras"]:{};for(var i=0,n=this._extraEditors.length;i<n;i++){this._extraEditors[i].setConfig(e);this._extraEditors[i].prepareLayout(this._leadingWrapper,i%2>0?"left":"right")}this.innerPrepareDialogContent(this._container);return this._container},innerPrepareDialogContent:function(t){},reset:function(){},getWidget:function(){return this._widget},getWidgetTypeName:function(){return this._widget.getTypeName()},getConfig:function(){return this._config},saveConfig:function(){if(this._entityTypeName!==""){this._config["entityTypeName"]=this._entityTypeName}if(this._enableTitle&&this._titleEditor){this._titleEditor.saveConfig();this._titleEditor.copyToConfig(this._config)}this._period.saveConfig();if(!BX.type.isPlainObject(this._config["filter"])){this._config["filter"]={}}this._period.copyToConfig(this._config["filter"]);if(!BX.type.isPlainObject(this._config["filter"]["extras"])){this._config["filter"]["extras"]={}}for(var t=0,e=this._extraEditors.length;t<e;t++){this._extraEditors[t].saveConfig();this._extraEditors[t].copyToConfig(this._config["filter"]["extras"])}this.innerSaveConfig()},innerSaveConfig:function(){},onDialogShow:function(){},onDialogClose:function(){if(this._dlg){this.reset();this._dlg.destroy()}},onDialogDestroy:function(){this._dlg=null},onDialogAcceptButtonClick:function(){this._widget.processConfigSave();this.closeDialog()},onDialogCancelButtonClick:function(){this.closeDialog()}};if(typeof BX.CrmWidgetConfigEditor.messages==="undefined"){BX.CrmWidgetConfigEditor.messages={}}BX.CrmWidgetConfigEditor.createSelect=function(t,e){var i=BX.create("SELECT",t);this.setupSelectOptions(i,e);return i};BX.CrmWidgetConfigEditor.setupSelectOptions=function(t,e){var i=t.value;var n=false;while(t.options.length>0){t.remove(0)}var r=null;var s="";for(var o=0;o<e.length;o++){var a=e[o];var h=BX.type.isNotEmptyString(a["group"])?a["group"]:"";if(h!==""&&h!==s){s=h;r=document.createElement("OPTGROUP");r.label=h;t.appendChild(r)}var l=BX.type.isNotEmptyString(a["value"])?a["value"]:"";var g=BX.type.isNotEmptyString(a["text"])?a["text"]:a["value"];if(!n&&l===i){n=true}var d=new Option(g,l,false,false);if(BX.type.isBoolean(a["disabled"])&&a["disabled"]){d.disabled=true}var c=BX.type.isPlainObject(a["attrs"])?a["attrs"]:null;if(c){for(var p in c){if(!c.hasOwnProperty(p)){continue}d.setAttribute("data-"+p,c[p])}}if(r){r.appendChild(d)}else{if(!BX.browser.IsIE()){t.add(d,null)}else{try{t.add(d,t.options[null])}catch(u){t.add(d,null)}}}}if(n){t.value=i}};BX.CrmWidgetConfigEditor.create=function(t,e){var i=new BX.CrmWidgetConfigEditor;i.initialize(t,e);return i}}if(typeof BX.CrmWidgetConfigPeriodEditor==="undefined"){BX.CrmWidgetConfigPeriodEditor=function(){this._id="";this._settings=null;this._isNested=false;this._enableEmpty=true;this._config=null;this._period="";this._curYear=0;this._curMonth=0;this._curQuarter=0;this._year=0;this._quarter=0;this._month=0;this._periodSelector=null;this._yearSelector=null;this._quarterSelector=null;this._monthSelector=null;this._yearSelectorWrapper=null;this._quarterSelectorWrapper=null;this._monthSelectorWrapper=null;this._periodChangeHandler=BX.delegate(this.onPeriodChange,this);this._yearChangeHandler=BX.delegate(this.onYearChange,this);this._quarterChangeHandler=BX.delegate(this.onQuarterChange,this);this._monthChangeHandler=BX.delegate(this.onMonthChange,this);this._changeNotifier=null};BX.CrmWidgetConfigPeriodEditor.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"";this._settings=e?e:{};this._isNested=this.getSetting("isNested",false);this._config=this.getSetting("config",{});this._period=BX.type.isNotEmptyString(this._config["periodType"])?this._config["periodType"].toUpperCase():this.getDefaultPeriod();this._enableEmpty=BX.type.isBoolean(this._config["enableEmpty"])?this._config["enableEmpty"]:true;var i=new Date;this._curYear=i.getFullYear();this._curMonth=i.getMonth()+1;this._curQuarter=this._curMonth>=10?4:this._curMonth>=7?3:this._curMonth>=4?2:1;this._year=typeof this._config["year"]!=="undefined"?parseInt(this._config["year"]):this._curYear;this._quarter=typeof this._config["quarter"]!=="undefined"?parseInt(this._config["quarter"]):this._curQuarter;this._month=typeof this._config["month"]!=="undefined"?parseInt(this._config["month"]):this._curMonth;this._changeNotifier=BX.CrmNotifier.create(this);var n=this.getSetting("controls");if(BX.type.isPlainObject(n)){this._yearSelectorWrapper=BX(n["yearWrap"]);this._quarterSelectorWrapper=BX(n["quarterWrap"]);this._monthSelectorWrapper=BX(n["monthWrap"]);this._periodSelector=BX(n["period"]);BX.CrmWidgetConfigEditor.setupSelectOptions(this._periodSelector,this.preparePeriodListItems());this._periodSelector.value=this._period;BX.bind(this._periodSelector,"change",this._periodChangeHandler);this._yearSelector=BX(n["year"]);BX.CrmWidgetConfigEditor.setupSelectOptions(this._yearSelector,this.prepareYearListItems());this._yearSelector.value=this._year;BX.bind(this._yearSelector,"change",this._yearChangeHandler);this._quarterSelector=BX(n["quarter"]);BX.CrmWidgetConfigEditor.setupSelectOptions(this._quarterSelector,this.prepareQuarterListItems());this._quarterSelector.value=this._quarter;BX.bind(this._quarterSelector,"change",this._quarterChangeHandler);this._monthSelector=BX(n["month"]);BX.CrmWidgetConfigEditor.setupSelectOptions(this._monthSelector,this.prepareMonthListItems());this._monthSelector.value=this._month;BX.bind(this._monthSelector,"change",this._monthChangeHandler);this.adjust()}BX.onCustomEvent(window,"CrmWidgetConfigPeriodEditorCreate",[this])},getId:function(){return this._id},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getMessage:function(t){var e=BX.CrmWidgetConfigPeriodEditor.messages;return e.hasOwnProperty(t)?e[t]:t},isNested:function(){return this._isNested},getDefaultPeriod:function(){return this.getSetting("defaultPeriodType",BX.CrmWidgetFilterPeriod.undefined)},getPeriod:function(){return this._period},setPeriod:function(t){this._period=t;this._periodSelector.value=t;this.adjust();this._changeNotifier.notify()},getYear:function(){return this._year},setYear:function(t){this._year=t;this._yearSelector.value=t;this._changeNotifier.notify()},getQuarter:function(){return this._quarter},setQuarter:function(t){this._quarter=t;this._quarterSelector.value=t;this._changeNotifier.notify()},getMonth:function(){return this._month},setMonth:function(t){this._month=t;this._monthSelector.value=t;this._changeNotifier.notify()},addChangeListener:function(t){this._changeNotifier.addListener(t)},removeChangeListener:function(t){this._changeNotifier.removeListener(t)},prepareYearListItems:function(){var t=[];for(var e=this._curYear-20;e<=this._curYear+20;e++){t.push({value:e.toString(),text:e.toString()})}return t},prepareQuarterListItems:function(){return[{value:"1",text:"I"},{value:"2",text:"II"},{value:"3",text:"III"},{value:"4",text:"IV"}]},prepareMonthListItems:function(){var t=[];var e=BX.CrmWidgetConfigPeriodEditor.getMonthNames();for(var i=1;i<=12;i++){t.push({value:i.toString(),text:e[i-1]})}return t},preparePeriodListItems:function(){return!this._isNested?BX.CrmWidgetFilterPeriod.prepareListItems({},!this._enableEmpty):this._enableEmpty?BX.CrmWidgetFilterPeriod.prepareListItems({"":this.getMessage("accordingToFilter")},false):BX.CrmWidgetFilterPeriod.prepareListItems({},true)},prepareLayout:function(t){this._periodSelector=BX.CrmWidgetConfigEditor.createSelect({events:{change:this._periodChangeHandler}},this.preparePeriodListItems());this._periodSelector.value=this._period;this._yearSelector=BX.CrmWidgetConfigEditor.createSelect({events:{change:this._yearChangeHandler}},this.prepareYearListItems());this._yearSelector.value=this._year;this._yearSelectorWrapper=BX.create("SPAN",{attrs:{className:"select-container select-container-period select-container-period-year"},children:[this._yearSelector]});this._quarterSelector=BX.CrmWidgetConfigEditor.createSelect({events:{change:this._quarterChangeHandler}},this.prepareQuarterListItems());this._quarterSelector.value=this._quarter;this._quarterSelectorWrapper=BX.create("SPAN",{attrs:{className:"select-container select-container-period select-container-period-quarter"},children:[this._quarterSelector]});this._monthSelector=BX.CrmWidgetConfigEditor.createSelect({events:{change:this._monthChangeHandler}},this.prepareMonthListItems());this._monthSelector.value=this._month;this._monthSelectorWrapper=BX.create("SPAN",{attrs:{className:"select-container select-container-period select-container-period-month"},children:[this._monthSelector]});t.appendChild(BX.create("DIV",{attrs:{className:"field-container field-container-period field-container-small field-container-left"},children:[BX.create("LABEL",{attrs:{className:"field-container-title"},text:this.getMessage("caption")+":"}),BX.create("SPAN",{attrs:{className:"select-container select-container-period"},children:[this._periodSelector]}),this._monthSelectorWrapper,this._quarterSelectorWrapper,this._yearSelectorWrapper]}));this.adjust()},resetLayout:function(){},saveConfig:function(){this._config["periodType"]=this._period;if(this._period===BX.CrmWidgetFilterPeriod.year||this._period===BX.CrmWidgetFilterPeriod.quarter||this._period===BX.CrmWidgetFilterPeriod.month){this._config["year"]=this._year}if(this._period===BX.CrmWidgetFilterPeriod.quarter){this._config["quarter"]=this._quarter}if(this._period===BX.CrmWidgetFilterPeriod.month){this._config["month"]=this._month}},getConfig:function(){return this._config},copyToConfig:function(t){if(this._config===t){return}var e=["periodType","year","quarter","month"];for(var i=0,n=e.length;i<n;i++){var r=e[i];if(this._config.hasOwnProperty(r)){t[r]=this._config[r]}else{delete t[r]}}},isEmpty:function(){return this._period===BX.CrmWidgetFilterPeriod.undefined},getDescription:function(){var t;if(this._period===BX.CrmWidgetFilterPeriod.undefined){return""}else if(this._period===BX.CrmWidgetFilterPeriod.year){return this.getMessage("yearDescription").replace(/#YEAR#/gi,this._year)}else if(this._period===BX.CrmWidgetFilterPeriod.quarter){var e=3*this._quarter;var i=e-2;t=BX.CrmWidgetConfigPeriodEditor.getMonthNames();return this.getMessage("quarterDescription").replace(/#YEAR#/gi,this._year).replace(/#FIRST_MONTH#/gi,t[i-1]).replace(/#LAST_MONTH#/gi,t[e-1])}else if(this._period===BX.CrmWidgetFilterPeriod.month){t=BX.CrmWidgetConfigPeriodEditor.getMonthNames();return this.getMessage("monthDescription").replace(/#YEAR#/gi,this._year).replace(/#MONTH#/gi,t[this._month-1])}else if(this._period===BX.CrmWidgetFilterPeriod.currentMonth){return BX.CrmWidgetFilterPeriod.getDescription(BX.CrmWidgetFilterPeriod.currentMonth).toLowerCase()}else if(this._period===BX.CrmWidgetFilterPeriod.currentQuarter){return BX.CrmWidgetFilterPeriod.getDescription(BX.CrmWidgetFilterPeriod.currentQuarter).toLowerCase()}else if(this._period===BX.CrmWidgetFilterPeriod.lastDays90){return this.getMessage("lastDaysDescription").replace(/#DAYS#/gi,90)}else if(this._period===BX.CrmWidgetFilterPeriod.lastDays60){return this.getMessage("lastDaysDescription").replace(/#DAYS#/gi,60)}else if(this._period===BX.CrmWidgetFilterPeriod.lastDays30){return this.getMessage("lastDaysDescription").replace(/#DAYS#/gi,30)}else if(this._period===BX.CrmWidgetFilterPeriod.lastDays7){return this.getMessage("lastDaysDescription").replace(/#DAYS#/gi,7)}return""},adjust:function(){this._yearSelectorWrapper.style.display=this._period===BX.CrmWidgetFilterPeriod.year||this._period===BX.CrmWidgetFilterPeriod.quarter||this._period===BX.CrmWidgetFilterPeriod.month?"":"none";this._quarterSelectorWrapper.style.display=this._period===BX.CrmWidgetFilterPeriod.quarter?"":"none";this._monthSelectorWrapper.style.display=this._period===BX.CrmWidgetFilterPeriod.month?"":"none"},onPeriodChange:function(t){this._period=this._periodSelector.value;this.adjust();this._changeNotifier.notify()},onYearChange:function(t){this._year=parseInt(this._yearSelector.value);this._changeNotifier.notify()},onQuarterChange:function(t){this._quarter=parseInt(this._quarterSelector.value);this._changeNotifier.notify()},onMonthChange:function(t){this._month=parseInt(this._monthSelector.value);this._changeNotifier.notify()}};BX.CrmWidgetConfigPeriodEditor.monthNames=null;BX.CrmWidgetConfigPeriodEditor.getMonthNames=function(){if(!this.monthNames){this.monthNames=[];for(var t=1;t<=12;t++){this.monthNames.push(BX.message["MONTH_"+t.toString()])}}return this.monthNames};if(typeof BX.CrmWidgetConfigPeriodEditor.messages==="undefined"){BX.CrmWidgetConfigPeriodEditor.messages={}}BX.CrmWidgetConfigPeriodEditor.items={};BX.CrmWidgetConfigPeriodEditor.create=function(t,e){var i=new BX.CrmWidgetConfigPeriodEditor;i.initialize(t,e);this.items[i.getId()]=i;return i}}if(typeof BX.CrmWidgetConfigTitleEditor==="undefined"){BX.CrmWidgetConfigTitleEditor=function(){this._id="";this._settings=null;this._config=null;this._mode=BX.CrmWidgetConfigControlMode.undifined;this._title="";this._titleBackgroundColor="";this._letter="";this._schemeId="";this._titleInput=null;this._titleEditButton=null;this._titleSaveButton=null;this._schemeSelectButton=null;this._enableScemeChange=true;this._deleteButton=null;this._enableDeletion=false;this._wrapper=null;this._titleViewContainer=null;this._titleEditContainer=null;this._titleWrapper=null;this._inputKeyDownHandler=BX.delegate(this.onInputKeyDown,this);this._titleEitButtonClickHandler=BX.delegate(this.onTitleEditButtonClick,this);this._titleSaveButtonClickHandler=BX.delegate(this.onTitleSaveButtonClick,this);this._schemeSelectButtonCkickHandler=BX.delegate(this.onSchemeSelectButtonClick,this);this._isSchemeMenuShown=false;this._schemeMenuId="";this._schemeMenu=null;this._schemeMenuHandler=BX.delegate(this.onSchemeMenuItemClick,this);this._schemeChangeNotifier=null;this._deleteButtonCkickHandler=BX.delegate(this.onDeleteButtonClick,this);this._deletionNotifier=null};BX.CrmWidgetConfigTitleEditor.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"";this._settings=e?e:{};this._config=this.getSetting("config",{});this._title=BX.type.isNotEmptyString(this._config["title"])?this._config["title"]:"";this._letter=this.getSetting("letter","");this._titleBackgroundColor=this.getSetting("backgroundColor","#22d02c");if(BX.type.isPlainObject(this._config["display"])&&BX.type.isNotEmptyString(this._config["display"]["colorScheme"])){this._schemeId=this._config["display"]["colorScheme"];var i=BX.CrmWidgetColorScheme.getInfo(this._schemeId);if(i){this._titleBackgroundColor=i["color"]}}this._mode=BX.CrmWidgetConfigControlMode.view;this._enableScemeChange=this.getSetting("enableBackgroundColorChange",true);this._schemeChangeNotifier=BX.CrmNotifier.create(this);this._enableDeletion=this.getSetting("enableDeletion",false);this._deletionNotifier=BX.CrmNotifier.create(this)},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getMessage:function(t){var e=BX.CrmWidgetConfigTitleEditor.messages;return e.hasOwnProperty(t)?e[t]:t},getId:function(){return this._id},getTitle:function(){return this._title},setTitle:function(t){this._title=t;if(this._titleInput){this._titleInput.value=t}if(this._titleViewContainer){this._titleViewContainer.innerHTML=BX.util.htmlspecialchars(t)}},getName:function(){return this._name},getTitleBackgroundColor:function(){return this._titleBackgroundColor},prepareLayout:function(t){this._titleEditButton=BX.create("SPAN",{attrs:{className:"field-title-icon-edit"},events:{click:this._titleEitButtonClickHandler}});this._titleSaveButton=BX.create("SPAN",{attrs:{className:"field-title-icon-ready"},events:{click:this._titleSaveButtonClickHandler},style:{display:"none"}});var e=this._title!==""?this._title:this.getMessage("untitled");this._titleViewContainer=BX.create("SPAN",{attrs:{className:"title-name"},text:e});this._titleInput=BX.create("INPUT",{props:{type:"text",placeholder:this.getTitle("placeholder")}});this._titleEditContainer=BX.create("SPAN",{attrs:{className:"fiedl-title-input-container"},children:[this._titleInput],style:{display:"none"}});var i=[];if(this._letter!==""){i.push(BX.create("SPAN",{attrs:{className:"field-title-letter"},text:this._letter}))}i.push(this._titleViewContainer);i.push(this._titleEditContainer);this._titleWrapper=BX.create("SPAN",{attrs:{className:"field-title-title-inner"},children:[BX.create("SPAN",{attrs:{className:"field-title-name"},children:i}),this._titleEditButton,this._titleSaveButton]});var n=BX.create("DIV",{attrs:{className:"field-title-panel"}});if(this._enableScemeChange){this._schemeSelectButton=BX.create("DIV",{attrs:{className:"field-title-panel-button field-title-button-bucket"},events:{click:this._schemeSelectButtonCkickHandler}});n.appendChild(this._schemeSelectButton)}if(this._enableDeletion){this._deleteButton=BX.create("DIV",{attrs:{className:"field-title-panel-button field-title-button-close"},events:{click:this._deleteButtonCkickHandler}});n.appendChild(this._deleteButton)}this._wrapper=BX.create("DIV",{attrs:{className:"field-title"},style:{backgroundColor:this._titleBackgroundColor},children:[n,BX.create("SPAN",{attrs:{className:"field-title-title"},children:[this._titleWrapper]})]});t.appendChild(this._wrapper);return t},resetLayout:function(){if(this._schemeMenu&&this._schemeMenu.popupWindow){this._schemeMenu.popupWindow.close()}if(this._titleEditButton){BX.unbind(this._titleEditButton,"click",this._titleEitButtonClickHandler);this._titleEditButton=null}if(this._titleSaveButton){BX.unbind(this._titleSaveButton,"click",this._titleSaveButtonClickHandler);this._titleSaveButton=null}if(this._schemeSelectButton){BX.unbind(this._schemeSelectButton,"click",this._schemeSelectButtonCkickHandler);this._schemeSelectButton=null}this._titleInput=null;this._titleWrapper=null;this._titleViewContainer=null;this._titleEditContainer=null;BX.cleanNode(this._wrapper,true);this._wrapper=null},getConfig:function(){return this._config},getColorSchemeId:function(){return this._schemeId},saveConfig:function(){if(this._mode===BX.CrmWidgetConfigControlMode.edit){this.saveInputValue();this.switchMode(BX.CrmWidgetConfigControlMode.view)}this._config["title"]=this._title;if(this._schemeId!==""){if(typeof this._config["display"]==="undefined"){this._config["display"]={}}this._config["display"]["colorScheme"]=this._schemeId}else if(typeof this._config["display"]!=="undefined"){delete this._config["display"]["colorScheme"]}},copyToConfig:function(t){t["title"]=this._config["title"];if(BX.type.isPlainObject(this._config["display"])&&BX.type.isNotEmptyString(this._config["display"]["colorScheme"])){if(typeof t["display"]==="undefined"){t["display"]={}}t["display"]["colorScheme"]=this._config["display"]["colorScheme"]}else if(BX.type.isPlainObject(t["display"])&&BX.type.isNotEmptyString(t["display"]["colorScheme"])){delete t["display"]["colorScheme"]}},switchMode:function(t){if(this._mode===t){return}if(t===BX.CrmWidgetConfigControlMode.view){BX.unbind(this._titleInput,"keydown",this._inputKeyDownHandler);this._titleInput.blur();BX.removeClass(this._titleWrapper,"input-container-edit");this._titleSaveButton.style.display="none";this._titleEditContainer.style.display="none";this._titleEditButton.style.display="";this._titleViewContainer.style.display=""}else if(t===BX.CrmWidgetConfigControlMode.edit){BX.addClass(this._titleWrapper,"input-container-edit");this._titleEditButton.style.display="none";this._titleViewContainer.style.display="none";this._titleSaveButton.style.display="";this._titleEditContainer.style.display="";BX.bind(this._titleInput,"keydown",this._inputKeyDownHandler);this._titleInput.focus()}this._mode=t},addColorSchemeChangeListener:function(t){this._schemeChangeNotifier.addListener(t)},removeColorSchemeChangeListener:function(t){this._schemeChangeNotifier.removeListener(t)},addDeletionListener:function(t){this._deletionNotifier.addListener(t)},removeDeletionListener:function(t){this._deletionNotifier.removeListener(t)},onTitleEditButtonClick:function(t){this.initInputValue();this.switchMode(BX.CrmWidgetConfigControlMode.edit)},onTitleSaveButtonClick:function(t){this.saveInputValue();this.switchMode(BX.CrmWidgetConfigControlMode.view)},saveInputValue:function(){this._title=this._titleInput.value;this._titleViewContainer.innerHTML=this._title!==""?BX.util.htmlspecialchars(this._title):this.getMessage("untitled")},initInputValue:function(){this._titleInput.value=this._title},onInputKeyDown:function(t){if(this._mode!==BX.CrmWidgetConfigControlMode.edit){return}t=t||window.event;if(t.keyCode===13){this.saveInputValue();this.switchMode(BX.CrmWidgetConfigControlMode.view)}else if(t.keyCode===27){this.switchMode(BX.CrmWidgetConfigControlMode.view)}},onSchemeSelectButtonClick:function(t){if(!this._isSchemeMenuShown){this.openSchemeMenu()}else{this.closeSchemeMenu()}},onDeleteButtonClick:function(t){this._deletionNotifier.notify()},openSchemeMenu:function(){if(this._isSchemeMenuShown){return}this._schemeMenuId=this._id+"_scheme_menu";if(typeof BX.PopupMenu.Data[this._schemeMenuId]!=="undefined"){BX.PopupMenu.Data[this._schemeMenuId].popupWindow.destroy();delete BX.PopupMenu.Data[this._schemeMenuId]}this._schemeMenu=BX.PopupMenu.create(this._schemeMenuId,this._schemeSelectButton,BX.CrmWidgetColorScheme.prepareMenuItems(this._schemeMenuHandler),{autoHide:true,offsetLeft:-21,offsetTop:-3,angle:{position:"top",offset:42},events:{onPopupClose:BX.delegate(this.onSchemeMenuClose,this)}});this._schemeMenu.popupWindow.show();this._isSchemeMenuShown=true},closeSchemeMenu:function(){if(this._schemeMenu&&this._schemeMenu.popupWindow){this._schemeMenu.popupWindow.close()}},onSchemeMenuClose:function(){this._schemeMenu=null;if(typeof BX.PopupMenu.Data[this._schemeMenuId]!=="undefined"){BX.PopupMenu.Data[this._schemeMenuId].popupWindow.destroy();delete BX.PopupMenu.Data[this._schemeMenuId]}this._isSchemeMenuShown=false},onSchemeMenuItemClick:function(t,e){this._schemeId=e.id;var i=BX.CrmWidgetColorScheme.getInfo(this._schemeId);if(i&&this._wrapper){this._wrapper.style.backgroundColor=this._titleBackgroundColor=i["color"]}this.closeSchemeMenu();this._schemeChangeNotifier.notify()}};if(typeof BX.CrmWidgetConfigTitleEditor.messages==="undefined"){BX.CrmWidgetConfigTitleEditor.messages={}}BX.CrmWidgetConfigTitleEditor.create=function(t,e){var i=new BX.CrmWidgetConfigTitleEditor;i.initialize(t,e);return i}}if(typeof BX.CrmWidgetConfigPresetEditor==="undefined"){BX.CrmWidgetConfigPresetEditor=function(){this._id="";this._settings=null;this._config=null;this._entityTypeName="";this._isSemanticsSupported=true;this._extraGrouping="";this._contextId="";this._enableContextChange=true;this._semanticId="";this._categoryName="";this._preset=null;this._typeSelector=null;this._enableSemanticsChange=true;this._presetSelector=null;this._contextSwitches={};this._contextChangeHandler=BX.delegate(this.onContextChange,this);this._typeChangeHandler=BX.delegate(this.onTypeChange,this);this._presetChangeHandler=BX.delegate(this.onPresetChange,this);this._presetChangeCallback=null;this._extraEditors=null;this._container=null;this._semanticsWrapper=null;this._presetWrapper=null;this._hasLayout=false};BX.CrmWidgetConfigPresetEditor.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"";this._settings=e?e:{};this._config=this.getSetting("config",{});this._preset=BX.CrmWidgetDataPreset.getItem(BX.type.isNotEmptyString(this._config["dataPreset"])?this._config["dataPreset"]:this._config["name"]);this._entityTypeName=this._preset&&BX.type.isNotEmptyString(this._preset["entity"])?this._preset["entity"]:this.getSetting("entityTypeName","");this._isSemanticsSupported=BX.CrmPhaseSemantics.isSupported(this._entityTypeName);if(this._isSemanticsSupported){var i=BX.type.isPlainObject(this._config["filter"])?this._config["filter"]:{};this._semanticId=BX.type.isNotEmptyString(i["semanticID"])?i["semanticID"]:""}this._extraGrouping=this.getSetting("extraGrouping","");this._contextId=this.getSetting("context",BX.CrmWidgetDataContext.undefined);if(this._contextId===BX.CrmWidgetDataContext.undefined){this._contextId=this._preset?this._preset["context"]:BX.CrmWidgetDataContext.entity}this._categoryName=this.getSetting("category","");if(this._categoryName===""){this._categoryName=this._preset&&BX.type.isNotEmptyString(this._preset["category"])?this._preset["category"]:""}this._presetChangeCallback=this.getSetting("presetChange",null);this._enableContextChange=this.getSetting("enableContextChange",true);this._extraEditors=this.getSetting("extraEditors");if(!BX.type.isArray(this._extraEditors)){this._extraEditors=[]}},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getMessage:function(t){var e=BX.CrmWidgetConfigPresetEditor.messages;return e.hasOwnProperty(t)?e[t]:t},getId:function(){return this._id},prepareLayout:function(t,e){if(this._hasLayout){return}this._container=t;var i=null;if(this._enableContextChange){i=BX.create("SPAN",{attrs:{className:"radiobox-container"}});var n=BX.CrmWidgetDataContext.descriptions;for(var r in n){if(!n.hasOwnProperty(r)||r===BX.CrmWidgetDataContext.undefined){continue}var s=n[r];var o=this.getId()+"_data_context";var a=o+"_"+r.toLowerCase();this._contextSwitches[r]=BX.create("INPUT",{props:{type:"radio",id:a,name:o},events:{click:this._contextChangeHandler}});if(this._contextId===r){this._contextSwitches[r].checked=true}i.appendChild(this._contextSwitches[r]);i.appendChild(BX.create("LABEL",{attrs:{"for":a},text:s}))}}var h="";var l=[{value:"",text:this.getMessage("notSelected")}];if(this._isSemanticsSupported){h=BX.CrmPhaseSemantics.getSelectorTitle(this._entityTypeName);if(h===""){h=this.getMessage("semanticsCaption")}var g=BX.CrmPhaseSemantics.prepareListItems(this._entityTypeName);var d=BX.CrmPhaseSemantics.getGroupTitle(this._entityTypeName);for(var c=0;c<g.length;c++){var p=g[c];if(p["value"]!==""){p["attrs"]={context:"semantics"};p["group"]=d;l.push(p)}}}else{h=BX.CrmWidgetDataCategory.selectorTitle}if(h===""){h=this.getMessage("categoryCaption")}var u=BX.CrmWidgetDataCategory.prepareListItems(this._entityTypeName);var f,_;if(this._isSemanticsSupported){for(f=0;f<u.length;f++){_=u[f];if(_["value"]===""){continue}_["attrs"]={context:"category"};_["group"]=BX.CrmWidgetDataCategory.groupTitle;l.push(_)}}else{for(f=0;f<u.length;f++){_=u[f];if(_["value"]!==""){l.push(_)}}}this._typeSelector=BX.CrmWidgetConfigEditor.createSelect({events:{change:this._typeChangeHandler}},l);if(this._semanticId!==""){this._typeSelector.value=this._semanticId}else if(this._categoryName!==""){this._typeSelector.value=this._categoryName}this.adjustTypeSelector();this._presetSelector=BX.CrmWidgetConfigEditor.createSelect({events:{change:this._presetChangeHandler}},BX.CrmWidgetDataPreset.prepareListItems(this._entityTypeName,this._categoryName,this._contextId,this._extraGrouping));if(this._preset){this._presetSelector.value=this._preset["name"]}if(!BX.type.isNotEmptyString(e)){e=""}var m=BX.type.isPlainObject(this._config["filter"])?this._config["filter"]:{};var C=this._extraEditors.length;if(e==="wide"){this._semanticsWrapper=BX.create("DIV",{attrs:{className:"field-container field-container-left"},children:[BX.create("LABEL",{attrs:{className:"field-container-title"},text:h+":"}),BX.create("SPAN",{attrs:{className:"select-container"},children:[this._typeSelector]})]});t.appendChild(this._semanticsWrapper);this._presetWrapper=BX.create("DIV",{attrs:{className:"field-container field-container-right"},children:[BX.create("LABEL",{attrs:{className:"field-container-title"},text:this.getMessage("nameCaption")+":"}),BX.create("SPAN",{attrs:{className:"select-container"},children:[this._presetSelector]})]});t.appendChild(this._presetWrapper);if(this._enableContextChange){t.appendChild(BX.create("DIV",{attrs:{className:"field-container field-container-left"},children:[i]}))}var y=this._enableContextChange?["right","left"]:["left","right"];for(var B=0;B<C;B++){this._extraEditors[B].setConfig(m);this._extraEditors[B].prepareLayout(t,y[B%2===0?0:1])}}else{this._semanticsWrapper=BX.create("DIV",{attrs:{className:"field-container"},children:[BX.create("LABEL",{attrs:{className:"field-container-title"},text:h+":"}),BX.create("SPAN",{attrs:{className:"select-container"},children:[this._typeSelector]})]});t.appendChild(this._semanticsWrapper);if(this._enableContextChange){t.appendChild(BX.create("DIV",{attrs:{className:"field-container"},children:[i]}))}this._presetWrapper=BX.create("DIV",{attrs:{className:"field-container"},children:[BX.create("LABEL",{attrs:{className:"field-container-title"},text:this.getMessage("nameCaption")+":"}),BX.create("SPAN",{attrs:{className:"select-container"},children:[this._presetSelector]})]});t.appendChild(this._presetWrapper);for(var X=0;X<C;X++){var S=BX.create("DIV",{attrs:{className:"field-container"}});t.appendChild(S);this._extraEditors[X].setConfig(m);this._extraEditors[X].prepareLayout(S,"")}}this._hasLayout=true},resetLayout:function(){if(!this._hasLayout){return}if(this._presetSelector){BX.unbind(this._presetSelector,"change",this._presetChangeHandler);this._presetSelector=null}if(this._typeSelector){BX.unbind(this._typeSelector,"change",this._typeChangeHandler);this._typeSelector=null}for(var t in this._contextSwitches){if(!this._contextSwitches.hasOwnProperty(t)){continue}BX.unbind(this._contextSwitches[t],"click",this._contextChangeHandler);

}this._contextSwitches={};for(var e=0,i=this._extraEditors.length;e<i;e++){this._extraEditors[e].resetLayout()}this._semanticsWrapper=this._presetWrapper=null;BX.cleanNode(this._container,false);this._hasLayout=false},getContextId:function(){return this._preset?this._preset["context"]:this._contextId},setContextId:function(t){if(this._contextId===t){return}this._contextId=t;this.adjustTypeSelector();BX.CrmWidgetConfigEditor.setupSelectOptions(this._presetSelector,BX.CrmWidgetDataPreset.prepareListItems(this._entityTypeName,this._categoryName,this._contextId,this._extraGrouping))},getExtraGrouping:function(){return this._extraGrouping},setExtraGrouping:function(t){if(this._extraGrouping===t){return}this._extraGrouping=t;this.adjustTypeSelector();BX.CrmWidgetConfigEditor.setupSelectOptions(this._presetSelector,BX.CrmWidgetDataPreset.prepareListItems(this._entityTypeName,this._categoryName,this._contextId,this._extraGrouping))},saveConfig:function(){if(this._isSemanticsSupported){if(this._semanticId!==BX.CrmPhaseSemantics.undefined){if(!BX.type.isPlainObject(this._config["filter"])){this._config["filter"]={}}this._config["filter"]["semanticID"]=this._semanticId}else if(BX.type.isPlainObject(this._config["filter"])){delete this._config["filter"]["semanticID"]}}if(this._preset){if(this._config["title"]===""){this._config["title"]=this._preset["title"]}this._config["dataPreset"]=this._preset["name"];this._config["dataSource"]=this._preset["source"];this._config["select"]=this._preset["select"];var t=this.getContextId();if(t===BX.CrmWidgetDataContext.fund){if(!BX.type.isPlainObject(this._config["format"])){this._config["format"]={}}this._config["format"]["isCurrency"]="Y";this._config["format"]["enableDecimals"]="N"}else if(BX.type.isPlainObject(this._config["format"])){delete this._config["format"]["isCurrency"];delete this._config["format"]["enableDecimals"]}if(t===BX.CrmWidgetDataContext.percent){if(!BX.type.isPlainObject(this._config["format"])){this._config["format"]={}}this._config["format"]["isPercent"]="Y"}else if(BX.type.isPlainObject(this._config["format"])){delete this._config["format"]["isPercent"]}}if(this._extraEditors.length>0){if(!BX.type.isPlainObject(this._config["filter"])){this._config["filter"]={}}for(var e=0,i=this._extraEditors.length;e<i;e++){this._extraEditors[e].saveConfig();this._extraEditors[e].copyToConfig(this._config["filter"])}}},getConfig:function(){return this._config},adjustTypeSelector:function(){var t=false;for(var e=0,i=this._typeSelector.options.length;e<i;e++){var n=this._typeSelector.options[e];if(this._isSemanticsSupported&&n.getAttribute("data-context","")!=="category"){continue}var r=n.value;if(r===""){continue}var s=!BX.CrmWidgetDataPreset.hasItems(this._entityTypeName,r,this._contextId,this._extraGrouping);n.disabled=s;if(s&&e===this._typeSelector.selectedIndex){t=true}}if(t){this._typeSelector.value="";this.onTypeChange()}},onContextChange:function(t){if(this._contextId!==BX.CrmWidgetDataContext.fund&&this._contextSwitches[BX.CrmWidgetDataContext.fund].checked){this.setContextId(BX.CrmWidgetDataContext.fund)}else if(this._contextId!==BX.CrmWidgetDataContext.entity&&this._contextSwitches[BX.CrmWidgetDataContext.entity].checked){this.setContextId(BX.CrmWidgetDataContext.entity)}else if(this._contextId!==BX.CrmWidgetDataContext.percent&&this._contextSwitches[BX.CrmWidgetDataContext.percent].checked){this.setContextId(BX.CrmWidgetDataContext.percent)}},onTypeChange:function(t){if(!this._hasLayout){return}var e=this._typeSelector.selectedIndex;var i=e>=0?this._typeSelector.options[e]:null;if(!i){this._semanticId=BX.CrmPhaseSemantics.undefined;this._categoryName=""}else{if(!this._isSemanticsSupported){this._semanticId=BX.CrmPhaseSemantics.undefined;this._categoryName=i.value}else{var n=i.getAttribute("data-context","");if(n==="category"){this._semanticId=BX.CrmPhaseSemantics.undefined;this._categoryName=i.value}else{this._semanticId=i.value;this._categoryName=""}}}var r=this._presetSelector.value;BX.CrmWidgetConfigEditor.setupSelectOptions(this._presetSelector,BX.CrmWidgetDataPreset.prepareListItems(this._entityTypeName,this._categoryName,this._contextId,this._extraGrouping));for(var s=0;s<this._presetSelector.options.length;s++){if(this._presetSelector.options[s].value===r){this._presetSelector.value=r;break}}},onPresetChange:function(t){this._preset=BX.CrmWidgetDataPreset.getItem(this._presetSelector.value);if(BX.type.isFunction(this._presetChangeCallback)){this._presetChangeCallback(this,this._preset)}}};if(typeof BX.CrmWidgetConfigPresetEditor.messages==="undefined"){BX.CrmWidgetConfigPresetEditor.messages={}}BX.CrmWidgetConfigPresetEditor.create=function(t,e){var i=new BX.CrmWidgetConfigPresetEditor;i.initialize(t,e);return i}}if(typeof BX.CrmWidgetConfigGroupingEditor==="undefined"){BX.CrmWidgetConfigGroupingEditor=function(){this._id="";this._settings=null;this._config=null;this._control=null;this._grouping="";this._groupingSelector=null;this._groupingChangeHandler=BX.delegate(this.onGroupingChange,this);this._changeNotifier=null};BX.CrmWidgetConfigGroupingEditor.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"";this._settings=e?e:{};this._control=this.getSetting("control",null);if(!this._control){throw"BX.CrmWidgetConfigGroupingEditor: Could not find 'control' parameter."}this._config=this.getSetting("config",{});this._grouping=BX.type.isNotEmptyString(this._config["group"])?this._config["group"].toUpperCase():"";if(this._grouping===""){var i=BX.type.isArray(this._config["configs"])?this._config["configs"]:[];var n=i.length>0?i[0]:null;if(n&&BX.type.isNotEmptyString(n["group"])){this._grouping=n["group"].toUpperCase()}}if(this._grouping===""){this._grouping=this._control.getDefault()}this._changeNotifier=BX.CrmNotifier.create(this)},getId:function(){return this._id},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getMessage:function(t){var e=BX.CrmWidgetConfigGroupingEditor.messages;return e.hasOwnProperty(t)?e[t]:t},getGrouping:function(){return this._grouping},getExtraGrouping:function(){return this._grouping!==""&&!this._control.isCommonGrouping(this._grouping)?this._grouping:""},isExtraGrouping:function(){return!this._control.isCommonGrouping(this._grouping)},prepareLayout:function(t,e){this._groupingSelector=BX.CrmWidgetConfigEditor.createSelect({events:{change:this._groupingChangeHandler}},this._control.prepareListItems());this._groupingSelector.value=this._grouping;var i="field-container";if(BX.type.isNotEmptyString(e)){if(e==="left"){i+=" field-container-left"}else if(e==="right"){i+=" field-container-right"}}t.appendChild(BX.create("DIV",{attrs:{className:i},children:[BX.create("LABEL",{attrs:{className:"field-container-title"},text:this.getMessage("caption")+":"}),BX.create("SPAN",{attrs:{className:"select-container select-container-period"},children:[this._groupingSelector]})]}))},resetLayout:function(){if(this._groupingSelector){BX.unbind(this._groupingSelector,"change",this._groupingChangeHandler);this._groupingSelector=null}},saveConfig:function(){this._config["group"]=this._grouping;var t=BX.type.isArray(this._config["configs"])?this._config["configs"]:[];for(var e=0,i=t.length;e<i;e++){if(typeof t[e]["group"]!=="undefined"){delete t[e]["group"]}}},getConfig:function(){return this._config},addChangeListener:function(t){this._changeNotifier.addListener(t)},removeChangeListener:function(t){this._changeNotifier.removeListener(t)},onGroupingChange:function(t){this._grouping=this._groupingSelector.value;var e={grouping:this._grouping,isExtra:!this._control.isCommonGrouping(this._grouping)};this._changeNotifier.notify([e])}};if(typeof BX.CrmWidgetConfigGroupingEditor.messages==="undefined"){BX.CrmWidgetConfigGroupingEditor.messages={}}BX.CrmWidgetConfigGroupingEditor.create=function(t,e){var i=new BX.CrmWidgetConfigGroupingEditor;i.initialize(t,e);return i}}if(typeof BX.CrmWidgetConfigContextEditor==="undefined"){BX.CrmWidgetConfigContextEditor=function(){this._id="";this._settings=null;this._config=null;this._contextId=BX.CrmWidgetDataContext.undefined;this._contextSwitches={};this._contextChangeHandler=BX.delegate(this.onContextChange,this);this._contextChangeCallback=null};BX.CrmWidgetConfigContextEditor.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"";this._settings=e?e:{};this._config=this.getSetting("config",{});this._contextId=BX.type.isNotEmptyString(this._config["context"])?this._config["context"]:BX.CrmWidgetDataContext.entity;this._contextChangeCallback=this.getSetting("contextChange",null)},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getId:function(){return this._id},prepareLayout:function(t,e){var i=BX.create("SPAN",{attrs:{className:"radiobox-container"}});var n=BX.CrmWidgetDataContext.descriptions;for(var r in n){if(!n.hasOwnProperty(r)||r===BX.CrmWidgetDataContext.undefined){continue}var s=n[r];var o=this.getId()+"_data_context";var a=o+"_"+r.toLowerCase();this._contextSwitches[r]=BX.create("INPUT",{props:{type:"radio",id:a,name:o},events:{click:this._contextChangeHandler}});if(this._contextId===r){this._contextSwitches[r].checked=true}i.appendChild(this._contextSwitches[r]);i.appendChild(BX.create("LABEL",{attrs:{"for":a},text:s}))}var h="field-container";if(BX.type.isNotEmptyString(e)){if(e==="left"){h+=" field-container-left"}else if(e==="right"){h+=" field-container-right"}}t.appendChild(BX.create("DIV",{attrs:{className:h},children:[i]}))},resetLayout:function(){for(var t in this._contextSwitches){if(!this._contextSwitches.hasOwnProperty(t)){continue}BX.unbind(this._contextSwitches[t],"click",this._contextChangeHandler)}this._contextSwitches={}},getContextId:function(){return this._contextId},setContextId:function(t){if(this._contextId===t){return}this._contextId=t;if(BX.type.isFunction(this._contextChangeCallback)){this._contextChangeCallback(this,this._contextId)}},saveConfig:function(){this._config["context"]=this._contextId},getConfig:function(){return this._config},onContextChange:function(t){if(this._contextId!==BX.CrmWidgetDataContext.fund&&this._contextSwitches[BX.CrmWidgetDataContext.fund].checked){this.setContextId(BX.CrmWidgetDataContext.fund)}else if(this._contextId!==BX.CrmWidgetDataContext.entity&&this._contextSwitches[BX.CrmWidgetDataContext.entity].checked){this.setContextId(BX.CrmWidgetDataContext.entity)}else if(this._contextId!==BX.CrmWidgetDataContext.percent&&this._contextSwitches[BX.CrmWidgetDataContext.percent].checked){this.setContextId(BX.CrmWidgetDataContext.percent)}}};BX.CrmWidgetConfigContextEditor.create=function(t,e){var i=new BX.CrmWidgetConfigContextEditor;i.initialize(t,e);return i}}if(typeof BX.CrmWidgetConfigSelectListEditor==="undefined"){BX.CrmWidgetConfigSelectListEditor=function(){this._id="";this._settings=null;this._configParamName="";this._configParamCaption="";this._config=null;this._listItems=null;this._selector=null;this._selectorChangeHandler=BX.delegate(this.onSelectorChange,this);this._defaultValue="";this._selectedValue="";this._changeNotifier=null};BX.CrmWidgetConfigSelectListEditor.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"";this._settings=e?e:{};this._configParamName=this.getSetting("configParamName");if(!BX.type.isNotEmptyString(this._configParamName)){throw"BX.CrmWidgetConfigSelectListEditor: Could not find configParamName parameter."}this._configParamCaption=this.getSetting("configParamCaption");if(!BX.type.isNotEmptyString(this._configParamCaption)){this._configParamCaption=this._configParamName}this._defaultValue=this.getSetting("defaultValue","");this._listItems=this.getSetting("listItems");if(!BX.type.isArray(this._listItems)){this._listItems=[]}this.setConfig(this.getSetting("config",{}));this._changeNotifier=BX.CrmNotifier.create(this)},getId:function(){return this._id},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getSelectedValue:function(){return this._selectedValue},addChangeListener:function(t){this._changeNotifier.addListener(t)},removeChangeListener:function(t){this._changeNotifier.removeListener(t)},prepareLayout:function(t,e){this._selector=BX.CrmWidgetConfigEditor.createSelect({events:{change:this._selectorChangeHandler}},this._listItems);this._selector.value=this._selectedValue;var i="field-container";if(BX.type.isNotEmptyString(e)){if(e==="left"){i+=" field-container-left"}else if(e==="right"){i+=" field-container-right"}}t.appendChild(BX.create("DIV",{attrs:{className:i},children:[BX.create("LABEL",{attrs:{className:"field-container-title"},text:this._configParamCaption+":"}),BX.create("SPAN",{attrs:{className:"select-container"},children:[this._selector]})]}))},resetLayout:function(){},saveConfig:function(){var t=this._selectedValue;if(t!==""){this._config[this._configParamName]=t}else if(typeof this._config[this._configParamName]!=="undefined"){delete this._config[this._configParamName]}},copyToConfig:function(t){if(this._config===t){return}if(typeof this._config[this._configParamName]!=="undefined"){t[this._configParamName]=this._config[this._configParamName]}else if(typeof t[this._configParamName]!=="undefined"){delete t[this._configParamName]}},setConfig:function(t){this._config=BX.type.isPlainObject(t)?t:{};this._selectedValue=BX.type.isNotEmptyString(this._config[this._configParamName])?this._config[this._configParamName]:this._defaultValue},getConfig:function(){return this._config},isEmpty:function(){return this._selectedValue===""},onSelectorChange:function(t){this._selectedValue=this._selector.value;this._changeNotifier.notify()}};BX.CrmWidgetConfigSelectListEditor.items={};BX.CrmWidgetConfigSelectListEditor.create=function(t,e){var i=new BX.CrmWidgetConfigSelectListEditor;i.initialize(t,e);this.items[i.getId()]=i;return i}}if(typeof BX.CrmRatingWidgetConfigEditor==="undefined"){BX.CrmRatingWidgetConfigEditor=function(){BX.CrmRatingWidgetConfigEditor.superclass.constructor.apply(this);this._config=null;this._titleEditor=null;this._presetEditor=null;this._presetChangeHandler=BX.delegate(this.onPresetChange,this)};BX.extend(BX.CrmRatingWidgetConfigEditor,BX.CrmWidgetConfigEditor);BX.CrmRatingWidgetConfigEditor.prototype.innerPrepareDialogContent=function(t){this._titleEditor=BX.CrmWidgetConfigTitleEditor.create(this._id,{config:this._config,backgroundColor:"#43a4af",enableBackgroundColorChange:false});var e=BX.type.isArray(this._config["configs"])&&this._config["configs"].length>0?this._config["configs"][0]:{};this._presetEditor=BX.CrmWidgetManager.getCurrent().createPresetEditor(this._entityTypeName,this._widget.getTypeName(),this._id,{config:e,presetChange:this._presetChangeHandler,entityTypeName:this.getEntityTypeName()});var i=BX.create("DIV",{attrs:{className:"container-item container-item-center"}});t.appendChild(i);this._titleEditor.prepareLayout(i);this._presetEditor.prepareLayout(i,"wide");return t};BX.CrmRatingWidgetConfigEditor.prototype.innerSaveConfig=function(){this._titleEditor.saveConfig();this._config["title"]=this._titleEditor.getTitle();this._presetEditor.saveConfig();this._config["configs"]=[this._presetEditor.getConfig()]};BX.CrmRatingWidgetConfigEditor.prototype.reset=function(){this._titleEditor.resetLayout();this._titleEditor=null;this._presetEditor.resetLayout();this._presetEditor=null;this._period.resetLayout();this._period=null};BX.CrmRatingWidgetConfigEditor.prototype.onPresetChange=function(t,e){if(e&&BX.type.isNotEmptyString(e["title"])&&this._titleEditor){this._titleEditor.setTitle(e["title"])}};BX.CrmRatingWidgetConfigEditor.create=function(t,e){var i=new BX.CrmRatingWidgetConfigEditor;i.initialize(t,e);return i}}if(typeof BX.CrmNumericWidgetConfigEditor==="undefined"){BX.CrmNumericWidgetConfigEditor=function(){BX.CrmNumericWidgetConfigEditor.superclass.constructor.apply(this);this._fields=[]};BX.extend(BX.CrmNumericWidgetConfigEditor,BX.CrmWidgetConfigEditor);BX.CrmNumericWidgetConfigEditor.prototype.innerPrepareDialogContent=function(t){var e=BX.type.isArray(this._config["configs"])?this._config["configs"]:[];var i,n;var r="";if(e.length===1){r="#43a4af"}for(i=0;i<e.length;i++){var s=e[i];var o=this._id+"_"+i;var a={config:s,index:i,parent:this,titleBackgroundColor:r,entityTypeName:this.getEntityTypeName()};this._fields.push(BX.CrmNumericWidgetConfigExpressionFieldEditor.isExpression(s)?BX.CrmNumericWidgetConfigExpressionFieldEditor.create(o,a):BX.CrmNumericWidgetConfigPresetFieldEditor.create(o,a))}for(i=0;i<this._fields.length;i++){this._fields[i].postInitialize()}var h=null;var l=[];for(i=0;i<this._fields.length;i++){var g=this._fields[i];if(i===0){t.appendChild(g.prepareLayout(BX.create("DIV",{attrs:{className:"container-item"}}),"wide"))}else{if(!h){h=BX.create("DIV",{attrs:{className:"container-item-wrapper"}});t.appendChild(h)}var d=BX.create("DIV",{attrs:{className:"container-item container-item-5 "+(i%2>0?"container-item-first":"container-item-second")}});h.appendChild(d);g.prepareLayout(d)}g.prepareExtraControls(l)}if(l.length>0){for(i=0;i<l.length;i++){var c=l[i];if(!BX.type.isArray(c["controls"])){continue}if(BX.type.isNotEmptyString(c["type"])&&c["type"]==="action"){var p=BX.create("DIV",{attrs:{className:"action-container"}});for(n=0;n<c["controls"].length;n++){p.appendChild(c["controls"][n])}if(h){t.insertBefore(p,h)}else{t.appendChild(p)}}else{for(n=0;n<c["controls"].length;n++){t.appendChild(c["controls"][n])}}}}return t};BX.CrmNumericWidgetConfigEditor.prototype.getFieldByName=function(t){for(var e=0;e<this._fields.length;e++){var i=this._fields[e];if(t===i.getName()){return i}}return null};BX.CrmNumericWidgetConfigEditor.prototype.getFields=function(){return this._fields};BX.CrmNumericWidgetConfigEditor.prototype.innerSaveConfig=function(){for(var t=0;t<this._fields.length;t++){this._fields[t].saveConfig();this._config["configs"][t]=this._fields[t].getConfig()}};BX.CrmNumericWidgetConfigEditor.prototype.reset=function(){for(var t=0;t<this._fields.length;t++){this._fields[t].resetLayout()}this._fields=[];this._period.resetLayout();this._period=null};BX.CrmNumericWidgetConfigEditor.create=function(t,e){var i=new BX.CrmNumericWidgetConfigEditor;i.initialize(t,e);return i}}if(typeof BX.CrmPieWidgetConfigEditor==="undefined"){BX.CrmPieWidgetConfigEditor=function(){BX.CrmPieWidgetConfigEditor.superclass.constructor.apply(this);this._field=null;this._grouping=null;this._groupingChangeHandler=BX.delegate(this.onGroupingChange,this)};BX.extend(BX.CrmPieWidgetConfigEditor,BX.CrmWidgetConfigEditor);BX.CrmPieWidgetConfigEditor.prototype.innerPrepareDialogContent=function(t){this._grouping=BX.CrmWidgetConfigGroupingEditor.create(this._id,{config:this._config,control:BX.CrmWidgetDataGroup.create({entityTypeName:this.getEntityTypeName()})});this._grouping.prepareLayout(this._leadingWrapper,"right");this._grouping.addChangeListener(this._groupingChangeHandler);var e=this._grouping.getExtraGrouping();var i=BX.type.isArray(this._config["configs"])?this._config["configs"]:[];var n=i.length>0?i[0]:null;if(n){var r=this._id+"_1";var s={config:n,extraGrouping:e,parent:this,isNew:false,index:0,titleBackgroundColor:"",entityTypeName:this.getEntityTypeName()};this._field=BX.CrmPieWidgetConfigFieldEditor.create(r,s);t.appendChild(this._field.prepareLayout(BX.create("DIV",{attrs:{className:"container-item"}}),"wide"))}return t};BX.CrmPieWidgetConfigEditor.prototype.innerSaveConfig=function(){this._grouping.saveConfig();this._field.saveConfig();this._config["configs"]=[this._field.getConfig()]};BX.CrmPieWidgetConfigEditor.prototype.reset=function(){this._field.resetLayout();this._field=null;this._grouping.resetLayout();this._grouping=null};BX.CrmPieWidgetConfigEditor.prototype.onGroupingChange=function(t,e){var i=e["isExtra"]?e["grouping"]:"";this._field.setExtraGrouping(i)};BX.CrmPieWidgetConfigEditor.create=function(t,e){var i=new BX.CrmPieWidgetConfigEditor;i.initialize(t,e);return i}}if(typeof BX.CrmGraphWidgetConfigEditor==="undefined"){BX.CrmGraphWidgetConfigEditor=function(){BX.CrmGraphWidgetConfigEditor.superclass.constructor.apply(this);this._grouping=null;this._context=null;this._fields=[];this._maxGraphCount=0;this._buttonContainer=null;this._addButton=null;this._contextChangeHandler=BX.delegate(this.onContextChange,this);this._fieldDeletionHandler=BX.delegate(this.onFieldDelete,this);this._addButtonClickHandler=BX.delegate(this.onAddButtonClick,this);this._groupingChangeHandler=BX.delegate(this.onGroupingChange,this)};BX.extend(BX.CrmGraphWidgetConfigEditor,BX.CrmWidgetConfigEditor);BX.CrmGraphWidgetConfigEditor.prototype.doInitialize=function(){this._maxGraphCount=parseInt(this.getSetting("maxGraphCount",0));if(isNaN(this._maxGraphCount)){this._maxGraphCount=0}};BX.CrmGraphWidgetConfigEditor.prototype.innerPrepareDialogContent=function(t){this._grouping=BX.CrmWidgetConfigGroupingEditor.create(this._id,{config:this._config,control:BX.CrmWidgetDataGroup.create({entityTypeName:this.getEntityTypeName()})});this._grouping.prepareLayout(this._leadingWrapper,"left");this._grouping.addChangeListener(this._groupingChangeHandler);this._context=BX.CrmWidgetConfigContextEditor.create(this._id,{config:this._config,contextChange:this._contextChangeHandler});this._context.prepareLayout(this._leadingWrapper,"right");var e=this._context.getContextId();var i=this._grouping.getExtraGrouping();var n=BX.type.isArray(this._config["configs"])?this._config["configs"]:[];var r=this._maxGraphCount>0&&n.length<this._maxGraphCount?n.length:this._maxGraphCount;for(var s=0;s<r;s++){var o=n[s];var a=this._id+"_"+(s+1).toString();var h={config:o,extraGrouping:i,context:e,parent:this,isNew:false,index:s,titleBackgroundColor:"",entityTypeName:this.getEntityTypeName()};this._fields.push(BX.CrmGraphWidgetConfigFieldEditor.create(a,h))}for(var l=0;l<this._fields.length;l++){var g=this._fields[l];g.addDeletionListener(this._fieldDeletionHandler);t.appendChild(g.prepareLayout(BX.create("DIV",{attrs:{className:"container-item"}}),"wide"))}this._addButton=BX.create("A",{attrs:{className:"field-link",href:"#"},text:this.getMessage("addGraph")});this._buttonContainer=BX.create("DIV",{attrs:{className:"container-item container-item-button"},children:[this._addButton]});BX.bind(this._addButton,"click",this._addButtonClickHandler);t.appendChild(this._buttonContainer);return t};BX.CrmGraphWidgetConfigEditor.prototype.getMessage=function(t){if(BX.CrmGraphWidgetConfigEditor.messages.hasOwnProperty(t)){return BX.CrmGraphWidgetConfigEditor.messages[t]}return BX.CrmGraphWidgetConfigEditor.superclass.getMessage.apply(this,[t])};BX.CrmGraphWidgetConfigEditor.prototype.getFieldByName=function(t){for(var e=0;e<this._fields.length;e++){var i=this._fields[e];if(t===i.getName()){return i}}return null};BX.CrmGraphWidgetConfigEditor.prototype.getFields=function(){return this._fields};BX.CrmGraphWidgetConfigEditor.prototype.createField=function(){var t=0;for(var e=0;e<this._fields.length;e++){if(!this._fields[e].isDeleted()){t++}}if(t>=this._maxGraphCount){alert(this.getMessage("maxGraphError").replace(/#MAX_GRAPH_COUNT#/gi,this._maxGraphCount));return}var i=this._fields.length;var n=this._id+"_"+(i+1).toString();var r={config:{name:"param"+(i+1).toString()},extraGrouping:this._grouping.getExtraGrouping(),context:this._context.getContextId(),parent:this,isNew:true,index:i,titleBackgroundColor:"",entityTypeName:this.getEntityTypeName()};var s=BX.CrmGraphWidgetConfigFieldEditor.create(n,r);this._fields.push(s);this._container.insertBefore(s.prepareLayout(BX.create("DIV",{attrs:{className:"container-item"}}),"wide"),this._buttonContainer);s.addDeletionListener(this._fieldDeletionHandler)};BX.CrmGraphWidgetConfigEditor.prototype.removeField=function(t){t.resetLayout()};BX.CrmGraphWidgetConfigEditor.prototype.removeConfig=function(t){if(!BX.type.isArray(this._config["configs"])){return}for(var e=0;e<this._config["configs"].length;e++){if(t===this._config["configs"][e]){this._config["configs"].splice(e,1);return}}};BX.CrmGraphWidgetConfigEditor.prototype.innerSaveConfig=function(){this._grouping.saveConfig();this._context.saveConfig();for(var t=0;t<this._fields.length;t++){var e=this._fields[t];if(!e.isDeleted()){e.saveConfig();if(e.isNew()){this._config["configs"].push(e.getConfig())}}else if(!e.isNew()){this.removeConfig(e.getConfig())}}};BX.CrmGraphWidgetConfigEditor.prototype.reset=function(){for(var t=0;t<this._fields.length;t++){this._fields[t].resetLayout()}this._fields=[];this._grouping.resetLayout();this._grouping=null;this._context.resetLayout();this._context=null;BX.unbind(this._addButton,"click",this._addButtonClickHandler);BX.cleanNode(this._buttonContainer,true);this._buttonContainer=null;this._addButton=null};BX.CrmGraphWidgetConfigEditor.prototype.onContextChange=function(t,e){for(var i=0;i<this._fields.length;i++){this._fields[i].setContextId(e)}};BX.CrmGraphWidgetConfigEditor.prototype.onGroupingChange=function(t,e){var i=e["isExtra"]?e["grouping"]:"";for(var n=0;n<this._fields.length;n++){this._fields[n].setExtraGrouping(i)}};BX.CrmGraphWidgetConfigEditor.prototype.onFieldDelete=function(t){this.removeField(t)};BX.CrmGraphWidgetConfigEditor.prototype.onAddButtonClick=function(t){this.createField();return BX.PreventDefault(t)};if(typeof BX.CrmGraphWidgetConfigEditor.messages==="undefined"){BX.CrmGraphWidgetConfigEditor.messages={}}BX.CrmGraphWidgetConfigEditor.create=function(t,e){var i=new BX.CrmGraphWidgetConfigEditor;i.initialize(t,e);return i}}if(typeof BX.CrmNumericWidgetConfigFieldEditor==="undefined"){BX.CrmNumericWidgetConfigFieldEditor=function(){this._id="";this._settings=null;this._parent=null;this._name="";this._index=0;this._letter="";this._config=null;this._titleBackgroundColor="";this._titleEditor=null};BX.CrmNumericWidgetConfigFieldEditor.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"";this._settings=e?e:{};this._parent=this.getSetting("parent");if(!this._parent){throw"CrmNumericWidgetConfigFieldEditor: Could not find 'parent' parameter."}this._index=this.getSetting("index",0);this._letter=String.fromCharCode(65+this._index);this._config=this.getSetting("config",{});this._name=BX.type.isNotEmptyString(this._config["name"])?this._config["name"]:"c"+(this._index+1);this._titleBackgroundColor=this.getSetting("titleBackgroundColor","");if(BX.type.isPlainObject(this._config["display"])&&BX.type.isNotEmptyString(this._config["display"]["colorScheme"])){this._schemeId=this._config["display"]["colorScheme"];var i=BX.CrmWidgetColorScheme.getInfo(this._schemeId);if(i){this._titleBackgroundColor=i["color"]}}if(this._titleBackgroundColor===""){if(this._index>1){this._titleBackgroundColor="#dec01f"}else if(this._index>0){this._titleBackgroundColor="#4fc3f7"}else{this._titleBackgroundColor="#22d02c"}}this.innerInitialize()},innerInitialize:function(){},postInitialize:function(){},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getId:function(){return this._id},getIndex:function(){return this._index},getLetter:function(){return this._letter},getName:function(){return this._name},getTitleEditor:function(){return this._titleEditor},getTitleBackgroundColor:function(){return this._titleEditor?this._titleEditor.getTitleBackgroundColor():this._titleBackgroundColor},prepareLayout:function(t,e){this._titleEditor=BX.CrmWidgetConfigTitleEditor.create(this._id,{config:this._config,backgroundColor:this._titleBackgroundColor,letter:this._letter});this._titleEditor.prepareLayout(t);this.innerPrepareLayout(t,e);return t},innerPrepareLayout:function(t,e){},prepareExtraControls:function(t){},resetLayout:function(){this._titleEditor.resetLayout();this._titleEditor=null;this.innerResetLayout()},innerResetLayout:function(){},getConfig:function(){return this._config},saveConfig:function(){this._config["name"]=this._name;this._titleEditor.saveConfig();this._config["title"]=this._titleEditor.getTitle();this.innerSaveConfig()},innerSaveConfig:function(){}}}if(typeof BX.CrmNumericWidgetConfigPresetFieldEditor==="undefined"){BX.CrmNumericWidgetConfigPresetFieldEditor=function(){BX.CrmNumericWidgetConfigPresetFieldEditor.superclass.constructor.apply(this);this._entityTypeName="";this._presetEditor=null;this._presetChangeHandler=BX.delegate(this._onPresetChange,this)};BX.extend(BX.CrmNumericWidgetConfigPresetFieldEditor,BX.CrmNumericWidgetConfigFieldEditor);BX.CrmNumericWidgetConfigPresetFieldEditor.prototype.innerInitialize=function(){this._entityTypeName=this.getSetting("entityTypeName","")};BX.CrmNumericWidgetConfigPresetFieldEditor.prototype.getContextId=function(){return this._presetEditor?this._presetEditor.getContextId():BX.CrmWidgetDataContext.undefined};BX.CrmNumericWidgetConfigPresetFieldEditor.prototype.innerPrepareLayout=function(t,e){this._presetEditor=BX.CrmWidgetManager.getCurrent().createPresetEditor(this._entityTypeName,this._parent.getWidgetTypeName(),this._id,{config:this._config,entityTypeName:this._entityTypeName,presetChange:this._presetChangeHandler});this._presetEditor.prepareLayout(t,e)};BX.CrmNumericWidgetConfigPresetFieldEditor.prototype.innerResetLayout=function(){this._presetEditor.resetLayout();this._presetEditor=null};BX.CrmNumericWidgetConfigPresetFieldEditor.prototype.innerSaveConfig=function(){this._presetEditor.saveConfig();this._config=this._presetEditor.getConfig()};BX.CrmNumericWidgetConfigPresetFieldEditor.prototype._onPresetChange=function(t,e){if(e&&BX.type.isNotEmptyString(e["title"])&&this._titleEditor){this._titleEditor.setTitle(e["title"])}};BX.CrmNumericWidgetConfigPresetFieldEditor.create=function(t,e){var i=new BX.CrmNumericWidgetConfigPresetFieldEditor;i.initialize(t,e);return i}}if(typeof BX.CrmNumericWidgetConfigExpressionFieldEditor==="undefined"){BX.CrmNumericWidgetConfigExpressionFieldEditor=function(){BX.CrmNumericWidgetConfigExpressionFieldEditor.superclass.constructor.apply(this);this._source=null;this._operation="";this._leftItem=null;this._rightItem=null;this._leftIcon=null;this._icon=null;this._rightIcon=null;this._operationLegend=null;this._operationIcon=null;this._operationSign=null;this._operationSelector=null;this._operationChangeHandler=BX.delegate(this.onOperationChange,this);this._colorSchemeChangeHandler=BX.delegate(this.onColorSchemeChange,this);this._leftItemColorSchemeChangeHandler=BX.delegate(this.onLeftItemColorSchemeChange,this);this._rightItemColorSchemeChangeHandler=BX.delegate(this.onRightItemColorSchemeChange,this)};BX.extend(BX.CrmNumericWidgetConfigExpressionFieldEditor,BX.CrmNumericWidgetConfigFieldEditor);BX.CrmNumericWidgetConfigExpressionFieldEditor.prototype.innerInitialize=function(){this._source=BX.type.isPlainObject(this._config["dataSource"])?this._config["dataSource"]:{};this._operation=BX.type.isNotEmptyString(this._source["operation"])?this._source["operation"].toUpperCase():BX.CrmWidgetExpressionOperation.diff};BX.CrmNumericWidgetConfigExpressionFieldEditor.prototype.postInitialize=function(){this._items={};var t=new RegExp("%([^%]+)%");var e=BX.type.isArray(this._source["arguments"])?this._source["arguments"]:[];var i=e.length;var n;if(i>0){if(i<2){throw"CrmNumericWidgetExpressionConfigEditor: Configuration must contain at least two arguments."}for(var r=0;r<2;r++){var s=t.exec(e[r]);if(!s){throw"CrmNumericWidgetExpressionConfigEditor: Could not parse argument."}var o=s[1];n=this._parent.getFieldByName(o);if(!n){throw"CrmNumericWidgetExpressionConfigEditor: Could not find field."}if(r===0){this._leftItem=n}else{this._rightItem=n}}}else{var a=this._parent.getFields();var h=a.length;if(h<2){throw"CrmNumericWidgetExpressionConfigEditor: Parent must contain at least two fields."}for(var l=0;l<2;l++){if(l===0){this._leftItem=a[l]}else{this._rightItem=a[l]}}}};BX.CrmNumericWidgetConfigExpressionFieldEditor.prototype.innerPrepareLayout=function(t,e){this._operationLegend=BX.create("P",{text:BX.CrmWidgetExpressionOperation.getLegend(this._operation)});t.appendChild(BX.create("DIV",{attrs:{className:"field-container"
},children:[this._operationLegend]}));this._icon=BX.create("SPAN",{attrs:{className:"color-digit"},style:{backgroundColor:this.getTitleBackgroundColor()},text:this._letter});this._leftIcon=BX.create("SPAN",{attrs:{className:"color-digit"},style:{backgroundColor:this._leftItem.getTitleBackgroundColor()},text:this._leftItem.getLetter()});this._rightIcon=BX.create("SPAN",{attrs:{className:"color-digit"},style:{backgroundColor:this._rightItem.getTitleBackgroundColor()},text:this._rightItem.getLetter()});this._operationSign=BX.create("SPAN",{attrs:{className:BX.CrmWidgetExpressionOperation.getSymbolClassName(this._operation)}});t.appendChild(BX.create("DIV",{attrs:{className:"subtraction"},children:[BX.create("DIV",{children:[this._icon,BX.create("SPAN",{attrs:{className:"symbol symbol-equally"}}),this._leftIcon,this._operationSign,this._rightIcon]})]}));if(BX.type.isElementNode(t.parentNode)){t.parentNode.appendChild(BX.create("DIV",{attrs:{className:"container-item-equally"},children:[BX.create("SPAN")]}))}var i=this.getTitleEditor();if(i){i.addColorSchemeChangeListener(this._colorSchemeChangeHandler)}var n=this._leftItem.getTitleEditor();if(n){n.addColorSchemeChangeListener(this._leftItemColorSchemeChangeHandler)}var r=this._rightItem.getTitleEditor();if(r){r.addColorSchemeChangeListener(this._rightItemColorSchemeChangeHandler)}};BX.CrmNumericWidgetConfigExpressionFieldEditor.prototype.prepareExtraControls=function(t){var e={type:"action",controls:[]};this._operationIcon=BX.create("SPAN",{attrs:{className:BX.CrmWidgetExpressionOperation.getIconClassName(this._operation)}});e["controls"].push(this._operationIcon);this._operationSelector=BX.CrmWidgetConfigEditor.createSelect({events:{change:this._operationChangeHandler}},BX.CrmWidgetExpressionOperation.prepareListItems());this._operationSelector.value=this._operation;e["controls"].push(BX.create("SPAN",{attrs:{className:"select-container"},children:[this._operationSelector]}));e["controls"].push(BX.create("SPAN",{text:BX.CrmWidgetExpressionOperation.getHint()}));t.push(e)};BX.CrmNumericWidgetConfigExpressionFieldEditor.prototype.innerSaveConfig=function(){if(!BX.type.isPlainObject(this._config["dataSource"])){this._config["dataSource"]={}}this._config["dataSource"]["name"]="EXPRESSION";this._config["dataSource"]["operation"]=this._operation;this._config["dataSource"]["arguments"]=["%"+this._leftItem.getName()+"%","%"+this._rightItem.getName()+"%"];if(this._operation!==BX.CrmWidgetExpressionOperation.percent&&(this._leftItem.getContextId()===BX.CrmWidgetDataContext.fund||this._rightItem.getContextId()===BX.CrmWidgetDataContext.fund)){if(!BX.type.isPlainObject(this._config["format"])){this._config["format"]={}}this._config["format"]["isCurrency"]="Y";this._config["format"]["enableDecimals"]="N"}else if(BX.type.isPlainObject(this._config["format"])){delete this._config["format"]["isCurrency"];delete this._config["format"]["enableDecimals"]}};BX.CrmNumericWidgetConfigExpressionFieldEditor.prototype.innerResetLayout=function(){var t=this.getTitleEditor();if(t){t.removeColorSchemeChangeListener(this._colorSchemeChangeHandler)}this._leftIcon=null;var e=this._leftItem?this._leftItem.getTitleEditor():null;if(e){e.removeColorSchemeChangeListener(this._leftItemColorSchemeChangeHandler)}this._rightIcon=null;var i=this._rightItem?this._rightItem.getTitleEditor():null;if(i){i.removeColorSchemeChangeListener(this._rightItemColorSchemeChangeHandler)}this._operationLegend=null;this._operationSign=null;this._operationIcon=null;if(this._operationSelector){BX.unbind(this._presetSelector,"change",this._operationChangeHandler);this._operationSelector=null}};BX.CrmNumericWidgetConfigExpressionFieldEditor.prototype.onOperationChange=function(t){this._operation=this._operationSelector.value;this._operationIcon.className=BX.CrmWidgetExpressionOperation.getIconClassName(this._operation);this._operationLegend.innerHTML=BX.util.htmlspecialchars(BX.CrmWidgetExpressionOperation.getLegend(this._operation));this._operationSign.className=BX.CrmWidgetExpressionOperation.getSymbolClassName(this._operation);this._titleEditor.setTitle(BX.CrmWidgetExpressionOperation.getDescription(this._operation))};BX.CrmNumericWidgetConfigExpressionFieldEditor.prototype.onColorSchemeChange=function(){if(this._icon){this._icon.style.backgroundColor=this.getTitleBackgroundColor()}};BX.CrmNumericWidgetConfigExpressionFieldEditor.prototype.onLeftItemColorSchemeChange=function(){if(this._leftItem&&this._leftIcon){this._leftIcon.style.backgroundColor=this._leftItem.getTitleBackgroundColor()}};BX.CrmNumericWidgetConfigExpressionFieldEditor.prototype.onRightItemColorSchemeChange=function(){if(this._rightItem&&this._rightIcon){this._rightIcon.style.backgroundColor=this._rightItem.getTitleBackgroundColor()}};BX.CrmNumericWidgetConfigExpressionFieldEditor.prototype.getOperation=function(){return this._operation};BX.CrmNumericWidgetConfigExpressionFieldEditor.isExpression=function(t){var e=BX.type.isPlainObject(t["dataSource"])?t["dataSource"]:{};return BX.type.isNotEmptyString(e["name"])&&e["name"].toUpperCase()==="EXPRESSION"};BX.CrmNumericWidgetConfigExpressionFieldEditor.create=function(t,e){var i=new BX.CrmNumericWidgetConfigExpressionFieldEditor;i.initialize(t,e);return i}}if(typeof BX.CrmGraphWidgetConfigFieldEditor==="undefined"){BX.CrmGraphWidgetConfigFieldEditor=function(){this._id="";this._settings=null;this._parent=null;this._name="";this._index=0;this._config=null;this._entityTypeName="";this._extraGrouping="";this._contextId=BX.CrmWidgetDataContext.undefined;this._titleBackgroundColor="";this._titleEditor=null;this._presetEditor=null;this._presetChangeHandler=BX.delegate(this.onPresetChange,this);this._titleDeletionHandler=BX.delegate(this.onTitleDeletion,this);this._isNew=false;this._isDeleted=false;this._deletionNotifier=null;this._container=null;this._hasLayout=false};BX.CrmGraphWidgetConfigFieldEditor.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"";this._settings=e?e:{};this._parent=this.getSetting("parent",null);if(!this._parent){throw"CrmGraphWidgetConfigFieldEditor: The 'parent' parameter is not found."}this._entityTypeName=this.getSetting("entityTypeName","");this._index=this.getSetting("index",0);this._extraGrouping=this.getSetting("extraGrouping","");this._contextId=this.getSetting("context",BX.CrmWidgetDataContext.entity);this._config=this.getSetting("config",{});this._name=BX.type.isNotEmptyString(this._config["name"])?this._config["name"]:"c"+(this._index+1);this._titleBackgroundColor=this.getSetting("titleBackgroundColor","");this._isNew=this.getSetting("isNew",false);this._deletionNotifier=BX.CrmNotifier.create(this)},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getId:function(){return this._id},getIndex:function(){return this._index},getName:function(){return this._name},getContextId:function(){return this._contextId},setContextId:function(t){this._contextId=t;if(this._presetEditor){this._presetEditor.setContextId(t)}},getExtraGrouping:function(){return this._extraGrouping},setExtraGrouping:function(t){this._extraGrouping=t;if(this._presetEditor){this._presetEditor.setExtraGrouping(t)}},getTitleBackgroundColor:function(){return this._titleBackgroundColor},getTitleEditor:function(){return this._titleEditor},prepareLayout:function(t){if(this._hasLayout){return}this._container=t;this._titleEditor=BX.CrmWidgetConfigTitleEditor.create(this._id,{config:this._config,enableDeletion:true,backgroundColor:this._titleBackgroundColor});this._titleEditor.addDeletionListener(this._titleDeletionHandler);this._titleEditor.prepareLayout(t);this._presetEditor=BX.CrmWidgetManager.getCurrent().createPresetEditor(this._entityTypeName,this._parent.getWidgetTypeName(),this._id,{config:this._config,entityTypeName:this._entityTypeName,presetChange:this._presetChangeHandler,extraGrouping:this._extraGrouping,context:this._contextId,enableContextChange:false});this._presetEditor.prepareLayout(t,"wide");this._hasLayout=true;return t},resetLayout:function(){if(!this._hasLayout){return}this._titleEditor.removeDeletionListener(this._titleDeletionHandler);this._titleEditor.resetLayout();this._titleEditor=null;this._presetEditor.resetLayout();this._presetEditor=null;BX.cleanNode(this._container,true);this._container=null;this._hasLayout=false},getConfig:function(){return this._config},saveConfig:function(){this._config["name"]=this._name;this._titleEditor.saveConfig();this._presetEditor.saveConfig()},addDeletionListener:function(t){this._deletionNotifier.addListener(t)},removeDeletionListener:function(t){this._deletionNotifier.removeListener(t)},isNew:function(){return this._isNew},isDeleted:function(){return this._isDeleted},onPresetChange:function(t,e){if(e&&BX.type.isNotEmptyString(e["title"])&&this._titleEditor){this._titleEditor.setTitle(e["title"])}},onTitleDeletion:function(t){this._isDeleted=true;this._deletionNotifier.notify()}};BX.CrmGraphWidgetConfigFieldEditor.create=function(t,e){var i=new BX.CrmGraphWidgetConfigFieldEditor;i.initialize(t,e);return i}}if(typeof BX.CrmPieWidgetConfigFieldEditor==="undefined"){BX.CrmPieWidgetConfigFieldEditor=function(){this._id="";this._settings=null;this._parent="";this._name="";this._config=null;this._entityTypeName="";this._extraGrouping="";this._titleEditor=null;this._presetEditor=null;this._presetChangeHandler=BX.delegate(this.onPresetChange,this);this._container=null;this._hasLayout=false};BX.CrmPieWidgetConfigFieldEditor.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"";this._settings=e?e:{};this._parent=this.getSetting("parent",null);if(!this._parent){throw"CrmPieWidgetConfigFieldEditor: The 'parent' parameter is not found."}this._entityTypeName=this.getSetting("entityTypeName","");this._extraGrouping=this.getSetting("extraGrouping","");this._config=this.getSetting("config",{});this._name=BX.type.isNotEmptyString(this._config["name"])?this._config["name"]:"c0"},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getId:function(){return this._id},getIndex:function(){return this._index},getName:function(){return this._name},getContextId:function(){return this._contextId},setContextId:function(t){this._contextId=t;if(this._presetEditor){this._presetEditor.setContextId(t)}},getExtraGrouping:function(){return this._extraGrouping},setExtraGrouping:function(t){this._extraGrouping=t;if(this._presetEditor){this._presetEditor.setExtraGrouping(t)}},getTitleEditor:function(){return this._titleEditor},prepareLayout:function(t){if(this._hasLayout){return}this._container=t;this._titleEditor=BX.CrmWidgetConfigTitleEditor.create(this._id,{config:this._config,backgroundColor:"#b0b6bc",enableBackgroundColorChange:false});this._titleEditor.prepareLayout(t);this._presetEditor=BX.CrmWidgetManager.getCurrent().createPresetEditor(this._entityTypeName,this._parent.getWidgetTypeName(),this._id,{config:this._config,entityTypeName:this._entityTypeName,presetChange:this._presetChangeHandler,extraGrouping:this._extraGrouping,enableContextChange:true});this._presetEditor.prepareLayout(t,"wide");this._hasLayout=true;return t},resetLayout:function(){if(!this._hasLayout){return}this._titleEditor.resetLayout();this._titleEditor=null;this._presetEditor.resetLayout();this._presetEditor=null;BX.cleanNode(this._container,true);this._container=null;this._hasLayout=false},getConfig:function(){return this._config},saveConfig:function(){this._config["name"]=this._name;this._titleEditor.saveConfig();this._presetEditor.saveConfig()},onPresetChange:function(t,e){if(e&&BX.type.isNotEmptyString(e["title"])&&this._titleEditor){this._titleEditor.setTitle(e["title"])}}};BX.CrmPieWidgetConfigFieldEditor.create=function(t,e){var i=new BX.CrmPieWidgetConfigFieldEditor;i.initialize(t,e);return i}}if(typeof BX.CrmWidgetDataPreset==="undefined"){BX.CrmWidgetDataPreset=function(){};BX.CrmWidgetDataPreset.prototype={};BX.CrmWidgetDataPreset.items=[];BX.CrmWidgetDataPreset.notSelected="-";BX.CrmWidgetDataPreset.hasItems=function(t,e,i,n){if(!BX.type.isNotEmptyString(t)){return false}if(!BX.type.isString(e)){e=""}if(!BX.type.isString(i)){i=BX.CrmWidgetDataContext.undefined}if(!BX.type.isString(n)){n=""}var r=BX.type.isNotEmptyString(n);for(var s=0;s<this.items.length;s++){var o=this.items[s];var a=BX.type.isNotEmptyString(o["entity"])?o["entity"]:"";var h=BX.type.isNotEmptyString(o["category"])?o["category"]:"";var l=BX.type.isNotEmptyString(o["context"])?o["context"]:"";if(a!==t||h!==e||i!==BX.CrmWidgetDataContext.undefined&&l!==i){continue}if(r){var g=BX.type.isPlainObject(o["grouping"])&&BX.type.isArray(o["grouping"]["extras"])?o["grouping"]["extras"]:[];var d=false;for(var c=0,p=g.length;c<p;c++){if(g[c]===n){d=true;break}}if(!d){continue}}return true}return false};BX.CrmWidgetDataPreset.prepareListItems=function(t,e,i,n){if(!BX.type.isNotEmptyString(t)){return[{value:"",text:this.notSelected}]}if(!BX.type.isString(e)){e=""}if(!BX.type.isString(i)){i=BX.CrmWidgetDataContext.undefined}if(!BX.type.isString(n)){n=""}var r=BX.type.isNotEmptyString(n);var s=[{value:"",text:this.notSelected}];for(var o=0;o<this.items.length;o++){var a=this.items[o];var h=BX.type.isNotEmptyString(a["entity"])?a["entity"]:"";var l=BX.type.isNotEmptyString(a["category"])?a["category"]:"";var g=BX.type.isNotEmptyString(a["context"])?a["context"]:"";if(h!==t||l!==e||i!==BX.CrmWidgetDataContext.undefined&&g!==i){continue}if(r){var d=BX.type.isPlainObject(a["grouping"])&&BX.type.isArray(a["grouping"]["extras"])?a["grouping"]["extras"]:[];var c=false;for(var p=0,u=d.length;p<u;p++){if(d[p]===n){c=true;break}}if(!c){continue}}var f=BX.type.isNotEmptyString(a["name"])?a["name"]:"";var _=BX.type.isNotEmptyString(a["listTitle"])?a["listTitle"]:"";if(_===""){_=BX.type.isNotEmptyString(a["title"])?a["title"]:""}if(_===""){_=f}s.push({value:f,text:_})}return s};BX.CrmWidgetDataPreset.getItem=function(t){if(!BX.type.isNotEmptyString(t)){return null}for(var e=0;e<this.items.length;e++){var i=this.items[e];var n=BX.type.isNotEmptyString(i["name"])?i["name"]:"";if(n===t){return i}}return null}}if(typeof BX.CrmWidgetDataCategory==="undefined"){BX.CrmWidgetDataCategory=function(){};BX.CrmWidgetDataCategory.prototype={};BX.CrmWidgetDataCategory.items=[];BX.CrmWidgetDataCategory.notSelected="-";BX.CrmWidgetDataCategory.groupTitle="";BX.CrmWidgetDataCategory.selectorTitle="";BX.CrmWidgetDataCategory.getItem=function(t){if(!BX.type.isNotEmptyString(t)){return null}for(var e=0;e<this.items.length;e++){var i=this.items[e];var n=BX.type.isNotEmptyString(i["name"])?i["name"]:"";if(n===t){return i}}return null};BX.CrmWidgetDataCategory.prepareListItems=function(t){if(!BX.type.isNotEmptyString(t)){t=""}var e=[{value:"",text:this.notSelected}];for(var i=0;i<this.items.length;i++){var n=this.items[i];var r=BX.type.isNotEmptyString(n["entity"])?n["entity"]:"";if(r!==t){continue}var s=BX.type.isNotEmptyString(n["name"])?n["name"]:"";var o=BX.type.isNotEmptyString(n["title"])?n["title"]:"";if(o===""){o=s}e.push({value:s,text:o})}return e}}if(typeof BX.CrmWidgetPanelCell==="undefined"){BX.CrmWidgetPanelCell=function(){this._id="";this._settings=null;this._prefix="";this._hasLayout=false;this._panel=null;this._row=null;this._container=null;this._widgets=[]};BX.CrmWidgetPanelCell.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"";this._settings=e?e:{};this._prefix=this.getSetting("prefix",this._id);this._row=this.getSetting("row");if(!this._row){throw"BX.CrmWidgetPanelCell: Parameter 'row' is not found."}this._panel=this.getSetting("panel");if(!this._panel){this._panel=this._row.getPanel()}this._container=this.getSetting("container",null);var i=this.getSetting("data",[]);var n=this.getSetting("controls",[]);var r=this._row.getHeight();var s=this._panel.getWidgetCount();var o=this._panel.getMaxWidgetCount();for(var a=0;a<i.length;a++){if(o>0&&s>=o){break}var h=n[a];var l=BX.type.isNotEmptyString(h["entityTypeName"])?h["entityTypeName"]:"";if(l===""){l=this._panel.getDefaultEntityTypeName()}var g=BX.CrmWidgetManager.getCurrent().createWidget(this._prefix+"_"+a,{cell:this,prefix:this._prefix,data:i[a],config:h,entityTypeName:l,heightInPixel:r});this._widgets.push(g);s++}},createWidget:function(t,e){var i=BX.CrmWidgetManager.getCurrent().createWidget(this._prefix+"_"+e,{cell:this,prefix:this._prefix,entityTypeName:BX.type.isNotEmptyString(t["entityTypeName"])?t["entityTypeName"]:"",config:BX.type.isPlainObject(t["config"])?t["config"]:{},data:BX.type.isPlainObject(t["data"])?t["data"]:{},heightInPixel:this._row.getHeight()});this.addWidget(i,e);return i},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getId:function(){return this._id},getRow:function(){return this._row},getPanel:function(){return this._panel},getContainer:function(){return this._container},getIndex:function(){return this._row.getCellIndex(this)},getConfig:function(){var t={controls:[]};for(var e=0;e<this._widgets.length;e++){var i=this._widgets[e];t["controls"].push(i.getConfig())}if(t["controls"].length==0){t["isEmpty"]="Y"}return t},getWidgets:function(){return this._widgets},getWidgetCount:function(){return this._widgets.length},getWidgetTotalHeight:function(){var t=0;for(var e=0;e<this._widgets.length;e++){t+=this._widgets[e].getHeight()}return t},getWidgetById:function(t){for(var e=0;e<this._widgets.length;e++){var i=this._widgets[e];if(i.getId()===t){return i}}return null},getWidgetIndex:function(t){for(var e=0;e<this._widgets.length;e++){if(t===this._widgets[e]){return e}}return-1},getNextWidget:function(t){var e=this._widgets.length-1;for(var i=0;i<e;i++){if(t===this._widgets[i]){return this._widgets[i+1]}}return null},addWidget:function(t,e){if(e<this._widgets.length){this._widgets.splice(e,0,t)}else{this._widgets.push(t)}t.setContainer(this._container)},removeWidget:function(t){var e=-1;for(var i=0;i<this._widgets.length;i++){if(t===this._widgets[i]){e=i;break}}if(e>=0){this._widgets.splice(e,1);t.setContainer(null)}},isEmpty:function(){return this._widgets.length===0},isThin:function(){return this._row.getHeight()-this.getWidgetTotalHeight()>0},layout:function(){if(this._hasLayout){return}this._container=BX.create("DIV",{attrs:{id:this._prefix+"_container",className:"crm-widget-container"}});if(this._row.getCellCount()>1){BX.addClass(this._container,this.getIndex()===0?"crm-widget-left":"crm-widget-right")}this._row.getContainer().appendChild(this._container);for(var t=0;t<this._widgets.length;t++){var e=this._widgets[t];e.setContainer(this._container);e.layout()}this._hasLayout=true},clearLayout:function(){if(!this._hasLayout){return}for(var t=0;t<this._widgets.length;t++){var e=this._widgets[t];e.clearLayout()}BX.cleanNode(this._container,true);this._container=null;this._hasLayout=false},invalidate:function(){for(var t=0;t<this._widgets.length;t++){this._widgets[t].invalidate()}}};BX.CrmWidgetPanelCell.getItemWidgetCount=function(t){return t?t.getWidgetCount():0};BX.CrmWidgetPanelCell.create=function(t,e){var i=new BX.CrmWidgetPanelCell;i.initialize(t,e);return i}}if(typeof BX.CrmWidgetPanelRow==="undefined"){BX.CrmWidgetPanelRow=function(){this._id="";this._settings=null;this._panel=null;this._prefix="";this._height=0;this._hasLayout=false;this._container=null;this._index=-1;this._cells=[]};BX.CrmWidgetPanelRow.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"";this._settings=e?e:{};this._panel=this.getSetting("panel");if(!this._panel){throw"BX.CrmWidgetPanelRow: Parameter 'panel' is not found."}this._prefix=this.getSetting("prefix",this._id);this._height=parseInt(this.getSetting("height",BX.CrmWidgetLayoutHeight.full));var i=this.getSetting("cells",[]);for(var n=0;n<i.length;n++){var r=BX.CrmWidgetPanelCell.create(this._prefix+"_"+(n+1),{row:this,controls:i[n]["controls"],data:i[n]["data"]});this._cells.push(r)}},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getId:function(){return this._id},getPanel:function(){return this._panel},getContainer:function(){return this._container},getCells:function(){return this._cells},getCellCount:function(){return this._cells.length},getMaxCellHeight:function(){var t=0;for(var e=0;e<this._cells.length;e++){var i=this._cells[e].getWidgetTotalHeight();if(i>t){t=i}}return t},getHeight:function(){return this._height},setHeight:function(t){this._height=t;if(this._container){this._container.style.height=this._height+"px"}},getIndex:function(){return this._panel.getRowIndex(this)},getConfig:function(){var t={cells:[]};for(var e=0;e<this._cells.length;e++){var i=this._cells[e];t["cells"].push(i.getConfig())}if(this._height>0){t["height"]=this._height}return t},getCellIndex:function(t){for(var e=0;e<this._cells.length;e++){if(this._cells[e]===t){return e}}return-1},getCellByIndex:function(t){return this._cells.length>t?this._cells[t]:null},getThinCells:function(){var t=[];for(var e=0;e<this._cells.length;e++){var i=this._cells[e];if(i.isThin()){t.push(i)}}return t},getWidgetById:function(t){var e=null;for(var i=0;i<this._cells.length;i++){e=this._cells[i].getWidgetById(t);if(e){break}}return e},getWidgetCount:function(){var t=0;for(var e=0;e<this._cells.length;e++){t+=this._cells[e].getWidgetCount()}return t},isEmpty:function(){for(var t=0;t<this._cells.length;t++){if(!this._cells[t].isEmpty()){return false}}return true},ensureCellCreated:function(t,e){if(t<0){return}e=!!e;for(var i=0;i<=t;i++){if(this._cells.length<=i){var n=BX.CrmWidgetPanelCell.create(this._prefix+"_"+(i+1),{row:this});this._cells.push(n);if(e){n.layout()}}}},layout:function(){if(this._hasLayout){return}this._container=BX.create("DIV",{attrs:{id:this._prefix+"_container",className:"crm-widget-row"}});this._container.style.height=this._height+"px";var t=this.getIndex();var e=this._panel.getContainer();if(t<0||t>e.children.length){t=e.children.length}if(t===e.children.length){e.appendChild(this._container)}else{e.insertBefore(this._container,e.children[t])}for(var i=0;i<this._cells.length;i++){this._cells[i].layout()}this._hasLayout=true},clearLayout:function(){if(!this._hasLayout){return}for(var t=0;t<this._cells.length;t++){var e=this._cells[t];e.clearLayout()}if(this._container){BX.cleanNode(this._container,true);this._container=null}this._hasLayout=false},invalidate:function(){for(var t=0;t<this._cells.length;t++){this._cells[t].invalidate()}}};BX.CrmWidgetPanelRow.create=function(t,e){var i=new BX.CrmWidgetPanelRow;i.initialize(t,e);return i}}if(typeof BX.CrmWidgetPanel==="undefined"){BX.CrmWidgetPanel=function(){this._id="";this._settings=null;this._defaultEntityTypeName="";this._entityTypeNames=null;this._layoutType=BX.CrmWidgetLayout.undifined;this._prefix="";this._container=null;this._settingButton=null;this._rows=[];this._dragDropController=null;this._saveConfigCallback=null;this._isSettingMenuShown=false;this._settingMenuId="";this._settingMenu=null;this._settingMenuHandler=BX.delegate(this.onSettingMenuItemClick,this);this._settingButtonClickHandler=BX.delegate(this.onSettingButtonClick,this);this._dynamicRowKeys={};this._isAjaxMode=false;this._isDemoMode=false;this._useDemoMode=true;this._demoModeInfoContainer=null;this._disableDemoModeButton=null;this._demoModeInfoCloseButton=null;this._disableDemoButtonClickHandler=BX.delegate(this.onDisableDemoButtonClick,this);this._demoModeInfoCloseButtonClickHandler=BX.delegate(this.onDemoInfoCloseButtonClick,this);this._typeSelector=null;this._layoutTypeSelector=null;this._maxGraphCount=0;this._maxWidgetCount=0};BX.CrmWidgetPanel.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"";this._settings=e?e:{};this._entityTypeNames=this.getSetting("entityTypes",[]);this._defaultEntityTypeName=this.getSetting("defaultEntityType","");if(this._defaultEntityTypeName===""&&this._entityTypeNames.length>0){this._defaultEntityTypeName=this._entityTypeNames[0]}this._isAjaxMode=this.getSetting("isAjaxMode",false);this._prefix=this.getSetting("prefix",this._id);var i=this.getSetting("containerId");if(!BX.type.isNotEmptyString(i)){throw"BX.CrmWidgetPanel: Parameter 'containerId' is not found."}this._container=BX(i);if(!this._container){throw"BX.CrmWidgetPanel: Container is not found."}this._layoutType=this.getSetting("layout",BX.CrmWidgetLayout.l50r50);this.processLayoutTypeChange();this._maxGraphCount=parseInt(this.getSetting("maxGraphCount",0));this._maxWidgetCount=parseInt(this.getSetting("maxWidgetCount",0));var n=this.getSetting("rows");if(BX.type.isArray(n)){for(var r=0;r<n.length;r++){var s=n[r];s["panel"]=this;var o=BX.CrmWidgetPanelRow.create(this._prefix+"_"+(r+1),s);this._rows.push(o)}}this._settingButton=BX(this.getSetting("settingButtonId"));if(this._settingButton){BX.bind(this._settingButton,"click",this._settingButtonClickHandler)}this._isDemoMode=this.getSetting("isDemoMode");this._useDemoMode=this.getSetting("useDemoMode",true);if(this._isDemoMode){this._demoModeInfoContainer=BX(this.getSetting("demoModeInfoContainerId"));this._disableDemoModeButton=BX(this.getSetting("disableDemoModeButtonId"));if(this._disableDemoModeButton){BX.bind(this._disableDemoModeButton,"click",this._disableDemoButtonClickHandler)}this._demoModeInfoCloseButton=BX(this.getSetting("demoModeInfoCloseButtonId"));if(this._demoModeInfoCloseButton){BX.bind(this._demoModeInfoCloseButton,"click",this._demoModeInfoCloseButtonClickHandler)}}BX.addCustomEvent("BX.Main.Filter:apply",BX.delegate(this.onFilterApply,this));BX.onCustomEvent(window,"CrmWidgetPanelCreated",[this])},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getId:function(){return this._id},getMessage:function(t){var e=BX.CrmWidgetPanel.messages;return e.hasOwnProperty(t)?e[t]:t},getContainer:function(){return this._container},getDefaultEntityTypeName:function(){return this._defaultEntityTypeName},getEntityTypeNames:function(){return this._entityTypeNames},getLayoutType:function(){return this._layoutType},setLayoutType:function(t){if(this._layoutType===t){return}this._layoutType=t;this.processLayoutTypeChange();this.invalidate();BX.showWait();BX.ajax.post(this.getSetting("serviceUrl",""),{guid:this._id,action:"savelayout",layout:t},BX.delegate(this.onAfterConfigSave,this))},getRows:function(){return this._rows},getRowCount:function(){return this._rows.length},getRowIndex:function(t){for(var e=0;e<this._rows.length;e++){if(this._rows[e]===t){return e}}return-1},getRowById:function(t){for(var e=0;e<this._rows.length;e++){var i=this._rows[e];if(i.getId()===t){return i}}return null},getRowByIndex:function(t){return this._rows.length>t?this._rows[t]:null},getThinCells:function(){var t=[];for(var e=0;e<this._rows.length;e++){var i=this._rows[e].getThinCells();for(var n=0;n<i.length;n++){t.push(i[n])}}return t},getWidgetById:function(t){var e=null;for(var i=0;i<this._rows.length;i++){e=this._rows[i].getWidgetById(t);if(e){break}}return e},getWidgetCount:function(){var t=0;for(var e=0;e<this._rows.length;e++){t+=this._rows[e].getWidgetCount()}return t},getCurrencyFormat:function(){return this.getSetting("currencyFormat",null)},getMaxGraphCount:function(){return this._maxGraphCount},getMaxWidgetCount:function(){return this._maxWidgetCount},openTypeSelector:function(){if(this._layoutTypeSelector&&this._layoutTypeSelector.isDialogOpened()){this._layoutTypeSelector.closeDialog()}if(!this._typeSelector){this._typeSelector=BX.CrmWidgetTypeSelector.create(this._id+"_widget_type_selector",{entityTypeNames:this._entityTypeNames.length>0?this._entityTypeNames:[this._defaultEntityTypeName],callback:BX.delegate(this.onConfiguratorAction,this)})}this._typeSelector.openDialog()},openLayoutTypeSelector:function(){if(this._typeSelector&&this._typeSelector.isDialogOpened()){this._typeSelector.closeDialog()}if(!this._layoutTypeSelector){this._layoutTypeSelector=BX.CrmWidgetPanelLayoutTypeSelector.create(this._id+"_layout_type_selector",{layoutType:this._layoutType,callback:BX.delegate(this.onConfiguratorAction,this)})}this._layoutTypeSelector.openDialog()},onConfiguratorAction:function(t,e){if(t!==this._typeSelector&&t!==this._layoutTypeSelector){return}t.closeDialog();var i=BX.type.isNotEmptyString(e["action"])?e["action"]:"";var n=BX.type.isPlainObject(e["data"])?e["data"]:{};if(i==="addItem"&&BX.type.isPlainObject(n["params"])){this.addWidget(n["params"],true)}else if(i="changeLayout"&&BX.type.isNotEmptyString(n["layoutType"])){this.setLayoutType(n["layoutType"])}},addWidget:function(t,e){var i=this.getWidgetCount();if(this._maxWidgetCount>0&&i>=this._maxWidgetCount){alert(this.getMessage("maxWidgetError").replace(/#MAX_WIDGET_COUNT#/gi,this._maxWidgetCount));return}var n=this.createRow({index:0,height:BX.type.isNumber(t["rowHeight"])?t["rowHeight"]:BX.CrmWidgetLayoutHeight.full,cellCount:1});var r=n.getCellByIndex(0).createWidget(t,0);r.layout();if(e){r.scrollIntoView()}this._dragDropController.registerRow(n);this.saveConfig(function(){r.openConfigDialog()})},createRow:function(t){var e=BX.util.getRandomString(6).toLowerCase();while(this._dynamicRowKeys.hasOwnProperty(e)){e=BX.util.getRandomString(8).toLowerCase()}var i=this._prefix+"_"+e;this._dynamicRowKeys[e]=i;var n=t["index"];var r=t["height"];var s=t["cellCount"];var o=BX.CrmWidgetPanelRow.create(i,{panel:this,height:r,dynamicKey:e});for(var a=0;a<s;a++){o.ensureCellCreated(a,false)}this._rows.splice(n,0,o);o.layout();return o},removeRow:function(t){for(var e=0;e<this._rows.length;e++){if(this._rows[e]===t){var i=t.getSetting("dynamicKey","");if(i!==""){delete this._dynamicRowKeys[i]}t.clearLayout();this._rows.splice(e,1);return}}},moveWidget:function(t,e,i,n){t.clearLayout();t.undock();e.ensureCellCreated(i);var r=e.getCellByIndex(i);t.dock(r,n);t.layout()},processWidgetRemoval:function(t){var e=t.getRow();if(!e){return}if(!t.remove()){return}this._dragDropController.processRowChange(e);this.saveConfig()},processWidgetRefresh:function(t){this._dragDropController.processWidgetChange(t)},processLayoutTypeChange:function(){var t="crm-widget";if(this._layoutType===BX.CrmWidgetLayout.l70r30){t="crm-widget-70-30"}else if(this._layoutType===BX.CrmWidgetLayout.l50r50){t="crm-widget-50-50"}else if(this._layoutType===BX.CrmWidgetLayout.l30r70){t="crm-widget-30-70"}this._container.className=t},layout:function(){for(var t=0;t<this._rows.length;t++){this._rows[t].layout()}this._dragDropController=BX.CrmWidgetDragDropController.create(this._id,{panel:this,wrapper:this._container,rows:this._rows})},saveConfig:function(t){var e=this.getSetting("serviceUrl","");if(!BX.type.isNotEmptyString(e)){throw"BX.CrmWidgetPanel: Parameter 'serviceUrl' is not found."}var i={guid:this._id,action:"saveconfig",rows:[]};for(var n=0;n<this._rows.length;n++){i["rows"].push(this._rows[n].getConfig())}if(BX.type.isFunction(t)){this._saveConfigCallback=t}BX.showWait();BX.ajax.post(e,i,BX.delegate(this.onAfterConfigSave,this))},resetConfig:function(t){var e=this.getSetting("serviceUrl","");if(!BX.type.isNotEmptyString(e)){throw"BX.CrmWidgetPanel: Parameter 'serviceUrl' is not found."}var i={guid:this._id,action:"resetrows",rows:[]};for(var n=0;n<this._rows.length;n++){i["rows"].push(this._rows[n].getConfig())}if(BX.type.isFunction(t)){this._saveConfigCallback=t}BX.showWait();BX.ajax.post(e,i,BX.delegate(this.onAfterConfigSave,this))},enableDemoMode:function(t,e){t=!!t;window.setTimeout(function(){window.location.reload()},200);var i=this.getSetting("serviceUrl","");if(!BX.type.isNotEmptyString(i)){throw"BX.CrmWidgetPanel: Parameter 'serviceUrl' is not found."}var n={guid:this._id,action:"enabledemo",enable:t?"Y":"N"};if(BX.type.isFunction(e)){this._saveConfigCallback=e}BX.showWait();BX.ajax.post(i,n,BX.delegate(this.onAfterConfigSave,this))},isAjaxMode:function(){return this._isAjaxMode},invalidate:function(){for(var t=0;t<this._rows.length;t++){this._rows[t].invalidate()}},onAfterConfigSave:function(){BX.closeWait();if(this._saveConfigCallback){this._saveConfigCallback();this._saveConfigCallback=null;

}},onSettingButtonClick:function(){if(!this._isSettingMenuShown){this.openSettingMenu()}else{this.closeSettingMenu()}},openSettingMenu:function(){if(this._isSettingMenuShown){return}this._settingMenuId=this._id+"_menu";if(typeof BX.PopupMenu.Data[this._settingMenuId]!=="undefined"){BX.PopupMenu.Data[this._settingMenuId].popupWindow.destroy();delete BX.PopupMenu.Data[this._settingMenuId]}var t=[];if(!this._isDemoMode){t.push({id:"add",text:this.getMessage("menuItemAdd"),onclick:this._settingMenuHandler})}t.push({id:"layout",text:this.getMessage("menuChangeLayout"),onclick:this._settingMenuHandler});t.push({id:"reset",text:this.getMessage("menuItemReset"),onclick:this._settingMenuHandler});if(!this._isDemoMode&&this._useDemoMode){t.push({id:"enabledemomode",text:this.getMessage("menuItemEnableDemoMode"),onclick:this._settingMenuHandler})}this._settingMenu=BX.PopupMenu.create(this._settingMenuId,this._settingButton,t,{autoHide:true,offsetLeft:-21,offsetTop:-3,angle:{position:"top",offset:42},events:{onPopupClose:BX.delegate(this.onSettingMenuClose,this)}});this._settingMenu.popupWindow.show();this._isSettingMenuShown=true},closeSettingMenu:function(){if(this._settingMenu&&this._settingMenu.popupWindow){this._settingMenu.popupWindow.close()}},onSettingMenuClose:function(){this._settingMenu=null;if(typeof BX.PopupMenu.Data[this._settingMenuId]!=="undefined"){BX.PopupMenu.Data[this._settingMenuId].popupWindow.destroy();delete BX.PopupMenu.Data[this._settingMenuId]}this._isSettingMenuShown=false},onSettingMenuItemClick:function(t,e){this.processAction(e.id);this.closeSettingMenu()},onDisableDemoButtonClick:function(t){this.enableDemoMode(false,function(){window.location.reload()})},onDemoInfoCloseButtonClick:function(){if(this._disableDemoModeButton){BX.unbind(this._disableDemoModeButton,"click",this._disableDemoButtonClickHandler);this._disableDemoModeButton=null}if(this._demoModeInfoCloseButton){BX.unbind(this._demoModeInfoCloseButton,"click",this._demoModeInfoCloseButtonClickHandler);this._demoModeInfoCloseButton=null}BX.cleanNode(this._demoModeInfoContainer,true);this._demoModeInfoContainer=null},onFilterApply:function(t,e,i){window.location.reload()},processAction:function(t){if(t==="add"){var e=this.getWidgetCount();if(this._maxWidgetCount>0&&e>=this._maxWidgetCount){alert(this.getMessage("maxWidgetError").replace(/#MAX_WIDGET_COUNT#/gi,this._maxWidgetCount))}else{this.openTypeSelector()}}else if(t==="layout"){this.openLayoutTypeSelector()}else if(t==="reset"){this.resetConfig(function(){window.location.reload()})}else if(t==="enabledemomode"){this.enableDemoMode(true,function(){window.location.reload()})}}};if(typeof BX.CrmWidgetPanel.messages==="undefined"){BX.CrmWidgetPanel.messages={}}BX.CrmWidgetPanel.isAjaxMode=false;BX.CrmWidgetPanel.current=null;BX.CrmWidgetPanel.create=function(t,e){var i=new BX.CrmWidgetPanel;i.initialize(t,e);return i}}if(typeof BX.CrmWidgetLayout==="undefined"){BX.CrmWidgetLayout={undifined:"",l70r30:"L70R30",l50r50:"L50R50",l30r70:"L30R70",getAll:function(){return[this.l70r30,this.l50r50,this.l30r70]}}}if(typeof BX.CrmWidgetLayoutHeight==="undefined"){BX.CrmWidgetLayoutHeight={undifined:0,full:380,half:180}}if(typeof BX.CrmWidgetExpressionOperation==="undefined"){BX.CrmWidgetExpressionOperation={undefined:"",sum:"SUM",diff:"DIFF",percent:"PC",descriptions:{},prepareListItems:function(){var t=[];for(var e in this.descriptions){if(!this.descriptions.hasOwnProperty(e)){continue}t.push({value:e,text:this.descriptions[e]})}return t},getMessage:function(t){var e=BX.CrmWidgetExpressionOperation.messages;return e.hasOwnProperty(t)?e[t]:t},getDescription:function(t){return this.descriptions.hasOwnProperty(t)?this.descriptions[t]:""},getLegend:function(t){t=t.toUpperCase();if(t===this.diff){return this.getMessage("diffLegend")}else if(t===this.sum){return this.getMessage("sumLegend")}else if(t===this.percent){return this.getMessage("percentLegend")}return""},getHint:function(){return this.getMessage("hint")},getSign:function(t){t=t.toUpperCase();if(t===this.diff){return"&#8722;"}else if(t===this.sum){return"&#43;"}else if(t===this.percent){return"&#37;"}return""},getIconClassName:function(t){t=t.toUpperCase();if(t===this.diff){return"action-icon action-icon-minus"}else if(t===this.sum){return"action-icon action-icon-plus"}else if(t===this.percent){return"action-icon action-icon-persent"}return"action-icon"},getSymbolClassName:function(t){t=t.toUpperCase();if(t===this.diff){return"symbol symbol-minus"}else if(t===this.sum){return"symbol symbol-plus"}else if(t===this.percent){return"symbol symbol-persent"}return""}};if(typeof BX.CrmWidgetExpressionOperation.messages==="undefined"){BX.CrmWidgetExpressionOperation.messages={}}}if(typeof BX.CrmWidgetConfigControlMode==="undefined"){BX.CrmWidgetConfigControlMode={undifined:0,view:1,edit:2}}if(typeof BX.CrmWidgetFilterPeriod==="undefined"){BX.CrmWidgetFilterPeriod={undefined:"",year:"Y",quarter:"Q",month:"M",currentMonth:"M0",currentQuarter:"Q0",lastDays90:"D90",lastDays60:"D60",lastDays30:"D30",lastDays7:"D7",descriptions:{},getDescription:function(t){return this.descriptions.hasOwnProperty(t)?this.descriptions[t]:""},prepareListItems:function(t,e){if(!t){t={}}e=!!e;var i=[];for(var n in this.descriptions){if(!this.descriptions.hasOwnProperty(n)){continue}if(n===BX.CrmWidgetFilterPeriod.undefined&&e){continue}var r=t.hasOwnProperty(n)?t[n]:this.descriptions[n];i.push({value:n,text:r})}return i}}}if(typeof BX.CrmWidgetColorScheme==="undefined"){BX.CrmWidgetColorScheme={undifined:"",red:"red",green:"green",blue:"blue",cyan:"cyan",yellow:"yellow",descriptions:{},infos:{red:{color:"#f02f2f"},green:{color:"#05d215"},blue:{color:"#4fc3f7"},cyan:{color:"#50c5d3"},yellow:{color:"#f7d622"}},getInfo:function(t){return typeof this.infos[t]!=="undefined"?this.infos[t]:null},prepareMenuItems:function(t){var e=[];for(var i in this.infos){if(!this.infos.hasOwnProperty(i)){continue}var n=this.infos[i]["color"];var r=this.descriptions[i];e.push({id:i,text:'<span class="color-item"><span style="background: '+n+';" class="color"></span>'+r+"</span>",onclick:t})}return e}}}if(typeof BX.CrmWidgetDataContext==="undefined"){BX.CrmWidgetDataContext={undefined:"",entity:"E",fund:"F",percent:"P",descriptions:{},prepareListItems:function(){var t=[];for(var e in this.descriptions){if(!this.descriptions.hasOwnProperty(e)){continue}t.push({value:e,text:this.descriptions[e]})}return t}}}if(typeof BX.CrmPhaseSemantics==="undefined"){BX.CrmPhaseSemantics={undefined:"",process:"P",success:"S",failure:"F",descriptions:{},detailedInfos:{},getCaption:function(t){return BX.type.isNotEmptyString(t)&&BX.type.isPlainObject(this.detailedInfos[t])&&BX.type.isNotEmptyString(this.detailedInfos[t]["caption"])?this.detailedInfos[t]["caption"]:""},getSelectorTitle:function(t){return BX.type.isNotEmptyString(t)&&BX.type.isPlainObject(this.detailedInfos[t])&&BX.type.isNotEmptyString(this.detailedInfos[t]["selectorTitle"])?this.detailedInfos[t]["selectorTitle"]:""},getGroupTitle:function(t){return BX.type.isNotEmptyString(t)&&BX.type.isPlainObject(this.detailedInfos[t])&&BX.type.isNotEmptyString(this.detailedInfos[t]["groupTitle"])?this.detailedInfos[t]["groupTitle"]:""},prepareListItems:function(t){var e=BX.type.isNotEmptyString(t)&&BX.type.isPlainObject(this.detailedInfos[t])&&BX.type.isPlainObject(this.detailedInfos[t]["descriptions"])?this.detailedInfos[t]["descriptions"]:this.descriptions;var i=[];for(var n in e){if(!e.hasOwnProperty(n)){continue}i.push({value:n,text:e[n]})}return i},isSupported:function(t){return t===BX.CrmEntityType.names.lead||t===BX.CrmEntityType.names.deal||t===BX.CrmEntityType.names.invoice}}}if(typeof BX.CrmWidgetManager==="undefined"){BX.CrmWidgetManager=function(){this._factories={};this._defaultFactory=null;this._requestQueue=null;this._isRequestRunning=false};BX.CrmWidgetManager.prototype={initialize:function(){this._requestQueue=[]},createWidget:function(t,e){e=e?e:{};var i=e.hasOwnProperty("config")?e["config"]:{};var n=i.hasOwnProperty("typeName")?i["typeName"]:"";if(n===""){throw"CrmWidgetManager: The type name is not found."}if(n==="funnel"){return BX.CrmFunnelWidget.create(t,e)}else if(n==="pie"){return BX.CrmPieWidget.create(t,e)}else if(n==="graph"||n==="bar"){return BX.CrmGraphWidget.create(t,e)}else if(n==="number"){return BX.CrmNumericWidget.create(t,e)}else if(n==="rating"){return BX.CrmRatingWidget.create(t,e)}else if(n==="custom"){return BX.CrmCustomWidget.create(t,e)}return BX.CrmWidget.create(t,e)},createConfigEditor:function(t,e,i,n){return this.resolveFactory(t).createConfigEditor(e,i,n)},createPresetEditor:function(t,e,i,n){return this.resolveFactory(t).createPresetEditor(e,i,n)},prepareWidgetData:function(t){this.addToQueueItem(t,"PREPARE_DATA",{CONTROL:t.getConfig(),FILTER:BX.CrmWidgetManager.filter,CONTEXT_DATA:BX.CrmWidgetManager.contextData,CONTEXT_ENTITY_TYPE_NAME:BX.CrmWidgetManager.contextEntityTypeName,CONTEXT_ENTITY_ID:BX.CrmWidgetManager.contextEntityID});this.processQueue()},registerFactory:function(t,e){this._factories[t]=e},unregisterFactory:function(t){if(typeof this._factories[t]!=="undefined"){delete this._factories[t]}},getDefaultFactory:function(){if(this._defaultFactory===null){this._defaultFactory=BX.CrmWidgetFactory.create("default")}return this._defaultFactory},resolveFactory:function(t){if(typeof this._factories[t]!=="undefined"){return this._factories[t]}return this.getDefaultFactory()},addToQueueItem:function(t,e,i){var n=t.getId()+"_"+BX.util.getRandomString(8).toLowerCase();this._requestQueue.push({guid:n,widget:t,action:e,params:i})},getQueueItem:function(t){for(var e=0;e<this._requestQueue.length;e++){if(this._requestQueue[e]["guid"]===t){return this._requestQueue[e]}}return null},removeQueueItem:function(t){for(var e=0;e<this._requestQueue.length;e++){if(this._requestQueue[e]===t){this._requestQueue.splice(e,1);return true}}return false},processQueue:function(){if(this._isRequestRunning||this._requestQueue.length===0){return}var t=this._requestQueue[0];var e=t["params"];e["GUID"]=t["guid"];this._startRequest(t["action"],e)},getContextParam:function(t,e){var i=BX.CrmWidgetManager.contextData;return i.hasOwnProperty(t)?i[t]:e},_startRequest:function(t,e){if(this._isRequestRunning){return false}var i=BX.CrmWidgetManager.serviceUrl;if(!BX.type.isNotEmptyString(i)){throw"CrmWidgetManager: Could no start request. The fild 'serviceUrl' is not assigned."}this._isRequestRunning=true;BX.showWait();BX.ajax({url:i,method:"POST",dataType:"json",data:{ACTION:t,PARAMS:e},onsuccess:BX.delegate(this._onRequestSuccess,this),onfailure:BX.delegate(this._onRequestFailure,this)});return true},_onRequestSuccess:function(t){this._isRequestRunning=false;BX.closeWait();if(!BX.type.isPlainObject(t["RESULT"])){return}var e=t["RESULT"];var i=BX.type.isNotEmptyString(e["GUID"])?this.getQueueItem(e["GUID"]):null;if(!i){return}if(BX.type.isPlainObject(e["DATA"])){i["widget"].setData(e["DATA"]);i["widget"].refresh()}this.removeQueueItem(i)},_onRequestFailure:function(t){this._isRequestRunning=false;BX.closeWait()}};if(typeof BX.CrmWidgetManager.serviceUrl==="undefined"){BX.CrmWidgetManager.serviceUrl=""}if(typeof BX.CrmWidgetManager.filter==="undefined"){BX.CrmWidgetManager.filter={}}if(typeof BX.CrmWidgetManager.contextData==="undefined"){BX.CrmWidgetManager.contextData={}}if(typeof BX.CrmWidgetManager.contextEntityTypeName==="undefined"){BX.CrmWidgetManager.contextEntityTypeName=""}if(typeof BX.CrmWidgetManager.contextEntityID==="undefined"){BX.CrmWidgetManager.contextEntityID=0}BX.CrmWidgetManager.current=null;BX.CrmWidgetManager.getCurrent=function(){if(!this.current){this.current=new BX.CrmWidgetManager;this.current.initialize()}return this.current}}if(typeof BX.CrmWidgetDragDropController==="undefined"){BX.CrmWidgetDragDropController=function(){this._id="";this._settings=null;this.panel=null;this.wrapper=null;this.dropZoneListObj={};this.dropZoneList=[];this.dropZoneCounter=0;this.dropZoneActiveClass="crm-widget-catcher-inner-active";this.activeDragRow=null;this.prevEventPosX=0;this.prevEventPosY=0;this.isDropBlockShow=false};BX.CrmWidgetDragDropController.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"";this._settings=e?e:{};this.panel=e.panel;var i=e.rows;for(var n=0;n<i.length;n++){var r=i[n];r.getContainer().setAttribute("data-row-id",r.getId())}this.wrapper=e.wrapper;this.ddPlaceBlock=this.createDropZoneBlock();this.crmDnD=BX.DragDrop.create({dragItemClassName:"crm-widget",dropZoneList:this.dropZoneList,dragActiveClass:"crm-widget-drag-active",drag:BX.delegate(this.drag,this),dragStart:BX.delegate(this.dragStart,this),dragDrop:BX.delegate(this.dragDrop,this),dragEnter:BX.delegate(this.dragEnter,this),dragLeave:BX.delegate(this.dragLeave,this),dragEnd:BX.delegate(this.dragEnd,this),sortable:{rootElem:e.wrapper,className:"crm-widget-row",node:this.ddPlaceBlock}});this.initializeCellDropZones()},initializeCellDropZones:function(){var t=this.panel.getThinCells();for(var e=0;e<t.length;e++){var i=t[e];var n=i.getWidgetTotalHeight();if(n>BX.CrmWidgetLayoutHeight.half){continue}var r=i.getRow();var s=n>0?BX.CrmWidgetLayoutHeight.half:r.getHeight();var o=this.createDropZone({parentRowId:r.getId(),parentCellId:i.getId(),height:s,htmlHeight:s,position:r.getCellCount()>1?r.getCellIndex(i)>0?"right":"left":"wide"});o.style.display="none";i.getContainer().appendChild(o)}},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getId:function(){return this._id},getRowInfo:function(t){var e={height:0,node:null,index:0,chartsCount:0};var i=this.panel.getRowById(t);if(i){e.height=i.getHeight();e.node=i.getContainer();e.index=i.getIndex();e.chartsCount=i.getWidgetCount()}return e},getWidgetInfo:function(t){var e={height:0,node:null,parentRowId:"",parentCellId:"",rowIndex:-1,cellIndex:-1,index:-1};var i=this.panel.getWidgetById(t);if(i){var n=i.getCell();var r=n.getRow();e.height=i.getHeight();e.node=i.getWrapper();e.parentRowId=r.getId();e.parentCellId=n.getId();e.rowIndex=r.getIndex();e.cellIndex=n.getIndex();e.index=i.getIndex()}return e},createDropZone:function(t){var e=t.position||null,i=t.parentRowId||null,n=t.parentCellId||null,r=t.height,s=t.htmlHeight;var o="dropZone-"+this.dropZoneCounter;this.dropZoneCounter++;var a=BX.create("div",{props:{className:"crm-widget-catcher-inner"},attrs:{"data-dropZone-id":o},style:{height:s+"px"}});this.dropZoneListObj[o]={id:o,node:a,position:e,parentRowId:i,parentCellId:n,height:r};if(i)this.crmDnD.addCatcher(a);if(e)this.dropZoneList.push(a);return a},createDropZoneBlock:function(){return BX.create("div",{props:{className:"crm-widget-catcher-wrap"},children:[BX.create("div",{props:{className:"crm-widget-catcher crm-widget-left"},children:[this.createDropZone({position:"left",height:BX.CrmWidgetLayoutHeight.full,htmlHeight:55})]}),BX.create("div",{props:{className:"crm-widget-catcher crm-widget-right"},children:[this.createDropZone({position:"right",height:BX.CrmWidgetLayoutHeight.full,htmlHeight:55})]}),BX.create("div",{props:{className:"crm-widget-catcher crm-widget-bottom"},children:[this.createDropZone({position:"wide",height:BX.CrmWidgetLayoutHeight.full,htmlHeight:55})]})]})},showDropZone:function(t){for(var e in this.dropZoneListObj){if(t==BX.CrmWidgetLayoutHeight.half&&this.dropZoneListObj[e].height<=BX.CrmWidgetLayoutHeight.full)this.dropZoneListObj[e].node.style.display="block";else if(this.dropZoneListObj[e].height==BX.CrmWidgetLayoutHeight.full)this.dropZoneListObj[e].node.style.display="block"}},hideDropZone:function(){for(var t in this.dropZoneListObj){BX.removeClass(this.dropZoneListObj[t].node,this.dropZoneActiveClass);this.dropZoneListObj[t].node.style.display="none"}},showDropBlock:function(t){this.ddPlaceBlock.style.display="block";this.wrapper.insertBefore(this.ddPlaceBlock,t);setTimeout(BX.delegate(function(){this.ddPlaceBlock.style.height=133+"px"},this),50)},hideDropBlock:function(){this.ddPlaceBlock.style.height=0;this.isDropBlockShow=false;setTimeout(BX.delegate(function(){this.wrapper.removeChild(this.ddPlaceBlock)},this),300)},showNewRow:function(t){var e=this.getRowInfo(t);this.wrapper.insertBefore(e.node,this.ddPlaceBlock);e.node.setAttribute("data-row-id",t);e.node.style.opacity=0;e.node.style.height=133+"px";this.ddPlaceBlock.style.display="none";setTimeout(BX.delegate(function(){e.node.style.height=e.height+"px";e.node.style.opacity=1}),50)},getCellDropZone:function(t){for(var e in this.dropZoneListObj){if(!this.dropZoneListObj.hasOwnProperty(e)){continue}var i=this.dropZoneListObj[e];if(i.parentCellId===t){return i}}return null},registerRow:function(t){var e=t.getContainer();e.setAttribute("data-row-id",t.getId());this.crmDnD.addSortableItem(e);var i=t.getCells();for(var n=0;n<i.length;n++){var r=i[n].getWidgets();for(var s=0;s<r.length;s++){this.crmDnD.addDragItem([r[s].getWrapper()])}}this.processRowChange(t)},processWidgetChange:function(t){this.crmDnD.addDragItem([t.getWrapper()])},processRowChange:function(t){if(t.isEmpty()){this.crmDnD.removeSortableItem(t.getContainer());this.panel.removeRow(t);return}var e=0,i=null,n=0,r=0;var s=t.getCells();var o=s.length;for(e=0;e<o;e++){n=s[e].getWidgetTotalHeight();if(r<n){r=n}}var a=t.getHeight();if(a!==r){a=r>BX.CrmWidgetLayoutHeight.half?BX.CrmWidgetLayoutHeight.full:BX.CrmWidgetLayoutHeight.half;t.setHeight(a)}for(e=0;e<o;e++){i=s[e];n=i.getWidgetTotalHeight();var h=this.getCellDropZone(i.getId());var l=a-n>=BX.CrmWidgetLayoutHeight.half;if(!l&&h){delete this.dropZoneListObj[h.id];this.crmDnD.removeCatcher(h.node);BX.cleanNode(h.node,true)}else if(l){var g=n===0?a:BX.CrmWidgetLayoutHeight.half;if(h){delete this.dropZoneListObj[h.id];this.crmDnD.removeCatcher(h.node);BX.cleanNode(h.node,true)}var d=this.createDropZone({parentRowId:t.getId(),parentCellId:i.getId(),height:g,htmlHeight:g,position:o>1?i.getIndex()>0?"right":"left":"wide"});d.style.display="none";i.getContainer().appendChild(d)}}},dragStart:function(t){var e=t.dragElement.getAttribute("data-widget-id");var i=this.getWidgetInfo(e);var n=i.parentRowId;var r=this.getRowInfo(n).node;var s=i.height;this.showDropZone(s);this.activeDragRow=r;this.prevEventPosY=t.event.clientY;this.prevEventPosX=t.event.clientX},drag:function(t,e,i){this.dragClientY=i.clientFFY||i.clientY;if(this.dragClientY>this.prevEventPosY&&!this.isDropBlockShow){this.showDropBlock(this.activeDragRow.nextSibling);this.isDropBlockShow=true}else if(this.dragClientY<this.prevEventPosY&&!this.isDropBlockShow){this.showDropBlock(this.activeDragRow);this.isDropBlockShow=true}this.prevEventPosY=this.dragClientY},dragDrop:function(t,e){var i=t.getAttribute("data-dropZone-id");var n=this.dropZoneListObj[i];var r=e.getAttribute("data-widget-id");var s=this.panel.getWidgetById(r);var o=null;var a=0;var h=0;if(n.parentRowId){o=this.panel.getRowById(n.parentRowId);a=n.position==="right"?1:0;h=BX.CrmWidgetPanelCell.getItemWidgetCount(o.getCellByIndex(a))}else if(n.position){var l=this.panel.getRowCount();var g=BX.findNextSibling(this.ddPlaceBlock,{tagName:"DIV",className:"crm-widget-row"});if(g){l=this.panel.getRowById(g.getAttribute("data-row-id")).getIndex()}o=this.panel.createRow({index:l,height:s.getHeight(),cellCount:n.position==="wide"?1:2});a=n.position==="right"?1:0;h=0;var d=o.getId();this.crmDnD.addSortableItem(o.getContainer());this.showNewRow(d)}var c=s.getRow();this.panel.moveWidget(s,o,a,h);this.crmDnD.addDragItem([s.getWrapper()]);o=s.getRow();this.processRowChange(c);if(o!==c){this.processRowChange(o)}this.panel.saveConfig()},dragEnter:function(t){BX.addClass(t,this.dropZoneActiveClass)},dragLeave:function(t){BX.removeClass(t,this.dropZoneActiveClass)},dragEnd:function(){this.hideDropZone();this.hideDropBlock();this.isDropBlockShow=false}};BX.CrmWidgetDragDropController.items={};BX.CrmWidgetDragDropController.create=function(t,e){var i=new BX.CrmWidgetDragDropController;i.initialize(t,e);this.items[i.getId()]=i;return i}}if(typeof BX.CrmWidgetTypeSelector==="undefined"){BX.CrmWidgetTypeSelector=function(){this._id="";this._settings=null;this._currentEntityTypeName="";this._entityTypeNames=null;this._tabs=null;this._widgetTypeItems=null;this._widgetTypeContainer=null;this._tabSelectionHandler=BX.delegate(this.onTabSelection,this);this._widgetTypeSelectionHandler=BX.delegate(this.onWidgetTypeSelection,this);this._callback=null;this._dlg=null};BX.CrmWidgetTypeSelector.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"";this._settings=e?e:{};this._entityTypeNames=this.getSetting("entityTypeNames",[]);this._currentEntityTypeName=this._entityTypeNames.length>0?this._entityTypeNames[0]:"";this._callback=this.getSetting("callback");if(!BX.type.isFunction(this._callback)){this._callback=null}},getId:function(){return this._id},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getMessage:function(t){var e=BX.CrmWidgetTypeSelector.messages;return e.hasOwnProperty(t)?e[t]:t},isEntityTypeEnabled:function(t){for(var e=0;e<this._entityTypeNames.length;e++){if(this._entityTypeNames[e]===t){return true}}return false},openDialog:function(){if(this._dlg){return}var t=this._id;this._dlg=new BX.PopupWindow(t,null,{autoHide:false,draggable:true,bindOptions:{forceBindPosition:false},closeByEsc:false,closeIcon:{top:"10px",right:"15px"},zIndex:0,titleBar:this.getMessage("dialogTitle"),content:this.prepareDialogContent(),buttons:[new BX.PopupWindowButtonLink({text:this.getMessage("dialogCancelButton"),className:"popup-window-button-link-cancel",events:{click:BX.delegate(this.onDialogCancelButtonClick,this)}})],events:{onPopupShow:BX.delegate(this.onDialogShow,this),onPopupClose:BX.delegate(this.onDialogClose,this),onPopupDestroy:BX.delegate(this.onDialogDestroy,this)}});this._dlg.show()},closeDialog:function(){if(this._dlg){this._dlg.close()}},isDialogOpened:function(){return this._dlg&&this._dlg.isShown()},prepareDialogContent:function(){var t=BX.create("DIV",{attrs:{className:"view-report-wrapper-container"}});var e=BX.create("DIV",{attrs:{className:"view-report-sidebar"}});t.appendChild(e);this._tabs=[];for(var i=0;i<BX.CrmWidgetTypeSelector.entityTypeInfos.length;i++){var n=BX.CrmWidgetTypeSelector.entityTypeInfos[i];var r=BX.type.isNotEmptyString(n["name"])?n["name"]:"";if(r===""){continue}var s=BX.type.isNotEmptyString(n["description"])?n["description"]:"";if(s===""){s=r}var o=this.isEntityTypeEnabled(r);var a=BX.CrmWidgetPanelConfiguratorTab.create(r,{title:s,isEnabled:o,isActive:this._currentEntityTypeName===r,container:e,configurator:this});this._tabs.push(a);a.addSelectionListener(this._tabSelectionHandler);a.layout()}var h=BX.create("DIV",{attrs:{className:"view-report-wrapper view-report-wrapper-popup"}});t.appendChild(h);this._widgetTypeContainer=BX.create("DIV",{attrs:{className:"view-report-wrapper-inner"}});h.appendChild(this._widgetTypeContainer);this._widgetTypeItems=[];for(var l=0;l<BX.CrmWidgetTypeSelector.infos.length;l++){var g=BX.CrmWidgetTypeSelector.infos[l];if(g["name"]==="funnel"&&(this.isEntityTypeEnabled("ACTIVITY")||this.isEntityTypeEnabled("CONTACT")||this.isEntityTypeEnabled("COMPANY"))){continue}var d=BX.CrmWidgetTypeSelectorItem.create(g["name"],{info:g,wrapper:this._widgetTypeContainer,configurator:this});this._widgetTypeItems.push(d);d.layout();d.addSelectionListener(this._widgetTypeSelectionHandler)}return t},onDialogShow:function(){},onDialogClose:function(){if(BX.type.isArray(this._tabs)){for(var t=0;t<this._tabs.length;t++){var e=this._tabs[t];e.removeSelectionListener(this._tabSelectionHandler);e.cleanLayout()}}this._tabs=null;if(this._dlg){this._dlg.destroy()}},onDialogDestroy:function(){this._dlg=null},onDialogCancelButtonClick:function(){this.closeDialog()},onTabSelection:function(t){var e=t.getId();if(this._currentEntityTypeName===e){return}this._currentEntityTypeName=e;for(var i=0,n=this._tabs.length;i<n;i++){var r=this._tabs[i];r.setActive(r.getId()===e)}},onWidgetTypeSelection:function(t){if(!this._callback){return}var e=t.getInfo();var i=BX.clone(e["params"]);i["entityTypeName"]=this._currentEntityTypeName;this._callback(this,{action:"addItem",data:{params:i}})}};if(typeof BX.CrmWidgetTypeSelector.messages==="undefined"){BX.CrmWidgetTypeSelector.messages={}}if(typeof BX.CrmWidgetTypeSelector.entityTypeInfos==="undefined"){BX.CrmWidgetTypeSelector.entityTypeInfos=[]}if(typeof BX.CrmWidgetTypeSelector.infos==="undefined"){BX.CrmWidgetTypeSelector.infos=[]}BX.CrmWidgetTypeSelector.create=function(t,e){var i=new BX.CrmWidgetTypeSelector;i.initialize(t,e);return i}}if(typeof BX.CrmWidgetTypeSelectorItem==="undefined"){BX.CrmWidgetTypeSelectorItem=function(){this._id="";this._settings=null;this._info=null;this._configurator=null;this._wrapper=null;this._container=null;this._clickHandler=BX.delegate(this.onClick,this);this._selectionNotifier=null;this._hasLayout=false};BX.CrmWidgetTypeSelectorItem.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"";this._settings=e?e:{};this._info=this.getSetting("info");if(!this._info){throw"CrmWidgetTypeSelectorItem: The 'info' parameter is not found."}this._configurator=this.getSetting("configurator");if(!this._configurator){throw"CrmWidgetTypeSelectorItem: The 'configurator' parameter is not found."}this._wrapper=this.getSetting("wrapper");if(!this._wrapper){throw"CrmWidgetTypeSelectorItem: The 'wrapper' parameter is not found."}this._selectionNotifier=BX.CrmNotifier.create(this)},getId:function(){return this._id},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getInfo:function(){return this._info},addSelectionListener:function(t){this._selectionNotifier.addListener(t)},removeSelectionListener:function(t){this._selectionNotifier.removeListener(t)},layout:function(){if(this._hasLayout){return}this._container=BX.create("DIV",{attrs:{className:"view-report-container"},children:[BX.create("DIV",{attrs:{className:"view-report"},children:[BX.create("IMG",{props:{src:this._info["logo"]}})]}),BX.create("DIV",{attrs:{className:"view-report-title"},text:this._info["title"]})]});BX.bind(this._container,"click",this._clickHandler);this._wrapper.appendChild(this._container);this._hasLayout=true},cleanLayout:function(){if(!this._hasLayout){return}BX.unbind(this._container,"click",this._clickHandler);BX.cleanNode(this._container,true);this._container=null;this._hasLayout=false},onClick:function(t){this._selectionNotifier.notify();return BX.PreventDefault(t)}};BX.CrmWidgetTypeSelectorItem.create=function(t,e){var i=new BX.CrmWidgetTypeSelectorItem;i.initialize(t,e);return i}}if(typeof BX.CrmWidgetPanelLayoutTypeSelector==="undefined"){BX.CrmWidgetPanelLayoutTypeSelector=function(){this._id="";this._settings=null;this._layoutTypeItems=null;this._layoutType=BX.CrmWidgetLayout.undifined;this._layoutTypeContainer=null;this._layoutTypeSelectionHandler=BX.delegate(this.onLayoutTypeSelection,this);this._callback=null;this._dlg=null};BX.CrmWidgetPanelLayoutTypeSelector.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"";this._settings=e?e:{};this._layoutType=this.getSetting("layoutType",BX.CrmWidgetLayout.l50r50);this._callback=this.getSetting("callback");if(!BX.type.isFunction(this._callback)){this._callback=null}},getId:function(){return this._id},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getMessage:function(t){var e=BX.CrmWidgetPanelLayoutTypeSelector.messages;return e.hasOwnProperty(t)?e[t]:t},openDialog:function(){if(this._dlg){return}var t=this._id;this._dlg=new BX.PopupWindow(t,null,{autoHide:false,draggable:true,bindOptions:{forceBindPosition:false},closeByEsc:false,closeIcon:{top:"10px",right:"15px"},zIndex:0,titleBar:this.getMessage("dialogTitle"),content:this.prepareDialogContent(),buttons:[new BX.PopupWindowButtonLink({text:this.getMessage("dialogCancelButton"),className:"popup-window-button-link-cancel",events:{click:BX.delegate(this.onDialogCancelButtonClick,this)}})],events:{onPopupShow:BX.delegate(this.onDialogShow,this),onPopupClose:BX.delegate(this.onDialogClose,this),onPopupDestroy:BX.delegate(this.onDialogDestroy,this)}});this._dlg.show()},closeDialog:function(){if(this._dlg){this._dlg.close()}},isDialogOpened:function(){return this._dlg&&this._dlg.isShown()},prepareDialogContent:function(){var t=BX.create("DIV",{attrs:{className:"view-report-wrapper-container"}});var e=BX.create("DIV",{attrs:{className:"view-report-wrapper view-report-wrapper-popup"}});t.appendChild(e);this._layoutTypeContainer=BX.create("DIV",{attrs:{className:"view-report-wrapper-inner"}});e.appendChild(this._layoutTypeContainer);this._layoutTypeItems=[];var i=BX.CrmWidgetLayout.getAll();for(var n=0;n<i.length;n++){var r=i[n];var s=BX.CrmWidgetPanelLayoutTypeItem.create(r,{layoutType:r,isActive:this._layoutType===r,container:this._layoutTypeContainer,configurator:this});this._layoutTypeItems.push(s);s.layout();s.addSelectionListener(this._layoutTypeSelectionHandler)}return t},onDialogShow:function(){},onDialogClose:function(){if(this._dlg){this._dlg.destroy()}},onDialogDestroy:function(){this._dlg=null},onDialogCancelButtonClick:function(){this.closeDialog()},onLayoutTypeSelection:function(t){if(!this._callback){return}this._layoutType=t.getLayoutType();this._callback(this,{action:"changeLayout",data:{layoutType:this._layoutType}})}};if(typeof BX.CrmWidgetPanelLayoutTypeSelector.messages==="undefined"){BX.CrmWidgetPanelLayoutTypeSelector.messages={}}BX.CrmWidgetPanelLayoutTypeSelector.create=function(t,e){var i=new BX.CrmWidgetPanelLayoutTypeSelector;i.initialize(t,e);return i}}if(typeof BX.CrmWidgetPanelLayoutTypeItem==="undefined"){BX.CrmWidgetPanelLayoutTypeItem=function(){this._id="";this._settings=null;this._layoutType=BX.CrmWidgetLayout.undifined;this._container=null;this._configurator=null;this._isActive=false;this._clickHandler=BX.delegate(this.onClick,this);this._selectionNotifier=null;this._hasLayout=false};BX.CrmWidgetPanelLayoutTypeItem.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"";this._settings=e?e:{};this._layoutType=this.getSetting("layoutType");if(this._layoutType===BX.CrmWidgetLayout.undifined){throw"CrmWidgetPanelLayoutTypeItem: The 'layoutType' parameter is not found."}this._container=this.getSetting("container");if(!this._container){throw"CrmWidgetPanelLayoutTypeItem: The 'container' parameter is not found."}this._configurator=this.getSetting("configurator");if(!this._configurator){throw"CrmWidgetPanelLayoutTypeItem: The 'configurator' parameter is not found."}this._isActive=this.getSetting("isActive",false);this._selectionNotifier=BX.CrmNotifier.create(this)},getId:function(){return this._id},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getLayoutType:function(){return this._layoutType},addSelectionListener:function(t){this._selectionNotifier.addListener(t)},removeSelectionListener:function(t){this._selectionNotifier.removeListener(t)},layout:function(){if(this._hasLayout){return}var t="crm-widget-template";if(this._isActive){t+=" crm-widget-template-active"}this._wrapper=BX.create("DIV",{attrs:{className:t}});this._container.appendChild(this._wrapper);var e=5;var i=5;if(this._layoutType===BX.CrmWidgetLayout.l30r70){e=3;i=7}else if(this._layoutType===BX.CrmWidgetLayout.l70r30){e=7;i=3}this._wrapper.appendChild(this.prepareTileLayout(e));this._wrapper.appendChild(this.prepareTileLayout(i));this._wrapper.appendChild(BX.create("BR"));this._wrapper.appendChild(this.prepareTileLayout(10));this._wrapper.appendChild(BX.create("BR"));this._wrapper.appendChild(this.prepareTileLayout(e));this._wrapper.appendChild(this.prepareTileLayout(i));BX.bind(this._wrapper,"click",this._clickHandler);this._hasLayout=true},prepareTileLayout:function(t){var e="crm-widget-template-item";if(t<10){e+=" template-item-"+t.toString()}return BX.create("DIV",{attrs:{className:e},text:(t*10).toString()+"%"})},cleanLayout:function(){if(!this._hasLayout){
return}BX.unbind(this._wrapper,"click",this._clickHandler);BX.cleanNode(this._wrapper,true);this._wrapper=null;this._hasLayout=false},onClick:function(t){this._selectionNotifier.notify();return BX.PreventDefault(t)}};BX.CrmWidgetPanelLayoutTypeItem.create=function(t,e){var i=new BX.CrmWidgetPanelLayoutTypeItem;i.initialize(t,e);return i}}if(typeof BX.CrmWidgetPanelConfiguratorTab==="undefined"){BX.CrmWidgetPanelConfiguratorTab=function(){this._id="";this._settings=null;this._title="";this._configurator=null;this._isEnabled=false;this._isActive=false;this._container=null;this._element=null;this._clickHandler=BX.delegate(this.onClick,this);this._selectionNotifier=null;this._hasLayout=false};BX.CrmWidgetPanelConfiguratorTab.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"";this._settings=e?e:{};this._title=this.getSetting("title");if(this._title===""){this._title=this._id}this._configurator=this.getSetting("configurator");if(!this._configurator){throw"CrmWidgetPanelConfiguratorTab: The 'configurator' parameter is not found."}this._container=this.getSetting("container");if(!this._container){throw"CrmWidgetPanelConfiguratorTab: The 'container' parameter is not found."}this._isActive=this.getSetting("isActive",false);this._isEnabled=this.getSetting("isEnabled",false);this._selectionNotifier=BX.CrmNotifier.create(this)},getId:function(){return this._id},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},addSelectionListener:function(t){this._selectionNotifier.addListener(t)},removeSelectionListener:function(t){this._selectionNotifier.removeListener(t)},layout:function(){if(this._hasLayout){return}this._element=BX.create("A",{attrs:{className:"sidebar-tab"},props:{href:"#"},text:this._title});this._container.appendChild(this._element);BX.bind(this._element,"click",this._clickHandler);var t=this.getSetting("className","");if(t!==""){BX.addClass(this._element,t)}if(!this._isEnabled){BX.addClass(this._element,"sidebar-tab-disabled")}if(this._isActive){BX.addClass(this._element,"sidebar-tab-active")}this._hasLayout=true},cleanLayout:function(){if(!this._hasLayout){return}BX.unbind(this._element,"click",this._clickHandler);BX.cleanNode(this._element,true);this._element=null;this._hasLayout=false},isActive:function(){return this._isActive},setActive:function(t){t=!!t;this._isActive=t;if(t){BX.addClass(this._element,"sidebar-tab-active")}else{BX.removeClass(this._element,"sidebar-tab-active")}},onClick:function(t){if(this._isEnabled){this._selectionNotifier.notify()}return BX.PreventDefault(t)}};BX.CrmWidgetPanelConfiguratorTab.create=function(t,e){var i=new BX.CrmWidgetPanelConfiguratorTab;i.initialize(t,e);return i}}if(typeof BX.CrmWidgetDataGroup==="undefined"){BX.CrmWidgetDataGroup=function(){this._settings={};this._entityTypeName=""};BX.CrmWidgetDataGroup.undefined="";BX.CrmWidgetDataGroup.date="DATE";BX.CrmWidgetDataGroup.user="USER";BX.CrmWidgetDataGroup.prototype={initialize:function(t){this._settings=t?t:{};this._entityTypeName=this.getSetting("entityTypeName","")},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getDefault:function(){return BX.CrmWidgetDataGroup.date},isCommonGrouping:function(t){return BX.CrmWidgetDataGroup.isCommonGrouping(t)},prepareListItems:function(t){t=!!t;var e=[];var i=BX.CrmWidgetDataGroup.descriptions;for(var n in i){if(!i.hasOwnProperty(n)){continue}if(n!==BX.CrmWidgetDataGroup.undefined||t){e.push({value:n,text:i[n]})}}if(this._entityTypeName!==""){var r=BX.CrmWidgetDataGroup.extras;for(var s=0,o=r.length;s<o;s++){var a=r[s];if(!BX.type.isNotEmptyString(a["name"])){continue}if(BX.type.isNotEmptyString(a["entity"])&&a["entity"]===this._entityTypeName){e.push({value:a["name"],text:BX.type.isNotEmptyString(a["title"])?a["title"]:a["name"],attrs:{category:"extra"}})}}}return e}};if(typeof BX.CrmWidgetDataGroup.descriptions==="undefined"){BX.CrmWidgetDataGroup.descriptions={}}if(typeof BX.CrmWidgetDataGroup.extras==="undefined"){BX.CrmWidgetDataGroup.extras={}}BX.CrmWidgetDataGroup.isCommonGrouping=function(t){return t===this.date||t===this.user};BX.CrmWidgetDataGroup.create=function(t){var e=new BX.CrmWidgetDataGroup;e.initialize(t);return e}}if(typeof BX.CrmWidgetFactory==="undefined"){BX.CrmWidgetFactory=function(){this._id=""};BX.CrmWidgetFactory.prototype={initialize:function(t){this._id=BX.type.isNotEmptyString(t)?t:""},getId:function(){return this._id},createConfigEditor:function(t,e,i){if(t==="pie"){return BX.CrmPieWidgetConfigEditor.create(e,i)}else if(t==="graph"||t==="bar"){return BX.CrmGraphWidgetConfigEditor.create(e,i)}else if(t==="number"){return BX.CrmNumericWidgetConfigEditor.create(e,i)}else if(t==="rating"){return BX.CrmRatingWidgetConfigEditor.create(e,i)}return BX.CrmWidgetConfigEditor.create(e,i)},createPresetEditor:function(t,e,i){return BX.CrmWidgetConfigPresetEditor.create(e,i)}};BX.CrmWidgetFactory.create=function(t){var e=new BX.CrmWidgetFactory;e.initialize(t);return e}}if(typeof BX.CrmDealWidgetFactory==="undefined"){BX.CrmDealWidgetFactory=function(){this._id="";this._settings=null;this._basic=null};BX.CrmDealWidgetFactory.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"";this._settings=e?e:{};this._basic=BX.CrmWidgetFactory.create(this._id)},getId:function(){return this._id},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getMessage:function(t){var e=BX.CrmDealWidgetFactory.messages;return e.hasOwnProperty(t)?e[t]:t},getCurrentCategoryId:function(){return parseInt(BX.CrmWidgetManager.getCurrent().getContextParam("dealCategoryID",-1))},createConfigEditor:function(t,e,i){if(t==="funnel"){var n=BX.CrmDealCategory.getDefaultValue();var r=BX.CrmDealCategory.getListItems();if(this.getCurrentCategoryId()>=0){r.unshift({value:"?",text:this.getMessage("current")});n="?"}i["extraEditors"]=[BX.CrmWidgetConfigSelectListEditor.create("dealCategorySelector",{configParamName:"dealCategoryID",configParamCaption:this.getMessage("categoryConfigParamCaption"),defaultValue:n,listItems:r})];return BX.CrmWidgetConfigEditor.create(e,i)}return this._basic.createConfigEditor(t,e,i)},createPresetEditor:function(t,e,i){var n=BX.CrmDealCategory.getListItems();if(this.getCurrentCategoryId()>=0){n.unshift({value:"?",text:this.getMessage("current")})}n.unshift({value:"",text:this.getMessage("notSelected")});i["extraEditors"]=[BX.CrmWidgetConfigSelectListEditor.create("dealCategorySelector",{configParamName:"dealCategoryID",configParamCaption:this.getMessage("categoryConfigParamCaption"),defaultValue:"",listItems:n})];return BX.CrmWidgetConfigPresetEditor.create(e,i)}};if(typeof BX.CrmDealWidgetFactory.messages==="undefined"){BX.CrmDealWidgetFactory.messages={}}BX.CrmDealWidgetFactory.create=function(t,e){var i=new BX.CrmDealWidgetFactory;i.initialize(t,e);return i}}
/* End */
;
; /* Start:"a:4:{s:4:"full";s:92:"/bitrix/components/bitrix/crm.interface.toolbar/templates/title/script.min.js?15113164782303";s:6:"source";s:73:"/bitrix/components/bitrix/crm.interface.toolbar/templates/title/script.js";s:3:"min";s:77:"/bitrix/components/bitrix/crm.interface.toolbar/templates/title/script.min.js";s:3:"map";s:77:"/bitrix/components/bitrix/crm.interface.toolbar/templates/title/script.map.js";}"*/
if(typeof BX.InterfaceToolBar==="undefined"){BX.InterfaceToolBar=function(){this._id="";this._settings=null;this._container=null;this._menuButton=null;this._menuPopup=null;this._isMenuOpened=false};BX.InterfaceToolBar.prototype={initialize:function(e,t){this._id=e;this._settings=t?t:BX.CrmParamBag.create(null);var n=this._container=BX(this.getSetting("containerId",""));if(n){var i=this.getSetting("menuButtonClassName");if(!BX.type.isNotEmptyString(i)){i=this.getSetting("moreButtonClassName","crm-setting-btn")}if(BX.type.isNotEmptyString(i)){var o=this._menuButton=BX.findChild(n,{className:i},true,false);if(o){BX.bind(o,"click",BX.delegate(this.onMenuButtonClick,this))}}}},getId:function(){return this._id},getSetting:function(e,t){return this._settings.getParam(e,t)},openMenu:function(e){if(this._isMenuOpened){this.closeMenu();return}var t=this.getSetting("items",null);if(!BX.type.isArray(t)){return}var n=/return\s+false(\s*;)?\s*$/;var i=/;\s*$/;var o=[];for(var u=0;u<t.length;u++){var s=t[u];var p=typeof s["SEPARATOR"]!=="undefined"?s["SEPARATOR"]:false;if(p){o.push({SEPARATOR:true});continue}var r=typeof s["LINK"]!=="undefined"?s["LINK"]:"";var a=typeof s["ONCLICK"]!=="undefined"?s["ONCLICK"]:"";if(r!==""){var f='window.location.href = "'+r+'";';a=a!==""?f+" "+a:f}if(a!==""){if(!n.test(a)){if(!i.test(a)){a+=";"}a+=" return false;"}}o.push({text:typeof s["TEXT"]!=="undefined"?s["TEXT"]:"",onclick:a})}this._menuId=this._id.toLowerCase()+"_menu";BX.PopupMenu.show(this._menuId,this._menuButton,o,{offsetTop:0,offsetLeft:0,events:{onPopupShow:BX.delegate(this.onPopupShow,this),onPopupClose:BX.delegate(this.onPopupClose,this),onPopupDestroy:BX.delegate(this.onPopupDestroy,this)}});this._menuPopup=BX.PopupMenu.currentItem},closeMenu:function(){if(this._menuPopup){if(this._menuPopup.popupWindow){this._menuPopup.popupWindow.destroy()}}},onMenuButtonClick:function(e){this.openMenu()},onPopupShow:function(){this._isMenuOpened=true},onPopupClose:function(){this.closeMenu()},onPopupDestroy:function(){this._isMenuOpened=false;this._menuPopup=null;if(typeof BX.PopupMenu.Data[this._menuId]!=="undefined"){delete BX.PopupMenu.Data[this._menuId]}}};BX.InterfaceToolBar.create=function(e,t){var n=new BX.InterfaceToolBar;n.initialize(e,t);return n}}
/* End */
;
; /* Start:"a:4:{s:4:"full";s:91:"/bitrix/components/bitrix/crm.interface.filter/templates/title/script.min.js?15113164782949";s:6:"source";s:72:"/bitrix/components/bitrix/crm.interface.filter/templates/title/script.js";s:3:"min";s:76:"/bitrix/components/bitrix/crm.interface.filter/templates/title/script.min.js";s:3:"map";s:76:"/bitrix/components/bitrix/crm.interface.filter/templates/title/script.map.js";}"*/
if(typeof BX.InterfaceGridFilterNavigationBar==="undefined"){BX.InterfaceGridFilterNavigationBar=function(){this._id="";this._settings=null;this._binding=null;this._items=null;this._activeItem=null};BX.InterfaceGridFilterNavigationBar.prototype={initialize:function(t,i){this._id=t;this._settings=i?i:BX.CrmParamBag.create(null);this._binding=this.getSetting("binding",null);this._items=[];var e=this.getSetting("items",[]);for(var n=0;n<e.length;n++){var r=e[n];var a=BX.type.isNotEmptyString(r["id"])?r["id"]:n;r["parent"]=this;var s=BX.InterfaceGridFilterNavigationBarItem.create(a,BX.CrmParamBag.create(r));if(this._activeItem===null&&s.isActive()){this._activeItem=s}this._items.push(s)}},getId:function(){return this._id},getSetting:function(t,i){return this._settings.getParam(t,i)},getBinding:function(){return this._binding},processMenuItemClick:function(t){if(!t.isActive()){t.openUrl()}}};BX.InterfaceGridFilterNavigationBar.create=function(t,i){var e=new BX.InterfaceGridFilterNavigationBar;e.initialize(t,i);return e}}if(typeof BX.InterfaceGridFilterNavigationBarItem==="undefined"){BX.InterfaceGridFilterNavigationBarItem=function(){this._id="";this._settings=null;this._parent=null;this._element=null;this._name="";this._isActive=false;this._elementClickHandler=BX.delegate(this.onElementClick,this)};BX.InterfaceGridFilterNavigationBarItem.prototype={initialize:function(t,i){this._id=t;this._settings=i?i:BX.CrmParamBag.create(null);this._name=this.getSetting("name","");this._parent=this.getSetting("parent");if(!this._parent){throw"InterfaceGridFilterNavigationBarItem: The parameter 'parent' is not found."}this._element=BX(this.getSetting("elementId"));if(!BX.type.isElementNode(this._element)){throw"InterfaceGridFilterNavigationBarItem: The parameter 'element' is not found."}BX.bind(this._element,"click",this._elementClickHandler);this._isActive=this.getSetting("active",false)},getId:function(){return this._id},getSetting:function(t,i){return this._settings.getParam(t,i)},getName:function(){return this._name},getElement:function(){return this._element},isActive:function(){return this._isActive},openUrl:function(){var t=this.getSetting("url","");if(t===""){return}var i=this._parent.getBinding();if(i){var e=BX.type.isNotEmptyString(i["category"])?i["category"]:"";var n=BX.type.isNotEmptyString(i["name"])?i["name"]:"";var r=BX.type.isNotEmptyString(i["key"])?i["key"]:"";if(e!==""&&n!==""&&r!==""){var a=new Date;var s=a.getFullYear().toString();var l=a.getMonth()+1;l=l>=10?l.toString():"0"+l.toString();var g=a.getDate();g=g>=10?g.toString():"0"+g.toString();var o=this._id+":"+s+l+g;BX.userOptions.save(e,n,r,o,false)}}setTimeout(function(){window.location.href=t},150)},onElementClick:function(t){this._parent.processMenuItemClick(this)}};BX.InterfaceGridFilterNavigationBarItem.create=function(t,i){var e=new BX.InterfaceGridFilterNavigationBarItem;e.initialize(t,i);return e}}
/* End */
;
; /* Start:"a:4:{s:4:"full";s:100:"/bitrix/components/bitrix/intranet.user.selector.new/templates/.default/users.min.js?151131652313983";s:6:"source";s:80:"/bitrix/components/bitrix/intranet.user.selector.new/templates/.default/users.js";s:3:"min";s:84:"/bitrix/components/bitrix/intranet.user.selector.new/templates/.default/users.min.js";s:3:"map";s:84:"/bitrix/components/bitrix/intranet.user.selector.new/templates/.default/users.map.js";}"*/
(function(){if(window.IntranetUsers)return;window.IntranetUsers=function(e,t,a){this.name=e;this.multiple=t;this.arSelected=[];this.arFixed=[];this.bSubordinateOnly=a;this.ajaxUrl="";this.lastSearchTime=0};IntranetUsers.arStructure={};IntranetUsers.bSectionsOnly=false;IntranetUsers.arEmployees={group:{}};IntranetUsers.arEmployeesData={};IntranetUsers.ajaxUrl="";IntranetUsers.prototype.loadGroup=function(e){var t=BX(this.name+"_group_section_"+e);function a(t){IntranetUsers.arEmployees["group"][e]=t;this.show(e,t,"g")}e=parseInt(e);if(IntranetUsers.arEmployees["group"][e]!=null){this.show(e,IntranetUsers.arEmployees["group"][e],"g")}else{var s=this.getAjaxUrl()+"&MODE=EMPLOYEES&GROUP_ID="+e;BX.ajax.loadJSON(s,BX.proxy(a,this))}BX.toggleClass(t,"company-department-opened");BX.toggleClass(BX(this.name+"_gchildren_"+e),"company-department-children-opened")};IntranetUsers.prototype.load=function(e,t,a,s){this.bSectionsOnly=s;function n(t){IntranetUsers.arStructure[e]=t.STRUCTURE;IntranetUsers.arEmployees[e]=t.USERS;this.show(e,false,"",this.bSectionsOnly)}if(null==t)t=false;if(null==a)a=false;if(null==s)s=false;if(e!="extranet")e=parseInt(e);var r=BX(this.name+"_employee_section_"+e);if(!r.BX_LOADED){if(IntranetUsers.arEmployees[e]!=null){this.show(e,false,"",this.bSectionsOnly)}else{var i=this.getAjaxUrl()+"&MODE=EMPLOYEES&SECTION_ID="+e;BX.ajax.loadJSON(i,BX.proxy(n,this))}}if(a){BX(this.name+"_employee_search_layout").scrollTop=r.offsetTop-40}BX.toggleClass(r,"company-department-opened");BX.toggleClass(BX(this.name+"_children_"+e),"company-department-children-opened")};IntranetUsers.prototype.show=function(e,t,a,s){s=!!s;a=a||"";var n=BX(this.name+"_"+a+"employee_section_"+e);var r=t||IntranetUsers.arEmployees[e];if(n!==null){n.BX_LOADED=true}var i=BX(this.name+"_"+a+"employees_"+e);if(i){if(IntranetUsers.arStructure[e]!=null&&!a){var l=IntranetUsers.arStructure[e];var o=BX(this.name+"_"+a+"children_"+e);if(o){for(var c=0;c<l.length;c++){obSectionRow1=BX.create("div",{props:{className:"company-department"},children:[s?BX.create("span",{props:{className:"company-department-inner",id:this.name+"_employee_section_"+l[c].ID},children:[BX.create("div",{props:{className:"company-department-arrow"},attrs:{onclick:"O_"+this.name+".load("+l[c].ID+", false, false, true)"}}),BX.create("div",{props:{className:"company-department-text"},attrs:{"data-section-id":l[c].ID,onclick:"O_"+this.name+".selectSection("+this.name+"_employee_section_"+l[c].ID+")"},text:l[c].NAME})]}):BX.create("span",{props:{className:"company-department-inner",id:this.name+"_employee_section_"+l[c].ID},attrs:{onclick:"O_"+this.name+".load("+l[c].ID+")"},children:[BX.create("div",{props:{className:"company-department-arrow"}}),BX.create("div",{props:{className:"company-department-text"},text:l[c].NAME})]})]});obSectionRow2=BX.create("div",{props:{className:"company-department-children",id:this.name+"_children_"+l[c].ID},children:[BX.create("div",{props:{className:"company-department-employees",id:this.name+"_employees_"+l[c].ID},children:[BX.create("span",{props:{className:"company-department-employees-loading"},text:BX.message("INTRANET_EMP_WAIT")})]})]});o.appendChild(obSectionRow1);o.appendChild(obSectionRow2)}o.appendChild(i)}}i.innerHTML="";for(var c=0;c<r.length;c++){var d;var p=false;IntranetUsers.arEmployeesData[r[c].ID]={id:r[c].ID,name:r[c].NAME,sub:r[c].SUBORDINATE=="Y"?true:false,sup:r[c].SUPERORDINATE=="Y"?true:false,position:r[c].WORK_POSITION,photo:r[c].PHOTO};var m=BX.create("input",{props:{className:"intranet-hidden-input"}});if(this.multiple){m.name=this.name+"[]";m.type="checkbox"}else{m.name=this.name;m.type="radio"}var h=document.getElementsByName(m.name);var u=0;while(!p&&u<h.length){if(h[u].value==r[c].ID&&h[u].checked){p=true}u++}m.value=r[c].ID;d=BX.create("div",{props:{className:"company-department-employee"+(p?" company-department-employee-selected":"")},events:{click:BX.proxy(this.select,this)},children:[m,BX.create("div",{props:{className:"company-department-employee-avatar"},style:{background:r[c].PHOTO?"url('"+r[c].PHOTO+"') no-repeat center center":"",backgroundSize:r[c].PHOTO?"cover":""}}),BX.create("div",{props:{className:"company-department-employee-icon"}}),BX.create("div",{props:{className:"company-department-employee-info"},children:[BX.create("div",{props:{className:"company-department-employee-name"},text:r[c].NAME}),BX.create("div",{props:{className:"company-department-employee-position"},html:!r[c].HEAD&&!r[c].WORK_POSITION?"&nbsp;":BX.util.htmlspecialchars(r[c].WORK_POSITION)+(r[c].HEAD&&r[c].WORK_POSITION?", ":"")+(r[c].HEAD?BX.message("INTRANET_EMP_HEAD"):"")})]})]});i.appendChild(d)}}};IntranetUsers.prototype.select=function(e){var t;var a=0;var s=e.target||e.srcElement;if(e.currentTarget){t=e.currentTarget}else{t=s;while(!BX.hasClass(t,"finder-box-item")&&!BX.hasClass(t,"company-department-employee")){t=t.parentNode}}var n=BX.findChild(t,{tag:"input"});if(!this.multiple){var r=document.getElementsByName(this.name);for(var a=0;a<r.length;a++){if(r[a].value!=n.value){BX.removeClass(r[a].parentNode,BX.hasClass(r[a].parentNode,"finder-box-item")?"finder-box-item-selected":"company-department-employee-selected")}else{BX.addClass(r[a].parentNode,BX.hasClass(r[a].parentNode,"finder-box-item")?"finder-box-item-selected":"company-department-employee-selected")}}n.checked=true;BX.addClass(t,BX.hasClass(t,"finder-box-item")?"finder-box-item-selected":"company-department-employee-selected");this.searchInput.value=IntranetUsers.arEmployeesData[n.value].name;this.arSelected=[];this.arSelected[n.value]={id:n.value,name:IntranetUsers.arEmployeesData[n.value].name,sub:IntranetUsers.arEmployeesData[n.value].sub,sup:IntranetUsers.arEmployeesData[n.value].sup,position:IntranetUsers.arEmployeesData[n.value].position,photo:IntranetUsers.arEmployeesData[n.value].photo}}else{var r=document.getElementsByName(this.name+"[]");if(!BX.util.in_array(n,r)&&!BX.util.in_array(n.value,this.arFixed)){n.checked=false;BX.toggleClass(n.parentNode,BX.hasClass(n.parentNode,"finder-box-item")?"finder-box-item-selected":"company-department-employee-selected")}for(var a=0;a<r.length;a++){if(r[a].value==n.value&&!BX.util.in_array(n.value,this.arFixed)){r[a].checked=false;BX.toggleClass(r[a].parentNode,BX.hasClass(r[a].parentNode,"finder-box-item")?"finder-box-item-selected":"company-department-employee-selected")}}if(BX.hasClass(n.parentNode,"finder-box-item-selected")||BX.hasClass(n.parentNode,"company-department-employee-selected")){n.checked=true}if(n.checked){var i=BX.findChild(BX(this.name+"_selected_users"),{className:"finder-box-selected-items"});if(!BX(this.name+"_employee_selected_"+n.value)){var l=BX.create("DIV");l.id=this.name+"_employee_selected_"+n.value;l.className="finder-box-selected-item";var o=BX.findChild(t,{tag:"DIV",className:"finder-box-item-text"},true)||BX.findChild(t,{tag:"DIV",className:"company-department-employee-name"},true);l.innerHTML='<div class="finder-box-selected-item-icon" id="'+this.name+"-user-selector-unselect-"+n.value+'" onclick="O_'+this.name+".unselect("+n.value+', this);"></div><span class="finder-box-selected-item-text">'+o.innerHTML+"</span>";i.appendChild(l);var c=BX(this.name+"_current_count");c.innerHTML=parseInt(c.innerHTML)+1;this.arSelected[n.value]={id:n.value,name:IntranetUsers.arEmployeesData[n.value].name,sub:IntranetUsers.arEmployeesData[n.value].sub,sup:IntranetUsers.arEmployeesData[n.value].sup,position:IntranetUsers.arEmployeesData[n.value].position,photo:IntranetUsers.arEmployeesData[n.value].photo}}}else{BX.remove(BX(this.name+"_employee_selected_"+n.value));var c=BX(this.name+"_current_count");c.innerHTML=parseInt(c.innerHTML)-1;this.arSelected[n.value]=null}}var d=BX.util.array_search(n.value,IntranetUsers.lastUsers);if(d>=0)IntranetUsers.lastUsers.splice(d,1);IntranetUsers.lastUsers.unshift(n.value);BX.userOptions.save("intranet","user_search","last_selected",IntranetUsers.lastUsers.slice(0,10));if(this.onSelect){var p=this.arSelected.pop();this.arSelected.push(p);this.onSelect(p)}BX.onCustomEvent(this,"on-change",[this.toObject(this.arSelected)]);if(this.onChange){this.onChange(this.arSelected)}};IntranetUsers.prototype.toObject=function(e){var t={};for(var a in e){a=parseInt(a);if(typeof a=="number"&&e[a]!==null){t[a]=BX.clone(e[a])}}return t};IntranetUsers.prototype.selectSection=function(e){var t=BX(e);if(!t){return false}else{var a=BX.findChild(t,{tag:"div",className:"company-department-text"});if(a){if(this.onSectionSelect){this.onSectionSelect({id:a.getAttribute("data-section-id"),name:a.innerHTML})}}}};IntranetUsers.prototype.unselect=function(e){var t=BX(this.name+"-user-selector-unselect-"+e);var a=document.getElementsByName(this.name+(this.multiple?"[]":""));for(var s=0;s<a.length;s++){if(a[s].value==e){a[s].checked=false;BX.removeClass(a[s].parentNode,BX.hasClass(a[s].parentNode,"finder-box-item")?"finder-box-item-selected":"company-department-employee-selected")}}if(this.multiple){if(t){BX.remove(t.parentNode)}var n=BX(this.name+"_current_count");n.innerHTML=parseInt(n.innerHTML)-1}this.arSelected[e]=null;BX.onCustomEvent(this,"on-change",[this.toObject(this.arSelected)]);if(this.onChange){this.onChange(this.arSelected)}};IntranetUsers.prototype.getSelected=function(){return this.arSelected};IntranetUsers.prototype.setSelected=function(e){for(var t=0,a=this.arSelected.length;t<a;t++){if(this.arSelected[t]&&this.arSelected[t].id)this.unselect(this.arSelected[t].id)}if(!this.multiple){e=[e[0]]}this.arSelected=[];for(var t=0,a=e.length;t<a;t++){this.arSelected[e[t].id]=e[t];var s=BX.create("input",{props:{className:"intranet-hidden-input",value:e[t].id,checked:"checked",name:this.name+(this.multiple?"[]":"")}});BX(this.name+"_last").appendChild(s);if(this.multiple){var n=BX.findChild(BX(this.name+"_selected_users"),{className:"finder-box-selected-items"});var r=BX.create("div",{props:{className:"finder-box-selected-item",id:this.name+"_employee_selected_"+e[t].id},html:'<div class="finder-box-selected-item-icon" id="'+this.name+"-user-selector-unselect-"+e[t].id+'" onclick="O_'+this.name+".unselect("+e[t].id+', this);"></div><span class="finder-box-selected-item-text">'+BX.util.htmlspecialchars(e[t].name)+"</span>"});n.appendChild(r)}var i=document.getElementsByName(this.name+(this.multiple?"[]":""));for(var l=0;l<i.length;l++){if(i[l].value==e[t].id){BX.toggleClass(i[l].parentNode,BX.hasClass(i[l].parentNode,"finder-box-item")?"finder-box-item-selected":"company-department-employee-selected")}}}if(this.multiple){BX.adjust(BX(this.name+"_current_count"),{text:e.length})}};IntranetUsers.prototype.setFixed=function(e){if(typeof e!="object")e=[];this.arFixed=e;var t=BX.findChildren(BX(this.name+"_selected_users"),{className:"finder-box-selected-item-icon"},true);for(i=0;i<t.length;i++){var a=t[i].id.replace(this.name+"-user-selector-unselect-","");BX.adjust(t[i],{style:{visibility:BX.util.in_array(a,this.arFixed)?"hidden":"visible"}})}};IntranetUsers.prototype.search=function(e){this.searchRqstTmt=clearTimeout(this.searchRqstTmt);if(typeof this.searchRqst=="object"){this.searchRqst.abort();this.searchRqst=false}if(!e)e=window.event;if(this.searchInput.value.length>0){this.displayTab("search");var t=this.getAjaxUrl()+"&MODE=SEARCH&SEARCH_STRING="+encodeURIComponent(this.searchInput.value);if(this.bSubordinateOnly)t+="&S_ONLY=Y";var a=this;this.searchRqstTmt=setTimeout(function(){var e=(new Date).getTime();a.lastSearchTime=e;a.searchRqst=BX.ajax.loadJSON(t,BX.proxy(function(t){if(a.lastSearchTime==e)a.showResults(t)},a))},400)}};IntranetUsers.prototype.showResults=function(e){var t=e;var a=BX(this.name+"_search");var s=a.getElementsByTagName("input");for(var n=0,r=s.length;n<r;n++){if(s[n].checked){BX(this.name+"_last").appendChild(s[n])}}if(a){a.innerHTML="";var i=BX.create("table",{props:{className:"finder-box-tab-columns",cellspacing:"0"},children:[BX.create("tbody")]});var l=BX.create("tr");i.firstChild.appendChild(l);var o=BX.create("td");l.appendChild(o);a.appendChild(i);for(var n=0;n<t.length;n++){var c;var d=false;IntranetUsers.arEmployeesData[t[n].ID]={id:t[n].ID,name:t[n].NAME,sub:t[n].SUBORDINATE=="Y"?true:false,sup:t[n].SUPERORDINATE=="Y"?true:false,position:t[n].WORK_POSITION,photo:t[n].PHOTO};var p=BX.create("input",{props:{className:"intranet-hidden-input"}});if(this.multiple){p.name=this.name+"[]";p.type="checkbox"}else{p.name=this.name;p.type="radio"}var s=document.getElementsByName(p.name);var m=0;while(!d&&m<s.length){if(s[m].value==t[n].ID&&s[m].checked){d=true}m++}p.value=t[n].ID;var h=t[n].NAME;var u="finded_anchor_user_id_"+t[n].ID;c=BX.create("div",{props:{className:"finder-box-item"+(d?" finder-box-item-selected":""),id:u},events:{click:BX.proxy(this.select,this)},children:[p,BX.create("div",{props:{className:"finder-box-item-text"},text:h}),BX.create("div",{props:{className:"finder-box-item-icon"}})]});o.appendChild(c);if(n==Math.ceil(t.length/2)-1){o=BX.create("td");i.firstChild.appendChild(o)}BX.tooltip(t[n].ID,u,"")}}};IntranetUsers.prototype.displayTab=function(e){BX.removeClass(BX(this.name+"_last"),"finder-box-tab-content-selected");BX.removeClass(BX(this.name+"_search"),"finder-box-tab-content-selected");BX.removeClass(BX(this.name+"_structure"),"finder-box-tab-content-selected");BX.removeClass(BX(this.name+"_groups"),"finder-box-tab-content-selected");BX.addClass(BX(this.name+"_"+e),"finder-box-tab-content-selected");BX.removeClass(BX(this.name+"_tab_last"),"finder-box-tab-selected");BX.removeClass(BX(this.name+"_tab_search"),"finder-box-tab-selected");BX.removeClass(BX(this.name+"_tab_structure"),"finder-box-tab-selected");BX.removeClass(BX(this.name+"_tab_groups"),"finder-box-tab-selected");BX.addClass(BX(this.name+"_tab_"+e),"finder-box-tab-selected")};IntranetUsers.prototype._onFocus=function(){this.searchInput.value=""};IntranetUsers.prototype.getAjaxUrl=function(){return this.ajaxUrl||IntranetUsers.ajaxUrl}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:89:"/bitrix/components/bitrix/main.ui.filter/templates/.default/script.min.js?151131647240526";s:6:"source";s:69:"/bitrix/components/bitrix/main.ui.filter/templates/.default/script.js";s:3:"min";s:73:"/bitrix/components/bitrix/main.ui.filter/templates/.default/script.min.js";s:3:"map";s:73:"/bitrix/components/bitrix/main.ui.filter/templates/.default/script.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Main");BX.Main.Filter=function(t,e,s,i,r){this.params=null;this.search=null;this.popup=null;this.presets=null;this.fields=null;this.types=null;this.dateTypes=null;this.settings=null;this.filter=null;this.api=null;this.isAddPresetModeState=false;this.init(t,e,s,i,r)};BX.Main.Filter.prototype={init:function(t,e,s,i,r){try{this.params=t;this.types=s;this.dateTypes=i;this.numberTypes=r;this.settings=new BX.Filter.Settings(e,this);BX.bind(document,"mousedown",BX.delegate(this._onDocumentClick,this));if(this.getParam("GRID_ID")){BX.addCustomEvent("Grid::ready",BX.delegate(this._onGridReady,this))}}catch(a){throw a}BX.bind(document,"keydown",BX.delegate(this._onDocumentKeydown,this));this.getSearch().updatePreset(this.getParam("CURRENT_PRESET"));if(this.getParam("CLEAR_GET")){this.clearGet()}BX.bind(window,"load",BX.delegate(function(){this.settings.get("AUTOFOCUS")&&this.adjustFocus()},this));this.firstInit=true},clearGet:function(){if("history"in window){var t=window.location.toString();var e=BX.util.remove_url_param(t,"apply_filter");window.history.replaceState(null,"",e)}},adjustFocus:function(){this.getSearch().adjustFocus()},_onAddPresetKeydown:function(t){if(BX.Filter.Utils.isKey(t,"enter")){this._onSaveButtonClick()}},_onDocumentKeydown:function(t){if(BX.Filter.Utils.isKey(t,"escape")){if(this.getPopup().isShown()){BX.onCustomEvent(window,"BX.Main.Filter:blur",[this]);this.closePopup();if(this.getParam("VALUE_REQUIRED_MODE")){this.restoreRemovedPreset()}}}},getApi:function(){if(!(this.api instanceof BX.Filter.Api)){this.api=new BX.Filter.Api(this)}return this.api},addSidebarItem:function(t,e,s){var i=this.getPreset();var r=i.getContainer();var a=i.createSidebarItem(t,e,s);var n=i.getPresetNodeById(t);if(BX.type.isDomNode(n)){BX.remove(n);BX.prepend(a,r)}else{r&&r.insertBefore(a,i.getAddPresetField())}BX.bind(a,"click",BX.delegate(i._onPresetClick,i))},saveUserSettings:function(t){var e={FILTER_ID:this.getParam("FILTER_ID"),GRID_ID:this.getParam("GRID_ID"),action:"SET_FILTER_ARRAY"};var s=this.getPreset();var i=s.getCurrentPresetId();var r={};this.params["PRESETS"]=BX.clone(this.editablePresets);r.current_preset=i;s.getPresets().forEach(function(t,e){var i=s.getPresetId(t);if(i&&i!=="tmp_filter"){var a=s.getPreset(i);var n=a.FIELDS.map(function(t){return t.NAME});a.TITLE=BX.util.htmlspecialchars(BX.util.htmlspecialcharsback(a.TITLE));a.SORT=e;s.updatePresetName(t,a.TITLE);r[i]={sort:e,name:a.TITLE,fields:this.preparePresetSettingsFields(a.FIELDS,n)}}},this);this.saveOptions(r,e,null,t)},isForAll:function(){var t=this.getForAllCheckbox();return t&&t.checked},getForAllCheckbox:function(){if(!this.forAllCheckbox){this.forAllCheckbox=BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classForAllCheckbox)}return this.forAllCheckbox},preparePresetSettingsFields:function(t){var e={};var s;(t||[]).forEach(function(t){switch(t.TYPE){case this.types.STRING:{e[t.NAME]=t.VALUE;break}case this.types.SELECT:{e[t.NAME]="VALUE"in t.VALUE?t.VALUE.VALUE:"";break}case this.types.MULTI_SELECT:{if(BX.type.isArray(t.VALUE)&&t.VALUE.length){t.VALUE.forEach(function(s,i){e[t.NAME]=BX.type.isPlainObject(e[t.NAME])?e[t.NAME]:{};e[t.NAME][i]=s.VALUE},this)}break}case this.types.CHECKBOX:{if(BX.type.isArray(t.VALUE)&&t.VALUE.length){t.VALUE.forEach(function(s,i){e[t.NAME]=BX.type.isPlainObject(e[t.NAME])?e[t.NAME]:{};e[t.NAME][i]=s.VALUE},this)}break}case this.types.DATE:{if(BX.type.isPlainObject(t.VALUES)){s=Object.keys(t.VALUES);e[t.NAME+"_datesel"]=t.SUB_TYPE.VALUE;s.forEach(function(s){e[t.NAME+s]=t.VALUES[s]},this)}break}case this.types.NUMBER:{if(BX.type.isPlainObject(t.VALUES)){s=Object.keys(t.VALUES);e[t.NAME+"_numsel"]=t.SUB_TYPE.VALUE;s.forEach(function(s){e[t.NAME+s]=t.VALUES[s]},this)}break}case this.types.CUSTOM_ENTITY:{if(BX.type.isPlainObject(t.VALUES)){e[t.NAME]=t.VALUES._value;e[t.NAME+"_label"]=t.VALUES._label}break}default:{break}}},this);return e},savePreset:function(){var t="filter_"+ +new Date;var e=BX.util.htmlspecialcharsback(this.getPreset().getAddPresetFieldInput().value);this.updatePreset(t,e,null,true);this.addSidebarItem(t,e);this.getPreset().applyPreset(t);this.getPreset().activatePreset(t);this.applyFilter()},updatePreset:function(t,e,s,i,r,a){var n=this.getFilterFieldsValues();var l=this.getPreset().getFields().map(function(t){return BX.data(t,"name")});var o=this.getPreset().getCurrentPresetData();var h={FILTER_ID:this.getParam("FILTER_ID"),GRID_ID:this.getParam("GRID_ID"),action:"SET_FILTER"};var d,u,c,f,g;var p={};d=Object.keys(n);if(!s){p.apply_filter="Y"}else{p.clear_filter="Y"}p.save="Y";p.fields=n;p.rows=l.join(",");p.preset_id=t||o.ID;if(BX.type.isNotEmptyString(e)){p.name=BX.util.htmlspecialchars(e)}else{c=this.getPreset().getPresetNodeById(p.preset_id);f=this.getPreset().getPresetInput(c);if(BX.type.isDomNode(f)&&BX.type.isNotEmptyString(f.value)){p.name=f.value}else{p.name=o.TITLE}}if((!("sort"in p)||!BX.type.isNumber(p.sort))&&i){g=this.getParam("PRESETS");p.sort=g.length+2}if(!s){d.forEach(function(t){if(BX.type.isArray(p.fields[t])){u=p.fields[t].length?{}:"";p.fields[t].forEach(function(t,e){u[e]=t},this);if(u||BX.type.isNumber(u)||BX.type.isBoolean(u)){p.fields[t]=u}}},this)}if(p.preset_id==="tmp_filter"||this.isAddPresetEnabled()||s){this.updateParams(p)}if(BX.type.isFunction(r)){r()}var B=new BX.Promise(null,this);B.setAutoResolve("fulfill",0);B.then(function(){var t=new BX.Promise(null,this);this.saveOptions(p,h,BX.proxy(t.fulfill,t));return t}).then(function(){!!a&&a()});return B},saveFieldsSort:function(){var t={FILTER_ID:this.getParam("FILTER_ID"),GRID_ID:this.getParam("GRID_ID"),action:"SET_FILTER"};var e=this.getPreset().getFields();var s={};s.preset_id="default_filter";if(BX.type.isArray(e)){s.rows=e.map(function(t){return BX.data(t,"name")});s.rows=s.rows.join(",")}this.updateParams(s);this.saveOptions(s,t)},updateParams:function(t){var e,s;var i=[];if(BX.type.isPlainObject(t)&&"preset_id"in t){e=this.getPreset().getPreset(t.preset_id);if(BX.type.isPlainObject(e)){if("name"in t&&BX.type.isNotEmptyString(t.name)){e.TITLE=t.name}if("rows"in t&&!("fields"in t)){t.fields={};t.rows.split(",").forEach(function(e){t.fields[e]=""})}if("fields"in t){e.FIELDS=this.preparePresetFields(t.fields,t.rows)}}else{s=this.getParam("PRESETS");e={ID:t.preset_id,TITLE:t.name,SORT:s.length+2,FIELDS:this.preparePresetFields(t.fields,t.rows)};s.push(e)}}},preparePresetFields:function(t,e){var s,i;var r=[];if(BX.type.isPlainObject(t)){e=BX.type.isNotEmptyString(e)?e.split(","):[];s=e.length?e:Object.keys(t);s.forEach(function(e){e=e.replace("_datesel","").replace("_numsel","");i=BX.clone(this.getFieldByName(e));if(BX.type.isPlainObject(i)){if(i.TYPE===this.types.STRING){i.VALUE=t[e]}if(i.TYPE===this.types.MULTI_SELECT){i.VALUE=this.prepareMultiSelectValue(t[e],i.ITEMS)}if(i.TYPE===this.types.SELECT||i.TYPE===this.types.CHECKBOX){i.VALUE=this.prepareSelectValue(t[e],i.ITEMS)}if(i.TYPE===this.types.DATE){i.SUB_TYPE=this.prepareSelectValue(t[e+"_datesel"],i.SUB_TYPES);i.VALUES={_from:t[e+"_from"],_to:t[e+"_to"],_days:t[e+"_days"],_month:t[e+"_days"],_quarter:t[e+"_quarter"],_year:t[e+"_year"]}}if(i.TYPE===this.types.NUMBER){i.SUB_TYPE=this.prepareSelectValue(t[e+"_numsel"],i.SUB_TYPES);i.VALUES={_from:t[e+"_from"],_to:t[e+"_to"]}}if(i.TYPE===this.types.CUSTOM_ENTITY){if(typeof t[e+"_label"]!=="undefined"){i.VALUES._label=t[e+"_label"]}if(typeof t[e]!=="undefined"){i.VALUES._value=t[e]}}if(i.TYPE===this.types.CUSTOM){i._VALUE=t[e]}r.push(i)}},this)}return r},prepareSelectValue:function(t,e){var s={};var i;if(BX.type.isNotEmptyString(t)&&BX.type.isArray(e)){i=this.prepareMultiSelectValue({0:t},e);s=i.length>0?i[0]:{}}else{s=e[0]}return s},prepareMultiSelectValue:function(t,e){var s=[];if(BX.type.isPlainObject(t)&&BX.type.isArray(e)){var i=Object.keys(t);var r=i.map(function(e){return t[e]});s=e.filter(function(t){return r.some(function(e){return e===t.VALUE})},this)}return s},getFieldByName:function(t){var e=this.getParam("FIELDS");e=e.filter(function(e){return e.NAME===t},this);return e.length>0?e[0]:null},saveOptions:function(t,e,s,i){if(this.isUseCommonPresets()){if(BX.type.isPlainObject(e)){e.common_presets_id=this.getParam("COMMON_PRESETS_ID")}}var r=BX.util.add_url_param(this.getParam("SETTINGS_URL"),e||{});i=BX.type.isBoolean(i)?i:!!this.getSaveForAllCheckbox()&&this.getSaveForAllCheckbox().checked;if(i&&("action"in e&&e.action==="SET_FILTER_ARRAY")){var a={CONFIRM:true,CONFIRM_MESSAGE:this.getParam("MAIN_UI_FILTER__CONFIRM_MESSAGE_FOR_ALL"),CONFIRM_APPLY_BUTTON:this.getParam("MAIN_UI_FILTER__CONFIRM_APPLY_FOR_ALL"),CONFIRM_CANCEL_BUTTON:this.getParam("CONFIRM_CANCEL")};this.confirmDialog(a,BX.delegate(function(){r=BX.util.add_url_param(r,{for_all:"true"});this.disableEdit();this.disableAddPreset();n(r,this,true)},this),BX.delegate(function(){},this))}else{n(r,this)}function n(e,i){BX.ajax.post(e,t,BX.delegate(function(){BX.removeClass(this.getFindButton(),this.settings.classWaitButtonClass);BX.type.isFunction(s)&&s()},i))}},prepareEvent:function(t){var e,s;if(!("path"in t)||!t.path.length){t.path=[t.target];e=0;while((s=t.path[e++].parentNode)!==null){t.path.push(s)}}return t},restoreRemovedPreset:function(){if(this.getParam("VALUE_REQUIRED_MODE")){var t=this.getParam("CURRENT_PRESET");if(BX.type.isPlainObject(t)){var e=t.ID;var s=this.getPreset().getPresetNodeById(e);this.getPreset().applyPreset(e);this.getPreset().activatePreset(s)}}},hasScrollClick:function(t){var e="clientX"in t?t.clientX:"x"in t?t.x:0;return e>=document.documentElement.offsetWidth},isUseCommonPresets:function(){return!!this.getParam("COMMON_PRESETS_ID")},isInsideFilterEvent:function(t){t=this.prepareEvent(t);return(t.path||[]).some(function(t){return BX.type.isDomNode(t)&&(BX.hasClass(t,this.settings.classFilterContainer)||BX.hasClass(t,this.settings.classSearchContainer)||BX.hasClass(t,this.settings.classDefaultPopup)||BX.hasClass(t,this.settings.classPopupOverlay))},this)},_onDocumentClick:function(t){var e=this.getPopup();if(!this.isInsideFilterEvent(t)&&!this.hasScrollClick(t)){if(e&&e.isShown()){this.closePopup();if(this.getParam("VALUE_REQUIRED_MODE")){this.restoreRemovedPreset()}}BX.onCustomEvent(window,"BX.Main.Filter:blur",[this])}},_onAddFieldClick:function(t){var e=this.getFieldsPopup();t.stopPropagation();t.preventDefault();if(e&&!e.isShown()){this.showFieldsPopup();this.syncFields()}else{this.closeFieldListPopup()}},syncFields:function(){var t=this.getPreset().getFields();var e=this.getFieldsPopupItems();var s,i;if(BX.type.isArray(e)&&e.length){e.forEach(function(e){s=BX.data(e,"name").replace("_datesel","").replace("_numsel","");i=t.some(function(t){return BX.data(t,"name")===s});if(i){BX.addClass(e,this.settings.classMenuItemChecked)}else{BX.removeClass(e,this.settings.classMenuItemChecked)}},this)}},getFieldsPopupItems:function(){var t;if(!BX.type.isArray(this.fieldsPopupItems)){t=this.getFieldsPopup();if("contentContainer"in t&&BX.type.isDomNode(t.contentContainer)){this.fieldsPopupItems=BX.Filter.Utils.getByClass(t.contentContainer,this.settings.classMenuItem,true)}}return this.fieldsPopupItems},getFieldListContainerClassName:function(t){var e=this.settings.classPopupFieldList1Column;if(t>6&&t<12){e=this.settings.classPopupFieldList2Column}if(t>12){e=this.settings.classPopupFieldList3Column}return e},prepareFieldsDecl:function(t){return(t||[]).map(function(t){return{block:"main-ui-filter-field-list-item",label:"LABEL"in t?t.LABEL:"",id:"ID"in t?t.ID:"",name:"NAME"in t?t.NAME:"",item:t,onClick:BX.delegate(this._clickOnFieldListItem,this)}},this)},getFieldsListPopupContent:function(){var t=this.getParam("FIELDS");var e=BX.type.isArray(t)?t.length:0;var s={block:this.settings.classPopupFieldList,mix:this.getFieldListContainerClassName(e),content:this.prepareFieldsDecl(t)};return BX.decl(s)},_clickOnFieldListItem:function(t){var e=t.target;var s;if(!BX.hasClass(e,this.settings.classFieldListItem)){e=BX.findParent(e,{"class":this.settings.classFieldListItem},true,false)}if(BX.type.isDomNode(e)){try{s=JSON.parse(BX.data(e,"item"))}catch(i){}if(BX.hasClass(e,this.settings.classMenuItemChecked)){BX.removeClass(e,this.settings.classMenuItemChecked);this.getPreset().removeField(s)}else{if(BX.type.isPlainObject(s)){this.getPreset().addField(s);BX.addClass(e,this.settings.classMenuItemChecked)}}this.syncFields()}},showFieldsPopup:function(){var t=this.getFieldsPopup();this.adjustFieldListPopupPosition();t.show()},closeFieldListPopup:function(){var t=this.getFieldsPopup();t.close()},adjustFieldListPopupPosition:function(){var t=this.getFieldsPopup();var e=BX.pos(this.getAddField());e.forceBindPosition=true;t.adjustPosition(e)},getFieldsPopup:function(){var t=this.getAddField();if(!this.fieldsPopup){this.fieldsPopup=new BX.PopupWindow(this.getParam("FILTER_ID")+"_fields_popup",t,{autoHide:true,offsetTop:4,offsetLeft:0,lightShadow:true,closeIcon:false,closeByEsc:false,noAllPaddings:true,zIndex:13});this.fieldsPopup.setContent(this.getFieldsListPopupContent())}return this.fieldsPopup},_onAddPresetClick:function(){this.enableAddPreset()},enableWaitSate:function(t){t&&BX.addClass(t,this.settings.classWaitButtonClass)},disableWaitState:function(t){t&&BX.removeClass(t,this.settings.classWaitButtonClass)},_onSaveButtonClick:function(){var t=!!this.getSaveForAllCheckbox()&&this.getSaveForAllCheckbox().checked;this.enableWaitSate(this.getFindButton());if(this.isAddPresetEnabled()&&!t){this.savePreset();this.disableAddPreset()}if(this.isEditEnabled()){var e=this.getPreset();e.updateEditablePreset(e.getCurrentPresetId());this.saveUserSettings(t);!t&&this.disableEdit()}},_onCancelButtonClick:function(){this.disableAddPreset();this.getPreset().clearAddPresetFieldInput();this.disableEdit();!!this.getSaveForAllCheckbox()&&(this.getSaveForAllCheckbox().checked=null)},_onGridReady:function(t){if(!this.grid&&t.getContainerId()===this.getParam("GRID_ID")){this.grid=t}},_onFilterMousedown:function(t){var e=t.target;if(this.getFields().isDragButton(e)){var s=BX.Filter.Utils.getByTag(e.parentNode,"input",true);(s||[]).forEach(function(t){BX.fireEvent(t,"blur")});BX.fireEvent(this.getFilter(),"click")}},_onFilterClick:function(t){var e=this.getFields();var s=this.getPreset();var i;if(e.isFieldDelete(t.target)){i=e.getField(t.target);s.removeField(i)}if(e.isFieldValueDelete(t.target)){i=e.getField(t.target);e.clearFieldValue(i)}},getButtonsContainer:function(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classButtonsContainer)},getSaveButton:function(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classSaveButton)},getCancelButton:function(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classCancelButton)},getFindButton:function(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classFindButton)},getResetButton:function(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classResetButton)},getAddPresetButton:function(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classAddPresetButton)},isAddPresetEnabled:function(){return this.isAddPresetModeState},enableAddPreset:function(){var t=this.getPreset();var e=t.getAddPresetField();var s=t.getAddPresetFieldInput();var i=this.getButtonsContainer();BX.show(e);BX.show(i);BX.hide(this.getPresetButtonsContainer());this.hideForAllCheckbox();if(BX.type.isDomNode(s)){s.focus()}BX.addClass(this.getSidebarControlsContainer(),this.settings.classDisabled);this.isAddPresetModeState=true},disableAddPreset:function(){var t=this.getPreset();var e=t.getAddPresetField();var s=this.getButtonsContainer();var i=t.getCurrentPresetId();BX.hide(e);BX.hide(s);BX.show(this.getPresetButtonsContainer());this.showForAllCheckbox();if(BX.type.isNotEmptyString(i)){t.applyPreset(i)}t.getAddPresetFieldInput().value="";BX.removeClass(this.getSidebarControlsContainer(),this.settings.classDisabled);this.isAddPresetModeState=false},getControls:function(){var t=this.getFieldListContainer();var e=null;if(BX.type.isDomNode(t)){e=BX.Filter.Utils.getByClass(t,this.settings.classControl,true)}return e},getFilterFields:function(){var t=this.getFieldListContainer();var e=[];var s=[];if(BX.type.isDomNode(t)){e=BX.Filter.Utils.getByClass(t,this.settings.classField,true);s=BX.Filter.Utils.getByClass(t,this.settings.classFieldGroup,true);if(!BX.type.isArray(e)){e=[]}if(BX.type.isArray(s)){s.forEach(function(t){e.push(t)})}}return e},getFilterFieldsValues:function(){var t=this.getPreset().getFields();var e=this.getSearch();var s={};var i,r;s["FIND"]=e.getInput().value;if(BX.type.isArray(t)&&t.length){t.forEach(function(t){i=BX.data(t,"type");r=BX.data(t,"name");switch(i){case this.types.STRING:{this.prepareControlStringValue(s,t);break}case this.types.NUMBER:{this.prepareControlNumberValue(s,r,t);break}case this.types.DATE:{this.prepareControlDateValue(s,r,t);break}case this.types.SELECT:{this.prepareControlSelectValue(s,r,t);break}case this.types.MULTI_SELECT:{this.prepareControlMultiselectValue(s,r,t);break}case this.types.CUSTOM:{this.prepareControlCustomValue(s,r,t);break}case this.types.CUSTOM_ENTITY:{this.prepareControlCustomEntityValue(s,r,t);break}default:{break}}},this)}return s},prepareControlCustomEntityValue:function(t,e,s){var i=this.fetchSquares(s);var r=this.fetchSquaresData(i);var a=BX.Main.ui.CustomEntity.isMultiple(s);t[e]="";t[e+"_label"]="";if(a){t[e]=[];t[e+"_label"]=[];!!r&&r.forEach(function(s){t[e].push(s._value.toString());t[e+"_label"].push(s._label.toString())})}else{if(r.length){t[e]=r[0]._value.toString();t[e+"_label"]=r[0]._label.toString()}}},fetchSquares:function(t){return!!t?BX.Filter.Utils.getByClass(t,this.settings.classSquare,true):[]},fetchSquaresData:function(t){return t.map(function(t){return JSON.parse(BX.data(t,"item"))},this)},prepareControlCustomValue:function(t,e,s){var i=BX.Filter.Utils.getByTag(s,"input",true);t[e]="";if(BX.type.isArray(i)){i.forEach(function(e){if(BX.type.isNotEmptyString(e.name)){t[e.name]=e.value}})}},prepareControlMultiselectValue:function(t,e,s){var i=BX.Filter.Utils.getByClass(s,this.settings.classMultiSelect);var r=JSON.parse(BX.data(i,"value"));t[e]="";if(BX.type.isArray(r)&&r.length){t[e]={};r.forEach(function(s,i){t[e][i]=s.VALUE})}},prepareControlSelectValue:function(t,e,s){var i=BX.Filter.Utils.getByClass(s,this.settings.classSelect);var r=JSON.parse(BX.data(i,"value"));t[e]=r.VALUE},prepareControlDateValue:function(t,e,s){var i=BX.Filter.Utils.getByClass(s,this.settings.classSelect);var r=e+this.settings.datePostfix;var a=e+this.settings.fromPostfix;var n=e+this.settings.toPostfix;var l=e+this.settings.daysPostfix;var o=e+this.settings.monthPostfix;var h=e+this.settings.quarterPostfix;var d=e+this.settings.yearPostfix;var u,c,f,g;t[r]="";t[a]="";t[n]="";t[l]="";t[o]="";t[h]="";t[d]="";u=JSON.parse(BX.data(i,"value"));t[r]=u.VALUE;switch(u.VALUE){case this.dateTypes.EXACT:{c=BX.Filter.Utils.getByClass(s,this.settings.classDateInput);t[a]=c.value;t[n]=c.value;break}case this.dateTypes.QUARTER:{f=BX.Filter.Utils.getByClass(s,this.settings.classControl,true);if(BX.type.isArray(f)){f.forEach(function(e){g=BX.data(e,"name");if(g&&g.indexOf("_quarter")!==-1){t[h]=JSON.parse(BX.data(e,"value")).VALUE}if(g&&g.indexOf("_year")!==-1){t[d]=JSON.parse(BX.data(e,"value")).VALUE}},this)}break}case this.dateTypes.YEAR:{f=BX.Filter.Utils.getByClass(s,this.settings.classControl,true);if(BX.type.isArray(f)){f.forEach(function(e){g=BX.data(e,"name");if(g&&g.indexOf("_year")!==-1){t[d]=JSON.parse(BX.data(e,"value")).VALUE}},this)}break}case this.dateTypes.MONTH:{f=BX.Filter.Utils.getByClass(s,this.settings.classControl,true);if(BX.type.isArray(f)){f.forEach(function(e){g=BX.data(e,"name");if(g&&g.indexOf("_month")!==-1){t[o]=JSON.parse(BX.data(e,"value")).VALUE}if(g&&g.indexOf("_year")!==-1){t[d]=JSON.parse(BX.data(e,"value")).VALUE}},this)}break}case this.dateTypes.NEXT_DAYS:case this.dateTypes.PREV_DAYS:{var p=BX.Filter.Utils.getByClass(s,this.settings.classNumberInput);if(!!p&&p.name===l){t[l]=p.value}break}case this.dateTypes.RANGE:{c=BX.Filter.Utils.getByClass(s,this.settings.classDateInput,true);c.forEach(function(e){if(e.name===a){t[a]=e.value}else if(e.name===n){t[n]=e.value}},this);break}default:{break}}},prepareControlNumberValue:function(t,e,s){var i=BX.Filter.Utils.getByClass(s,this.settings.classNumberInput,true);var r=BX.Filter.Utils.getByClass(s,this.settings.classSelect);var a=e+this.settings.numberPostfix;var n=e+this.settings.fromPostfix;var l=e+this.settings.toPostfix;var o;t[n]="";t[l]="";o=JSON.parse(BX.data(r,"value"));t[a]=o.VALUE;i.forEach(function(e){if(e.name.indexOf(this.settings.fromPostfix)!==-1){t[n]=e.value||"";if(t[a]==="exact"){t[l]=e.value||""}}else if(e.name.indexOf(this.settings.toPostfix)!==-1){t[l]=e.value||""}},this)},prepareControlStringValue:function(t,e){var s=BX.Filter.Utils.getByClass(e,this.settings.classStringInput);var i;if(BX.type.isDomNode(s)){i=s.name;t[i]=s.value}},showGridAnimation:function(){this.grid&&this.grid.tableFade()},hideGridAnimation:function(){this.grid&&this.grid.tableUnfade()},getPresetId:function(t,e){var s=this.getPreset().getCurrentPresetId();if(!this.isEditEnabled()&&!this.isAddPresetEnabled()&&!e||s==="default_filter"&&!t){s="tmp_filter"}return s},applyFilter:function(t,e){var s=this.getPresetId(t,e);var i=this.getParam("FILTER_ID");var r=new BX.Promise(null,this);var a=this.getPreset();var n=this.getSearch();var l={autoResolve:!this.grid};var o=this;this.showGridAnimation();BX.onCustomEvent(window,"BX.Main.Filter:beforeApply",[i,{},this,r]);this.updatePreset(s,null,t,null).then(function(){n.updatePreset(a.getPreset(s))}).then(function(){var t={apply_filter:"Y",clear_nav:"Y"};var e=BX.delegate(r.fulfill,r);var s=BX.delegate(r.reject,r);o.grid&&o.grid.reloadTable("POST",t,e,s);BX.onCustomEvent(window,"BX.Main.Filter:apply",[i,{},o,r,l]);l.autoResolve&&r.fulfill()});return r},getAddField:function(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classAddField)},getFieldListContainer:function(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classFileldControlList)},getFields:function(){if(!(this.fields instanceof BX.Filter.Fields)){this.fields=new BX.Filter.Fields(this)}return this.fields},getPreset:function(){if(!(this.presets instanceof BX.Filter.Presets)){this.presets=new BX.Filter.Presets(this)}return this.presets},resetControlData:function(t){if(BX.type.isPlainObject(t)){switch(t.TYPE){case this.types.MULTI_SELECT:{t.VALUE=[];break}case this.types.SELECT:{t.VALUE=t.ITEMS[0];break}case this.types.DATE:{t.SUB_TYPE=t.SUB_TYPES[0];t.VALUES={_from:"",_to:"",_days:"",_quarter:"",_year:""};break}case this.types.NUMBER:{t.SUB_TYPE=t.SUB_TYPES[0];t.VALUES={_from:"",_to:""};break}case this.types.CUSTOM_ENTITY:{t.VALUES={_label:"",_value:""};break}case this.types.CUSTOM:{t._VALUE="";break}default:{t.VALUE=""}}}return t},clearControl:function(t){var e=this.getPreset().getField({NAME:t});var s,i;if(BX.type.isDomNode(e)){s=this.getFieldByName(t);s=this.resetControlData(s);i=this.getPreset().createControl(s);BX.insertAfter(i,e);BX.remove(e)}},clearControls:function(t){if(BX.type.isArray(t)){t.forEach(function(t){"name"in t&&this.clearControl(t.name)},this)}else if(BX.type.isPlainObject(t)&&"name"in t){this.clearControl(t.name)}},getTemplate:function(){return BX.html(BX(this.settings.generalTemplateId))},isIe:function(){if(!BX.type.isBoolean(this.ie)){this.ie=BX.hasClass(document.documentElement,"bx-ie")}return this.ie},closePopup:function(){var t=this.getPopup();var e=t.popupContainer;var s=this.settings.get("FILTER_CLOSE_DELAY");var i;setTimeout(BX.delegate(function(){if(!this.isIe()){BX.removeClass(e,this.settings.classAnimationShow);BX.addClass(e,this.settings.classAnimationClose);i=parseFloat(BX.style(e,"animation-duration"));if(BX.type.isNumber(i)){i=i*1e3}setTimeout(function(){t.close()},i)}else{t.close()}},this),s);this.closeFieldListPopup();this.adjustFocus()},showPopup:function(){var t=this.getPopup();var e;if(!t.isShown()){this.isOpened=true;var s=this.settings.get("FILTER_SHOW_DELAY");setTimeout(BX.delegate(function(){t.show();if(!this.isIe()){e=t.popupContainer;BX.removeClass(e,this.settings.classAnimationClose);BX.addClass(e,this.settings.classAnimationShow)}},this),s)}},getSaveForAllCheckbox:function(){if(!this.saveForAllCheckbox&&!!this.getSaveForAllCheckboxContainer()){this.saveForAllCheckbox=BX.Filter.Utils.getBySelector(this.getSaveForAllCheckboxContainer(),'input[type="checkbox"]')}return this.saveForAllCheckbox},getSaveForAllCheckboxContainer:function(){if(!this.saveForAllCheckboxContainer){this.saveForAllCheckboxContainer=BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classForAllCheckbox)}return this.saveForAllCheckboxContainer},showForAllCheckbox:function(){!!this.getSaveForAllCheckboxContainer()&&BX.removeClass(this.getSaveForAllCheckboxContainer(),this.settings.classHide)},hideForAllCheckbox:function(){!!this.getSaveForAllCheckboxContainer()&&BX.addClass(this.getSaveForAllCheckboxContainer(),this.settings.classHide)},getPopupBindElement:function(){if(!this.popupBindElement){var t=this.settings.get("POPUP_BIND_ELEMENT_SELECTOR");var e=null;if(BX.type.isNotEmptyString(t)){e=BX.Filter.Utils.getBySelector(document,t)}this.popupBindElement=!!e?e:this.getSearch().getContainer()}return this.popupBindElement},getPopup:function(){if(!(this.popup instanceof BX.PopupWindow)){this.popup=new BX.PopupWindow(this.getParam("FILTER_ID")+this.settings.searchContainerPostfix,this.getPopupBindElement(),{autoHide:false,offsetTop:parseInt(this.settings.get("POPUP_OFFSET_TOP")),offsetLeft:parseInt(this.settings.get("POPUP_OFFSET_LEFT")),lightShadow:true,closeIcon:false,closeByEsc:false,noAllPaddings:true,zIndex:12});this.popup.setContent(this.getTemplate());BX.bind(this.getFieldListContainer(),"keydown",BX.delegate(this._onFieldsContainerKeydown,this));BX.bind(this.getFilter(),"click",BX.delegate(this._onFilterClick,this));BX.bind(this.getAddPresetButton(),"click",BX.delegate(this._onAddPresetClick,this));BX.bind(this.getPreset().getAddPresetFieldInput(),"keydown",BX.delegate(this._onAddPresetKeydown,this));BX.bind(this.getPreset().getContainer(),"keydown",BX.delegate(this._onPresetInputKeydown,this));BX.bind(this.getSaveButton(),"click",BX.delegate(this._onSaveButtonClick,this));BX.bind(this.getCancelButton(),"click",BX.delegate(this._onCancelButtonClick,this));BX.bind(this.getFindButton(),"click",BX.delegate(this._onFindButtonClick,this));BX.bind(this.getResetButton(),"click",BX.delegate(this._onResetButtonClick,this));BX.bind(this.getAddField(),"click",BX.delegate(this._onAddFieldClick,this));BX.bind(this.getEditButton(),"click",BX.delegate(this._onEditButtonClick,this));BX.bind(this.getRestoreButton(),"click",BX.delegate(this._onRestoreButtonClick,this));BX.bind(this.getRestoreFieldsButton(),"click",BX.delegate(this._onRestoreFieldsButtonClick,this));this.getFilter().addEventListener("mousedown",BX.delegate(this._onFilterMousedown,this),true);this.getPreset().showCurrentPresetFields();this.getPreset().bindOnPresetClick()}return this.popup},_onRestoreFieldsButtonClick:function(){this.restoreDefaultFields()},restoreDefaultFields:function(){var t=this.getPreset().getPreset("default_filter",true);var e=this.getParam("PRESETS");var s=this.getPreset().getCurrentPresetId();var i={FILTER_ID:this.getParam("FILTER_ID"),GRID_ID:this.getParam("GRID_ID"),action:"SET_FILTER"};var r=t.FIELDS.map(function(t){return t.NAME});var a=r.join(",");e.forEach(function(s,i){if(s.ID==="default_filter"){e[i]=BX.clone(t)}},this);if(BX.type.isArray(this.editablePresets)){this.editablePresets.forEach(function(e,s){if(e.ID==="default_filter"){this.editablePresets[s]=BX.clone(t)}},this)}this.getPreset().applyPreset(s);this.updatePreset(s);this.saveOptions({preset_id:"default_filter",rows:a,save:"Y",apply_filter:"N"},i)},getRestoreFieldsButton:function(){if(!this.restoreFieldsButton){this.restoreFieldsButton=BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classRestoreFieldsButton)}return this.restoreFieldsButton},restoreFilter:function(){var t=this.getParam("DEFAULT_PRESETS");var e=this.getParam("PRESETS");var s=false;var i,r,a;if(BX.type.isArray(t)){t.sort(function(t,e){return t.SORT<e.SORT});t.forEach(function(t){s=e.some(function(e,s){if(e.ID===t.ID){i=s;return true}});if(s){e[i]=BX.clone(t)}else{e.push(BX.clone(t))}if(t.ID!=="default_filter"){this.addSidebarItem(t.ID,t.TITLE,t.PINNED);if(t.PINNED){r=t.ID}}},this)}this.saveRestoreFilter();this.disableAddPreset();this.disableEdit();if(!r){r="default_filter"}a=this.getPreset().getPresetNodeById(r);if(a){BX.fireEvent(a,"click")}},saveRestoreFilter:function(){var t={FILTER_ID:this.getParam("FILTER_ID"),GRID_ID:this.getParam("GRID_ID"),action:"RESTORE_FILTER"};var e=this.getParam("PRESETS");var s={};var i;if(BX.type.isArray(e)){e.forEach(function(t,e){i=t.FIELDS.map(function(t){return t.NAME});i=i.join(",");s[t.ID]={name:t.TITLE||null,sort:e,preset_id:t.ID,fields:this.prepareFields(t.FIELDS),rows:i}},this);this.saveOptions(s,t)}},prepareFields:function(t){var e={};var s;if(BX.type.isArray(t)){t.forEach(function(t){if(t.TYPE===this.types.SELECT){e[t.NAME]="VALUE"in t.VALUE?t.VALUE.VALUE:""}if(t.TYPE===this.types.MULTI_SELECT){t.VALUE.forEach(function(s,i){e[t.NAME]=e[t.NAME]||{};e[t.NAME][i]=s.VALUE});e[t.NAME]=e[t.NAME]||""}if(t.TYPE===this.types.DATE||t.TYPE===this.types.NUMBER){s=Object.keys(t.VALUES);s.forEach(function(s){e[t.NAME+s]=t.VALUES[s]});if(t.TYPE===this.types.DATE){e[t.NAME+"_datesel"]="VALUE"in t.SUB_TYPE?t.SUB_TYPE.VALUE:t.SUB_TYPES[0].VALUE}if(t.TYPE===this.types.NUMBER){e[t.NAME+"_numsel"]="VALUE"in t.SUB_TYPE?t.SUB_TYPE.VALUE:t.SUB_TYPES[0].VALUE}}if(t.TYPE===this.types.CUSTOM_ENTITY){e[t.NAME+"_label"]=t.VALUES._label;e[t.NAME+"_value"]=t.VALUES._value}},this)}return e},getRestoreButton:function(){if(!BX.type.isDomNode(this.restoreButton)){this.restoreButton=BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classRestoreButton)}return this.restoreButton},_onPresetInputKeydown:function(t){if(BX.Filter.Utils.isKey(t,"enter")&&t.target.tagName==="INPUT"){BX.fireEvent(this.getSaveButton(),"click")}},_onFieldsContainerKeydown:function(t){if(BX.Filter.Utils.isKey(t,"enter")&&t.target.tagName==="INPUT"){this.applyFilter();this.closePopup()}},_onFindButtonClick:function(){this.getPreset().deactivateAllPresets();this.applyFilter();this.closePopup()},_onResetButtonClick:function(){if(this.getParam("RESET_TO_DEFAULT_MODE")){this.getSearch().clearInput();this.getPreset().applyPinnedPreset()}else{this.resetFilter()}this.closePopup()},resetFilter:function(t){var e=this.getSearch();var s=this.getPreset();if(!t){e.clearInput()}e.removePreset();s.deactivateAllPresets();s.resetPreset(true);e.hideClearButton();e.adjustPlaceholder();return this.applyFilter(true,true)},_onEditButtonClick:function(){if(!this.isEditEnabled()){this.enableEdit()}else{this.disableEdit()}},enableFieldsDragAndDrop:function(){var t=this.getPreset().getFields();this.fieldsList=[];if(BX.type.isArray(t)){this.fieldsList=t.map(this.registerDragItem,this)}},registerDragItem:function(t){var e=this.getDragButton(t);e.onbxdragstart=BX.delegate(this._onFieldDragStart,this);e.onbxdragstop=BX.delegate(this._onFieldDragStop,this);e.onbxdrag=BX.delegate(this._onFieldDrag,this);jsDD.registerObject(e);jsDD.registerDest(e);return t},unregisterDragItem:function(t){var e=this.getDragButton(t);jsDD.unregisterObject(e);jsDD.unregisterDest(e)},_onFieldDragStart:function(){this.dragItem=this.getFields().getField(jsDD.current_node);this.dragIndex=BX.Filter.Utils.getIndex(this.fieldsList,this.dragItem);this.dragRect=this.dragItem.getBoundingClientRect();this.offset=this.dragRect.height;this.dragStartOffset=jsDD.start_y-(this.dragRect.top+BX.scrollTop(window));BX.Filter.Utils.styleForEach(this.fieldsList,{transition:"100ms"});BX.addClass(this.dragItem,this.settings.classPresetOndrag);BX.bind(document,"mousemove",BX.delegate(this._onMouseMove,this));

},_onFieldDragStop:function(){BX.unbind(document,"mousemove",BX.delegate(this._onMouseMove,this));BX.removeClass(this.dragItem,this.settings.classPresetOndrag);BX.Filter.Utils.styleForEach(this.fieldsList,{transition:"",transform:""});BX.Filter.Utils.collectionSort(this.dragItem,this.targetItem);this.fieldsList=this.getPreset().getFields();this.saveFieldsSort()},_onFieldDrag:function(){var t=this;var e,s;this.dragOffset=this.realY-this.dragRect.top-this.dragStartOffset;this.sortOffset=t.realY+BX.scrollTop(window);BX.Filter.Utils.styleForEach([this.dragItem],{transition:"0ms",transform:"translate3d(0px, "+this.dragOffset+"px, 0px)"});this.fieldsList.forEach(function(i,r){if(i){e=i.getBoundingClientRect();s=e.top+BX.scrollTop(window)+e.height/2;if(r>t.dragIndex&&t.sortOffset>s&&i.style.transform!=="translate3d(0px, "+-t.offset+"px, 0px)"&&i.style.transform!==""){t.targetItem=i;BX.style(i,"transform","translate3d(0px, "+-t.offset+"px, 0px)");BX.style(i,"transition","300ms")}if(r<t.dragIndex&&t.sortOffset<s&&i.style.transform!=="translate3d(0px, "+t.offset+"px, 0px)"&&i.style.transform!==""){t.targetItem=i;BX.style(i,"transform","translate3d(0px, "+t.offset+"px, 0px)");BX.style(i,"transition","300ms")}if((r<t.dragIndex&&t.sortOffset>s||r>t.dragIndex&&t.sortOffset<s)&&i.style.transform!=="translate3d(0px, 0px, 0px)"){if(i.style.transform!==""){t.targetItem=i}BX.style(i,"transform","translate3d(0px, 0px, 0px)");BX.style(i,"transition","300ms")}}})},disableFieldsDragAndDrop:function(){if(BX.type.isArray(this.fieldsList)&&this.fieldsList.length){this.fieldsList.map(this.unregisterDragItem,this)}},enablePresetsDragAndDrop:function(){var t,e,s,i;t=this.getPreset();e=t.getPresets();this.presetsList=[];if(BX.type.isArray(e)&&e.length){e.forEach(function(e){i=t.getPresetId(e);if(!BX.hasClass(e,this.settings.classAddPresetField)&&i!=="default_filter"&&!BX.hasClass(e,this.settings.classDefaultFilter)){s=this.getDragButton(e);s.onbxdragstart=BX.delegate(this._onDragStart,this);s.onbxdragstop=BX.delegate(this._onDragStop,this);s.onbxdrag=BX.delegate(this._onDrag,this);jsDD.registerObject(s);jsDD.registerDest(s);this.presetsList.push(e)}},this)}},getDragButton:function(t){return BX.Filter.Utils.getByClass(t,this.settings.classPresetDragButton)},disablePresetsDragAndDrop:function(){if(BX.type.isArray(this.presetsList)&&this.presetsList.length){this.presetsList.forEach(function(t){if(!BX.hasClass(t,this.settings.classAddPresetField)){jsDD.unregisterObject(t);jsDD.unregisterDest(t)}},this)}},_onDragStart:function(){this.dragItem=this.getPreset().normalizePreset(jsDD.current_node);this.dragIndex=BX.Filter.Utils.getIndex(this.presetsList,this.dragItem);this.dragRect=this.dragItem.getBoundingClientRect();this.offset=this.dragRect.height;this.dragStartOffset=jsDD.start_y-(this.dragRect.top+BX.scrollTop(window));BX.Filter.Utils.styleForEach(this.list,{transition:"100ms"});BX.addClass(this.dragItem,this.settings.classPresetOndrag);BX.bind(document,"mousemove",BX.delegate(this._onMouseMove,this))},_onMouseMove:function(t){this.realX=t.clientX;this.realY=t.clientY},getDragOffset:function(){return jsDD.x-this.startDragOffset-this.dragRect.left},_onDragStop:function(){var t,e;BX.unbind(document,"mousemove",BX.delegate(this._onMouseMove,this));BX.removeClass(this.dragItem,this.settings.classPresetOndrag);BX.Filter.Utils.styleForEach(this.presetsList,{transition:"",transform:""});BX.Filter.Utils.collectionSort(this.dragItem,this.targetItem);t=this.getPreset();e=t.getPresets();this.presetsList=[];if(BX.type.isArray(e)&&e.length){e.forEach(function(t){if(!BX.hasClass(t,this.settings.classAddPresetField)&&!BX.hasClass(t,this.settings.classDefaultFilter)){this.presetsList.push(t)}},this)}},_onDrag:function(){var t=this;var e,s;this.dragOffset=this.realY-this.dragRect.top-this.dragStartOffset;this.sortOffset=t.realY+BX.scrollTop(window);BX.Filter.Utils.styleForEach([this.dragItem],{transition:"0ms",transform:"translate3d(0px, "+this.dragOffset+"px, 0px)"});this.presetsList.forEach(function(i,r){if(i){e=i.getBoundingClientRect();s=e.top+BX.scrollTop(window)+e.height/2;if(r>t.dragIndex&&t.sortOffset>s&&i.style.transform!=="translate3d(0px, "+-t.offset+"px, 0px)"&&i.style.transform!==""){t.targetItem=i;BX.style(i,"transform","translate3d(0px, "+-t.offset+"px, 0px)");BX.style(i,"transition","300ms")}if(r<t.dragIndex&&t.sortOffset<s&&i.style.transform!=="translate3d(0px, "+t.offset+"px, 0px)"&&i.style.transform!==""){t.targetItem=i;BX.style(i,"transform","translate3d(0px, "+t.offset+"px, 0px)");BX.style(i,"transition","300ms")}if((r<t.dragIndex&&t.sortOffset>s||r>t.dragIndex&&t.sortOffset<s)&&i.style.transform!=="translate3d(0px, 0px, 0px)"){if(i.style.transform!==""){t.targetItem=i}BX.style(i,"transform","translate3d(0px, 0px, 0px)");BX.style(i,"transition","300ms")}}})},getSidebarControlsContainer:function(){if(!BX.type.isDomNode(this.sidebarControlsContainer)){this.sidebarControlsContainer=BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classSidebarControlsContainer)}return this.sidebarControlsContainer},enableEdit:function(){var t=this.getPreset();var e=t.getPresets();var s;if(BX.type.isArray(e)&&e.length){e.forEach(function(e){s=t.getPresetId(e);if(!BX.hasClass(e,this.settings.classAddPresetField)&&s!=="default_filter"){BX.addClass(e,this.settings.classPresetEdit)}},this)}this.enablePresetsDragAndDrop();BX.show(this.getButtonsContainer());BX.hide(this.getPresetButtonsContainer());BX.addClass(this.getSidebarControlsContainer(),this.settings.classDisabled);this.editablePresets=BX.clone(this.getParam("PRESETS"));this.isEditEnabledState=true},disableEdit:function(){var t=this.getPreset();var e=t.getPresets();if(BX.type.isArray(e)&&e.length){e.forEach(function(t){if(!BX.hasClass(t,this.settings.classAddPresetField)){BX.removeClass(t,this.settings.classPresetEdit);this.getPreset().disableEditPresetName(t)}},this)}this.disablePresetsDragAndDrop();if(!this.isAddPresetEnabled()){BX.style(this.getButtonsContainer(),"display","")}BX.show(this.getPresetButtonsContainer());BX.removeClass(this.getSidebarControlsContainer(),this.settings.classDisabled);this.editablePresets=null;this.isEditEnabledState=false;this.applyFilter(null,true)},getPresetButtonsContainer:function(){if(!BX.type.isDomNode(this.presetButtonsContainer)){this.presetButtonsContainer=BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classPresetButtonsContainer)}return this.presetButtonsContainer},isEditEnabled:function(){return this.isEditEnabledState},getEditButton:function(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classEditButton)},getParam:function(t,e){return t in this.params?this.params[t]:e},getFilter:function(){return BX.Filter.Utils.getByClass(this.getPopup().contentContainer,this.settings.classFilterContainer)},getSearch:function(){if(!(this.search instanceof BX.Filter.Search)){this.search=new BX.Filter.Search(this)}return this.search},_onRestoreButtonClick:function(){var t={CONFIRM:true,CONFIRM_MESSAGE:this.getParam("CONFIRM_MESSAGE"),CONFIRM_APPLY_BUTTON:this.getParam("CONFIRM_APPLY"),CONFIRM_CANCEL_BUTTON:this.getParam("CONFIRM_CANCEL")};this.confirmDialog(t,BX.delegate(this.restoreFilter,this))},confirmDialog:function(t,e,s){if("CONFIRM"in t&&t.CONFIRM){var i=this.getParam("FILTER_ID")+"-confirm-dialog";var r='<div class="main-ui-filter-confirm-content">'+t.CONFIRM_MESSAGE+"</div>";var a="CONFIRM_TITLE"in t?t.CONFIRM_TITLE:"";var n=new BX.PopupWindowButton({text:t.CONFIRM_APPLY_BUTTON,events:{click:function(){BX.type.isFunction(e)?e():null;this.popupWindow.close();this.popupWindow.destroy()}}});var l=new BX.PopupWindowButtonLink({text:t.CONFIRM_CANCEL_BUTTON,events:{click:function(){BX.type.isFunction(s)?s():null;this.popupWindow.close();this.popupWindow.destroy()}}});var o=new BX.PopupWindow(i,null,{content:r,titleBar:a,autoHide:false,zIndex:9999,overlay:.4,offsetTop:-100,closeIcon:true,closeByEsc:true,buttons:[n,l]});BX.addCustomEvent(o,"onPopupClose",BX.delegate(function(){!!this.getSaveForAllCheckbox()&&(this.getSaveForAllCheckbox().checked=null)},this));if(!o.isShown()){o.show();var h=o.popupContainer;BX.removeClass(h,this.settings.classAnimationShow);BX.addClass(h,this.settings.classAnimationShow)}}else{BX.type.isFunction(e)?e():null}}}})();(function(){BX.Main.filterManager={data:{},push:function(t,e){if(BX.type.isNotEmptyString(t)&&e){this.data[t]=e}},getById:function(t){var e=null;if(t in this.data){e=this.data[t]}return e}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:87:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/api.min.js?1511316472586";s:6:"source";s:69:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/api.js";s:3:"min";s:73:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/api.min.js";s:3:"map";s:73:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/api.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Filter");BX.Filter.Api=function(t){this.parent=t};BX.Filter.Api.prototype={setFields:function(t){var e,i;if(BX.type.isPlainObject(t)){this.parent.getPopup();e=this.parent.getPreset();e.deactivateAllPresets();i={preset_id:"tmp_filter",fields:t};this.parent.updateParams(i);e.applyPreset("tmp_filter")}},apply:function(){if(!this.parent.isEditEnabled()){if(!this.parent.isEditEnabled()){this.parent.applyFilter()}this.parent.closePopup();if(this.parent.isAddPresetEnabled()){this.parent.disableAddPreset()}}}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:101:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/field-controller.min.js?15113164722703";s:6:"source";s:82:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/field-controller.js";s:3:"min";s:86:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/field-controller.min.js";s:3:"map";s:86:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/field-controller.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Filter");BX.Filter.FieldController=function(t,e){this.field=null;this.parent=null;this.type=null;this.input=null;this.deleteButton=null;this.init(t,e)};BX.Filter.FieldController.prototype={init:function(t,e){if(!BX.type.isDomNode(t)){throw"BX.Filter.FieldController.init: field isn't dom node"}if(!(e instanceof BX.Main.Filter)){throw"BX.Filter.FieldController.init: parent not instance of BX.Main.ui.Filter"}this.field=t;this.parent=e;this.bind();this.isShowDelete()?this.showDelete():this.hideDelete()},isShowDelete:function(){var t=this.getSquares();return this.getInputValue()||BX.type.isArray(t)&&t.length},getField:function(){return this.field},getInput:function(){var t,e;if(!BX.type.isDomNode(this.input)){t=this.getType();e=this.parent.types;if(t===e.DATE){this.input=BX.Filter.Utils.getByClass(this.getField(),this.parent.settings.classDateInput)}if(t===e.NUMBER||t==="number"){this.input=BX.Filter.Utils.getByClass(this.getField(),this.parent.settings.classNumberInput)}if(t===e.STRING){this.input=BX.Filter.Utils.getByClass(this.getField(),this.parent.settings.classStringInput)}if(t===e.CUSTOM_ENTITY){this.input=BX.Filter.Utils.getBySelector(this.getField(),'input[type="hidden"]')}}return this.input},getDeleteButton:function(){if(!BX.type.isDomNode(this.deleteButton)){this.deleteButton=BX.Filter.Utils.getByClass(this.getField(),this.parent.settings.classValueDelete)}return this.deleteButton},getSquares:function(){return BX.Filter.Utils.getByClass(this.getField(),this.parent.settings.classSquare)},bind:function(){if(this.getType()!==this.parent.types.MULTI_SELECT&&this.getType()!==this.parent.types.SELECT){BX.bind(this.getDeleteButton(),"click",BX.delegate(this._onDeleteClick,this));BX.bind(this.getInput(),"input",BX.delegate(this._onInput,this))}},clearInput:function(){var t=this.getInput();if(BX.type.isDomNode(t)){t.value=""}},hideDelete:function(){var t=this.getDeleteButton();if(BX.type.isDomNode(t)){BX.addClass(t,this.parent.settings.classHide)}},showDelete:function(){var t=this.getDeleteButton();if(BX.type.isDomNode(t)){BX.removeClass(t,this.parent.settings.classHide)}},removeSquares:function(){var t=this.getSquares();if(BX.type.isArray(t)&&t.length){t.forEach(function(t){BX.remove(t)})}},_onDeleteClick:function(){this.removeSquares();this.clearInput();this.hideDelete()},_onInput:function(){this.getInputValue()?this.showDelete():this.hideDelete()},getInputValue:function(){var t="";var e=this.getInput();if(BX.type.isDomNode(e)){t=e.value}return t},getType:function(){if(!BX.type.isNotEmptyString(this.type)){this.type=BX.data(this.getField(),"type")}return this.type}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:92:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/fields.min.js?151131647216599";s:6:"source";s:72:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/fields.js";s:3:"min";s:76:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/fields.min.js";s:3:"map";s:76:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/fields.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Filter");BX.Filter.Fields=function(t){this.parent=null;this.init(t)};BX.Filter.Fields.prototype={init:function(t){this.parent=t;BX.addCustomEvent(window,"UI::Select::change",BX.delegate(this._onDateTypeChange,this))},deleteField:function(t){BX.remove(t)},isFieldDelete:function(t){return BX.hasClass(t,this.parent.settings.classFieldDelete)},isFieldValueDelete:function(t){return BX.hasClass(t,this.parent.settings.classValueDelete)||BX.hasClass(t.parentNode,this.parent.settings.classValueDelete)},isDragButton:function(t){return t&&BX.hasClass(t,this.parent.settings.classPresetDragButton)},clearFieldValue:function(t){if(t){var e=BX.Filter.Utils.getByClass(t,this.parent.settings.classControl,true);var n=BX.Filter.Utils.getByClass(t,this.parent.settings.classSquare,true);(n||[]).forEach(BX.remove);(e||[]).forEach(function(t){t&&"value"in t&&(t.value="")},this)}},getField:function(t){var e;if(BX.type.isDomNode(t)){e=BX.findParent(t,{"class":this.parent.settings.classField},true,false);if(!BX.type.isDomNode(e)){e=BX.findParent(t,{"class":this.parent.settings.classFieldGroup},true,false)}}return e},render:function(t,e){var n,i,a,l;if(BX.type.isPlainObject(e)&&BX.type.isNotEmptyString(t)){n=Object.keys(e);n.forEach(function(n){l="{{"+n+"}}";t=t.replace(new RegExp(l,"g"),e[n])});a=BX.create("div",{html:t});i=BX.Filter.Utils.getByClass(a,this.parent.settings.classFieldGroup);if(!BX.type.isDomNode(i)){i=BX.Filter.Utils.getByClass(a,this.parent.settings.classField)}if(!BX.type.isDomNode(i)){i=BX.Filter.Utils.getByClass(a,this.parent.settings.classFieldLine)}}return i},createInputText:function(t){var e={block:"main-ui-control-field",mix:this.parent.getParam("ENABLE_LABEL")?[this.parent.settings.classFieldWithLabel]:null,deleteButton:true,valueDelete:true,name:t.NAME,type:t.TYPE,label:this.parent.getParam("ENABLE_LABEL")?t.LABEL:"",dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),content:[{block:"main-ui-control-string",name:t.NAME,placeholder:t.PLACEHOLDER||"",value:t.VALUE,tabindex:t.TABINDEX}]};return BX.decl(e)},createCustomEntity:function(t){var e,n;var i={block:"main-ui-control-field",mix:this.parent.getParam("ENABLE_LABEL")?[this.parent.settings.classFieldWithLabel]:null,deleteButton:true,valueDelete:true,name:t.NAME,type:t.TYPE,label:this.parent.getParam("ENABLE_LABEL")?t.LABEL:"",dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),content:{block:"main-ui-control-entity",mix:"main-ui-control",attrs:{"data-multiple":JSON.stringify(t.MULTIPLE)},content:[]}};if("_label"in t.VALUES&&!!t.VALUES._label){if(t.MULTIPLE){var a=!!t.VALUES._label?t.VALUES._label:[];if(BX.type.isPlainObject(a)){a=Object.keys(a).map(function(t){return a[t]})}a.forEach(function(e,n){i.content.content.push({block:"main-ui-square",tag:"span",name:e,item:{_label:e,_value:t.VALUES._value[n]}})})}else{i.content.content.push({block:"main-ui-square",tag:"span",name:"_label"in t.VALUES?t.VALUES["_label"]:"",item:t.VALUES})}}i.content.content.push({block:"main-ui-square-search",tag:"span",content:{block:"main-ui-control-string",name:t.NAME+"_label",tabindex:t.TABINDEX,type:"text",placeholder:t.PLACEHOLDER||""}},{block:"main-ui-control-string",name:t.NAME,type:"hidden",placeholder:t.PLACEHOLDER||"",value:"_value"in t.VALUES?t.VALUES["_value"]:"",tabindex:t.TABINDEX});i=BX.decl(i);e=BX.Filter.Utils.getBySelector(i,'.main-ui-control-string[type="text"]');BX.addClass(e,"main-ui-square-search-item");BX.bind(e,"focus",BX.proxy(this._onCustomEntityInputFocus,this));BX.bind(e,"click",BX.proxy(this._onCustomEntityInputClick,this));if(!this.bindDocument){BX.bind(document,"click",BX.proxy(this._onCustomEntityBlur,this));document.addEventListener("focus",BX.proxy(this._onDocumentFocus,this),true);this.bindDocument=true}BX.bind(e,"keydown",BX.proxy(this._onCustomEntityKeydown,this));BX.bind(i,"click",BX.proxy(this._onCustomEntityFieldClick,this));return i},_onCustomEntityInputFocus:function(t){BX.fireEvent(t.currentTarget,"click")},_onCustomEntityInputClick:function(t){var e,n,i,a;t.preventDefault();t.stopPropagation();if(t.isTrusted){this.trustTimestamp=t.timeStamp;this.notTrustTimestamp=this.notTrustTimestamp||t.timeStamp}else{this.notTrustTimestamp=t.timeStamp}e=new Date(this.trustTimestamp);n=new Date(this.notTrustTimestamp);i=e.getMinutes()+":"+e.getSeconds();a=n.getMinutes()+":"+n.getSeconds();if(i!==a){this._onCustomEntityFocus(t)}},_onDocumentFocus:function(t){var e=false;if(this.lastLabelInput&&t.target!==this.lastLabelInput){if(BX.type.isArray(this.popupInputs)&&this.popupInputs.length){e=this.popupInputs.some(function(e){return e===t.target})}if(!e){this._onCustomEntityBlur(t)}}},_onCustomEntityKeydown:function(t){var e=BX.Filter.Utils.getByClass(t.target.parentNode.parentNode,this.parent.settings.classSquare,true);var n=null;if(e.length){n=e[e.length-1]}if(BX.Filter.Utils.isKey(t,"backspace")&&t.currentTarget.selectionStart===0){if(BX.type.isDomNode(n)){if(BX.hasClass(n,this.parent.settings.classSquareSelected)){BX.remove(n);var i=BX.Filter.Utils.getBySelector(t.target.parentNode.parentNode,'input[type="hidden"]');i.value="";BX.fireEvent(i,"input")}else{BX.addClass(n,this.parent.settings.classSquareSelected)}}}else if(BX.type.isDomNode(n)&&BX.hasClass(n,this.parent.settings.classSquareSelected)){BX.removeClass(n,this.parent.settings.classSquareSelected)}},_onCustomEntityFieldClick:function(t){var e;if(BX.hasClass(t.target,this.parent.settings.classSquareDelete)){e=BX.findParent(t.target,{className:this.parent.settings.classSquare},true,false);if(BX.type.isDomNode(e)){var n=this.getCustomEntityInstance();BX.onCustomEvent(window,"BX.Main.Filter:customEntityRemove",[n]);BX.remove(e)}}else{var i=BX.Filter.Utils.getBySelector(t.target,'input[type="text"]');BX.fireEvent(i,"focus")}},_onCustomEntityBlur:function(t){var e={stopBlur:false};BX.onCustomEvent(window,"BX.Main.Filter:onGetStopBlur",[t,e]);if(typeof e.stopBlur=="undefined"||!e.stopBlur){var n=this.getCustomEntityInstance();this.lastLabelInput=null;BX.onCustomEvent(window,"BX.Main.Filter:customEntityBlur",[n]);BX.unbind(n.getPopupContainer(),"click",this._stopPropagation);this.popupInputs=null;BX.removeClass(n.getField(),this.parent.settings.classFocus)}},_stopPropagation:function(t){t.stopPropagation()},getCustomEntityInstance:function(){if(!(this.customEntityInstance instanceof BX.Main.ui.CustomEntity)){this.customEntityInstance=new BX.Main.ui.CustomEntity}return this.customEntityInstance},_onCustomEntityFocus:function(t){var e=BX.findParent(t.currentTarget,{className:"main-ui-control-entity"},true,false);var n=this.getCustomEntityInstance();t.stopPropagation();n.setField(e);this.lastLabelInput=n.getLabelNode();BX.onCustomEvent(window,"BX.Main.Filter:customEntityFocus",[n]);var i=n.getPopupContainer();if(BX.type.isElementNode(i)){BX.bind(i,"click",this._stopPropagation);this.popupInputs=i.querySelectorAll("input,a,div");this.popupInputs=Array.prototype.slice.call(this.popupInputs)}BX.addClass(e,this.parent.settings.classFocus)},createCustom:function(t){var e,n,i;var a=[];t.VALUE=BX.util.htmlspecialcharsback(t.VALUE);a.push("main-ui-control");a.push("main-ui-custom-style");i=BX.decl({block:"main-ui-control-field",mix:this.parent.getParam("ENABLE_LABEL")?[this.parent.settings.classFieldWithLabel]:null,name:t.NAME,type:t.TYPE,deleteButton:true,label:this.parent.getParam("ENABLE_LABEL")?t.LABEL:"",dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),content:{block:"main-ui-custom",mix:a,attrs:{"data-name":t.NAME},content:""}});n='name="'+t.NAME+'" value="'+("_VALUE"in t?t._VALUE:"")+'"';e=BX.Filter.Utils.getByClass(i,"main-ui-custom");try{t.VALUE=t.VALUE.replace('name="'+t.NAME+'"',n)}catch(l){}BX.html(e,t.VALUE);return i},createSelect:function(t){return BX.decl({block:"main-ui-control-field",mix:this.parent.getParam("ENABLE_LABEL")?[this.parent.settings.classFieldWithLabel]:null,name:t.NAME,type:t.TYPE,deleteButton:true,label:this.parent.getParam("ENABLE_LABEL")?t.LABEL:"",dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),content:{block:this.parent.settings.classSelect,name:t.NAME,items:t.ITEMS,value:"VALUE"in t?t.VALUE:t.ITEMS[0],params:t.PARAMS,tabindex:t.TABINDEX,valueDelete:false}})},createMultiSelect:function(t){return BX.decl({block:"main-ui-control-field",mix:this.parent.getParam("ENABLE_LABEL")?[this.parent.settings.classFieldWithLabel]:null,name:t.NAME,type:t.TYPE,deleteButton:true,label:this.parent.getParam("ENABLE_LABEL")?t.LABEL:"",dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),content:{block:"main-ui-multi-select",name:t.NAME,tabindex:"TABINDEX"in t?t.TABINDEX:"",placeholder:!this.parent.getParam("ENABLE_LABEL")&&"PLACEHOLDER"in t?t.PLACEHOLDER:"",items:"ITEMS"in t?t.ITEMS:[],value:"VALUE"in t?t.VALUE:[],params:"PARAMS"in t?t.PARAMS:{isMulti:true},valueDelete:true}})},_onDateTypeChange:function(t,e){var n={};var i=null;var a,l,s,r,E,o,u,c;if(BX.type.isPlainObject(e)&&"VALUE"in e){r=BX.data(t.getNode(),"name");l=t.getParams();if(!BX.type.isPlainObject(l)&&(r.indexOf("_datesel")!==-1||r.indexOf("_numsel")!==-1)){a=t.getNode().parentNode.parentNode;n.TABINDEX=t.getInput().getAttribute("tabindex");n.SUB_TYPES=t.getItems();n.SUB_TYPE=e;n.NAME=BX.data(a,"name");n.TYPE=BX.data(a,"type");o=this.parent.getPreset().getCurrentPresetData();if("FIELDS"in o&&o.FIELDS.length){u=o.FIELDS.filter(function(t){return t.NAME===n.NAME},this);if(u.length){u=u[0];if(r.indexOf("_datesel")!==-1){n.MONTHS=u.MONTHS;n.MONTH=u.MONTH;n.YEARS=u.YEARS;n.YEAR=u.YEAR;n.QUARTERS=u.QUARTERS;n.QUARTER=u.QUARTER;n.ENABLE_TIME=u.ENABLE_TIME}n.VALUES=u.VALUES}}if(this.parent.getParam("ENABLE_LABEL")){s=BX.Filter.Utils.getByClass(a,this.parent.settings.classFieldLabel);n.LABEL=s.innerText}if(r.indexOf("_datesel")!==-1){i=this.createDate(n)}else{i=this.createNumber(n)}if(BX.type.isArray(this.parent.fieldsList)){c=this.parent.fieldsList.indexOf(a);if(c!==-1){this.parent.fieldsList[c]=i;this.parent.registerDragItem(i)}}this.parent.unregisterDragItem(a);E=BX.Filter.Utils.getByClass(i,this.parent.settings.classField,true);if(BX.type.isArray(E)&&E.length){E.forEach(function(t){t.FieldController=new BX.Filter.FieldController(t,this.parent)},this)}BX.insertAfter(i,a);BX.remove(a)}}},createNumber:function(t){var e,n,i,a,l,s;var r=this.parent.numberTypes;var E=r.SINGLE;if("SUB_TYPE"in t&&BX.type.isPlainObject(t.SUB_TYPE)){E=t.SUB_TYPE.VALUE;i="PLACEHOLDER"in t.SUB_TYPE?t.SUB_TYPE.PLACEHOLDER:""}t.NAME=t.NAME.replace("_numsel","");e={block:"number-group",type:t.TYPE,mix:this.parent.getParam("ENABLE_LABEL")?[this.parent.settings.classFieldWithLabel,"main-ui-filter-number-group"]:["main-ui-filter-number-group"],label:this.parent.getParam("ENABLE_LABEL")?t.LABEL:"",dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),tabindex:"TABINDEX"in t?t.TABINDEX:"",value:"SUB_TYPE"in t?t.SUB_TYPE:{},items:"SUB_TYPES"in t?t.SUB_TYPES:[],name:"NAME"in t?t.NAME:"",deleteButton:true,content:[]};if(E!==r.LESS){a={block:"main-ui-control-field",type:t.TYPE,dragButton:false,content:{block:"main-ui-number",mix:["filter-type-single"],calendarButton:true,valueDelete:true,placeholder:i,name:"NAME"in t?t.NAME+"_from":"",tabindex:"TABINDEX"in t?t.TABINDEX:"",value:"VALUES"in t?t.VALUES._from:""}};e.content.push(a)}if(E===r.RANGE){l={block:"main-ui-filter-field-line",content:{block:"main-ui-filter-field-line-item",tag:"span"}};e.content.push(l)}if(E===r.RANGE||E===r.LESS){s={block:"main-ui-control-field",type:t.TYPE,dragButton:false,content:{block:"main-ui-number",calendarButton:true,valueDelete:true,name:"NAME"in t?t.NAME+"_to":"",tabindex:"TABINDEX"in t?t.TABINDEX:"",value:"VALUES"in t?t.VALUES._to:""}}}e.content.push(s);return BX.decl(e)},createDate:function(t){var e,n,i,a,l,s,r,E,o;var u=this.parent.dateTypes;var c=u.NONE;if("SUB_TYPE"in t&&BX.type.isPlainObject(t.SUB_TYPE)){c=t.SUB_TYPE.VALUE;s="PLACEHOLDER"in t.SUB_TYPE?t.SUB_TYPE.PLACEHOLDER:""}t.NAME=t.NAME.replace("_datesel","");if("VALUES"in t&&BX.type.isPlainObject(t.VALUES)){var A=Object.keys(t.VALUES);A.forEach(function(e){if(!t.VALUES[e]){t.VALUES[e]=""}})}e={block:"date-group",type:t.TYPE,mix:this.parent.getParam("ENABLE_LABEL")?[this.parent.settings.classFieldWithLabel,"main-ui-filter-date-group"]:["main-ui-filter-date-group"],label:this.parent.getParam("ENABLE_LABEL")?t.LABEL:"",dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),tabindex:"TABINDEX"in t?t.TABINDEX:"",value:"SUB_TYPE"in t?t.SUB_TYPE:{},items:"SUB_TYPES"in t?t.SUB_TYPES:[],name:"NAME"in t?t.NAME:"",enableTime:"ENABLE_TIME"in t?t.ENABLE_TIME:false,deleteButton:true,content:[]};t.NAME=t.NAME.replace("_datesel","");if(c===u.EXACT){a={block:"main-ui-control-field",type:t.TYPE,dragButton:false,content:{block:"main-ui-date",mix:["filter-type-single"],calendarButton:true,valueDelete:true,placeholder:s,name:"NAME"in t?t.NAME+"_from":"",tabindex:"TABINDEX"in t?t.TABINDEX:"",value:"VALUES"in t?t.VALUES._from:"",enableTime:t.ENABLE_TIME}};e.content.push(a)}if(c===u.NEXT_DAYS||c===u.PREV_DAYS){a={block:"main-ui-control-field",type:t.TYPE,dragButton:false,content:{block:"main-ui-number",mix:["filter-type-single"],calendarButton:true,valueDelete:true,placeholder:s,name:"NAME"in t?t.NAME+"_days":"",tabindex:"TABINDEX"in t?t.TABINDEX:"",value:"VALUES"in t?t.VALUES._days:""}};e.content.push(a)}if(c===u.RANGE){n={block:"main-ui-control-field",type:t.TYPE,dragButton:false,content:{block:"main-ui-date",calendarButton:true,valueDelete:true,name:"NAME"in t?t.NAME+"_from":"",tabindex:"TABINDEX"in t?t.TABINDEX:"",value:"VALUES"in t?t.VALUES._from:"",placeholder:s,enableTime:t.ENABLE_TIME}};l={block:"main-ui-filter-field-line",content:{block:"main-ui-filter-field-line-item",tag:"span"}};i={block:"main-ui-control-field",type:t.TYPE,dragButton:false,content:{block:"main-ui-date",calendarButton:true,valueDelete:true,name:"NAME"in t?t.NAME+"_to":"",tabindex:"TABINDEX"in t?t.TABINDEX:"",value:"VALUES"in t?t.VALUES._to:"",placeholder:s,enableTime:t.ENABLE_TIME}};e.content.push(n);e.content.push(l);e.content.push(i)}if(c===u.MONTH){if("_month"in t.VALUES&&t.VALUES._month){t.MONTH=t.MONTHS.filter(function(e){return e.VALUE===t.VALUES._month});t.MONTH=t.MONTH.length?t.MONTH[0]:null}if(!t.MONTH){t.MONTH=t.MONTHS[0]}o={block:"main-ui-control-field",dragButton:false,content:{block:"main-ui-select",tabindex:"tabindex"in t?t.tabindex:"",value:t.MONTH,items:t.MONTHS,name:t.NAME+"_month",valueDelete:false}};if("_year"in t.VALUES&&t.VALUES._year){t.YEAR=t.YEARS.filter(function(e){return e.VALUE===t.VALUES._year});t.YEAR=t.YEAR.length?t.YEAR[0]:null}if(!t.YEAR){t.YEAR=t.YEARS[0]}r={block:"main-ui-control-field",dragButton:false,content:{block:"main-ui-select",tabindex:"tabindex"in t?t.tabindex:"",value:t.YEAR,items:t.YEARS,name:t.NAME+"_year",valueDelete:false}};e.content.push(o);e.content.push(r)}if(c===u.QUARTER){if("_year"in t.VALUES&&t.VALUES._year){t.YEAR=t.YEARS.filter(function(e){return e.VALUE===t.VALUES._year});t.YEAR=t.YEAR.length?t.YEAR[0]:null}if(!t.YEAR){t.YEAR=t.YEARS[0]}r={block:"main-ui-control-field",dragButton:false,content:{block:"main-ui-select",tabindex:"tabindex"in t?t.tabindex:"",value:t.YEAR,items:t.YEARS,name:t.NAME+"_year",valueDelete:false}};if("_quarter"in t.VALUES&&t.VALUES._quarter){t.QUARTER=t.QUARTERS.filter(function(e){return e.VALUE===t.VALUES._quarter});t.QUARTER=t.QUARTER.length?t.QUARTER[0]:null}if(!t.QUARTER){t.QUARTER=t.QUARTERS[0]}E={block:"main-ui-control-field",dragButton:false,content:{block:"main-ui-select",tabindex:"tabindex"in t?t.tabindex:"",value:t.QUARTER,items:t.QUARTERS,name:t.NAME+"_quarter",params:t.PARAMS,valueDelete:false}};e.content.push(E);e.content.push(r)}if(c===u.YEAR){if("_year"in t.VALUES&&t.VALUES._year){t.YEAR=t.YEARS.filter(function(e){return e.VALUE===t.VALUES._year});t.YEAR=t.YEAR.length?t.YEAR[0]:null}if(!t.YEAR){t.YEAR=t.YEARS[0]}r={block:"main-ui-control-field",dragButton:false,content:{block:"main-ui-select",tabindex:"tabindex"in t?t.tabindex:"",value:t.YEAR,items:t.YEARS,name:t.NAME+"_year",valueDelete:false}};e.content.push(r)}return BX.decl(e)}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:114:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/main-ui-control-custom-entity.min.js?15113164722940";s:6:"source";s:95:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/main-ui-control-custom-entity.js";s:3:"min";s:99:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/main-ui-control-custom-entity.min.js";s:3:"map";s:99:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/main-ui-control-custom-entity.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Main.ui");BX.Main.ui.CustomEntity=function(){this.field=null;this.labelInput=null;this.hiddenInput=null;this.popupContainer=null;this.inputClass="main-ui-control-string";this.squareClass="main-ui-square";this.multiple=null};BX.Main.ui.CustomEntity.isMultiple=function(t){if(!!t&&!BX.hasClass(t,"main-ui-control-entity")){t=BX.Filter.Utils.getByClass(t,"main-ui-control-entity")}return!!t&&JSON.parse(BX.data(t,"multiple"))};BX.Main.ui.CustomEntity.prototype={setField:function(t){if(this.field!==t){this.field=t;this.reset()}},isMultiple:function(){if(this.multiple===null){this.multiple=BX.Main.ui.CustomEntity.isMultiple(this.getField())}return this.multiple},reset:function(){this.labelInput=null;this.hiddenInput=null},getField:function(){return this.field},getId:function(){var t=this.getHiddenNode();var e=null;if(BX.type.isDomNode(t)){e=t.name}return e},getLabelNode:function(){if(!BX.type.isDomNode(this.labelInput)){this.labelInput=BX.Filter.Utils.getBySelector(this.getField(),"."+this.inputClass+'[type="text"]')}return this.labelInput},getHiddenNode:function(){if(!BX.type.isDomNode(this.hiddenInput)){this.hiddenInput=BX.Filter.Utils.getBySelector(this.getField(),"."+this.inputClass+'[type="hidden"]')}return this.hiddenInput},getSquareByValue:function(t){return BX.Filter.Utils.getBySelector(this.getField(),'[data-item*=":'+t+'}"]')},getSquares:function(){return BX.Filter.Utils.getByClass(this.getField(),this.squareClass,true)},removeSquares:function(){this.getSquares().forEach(BX.remove)},setSquare:function(t,e){var i=this.getField();var n={block:"main-ui-square",name:t,item:{_label:t,_value:e}};var s=BX.decl(n);var u=this.getSquares();if(!u.length){BX.prepend(s,i)}else{BX.insertAfter(s,u[u.length-1])}},getCurrentValues:function(){var t=this.getSquares();var e;try{e=JSON.parse(BX.data(t,"item"));e={label:e._label,value:e._value}}catch(i){e={label:"",value:""}}return e},setData:function(t,e){return this.isMultiple()?this.setMultipleData(t,e):this.setSingleData(t,e)},setSingleData:function(t,e){var i=this.getHiddenNode();this.removeSquares();this.setSquare(t,e);if(BX.type.isDomNode(i)){i.value=e;BX.fireEvent(i,"input")}},setMultipleData:function(t,e){var i=[];var n=this.getHiddenNode();if(BX.type.isArray(t)){this.removeSquares();if(BX.type.isArray(t)){t.forEach(function(t){i.push(t.value);this.setSquare(t.label,t.value)},this);if(BX.type.isDomNode(n)){n.value=JSON.stringify(i);BX.fireEvent(n,"input")}}}if(!BX.type.isArray(t)&&e!==null){if(!this.getSquareByValue(e)){this.setSquare(t,e);this.getSquares().forEach(function(t){var e=JSON.parse(BX.data(t,"item"));if(BX.type.isPlainObject(e)){i.push(e._value)}});n.value=JSON.stringify(i);BX.fireEvent(n,"input")}}},setPopupContainer:function(t){if(BX.type.isDomNode(t)){this.popupContainer=t}},getPopupContainer:function(){return this.popupContainer}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:93:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/presets.min.js?151131647214223";s:6:"source";s:73:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/presets.js";s:3:"min";s:77:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/presets.min.js";s:3:"map";s:77:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/presets.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Filter");BX.Filter.Presets=function(e){this.parent=null;this.presets=null;this.container=null;this.init(e)};BX.Filter.Presets.prototype={init:function(e){this.parent=e},bindOnPresetClick:function(){var e=this.getPresets();var t=this;(e||[]).forEach(function(e){BX.bind(e,"click",BX.delegate(t._onPresetClick,t))})},getAddPresetField:function(){return BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classAddPresetField)},getAddPresetFieldInput:function(){return BX.Filter.Utils.getByClass(this.getAddPresetField(),this.parent.settings.classAddPresetFieldInput)},clearAddPresetFieldInput:function(){var e=this.getAddPresetFieldInput();e&&(e.value="")},normalizePreset:function(e){if(!BX.hasClass(e,this.parent.settings.classPreset)){e=BX.findParent(e,{"class":this.parent.settings.classPreset},true,false)}return e},deactivateAllPresets:function(){var e=this.getPresets();var t=this;(e||[]).forEach(function(e){if(BX.hasClass(e,t.parent.settings.classPresetCurrent)){BX.removeClass(e,t.parent.settings.classPresetCurrent)}})},createSidebarItem:function(e,t,s){return BX.decl({block:"sidebar-item",text:BX.util.htmlspecialcharsback(t),id:e,pinned:s,noEditPinTitle:this.parent.getParam("MAIN_UI_FILTER__IS_SET_AS_DEFAULT_PRESET"),editNameTitle:this.parent.getParam("MAIN_UI_FILTER__EDIT_PRESET_TITLE"),removeTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_PRESET"),editPinTitle:this.parent.getParam("MAIN_UI_FILTER__SET_AS_DEFAULT_PRESET"),dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_TITLE")})},activatePreset:function(e){this.deactivateAllPresets();if(BX.type.isNotEmptyString(e)){e=this.getPresetNodeById(e)}if(!BX.hasClass(e,this.parent.settings.classPresetCurrent)){BX.addClass(e,this.parent.settings.classPresetCurrent)}},getPresetNodeById:function(e){var t=this.getPresets();var s=t.filter(function(t){return BX.data(t,"id")===e},this);return s.length>0?s[0]:null},getPresetId:function(e){return BX.data(e,"id")},updatePresetName:function(e,t){var s;if(BX.type.isDomNode(e)&&BX.type.isNotEmptyString(t)){s=this.getPresetNameNode(e);if(BX.type.isDomNode(s)){BX.html(s,t)}}},removePreset:function(e,t,s){var i=this.getCurrentPresetId();var r=[];var a={preset_id:t,is_default:s};var n={FILTER_ID:this.parent.getParam("FILTER_ID"),action:"REMOVE_FILTER"};this.parent.saveOptions(a,n);BX.remove(e);if(BX.type.isArray(this.parent.params["PRESETS"])){r=this.parent.params["PRESETS"].filter(function(e){return e.ID!==t},this);this.parent.params["PRESETS"]=r}if(BX.type.isArray(this.parent.editablePresets)){r=this.parent.editablePresets.filter(function(e){return e.ID!==t},this);this.parent.editablePresets=r}if(t===i){this.parent.getSearch().removePreset();this.resetPreset()}},pinPreset:function(e){if(!BX.type.isNotEmptyString(e)){e="default_filter"}var t=this.getPresetNodeById(e);if(this.parent.getParam("VALUE_REQUIRED_MODE")){if(e=="default_filter"){return}}var s={FILTER_ID:this.parent.getParam("FILTER_ID"),GRID_ID:this.parent.getParam("GRID_ID"),action:"PIN_PRESET"};var i={preset_id:e};this.getPresets().forEach(function(e){BX.removeClass(e,this.parent.settings.classPinnedPreset)},this);BX.addClass(t,this.parent.settings.classPinnedPreset);this.parent.saveOptions(i,s)},_onPresetClick:function(e){var t,s,i,r,a,n,l;e.preventDefault();l=this.parent;n=l.settings;a=e.target;t=e.currentTarget;s=this.getPresetId(t);i=this.getPreset(s);if(BX.hasClass(a,n.classPinButton)){if(this.parent.isEditEnabled()){if(BX.hasClass(t,n.classPinnedPreset)){this.pinPreset("default_filter")}else{this.pinPreset(s)}}}if(BX.hasClass(a,n.classPresetEditButton)){this.enableEditPresetName(t,a)}if(BX.hasClass(a,n.classPresetDeleteButton)){r="IS_DEFAULT"in i?i.IS_DEFAULT:false;this.removePreset(t,s,r);return false}if(!BX.hasClass(a,n.classPresetDragButton)&&!BX.hasClass(a,n.classAddPresetFieldInput)){if(this.parent.isEditEnabled()){this.updateEditablePreset(this.getCurrentPresetId())}this.activatePreset(t);this.applyPreset(s);if(!this.parent.isEditEnabled()){l.applyFilter(null,true);if(e.isTrusted){l.closePopup()}if(l.isAddPresetEnabled()){l.disableAddPreset()}}}},applyPinnedPreset:function(){var e=this.parent;var t=this.isPinned(this.getCurrentPresetId());var s;if(!t){var i=this.getPinnedPresetId();var r=this.getPinnedPresetNode();var a=false;var n=true;this.deactivateAllPresets();this.activatePreset(r);this.applyPreset(i);s=e.applyFilter(a,n);e.closePopup()}else{s=e.resetFilter()}return s},updateEditablePreset:function(e){var t=this.parent.getFilterFieldsValues();var s=this.getFields().map(function(e){return BX.data(e,"name")});var i=this.parent.preparePresetFields(t,s);var r=this.getPreset(e);r.FIELDS=i;r.TITLE=this.getPresetInput(this.getPresetNodeById(e)).value;r.ROWS=s},getPresetInput:function(e){return BX.Filter.Utils.getByClass(e,this.parent.settings.classPresetEditInput)},enableEditPresetName:function(e){var t=this.getPresetInput(e);BX.addClass(e,this.parent.settings.classPresetNameEdit);t.focus();t.value=BX.util.htmlspecialcharsback(t.value);BX.bind(t,"input",BX.delegate(this._onPresetNameInput,this))},_onPresetNameInput:function(e){var t=this.parent.getSearch();var s=e.currentTarget.value;var i=BX.findParent(e.currentTarget,{className:this.parent.settings.classPreset},true,false);var r=this.getPresetId(i);var a=this.getCurrentPresetId();var n={ID:r,TITLE:s};if(r===a){t.updatePreset(n)}},getPresetNameNode:function(e){return BX.Filter.Utils.getByClass(e,this.parent.settings.classPresetName)},disableEditPresetName:function(e){var t=this.getPresetInput(e);BX.removeClass(e,this.parent.settings.classPresetNameEdit);if(BX.type.isDomNode(t)){t.blur();BX.unbind(t,"input",BX.delegate(this._onPresetNameInput,this))}},getPreset:function(e,t){var s=this.parent.getParam(t?"DEFAULT_PRESETS":"PRESETS",[]);if(this.parent.isEditEnabled()&&!t){s=this.parent.editablePresets}var i=s.filter(function(t){return t.ID===e});return i.length!==0?i[0]:null},getPresetField:function(e,t){var s=this.getPreset(e);var i=null;if(BX.type.isPlainObject(s)&&"FIELDS"in s&&BX.type.isArray(s.FIELDS)){i=s.FIELDS.filter(function(e){return e.NAME===t},this);i=i.length?i[0]:null}return i},applyPreset:function(e,t){var s;e=t?"default_filter":e||"default_filter";s=this.getPreset(e);if(e!=="default_preset"){s=this.extendPreset(s)}this.parent.getSearch().updatePreset(s);this.updatePresetFields(s,t)},extendPreset:function(e){var t=BX.clone(this.getPreset("default_filter"));if(BX.type.isPlainObject(e)){e=BX.clone(e);e.FIELDS.forEach(function(e,s){var i;var r=t.FIELDS.some(function(t,s){var r=false;if(t.NAME===e.NAME){i=s;r=true}return r},this);if(r&&i||r&&i===0){t.FIELDS[i]=e}else{if(!this.isEmptyField(e)){t.FIELDS.push(e)}}},this);e.FIELDS=t.FIELDS}return e},isEmptyField:function(e){var t=true;if(e.TYPE===this.parent.types.STRING){if(e.VALUE&&e.VALUE.length){t=false}}if(e.TYPE===this.parent.types.SELECT){if(BX.type.isPlainObject(e.VALUE)&&"VALUE"in e.VALUE&&e.VALUE.VALUE){t=false}}if(e.TYPE===this.parent.types.MULTI_SELECT){if(BX.type.isArray(e.VALUE)&&e.VALUE.length){t=false}}if(e.TYPE===this.parent.types.CUSTOM_ENTITY){if(BX.type.isPlainObject(e.VALUES)&&e.VALUES._label&&e.VALUES._value){t=false}}if(e.TYPE===this.parent.types.DATE){if(BX.type.isPlainObject(e.VALUES)&&(e.VALUES._from||e.VALUES._to||e.VALUES._month||e.VALUES._quarter||e.VALUES._year||e.VALUES._days)||(e.VALUES._datesel===this.parent.dateTypes.CURRENT_DAY||e.VALUES._datesel===this.parent.dateTypes.CURRENT_WEEK||e.VALUES._datesel===this.parent.dateTypes.CURRENT_MONTH||e.VALUES._datesel===this.parent.dateTypes.CURRENT_QUARTER||e.VALUES._datesel===this.parent.dateTypes.LAST_7_DAYS||e.VALUES._datesel===this.parent.dateTypes.LAST_30_DAYS||e.VALUES._datesel===this.parent.dateTypes.LAST_60_DAYS||e.VALUES._datesel===this.parent.dateTypes.LAST_90_DAYS||e.VALUES._datesel===this.parent.dateTypes.LAST_WEEK||e.VALUES._datesel===this.parent.dateTypes.LAST_MONTH)){t=false}}if(e.TYPE===this.parent.types.NUMBER){if(BX.type.isPlainObject(e.VALUES)&&(e.VALUES._from||e.VALUES._to)){t=false}}if(e.TYPE===this.parent.types.CHECKBOX){if(BX.type.isPlainObject(e.VALUE)&&e.VALUE.VALUE){t=false}}return t},resetPreset:function(e){this.applyPreset(null,e)},getFields:function(){var e=this.parent.getFieldListContainer();var t=null;if(BX.type.isDomNode(e)){t=BX.Filter.Utils.getBySelector(e.parentNode,"."+this.parent.settings.classFileldControlList+" > div",true)}return t},getField:function(e){var t=this.getFields();var s=null;var i,r;if(BX.type.isArray(t)&&t.length){r=t.filter(function(t){if(BX.type.isDomNode(t)){i=BX.data(t,"name")}return i===e.NAME},this);s=r.length>0?r[0]:null}return s},removeField:function(e){var t,s;if(BX.type.isPlainObject(e)){s=e.NAME;e=this.getField(e);if(BX.type.isArray(this.parent.fieldsList)){t=this.parent.fieldsList.indexOf(e);if(t!==-1){delete this.parent.fieldsList[t]}}this.parent.unregisterDragItem(e)}if(BX.type.isDomNode(e)){s=BX.data(e,"name");this.parent.getFields().deleteField(e)}if(!this.parent.isEditEnabled()&&!this.parent.isAddPresetEnabled()){var i=this.getCurrentPresetId();var r=this.getPresetField(i,s);if(r&&!this.isEmptyField(r)){this.deactivateAllPresets();this.parent.applyFilter()}}this.parent.saveFieldsSort()},addField:function(e){var t,s,i;if(BX.type.isPlainObject(e)){t=this.parent.getFieldListContainer();i=this.parent.getControls();s=BX.type.isArray(i)?i[i.length-1]:null;if(BX.type.isDomNode(s)){if(s.nodeName!=="INPUT"){s=BX.Filter.Utils.getByTag(s,"input")}if(BX.type.isDomNode(s)){e.TABINDEX=parseInt(s.getAttribute("tabindex"))+1}}else{e.TABINDEX=2}if(BX.type.isDomNode(t)){s=this.createControl(e);if(BX.type.isDomNode(s)){BX.append(s,t);if(BX.type.isArray(this.parent.fieldsList)){this.parent.fieldsList.push(s)}this.parent.registerDragItem(s)}}}if(!this.parent.isEditEnabled()&&!this.parent.isAddPresetEnabled()){var r=this.getCurrentPresetId();var a=this.getPresetField(r,e.NAME);if(a&&!this.isEmptyField(a)){this.parent.updatePreset("tmp_filter");this.deactivateAllPresets();this.parent.getSearch().updatePreset(this.getPreset("tmp_filter"))}}this.parent.saveFieldsSort()},createControl:function(e){var t;switch(e.TYPE){case this.parent.types.STRING:{t=this.parent.getFields().createInputText(e);break}case this.parent.types.SELECT:{t=this.parent.getFields().createSelect(e);break}case this.parent.types.MULTI_SELECT:{t=this.parent.getFields().createMultiSelect(e);break}case this.parent.types.NUMBER:{t=this.parent.getFields().createNumber(e);break}case this.parent.types.DATE:{t=this.parent.getFields().createDate(e);break}case this.parent.types.USER:{t=this.parent.getFields().createUser(e);break}case this.parent.types.ENTITY:{t=this.parent.getFields().createEntity(e);break}case this.parent.types.CUSTOM:{t=this.parent.getFields().createCustom(e);break}case this.parent.types.CUSTOM_ENTITY:{t=this.parent.getFields().createCustomEntity(e);break}default:{break}}if(BX.type.isDomNode(t)){t.dataset.name=e.NAME;t.FieldController=new BX.Filter.FieldController(t,this.parent)}return t},removeNotCompareVariables:function(e){if("FIND"in e){delete e.FIND}},isPresetValuesModified:function(e){var t=this.getPreset(e);var s=this.parent.preparePresetSettingsFields(t.FIELDS,t.ROWS);var i=this.parent.getFilterFieldsValues();this.removeNotCompareVariables(s);this.removeNotCompareVariables(i);var r=BX.Filter.Utils.sortObject(s);var a=BX.Filter.Utils.sortObject(i);return!BX.Filter.Utils.objectsIsEquails(r,a)},getAdditionalValues:function(e){var t=this.getPreset(e);var s=this.parent.preparePresetSettingsFields(t.FIELDS,t.ROWS);var i=this.parent.getFilterFieldsValues();this.removeNotCompareVariables(s);this.removeNotCompareVariables(i);this.removeSameProperties(i,s);return i},removeSameProperties:function(e,t){var s=Object.keys(e);s.forEach(function(s){if(s in t){if(BX.type.isPlainObject(e[s])){var i=BX.Filter.Utils.sortObject(e);var r=BX.Filter.Utils.sortObject(t);if(!BX.Filter.Utils.objectsIsEquails(i,r)){e[s]=this.removeSameProperties(e[s],t[s])}else{delete e[s]}}else{delete e[s]}}},this);return e},updatePresetFields:function(e,t){var s,i;var r=[];if(BX.type.isPlainObject(e)&&"FIELDS"in e){s=e.FIELDS;(s||[]).forEach(function(e,s){e.TABINDEX=s+1;if(t){switch(e.TYPE){case this.parent.types.SELECT:{e.VALUE=e.ITEMS[0];break}case this.parent.types.MULTI_SELECT:{e.VALUE=[];break}case this.parent.types.DATE:{e.SUB_TYPE=e.SUB_TYPES[0];e.VALUES={_from:"",_to:"",_days:""};break}case this.parent.types.NUMBER:{e.SUB_TYPE=e.SUB_TYPES[0];e.VALUES={_from:"",_to:""};break}case this.parent.types.CUSTOM_ENTITY:{e.VALUES={_label:"",_value:""};break}case this.parent.types.CUSTOM:{e._VALUE="";break}default:{if("VALUE"in e){if(BX.type.isArray(e.VALUE)){e.VALUE=[]}else{e.VALUE=""}}break}}}r.push(this.createControl(e))},this);this.parent.disableFieldsDragAndDrop();i=this.parent.getFieldListContainer();BX.cleanNode(i);if(r.length){r.forEach(function(e){if(BX.type.isDomNode(e)){BX.append(e,i)}});this.parent.enableFieldsDragAndDrop()}}},showCurrentPresetFields:function(){var e=this.getCurrentPresetData();this.updatePresetFields(e)},getCurrentPreset:function(){return BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classPresetCurrent)},getCurrentPresetId:function(){var e=this.getCurrentPreset();var t=null;if(BX.type.isDomNode(e)){t=this.getPresetId(e)}else{t="default_filter"}return t},getCurrentPresetData:function(){var e=this.getCurrentPresetId();var t=null;if(BX.type.isNotEmptyString(e)){t=this.getPreset(e);t=this.extendPreset(t)}return t},getContainer:function(){return BX.Filter.Utils.getByClass(this.parent.getFilter(),this.parent.settings.classPresetsContainer)},getPresets:function(){return BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classPreset,true)},getDefaultPresets:function(){return BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classDefaultFilter,true)},getPinnedPresetNode:function(){return BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classPinnedPreset)},isPinned:function(e){return this.getPinnedPresetId()===e},getPinnedPresetId:function(){var e=this.getPinnedPresetNode();var t="default_filter";if(!!e){var s=BX.data(e,"id");t=!!s?s:t}return t}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:92:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/search.min.js?151131647215840";s:6:"source";s:72:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/search.js";s:3:"min";s:76:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/search.min.js";s:3:"map";s:76:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/search.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Filter");BX.Filter.Search=function(t){this.parent=null;this.container=null;this.input=null;this.preset=null;this.buttonsContainer=null;this.delay=800;this.timeout=null;this.init(t)};BX.Filter.Search.prototype={init:function(t){this.parent=t;BX.bind(this.getInput(),"input",BX.delegate(this._onInputWithoutDebounce,this));if(this.parent.getParam("ENABLE_LIVE_SEARCH")){BX.bind(this.getInput(),"input",BX.debounce(this._onInput,this.delay,this))}BX.bind(this.getInput(),"keydown",BX.delegate(this._onKeyDown,this));BX.bind(this.getFindButton(),"click",BX.delegate(this._onSearchClick,this));BX.bind(this.getContainer(),"click",BX.delegate(this._onSearchContainerClick,this));this.firstInit=true},getFindButton:function(){if(!BX.type.isDomNode(this.findButton)){this.findButton=BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classSearchButton)}return this.findButton},_onSearchClick:function(){this.apply()},selectSquare:function(t){!!t&&BX.addClass(t,this.parent.settings.classSquareSelected)},selectSquares:function(){this.getSquares().forEach(this.selectSquare,this)},unselectSquare:function(t){!!t&&BX.removeClass(t,this.parent.settings.classSquareSelected)},unselectSquares:function(){this.getSquares().forEach(this.unselectSquare,this)},removeSquares:function(){this.getSquares().forEach(this.removeSquare,this)},isSquaresSelected:function(){return this.getSquares().every(this.isSquareSelected,this)},isSquareSelected:function(t){return!!t&&BX.hasClass(t,this.parent.settings.classSquareSelected)},getLastSquare:function(){var t=this.getSquares();return!!t?t[t.length-1]:null},isTextSelected:function(){var t=this.getSearchString().length;var e=this.getInput();var s=e.selectionStart;var i=e.selectionEnd;return s===0&&i===t},isSelectionStart:function(){var t=this.getInput();var e=t.selectionStart;var s=t.selectionEnd;return e===0&&s===0},isSquareRemoveButton:function(t){return!!t&&BX.hasClass(t,this.parent.settings.classSquareDelete)},isClearButton:function(t){return!!t&&BX.hasClass(t,this.parent.settings.classClearSearchValueButton)},isSearchButton:function(t){return!!t&&BX.hasClass(t,this.parent.settings.classSearchButton)},adjustFocus:function(){var t=this.getInput();if(document.activeElement!==t&&window.scrollY<BX.pos(t).top){t.value=t.value;t.blur();t.focus()}},findSquareByChild:function(t){return BX.findParent(t,{className:this.parent.settings.classSquare},true,false)},getSquareData:function(t){var e=BX.data(t,"item");return!!t&&!!e?JSON.parse(e):null},isSquareControl:function(t){var e=this.getSquareData(t);return!!e&&(e.type==="control"||BX.type.isArray(e))},onPresetSquareRemove:function(){var t=this.parent;var e=t.getPreset();var s=e.getCurrentPresetId();var i=t.getParam("RESET_TO_DEFAULT_MODE");var r=e.isPinned(s);if(i&&r||!i){var a=true;this.lastPromise=t.resetFilter(a);t.closePopup()}if(i&&!r){this.lastPromise=t.getPreset().applyPinnedPreset()}},onControlSquareRemove:function(t){var e=this.parent;var s=e.getParam("RESET_TO_DEFAULT_MODE");if(s&&this.getSquares().length===1){this.lastPromise=e.getPreset().applyPinnedPreset()}else{var i=this.getSquareData(t);e.clearControls(i);e.closePopup();this.apply()}},onValueRequiredSquareRemove:function(){var t=this.parent;t.getPreset().deactivateAllPresets();t.showPopup();this.adjustPlaceholder()},complexSquareRemove:function(t){var e=this.parent.getParam("VALUE_REQUIRED_MODE");var s=!this.isSquareControl(t);if(e){this.onValueRequiredSquareRemove()}else{if(s){this.onPresetSquareRemove()}else{this.onControlSquareRemove(t)}}this.removeSquare(t);this.adjustClearButton()},adjustClearButton:function(){!!this.getLastSquare()?this.showClearButton():this.hideClearButton()},removeSquare:function(t){!!t&&BX.remove(t)},_onSearchContainerClick:function(t){var e=this.parent;if(this.isClearButton(t.target)){if(!e.getParam("VALUE_REQUIRED_MODE")){if(e.getParam("RESET_TO_DEFAULT_MODE")){this.clearInput();this.lastPromise=e.getPreset().applyPinnedPreset()}else{e.resetFilter()}e.closePopup();this.adjustFocus()}else{this.removeSquares();e.showPopup();this.adjustPlaceholder();this.hideClearButton();e.getPreset().deactivateAllPresets()}}else if(this.isSearchButton(t.target)){this.apply();this.adjustFocus()}else if(this.isSquareRemoveButton(t.target)){var s=this.findSquareByChild(t.target);this.complexSquareRemove(s);this.adjustFocus()}else{if(!e.getPopup().isShown()){e.showPopup()}else{var i=this.getInput();var r=i.selectionStart;var a=i.selectionEnd;var n=this.getSearchString().length;if(!(n&&r===0&&a===n)){e.closePopup();if(e.getParam("VALUE_REQUIRED_MODE")){e.restoreRemovedPreset()}}}}},_onKeyDown:function(t){var e=BX.Filter.Utils;var s=this.parent;if(e.isKey(t,"enter")){this.apply();s.closePopup()}if(e.isKey(t,"tab")||e.isKey(t,"downArrow")){s.showPopup();s.adjustFocus();this.unselectSquares()}if(e.isKey(t,"upArrow")){s.closePopup();s.getParam("VALUE_REQUIRED_MODE")&&this.parent.restoreRemovedPreset()}if(e.isKey(t,"a")&&t.metaKey||e.isKey(t,"a")&&t.ctrlKey){this.selectSquares()}if(e.isKey(t,"backspace")&&this.isTextSelected()&&this.isSquaresSelected()){clearTimeout(this.timeout);if(this.parent.getParam("RESET_TO_DEFAULT_MODE")){this.lastPromise=this.parent.getPreset().applyPinnedPreset()}else{this.lastPromise=this.parent.resetFilter()}this.parent.closePopup()}if(e.isKey(t,"backspace")&&this.isSelectionStart()){clearTimeout(this.timeout);var i=this.getLastSquare();this.isSquareSelected(i)?this.complexSquareRemove(i):this.selectSquare(i)}if(!e.isKey(t,"backspace")&&!t.metaKey&&this.isSquaresSelected()){this.unselectSquares()}},getSearchString:function(){var t=this.getInput();return!!t?t.value:""},getSquares:function(){return BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classSquare,true)},adjustPlaceholder:function(){this.setInputPlaceholder(this.parent.getParam("MAIN_UI_FILTER__PLACEHOLDER"+(this.parent.getParam("DISABLE_SEARCH")||!this.parent.settings.get("SEARCH")?"":"_DEFAULT")))},isResolvedRequest:function(){return!this.lastPromise||!!this.lastPromise&&this.lastPromise.state},apply:function(){if(this.isResolvedRequest()){this.lastPromise=this.parent.applyFilter(null,true)}return this.lastPromise},reset:function(){if(this.isResolvedRequest()){this.parent.getSearch().removePreset();this.parent.getPreset().deactivateAllPresets();this.parent.getPreset().resetPreset(true);this.timeout=setTimeout(BX.delegate(function(){this.lastPromise=this.parent.resetFilter()},this),this.delay)}return this.lastPromise},_onInputWithoutDebounce:function(){clearTimeout(this.timeout);var t=this.getSearchString();this.lastSearchString=!!this.lastSearchString?this.lastSearchString:t;if(t!==this.lastSearchString&&(!this.parent.isIe()||!this.firstInit)){if(this.parent.getParam("ENABLE_LIVE_SEARCH")){this.parent.showGridAnimation();BX.onCustomEvent(window,"BX.Filter.Search:input",[this.parent.params.FILTER_ID,t])}this.parent.getPopup().isShown()&&this.parent.closePopup()}if(t){this.showClearButton()}else{if(!this.getSquares().length&&this.lastSearchString!==t){this.hideClearButton();this.adjustPlaceholder()}}},_onInput:function(){var t=this.getSearchString();if(t!==this.lastSearchString&&(!this.parent.isIe()||!this.firstInit)){this.apply()}this.firstInit=false;this.lastSearchString=t},getButtonsContainer:function(){if(!BX.type.isDomNode(this.buttonsContainer)){this.buttonsContainer=BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classSearchButtonsContainer)}return this.buttonsContainer},showClearButton:function(){BX.addClass(this.getButtonsContainer(),this.parent.settings.classShow)},hideClearButton:function(){BX.removeClass(this.getButtonsContainer(),this.parent.settings.classShow)},getInput:function(){var t;if(!BX.type.isDomNode(this.input)){t=[this.parent.getParam("FILTER_ID",""),"_search"].join("");this.input=BX(t)}return this.input},getContainer:function(){var t;if(!BX.type.isDomNode(this.container)){t=[this.parent.getParam("FILTER_ID"),"_search_container"].join("");this.container=BX(t)}return this.container},setInputPlaceholder:function(t){var e=this.getInput();e.placeholder=t},clearInput:function(){var t=this.getInput();if(BX.type.isDomNode(t)){t.value=null}},clearForm:function(){this.clearInput();this.removePreset()},makeSquares:function(t,e,s){var i;var r=null;var a=this.getContainer();var n={squares:[],moreSquares:[]};t.forEach(function(t,o){if(o<e){i=BX.decl(t);r=r||i;if(!s){if(o===0){BX.prepend(i,a)}else{BX.insertAfter(i,r)}}else{var u=BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classSquare);if(u){BX.insertAfter(i,u)}else{BX.prepend(i,a)}}r=i;n.squares.push(i)}else{n.moreSquares.push({type:"control",name:t.value,title:t.title})}},this);return n},squares:function(t,e,s){var i,r,a,n,o;var u=BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classSquare,true);if(s){u.forEach(function(t){var e=BX.data(t,"item");if(e){BX.remove(t)}})}else{u.forEach(BX.remove)}i=this.prepareSquaresData(t);r=this.makeSquares(i,e,s);n=0;o={squaresData:i,width:0};if(r.moreSquares.length){a={block:"main-ui-search-square",name:this.parent.getParam("MAIN_UI_FILTER__AND")+" "+this.parent.getParam("MAIN_UI_FILTER__MORE")+" "+r.moreSquares.length,item:r.moreSquares,title:r.moreSquares.map(function(t){return t.title}).join(", \n")};a=BX.decl(a);r.squares.push(a);BX.insertAfter(a,r.squares[r.squares.length-2]);n=r.squares.reduce(function(t,e){return t+BX.width(e)+(parseFloat(BX.style(e,"margin-right"))||0)},0)}o.width=n;return o},setPreset:function(t){var e=this.getContainer();var s,i;var r;if(BX.type.isPlainObject(t)){i=BX.Filter.Utils.getByClass(e,this.parent.settings.classSquare,true);i.forEach(BX.remove);t=BX.clone(t);t.ADDITIONAL=t.ADDITIONAL||[];BX.onCustomEvent(window,"BX.Filter.Search:beforeSquaresUpdate",[t,this]);if(t.ID!=="default_filter"&&t.ID!=="tmp_filter"){s=BX.decl({block:"main-ui-search-square",name:t.TITLE,value:t.ID,isPreset:true});BX.prepend(s,e);if("ADDITIONAL"in t&&BX.type.isArray(t.ADDITIONAL)&&t.ADDITIONAL.length){r=this.squares(t.ADDITIONAL,1,true);if(BX.width(e)-r.width<100){r=this.squares(t.ADDITIONAL,0,true)}}}else{if("ADDITIONAL"in t&&BX.type.isArray(t.ADDITIONAL)&&t.ADDITIONAL.length){t.ADDITIONAL.forEach(function(e,s){if(!("ID"in e)){e.ID="ADDITIONAL_ID_"+s}if(!("NAME"in e)){e.NAME="ADDITIONAL_NAME_"+s}if(!("TYPE"in e)){e.TYPE="STRING"}if("LABEL"in e&&"LABEL"in e){t.FIELDS.push(e)}})}if(BX.type.isArray(t.FIELDS)&&t.FIELDS.length){r=this.squares(t.FIELDS,2);if(BX.width(e)-r.width<100){r=this.squares(t.FIELDS,1)}}}if(r&&BX.type.isArray(r.squaresData)&&r.squaresData.length||t.ID!=="default_filter"&&t.ID!=="tmp_filter"){this.setInputPlaceholder(this.parent.getParam("MAIN_UI_FILTER__PLACEHOLDER_WITH_FILTER"));this.showClearButton()}else{if(this.parent.getParam("DISABLE_SEARCH")||!this.parent.settings.get("SEARCH")){this.setInputPlaceholder(this.parent.getParam("MAIN_UI_FILTER__PLACEHOLDER"))}else{this.setInputPlaceholder(this.parent.getParam("MAIN_UI_FILTER__PLACEHOLDER_DEFAULT"))}}if(BX.type.isNotEmptyString(this.parent.getSearch().getInput().value)){this.showClearButton()}}},prepareSquaresData:function(t){var e,s,i,r;var a=[];t.map(function(t){e=null;switch(t.TYPE){case this.parent.types.DATE:{e=t.LABEL+": "+t.SUB_TYPE.NAME;if(t.SUB_TYPE.VALUE===this.parent.dateTypes.QUARTER&&BX.type.isNotEmptyString(t.VALUES._quarter)){var r=t.QUARTERS.filter(function(e){return e.VALUE==t.VALUES._quarter}).map(function(t){return t.NAME});r=r.length?r.join(""):"";e=t.LABEL+": "+r+" "+this.parent.getParam("MAIN_UI_FILTER__QUARTER").toLocaleLowerCase()+" "+t.VALUES._year}if(t.SUB_TYPE.VALUE===this.parent.dateTypes.YEAR&&BX.type.isNotEmptyString(t.VALUES._year)){e=t.LABEL+": "+t.VALUES._year}if(t.SUB_TYPE.VALUE===this.parent.dateTypes.MONTH&&BX.type.isNotEmptyString(t.VALUES._month)){var n=t.MONTHS.filter(function(e){return e.VALUE==t.VALUES._month}).map(function(t){return t.NAME});n=n.length?n.join(""):"";e=t.LABEL+": "+n+" "+t.VALUES._year}if(t.SUB_TYPE.VALUE===this.parent.dateTypes.EXACT&&BX.type.isNotEmptyString(t.VALUES._from)){e=t.LABEL+": "+t.VALUES._from}if(t.SUB_TYPE.VALUE===this.parent.dateTypes.RANGE){if(BX.type.isNotEmptyString(t.VALUES._from)&&BX.type.isNotEmptyString(t.VALUES._to)){e=t.LABEL+": "+t.VALUES._from+"-"+t.VALUES._to}else if(!BX.type.isNotEmptyString(t.VALUES._from)&&BX.type.isNotEmptyString(t.VALUES._to)){e=t.LABEL+": "+this.parent.getParam("MAIN_UI_FILTER__BEFORE")+" "+t.VALUES._to}else if(BX.type.isNotEmptyString(t.VALUES._from)&&!BX.type.isNotEmptyString(t.VALUES._to)){e=t.LABEL+": "+this.parent.getParam("MAIN_UI_FILTER__AFTER")+" "+t.VALUES._from}}if((t.SUB_TYPE.VALUE===this.parent.dateTypes.NEXT_DAYS||t.SUB_TYPE.VALUE===this.parent.dateTypes.PREV_DAYS)&&!BX.type.isNumber(parseInt(t.VALUES._days))){e=null}if(t.SUB_TYPE.VALUE===this.parent.dateTypes.NEXT_DAYS&&BX.type.isNumber(parseInt(t.VALUES._days))){e=t.LABEL+": "+this.parent.getParam("MAIN_UI_FILTER__DATE_NEXT_DAYS_LABEL").replace("#N#",t.VALUES._days)}if(t.SUB_TYPE.VALUE===this.parent.dateTypes.PREV_DAYS&&BX.type.isNumber(parseInt(t.VALUES._days))){e=t.LABEL+": "+this.parent.getParam("MAIN_UI_FILTER__DATE_PREV_DAYS_LABEL").replace("#N#",t.VALUES._days)}if(t.SUB_TYPE.VALUE===this.parent.dateTypes.NONE){e=null}break}case this.parent.types.SELECT:{if(BX.type.isPlainObject(t.VALUE)&&t.VALUE.VALUE){e=t.LABEL+": "+t.VALUE.NAME}break}case this.parent.types.MULTI_SELECT:{if(BX.type.isArray(t.VALUE)&&t.VALUE.length){s=[];e=t.LABEL+": ";t.VALUE.forEach(function(t,e){if(e<2){s.push(t.NAME)}});e+=s.join(", ");if(t.VALUE.length>2){i=[];t.VALUE.forEach(function(t){i.push(t.NAME)});e=i.join(", ")}}break}case this.parent.types.NUMBER:{if(t.SUB_TYPE.VALUE==="exact"){if(BX.type.isNotEmptyString(t.VALUES._from)){e=t.LABEL+": "+t.VALUES._from}else{e=null}}if(t.SUB_TYPE.VALUE==="range"){if(BX.type.isNotEmptyString(t.VALUES._from)&&BX.type.isNotEmptyString(t.VALUES._to)){e=t.LABEL+": "+t.VALUES._from+"-"+t.VALUES._to}else if(!BX.type.isNotEmptyString(t.VALUES._from)&&BX.type.isNotEmptyString(t.VALUES._to)){e=t.LABEL+": "+this.parent.getParam("MAIN_UI_FILTER__NUMBER_LESS")+" "+t.VALUES._to}else if(BX.type.isNotEmptyString(t.VALUES._from)&&!BX.type.isNotEmptyString(t.VALUES._to)){e=t.LABEL+": "+this.parent.getParam("MAIN_UI_FILTER__NUMBER_MORE")+" "+t.VALUES._from}else{e=null}}if(t.SUB_TYPE.VALUE==="more"){if(BX.type.isNotEmptyString(t.VALUES._from)){e=t.LABEL+": > ";e+=t.VALUES._from}}if(t.SUB_TYPE.VALUE==="less"){if(BX.type.isNotEmptyString(t.VALUES._to)){e=t.LABEL+": < ";e+=t.VALUES._to}}break}case this.parent.types.CUSTOM_ENTITY:{if(t.MULTIPLE){var o=!!t.VALUES._label?t.VALUES._label:[];if(BX.type.isPlainObject(o)){o=Object.keys(o).map(function(t){return o[t]})}if(o.length){e=t.LABEL+": ";e+=o.join(", ")}}else{if(BX.type.isNotEmptyString(t.VALUES._value)&&BX.type.isNotEmptyString(t.VALUES._label)){e=t.LABEL+": ";e+=t.VALUES._label}}break}case this.parent.types.CUSTOM:{e="_VALUE"in t&&BX.type.isNotEmptyString(t._VALUE)?t.LABEL:null;break}default:{if(BX.type.isNotEmptyString(t.VALUE)){e=t.LABEL+": "+t.VALUE}break}}if(e!==null){a.push({block:"main-ui-search-square",name:e,value:t.NAME,item:{type:"control",name:t.NAME},title:e})}},this);return a},getPreset:function(){var t=this.getContainer();var e=this.parent.settings.classSquare;var s=null;if(BX.type.isDomNode(t)){s=BX.Filter.Utils.getByClass(t,e)}return s},removePreset:function(){var t=this.getPreset();if(BX.type.isDomNode(t)){BX.remove(t);if(this.parent.getParam("DISABLE_SEARCH")||!this.parent.settings.get("SEARCH")){this.setInputPlaceholder(this.parent.getParam("MAIN_UI_FILTER__PLACEHOLDER"))}else{this.setInputPlaceholder(this.parent.getParam("MAIN_UI_FILTER__PLACEHOLDER_DEFAULT"))}}this.hideClearButton()},updatePreset:function(t){this.removePreset();this.setPreset(t)}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:93:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/settings.min.js?15113164724325";s:6:"source";s:74:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/settings.js";s:3:"min";s:78:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/settings.min.js";s:3:"map";s:78:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/settings.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Filter");BX.Filter.Settings=function(i,t){this.classField="main-ui-control-field";this.classFieldGroup="main-ui-control-field-group";this.classFieldLine="main-ui-filter-field-line";this.classFieldDelete="main-ui-filter-field-delete";this.classFieldLabel="main-ui-control-field-label";this.classFieldWithLabel="main-ui-filter-wield-with-label";this.classPresetName="main-ui-filter-sidebar-item-text";this.classControl="main-ui-control";this.classDateInput="main-ui-date-input";this.classHide="main-ui-hide";this.classNumberInput="main-ui-number-input";this.classSelect="main-ui-select";this.classMultiSelect="main-ui-multi-select";this.classValueDelete="main-ui-control-value-delete";this.classStringInput="main-ui-control-string";this.classAddField="main-ui-filter-field-add-item";this.classAddPresetField="main-ui-filter-new-filter";this.classAddPresetFieldInput="main-ui-filter-sidebar-edit-control";this.classAddPresetButton="main-ui-filter-add-item";this.classButtonsContainer="main-ui-filter-field-button-container";this.classSaveButton="main-ui-filter-save";this.classCancelButton="main-ui-filter-cancel";this.classMenuItem="main-ui-select-inner-item";this.classMenuItemText="main-ui-select-inner-item-element";this.classMenuMultiItemText="main-ui-select-inner-label";this.classMenuItemChecked="main-ui-checked";this.classSearchContainer="main-ui-filter-search";this.classDefaultPopup="popup-window";this.classPopupFieldList="main-ui-filter-popup-field-list";this.classPopupFieldList1Column="main-ui-filter-field-list-1-column";this.classPopupFieldList2Column="main-ui-filter-field-list-2-column";this.classPopupFieldList3Column="main-ui-filter-field-list-3-column";this.classFieldListItem="main-ui-filter-field-list-item";this.classEditButton="main-ui-filter-add-edit";this.classPresetEdit="main-ui-filter-edit";this.classPresetNameEdit="main-ui-filter-edit-text";this.classPresetDeleteButton="main-ui-delete";this.classPresetDragButton="main-ui-filter-icon-grab";this.classPresetEditButton="main-ui-filter-icon-edit";this.classPresetEditInput="main-ui-filter-sidebar-item-input";this.classPresetOndrag="main-ui-filter-sidebar-item-ondrag";this.classSquare="main-ui-square";this.classSquareDelete="main-ui-square-delete";this.classSquareSelected="main-ui-square-selected";this.classPresetsContainer="main-ui-filter-sidebar-item-container";this.classPreset="main-ui-filter-sidebar-item";this.classPresetCurrent="main-ui-filter-current-item";this.classFilterContainer="main-ui-filter-wrapper";this.classFileldControlList="main-ui-filter-field-container-list";this.classRestoreFieldsButton="main-ui-filter-field-restore-items";this.classClearSearchValueButton="main-ui-delete";this.classSearchButtonsContainer="main-ui-item-icon-block";this.classSearchButton="main-ui-search";this.classDisabled="main-ui-disable";this.classAnimationShow="main-ui-popup-show-animation";this.classAnimationClose="main-ui-popup-close-animation";this.classSidebarControlsContainer="main-ui-filter-add-container";this.searchContainerPostfix="_search_container";this.classPresetButtonsContainer="main-ui-filter-field-preset-button-container";this.classFindButton="main-ui-filter-find";this.classResetButton="main-ui-filter-reset";this.classDefaultFilter="main-ui-filter-default-preset";this.classRestoreButton="main-ui-filter-reset-link";this.classPinButton="main-ui-filter-icon-pin";this.classPopupOverlay="popup-window-overlay";this.classPinnedPreset="main-ui-item-pin";this.classWaitButtonClass="webform-small-button-wait";this.classForAllCheckbox="main-ui-filter-save-for-all";this.classShow="main-ui-show";this.classFocus="main-ui-focus";this.numberPostfix="_numsel";this.datePostfix="_datesel";this.toPostfix="_to";this.fromPostfix="_from";this.daysPostfix="_days";this.monthPostfix="_month";this.quarterPostfix="_quarter";this.yearPostfix="_year";this.generalTemplateId="";this.init(i,t)};BX.Filter.Settings.prototype={init:function(i,t){this.generalTemplateId=t.getParam("FILTER_ID")+"_GENERAL_template";this.mergeSettings(i)},get:function(i,t){return i&&i in this&&!BX.type.isFunction(this[i])?this[i]:t},mergeSettings:function(i){if(BX.type.isPlainObject(i)){Object.keys(i).forEach(function(t){if(!BX.type.isFunction(this[t])){this[t]=i[t]}},this)}}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:90:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/utils.min.js?15113164722222";s:6:"source";s:71:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/utils.js";s:3:"min";s:75:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/utils.min.js";s:3:"map";s:75:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/utils.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Filter");BX.Filter.Utils={cache:{},styleForEach:function(e,t){var n;t=BX.type.isPlainObject(t)?t:null;n=Object.keys(t);[].forEach.call(e||[],function(e){n.forEach(function(n){BX.style(e,n,t[n])})})},closestParent:function(e,t){if(e){if(!t){return e.parentNode||null}else{return BX.findParent(e,{"class":t})}}},closestChilds:function(e){if(e){return e.children||null}},getNext:function(e){if(e){return e.nextElementSibling||null}},getPrev:function(e){if(e){return e.previousElementSibling||null}},collectionSort:function(e,t){var n,i,r,o,l;if(e&&t&&e!==t&&e.parentNode===t.parentNode){n=this.closestParent(t);i=this.closestChilds(n);r=i.length;o=this.getIndex(i,e);l=this.getIndex(i,t);if(r===l){n.appendChild(t)}if(o>l){n.insertBefore(e,t)}if(o<l&&r!==l){n.insertBefore(e,this.getNext(t))}}},getIndex:function(e,t){return[].indexOf.call(e||[],t)},getByClass:function(e,t,n){var i=[];if(t){i=(e||document.body).getElementsByClassName(t);if(!n){i=i.length?i[0]:null}else{i=[].slice.call(i)}}return i},getByTag:function(e,t,n){var i=[];if(t){i=(e||document.body).getElementsByTagName(t);if(!n){i=i.length?i[0]:null}else{i=[].slice.call(i)}}return i},getBySelector:function(e,t,n){var i=[];if(t){if(!n){i=(e||document.body).querySelector(t)}else{i=(e||document.body).querySelectorAll(t);i=[].slice.call(i)}}return i},requestAnimationFrame:function(){var e=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)};e.apply(window,arguments)},sortObject:function(e){var t={};Object.keys(e).sort().forEach(function(n){t[n]=e[n]});return t},objectsIsEquails:function(e,t){return JSON.stringify(e)===JSON.stringify(t)},isKey:function(e,t){var n={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",27:"escape",32:"space",37:"leftArrow",38:"upArrow",39:"rightArrow",40:"downArrow",46:"delete",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",65:"a"};var i=!!e?"keyCode"in e?e.keyCode:"which"in e?e.which:0:0;return i in n&&n[i]===t}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:99:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/date-group.min.js?15113164721428";s:6:"source";s:80:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/date-group.js";s:3:"min";s:84:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/date-group.min.js";s:3:"map";s:84:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/date-group.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Main.ui.block");BX.Main.ui.block["date-group"]=function(t){var e,n,i,a,l;e={block:"main-ui-control-field-group",name:"name"?t.name+"_datesel":"",mix:"mix"in t?t.mix:null,attrs:{"data-type":"type"in t?t.type:"","data-name":"name"in t?t.name:"","data-time":t.enableTime},content:[]};if("label"in t&&BX.type.isNotEmptyString(t.label)){a={block:"main-ui-control-field-label",tag:"span",content:t.label};e.content.push(a)}n={block:"main-ui-control-field",dragButton:false,content:{block:"main-ui-select",tabindex:"tabindex"in t?t.tabindex:"",value:"value"in t?t.value:"",items:"items"in t?t.items:"",name:"name"in t?t.name+"_datesel":"",params:"params"in t?t.params:"",valueDelete:false}};e.content.push(n);if("content"in t&&BX.type.isArray(t.content)){t.content.forEach(function(t){e.content.push(t)})}if("content"in t&&(BX.type.isPlainObject(t.content)||BX.type.isNotEmptyString(t.content))){e.content.push(t.content)}i={block:"main-ui-item-icon-container",content:{block:"main-ui-item-icon",mix:["main-ui-delete","main-ui-filter-field-delete"],tag:"span",attrs:{title:"deleteTitle"in t&&t.deleteTitle?t.deleteTitle:""}}};e.content.push(i);if(!("dragButton"in t)||t.dragButton!==false){l={block:"main-ui-filter-icon-grab",mix:["main-ui-item-icon"],tag:"span",attrs:{title:"dragTitle"in t&&t.dragTitle?t.dragTitle:""}};e.content.push(l)}return e}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:116:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-control-field-group.min.js?15113164721136";s:6:"source";s:97:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-control-field-group.js";s:3:"min";s:101:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-control-field-group.min.js";s:3:"map";s:101:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-control-field-group.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Main.ui.block");BX.Main.ui.block["main-ui-control-field-group"]=function(t){var n,e,i,a;n={block:"main-ui-control-field-group",mix:"mix"in t?t.mix:null,attrs:{"data-type":"type"in t?t.type:"","data-name":"name"in t?t.name:""},content:[]};if("label"in t&&BX.type.isNotEmptyString(t.label)){i={block:"main-ui-control-field-label",tag:"span",content:t.label};n.content.push(i)}if(BX.type.isArray(t.content)){t.content.forEach(function(t){n.content.push(t)})}else if(BX.type.isPlainObject(t.content)||BX.type.isNotEmptyString(t.content)){n.content.push(t.content)}if("deleteButton"in t&&t.deleteButton===true){e={block:"main-ui-item-icon-container",content:{block:"main-ui-item-icon",mix:["main-ui-delete","main-ui-filter-field-delete"],tag:"span",attrs:{title:"deleteTitle"in t&&t.deleteTitle?t.deleteTitle:""}}};n.content.push(e)}if(!("dragButton"in t)||t.dragButton!==false){a={block:"main-ui-filter-icon-grab",mix:["main-ui-item-icon"],tag:"span",attrs:{title:"dragTitle"in t&&t.dragTitle?t.dragTitle:""}};n.content.push(a)}return n}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:110:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-control-field.min.js?15113164721286";s:6:"source";s:91:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-control-field.js";s:3:"min";s:95:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-control-field.min.js";s:3:"map";s:95:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-control-field.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Main.ui.block");BX.Main.ui.block["main-ui-control-field"]=function(t){var e,n,i,l,a;e={block:"main-ui-control-field",mix:"mix"in t?t.mix:null,attrs:{"data-type":"type"in t?t.type:"","data-name":"name"in t?t.name:""},content:[]};if("label"in t&&BX.type.isNotEmptyString(t.label)){l={block:"main-ui-control-field-label",tag:"span",content:t.label};e.content.push(l)}if(BX.type.isArray(t.content)){t.content.forEach(function(t){e.content.push(t)})}else if(BX.type.isPlainObject(t.content)||BX.type.isNotEmptyString(t.content)){e.content.push(t.content)}if("valueDelete"in t&&t.valueDelete===true){i={block:"main-ui-control-value-delete",content:{block:"main-ui-control-value-delete-item",tag:"span"}};e.content.push(i)}if("deleteButton"in t&&t.deleteButton===true){n={block:"main-ui-item-icon-container",content:{block:"main-ui-item-icon",mix:["main-ui-delete","main-ui-filter-field-delete"],tag:"span",attrs:{title:"deleteTitle"in t&&t.deleteTitle?t.deleteTitle:""}}};e.content.push(n)}if(!("dragButton"in t)||t.dragButton!==false){a={block:"main-ui-filter-icon-grab",mix:["main-ui-item-icon"],tag:"span",attrs:{title:"dragTitle"in t&&t.dragTitle?t.dragTitle:""}};e.content.push(a)}return e}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:110:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-control-string.min.js?1511316472422";s:6:"source";s:92:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-control-string.js";s:3:"min";s:96:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-control-string.min.js";s:3:"map";s:96:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-control-string.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Main.ui.block");BX.Main.ui.block["main-ui-control-string"]=function(n){return{block:"main-ui-control-string",mix:["main-ui-control"],tag:"input",attrs:{type:"type"in n?n.type:"text",name:"name"in n?n.name:"",placeholder:"placeholder"in n?n.placeholder:"",tabindex:"tabindex"in n?n.tabindex:"",value:"value"in n?n.value:""}}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:118:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-filter-field-list-item.min.js?1511316472490";s:6:"source";s:100:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-filter-field-list-item.js";s:3:"min";s:104:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-filter-field-list-item.min.js";s:3:"map";s:104:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-filter-field-list-item.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Main.ui.block");BX.Main.ui.block["main-ui-filter-field-list-item"]=function(i){var e={block:"main-ui-select-inner-label",content:"label"in i?i.label:""};var n={block:"main-ui-filter-field-list-item",mix:"main-ui-select-inner-item",attrs:{"data-id":i.id,"data-name":i.name,"data-item":"item"in i?JSON.stringify(i.item):{}},events:{click:"onClick"in i?i.onClick:""},content:e};return n}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:107:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-filter-info.min.js?1511316472250";s:6:"source";s:89:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-filter-info.js";s:3:"min";s:93:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-filter-info.min.js";s:3:"map";s:93:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-filter-info.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Main.ui.block");BX.Main.ui.block["main-ui-filter-info"]=function(t){return{block:"main-ui-filter-info",tag:"span",content:t.content,attrs:{title:t.title}}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:102:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-number.min.js?1511316472754";s:6:"source";s:84:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-number.js";s:3:"min";s:88:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-number.min.js";s:3:"map";s:88:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-number.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Main.ui.block");BX.Main.ui.block["main-ui-number"]=function(e){var n,i,t;n={block:"main-ui-number",mix:["main-ui-control"],content:[]};if("mix"in e&&BX.type.isArray(e.mix)){e.mix.forEach(function(e){n.mix.push(e)})}i={block:"main-ui-number-input",mix:["main-ui-control-input"],tag:"input",attrs:{type:"number",name:"name"in e?e.name:"",tabindex:"tabindex"in e?e.tabindex:"",value:"value"in e?e.value:"",placeholder:"placeholder"in e?e.placeholder:"",autocomplete:"off"}};n.content.push(i);if("valueDelete"in e&&e.valueDelete===true){t={block:"main-ui-control-value-delete",content:{block:"main-ui-control-value-delete-item",tag:"span"}};n.content.push(t)}return n}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:109:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-search-square.min.js?1511316472563";s:6:"source";s:91:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-search-square.js";s:3:"min";s:95:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-search-square.min.js";s:3:"map";s:95:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-search-square.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Main.ui.block");BX.Main.ui.block["main-ui-search-square"]=function(i){var e=["main-ui-filter-search-square"];if("isPreset"in i&&i.isPreset){e.push("main-ui-filter-search-square-preset")}return{block:"main-ui-square",mix:e,attrs:{"data-item":"item"in i?JSON.stringify(i.item):"",title:"title"in i?i.title:""},content:[{block:"main-ui-square-item",content:"name"in i?BX.util.htmlspecialcharsback(i.name):""},{block:"main-ui-square-delete",mix:["main-ui-item-icon"]}]}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:101:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/number-group.min.js?15113164721409";s:6:"source";s:82:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/number-group.js";s:3:"min";s:86:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/number-group.min.js";s:3:"map";s:86:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/number-group.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Main.ui.block");BX.Main.ui.block["number-group"]=function(n){var t,e,i,a,l;t={block:"main-ui-control-field-group",name:"name"in n?n.name+"_numsel":"",mix:"mix"in n?n.mix:null,attrs:{"data-type":"type"in n?n.type:"","data-name":"name"in n?n.name:""},content:[]};if("label"in n&&BX.type.isNotEmptyString(n.label)){a={block:"main-ui-control-field-label",tag:"span",content:n.label};t.content.push(a)}e={block:"main-ui-control-field",dragButton:false,content:{block:"main-ui-select",tabindex:"tabindex"in n?n.tabindex:"",value:"value"in n?n.value:"",items:"items"in n?n.items:"",name:"name"in n?n.name+"_numsel":"",params:"params"in n?n.params:"",valueDelete:false}};t.content.push(e);if("content"in n&&BX.type.isArray(n.content)){n.content.forEach(function(n){t.content.push(n)})}if("content"in n&&(BX.type.isPlainObject(n.content)||BX.type.isNotEmptyString(n.content))){t.content.push(n.content)}i={block:"main-ui-item-icon-container",content:{block:"main-ui-item-icon",mix:["main-ui-delete","main-ui-filter-field-delete"],tag:"span",attrs:{title:"deleteTitle"in n&&n.deleteTitle?n.deleteTitle:""}}};t.content.push(i);if(!("dragButton"in n)||n.dragButton!==false){l={block:"main-ui-filter-icon-grab",mix:["main-ui-item-icon"],tag:"span",attrs:{title:"dragTitle"in n&&n.dragTitle?n.dragTitle:""}};t.content.push(l)}return t}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:101:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/sidebar-item.min.js?15113164721364";s:6:"source";s:82:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/sidebar-item.js";s:3:"min";s:86:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/sidebar-item.min.js";s:3:"map";s:86:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/sidebar-item.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Main.ui.block");BX.Main.ui.block["sidebar-item"]=function(i){return{block:"main-ui-filter-sidebar-item"+("pinned"in i&&i.pinned?" main-ui-item-pin":""),attrs:{"data-id":"id"in i?i.id:""},content:[{block:"main-ui-filter-icon-grab",tag:"span",mix:["main-ui-item-icon"],attrs:{title:"dragTitle"in i&&i.dragTitle?i.dragTitle:""}},{block:"main-ui-filter-sidebar-item-text-container",tag:"span",content:[{block:"main-ui-filter-sidebar-item-input",tag:"input",attrs:{type:"text",placeholder:"placeholder"in i?i.placeholder:"",value:"text"in i?BX.util.htmlspecialchars(BX.util.htmlspecialcharsback(i.text)):""}},{block:"main-ui-filter-sidebar-item-text",tag:"span",content:"text"in i?i.text:""},{block:"main-ui-filter-icon-pin",tag:"span",mix:["main-ui-item-icon"],attrs:{title:"noEditPinTitle"in i&&i.noEditPinTitle?i.noEditPinTitle:""}}]},{block:"main-ui-filter-icon-edit",tag:"span",mix:["main-ui-item-icon"],attrs:{title:"editNameTitle"in i&&i.editNameTitle?i.editNameTitle:""}},{block:"main-ui-delete",tag:"span",mix:["main-ui-item-icon"],attrs:{title:"removeTitle"in i&&i.removeTitle?i.removeTitle:""}},{block:"main-ui-filter-icon-pin",tag:"span",mix:["main-ui-item-icon"],attrs:{title:"editPinTitle"in i&&i.editPinTitle?i.editPinTitle:""}},{block:"main-ui-filter-edit-mask"}]}}})();
/* End */
;; /* /bitrix/components/bitrix/main.interface.buttons/templates/.default/script.min.js?151131647237595*/
; /* /bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.min.js?1511316472575*/
; /* /bitrix/components/bitrix/crm.entity.counter.panel/templates/.default/script.min.js?15113164781267*/
; /* /bitrix/components/bitrix/crm.widget_panel/templates/.default/script.min.js?1511316478167003*/
; /* /bitrix/components/bitrix/crm.interface.toolbar/templates/title/script.min.js?15113164782303*/
; /* /bitrix/components/bitrix/crm.interface.filter/templates/title/script.min.js?15113164782949*/
; /* /bitrix/components/bitrix/intranet.user.selector.new/templates/.default/users.min.js?151131652313983*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/script.min.js?151131647240526*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/js/api.min.js?1511316472586*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/js/field-controller.min.js?15113164722703*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/js/fields.min.js?151131647216599*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/js/main-ui-control-custom-entity.min.js?15113164722940*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/js/presets.min.js?151131647214223*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/js/search.min.js?151131647215840*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/js/settings.min.js?15113164724325*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/js/utils.min.js?15113164722222*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/date-group.min.js?15113164721428*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-control-field-group.min.js?15113164721136*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-control-field.min.js?15113164721286*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-control-string.min.js?1511316472422*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-filter-field-list-item.min.js?1511316472490*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-filter-info.min.js?1511316472250*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-number.min.js?1511316472754*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-search-square.min.js?1511316472563*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/number-group.min.js?15113164721409*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/sidebar-item.min.js?15113164721364*/

//# sourceMappingURL=page_1d88733880f13253c191a7a505755a19.map.js