var VoxImplant=function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={exports:{},id:r,loaded:false};e[r].call(o.exports,o,o.exports,n);o.loaded=true;return o.exports}n.m=e;n.c=t;n.p="/build";return n(0)}([function(e,t,n){"use strict";var r=n(1);n(40);var o=n(52);var i=n(5);var a=n(2);t.Events=a.Events;var s=n(18);t.CallEvents=s.CallEvents;var c=n(55);t.MessagingEvents=c.MessagingEvents;var d=n(57);t.OperatorACDStatuses=d.OperatorACDStatuses;var l=n(4);t.LogCategory=l.LogCategory;t.LogLevel=l.LogLevel;function u(){return r.Client.getInstance()}t.getInstance=u;t.version=r.Client.getInstance().version;function g(){if(!i.Authenticator.get().authorized())throw new Error("NOT_AUTHORIZED");return o.Messenger.getInstance()}t.getMessenger=g},function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var o=arguments.length,i=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,a;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")i=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)if(a=e[s])i=(o<3?a(i):o>3?a(t,n,i):a(t,n))||i;return o>3&&i&&Object.defineProperty(t,n,i),i};var o=n(2);var i=n(3);var a=n(6);var s=n(11);var c=n(5);var d=n(7);var l=n(4);var u=n(13);var g=n(16);var f=n(15);var p=n(36);var h=n(20);var v=n(24);var m=n(26);var C=n(10);var y=n(37);var L=n(38);var S=n(39);var E=function(){function e(){var t=this;this._connected=false;this.progressToneScript={US:"440@-19,480@-19;*(2/4/1+2)",RU:"425@-19;*(1/3/1)"};this.playingNow=false;this.serversList=[];this._vol=100;this.micRequired=false;this.videoConstraints=null;this.progressToneCountry="US";this.progressTone=true;this.showDebugInfo=false;this.showWarnings=false;this.RTCsupported=false;this._deviceEnumAPI=false;this.eventListeners={};this.applyMixins(e,[p.Callbackable]);if(e.instance){throw new Error("Error - use VoxImplant.getInstance()")}e.instance=this;this._promises={};d.default.init();var n=u.PCFactory.get();n.requireMedia=false;this.voxSignaling=a.VoxSignaling.get();this.voxMediaManager=s.UserMediaManager.get();this.voxCallManager=g.CallManager.get();this.mediacache=C.MediaCache.get();this.renderer=f.Renderer.get();this.setLogLevelAll(l.LogLevel.NONE);l.LogManager.get().writeMessage(l.LogCategory.CLIENT,"SDK ver.",l.LogLevel.TRACE,this.version);a.VoxSignaling.get().setRPCHandler(v.RemoteEvent.onPCStats,function(e,n){if(u.PCFactory.get().getPeerConnect(e))t.dispatchEvent({name:"NetStatsReceived",stats:n})});this._defaultSinkId=null}e.prototype.applyMixins=function(e,t){t.forEach(function(t){Object.getOwnPropertyNames(t.prototype).forEach(function(n){e.prototype[n]=t.prototype[n]})})};e.prototype.deviceEnumAPI=function(){var e=this;this.voxMediaManager.getDevices().then(function(){e._deviceEnumAPI=true;e.dispatchEvent({name:o.Events.SourcesInfoUpdated})}).catch(function(e){this._deviceEnumAPI=false})};e.prototype.playProgressTone=function(){if(this.progressToneScript[this.progressToneCountry]!==null){if(!this.playingNow)this.playToneScript(this.progressToneScript[this.progressToneCountry]);this.playingNow=true}};e.prototype.stopProgressTone=function(){if(this.playingNow){this.stopPlayback();this.playingNow=false}};e.prototype.onIncomingCall=function(e,t,n,r,i){this.dispatchEvent({name:o.Events.IncomingCall,call:g.CallManager.get().calls[e],headers:r,video:i})};e.prototype.checkConnection=function(){if(!this._connected)throw new Error("NOT_CONNECTED_TO_VOXIMPLANT")};e.prototype.init=function(e){var t=this;return new Promise(function(n,r){t._config=typeof e!=="undefined"?e:{};if(t._config.progressToneCountry!==undefined)t.progressToneCountry=t._config.progressToneCountry;if(t._config.progressTone!==true)t.progressTone=false;if(t._config.serverIp!==undefined)t.serverIp=t._config.serverIp;if(t._config.showDebugInfo!==undefined)t.showDebugInfo=t._config.showDebugInfo;if(t._config.showWarnings!==false)t.showWarnings=true;if(typeof t._config.videoContainerId==="string")t.remoteVideoContainerId=t._config.videoContainerId;if(typeof t._config.remoteVideoContainerId==="string")t.remoteVideoContainerId=t._config.remoteVideoContainerId;if(typeof t._config.localVideoContainerId==="string")t.localVideoContainerId=t._config.localVideoContainerId;if(t._config.micRequired!==false)t.micRequired=true;if(typeof t._config.videoSupport!="undefined")t.videoSupport=t._config.videoSupport;else t.videoSupport=false;if(typeof t._config.H264first!="undefined")t._h264first=t._config.H264first;else t._h264first=false;if(typeof t._config.VP8first!="undefined")t._VP8first=t._config.VP8first;else t._VP8first=false;if(typeof t._config.rtcStatsCollectionInterval!="undefined")g.CallManager.get().rtcStatsCollectionInterval=t._config.rtcStatsCollectionInterval;else g.CallManager.get().rtcStatsCollectionInterval=1e4;if(t.showWarnings)t.setLogLevelAll(l.LogLevel.WARNING);if(t.showDebugInfo)t.setLogLevelAll(l.LogLevel.TRACE);if(t._config.protocolVersion&&(t._config.protocolVersion==="2"||t._config.protocolVersion==="3")){t._callProtocolVersion=t._config.protocolVersion;g.CallManager.get().setProtocolVersion(t._callProtocolVersion)}else t._callProtocolVersion="3";if(t._config.callstatsIoParams)m.CallstatsIo.get(t._config.callstatsIoParams);if(t._config.prettyPrint)l.LogManager.get().setPrettyPrint(t._config.prettyPrint);if(t._config.videoConstraints!==undefined){t.videoConstraints=t._config.videoConstraints;s.UserMediaManager.get().setConstraints(t.videoConstraints,false)}s.UserMediaManager.get().enableAudio(t.micRequired);s.UserMediaManager.get().enableVideo(t.videoSupport);if(window.location.hostname!="127.0.0.1"&&window.location.hostname!="localhost"&&window.location.protocol!="https:"){if(typeof console.error!="undefined"&&t.showWarnings)console.error("WARNING: getUserMedia() is deprecated on insecure origins, and support will be removed in the future. You should consider switching your application to a secure origin, such as HTTPS. See https://goo.gl/rStTGz for more details.")}if(typeof webkitRTCPeerConnection!="undefined"||typeof mozRTCPeerConnection!="undefined"||typeof RTCPeerConnection!="undefined"||typeof RTCIceGatherer!="undefined"){if(typeof mozRTCPeerConnection!="undefined"){try{new mozRTCPeerConnection({iceServers:[]});t.RTCsupported=true}catch(i){}}else t.RTCsupported=true}if(t.RTCsupported){var a;if(window.location.href.match(/^file\:\/{3}.*$/g)!=null){if(typeof console.error!="undefined"&&t.showWarnings)console.error("WebRTC requires application to be loaded from a web server")}t.voxAuth=c.Authenticator.get();t.voxAuth.setHandler({onLoginSuccessful:function(e,n){t._promises["login"].resolve({name:o.Events.AuthResult,displayName:e,result:true});t.dispatchEvent({name:o.Events.AuthResult,displayName:e,result:true,tokens:n})},onLoginFailed:function(e){t._promises["login"].reject({name:o.Events.AuthResult,code:e,result:false});t.dispatchEvent({name:o.Events.AuthResult,code:e,result:false})},onSecondStageInitiated:function(){t._promises["login"].reject({name:o.Events.AuthResult,code:301,result:false});t.dispatchEvent({name:o.Events.AuthResult,code:301,result:false})},onOneTimeKeyGenerated:function(e){t._promises["loginkey"].resolve({name:o.Events.AuthResult,key:e,code:302,result:false});t.dispatchEvent({name:o.Events.AuthResult,key:e,code:302,result:false})},onRefreshTokenFailed:function(e){t.dispatchEvent({name:o.Events.RefreshTokenResult,code:e,result:false})},onRefreshTokenSuccess:function(e){t.dispatchEvent({name:o.Events.RefreshTokenResult,tokens:e,result:true})}});t.voxSignaling.addHandler(t);a=setInterval(function(){if(typeof document!="undefined"){clearInterval(a);t.deviceEnumAPI();t.dispatchEvent({name:o.Events.SDKReady,version:t.version});n({name:o.Events.SDKReady,version:t.version})}},100)}else{r(new Error("NO_WEBRTC_SUPPORT"));throw new Error("NO_WEBRTC_SUPPORT")}})};e.prototype.call=function(e,t,n,r){i.Utils.checkCA();var o={};if(typeof e=="string"){o={number:e,video:t,customData:n,extraHeaders:r}}else{o=e}if(typeof o.video==="boolean")o.video={sendVideo:o.video,receiveVideo:o.video};if(typeof o.H264first=="undefined")o.H264first=this._h264first;if(typeof o.VP8first=="undefined")o.VP8first=this._VP8first;var a=this.voxCallManager.call(o);return a};e.prototype.config=function(){return this._config};e.prototype.connect=function(e){var t=this;return new Promise(function(n,r){t._promises["connect"]={resolve:n,reject:r};if(t.serverIp!==undefined){var o=void 0;if(typeof t.serverIp==="object"){t.serversList=t.serverIp;o=t.serversList[0]}else o=t.serverIp;t.connectTo(o,null,e)}else{var a=function(t){var n=String(t).indexOf(";"),r;if(n==-1){r=t}else{this.serversList=t.split(";");r=this.serversList[0]}this.connectTo(r,null,e)};i.Utils.getServers(a.bind(t),false,t)}})};e.prototype.connectTo=function(e,t,n){var r=this;if(this._connected){throw new Error("ALREADY_CONNECTED_TO_VOXIMPLANT")}this.host=e;if(!this.micRequired||t===true)this.voxSignaling.connectTo(e,true,true,n,this._callProtocolVersion);else{this.voxMediaManager.queryMedia().then(function(e){r.deviceEnumAPI();if(r.micRequired)r.voxSignaling.connectTo(r.host,true,true,n,r._callProtocolVersion);r.dispatchEvent({name:o.Events.MicAccessResult,result:true,stream:e})}).catch(function(e){r.dispatchEvent({name:o.Events.MicAccessResult,result:false,reason:e})})}};e.prototype.disconnect=function(){this.checkConnection();this.voxSignaling.disconnect();this.voxMediaManager.stopLocalStream();this.voxSignaling.removeRPCHandler(v.RemoteEvent.onCallRemoteFunctionError);this.voxSignaling.removeRPCHandler(v.RemoteEvent.handleError)};e.prototype.setOperatorACDStatus=function(e){var t=this;return new Promise(function(n,r){i.Utils.checkCA();t._promises["acd_status"]={resolve:n,reject:r};t.voxSignaling.callRemoteFunction(h.RemoteFunction.setOperatorACDStatus,e)})};e.prototype.login=function(e,t,n){var r=this;return new Promise(function(o,a){r._promises["login"]={resolve:o,reject:a};n=typeof n!=="undefined"?n:{};n=i.Utils.extend({},n);if(!r._connected){a(new Error("NOT_CONNECTED_TO_VOXIMPLANT"));throw new Error("NOT_CONNECTED_TO_VOXIMPLANT")}r.voxAuth.basicLogin(e,t,n)})};e.prototype.loginWithCode=function(e,t,n){var r=this;return new Promise(function(o,a){r._promises["login"]={resolve:o,reject:a};n=typeof n!=="undefined"?n:{};n=i.Utils.extend({serverPresenceControl:false},n);if(!r._connected){a(new Error("NOT_CONNECTED_TO_VOXIMPLANT"));throw new Error("NOT_CONNECTED_TO_VOXIMPLANT")}r.voxAuth.loginStage2(e,t,n)})};e.prototype.loginWithToken=function(e,t,n){var r=this;return new Promise(function(o,a){r._promises["login"]={resolve:o,reject:a};n=typeof n!=="undefined"?n:{};n=i.Utils.extend({serverPresenceControl:false},n);n.accessToken=t;if(!r._connected){a(new Error("NOT_CONNECTED_TO_VOXIMPLANT"));throw new Error("NOT_CONNECTED_TO_VOXIMPLANT")}r.voxAuth.tokenLogin(e,n)})};e.prototype.tokenRefresh=function(e,t,n){this.voxAuth.tokenRefresh(e,t,n)};e.prototype.requestOneTimeLoginKey=function(e){var t=this;return new Promise(function(n,r){t._promises["loginkey"]={resolve:n,reject:r};if(!t._connected){r(new Error("NOT_CONNECTED_TO_VOXIMPLANT"));throw new Error("NOT_CONNECTED_TO_VOXIMPLANT")}t.voxAuth.generateOneTimeKey(e)})};e.prototype.loginWithOneTimeKey=function(e,t,n){var r=this;return new Promise(function(o,a){r._promises["login"]={resolve:o,reject:a};n=typeof n!=="undefined"?n:{};n=i.Utils.extend({serverPresenceControl:false},n);if(!r._connected){a(new Error("NOT_CONNECTED_TO_VOXIMPLANT"));throw new Error("NOT_CONNECTED_TO_VOXIMPLANT")}r.voxAuth.loginUsingOneTimeKey(e,t,n)})};e.prototype.connected=function(){return this._connected};e.prototype.showLocalVideo=function(e,t,n){if(e===void 0){e=true}if(t===void 0){t=false}if(n===void 0){n=false}this.voxMediaManager.showLocalVideo(e,t,n)};e.prototype.setLocalVideoPosition=function(e,t){throw new Error("Deprecated: please use CSS to position '#voximplantlocalvideo' element")};e.prototype.setLocalVideoSize=function(e,t){throw new Error("Deprecated: please use CSS to set size of '#voximplantlocalvideo' element")};e.prototype.setVideoSettings=function(e,t,n){var r=this;s.UserMediaManager.get().setConstraints(e,true).then(function(e){if(document.getElementById("voximplantlocalvideo")!==null)d.default.attachMedia(r.voxMediaManager.currentStream,document.getElementById("voximplantlocalvideo"));if(typeof t=="function")t(e)}).catch(function(e){if(typeof n=="function")n(e)})};e.prototype.setVideoBandwidth=function(e){this.checkConnection();u.PCFactory.get().setBandwidthParams(e);this.voxSignaling.callRemoteFunction(h.RemoteFunction.setDesiredVideoBandwidth,e)};e.prototype.playToneScript=function(e,t){if(t===void 0){t=false}i.Utils.playToneScript(e,t)};e.prototype.stopPlayback=function(){if(i.Utils.stopPlayback())this.dispatchEvent({name:o.Events.PlaybackFinished})};e.prototype.volume=function(e){if(e===undefined){return this._vol}else{if(e>100)e=100;if(e<0)e=0;f.Renderer.get().setPlaybackVolume(e/100);this._vol=e}};e.prototype.audioSources=function(){return this.voxMediaManager.audioSourcesList};e.prototype.videoSources=function(){return this.voxMediaManager.videoSourcesList};e.prototype.audioOutputs=function(){return this.voxMediaManager.audioOutputsList};e.prototype.useAudioSource=function(e,t,n){var r=this;return new Promise(function(o,i){r.voxMediaManager.useAudioInputDevice(e);r.voxMediaManager.enableAudio(true);r.voxMediaManager.queryMedia().then(function(e){if(typeof t=="function")t(e);o(e);s.UserMediaManager.get().updateLocalVideo(e)}).catch(function(e){if(typeof n=="function")n(e);i(e)})})};e.prototype.useVideoSource=function(e,t,n){var r=this;return new Promise(function(o,i){r.voxMediaManager.useVideoDevice(e);if(s.UserMediaManager.get().isVideoEnabled()){r.voxMediaManager.queryMedia().then(function(e){if(typeof t=="function")t(e);s.UserMediaManager.get().updateLocalVideo(e);o(e)}).catch(function(e){if(typeof n=="function")n(e);i(e)})}else{s.UserMediaManager.get().updateLocalVideo()}})};e.prototype.useAudioOutput=function(e){var t=this;return new Promise(function(n,r){if(d.default.getWSVendor(true)!=="chrome")r(new Error("Unsupported browser. Only Google Chrome 49 and above."));t._defaultSinkId=e;n()})};e.prototype.attachRecordingDevice=function(e,t){var n=this;this.voxMediaManager.enableAudio(true);if(this._config.videoSupport)this.voxMediaManager.enableVideo(true);return new Promise(function(r,i){return n.voxMediaManager.queryMedia().then(function(t){if(typeof e=="function")e(t);n.dispatchEvent({name:o.Events.MicAccessResult,result:true,stream:t})}).catch(function(e){if(typeof t=="function")t(e);n.dispatchEvent({name:o.Events.MicAccessResult,result:false,reason:e})})})};e.prototype.detachRecordingDevice=function(){s.UserMediaManager.get().stopLocalStream()};e.prototype.setCallActive=function(e,t){if(t===void 0){t=true}return new Promise(function(n,r){i.Utils.checkCA();if(e)return e.setActive(t);else r("trying to hold unknown call "+e)})};e.prototype.sendVideo=function(e){if(e===void 0){e=true}this.voxMediaManager.sendVideo(e)};e.prototype.isRTCsupported=function(){var e=window;return e.RTCPeerConnection||e.mozRTCPeerConnection||e.webkitRTCPeerConnection||navigator.userAgent.match(/Edge\/(\d+).(\d+)$/)};e.prototype.transferCall=function(e,t){i.Utils.checkCA();this.voxCallManager.transferCall(e,t)};e.getInstance=function(){if(typeof e.instance=="undefined")e.instance=new e;return e.instance};Object.defineProperty(e.prototype,"version",{get:function(){return"4.0.6799-b24"},enumerable:true,configurable:true});e.prototype.setLogLevel=function(e,t){l.LogManager.get().setLogLevel(e,t)};e.prototype.setLogLevelAll=function(e){this.setLogLevel(l.LogCategory.SIGNALING,e);this.setLogLevel(l.LogCategory.RTC,e);this.setLogLevel(l.LogCategory.ORTC,e);this.setLogLevel(l.LogCategory.USERMEDIA,e);this.setLogLevel(l.LogCategory.CALL,e);this.setLogLevel(l.LogCategory.CALLEXP2P,e);this.setLogLevel(l.LogCategory.CALLEXSERVER,e);this.setLogLevel(l.LogCategory.CALLMANAGER,e);this.setLogLevel(l.LogCategory.CLIENT,e);this.setLogLevel(l.LogCategory.AUTHENTICATOR,e);this.setLogLevel(l.LogCategory.PCFACTORY,e);this.setLogLevel(l.LogCategory.UTILS,e);this.setLogLevel(l.LogCategory.MESSAGING,e)};e.prototype.onSignalingConnected=function(){this._connected=true;if(this._promises["connect"]!==undefined)this._promises["connect"].resolve({name:o.Events.ConnectionEstablished});this.dispatchEvent({name:o.Events.ConnectionEstablished})};e.prototype.onSignalingClosed=function(){this._connected=false;this.dispatchEvent({name:o.Events.ConnectionClosed});if(this.progressTone)this.stopProgressTone()};e.prototype.onSignalingConnectionFailed=function(e){this._connected=false;if(this.serversList.length>1&&(typeof this.serverIp==="undefined"||typeof this.serverIp==="object")){this.serversList.splice(0,1);this.connectTo(this.serversList[0],true)}else{if(this._promises["connect"]!==undefined)this._promises["connect"].reject({name:o.Events.ConnectionFailed,message:e});this.dispatchEvent({name:o.Events.ConnectionFailed,message:e})}};e.prototype.onMediaConnectionFailed=function(){};e.prototype.getCall=function(e){return g.CallManager.get().calls[e]};e.prototype.removeCall=function(e){g.CallManager.get().removeCall(e)};e.prototype.dispatchEvent=function(e){return undefined};e.prototype.addEventListener=function(e,t){};e.prototype.removeEventListener=function(e,t){};e.prototype.on=function(e,t){};e.prototype.off=function(e,t){};e.prototype.sslset=function(e){this.voxSignaling.writeLog=e};e.prototype.sslget=function(){return this.voxSignaling.getLog()};e.prototype.getZingayaAPI=function(){return new y.ZingayaAPI(this)};e.prototype.getMediaCache=function(){return C.MediaCache.get()};e.prototype.registerForPushNotificatuons=function(e){return L.PushService.register(e)};e.prototype.unregisterForPushNotificatuons=function(e){return L.PushService.unregister(e)};e.prototype.handlePushNotification=function(e){return L.PushService.incomingPush(e)};e.prototype.getGUID=function(){return(new S.GUID).toString()};r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"deviceEnumAPI",null);r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"playProgressTone",null);r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"stopProgressTone",null);r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"onIncomingCall",null);r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"checkConnection",null);r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"init",null);r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"call",null);r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"config",null);r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"connect",null);r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"connectTo",null);r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"disconnect",null);r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"setOperatorACDStatus",null);r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"login",null);r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"loginWithCode",null);r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"loginWithToken",null);r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"tokenRefresh",null);r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"requestOneTimeLoginKey",null);r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"loginWithOneTimeKey",null);r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"connected",null);r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"showLocalVideo",null);r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"setLocalVideoPosition",null);r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"setLocalVideoSize",null);r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"setVideoSettings",null);r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"setVideoBandwidth",null);r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"playToneScript",null);r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"stopPlayback",null);r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"volume",null);r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"audioSources",null);r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"videoSources",null);r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"audioOutputs",null);r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"useAudioSource",null);r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"useVideoSource",null);r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"useAudioOutput",null);r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"attachRecordingDevice",null);r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"detachRecordingDevice",null);r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"setCallActive",null);r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"sendVideo",null);r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"isRTCsupported",null);r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"transferCall",null);r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"setLogLevel",null);r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"setLogLevelAll",null);r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"onSignalingConnected",null);r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"onSignalingClosed",null);r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"onSignalingConnectionFailed",null);r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"onMediaConnectionFailed",null);r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"getCall",null);r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"removeCall",null);r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"dispatchEvent",null);r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"addEventListener",null);r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"removeEventListener",null);r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"on",null);r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"off",null);r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e,"getInstance",null);return e}();t.Client=E},function(e,t){"use strict";(function(e){e[e["SDKReady"]="SDKReady"]="SDKReady";e[e["ConnectionEstablished"]="ConnectionEstablished"]="ConnectionEstablished";e[e["ConnectionFailed"]="ConnectionFailed"]="ConnectionFailed";e[e["ConnectionClosed"]="ConnectionClosed"]="ConnectionClosed";e[e["AuthResult"]="AuthResult"]="AuthResult";e[e["RefreshTokenResult"]="RefreshTokenResult"]="RefreshTokenResult";e[e["PlaybackFinished"]="PlaybackFinished"]="PlaybackFinished";e[e["MicAccessResult"]="MicAccessResult"]="MicAccessResult";e[e["IncomingCall"]="IncomingCall"]="IncomingCall";e[e["SourcesInfoUpdated"]="SourcesInfoUpdated"]="SourcesInfoUpdated";e[e["NetStatsReceived"]="NetStatsReceived"]="NetStatsReceived"})(t.Events||(t.Events={}));var n=t.Events},function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var o=arguments.length,i=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,a;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")i=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)if(a=e[s])i=(o<3?a(i):o>3?a(t,n,i):a(t,n))||i;return o>3&&i&&Object.defineProperty(t,n,i),i};var o=n(4);var i=n(1);var a=n(5);var s=n(11);var c=function(){function e(){}e.extend=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t-0]=arguments[t]}var n={};var r=function(e){for(var t in e){if(Object.prototype.hasOwnProperty.call(e,t)){n[t]=e[t]}}};r(arguments[0]);for(var o=1;o<arguments.length;o++){var i=arguments[o];r(i)}return n};e.stringifyExtraHeaders=function(e){if(Object.prototype.toString.call(e)=="[object Object]")e=JSON.stringify(e);else e=null;return e};e.cadScript=function(e){var t=e.split(";");return t.map(function(e){if(e.length===0){return}var t=e.match(/\([0-9\/\.,\*\+]*\)$/),n=e.substring(0,t.index),r=t.pop();if(t.length){throw new Error("cadence script should be of the form `%f(%f/%f[,%f/%f])`")}n=n==="*"?Infinity:parseFloat(n);if(isNaN(n)){throw new Error("cadence length should be of the form `%f`")}r=r.slice(1,r.length-1).split(",").map(function(e){try{var t=e.split("/");if(t.length>3){throw new Error}t=t.map(function(e,t){if(t===2){var n=e.split("+").map(function(e){var t=parseInt(e,10);if(isNaN(t)){throw new Error}return t-1});return n}var r;if(e=="*"){r=Infinity}r=r?r:parseFloat(e);if(isNaN(r)){throw new Error}return r});return{on:t[0],off:t[1],frequencies:t[2]}}catch(n){throw new Error("cadence segments should be of the form `%f/%f[%d[+%d]]`")}});return{duration:n,sections:r}})};e.freqScript=function(e){var t=e.split(",");return t.map(function(e){try{var t=e.split("@"),n=parseInt(t.shift()),r=parseFloat(t.shift());if(t.length){throw Error()}return{frequency:n,decibels:r}}catch(o){throw new Error("freqScript pairs are expected to be of the form `%d@%f[,%d@%f]`")}})};e.toneScript=function(e){var t=e.split(";"),n=this.freqScript(t.shift()),r=this.cadScript(t.join(";"));return{frequencies:n,cadences:r}};e.playToneScript=function(e,t){if(t===void 0){t=false}if(typeof window.AudioContext!="undefined"||typeof window.webkitAudioContext!="undefined"){var n=s.UserMediaManager.get().audioContext,r=this.toneScript(e),o=[],i=0;var a=function(e){for(var t=0;t<n.sampleRate*e;t++)o.push(0)};var c=function(e,t){for(var i=0;i<n.sampleRate*t;i++){var a=0;for(var s=0;s<e.length;s++){a+=Math.pow(10,r.frequencies[e[s]].decibels/20)*Math.sin((o.length+i)*(3.14159265359/n.sampleRate)*r.frequencies[e[s]].frequency);if(i<10)a*=i/10;if(i>n.sampleRate*t-10)a*=(n.sampleRate*t-i)/10}o.push(a)}};var d=function(e,t){if(t!=Infinity)var n=t;else n=t=20;if(e.off!==0&&e.off!=Infinity){while(n>0){c(e.frequencies,e.on);n-=e.on;a(e.off);n-=e.off;var r=n*10;n=parseInt(String(n*10))/10}}else{c(e.frequencies,t)}};var l=function(e){if(e.duration!=Infinity)i+=e.duration;else i+=20;for(var t=0;t<e.sections.length;t++){d(e.sections[t],e.duration)}};this.source=n.createBufferSource();for(var u=0;u<r.cadences.length;u++){if(r.cadences[u].duration==Infinity)this.source.loop=true;l(r.cadences[u])}this.source.connect(n.destination);var g=n.createBuffer(1,i*n.sampleRate,n.sampleRate);var f=g.getChannelData(0);for(var p=0;p<i*n.sampleRate;p++){f[p]=o[p]}o=null;this.source.buffer=g;if(t===true)this.source.loop=true;this.source.start(0)}};e.stopPlayback=function(){if(this.source!==null){this.source.stop(0);this.source=null;return true}return false};e.sendRequest=function(e,t,n,r){var o=false;var i=function(){var e=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}];var t;for(var n=0;n<e.length;n++){try{t=e[n]();if(n===0)o=true}catch(r){continue}break}return t};var a=i();if(!a)return;var s=r?"POST":"GET";if(!o){a.open(s,e,true);if(r)a.setRequestHeader("Content-type","application/x-www-form-urlencoded");a.onreadystatechange=function(){if(a.readyState!=4)return;if(a.status!=200&&a.status!=304){n(a);return}t(a)};if(a.readyState==4)return;a.send(r)}else{a.onerror=function(){n(a)};a.ontimeout=function(){n(a)};a.onload=function(){t(a)};a.open(s,e);a.timeout=5e3;a.send()}};e.getServers=function(e,t,n){if(t===void 0){t=false}var r="https:"==document.location.protocol?"https://":"http://";if(t===true)var o=r+"balancer.voximplant.com/getNearestHost";else o=r+"balancer.voximplant.com/getNearestHost";this.sendRequest(o,function(e){i(e.responseText)},function(e){i(null)});function i(r){if(r!==null)e(r);else if(t!==true)this.getServers(e,true,n);else n.dispatchEvent({name:"ConnectionFailed",message:"VoxImplant Cloud is unavailable"})}};e.generateUUID=function(){var e=this._gri,t=this._ha;return t(e(32),8)+"-"+t(e(16),4)+"-"+t(16384|e(12),4)+"-"+t(32768|e(14),4)+"-"+t(e(48),12)};e._gri=function(e){if(e<0)return NaN;if(e<=30)return 0|Math.random()*(1<<e);if(e<=53)return(0|Math.random()*(1<<30))+(0|Math.random()*(1<<e-30))*(1<<30);return NaN};e._ha=function(e,t){var n=e.toString(16),r=t-n.length,o="0";for(;r>0;r>>>=1,o+=o){if(r&1){n=o+n}}return n};e.filterXSS=function(e){var t=document.createElement("div");t.appendChild(document.createTextNode(e));e=t.innerHTML;return e};e.checkCA=function(){if(!i.Client.getInstance().connected())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");if(!a.Authenticator.get().authorized())throw new Error("NOT_AUTHORIZED")};e.canRTC=function(e){return};e.mixObjectToLeft=function(e,t){for(var n in e){if(typeof t[n]=="undefined")continue;e[n]=t[n]}return e};e.makeRandomString=function(e){var t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/";var n="";for(var r=0;r<e;r++){n+=t.charAt(Math.floor(Math.random()*t.length))}return n};e.source=null;r([o.LogManager.d_trace(o.LogCategory.UTILS)],e,"extend",null);r([o.LogManager.d_trace(o.LogCategory.UTILS)],e,"stringifyExtraHeaders",null);r([o.LogManager.d_trace(o.LogCategory.UTILS)],e,"cadScript",null);r([o.LogManager.d_trace(o.LogCategory.UTILS)],e,"freqScript",null);r([o.LogManager.d_trace(o.LogCategory.UTILS)],e,"toneScript",null);r([o.LogManager.d_trace(o.LogCategory.UTILS)],e,"playToneScript",null);r([o.LogManager.d_trace(o.LogCategory.UTILS)],e,"stopPlayback",null);r([o.LogManager.d_trace(o.LogCategory.UTILS)],e,"sendRequest",null);r([o.LogManager.d_trace(o.LogCategory.UTILS)],e,"getServers",null);r([o.LogManager.d_trace(o.LogCategory.UTILS)],e,"generateUUID",null);r([o.LogManager.d_trace(o.LogCategory.UTILS)],e,"_gri",null);r([o.LogManager.d_trace(o.LogCategory.UTILS)],e,"_ha",null);r([o.LogManager.d_trace(o.LogCategory.UTILS)],e,"filterXSS",null);r([o.LogManager.d_trace(o.LogCategory.UTILS)],e,"checkCA",null);return e}();t.Utils=c},function(e,t){"use strict";(function(e){e[e["NONE"]=0]="NONE";e[e["ERROR"]=1]="ERROR";e[e["WARNING"]=2]="WARNING";e[e["INFO"]=3]="INFO";e[e["TRACE"]=4]="TRACE"})(t.LogLevel||(t.LogLevel={}));var n=t.LogLevel;(function(e){e[e["SIGNALING"]=0]="SIGNALING";e[e["RTC"]=1]="RTC";e[e["USERMEDIA"]=2]="USERMEDIA";e[e["CALL"]=3]="CALL";e[e["CALLEXP2P"]=4]="CALLEXP2P";e[e["CALLEXSERVER"]=5]="CALLEXSERVER";e[e["CALLMANAGER"]=6]="CALLMANAGER";e[e["CLIENT"]=7]="CLIENT";e[e["AUTHENTICATOR"]=8]="AUTHENTICATOR";e[e["PCFACTORY"]=9]="PCFACTORY";e[e["UTILS"]=10]="UTILS";e[e["ORTC"]=11]="ORTC";e[e["MESSAGING"]=12]="MESSAGING"})(t.LogCategory||(t.LogCategory={}));var r=t.LogCategory;var o=function(){function e(e,t,n){this.category=e;this.label=t;this.provider=n}e.prototype.log=function(e,t){this.provider.writeMessage(this.category,this.label,e,t)};e.prototype.error=function(e){this.log(n.ERROR,e)};e.prototype.warning=function(e){this.log(n.WARNING,e)};e.prototype.info=function(e){this.log(n.INFO,e)};e.prototype.trace=function(e){this.log(n.TRACE,e)};return e}();t.Logger=o;var i=function(){function e(){this.levels={}}e.get=function(){if(typeof this.inst=="undefined"){this.inst=new e;this.inst.prettyPrint=false}return this.inst};e.prototype.setPrettyPrint=function(e){this.prettyPrint=e};e.prototype.setLogLevel=function(e,t){this.levels[r[e]]=t};e.prototype.writeMessage=function(t,o,i,a){e.tick++;var s=e.tick+" "+(new Date).toString()+" "+n[i]+" "+o+": "+a;var c=n.NONE;if(typeof this.levels[r[t]]!="undefined")c=this.levels[r[t]];if(i<=c){if(typeof console.debug!="undefined"&&typeof console.info!="undefined"&&typeof console.error!="undefined"&&typeof console.warn!="undefined"){if(this.prettyPrint){if(typeof a!="string")a=JSON.stringify(a);console.log("%c "+(new Date).toUTCString()+" ["+n[i]+"] %c"+o+": %c"+a.replace("\r\n","<br>"),"color:#ccc","color:#2375a2","color:#000")}else{if(i===n.ERROR)console.error(s);else if(i===n.WARNING)console.warn(s);else if(i===n.INFO)console.info(s);else if(i===n.TRACE)console.debug(s);else console.log(s)}}else console.log(s)}};e.prototype.createLogger=function(e,t){return new o(e,t,this);

};e.d_trace=function(t){return function(r,o,i){return{value:function(){var r=[];for(var a=0;a<arguments.length;a++){r[a-0]=arguments[a]}var s="";try{s=r.map(function(e){return JSON.stringify(e)}).join()}catch(c){s="circular structure"}var d=i.value.apply(this,r);var l;try{l=JSON.stringify(l)}catch(c){l="circular structure"}if(typeof l=="undefined")e.get().writeMessage(t,"",n.TRACE,"Call: "+o+"("+s+")");else e.get().writeMessage(t,"",n.TRACE,"Call: "+o+"("+s+") => "+l);return d}}}};e.tick=0;return e}();t.LogManager=i},function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var o=arguments.length,i=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,a;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")i=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)if(a=e[s])i=(o<3?a(i):o>3?a(t,n,i):a(t,n))||i;return o>3&&i&&Object.defineProperty(t,n,i),i};var o=n(6);var i=n(4);var a=n(13);var s=n(20);var c=n(24);var d=n(26);(function(e){e[e["IDLE"]=0]="IDLE";e[e["IN_PROGRESS"]=1]="IN_PROGRESS"})(t.AuthenticatorState||(t.AuthenticatorState={}));var l=t.AuthenticatorState;var u=function(){function e(){var e=this;this.FAIL_CODE_SECOND_STAGE=301;this.FAIL_CODE_ONE_TIME_KEY=302;this._displayName=null;this._username=null;this._authorized=false;this.signaling=o.VoxSignaling.get();this.currentState=l.IDLE;this.log=i.LogManager.get().createLogger(i.LogCategory.SIGNALING,"Authenticator");this.signaling.setRPCHandler(c.RemoteEvent.loginFailed,function(t,n){e.onLoginFailed(t,n)});this.signaling.setRPCHandler(c.RemoteEvent.loginSuccessful,function(t,n){e.onLoginSuccesful(t,n)});this.signaling.setRPCHandler(c.RemoteEvent.refreshOauthTokenFailed,function(t){e.handler.onRefreshTokenFailed(t)});this.signaling.setRPCHandler(c.RemoteEvent.refreshOauthTokenSuccessful,function(t){e.handler.onRefreshTokenSuccess(t.OAuth)});this.signaling.addHandler(this)}e.get=function(){if(typeof this.inst=="undefined"){this.inst=new e}return this.inst};e.prototype.setHandler=function(e){this.handler=e};e.prototype.onLoginFailed=function(e,t){this.currentState=l.IDLE;switch(e){case this.FAIL_CODE_ONE_TIME_KEY:this.handler.onOneTimeKeyGenerated(t);break;case this.FAIL_CODE_SECOND_STAGE:this.handler.onSecondStageInitiated();break;default:this.handler.onLoginFailed(e);break}};e.prototype.onLoginSuccesful=function(e,t){this.currentState=l.IDLE;this._authorized=true;if(t)a.PCFactory.get().iceConfig=t.iceConfig;this._displayName=e;d.CallstatsIo.get().init({userName:this._username,aliasName:this._displayName});this.handler.onLoginSuccessful(e,t.OAuth)};Object.defineProperty(e.prototype,"displayName",{get:function(){return this._displayName},enumerable:true,configurable:true});e.prototype.basicLogin=function(e,t,n){if(this.currentState!=l.IDLE){this.log.error("Login operation already in progress");return}this._username=e;this.currentState=l.IN_PROGRESS;this.signaling.callRemoteFunction(s.RemoteFunction.login,e,t,n)};e.prototype.tokenLogin=function(e,t){if(this.currentState!=l.IDLE){this.log.error("Login operation already in progress");return}this._username=e;this.currentState=l.IN_PROGRESS;this.signaling.callRemoteFunction(s.RemoteFunction.login,e,"",t)};e.prototype.tokenRefresh=function(e,t,n){if(n)this.signaling.callRemoteFunction(s.RemoteFunction.refreshOauthToken,e,{refreshToken:t,deviceToken:n});else this.signaling.callRemoteFunction(s.RemoteFunction.refreshOauthToken,e,t)};e.prototype.loginUsingOneTimeKey=function(e,t,n){if(this.currentState!=l.IDLE){this.log.error("Login operation already in progress");return}this._username=e;this.currentState=l.IN_PROGRESS;this.signaling.callRemoteFunction(s.RemoteFunction.loginUsingOneTimeKey,e,t,n)};e.prototype.loginStage2=function(e,t,n){if(this.currentState!=l.IDLE){this.log.error("Login operation already in progress");return}this._username=e;this.currentState=l.IN_PROGRESS;this.signaling.callRemoteFunction(s.RemoteFunction.loginStage2,e,t,n)};e.prototype.generateOneTimeKey=function(e){if(this.currentState!=l.IDLE){this.log.error("Login operation already in progress");return}this.currentState=l.IN_PROGRESS;this.signaling.callRemoteFunction(s.RemoteFunction.loginGenerateOneTimeKey,e)};e.prototype.username=function(){return this._username};e.prototype.authorized=function(){return this._authorized};e.prototype.onSignalingConnected=function(){};e.prototype.onSignalingConnectionFailed=function(e){};e.prototype.onSignalingClosed=function(){this._authorized=false;this._displayName=null;this._username=null};e.prototype.onMediaConnectionFailed=function(){};e.prototype.ziAuthorized=function(e){this._authorized=e};r([i.LogManager.d_trace(i.LogCategory.AUTHENTICATOR)],e.prototype,"setHandler",null);r([i.LogManager.d_trace(i.LogCategory.AUTHENTICATOR)],e.prototype,"onLoginFailed",null);r([i.LogManager.d_trace(i.LogCategory.AUTHENTICATOR)],e.prototype,"onLoginSuccesful",null);r([i.LogManager.d_trace(i.LogCategory.AUTHENTICATOR)],e.prototype,"basicLogin",null);r([i.LogManager.d_trace(i.LogCategory.AUTHENTICATOR)],e.prototype,"tokenLogin",null);r([i.LogManager.d_trace(i.LogCategory.AUTHENTICATOR)],e.prototype,"tokenRefresh",null);r([i.LogManager.d_trace(i.LogCategory.AUTHENTICATOR)],e.prototype,"loginUsingOneTimeKey",null);r([i.LogManager.d_trace(i.LogCategory.AUTHENTICATOR)],e.prototype,"loginStage2",null);r([i.LogManager.d_trace(i.LogCategory.AUTHENTICATOR)],e.prototype,"generateOneTimeKey",null);r([i.LogManager.d_trace(i.LogCategory.AUTHENTICATOR)],e.prototype,"username",null);r([i.LogManager.d_trace(i.LogCategory.AUTHENTICATOR)],e.prototype,"authorized",null);r([i.LogManager.d_trace(i.LogCategory.AUTHENTICATOR)],e.prototype,"onSignalingConnected",null);r([i.LogManager.d_trace(i.LogCategory.AUTHENTICATOR)],e.prototype,"onSignalingConnectionFailed",null);r([i.LogManager.d_trace(i.LogCategory.AUTHENTICATOR)],e.prototype,"onSignalingClosed",null);r([i.LogManager.d_trace(i.LogCategory.AUTHENTICATOR)],e.prototype,"onMediaConnectionFailed",null);return e}();t.Authenticator=u},function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var o=arguments.length,i=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,a;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")i=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)if(a=e[s])i=(o<3?a(i):o>3?a(t,n,i):a(t,n))||i;return o>3&&i&&Object.defineProperty(t,n,i),i};var o=n(4);var i=n(7);var a=n(13);var s=n(16);var c=n(20);var d=n(24);var l=n(34);var u=n(1);(function(e){e[e["IDLE"]=0]="IDLE";e[e["CONNECTING"]=1]="CONNECTING";e[e["WSCONNECTED"]=2]="WSCONNECTED";e[e["CONNECTED"]=3]="CONNECTED";e[e["CLOSING"]=4]="CLOSING"})(t.VoxSignalingState||(t.VoxSignalingState={}));var g=t.VoxSignalingState;var f=function(){function e(){var e=this;this.ver="3";this.handlers=[];this.rpcHandlers={};this.pingTimer=null;this.pongTimer=null;this.manualDisconnect=false;this.platform="platform";this.referrer="platform";this.extra="";this.writeLog=false;this._opLog=[];this.token="";this.log=o.LogManager.get().createLogger(o.LogCategory.SIGNALING,"VoxSignaling");this.currentState=g.IDLE;this.setRPCHandler(d.RemoteEvent.connectionSuccessful,function(t){e.onConnectionSuccessfulRPC(t)});this.setRPCHandler(d.RemoteEvent.connectionFailed,function(){e.onConnectionFailedRPC()});this.setRPCHandler(d.RemoteEvent.createConnection,function(t){e.onConnectionSuccessfulRPC(t)})}e.get=function(){if(typeof this.inst=="undefined"){this.inst=new e}return this.inst};e.prototype.addHandler=function(e){this.handlers.push(e)};e.prototype.close=function(){if(this.ws){this.ws.onclose=null;this.ws.close();this.onWSClosed(null)}else{this.log.warning("Try close unused WS in state "+g[this.currentState])}};e.prototype.cleanup=function(){a.PCFactory.get().closeAll();if(this.pingTimer)clearTimeout(this.pingTimer);if(this.pongTimer)clearTimeout(this.pongTimer)};e.prototype.onConnectionSuccessfulRPC=function(e){if(this.currentState!=g.WSCONNECTED){this.log.error("Can't handle __connectionSuccessful while in state "+g[this.currentState]);return}if(e)this.token=e;this.currentState=g.CONNECTED;if(this.handlers.length>0){for(var t=0;t<this.handlers.length;++t){try{this.handlers[t].onSignalingConnected()}catch(n){this.log.warning("Error in onSignalingConnected callback: "+n)}}}else{this.log.warning("No VoxSignaling handler specified")}};e.prototype.onConnectionFailedRPC=function(){if(this.currentState!=g.WSCONNECTED){this.log.error("Can't handle __connectionSuccessful while in state "+g[this.currentState]);return}this.ws.onerror=null;this.ws.close();this.ws=null;this.currentState=g.IDLE;if(this.handlers.length>0){for(var e=0;e<this.handlers.length;++e){try{this.handlers[e].onMediaConnectionFailed()}catch(t){this.log.warning("Error in onMediaConnectionFailed callback: "+t)}}}else{this.log.warning("No VoxSignaling handler specified")}};e.prototype.connectTo=function(e,t,n,r,o){var a=this;if(t===void 0){t=false}if(n===void 0){n=true}this.manualDisconnect=false;this.ver=o;if(this.currentState!=g.IDLE){this.log.error("Can't establish connection while in state "+g[this.currentState]);return}this.currentState=g.CONNECTING;var s=i.default.getWSVendor(r);this.ws=new WebSocket("ws"+(n?"s":"")+"://"+e+"/"+this.platform+"?version="+this.ver+"&client="+s+"&referrer="+this.referrer+"&referrer="+this.extra+"&video"+(t?"true":"false")+"&client_version="+u.Client.getInstance().version);this.ws.onopen=function(e){return a.onWSConnected(e)};this.ws.onclose=function(e){return a.onWSClosed(e)};this.ws.onerror=function(e){return a.onWSError(e)};this.ws.onmessage=function(e){return a.onWSData(e.data)}};e.prototype.setRPCHandler=function(e,t){if(typeof this.rpcHandlers[e]!="undefined"){this.log.warning("Overwriting RPC handler for function "+e)}this.rpcHandlers[e]=t};e.prototype.removeRPCHandler=function(e){if(typeof this.rpcHandlers[e]=="undefined"){this.log.warning("There is no RPC handler for function "+e)}delete this.rpcHandlers[e]};e.prototype.callRemoteFunction=function(e){var t=[];for(var n=1;n<arguments.length;n++){t[n-1]=arguments[n]}if(this.currentState!=g.CONNECTED&&this.currentState!=g.WSCONNECTED){this.log.error("Can't make a RPC call in state "+g[this.currentState]);return false}if(typeof this.ws!="undefined"){if(this.writeLog)this._opLog.push("send:"+JSON.stringify({name:e,params:t}));var r=JSON.stringify({name:e,params:t});this.ws.send(r);o.LogManager.get().writeMessage(o.LogCategory.SIGNALING,"[wsdataout]",o.LogLevel.INFO,r);return true}};e.prototype.onWSData=function(e){o.LogManager.get().writeMessage(o.LogCategory.SIGNALING,"[wsdatain]",o.LogLevel.INFO,e);if(this.writeLog)this._opLog.push("recv:"+e);var t;try{t=JSON.parse(e)}catch(n){this.log.error("Can't parse JSON data: "+e);return}if(typeof t["service"]!="undefined")this.onWSMessData(t);else this.onWSVoipData(t)};e.prototype.onWSMessData=function(e){l.MsgSignaling.get().handleWsData(e)};e.prototype.onWSVoipData=function(e){var t=e["name"];var n=e["params"];if(typeof this.rpcHandlers[t]!="undefined"){try{this.rpcHandlers[t].apply(null,n)}catch(r){this.log.warning("Error in '"+t+"' handler : "+r)}}else{this.log.warning("No handler for "+t)}};e.prototype.disconnect=function(){this.manualDisconnect=true;this.onWSClosed(null);this.cleanup()};e.prototype.onWSClosed=function(e){if(this.currentState!=g.CONNECTED&&this.currentState!=g.CONNECTING&&this.currentState!=g.CLOSING){this.log.warning("onWSClosed in state "+g[this.currentState])}if(this.ws){this.ws.close();delete this.ws}var t=this.currentState;if(this.pingTimer){clearTimeout(this.pingTimer)}if(this.pongTimer){clearTimeout(this.pongTimer)}this.cleanup();this.currentState=g.IDLE;if(this.handlers.length>0){for(var n=0;n<this.handlers.length;++n){if((t==g.CONNECTING||t==g.WSCONNECTED||t==g.IDLE)&&!this.manualDisconnect){try{this.handlers[n].onSignalingConnectionFailed(e.reason)}catch(e){this.log.warning("Error in onSignalingConnectionFailed callback: "+e)}}else{try{this.handlers[n].onSignalingClosed()}catch(e){this.log.warning("Error in onSignalingClosed callback: "+e)}}}}else{this.log.warning("No VoxSignaling handler specified")}};e.prototype.onWSConnected=function(t){var n=this;if(this.currentState!=g.CONNECTING){this.log.warning("onWSConnected in state "+g[this.currentState])}this.currentState=g.WSCONNECTED;this.pingTimer=setTimeout(function(){return n.doPing()},e.PING_DELAY);this.setRPCHandler(d.RemoteEvent.pong,function(){return n.pongReceived()});this.setRPCHandler(d.RemoteEvent.increaseGain,function(){n.log.info("Deprecated increaseGain")})};e.prototype.onWSError=function(e){if(this.currentState!=g.CONNECTING){this.log.warning("onWSError in state "+this.currentState)}this.ws.close();delete this.ws;if(this.pingTimer){clearTimeout(this.pingTimer)}if(this.pongTimer){clearTimeout(this.pongTimer)}this.cleanup();this.currentState=g.IDLE;if(typeof this.handlers!="undefined"){for(var t=0;t<this.handlers.length;++t){try{this.handlers[t].onSignalingConnectionFailed("Error connecting to VoxImplant server")}catch(e){this.log.warning("Error in onSignalingConnectionFailed callback: "+e)}}}else{this.log.warning("No VoxSignaling handler specified")}};e.prototype.doPing=function(){var t=this;this.pingTimer=null;this.callRemoteFunction(c.RemoteFunction.ping,[]);this.pongTimer=setTimeout(function(){if(s.CallManager.get().numCalls>0){t.pongReceived();return}t.pongTimer=null;t.currentState=g.IDLE;for(var e=0;e<t.handlers.length;++e){if(t.currentState==g.CONNECTED){try{t.handlers[e].onSignalingClosed()}catch(n){t.log.warning("Error in onSignalingClosed callback: "+n)}}else{try{t.handlers[e].onSignalingConnectionFailed("Connection closed")}catch(n){t.log.warning("Error in onSignalingConnectionFailed callback: "+n)}}}},e.PING_DELAY)};e.prototype.pongReceived=function(){var t=this;if(this.pongTimer){clearTimeout(this.pongTimer);this.pongTimer=null;this.pingTimer=setTimeout(function(){return t.doPing()},e.PING_DELAY)}};e.prototype.sendRaw=function(e){if(this.writeLog)this._opLog.push("send:"+JSON.stringify(e));var t=JSON.stringify(e);this.ws.send(t);o.LogManager.get().writeMessage(o.LogCategory.SIGNALING,"[wsdataout]",o.LogLevel.INFO,t);return true};e.prototype.getLog=function(){return this._opLog};e.prototype.lagacyConnectTo=function(e,t,n,r){this.ver="2";this.platform=r;this.referrer=t;this.connectTo(e,false,true,true,"2")};e.PING_DELAY=3e4;r([o.LogManager.d_trace(o.LogCategory.SIGNALING)],e.prototype,"addHandler",null);r([o.LogManager.d_trace(o.LogCategory.SIGNALING)],e.prototype,"close",null);r([o.LogManager.d_trace(o.LogCategory.SIGNALING)],e.prototype,"cleanup",null);r([o.LogManager.d_trace(o.LogCategory.SIGNALING)],e.prototype,"onConnectionSuccessfulRPC",null);r([o.LogManager.d_trace(o.LogCategory.SIGNALING)],e.prototype,"onConnectionFailedRPC",null);r([o.LogManager.d_trace(o.LogCategory.SIGNALING)],e.prototype,"connectTo",null);r([o.LogManager.d_trace(o.LogCategory.SIGNALING)],e.prototype,"setRPCHandler",null);r([o.LogManager.d_trace(o.LogCategory.SIGNALING)],e.prototype,"removeRPCHandler",null);r([o.LogManager.d_trace(o.LogCategory.SIGNALING)],e.prototype,"callRemoteFunction",null);r([o.LogManager.d_trace(o.LogCategory.SIGNALING)],e.prototype,"onWSData",null);r([o.LogManager.d_trace(o.LogCategory.SIGNALING)],e.prototype,"onWSMessData",null);r([o.LogManager.d_trace(o.LogCategory.SIGNALING)],e.prototype,"onWSVoipData",null);r([o.LogManager.d_trace(o.LogCategory.SIGNALING)],e.prototype,"disconnect",null);r([o.LogManager.d_trace(o.LogCategory.SIGNALING)],e.prototype,"onWSClosed",null);r([o.LogManager.d_trace(o.LogCategory.SIGNALING)],e.prototype,"onWSConnected",null);r([o.LogManager.d_trace(o.LogCategory.SIGNALING)],e.prototype,"onWSError",null);r([o.LogManager.d_trace(o.LogCategory.SIGNALING)],e.prototype,"doPing",null);r([o.LogManager.d_trace(o.LogCategory.SIGNALING)],e.prototype,"pongReceived",null);return e}();t.VoxSignaling=f},function(e,t,n){"use strict";var r=n(4);var o=n(8);var i=n(28);var a=n(29);var s=n(32);var c=n(27);var d=n(33);var l;(function(e){var t;(function(e){e[e["Firefox"]=1]="Firefox";e[e["Webkit"]=2]="Webkit";e[e["Edge"]=3]="Edge";e[e["Safari"]=4]="Safari"})(t||(t={}));var n;function l(e,t,n){var r=e;if(typeof r!="object"){r={}}r[t]={ideal:n};return r}function u(e,o,i){switch(n){case t.Firefox:return new a.WebRTCPC(e,o,i);case t.Webkit:return new a.WebRTCPC(e,o,i);case t.Safari:return new a.WebRTCPC(e,o,i);case t.Edge:return new a.WebRTCPC(e,o,i);default:r.LogManager.get().writeMessage(r.LogCategory.RTC,"Core",r.LogLevel.INFO,"Unsupported browser "+navigator.userAgent);return null}}e.peerConnectionFactory=u;function g(){return n===t.Firefox||n===t.Webkit}e.isScreenSharingSupported=g;function f(e){return navigator.mediaDevices.getUserMedia(e)}function p(e,t){return new c.SignalingDTMFSender(t)}function h(e){var t=false;var n=false;if(e.audioEnabled){t=true;if(e.audioInputId)t=l(t,"deviceId",e.audioInputId)}if(e.videoEnabled){n=true;if(e.videoSettings){n=e.videoSettings}if(e.videoInputId)n=l(n,"deviceId",e.videoInputId)}return{peerIdentity:null,audio:t,video:n}}function v(e){if(e===void 0){e=true}if(e===false){return"voxmobile"}if(!n){m()}switch(n){case t.Firefox:return"firefox";case t.Webkit:return"chrome";case t.Safari:return"safari";case t.Edge:return"voxmobile";default:return""}}e.getWSVendor=v;function m(){if(navigator["mozGetUserMedia"]){n=t.Firefox}else if(navigator["webkitGetUserMedia"]){n=t.Webkit}else if(navigator.mediaDevices&&navigator.userAgent.match(/Edge\/(\d+).(\d+)$/)){n=t.Edge}else if(navigator["getUserMedia"]){n=t.Safari}}function C(){}function y(){if(!n){m()}if(n){r.LogManager.get().writeMessage(r.LogCategory.RTC,"Core",r.LogLevel.INFO,"Detected browser "+t[n])}e.getUserMedia=f;e.getDTMFSender=p;switch(n){case t.Firefox:e.attachMedia=o.FF.attachStream;e.detachMedia=o.FF.detachStream;e.getScreenMedia=o.FF.getScreenMedia;e.getRTCStats=o.FF.getRTCStats;e.getUserMedia=o.FF.getUserMedia;e.getDTMFSender=o.FF.getDTMFSender;break;case t.Webkit:e.attachMedia=i.Webkit.attachStream;e.detachMedia=i.Webkit.detachStream;e.getScreenMedia=i.Webkit.getScreenMedia;e.getRTCStats=i.Webkit.getRTCStats;e.getUserMedia=o.FF.getUserMedia;e.getDTMFSender=i.Webkit.getDTMFSender;break;case t.Safari:e.attachMedia=d.Safari.attachStream;e.detachMedia=d.Safari.detachStream;e.getScreenMedia=d.Safari.getScreenMedia;e.getRTCStats=d.Safari.getRTCStats;e.getUserMedia=o.FF.getUserMedia;e.getDTMFSender=d.Safari.getDTMFSender;break;case t.Edge:e.attachMedia=s.Edge.attachStream;e.detachMedia=s.Edge.detachStream;e.getScreenMedia=s.Edge.getScreenMedia;e.getRTCStats=s.Edge.getRTCStats;break;default:r.LogManager.get().writeMessage(r.LogCategory.RTC,"Core",r.LogLevel.INFO,"Unsupported browser "+navigator.userAgent)}e.composeConstraints=h}e.init=y})(l||(l={}));Object.defineProperty(t,"__esModule",{value:true});t.default=l},function(e,t,n){"use strict";var r=n(9);var o=n(10);var i=n(27);var a=function(){function e(){}e.attachStream=function(e,t){t["mozSrcObject"]=e;t.load();t.play()};e.detachStream=function(e){e["mozSrcObject"]=null;e.load();e.src=""};e.getScreenMedia=function(){return navigator.mediaDevices.getUserMedia({audio:false,video:{mediaSource:"window"||"screen"}})};e.getRTCStats=function(e){return new Promise(function(t,n){e.getStats().then(function(e){var n=[];e.forEach(function(e){if(e.type=="inboundrtp"||e.type=="outboundrtp")n.push(e)});t(n)}).catch(n)})};e.getUserMedia=function(e){return new Promise(function(t,n){var i=new MediaStream;var a=o.MediaCache.get();var s=[];new Promise(function(t,n){var o=[];if(typeof e.audio!=="undefined"&&e.audio!==false){var i=r.Md5.hashStr(JSON.stringify(e.audio));a.getTrack(i,"audio").then(function(n){if(typeof n!=="undefined"&&n.readyState!=="ended"){o.push(n);t(o)}else{var r=JSON.parse(JSON.stringify(e));r.video=false;navigator.mediaDevices.getUserMedia(r).then(function(e){for(var n=0,r=e.getTracks();n<r.length;n++){var s=r[n];a.setTrack(i,"audio",s);o.push(s)}t(o)}).catch(function(e){t([])})}})}else{t([])}}).then(function(t){return new Promise(function(n,o){if(typeof e.video!=="undefined"&&e.video!==false){var i=r.Md5.hashStr(JSON.stringify(e.video));s.push(new Promise(function(r,o){a.getTrack(i,"video").then(function(r){if(typeof r!=="undefined"&&r.readyState!=="ended"){t.push(r);n(t)}else{var o=JSON.parse(JSON.stringify(e));o.audio=false;navigator.mediaDevices.getUserMedia(o).then(function(e){for(var r=0,o=e.getTracks();r<o.length;r++){var s=o[r];a.setTrack(i,"video",s);t.push(s);n(t)}}).catch(function(e){n(t)})}})}))}else{n(t)}})}).then(function(e){for(var r=0,o=e;r<o.length;r++){var a=o[r];if(typeof a!=="undefined")i.addTrack(a)}if(e.length>0)t(i);else n()}).catch(function(e){n(e)})})};e.getDTMFSender=function(e,t){var n=/Firefox\/([0-9\.]+)(?:\s|$)/;var r=navigator.userAgent;if(n.test(r)){var o=n.exec(r);var a=o[1].split(".");if(+a[0]>=53){var s=e.getSenders().map(function(e){if(e.track.kind==="audio"&&!!e.dtmf)return e.dtmf});if(s.length>0)return s[0]}}return new i.SignalingDTMFSender(t)};return e}();t.FF=a},function(e,t){var n=function(){function e(){this._state=new Int32Array(4);this._buffer=new ArrayBuffer(68);this._buffer8=new Uint8Array(this._buffer,0,68);this._buffer32=new Uint32Array(this._buffer,0,17);this.start()}e.hashStr=function(e,t){if(t===void 0){t=false}return this.onePassHasher.start().appendStr(e).end(t)};e.hashAsciiStr=function(e,t){if(t===void 0){t=false}return this.onePassHasher.start().appendAsciiStr(e).end(t)};e.prototype.start=function(){this._dataLength=0;this._bufferLength=0;this._state.set(e.stateIdentity);return this};e.prototype.appendStr=function(t){var n=this._buffer8,r=this._buffer32,o=this._bufferLength,i,a;for(a=0;a<t.length;a+=1){i=t.charCodeAt(a);if(i<128){n[o++]=i}else if(i<2048){n[o++]=(i>>>6)+192;n[o++]=i&63|128}else if(i<55296||i>56319){n[o++]=(i>>>12)+224;n[o++]=i>>>6&63|128;n[o++]=i&63|128}else{i=(i-55296)*1024+(t.charCodeAt(++a)-56320)+65536;if(i>1114111){throw"Unicode standard supports code points up to U+10FFFF"}n[o++]=(i>>>18)+240;n[o++]=i>>>12&63|128;n[o++]=i>>>6&63|128;n[o++]=i&63|128}if(o>=64){this._dataLength+=64;e._md5cycle(this._state,r);o-=64;r[0]=r[16]}}this._bufferLength=o;return this};e.prototype.appendAsciiStr=function(t){var n=this._buffer8,r=this._buffer32,o=this._bufferLength,i,a=0;for(;;){i=Math.min(t.length-a,64-o);while(i--){n[o++]=t.charCodeAt(a++)}if(o<64){break}this._dataLength+=64;e._md5cycle(this._state,r);o=0}this._bufferLength=o;return this};e.prototype.appendByteArray=function(t){var n=this._buffer8,r=this._buffer32,o=this._bufferLength,i,a=0;for(;;){i=Math.min(t.length-a,64-o);while(i--){n[o++]=t[a++]}if(o<64){break}this._dataLength+=64;e._md5cycle(this._state,r);o=0}this._bufferLength=o;return this};e.prototype.getState=function(){var e=this,t=e._state;return{buffer:String.fromCharCode.apply(null,e._buffer8),buflen:e._bufferLength,length:e._dataLength,state:[t[0],t[1],t[2],t[3]]}};e.prototype.setState=function(e){var t=e.buffer,n=e.state,r=this._state,o;this._dataLength=e.length;this._bufferLength=e.buflen;r[0]=n[0];r[1]=n[1];r[2]=n[2];r[3]=n[3];for(o=0;o<t.length;o+=1){this._buffer8[o]=t.charCodeAt(o)}};e.prototype.end=function(t){if(t===void 0){t=false}var n=this._bufferLength,r=this._buffer8,o=this._buffer32,i=(n>>2)+1,a;this._dataLength+=n;r[n]=128;r[n+1]=r[n+2]=r[n+3]=0;o.set(e.buffer32Identity.subarray(i),i);if(n>55){e._md5cycle(this._state,o);o.set(e.buffer32Identity)}a=this._dataLength*8;if(a<=4294967295){o[14]=a}else{var s=a.toString(16).match(/(.*?)(.{0,8})$/),c=parseInt(s[2],16),d=parseInt(s[1],16)||0;o[14]=c;o[15]=d}e._md5cycle(this._state,o);return t?this._state:e._hex(this._state)};e._hex=function(t){var n=e.hexChars,r=e.hexOut,o,i,a,s;for(s=0;s<4;s+=1){i=s*8;o=t[s];for(a=0;a<8;a+=2){r[i+1+a]=n.charAt(o&15);o>>>=4;r[i+0+a]=n.charAt(o&15);o>>>=4}}return r.join("")};e._md5cycle=function(e,t){var n=e[0],r=e[1],o=e[2],i=e[3];n+=(r&o|~r&i)+t[0]-680876936|0;n=(n<<7|n>>>25)+r|0;i+=(n&r|~n&o)+t[1]-389564586|0;i=(i<<12|i>>>20)+n|0;o+=(i&n|~i&r)+t[2]+606105819|0;o=(o<<17|o>>>15)+i|0;r+=(o&i|~o&n)+t[3]-1044525330|0;r=(r<<22|r>>>10)+o|0;n+=(r&o|~r&i)+t[4]-176418897|0;n=(n<<7|n>>>25)+r|0;i+=(n&r|~n&o)+t[5]+1200080426|0;i=(i<<12|i>>>20)+n|0;o+=(i&n|~i&r)+t[6]-1473231341|0;o=(o<<17|o>>>15)+i|0;r+=(o&i|~o&n)+t[7]-45705983|0;r=(r<<22|r>>>10)+o|0;n+=(r&o|~r&i)+t[8]+1770035416|0;n=(n<<7|n>>>25)+r|0;i+=(n&r|~n&o)+t[9]-1958414417|0;i=(i<<12|i>>>20)+n|0;o+=(i&n|~i&r)+t[10]-42063|0;o=(o<<17|o>>>15)+i|0;r+=(o&i|~o&n)+t[11]-1990404162|0;r=(r<<22|r>>>10)+o|0;n+=(r&o|~r&i)+t[12]+1804603682|0;n=(n<<7|n>>>25)+r|0;i+=(n&r|~n&o)+t[13]-40341101|0;i=(i<<12|i>>>20)+n|0;o+=(i&n|~i&r)+t[14]-1502002290|0;o=(o<<17|o>>>15)+i|0;r+=(o&i|~o&n)+t[15]+1236535329|0;r=(r<<22|r>>>10)+o|0;n+=(r&i|o&~i)+t[1]-165796510|0;n=(n<<5|n>>>27)+r|0;i+=(n&o|r&~o)+t[6]-1069501632|0;i=(i<<9|i>>>23)+n|0;o+=(i&r|n&~r)+t[11]+643717713|0;o=(o<<14|o>>>18)+i|0;r+=(o&n|i&~n)+t[0]-373897302|0;r=(r<<20|r>>>12)+o|0;n+=(r&i|o&~i)+t[5]-701558691|0;n=(n<<5|n>>>27)+r|0;i+=(n&o|r&~o)+t[10]+38016083|0;i=(i<<9|i>>>23)+n|0;o+=(i&r|n&~r)+t[15]-660478335|0;o=(o<<14|o>>>18)+i|0;r+=(o&n|i&~n)+t[4]-405537848|0;r=(r<<20|r>>>12)+o|0;n+=(r&i|o&~i)+t[9]+568446438|0;n=(n<<5|n>>>27)+r|0;i+=(n&o|r&~o)+t[14]-1019803690|0;i=(i<<9|i>>>23)+n|0;o+=(i&r|n&~r)+t[3]-187363961|0;o=(o<<14|o>>>18)+i|0;r+=(o&n|i&~n)+t[8]+1163531501|0;r=(r<<20|r>>>12)+o|0;n+=(r&i|o&~i)+t[13]-1444681467|0;n=(n<<5|n>>>27)+r|0;i+=(n&o|r&~o)+t[2]-51403784|0;i=(i<<9|i>>>23)+n|0;o+=(i&r|n&~r)+t[7]+1735328473|0;o=(o<<14|o>>>18)+i|0;r+=(o&n|i&~n)+t[12]-1926607734|0;r=(r<<20|r>>>12)+o|0;n+=(r^o^i)+t[5]-378558|0;n=(n<<4|n>>>28)+r|0;i+=(n^r^o)+t[8]-2022574463|0;i=(i<<11|i>>>21)+n|0;o+=(i^n^r)+t[11]+1839030562|0;o=(o<<16|o>>>16)+i|0;r+=(o^i^n)+t[14]-35309556|0;r=(r<<23|r>>>9)+o|0;n+=(r^o^i)+t[1]-1530992060|0;n=(n<<4|n>>>28)+r|0;i+=(n^r^o)+t[4]+1272893353|0;i=(i<<11|i>>>21)+n|0;o+=(i^n^r)+t[7]-155497632|0;o=(o<<16|o>>>16)+i|0;r+=(o^i^n)+t[10]-1094730640|0;r=(r<<23|r>>>9)+o|0;n+=(r^o^i)+t[13]+681279174|0;n=(n<<4|n>>>28)+r|0;i+=(n^r^o)+t[0]-358537222|0;i=(i<<11|i>>>21)+n|0;o+=(i^n^r)+t[3]-722521979|0;o=(o<<16|o>>>16)+i|0;r+=(o^i^n)+t[6]+76029189|0;r=(r<<23|r>>>9)+o|0;n+=(r^o^i)+t[9]-640364487|0;n=(n<<4|n>>>28)+r|0;i+=(n^r^o)+t[12]-421815835|0;i=(i<<11|i>>>21)+n|0;o+=(i^n^r)+t[15]+530742520|0;o=(o<<16|o>>>16)+i|0;r+=(o^i^n)+t[2]-995338651|0;r=(r<<23|r>>>9)+o|0;n+=(o^(r|~i))+t[0]-198630844|0;n=(n<<6|n>>>26)+r|0;i+=(r^(n|~o))+t[7]+1126891415|0;i=(i<<10|i>>>22)+n|0;o+=(n^(i|~r))+t[14]-1416354905|0;o=(o<<15|o>>>17)+i|0;r+=(i^(o|~n))+t[5]-57434055|0;r=(r<<21|r>>>11)+o|0;n+=(o^(r|~i))+t[12]+1700485571|0;n=(n<<6|n>>>26)+r|0;i+=(r^(n|~o))+t[3]-1894986606|0;i=(i<<10|i>>>22)+n|0;o+=(n^(i|~r))+t[10]-1051523|0;o=(o<<15|o>>>17)+i|0;r+=(i^(o|~n))+t[1]-2054922799|0;r=(r<<21|r>>>11)+o|0;n+=(o^(r|~i))+t[8]+1873313359|0;n=(n<<6|n>>>26)+r|0;i+=(r^(n|~o))+t[15]-30611744|0;i=(i<<10|i>>>22)+n|0;o+=(n^(i|~r))+t[6]-1560198380|0;o=(o<<15|o>>>17)+i|0;r+=(i^(o|~n))+t[13]+1309151649|0;r=(r<<21|r>>>11)+o|0;n+=(o^(r|~i))+t[4]-145523070|0;n=(n<<6|n>>>26)+r|0;i+=(r^(n|~o))+t[11]-1120210379|0;i=(i<<10|i>>>22)+n|0;o+=(n^(i|~r))+t[2]+718787259|0;o=(o<<15|o>>>17)+i|0;r+=(i^(o|~n))+t[9]-343485551|0;r=(r<<21|r>>>11)+o|0;e[0]=n+e[0]|0;e[1]=r+e[1]|0;e[2]=o+e[2]|0;e[3]=i+e[3]|0};e.stateIdentity=new Int32Array([1732584193,-271733879,-1732584194,271733878]);e.buffer32Identity=new Int32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);e.hexChars="0123456789abcdef";e.hexOut=[];e.onePassHasher=new e;return e}();t.Md5=n;if(n.hashStr("hello")!=="5d41402abc4b2a76b9719d911017c592"){console.error("Md5 self test failed.")}},function(e,t,n){"use strict";var r=n(11);var o=function(){function e(){this.audioCache={};this.videoCache={}}e.get=function(){if(!this.inst)this.inst=new e;return this.inst};e.prototype.clear=function(){for(var e=0,t=this.videoCache;e<t.length;e++){var n=t[e];n.stop()}for(var r=0,o=this.audioCache;r<o.length;r++){var n=o[r];n.stop()}};e.prototype.getTrack=function(e,t){var n=this;return new Promise(function(r,o){if(e=="")e="def";switch(t){case"audio":r(n.audioCache[e]);break;case"video":r(n.videoCache[e]);break;default:r();break}})};e.prototype.setTrack=function(t,n,r){if(t=="")t="def";switch(n){case"audio":this.audioCache[t]=r;break;case"video":this.videoCache[t]=r;break;default:return}r.onmute=function(t){e.get().removeTrackByTrack(t.target)}};e.prototype.removeTrackByTrack=function(e){switch(e.kind){case"audio":this.deleteTrackFromCache(this.audioCache,e);break;case"video":this.deleteTrackFromCache(this.videoCache,e);break;default:return}r.UserMediaManager.get().resetLocalVideo()};e.prototype.deleteTrackFromCache=function(e,t){for(var n in e){if(e.hasOwnProperty(n)){if(e[n].id===t.id)delete e[n]}}t.stop()};e.prototype.getAudioCache=function(){return this.audioCache};e.prototype.getVideoCache=function(){return this.videoCache};return e}();t.MediaCache=o},function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var o=arguments.length,i=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,a;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")i=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)if(a=e[s])i=(o<3?a(i):o>3?a(t,n,i):a(t,n))||i;return o>3&&i&&Object.defineProperty(t,n,i),i};var o=n(4);var i=n(12);var a=n(7);var s=n(13);var c=n(1);(function(e){e[e["LOCAL"]=-1]="LOCAL";e[e["ANY"]=0]="ANY";e[e["REMOTE"]=1]="REMOTE"})(t.MediaDirection||(t.MediaDirection={}));var d=t.MediaDirection;var l=function(){function e(){this.audioSourcesList=[];this.videoSourcesList=[];this.audioOutputsList=[];this.videoContainerId="voximplantlocalvideo";this.log=o.LogManager.get().createLogger(o.LogCategory.USERMEDIA,"");this.config=new i.MediaCaptureConfig;this.clearConstraints();this.enableAudio(true);this.enableVideo(true);this.handlers=new Array;this.mediaAccessGranted=false;this._localVideos=new Array;if(typeof window.AudioContext!="undefined"||typeof window.webkitAudioContext!="undefined"){window.AudioContext=window.AudioContext||window.webkitAudioContext;this.audioContext=new AudioContext}}e.get=function(){if(!this.inst)this.inst=new e;return this.inst};e.prototype.clearConstraints=function(){};e.prototype.addHandler=function(e){this.handlers.push(e)};e.prototype.enableAudio=function(e){this.config.audioEnabled=e};e.prototype.enableVideo=function(e){this.config.videoEnabled=e};e.prototype.setLocalStream=function(e){if(e.getAudioTracks().length>0){this.currentAudioTrack=e.getAudioTracks()[0]}if(e.getVideoTracks().length>0){this.currentVideoTrack=e.getVideoTracks()[0]}if(!this._currentStream){this._currentStream=e}else{while(this._currentStream.getTracks().length>0)this._currentStream.removeTrack(this._currentStream.getTracks()[0]);if(this.currentAudioTrack)this._currentStream.addTrack(this.currentAudioTrack);if(this.currentVideoTrack)this._currentStream.addTrack(this.currentVideoTrack)}for(var t in s.PCFactory.get().peerConnections){this.attachTo(s.PCFactory.get().peerConnections[t])}};e.prototype.queryMedia=function(){var e=a.default.composeConstraints(this.config);this.muteAllLocal();return this.getQueryMedia(e)};e.prototype.queryMediaSilent=function(){var e=a.default.composeConstraints(this.config);this.muteAllLocal();return this.getQueryMediaSilent(e)};e.prototype.getConstrainWithSendFlag=function(e,t){var n=JSON.parse(JSON.stringify(this.config));if(e!=null)n.audioEnabled=e;if(t!=null)n.videoEnabled=t;return a.default.composeConstraints(n)};e.prototype.getQueryMedia=function(e){var t=this;return new Promise(function(n,r){a.default.getUserMedia(e).then(function(r){t.validConstraints=e;t.mediaAccessGranted=true;t.log.info("Media access granted");t.processGrantedMedia(r);n(r)}).catch(function(e){t.handlers.forEach(function(e){try{e.onMediaAccessRejected()}catch(n){t.log.error("Error in callback "+n)}});if(e.name)t.log.info("Media access rejected: "+e.name);else t.log.info("Media access rejected");if(t.validConstraints){a.default.getUserMedia(t.validConstraints).then(function(e){t.log.info("Regained media access using previous settings");t.processGrantedMedia(e);n(e);

}).catch(function(e){r(e);t.log.error("Failed to regain media access with previously valid constraints")})}r(e)})})};e.prototype.getQueryMediaSilent=function(e){var t=this;return new Promise(function(n,r){a.default.getUserMedia(e).then(function(r){t.validConstraints=e;t.log.info("Media access granted");n(r)}).catch(function(e){t.log.info("Media access rejected: "+e.name);if(t.validConstraints){a.default.getUserMedia(t.validConstraints).then(function(e){t.log.info("Regained media access using previous settings");n(e)}).catch(function(e){r(e);t.log.error("Failed to regain media access with previously valid constraints")})}r(e)})})};e.prototype.processGrantedMedia=function(e){var t=this;this.stopLocalStream();this.setLocalStream(e);this.handlers.forEach(function(n){try{n.onMediaAccessGranted(e)}catch(r){t.log.error("Error in callback "+r)}})};e.prototype.muteAllLocal=function(){if(this.currentAudioTrack){this.currentAudioTrack.stop();this.currentAudioTrack=null}if(this.currentVideoTrack){this.currentVideoTrack.stop();this.currentVideoTrack=null}};e.prototype.getDevices=function(){if(e.get().audioSourcesList.length!==0)this.audioSourcesList=[];if(e.get().videoSourcesList.length!==0)this.videoSourcesList=[];if(e.get().audioOutputsList.length!==0)this.audioOutputsList=[];var t=new Promise(function(t,n){navigator.mediaDevices.enumerateDevices().then(function(n){for(var r=0;r!=n.length;++r){var o=[0,0,0];var i=n[r];if(i.kind==="audio"||i.kind==="audioinput")e.get().audioSourcesList.push({id:i.id||i.deviceId,name:i.label||"Audio recording device "+o[0]++});else if(i.kind==="video"||i.kind==="videoinput")e.get().videoSourcesList.push({id:i.id||i.deviceId,name:i.label||"Video recording device "+o[1]++});else if(i.kind==="audiooutput")e.get().audioOutputsList.push({id:i.id||i.deviceId,name:i.label||"Audio playback device "+o[2]++})}t()}).catch(function(e){n(e)})});return t};e.prototype.useVideoDevice=function(e){this.config.videoInputId=e};e.prototype.useAudioInputDevice=function(e){this.config.audioInputId=e};Object.defineProperty(e.prototype,"currentStream",{get:function(){return this._currentStream},enumerable:true,configurable:true});e.prototype.attachTo=function(e){this._legacySoundControll=true;e.bindLocalMedia(this._currentStream)};e.prototype.attachToSound=function(e){this._legacySoundControll=true;e.bindLocalMedia(new MediaStream(this._currentStream.getAudioTracks()))};Object.defineProperty(e.prototype,"legacySoundControll",{get:function(){return this._legacySoundControll},enumerable:true,configurable:true});e.prototype.sendVideo=function(e){if(this.currentVideoTrack)this.currentVideoTrack.enabled=e};e.prototype.isVideoEnabled=function(){return this.config.videoEnabled};e.updateMuteState=function(t,n,r){var o=s.PCFactory.get().peerConnections;for(var i in o){switch(n){case d.ANY:this.updateMuteState(t,d.LOCAL,r);this.updateMuteState(t,d.REMOTE,r);break;case d.LOCAL:e.getAudioTracks(o[i].localStream).map(function(e){e.enabled=r});break;case d.REMOTE:o[i].remoteStreams.map(function(t){e.getAudioTracks(t).map(function(e){e.enabled=r})});return;default:return false}}};e.prototype.stopLocalStream=function(){if(this._currentStream){this.stopStream(this._currentStream);this._currentStream=null;for(var e in s.PCFactory.get().peerConnections)s.PCFactory.get().peerConnections[e].bindLocalMedia(null)}};e.prototype.stopStream=function(e){e.getTracks().forEach(function(e){e.stop()})};e.prototype.setConstraints=function(e,t){var n=this;this.config.videoEnabled=true;return new Promise(function(r,o){n.config.setVideoSettings(e);if(t===true)n.queryMedia().then(function(e){r(e)}).catch(function(e){o(e)})})};e.getAudioTracks=function(e){if(e){if(e.audioTracks)return e.audioTracks;if(e.getAudioTracks)return e.getAudioTracks()}return null};e.getVideoTracks=function(e){if(e){if(e.videoTracks)return e.videoTracks;if(e.getVideoTracks)return e.getVideoTracks()}return null};e.prototype.showLocalVideo=function(t,n,r){var o=this;if(t===void 0){t=true}if(n===void 0){n=false}if(r===void 0){r=false}this.currentLocalVideoSets={flag:t,mirror:n,detachCamera:r};if(typeof this.currentStream!="undefined"){var i=document.getElementById(c.Client.getInstance().localVideoContainerId)||document.body;var s=document.getElementById(this.videoContainerId);if(t){if(s===null){s=document.createElement("video");s.id=this.videoContainerId;s.autoplay=true;s.muted=true;if(i.firstChild)i.insertBefore(s,i.firstChild);else i.appendChild(s)}else{s.style.display="block"}a.default.getUserMedia(e.get().getConstrainWithSendFlag(false,true)).then(function(e){o._localVideos.push(e);a.default.attachMedia(e,s)})}else{s.style.display="none";if(r)for(var d=0;d<this._localVideos.length;d++)this.stopStream(this._localVideos[d])}if(n)s.style.cssText+="transform: rotateY(180deg);"+"-webkit-transform:rotateY(180deg);"+"-moz-transform:rotateY(180deg);"}};e.prototype.resetLocalVideo=function(){this._localVideos=[];this.showLocalVideo(this.currentLocalVideoSets.flag,this.currentLocalVideoSets.mirror,this.currentLocalVideoSets.detachCamera)};e.prototype.updateLocalVideo=function(e){if(e===void 0){e=null}var t=document.getElementById(this.videoContainerId);if(e===null&&t!==null&&t.style.display!="none")this.showLocalVideo(true);else{if(t===null||e.getVideoTracks().length==0){return false}else a.default.attachMedia(e,t)}};e.prototype.testLocalStream=function(e,t){var n=false;var r=false;for(var o=0,i=this._currentStream.getTracks();o<i.length;o++){var a=i[o];if(a.kind==="audio")n=true;if(a.kind==="video")r=true}return e===n&&t===r};r([o.LogManager.d_trace(o.LogCategory.USERMEDIA)],e.prototype,"clearConstraints",null);r([o.LogManager.d_trace(o.LogCategory.USERMEDIA)],e.prototype,"addHandler",null);r([o.LogManager.d_trace(o.LogCategory.USERMEDIA)],e.prototype,"enableAudio",null);r([o.LogManager.d_trace(o.LogCategory.USERMEDIA)],e.prototype,"enableVideo",null);r([o.LogManager.d_trace(o.LogCategory.USERMEDIA)],e.prototype,"setLocalStream",null);r([o.LogManager.d_trace(o.LogCategory.USERMEDIA)],e.prototype,"queryMedia",null);r([o.LogManager.d_trace(o.LogCategory.USERMEDIA)],e.prototype,"queryMediaSilent",null);r([o.LogManager.d_trace(o.LogCategory.USERMEDIA)],e.prototype,"processGrantedMedia",null);r([o.LogManager.d_trace(o.LogCategory.USERMEDIA)],e.prototype,"muteAllLocal",null);r([o.LogManager.d_trace(o.LogCategory.USERMEDIA)],e.prototype,"getDevices",null);r([o.LogManager.d_trace(o.LogCategory.USERMEDIA)],e.prototype,"useVideoDevice",null);r([o.LogManager.d_trace(o.LogCategory.USERMEDIA)],e.prototype,"useAudioInputDevice",null);r([o.LogManager.d_trace(o.LogCategory.USERMEDIA)],e.prototype,"attachTo",null);r([o.LogManager.d_trace(o.LogCategory.USERMEDIA)],e.prototype,"attachToSound",null);r([o.LogManager.d_trace(o.LogCategory.USERMEDIA)],e.prototype,"sendVideo",null);r([o.LogManager.d_trace(o.LogCategory.USERMEDIA)],e.prototype,"stopLocalStream",null);r([o.LogManager.d_trace(o.LogCategory.USERMEDIA)],e.prototype,"stopStream",null);r([o.LogManager.d_trace(o.LogCategory.USERMEDIA)],e.prototype,"setConstraints",null);r([o.LogManager.d_trace(o.LogCategory.USERMEDIA)],e.prototype,"showLocalVideo",null);r([o.LogManager.d_trace(o.LogCategory.USERMEDIA)],e.prototype,"updateLocalVideo",null);r([o.LogManager.d_trace(o.LogCategory.USERMEDIA)],e.prototype,"testLocalStream",null);r([o.LogManager.d_trace(o.LogCategory.USERMEDIA)],e,"updateMuteState",null);r([o.LogManager.d_trace(o.LogCategory.USERMEDIA)],e,"getAudioTracks",null);r([o.LogManager.d_trace(o.LogCategory.USERMEDIA)],e,"getVideoTracks",null);return e}();t.UserMediaManager=l},function(e,t){"use strict";var n=function(){function e(){}e.prototype.clone=function(){var t=new e;t.videoInputId=this.videoInputId;t.audioInputId=this.audioInputId;t.audioEnabled=this.audioEnabled;t.videoEnabled=this.videoEnabled;t.videoSettings=this.videoSettings;return t};e.prototype.setVideoSettings=function(e){this.videoSettings=e;if(typeof e.deviceId!="undefined")this.videoInputId=e.deviceId};return e}();t.MediaCaptureConfig=n},function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var o=arguments.length,i=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,a;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")i=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)if(a=e[s])i=(o<3?a(i):o>3?a(t,n,i):a(t,n))||i;return o>3&&i&&Object.defineProperty(t,n,i),i};var o=n(14);var i=n(6);var a=n(11);var s=n(4);var c=n(16);var d=n(17);var l=n(7);var u=n(20);var g=n(24);var f=function(){function e(){var e=this;this.iceConfig=null;this._peerConnections={};this.waitingPeerConnections={};this.log=s.LogManager.get().createLogger(s.LogCategory.RTC,"PCFactory");this._requireMedia=true;i.VoxSignaling.get().setRPCHandler(g.RemoteEvent.createPC,function(t,n){e.rpcHandlerCreatePC(t,n)});i.VoxSignaling.get().setRPCHandler(g.RemoteEvent.destroyPC,function(t){e.rpcHandlerDestroyPC(t)});i.VoxSignaling.get().addHandler(this)}e.get=function(){if(this.inst===null){this.inst=new e}return this.inst};e.sdpOffersVideo=function(e){return{receiveVideo:e.indexOf("m=video")!==-1,sendVideo:true}};e.prototype.rpcHandlerCreatePC=function(t,n){if(a.UserMediaManager.get().currentStream||!this._requireMedia){i.VoxSignaling.get().callRemoteFunction(u.RemoteFunction.muteLocal,t,false);i.VoxSignaling.get().callRemoteFunction(u.RemoteFunction.muteLocal,t,false);return this.createPC(t,n,o.PeerConnectionMode.CLIENT_SERVER_V1,e.sdpOffersVideo(n))}else{this.waitingPeerConnections[t]=n}};e.prototype.rpcHandlerDestroyPC=function(e){if(this._peerConnections[e]){this._peerConnections[e].close();delete this._peerConnections[e]}delete this.waitingPeerConnections[e]};e.prototype.createPC=function(e,t,n,r){var o=this;var s=l.default.peerConnectionFactory(e,n,r);a.UserMediaManager.get().attachTo(s);this._peerConnections[e]=s;var g=c.CallManager.get().calls[e];if(t){s.processRemoteOffer(t).then(function(t){if(typeof g==="undefined"||g.checkCallMode(d.CallMode.SERVER))i.VoxSignaling.get().callRemoteFunction(u.RemoteFunction.confirmPC,e,t);else i.VoxSignaling.get().callRemoteFunction(u.RemoteFunction.acceptCall,[e,c.CallManager.cleanHeaders(g.headers()),t]);if(e!=="__default"&&typeof c.CallManager.get().calls[e]!=="undefined"){c.CallManager.get().calls[e].peerConnection=s}}).catch(function(e){o.log.error("Error during PC creation: "+e)})}return s};e.prototype.setupDirectPC=function(e,t,n,r){var o=l.default.peerConnectionFactory(e,t,n);o.setHoldKey(r);if(!n.sendVideo)a.UserMediaManager.get().attachToSound(o);else a.UserMediaManager.get().attachTo(o);this._peerConnections[e]=o;return o.getLocalOffer()};e.prototype.incomeDirectPC=function(e,t,n,r){var i=l.default.peerConnectionFactory(e,o.PeerConnectionMode.P2P,t);i.setHoldKey(r);i._setRemoteDescription(n);this._peerConnections[e]=i;return i};e.prototype.getPeerConnect=function(e){return this._peerConnections[e]};e.prototype.onMediaAccessRejected=function(){};e.prototype.onMediaAccessGranted=function(t){for(var n in this.waitingPeerConnections){this.createPC(n,this.waitingPeerConnections[n],o.PeerConnectionMode.CLIENT_SERVER_V1,e.sdpOffersVideo(this.waitingPeerConnections[n]))}this.waitingPeerConnections={}};e.prototype.onSignalingConnected=function(){};e.prototype.onSignalingClosed=function(){this.log.info("Closing all peer connections because signaling connection has closed");this.waitingPeerConnections={};for(var e in this._peerConnections){this._peerConnections[e].close()}this._peerConnections={}};e.prototype.onSignalingConnectionFailed=function(e){};e.prototype.onMediaConnectionFailed=function(){};Object.defineProperty(e.prototype,"requireMedia",{get:function(){return this._requireMedia},set:function(e){this._requireMedia=e},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"peerConnections",{get:function(){return this._peerConnections},enumerable:true,configurable:true});e.prototype.closeAll=function(){for(var e in this._peerConnections)this._peerConnections[e].close();this._peerConnections={}};e.prototype.setBandwidthParams=function(e){this._bandwidthParams=e};e.prototype.addBandwidthParams=function(e){if(this._bandwidthParams)e.sdp=e.sdp.replace(/(a=mid:video.*\r\n)/g,"$1b=AS:"+this._bandwidthParams+"\r\n");return e};e.inst=null;r([s.LogManager.d_trace(s.LogCategory.PCFACTORY)],e.prototype,"rpcHandlerCreatePC",null);r([s.LogManager.d_trace(s.LogCategory.PCFACTORY)],e.prototype,"rpcHandlerDestroyPC",null);r([s.LogManager.d_trace(s.LogCategory.PCFACTORY)],e.prototype,"createPC",null);r([s.LogManager.d_trace(s.LogCategory.PCFACTORY)],e.prototype,"setupDirectPC",null);r([s.LogManager.d_trace(s.LogCategory.PCFACTORY)],e.prototype,"incomeDirectPC",null);r([s.LogManager.d_trace(s.LogCategory.PCFACTORY)],e.prototype,"getPeerConnect",null);r([s.LogManager.d_trace(s.LogCategory.PCFACTORY)],e.prototype,"onMediaAccessRejected",null);r([s.LogManager.d_trace(s.LogCategory.PCFACTORY)],e.prototype,"onMediaAccessGranted",null);r([s.LogManager.d_trace(s.LogCategory.PCFACTORY)],e.prototype,"onSignalingConnected",null);r([s.LogManager.d_trace(s.LogCategory.PCFACTORY)],e.prototype,"onSignalingClosed",null);r([s.LogManager.d_trace(s.LogCategory.PCFACTORY)],e.prototype,"onSignalingConnectionFailed",null);r([s.LogManager.d_trace(s.LogCategory.PCFACTORY)],e.prototype,"onMediaConnectionFailed",null);r([s.LogManager.d_trace(s.LogCategory.PCFACTORY)],e.prototype,"closeAll",null);r([s.LogManager.d_trace(s.LogCategory.PCFACTORY)],e.prototype,"setBandwidthParams",null);r([s.LogManager.d_trace(s.LogCategory.PCFACTORY)],e.prototype,"addBandwidthParams",null);return e}();t.PCFactory=f},function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var o=arguments.length,i=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,a;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")i=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)if(a=e[s])i=(o<3?a(i):o>3?a(t,n,i):a(t,n))||i;return o>3&&i&&Object.defineProperty(t,n,i),i};var o=n(4);var i=n(6);var a=n(15);var s=n(16);var c=n(19);var d=n(20);(function(e){e[e["IDLE"]=0]="IDLE";e[e["REMOTEOFFER"]=1]="REMOTEOFFER";e[e["LOCALOFFER"]=2]="LOCALOFFER";e[e["ESTABLISHING"]=3]="ESTABLISHING";e[e["ESTABLISHED"]=4]="ESTABLISHED";e[e["CLOSED"]=5]="CLOSED"})(t.PeerConnectionState||(t.PeerConnectionState={}));var l=t.PeerConnectionState;(function(e){e[e["CLIENT_SERVER_V1"]=0]="CLIENT_SERVER_V1";e[e["P2P"]=1]="P2P"})(t.PeerConnectionMode||(t.PeerConnectionMode={}));var u=t.PeerConnectionMode;var g=function(){function e(e,t,n){this.id=e;this.mode=t;this.videoEnabled=n;this.SEND_CANDIDATE_DELAY=1e3;this.onHold=false;this.log=o.LogManager.get().createLogger(o.LogCategory.RTC,"PeerConnection "+e);this.state=l.IDLE;this.log.info("Created PC");this.renderers=[];this.pendingCandidates=[]}e.prototype.getId=function(){return this.id};e.prototype.setState=function(e){this.log.info("Transmitting from "+l[this.state]+" to "+l[e]);this.state=e};e.prototype.getState=function(){return this.state};e.prototype.processRemoteAnswer=function(e,t){this.log.info("Called processRemoteAnswer");this.state=l.ESTABLISHING;return this._processRemoteAnswer(e,t)};e.prototype.getLocalOffer=function(){if(this.state===l.IDLE||this.state===l.ESTABLISHED||l.LOCALOFFER){this.log.info("Called getLocalOffer");this.state=l.LOCALOFFER;return this._getLocalOffer()}else{this.log.error("Called getLocalOffer in state "+l[this.state]);return new Promise(function(e,t){t("Invalid state")})}};e.prototype.getLocalAnswer=function(){return this._getLocalAnswer()};e.prototype.processRemoteOffer=function(e){if(this.state===l.IDLE||this.state===l.ESTABLISHED){this.log.info("Called processRemoteOffer");this.state=l.ESTABLISHING;return this._processRemoteOffer(e)}else{this.log.error("Called processRemoteOffer in state "+l[this.state]);return new Promise(function(e,t){t("Invalid state")})}};e.prototype.close=function(){this.log.info("Called close");this._close();this.renderers.forEach(function(e){return a.Renderer.get().releaseElement(e)})};e.prototype.addRemoteCandidate=function(e,t){this.log.info("Called addRemoteCandidate");return this._addRemoteCandidate(e,t)};e.prototype.sendLocalCandidateToPeer=function(e,t){this._call=s.CallManager.get().calls[this.id];switch(this.mode){case u.P2P:s.CallManager.get().calls[this.id].sendInfo(c.Constants.P2P_SPD_FRAG_MIME_TYPE,JSON.stringify([[t,e]]),{});break;case u.CLIENT_SERVER_V1:i.VoxSignaling.get().callRemoteFunction(d.RemoteFunction.addCandidate,this.id,e,t);break}};e.prototype.bindLocalMedia=function(e){if(typeof this._localStream!=="undefined")this._unbindLocalMegia();if(typeof e!=="undefined"){var t=new MediaStream(e.getTracks().map(function(e){if(typeof e.clone!=="undefined")return e.clone();else return e}));this._localStream=t;this._bindLocalMedia()}};Object.defineProperty(e.prototype,"localStream",{get:function(){return this._localStream},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"remoteStreams",{get:function(){return this._remoteStreams},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"videoRenderer",{get:function(){var e=null;this.renderers.forEach(function(t){if(t.tagName.toLowerCase()==="video")e=t});return e},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"audioRenderer",{get:function(){this.renderers.forEach(function(e){if(e.tagName.toLowerCase()==="audio")return e});return null},enumerable:true,configurable:true});e.prototype.handleReinvite=function(e,t,n){return this._handleReinvite(e,t,n)};e.prototype.addCandidateToSend=function(e,t){this.pendingCandidates.push([t,e]);if(this.canSendCandidates)this.startCandidateSendTimer()};e.prototype.startCandidateSendTimer=function(){var e=this;if(this.candidateSendTimer===null||typeof this.candidateSendTimer==="undefined"){this.candidateSendTimer=setTimeout(function(){e.candidateSendTimer=null;if(e.pendingCandidates.length>0){s.CallManager.get().calls[e.id].sendInfo(c.Constants.P2P_SPD_FRAG_MIME_TYPE,JSON.stringify(e.pendingCandidates),{})}e.pendingCandidates=[]},this.SEND_CANDIDATE_DELAY)}};e.prototype.canStartSendingCandidates=function(){this.canSendCandidates=true;this.startCandidateSendTimer()};e.prototype.sendDTMF=function(e){var t=500;var n=50;this._sendDTMF(e,t,n)};e.prototype.hold=function(e){this._hold(e)};e.prototype.setVideoEnabled=function(e){var t=this.videoEnabled.receiveVideo;this.videoEnabled=e;if(t!=e.receiveVideo){this._hold(this.onHold)}};e.prototype.setVideoFlags=function(e){this.videoEnabled=e};e.prototype.updateRenderersSink=function(e){var t=this;return new Promise(function(n,r){t.sinkId=e;var o=[];for(var i=0,a=t.renderers;i<a.length;i++){var s=a[i];o.push(s.setSinkId(e))}Promise.all(o).then(function(){n()},r)})};e.prototype.getDirections=function(){return this._getDirections()};e.prototype.setHoldKey=function(e){this.onHold=e};e.prototype.getTrackKind=function(){return this._getTrackKind()};e.prototype.stopSharing=function(){this._stopSharing()};r([o.LogManager.d_trace(o.LogCategory.RTC)],e.prototype,"setState",null);r([o.LogManager.d_trace(o.LogCategory.RTC)],e.prototype,"getState",null);r([o.LogManager.d_trace(o.LogCategory.RTC)],e.prototype,"processRemoteAnswer",null);r([o.LogManager.d_trace(o.LogCategory.RTC)],e.prototype,"getLocalOffer",null);r([o.LogManager.d_trace(o.LogCategory.RTC)],e.prototype,"getLocalAnswer",null);r([o.LogManager.d_trace(o.LogCategory.RTC)],e.prototype,"processRemoteOffer",null);r([o.LogManager.d_trace(o.LogCategory.RTC)],e.prototype,"close",null);r([o.LogManager.d_trace(o.LogCategory.RTC)],e.prototype,"addRemoteCandidate",null);r([o.LogManager.d_trace(o.LogCategory.RTC)],e.prototype,"sendLocalCandidateToPeer",null);r([o.LogManager.d_trace(o.LogCategory.RTC)],e.prototype,"bindLocalMedia",null);r([o.LogManager.d_trace(o.LogCategory.RTC)],e.prototype,"addCandidateToSend",null);r([o.LogManager.d_trace(o.LogCategory.RTC)],e.prototype,"startCandidateSendTimer",null);r([o.LogManager.d_trace(o.LogCategory.RTC)],e.prototype,"canStartSendingCandidates",null);r([o.LogManager.d_trace(o.LogCategory.RTC)],e.prototype,"hold",null);return e}();t.PeerConnection=g},function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var o=arguments.length,i=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,a;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")i=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)if(a=e[s])i=(o<3?a(i):o>3?a(t,n,i):a(t,n))||i;return o>3&&i&&Object.defineProperty(t,n,i),i};var o=n(7);var i=n(4);var a=function(){function e(){this.videoElements=new Array;this.audioElements=new Array;this.log=i.LogManager.get().createLogger(i.LogCategory.RTC,"Renderer")}e.get=function(){if(!this.inst)this.inst=new e;return this.inst};Object.defineProperty(e.prototype,"defaultContainer",{get:function(){return this._defaultContainer},set:function(e){this._defaultContainer=e},enumerable:true,configurable:true});e.prototype.getElement=function(e,t,n){var r=n||this._defaultContainer||document.body;if(document.getElementById(e)){var o=document.getElementById(e);if(r)o.parentElement.removeChild(o)}var i;i=document.createElement(t?"video":"audio");if(t){this.videoElements.push(i);i.width=400;i.height=300}else{this.audioElements.push(i)}i.id=e;if(r){r.appendChild(i)}return i};e.prototype.getElementId=function(e,t){};e.prototype.renderStream=function(e,t){var n=this.getElement(e.id,e.getVideoTracks().length>0,t);o.default.attachMedia(e,n);return n};e.prototype.setPlaybackVolume=function(e){for(var t in this.audioElements){this.audioElements[t].volume=e}for(var t in this.videoElements){this.videoElements[t].volume=e}};e.prototype.releaseElement=function(e){if(e){e.id="";if(typeof e.parentElement!="undefined"&&e.parentElement!==null){if(e.parentElement)e.parentElement.removeChild(e)}else if(e.parentNode){if(e.parentNode)e.parentNode.removeChild(e)}o.default.detachMedia(e)}};r([i.LogManager.d_trace(i.LogCategory.USERMEDIA)],e.prototype,"getElement",null);r([i.LogManager.d_trace(i.LogCategory.USERMEDIA)],e.prototype,"getElementId",null);r([i.LogManager.d_trace(i.LogCategory.USERMEDIA)],e.prototype,"renderStream",null);r([i.LogManager.d_trace(i.LogCategory.USERMEDIA)],e.prototype,"setPlaybackVolume",null);r([i.LogManager.d_trace(i.LogCategory.USERMEDIA)],e.prototype,"releaseElement",null);return e}();t.Renderer=a},function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var o=arguments.length,i=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,a;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")i=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)if(a=e[s])i=(o<3?a(i):o>3?a(t,n,i):a(t,n))||i;return o>3&&i&&Object.defineProperty(t,n,i),i};var o=n(17);var i=n(18);var a=n(6);var s=n(3);var c=n(5);var d=n(19);var l=n(4);var u=n(13);var g=n(1);var f=n(14);var p=n(22);var h=n(23);var v=n(20);var m=n(24);var C=n(25);var y=n(26);var L=i.CallEvents.PendingUpdate;var S=function(){function e(){var e=this;this.protocolVersion="3";this._calls={};this.voxSignaling=a.VoxSignaling.get();this.log=l.LogManager.get().createLogger(l.LogCategory.SIGNALING,"CallManager");this.voxSignaling.addHandler(this);this.voxSignaling.setRPCHandler(m.RemoteEvent.handleIncomingConnection,function(t,n,r,o,i){e.handleIncomingConnection(t,n,r,o,i)});this.voxSignaling.setRPCHandler(m.RemoteEvent.handleConnectionConnected,function(t,n,r){e.handleConnectionConnected(t,n,r)});this.voxSignaling.setRPCHandler(m.RemoteEvent.handleConnectionDisconnected,function(t,n,r){e.handleConnectionDisconnected(t,n,r)});this.voxSignaling.setRPCHandler(m.RemoteEvent.handleRingOut,function(t){e.handleRingOut(t)});this.voxSignaling.setRPCHandler(m.RemoteEvent.stopRinging,function(t){e.stopRinging(t)});this.voxSignaling.setRPCHandler(m.RemoteEvent.handleConnectionFailed,function(t,n,r,o){e.handleConnectionFailed(t,n,r,o)});this.voxSignaling.setRPCHandler(m.RemoteEvent.handleSIPInfo,function(t,n,r,o,i){e.handleSIPInfo(t,n,r,o,i)});this.voxSignaling.setRPCHandler(m.RemoteEvent.handleSipEvent,function(t){e.handleSipEvent(t)});this.voxSignaling.setRPCHandler(m.RemoteEvent.handleTransferStarted,function(t){e.handleTransferStarted(t)});this.voxSignaling.setRPCHandler(m.RemoteEvent.handleTransferComplete,function(t){e.handleTransferComplete(t)});this.voxSignaling.setRPCHandler(m.RemoteEvent.handleTransferFailed,function(t){e.handleTransferFailed(t)});this.voxSignaling.setRPCHandler(m.RemoteEvent.handleReInvite,function(t,n,r){e.handleInReinvite(t,n,r)});this.voxSignaling.setRPCHandler(m.RemoteEvent.handleAcceptReinvite,function(t,n,r){e.handleReinvite(t,n,r)});this.voxSignaling.setRPCHandler(m.RemoteEvent.handleRejectReinvite,function(t,n,r){e.handleRejectReinvite(t,n,r)});this.voxSignaling.setRPCHandler(m.RemoteEvent.startEarlyMedia,function(t,n,r){e.startEarlyMedia(t,n,r)})}Object.defineProperty(e.prototype,"numCalls",{get:function(){return this._numCalls},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"calls",{get:function(){return this._calls},enumerable:true,configurable:true});e.get=function(){if(typeof this.inst=="undefined"){this.inst=new e}return this.inst};e.prototype.call=function(t){var n=this;if(typeof t.video==="boolean"){t.video={sendVideo:t.video,receiveVideo:t.video}}var r={number:null,video:{sendVideo:false,receiveVideo:false},customData:null,extraHeaders:{},wiredLocal:true,wiredRemote:true,H264first:false,VP8first:false,forceActive:false};var o=s.Utils.mixObjectToLeft(r,t);o=e.addCustomDataToHeaders(o);var i=s.Utils.generateUUID();if(this._calls[i]){this.log.error("Call "+i+" already exists");throw new Error("Internal error")}var a;if(this.protocolVersion=="3"){a=new C.CallExMedia(i,c.Authenticator.get().displayName,false,o)}else if(typeof o.extraHeaders[d.Constants.DIRECT_CALL_HEADER]!="undefined"){a=new h.CallExP2P(i,c.Authenticator.get().displayName,false,o)}else{a=new p.CallExServer(i,c.Authenticator.get().displayName,false,o)}this._calls[i]=a;if(y.CallstatsIo.isModuleEnabled()){o.extraHeaders[d.Constants.CALLSTATSIOID_HEADER]=i}if(o.VP8first){a.rearangeCodecs=function(e){return new Promise(function(t,n){for(var r=0;r<e.sections.length;r++){if(e.sections[r].kind.toLowerCase()=="video"){e.sections[r].codec.sort(function(e,t){if(e.toLowerCase().indexOf("vp8")!=-1)return-1;if(t.toLowerCase().indexOf("vp8")!=-1)return 1;return 0})}}t(e)})}}if(o.H264first){a.rearangeCodecs=function(e){return new Promise(function(t,n){for(var r=0;r<e.sections.length;r++){if(e.sections[r].kind.toLowerCase()=="video"){e.sections[r].codec.sort(function(e,t){if(e.toLowerCase().indexOf("h264")!=-1&&e.toLowerCase().indexOf("uc")==-1)return-1;if(t.toLowerCase().indexOf("h264")!=-1&&t.toLowerCase().indexOf("uc")==-1)return 1;return 0})}}t(e)})}}var l=false;if(Object.keys(this._calls).length>1){a.setActiveForce(false);l=true}if(typeof o.extraHeaders[d.Constants.DIRECT_CALL_HEADER]==="undefined"&&this.protocolVersion=="2"){this.voxSignaling.callRemoteFunction(v.RemoteFunction.createCall,-1,o.number,o.video,i,null,null,o.extraHeaders,o.extraParams)}else{u.PCFactory.get().setupDirectPC(i,f.PeerConnectionMode.P2P,t.video,l).then(function(e){a.peerConnection=u.PCFactory.get().peerConnections[i];var t={tracks:a.peerConnection.getTrackKind()};n.voxSignaling.callRemoteFunction(v.RemoteFunction.createCall,-1,o.number,o.video,i,null,null,o.extraHeaders,"",e.sdp,t)})}return a};e.addCustomDataToHeaders=function(e){if(typeof e.customData!="undefined"){if(typeof e.extraHeaders=="undefined")e.extraHeaders={};e.extraHeaders["VI-CallData"]=e.customData}return e};e.prototype.handleIncomingConnection=function(e,t,n,r,o){if(this._calls[e]){this.log.error("Call "+e+" already exists");throw new Error("Internal error")}var i;var a=g.Client.getInstance().videoSupport;var s={number:t,extraHeaders:r,video:a,wiredLocal:true,wiredRemote:true,forceActive:false};if(this.protocolVersion=="3"){i=new C.CallExMedia(e,n,true,s)}else if(typeof s.extraHeaders[d.Constants.DIRECT_CALL_HEADER]!="undefined")i=new h.CallExP2P(e,n,true,s);else i=new p.CallExServer(e,n,true,s);this._calls[e]=i;var c=false;if(Object.keys(this._calls).length>1){i.setActiveForce(false);c=true}if(typeof s.extraHeaders[d.Constants.DIRECT_CALL_HEADER]==="undefined"&&this.protocolVersion=="2"){i.peerConnection=u.PCFactory.get().getPeerConnect(e)}else{i.peerConnection=u.PCFactory.get().incomeDirectPC(e,{receiveVideo:true,sendVideo:true},o,c)}g.Client.getInstance().onIncomingCall(e,t,n,r,a)};e.prototype.isSDPHasVideo=function(e){var t=e.indexOf("m=video");if(t===-1)return false;var n=e.indexOf("a=sendrecv",t);var r=e.indexOf("a=sendonly",t);var o=e.indexOf("m=",t);if(n!==-1&&(n<o||o===-1)||r!==-1&&(r<o||o===-1))return true;return false};e.prototype.findCall=function(e,t){var n=this._calls[e];if(e==="")n=this._calls[Object.keys(this._calls)[0]];if(typeof n=="undefined"){this.log.warning("Received "+t+" for unknown call "+e);return null}return n};e.prototype.handleRingOut=function(e){var t=this.findCall(e,"handleRingOut");if(typeof t=="undefined")return;g.Client.getInstance().playProgressTone();t.onRingOut();t.canStartSendingCandidates()};e.prototype.handleConnectionConnected=function(e,t,n){var r=this.findCall(e,"handleConnectionConnected");if(typeof r=="undefined"){return}r.signalingConnected=true;r.onConnected(t,n);r.canStartSendingCandidates();if(typeof n!="undefined"&&n.length>0){var o=n.indexOf("m=video");if(o!==-1){var i=n.indexOf("a=sendrecv",o);var a=n.indexOf("a=sendonly",o);var s=n.indexOf("a=recvonly",o);var c=n.indexOf("a=inactive",o);if(i===-1&&a===-1&&s===-1&&c===-1)n+="a=inactive\r\n"}r.peerConnection.processRemoteAnswer(t,n)}g.Client.getInstance().stopProgressTone()};e.prototype.startEarlyMedia=function(e,t,n){var r=this.findCall(e,"startEarlyMedia");if(typeof n!="undefined"){r.peerConnection.processRemoteAnswer(t,n)}g.Client.getInstance().stopProgressTone()};e.prototype.handleConnectionDisconnected=function(e,t,n){var r=this.findCall(e,"handleConnectionDisconnected");if(!r)return;g.Client.getInstance().stopProgressTone();r.onDisconnected(t,n);delete this._calls[e]};e.prototype.handleSIPInfo=function(e,t,n,r,o){var i=this.findCall(e,"handleSIPInfo");if(typeof i=="undefined")return;i.onInfo(i,t,n,r,o)};e.prototype.stopRinging=function(e){var t=this.findCall(e,"stopRinging");t.canStartSendingCandidates();if(typeof t=="undefined")return;g.Client.getInstance().stopProgressTone();t.onStopRinging()};e.prototype.handleSipEvent=function(e){};e.prototype.handleTransferStarted=function(e){};e.prototype.handleTransferComplete=function(e){var t=this.findCall(e,"handleTransferComplete");if(typeof t=="undefined")return;t.onTransferComplete()};e.prototype.handleTransferFailed=function(e){var t=this.findCall(e,"handleTransferFailed");if(typeof t=="undefined")return;t.onTransferFailed()};e.prototype.handleReinvite=function(e,t,n){var r=this.findCall(e,"handleReinvite");if(typeof r=="undefined")return;var o=this.isSDPHasVideo(n);r.peerConnection.handleReinvite(t,n,o)};e.prototype.handleRejectReinvite=function(e,t,n){var r=this.findCall(e,"handleReinvite");if(typeof r=="undefined")return;r.dispatchEvent({code:20,call:r})};e.prototype.handleInReinvite=function(e,t,n){var r=this.findCall(e,"handleReinvite");if(typeof r=="undefined")return;r.runIncomingReInvite(t,n);r.dispatchEvent({name:L,result:true,call:r})};e.prototype.handleConnectionFailed=function(e,t,n,r){var o=this.findCall(e,"handleConnectionFailed");if(typeof o=="undefined")return;delete this._calls[e];g.Client.getInstance().stopProgressTone();o.onFailed(t,n,r)};e.prototype.onSignalingConnected=function(){};e.prototype.onSignalingClosed=function(){for(var e in this._calls){this._calls[e].hangup()}};e.prototype.onSignalingConnectionFailed=function(e){};e.prototype.onMediaConnectionFailed=function(){};e.prototype.recalculateNumCalls=function(){this._numCalls=0;for(var e in this._calls)this._numCalls++};e.prototype.transferCall=function(e,t){var n=[e,t];for(var r=0;r<n.length;r++){
var i=this._calls[n[r].id()];if(i){if(i.stateValue!=o.CallState.CONNECTED){this.log.error("trying to transfer call "+i.id()+" in state "+i.state());return}}else{this.log.error("trying to transfer unknown call "+i.id());return}}this.voxSignaling.callRemoteFunction(v.RemoteFunction.transferCall,[e,t])};e.prototype.removeCall=function(e){delete this._calls[e]};e.cleanHeaders=function(e){var t={};for(var n in e){if(n.substring(0,2)=="X-"||n==d.Constants.CALL_DATA_HEADER){t[n]=e[n]}}return t};e.prototype.setProtocolVersion=function(e){this.protocolVersion=e};r([l.LogManager.d_trace(l.LogCategory.CALLMANAGER)],e.prototype,"call",null);r([l.LogManager.d_trace(l.LogCategory.CALLMANAGER)],e.prototype,"handleIncomingConnection",null);r([l.LogManager.d_trace(l.LogCategory.CALLMANAGER)],e.prototype,"findCall",null);r([l.LogManager.d_trace(l.LogCategory.CALLMANAGER)],e.prototype,"handleRingOut",null);r([l.LogManager.d_trace(l.LogCategory.CALLMANAGER)],e.prototype,"handleConnectionConnected",null);r([l.LogManager.d_trace(l.LogCategory.CALLMANAGER)],e.prototype,"handleConnectionDisconnected",null);r([l.LogManager.d_trace(l.LogCategory.CALLEXSERVER)],e.prototype,"handleSIPInfo",null);r([l.LogManager.d_trace(l.LogCategory.CALLMANAGER)],e.prototype,"stopRinging",null);r([l.LogManager.d_trace(l.LogCategory.CALLMANAGER)],e.prototype,"handleSipEvent",null);r([l.LogManager.d_trace(l.LogCategory.CALLMANAGER)],e.prototype,"handleTransferStarted",null);r([l.LogManager.d_trace(l.LogCategory.CALLMANAGER)],e.prototype,"handleTransferComplete",null);r([l.LogManager.d_trace(l.LogCategory.CALLMANAGER)],e.prototype,"handleTransferFailed",null);r([l.LogManager.d_trace(l.LogCategory.CALLMANAGER)],e.prototype,"handleReinvite",null);r([l.LogManager.d_trace(l.LogCategory.CALLMANAGER)],e.prototype,"handleRejectReinvite",null);r([l.LogManager.d_trace(l.LogCategory.CALLMANAGER)],e.prototype,"handleInReinvite",null);r([l.LogManager.d_trace(l.LogCategory.CALLMANAGER)],e.prototype,"handleConnectionFailed",null);r([l.LogManager.d_trace(l.LogCategory.CALLMANAGER)],e.prototype,"onSignalingConnected",null);r([l.LogManager.d_trace(l.LogCategory.CALLMANAGER)],e.prototype,"onSignalingClosed",null);r([l.LogManager.d_trace(l.LogCategory.CALLMANAGER)],e.prototype,"onSignalingConnectionFailed",null);r([l.LogManager.d_trace(l.LogCategory.CALLMANAGER)],e.prototype,"removeCall",null);r([l.LogManager.d_trace(l.LogCategory.CALLMANAGER)],e,"addCustomDataToHeaders",null);return e}();t.CallManager=S},function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var o=arguments.length,i=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,a;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")i=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)if(a=e[s])i=(o<3?a(i):o>3?a(t,n,i):a(t,n))||i;return o>3&&i&&Object.defineProperty(t,n,i),i};var o=n(18);var i=n(6);var a=n(19);var s=n(4);var c=n(11);var d=n(13);var l=n(16);var u=n(7);var g=n(20);var f=n(21);var p=n(1);(function(e){e[e["ALERTING"]="ALERTING"]="ALERTING";e[e["PROGRESSING"]="PROGRESSING"]="PROGRESSING";e[e["CONNECTED"]="CONNECTED"]="CONNECTED";e[e["UPDATING"]="UPDATING"]="UPDATING";e[e["ENDED"]="ENDED"]="ENDED"})(t.CallState||(t.CallState={}));var h=t.CallState;(function(e){e[e["P2P"]=0]="P2P";e[e["SERVER"]=1]="SERVER"})(t.CallMode||(t.CallMode={}));var v=t.CallMode;var m=function(){function e(e,t,n,r){var o=this;this.eventListeners={};this.pendingReinvites=[];this.signalingConnected=false;this._id=e;this._num=r.number;this._displayName=t;this._headers=r.extraHeaders;this._state=n?h.ALERTING:h.PROGRESSING;this._mode=v.P2P;this._setupWiredLocal=r.wiredLocal;this._wiredLocal=r.wiredLocal;this._setupWiredRemote=r.wiredLocal;this._wiredRemote=r.wiredLocal;this._active=true;this._usedSinkId=null;this._promise=new Promise(function(e,t){o._promiseFunctions={resolve:e,reject:t}});this._renegotiationPromise=null;this.log=s.LogManager.get().createLogger(s.LogCategory.CALL,"Call "+e);this._callManager=l.CallManager.get();if(typeof r.video==="boolean"){this.videoDirections={sendVideo:r.video,receiveVideo:true}}else{this.videoDirections=r.video}}e.prototype.id=function(){return this._id};e.prototype.number=function(){return this._num};e.prototype.displayName=function(){return this._displayName};e.prototype.headers=function(){return this._headers};e.prototype.active=function(){return this._active};e.prototype.state=function(){return h[this._state]};Object.defineProperty(e.prototype,"stateValue",{get:function(){return this._state},enumerable:true,configurable:true});e.prototype.answer=function(e,t,n){if(typeof e!="undefined"){if(typeof t=="undefined")t={};t[a.Constants.CALL_DATA_HEADER]=e}if(typeof n!=="undefined")n={sendVideo:p.Client.getInstance().config().videoSupport,receiveVideo:p.Client.getInstance().config().videoSupport};if(this._state!=h.ALERTING)throw new Error("WRONG_CALL_STATE");if(typeof n!="undefined"){this._peerConnection.setVideoFlags(n)}};e.prototype.decline=function(e){this.reject(e)};e.prototype.reject=function(e){if(this._state!=h.ALERTING)throw new Error("WRONG_CALL_STATE");i.VoxSignaling.get().callRemoteFunction(g.RemoteFunction.rejectCall,this._id,true,l.CallManager.cleanHeaders(e))};e.prototype.hangup=function(e){if(this._state==h.CONNECTED||this._state==h.UPDATING||this._state==h.PROGRESSING)i.VoxSignaling.get().callRemoteFunction(g.RemoteFunction.disconnectCall,this._id,l.CallManager.cleanHeaders(e));else if(this._state==h.ALERTING)i.VoxSignaling.get().callRemoteFunction(g.RemoteFunction.rejectCall,this._id,true,l.CallManager.cleanHeaders(e));else throw new Error("WRONG_CALL_STATE")};e.prototype.sendTone=function(e){this._peerConnection.sendDTMF(e)};e.prototype.mutePlayback=function(){c.UserMediaManager.updateMuteState(this._id,c.MediaDirection.REMOTE,false)};e.prototype.muteMicrophone=function(){this.peerConnection.localStream.getAudioTracks().forEach(function(e){e.enabled=false})};e.prototype.unmutePlayback=function(){c.UserMediaManager.updateMuteState(this._id,c.MediaDirection.REMOTE,true)};e.prototype.unmuteMicrophone=function(){this.peerConnection.localStream.getAudioTracks().forEach(function(e){e.enabled=true})};e.prototype.showRemoteVideo=function(e){if(e===void 0){e=true}if(typeof e=="undefined")e=true;if(this.peerConnection.videoRenderer)this.peerConnection.videoRenderer.style.display=e?"block":"none"};e.prototype.setRemoteVideoPosition=function(e,t){throw new Error("Deprecated: please use CSS to position '#voximplantcontainer' element")};e.prototype.setRemoteVideoSize=function(e,t){throw new Error("Deprecated: please use CSS to set size of '#voximplantcontainer' element")};e.prototype.sendInfo=function(e,t,n){var r,o,a=e.indexOf("/");if(a==-1){r="application";o=e}else{r=e.substring(0,a);o=e.substring(a+1)}i.VoxSignaling.get().callRemoteFunction(g.RemoteFunction.sendSIPInfo,this._id,r,o,t,l.CallManager.cleanHeaders(n))};e.prototype.sendMessage=function(e){this.sendInfo(a.Constants.ZINGAYA_IM_MIME_TYPE,e,{})};e.prototype.setVideoSettings=function(e,t,n){c.UserMediaManager.get().setConstraints(e,true).then(function(e){if(typeof t=="function")t(e)}).catch(function(e){if(typeof n=="function")n(e)})};e.prototype.getVideoElementId=function(){if(this.peerConnection&&this._wiredRemote){var e=this.peerConnection.videoRenderer;return e!=null?e.id:null}else{return null}};e.prototype.addEventListener=function(e,t){if(typeof this.eventListeners[e]=="undefined")this.eventListeners[e]=[];this.eventListeners[e].push(t)};e.prototype.on=function(e,t){this.addEventListener(e,t)};e.prototype.removeEventListener=function(e,t){if(typeof this.eventListeners[e]=="undefined")return;if(typeof t==="function"){for(var n=0;n<this.eventListeners[e].length;n++){if(this.eventListeners[e][n]==t){this.eventListeners[e].splice(n,1);break}}}else{this.eventListeners[e]=[]}};e.prototype.off=function(e,t){this.removeEventListener(e,t)};e.prototype.dispatchEvent=function(e){var t=e.name;if(t===o.CallEvents.Updated||t===o.CallEvents.UpdateFailed){this._state=h.CONNECTED}if(t===o.CallEvents.Updated&&this._renegotiationPromise!==null){if(e.result)this._renegotiationPromise.resolve(e);else this._renegotiationPromise.reject({code:20,call:this});this._renegotiationPromise=null}if(t===o.CallEvents.UpdateFailed&&this._renegotiationPromise!==null){this._renegotiationPromise.reject(e);this._renegotiationPromise=null}if(t===o.CallEvents.Updated||t===o.CallEvents.UpdateFailed){this._renegotiationPromise=null;this.runPendingReinvite()}if(typeof this.eventListeners[t]!="undefined"){for(var n=0;n<this.eventListeners[t].length;n++){if(typeof this.eventListeners[t][n]=="function"){this.eventListeners[t][n](e)}}}};e.prototype.checkState=function(e,t){if(e){if(typeof e!="string"){var n=false;var r=e;for(var o=0;o<r.length;o++){if(r[o]==this._state){n=true}}if(!n){this.log.warning("Received "+t+" in invalid state "+this._state);return false}}else if(this._state!=e){this.log.warning("Received "+t+" in invalid state "+this._state);return false}}return true};e.prototype.onConnected=function(e,t){var n=this;if(!this.checkState([h.PROGRESSING,h.ALERTING],"onConnected"))return false;this._state=h.CONNECTED;setTimeout(function(){n.dispatchEvent({name:"Connected",call:n,headers:e})},800);return true};e.prototype.onDisconnected=function(e,t){if(!this.checkState([h.CONNECTED,h.ALERTING,h.PROGRESSING,h.UPDATING],"onDisconnected"))return false;this._state=h.ENDED;this.dispatchEvent({name:"Disconnected",call:this,headers:e,params:t});f.ReusableRenderer.get().freeRendersByCallId(this._id);return true};e.prototype.onFailed=function(e,t,n){this.dispatchEvent({name:"Failed",call:this,headers:n,code:e,reason:t});this._state=h.ENDED;f.ReusableRenderer.get().freeRendersByCallId(this._id);return true};e.prototype.onStopRinging=function(){if(!this.checkState([h.PROGRESSING,h.CONNECTED],"onStopRinging"))return false;this.dispatchEvent({name:"ProgressToneStop",call:this});return true};e.prototype.onRingOut=function(){if(!this.checkState(h.PROGRESSING,"onRingOut"))return false;this.dispatchEvent({name:"ProgressToneStart",call:this});return true};e.prototype.onTransferComplete=function(){if(!this.checkState(h.CONNECTED,"onTransferComplete"))return false;this.dispatchEvent({name:"TransferComplete",call:this});return true};e.prototype.onTransferFailed=function(){if(!this.checkState(h.CONNECTED,"onTransferFailed"))return false;this.dispatchEvent({name:"TransferFailed",call:this});return true};e.prototype.onInfo=function(e,t,n,r,o){if(e.stateValue==h.CONNECTED||e.stateValue==h.PROGRESSING||e.stateValue==h.ALERTING){var i=t+"/"+n;if(i==a.Constants.ZINGAYA_IM_MIME_TYPE){this.dispatchEvent({name:"onSendMessage",call:this,text:r})}else if(i==a.Constants.P2P_SPD_FRAG_MIME_TYPE){var s=JSON.parse(r);for(var c in s){e.peerConnection.addRemoteCandidate(s[c][1],s[c][0])}}else if(i==a.Constants.VI_SPD_OFFER_MIME_TYPE){e.peerConnection.processRemoteOffer(r)}else if(i==a.Constants.VI_SPD_ANSWER_MIME_TYPE){e.peerConnection.processRemoteAnswer({},r)}else{this.dispatchEvent({name:"InfoReceived",call:this,body:r,headers:o,mimeType:i})}return true}else{this.log.warning("received handleSIPInfo for call: "+e.id()+" in invalid state: "+e.state())}};e.prototype.setActive=function(e){var t=this;return new Promise(function(n,r){if(!t.signalingConnected)r({code:11,call:t});if(u.default.getWSVendor()==="firefox"){t.sendInfo(a.Constants.VI_HOLD_EMUL,JSON.stringify({hold:!e}));n({call:t,result:true});return}if(t._state===h.UPDATING){t.addPendingReinvite({action:"setActive",resolve:n,reject:r,params:e})}else{if(t._state==h.CONNECTED){t._state=h.UPDATING;t._active=e;if(!e)i.VoxSignaling.get().callRemoteFunction(g.RemoteFunction.hold,t._id);else i.VoxSignaling.get().callRemoteFunction(g.RemoteFunction.unhold,t._id);n({result:true,call:t})}else{r({code:11,call:t})}}})};Object.defineProperty(e.prototype,"promise",{get:function(){return this._promise},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"peerConnection",{get:function(){return this._peerConnection},set:function(e){this._peerConnection=e},enumerable:true,configurable:true});e.prototype.checkCallMode=function(e){return this._mode==e};e.prototype.canStartSendingCandidates=function(){if(typeof this._peerConnection=="undefined")this._peerConnection=d.PCFactory.get().peerConnections[this._id];this._peerConnection.canStartSendingCandidates()};e.prototype.notifyICETimeout=function(){this.dispatchEvent({name:"ICETimeout",call:this})};e.prototype.sendVideo=function(e){if(this.videoDirections.sendVideo===e)return;return this.sendMedia(null,e)};e.prototype.receiveVideo=function(){var e=this;if(this.videoDirections.receiveVideo===true)return;return new Promise(function(t,n){e.videoDirections.receiveVideo=true;if(e._state===h.UPDATING)e.addPendingReinvite({action:"receiveVideo",resolve:t,reject:n,params:{}});else{e._state=h.UPDATING;if(e._renegotiationPromise!==null){n({code:12,call:e})}e._renegotiationPromise={resolve:t,reject:n};e._peerConnection._hdnFRS()}})};e.prototype.sendMedia=function(e,t){var n=this;return new Promise(function(r,o){if(t!=null)n.videoDirections.sendVideo=t;if(n._state===h.UPDATING)n.addPendingReinvite({action:"sendMedia",resolve:r,reject:o,params:{audio:e,video:t}});else{n._state=h.UPDATING;if(n._renegotiationPromise!==null){o({code:12,call:n})}n._renegotiationPromise={resolve:r,reject:o};var i=c.UserMediaManager.get().getConstrainWithSendFlag(e,t);n.peerConnection.setVideoEnabled(n.videoDirections);c.UserMediaManager.get().getQueryMediaSilent(i).then(function(e){n.peerConnection.bindLocalMedia(e)}).catch(function(e){o({code:13,call:n,event:e})})}})};e.prototype.sendAudio=function(e){return this.sendMedia(e,null)};e.prototype.getLocalStream=function(){var e=this;if(this._wiredLocal)return new Promise(function(t,n){if(e.peerConnection)t(e.peerConnection.localStream);else n(new Error("We have no PC for this call yet"))});else return c.UserMediaManager.get().queryMedia()};e.prototype.setLocalStream=function(e){return new Promise(function(e,t){t(new Error("Not implemented"))})};e.prototype.shareScreen=function(){var e=this;if(u.default.isScreenSharingSupported)u.default.getScreenMedia().then(function(t){e.peerConnection._addMediaStream(t)});else s.LogManager.get().writeMessage(s.LogCategory.CALL,"SCREEN SHARING",s.LogLevel.WARNING,"Sorry, this browser does not support screen sharing.")};e.prototype.stopSharingScreen=function(){if(u.default.isScreenSharingSupported)this.peerConnection.stopSharing();else s.LogManager.get().writeMessage(s.LogCategory.CALL,"SCREEN SHARING",s.LogLevel.WARNING,"Sorry, this browser does not support screen sharing.")};e.prototype.addLocalStream=function(e){this.peerConnection._addMediaStream(e)};e.prototype.wireRemoteStream=function(){var e=this;return new Promise(function(t,n){if(e.peerConnection){if(typeof e.peerConnection.remoteStreams[0]!="undefined"){e.peerConnection.wireRemoteStream(true).then(function(){e._wiredRemote=true;t()}).catch(n)}else n(new Error("We have no remote MediaStream for this call yet"))}else n(new Error("We have no PC for this call yet"))})};e.prototype.getRemoteAudioStreams=function(){var e=this;return new Promise(function(t,n){if(e.peerConnection){if(typeof e.peerConnection.remoteStreams[0]!="undefined"&&e.peerConnection.remoteStreams[0].getAudioTracks().length!=0)t(new MediaStream(e.peerConnection.remoteStreams[0].getAudioTracks()));else n(new Error("We have no remote MediaStream for this call yet"))}else n(new Error("We have no PC for this call yet"))})};e.prototype.getRemoteVideoStreams=function(){var e=this;return new Promise(function(t,n){if(e.peerConnection){if(typeof e.peerConnection.remoteStreams[0]!="undefined"&&e.peerConnection.remoteStreams[0].getVideoTracks().length!=0)t(new MediaStream(e.peerConnection.remoteStreams[0].getVideoTracks()));else n(new Error("We have no remote MediaStream for this call yet"))}else n(new Error("We have no PC for this call yet"))})};e.prototype.getRemoteWiredState=function(){return this._wiredRemote};e.prototype.getLocalWiredState=function(){return this._wiredLocal};e.prototype.useAudioOutput=function(e){var t=this;return new Promise(function(n,r){if(u.default.getWSVendor(true)!=="chrome")r(new Error("Unsupported browser. Only Google Chrome 49 and above."));return t.peerConnection.updateRenderersSink(e)})};e.prototype.getAudioElementId=function(){if(this._peerConnection.remoteStreams.length=0)return null;if(this._peerConnection.remoteStreams[0].getAudioTracks().length=0)return null;return this._peerConnection.remoteStreams[0].getAudioTracks()[0].id};e.prototype.getDirections=function(){if(typeof this.peerConnection!=="undefined")return this.peerConnection.getDirections()};e.prototype.getStreamActivity=function(){return{}};e.prototype.hdnFRS=function(){this.peerConnection._hdnFRS()};e.prototype.hdnFRSPrep=function(){var e=this;if(typeof this.peerConnection!=="undefined")this.peerConnection._hdnFRSPrep();else setTimeout(function(){e.hdnFRSPrep()},1e3)};e.prototype.runIncomingReInvite=function(e,t){if(this._state===h.UPDATING){this.dispatchEvent({code:11,call:this})}else{this._state=h.UPDATING;var n=l.CallManager.get().isSDPHasVideo(t);this.peerConnection.handleReinvite(e,t,n)}};e.prototype.addPendingReinvite=function(e){if(this.pendingReinvites.length>5){this.log.info("Update queue overflow.")}this.pendingReinvites.push(e)};e.prototype.runPendingReinvite=function(){var e=this;if(this.pendingReinvites.length===0)return;var t=this.pendingReinvites.splice(0,1)[0];setTimeout(function(){switch(t.action){case"runIncomingReInvite":e.runIncomingReInvite(t.params.headers,t.params.sdp);break;case"setActive":e.setActive(t.params).then(function(){return t.resolve()}).catch(function(){return t.reject()});break;case"sendMedia":e.sendMedia(t.params.audio,t.params.video).then(function(){return t.resolve()}).catch(function(){return t.reject()});break;case"receiveVideo":e.receiveVideo().then(function(){return t.resolve()}).catch(function(){return t.reject()});break}},800)};e.prototype.setActiveForce=function(e){this._active=e};r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"id",null);r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"number",null);r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"displayName",null);r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"headers",null);r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"active",null);r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"state",null);r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"answer",null);r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"decline",null);r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"reject",null);r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"hangup",null);r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"sendTone",null);r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"mutePlayback",null);r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"muteMicrophone",null);r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"unmutePlayback",null);r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"unmuteMicrophone",null);r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"showRemoteVideo",null);r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"setRemoteVideoPosition",null);r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"setRemoteVideoSize",null);r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"sendInfo",null);r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"sendMessage",null);r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"setVideoSettings",null);r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"getVideoElementId",null);r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"addEventListener",null);r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"on",null);r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"removeEventListener",null);r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"off",null);r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"dispatchEvent",null);r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"checkState",null);r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"onConnected",null);r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"onDisconnected",null);r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"onFailed",null);r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"onStopRinging",null);r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"onRingOut",null);r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"onTransferComplete",null);r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"onTransferFailed",null);r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"onInfo",null);r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"setActive",null);r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"checkCallMode",null);r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"canStartSendingCandidates",null);r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"notifyICETimeout",null);r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"sendVideo",null);r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"receiveVideo",null);r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"sendAudio",null);r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"getLocalStream",null);r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"setLocalStream",null);r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"addLocalStream",null);r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"wireRemoteStream",null);r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"getRemoteAudioStreams",null);r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"getRemoteVideoStreams",null);r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"getRemoteWiredState",null);r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"getLocalWiredState",null);r([s.LogManager.d_trace(s.LogCategory.CLIENT)],e.prototype,"useAudioOutput",null);r([s.LogManager.d_trace(s.LogCategory.CLIENT)],e.prototype,"getAudioElementId",null);r([s.LogManager.d_trace(s.LogCategory.CLIENT)],e.prototype,"getDirections",null);r([s.LogManager.d_trace(s.LogCategory.CLIENT)],e.prototype,"getStreamActivity",null);r([s.LogManager.d_trace(s.LogCategory.CLIENT)],e.prototype,"hdnFRS",null);r([s.LogManager.d_trace(s.LogCategory.CLIENT)],e.prototype,"hdnFRSPrep",null);r([s.LogManager.d_trace(s.LogCategory.CLIENT)],e.prototype,"runIncomingReInvite",null);r([s.LogManager.d_trace(s.LogCategory.CLIENT)],e.prototype,"addPendingReinvite",null);r([s.LogManager.d_trace(s.LogCategory.CLIENT)],e.prototype,"runPendingReinvite",null);r([s.LogManager.d_trace(s.LogCategory.CLIENT)],e.prototype,"setActiveForce",null);return e}();t.Call=m},function(e,t){"use strict";(function(e){e[e["Connected"]="Connected"]="Connected";e[e["Disconnected"]="Disconnected"]="Disconnected";e[e["Failed"]="Failed"]="Failed";e[e["ProgressToneStart"]="ProgressToneStart"]="ProgressToneStart";e[e["ProgressToneStop"]="ProgressToneStop"]="ProgressToneStop";e[e["MessageReceived"]="onSendMessage"]="MessageReceived";e[e["InfoReceived"]="InfoReceived"]="InfoReceived";e[e["TransferComplete"]="TransferComplete"]="TransferComplete";e[e["TransferFailed"]="TransferFailed"]="TransferFailed";e[e["ICETimeout"]="ICETimeout"]="ICETimeout";e[e["RTCStatsReceived"]="RTCStatsReceived"]="RTCStatsReceived";e[e["MediaElementCreated"]="MediaElementCreated"]="MediaElementCreated";e[e["VideoPlaybackStarted"]="VideoPlaybackStarted"]="VideoPlaybackStarted";e[e["ICECompleted"]="ICECompleted"]="ICECompleted";e[e["Updated"]="Updated"]="Updated";e[e["PendingUpdate"]="PendingUpdate"]="PendingUpdate";e[e["UpdateFailed"]="UpdateFailed"]="UpdateFailed"})(t.CallEvents||(t.CallEvents={}));var n=t.CallEvents},function(e,t){"use strict";var n=function(){function e(){}e.DIRECT_CALL_HEADER="X-DirectCall";e.VIAMEDIA_CALL_HEADER="X-ViaMedia";e.CALLSTATSIOID_HEADER="X-CallstatsIOID";e.CALL_DATA_HEADER="VI-CallData";e.ZINGAYA_IM_MIME_TYPE="application/zingaya-im";e.P2P_SPD_FRAG_MIME_TYPE="voximplant/sdpfrag";e.VI_HOLD_EMUL="vi/holdemul";e.VI_SPD_OFFER_MIME_TYPE="vi/sdpoffer";e.VI_SPD_ANSWER_MIME_TYPE="vi/sdpanswer";return e}();t.Constants=n},function(e,t){"use strict";(function(e){e[e["ping"]="__ping"]="ping";e[e["login"]="login"]="login";e[e["loginGenerateOneTimeKey"]="loginGenerateOneTimeKey"]="loginGenerateOneTimeKey";e[e["loginStage2"]="loginStage2"]="loginStage2";e[e["setOperatorACDStatus"]="setOperatorACDStatus"]="setOperatorACDStatus";e[e["setDesiredVideoBandwidth"]="setDesiredVideoBandwidth"]="setDesiredVideoBandwidth";e[e["rejectCall"]="rejectCall"]="rejectCall";e[e["disconnectCall"]="disconnectCall"]="disconnectCall";e[e["sendDTMF"]="sendDTMF"]="sendDTMF";e[e["sendSIPInfo"]="sendSIPInfo"]="sendSIPInfo";e[e["hold"]="hold"]="hold";e[e["unhold"]="unhold"]="unhold";e[e["acceptCall"]="acceptCall"]="acceptCall";e[e["createCall"]="createCall"]="createCall";e[e["transferCall"]="transferCall"]="transferCall";e[e["muteLocal"]="__muteLocal"]="muteLocal";e[e["reInvite"]="ReInvite"]="reInvite";e[e["acceptReInvite"]="AcceptReInvite"]="acceptReInvite";e[e["confirmPC"]="__confirmPC"]="confirmPC";e[e["addCandidate"]="__addCandidate"]="addCandidate";e[e["loginUsingOneTimeKey"]="loginUsingOneTimeKey"]="loginUsingOneTimeKey";e[e["refreshOauthToken"]="refreshOauthToken"]="refreshOauthToken";e[e["zPromptFinished"]="promptFinished"]="zPromptFinished";e[e["zStartPreFlightCheck"]="__startPreFlightCheck"]="zStartPreFlightCheck";e[e["registerPushToken"]="registerPushToken"]="registerPushToken";e[e["unregisterPushToken"]="unregisterPushToken"]="unregisterPushToken";e[e["pushFeedback"]="pushFeedback"]="pushFeedback"})(t.RemoteFunction||(t.RemoteFunction={}));var n=t.RemoteFunction},function(e,t,n){"use strict";var r=n(7);var o=n(4);var i=function(){function e(e){this.kind=e;this.inUse=false;this.track=null;this.callId=null}e.prototype.attach=function(e,t){r.default.attachMedia(new MediaStream([e]),this.element);this.direction=t};e.prototype.free=function(){r.default.detachMedia(this.element);this.inUse=false;this.track=null;this.callId=null};return e}();t.ReusableStructure=i;var a=function(){function e(){this.elementList=new Array;this.log=o.LogManager.get().createLogger(o.LogCategory.RTC,"Renderer")}e.get=function(){if(!this.inst)this.inst=new e;return this.inst};e.prototype.getFreeElements=function(e){return this.elementList.filter(function(t){if(t.inUse&&(e=="all"||e==t.kind))return true})};e.prototype.catchRender=function(e,t,n){var r=this.getFreeElements(e.kind);var o;if(r.length){o=r[0]}else{o=new i(e.kind);this.elementList.push(o)}o.inUse=true;o.track=e;o.callId=t;o.attach(e,n);return o.element};e.prototype.catchRenders=function(e,t,n){var r=e.getTracks();var o=[];for(var i=0;i<r.length;i++){o.push(this.catchRender(r[i],t,n))}return o};e.prototype.freeRendersByCallId=function(e,t){if(t===void 0){t="all"}this.elementList.map(function(n){if(n.callId==e&&(t=="all"||t==n.direction))n.free()})};e.prototype.freeRenderByTrack=function(e){this.elementList.map(function(t){if(t.track.id==e.id)t.free()})};e.prototype.getRendererByCallId=function(e,t){if(t===void 0){t="all"}this.elementList.filter(function(n){if(n.callId==e&&(t=="all"||t==n.direction))return true})};return e}();t.ReusableRenderer=a},function(e,t,n){"use strict";var r=this&&this.__extends||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n];function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)};var o=this&&this.__decorate||function(e,t,n,r){var o=arguments.length,i=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,a;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")i=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)if(a=e[s])i=(o<3?a(i):o>3?a(t,n,i):a(t,n))||i;return o>3&&i&&Object.defineProperty(t,n,i),i};var i=n(17);var a=n(6);var s=n(16);var c=n(4);var d=n(20);var l=function(e){r(t,e);function t(t,n,r,o){e.call(this,t,n,r,o);this._mode=i.CallMode.SERVER}t.prototype.answer=function(t,n){e.prototype.answer.call(this,t,n);var r={tracks:this.peerConnection.getTrackKind()};a.VoxSignaling.get().callRemoteFunction(d.RemoteFunction.acceptCall,this._id,s.CallManager.cleanHeaders(n),r)};o([c.LogManager.d_trace(c.LogCategory.CALLEXSERVER)],t.prototype,"answer",null);return t}(i.Call);t.CallExServer=l},function(e,t,n){"use strict";var r=this&&this.__extends||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n];function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)};var o=this&&this.__decorate||function(e,t,n,r){var o=arguments.length,i=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,a;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")i=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)if(a=e[s])i=(o<3?a(i):o>3?a(t,n,i):a(t,n))||i;return o>3&&i&&Object.defineProperty(t,n,i),i};var i=n(17);var a=n(6);var s=n(4);var c=n(11);var d=n(20);var l=n(19);var u=function(e){r(t,e);function t(){e.apply(this,arguments)}t.prototype.answer=function(t,n,r){var o=this;e.prototype.answer.call(this,t,n);if(typeof t!="undefined"){if(typeof n=="undefined")n={};n[l.Constants.CALL_DATA_HEADER]=t}var i=c.UserMediaManager.get();if(typeof r=="undefined")i.attachTo(this._peerConnection);else if(!r.sendVideo){i.attachToSound(this._peerConnection)}else{i.attachTo(this._peerConnection)}this._peerConnection.getLocalAnswer().then(function(e){a.VoxSignaling.get().callRemoteFunction(d.RemoteFunction.acceptCall,o.id(),n,e.sdp)})};o([s.LogManager.d_trace(s.LogCategory.CALLEXP2P)],t.prototype,"answer",null);return t}(i.Call);t.CallExP2P=u},function(e,t){"use strict";(function(e){e[e["loginFailed"]="loginFailed"]="loginFailed";e[e["loginSuccessful"]="loginSuccessful"]="loginSuccessful";e[e["handleError"]="handleError"]="handleError";e[e["onPCStats"]="__onPCStats"]="onPCStats";e[e["handleIncomingConnection"]="handleIncomingConnection"]="handleIncomingConnection";e[e["handleConnectionConnected"]="handleConnectionConnected"]="handleConnectionConnected";e[e["handleConnectionDisconnected"]="handleConnectionDisconnected"]="handleConnectionDisconnected";e[e["handleRingOut"]="handleRingOut"]="handleRingOut";e[e["startEarlyMedia"]="startEarlyMedia"]="startEarlyMedia";e[e["stopRinging"]="stopRinging"]="stopRinging";e[e["handleConnectionFailed"]="handleConnectionFailed"]="handleConnectionFailed";e[e["handleSIPInfo"]="handleSIPInfo"]="handleSIPInfo";e[e["handleSipEvent"]="handleSipEvent"]="handleSipEvent";e[e["handleTransferStarted"]="handleTransferStarted"]="handleTransferStarted";e[e["handleTransferComplete"]="handleTransferComplete"]="handleTransferComplete";e[e["handleTransferFailed"]="handleTransferFailed"]="handleTransferFailed";e[e["handleReInvite"]="handleReInvite"]="handleReInvite";e[e["handleAcceptReinvite"]="handleAcceptReinvite"]="handleAcceptReinvite";e[e["handleRejectReinvite"]="handleRejectReinvite"]="handleRejectReinvite";e[e["createPC"]="__createPC"]="createPC";e[e["destroyPC"]="__destroyPC"]="destroyPC";e[e["connectionSuccessful"]="__connectionSuccessful"]="connectionSuccessful";e[e["connectionFailed"]="__connectionFailed"]="connectionFailed";e[e["createConnection"]="__createConnection"]="createConnection";e[e["pong"]="__pong"]="pong";e[e["increaseGain"]="increaseGain"]="increaseGain";e[e["handlePreFlightCheckResult"]="handlePreFlightCheckResult"]="handlePreFlightCheckResult";e[e["handleVoicemail"]="handleVoicemail"]="handleVoicemail";e[e["onCallRemoteFunctionError"]="onCallRemoteFunctionError"]="onCallRemoteFunctionError";e[e["refreshOauthTokenFailed"]="refreshOauthTokenFailed"]="refreshOauthTokenFailed";e[e["refreshOauthTokenSuccessful"]="refreshOauthTokenSuccessful"]="refreshOauthTokenSuccessful"})(t.RemoteEvent||(t.RemoteEvent={}));var n=t.RemoteEvent;

},function(e,t,n){"use strict";var r=this&&this.__extends||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n];function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)};var o=this&&this.__decorate||function(e,t,n,r){var o=arguments.length,i=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,a;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")i=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)if(a=e[s])i=(o<3?a(i):o>3?a(t,n,i):a(t,n))||i;return o>3&&i&&Object.defineProperty(t,n,i),i};var i=n(17);var a=n(6);var s=n(4);var c=n(11);var d=n(20);var l=n(7);var u=n(19);var g=function(e){r(t,e);function t(){e.apply(this,arguments)}t.prototype.answer=function(t,n,r){var o=this;e.prototype.answer.call(this,t,n);if(typeof t!="undefined"){if(typeof n=="undefined")n={};n[u.Constants.CALL_DATA_HEADER]=t}var i=c.UserMediaManager.get();if(typeof r=="undefined")i.attachTo(this._peerConnection);else if(!r.sendVideo){this._peerConnection.setVideoFlags(r);this.videoDirections=r;i.attachToSound(this._peerConnection)}else{this._peerConnection.setVideoFlags(r);this.videoDirections=r;i.attachTo(this._peerConnection)}this._peerConnection.getLocalAnswer().then(function(e){var t={tracks:o.peerConnection.getTrackKind()};a.VoxSignaling.get().callRemoteFunction(d.RemoteFunction.acceptCall,o.id(),n,e.sdp,t)})};t.prototype.setActive=function(e){var t=this;return new Promise(function(n,r){if(t._state!==i.CallState.CONNECTED){t.addPendingReinvite({action:"setActive",resolve:n,reject:r,params:e});return}else{if(t._state===i.CallState.UPDATING){r({code:11,call:t})}else{t._state=i.CallState.UPDATING;if(l.default.getWSVendor()==="firefox"){t.sendInfo(u.Constants.VI_HOLD_EMUL,JSON.stringify({hold:!e}))}if(t._renegotiationPromise!==null){r({code:12,call:t});return}if(t._active==e){r({code:14,call:t});return}t._active=e;t._renegotiationPromise={resolve:n,reject:r};t.peerConnection.hold(!e)}}})};o([s.LogManager.d_trace(s.LogCategory.CALL)],t.prototype,"answer",null);o([s.LogManager.d_trace(s.LogCategory.CALL)],t.prototype,"setActive",null);return t}(i.Call);t.CallExMedia=g},function(e,t,n){"use strict";var r=n(4);(function(e){e[e["multiplex"]="multiplex"]="multiplex";e[e["audio"]="audio"]="audio";e[e["video"]="video"]="video";e[e["screen"]="screen"]="screen";e[e["data"]="data"]="data";e[e["unbundled"]="unbundled"]="unbundled"})(t.CallstatsIoFabricUsage||(t.CallstatsIoFabricUsage={}));var o=t.CallstatsIoFabricUsage;(function(e){e[e["fabricHold"]="fabricHold"]="fabricHold";e[e["fabricResume"]="fabricResume"]="fabricResume";e[e["audioMute"]="audioMute"]="audioMute";e[e["audioUnmute"]="audioUnmute"]="audioUnmute";e[e["videoPause"]="videoPause"]="videoPause";e[e["videoResume"]="videoResume"]="videoResume";e[e["fabricTerminated"]="fabricTerminated"]="fabricTerminated";e[e["screenShareStart"]="screenShareStart"]="screenShareStart";e[e["screenShareStop"]="screenShareStop"]="screenShareStop";e[e["dominantSpeaker"]="dominantSpeaker"]="dominantSpeaker";e[e["activeDeviceList"]="activeDeviceList"]="activeDeviceList"})(t.CallstatsIoFabricEvent||(t.CallstatsIoFabricEvent={}));var i=t.CallstatsIoFabricEvent;(function(e){e[e["getUserMedia"]="getUserMedia"]="getUserMedia";e[e["createOffer"]="createOffer"]="createOffer";e[e["createAnswer"]="createAnswer"]="createAnswer";e[e["setLocalDescription"]="setLocalDescription"]="setLocalDescription";e[e["setRemoteDescription"]="setRemoteDescription"]="setRemoteDescription";e[e["addIceCandidate"]="addIceCandidate"]="addIceCandidate";e[e["iceConnectionFailure"]="iceConnectionFailure"]="iceConnectionFailure";e[e["signalingError"]="signalingError"]="signalingError";e[e["applicationLog"]="applicationLog"]="applicationLog"})(t.CallstatsioWrtcFuncNames||(t.CallstatsioWrtcFuncNames={}));var a=t.CallstatsioWrtcFuncNames;var s=function(){function e(e){this._params=e;this.inited=false;this.pendingFabric=[];var t=window;if(typeof t.callstats!="undefined")this.callstats=new t.callstats(null,t.io)}e.isModuleEnabled=function(){return e.moduleEnabled};e.get=function(t){var n=window;if(typeof n.callstats!="undefined")e.moduleEnabled=true;if(typeof e.instance=="undefined"){e.instance=new e(t)}if(typeof t!="undefined"){e.instance._params=t}return e.instance};e.prototype.init=function(t){var n=this;if(!e.moduleEnabled)return false;r.LogManager.get().writeMessage(r.LogCategory.UTILS,"[CallstatsIo]",r.LogLevel.INFO," Callstats.io SDK initialization start");this.callstats.initialize(this._params.AppID,this._params.AppSecret,t,function(){r.LogManager.get().writeMessage(r.LogCategory.UTILS,"[CallstatsIo]",r.LogLevel.INFO," Callstats.io SDK initialization successful");n.inited=true;n.pendingFabric.map(function(e){n.callstats.addNewFabric(e.pc,e.remoteUser,e.fabricUsage,e.callID)})},function(){},this.packParams());return true};e.prototype.packParams=function(){var e={};if(this._params.disableBeforeUnloadHandler)e["disableBeforeUnloadHandler"]=this._params.disableBeforeUnloadHandler;if(this._params.applicationVersion)e["applicationVersion"]=this._params.applicationVersion;return e};e.prototype.addNewFabric=function(t,n,o,i){if(!e.moduleEnabled)return false;if(this.inited){r.LogManager.get().writeMessage(r.LogCategory.UTILS,"[CallstatsIo]",r.LogLevel.INFO," Callstats.io addNewFabric");this.callstats.addNewFabric(t,n,o,i)}else{this.pendingFabric.push({pc:t,remoteUser:n,fabricUsage:o,callID:i})}};e.prototype.sendFabricEvent=function(t,n,r){if(!e.moduleEnabled)return false;this.callstats.sendFabricEvent(t,n,r)};e.prototype.reportError=function(t,n,r,o,i,a){if(!e.moduleEnabled)return false;this.callstats.reportError(t,n,r,o,i,a)};e.moduleEnabled=false;return e}();t.CallstatsIo=s},function(e,t,n){"use strict";var r=n(6);var o=n(20);var i=function(){function e(e){this._id=e}e.prototype.insertDTMF=function(e,t,n){var r=this;e.split("").forEach(function(e){return r.sendKey(e)})};e.prototype.sendKey=function(e){var t;if(e=="*")t=10;else if(e=="#")t=11;else{t=parseInt(e)}if(t>=0||t<=11)r.VoxSignaling.get().callRemoteFunction(o.RemoteFunction.sendDTMF,this._id,t)};return e}();t.SignalingDTMFSender=i},function(e,t,n){"use strict";var r=n(27);var o=n(1);var i=function(){function e(){}e.attachStream=function(e,t){if(t.srcObject)t.srcObject=e;else t.src=URL.createObjectURL(e);t.load();if(t instanceof HTMLVideoElement)t.play().catch(function(e){});else{t.play();var n=o.Client.getInstance()._defaultSinkId;if(n!=null)t.setSinkId(n)}};e.detachStream=function(e){if(e instanceof HTMLVideoElement){var t=e.pause();if(typeof t!="undefined")t.catch(function(e){})}else e.pause();e.src=""};e.getDTMFSender=function(e,t){if(!!e.createDTMFSender){var n=[];e.getLocalStreams().forEach(function(e){e.getAudioTracks().forEach(function(e){n.push(e)})});if(n.length){return e.createDTMFSender(n[0])}}else return new r.SignalingDTMFSender(t)};e.getScreenMedia=function(){return new Promise(function(e,t){window.postMessage("get-sourceId","*");var n=function(r){if(!r.data)return;if(r.origin==window.location.origin){if(r.data=="PermissionDeniedError"){t(new Error("PermissionDeniedError"))}if(typeof r.data!="string"&&typeof r.data.sourceId!="undefined"){window.removeEventListener("message",n);var o={audio:false,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:screen.width>1920?screen.width:1920,maxHeight:screen.height>1080?screen.height:1080,chromeMediaSourceId:r.data.sourceId},optional:[{googTemporalLayeredScreencast:true}]}};navigator.mediaDevices.getUserMedia(o).then(function(t){e(t)}).catch(function(e){t(e)})}}};window.addEventListener("message",n)})};e.onSharingResult=function(e){};e.getRTCStats=function(e){return new Promise(function(t,n){var r=[];e.getStats().then(function(e){e.forEach(function(e){if(e.type=="ssrc"){var t={};t.id=e.id;t.type=e.type;t.timestamp=e.timestamp;r.push(t)}});t(r)}).catch(n)})};return e}();t.Webkit=i},function(e,t,n){"use strict";var r=this&&this.__extends||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n];function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)};var o=this&&this.__decorate||function(e,t,n,r){var o=arguments.length,i=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,a;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")i=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)if(a=e[s])i=(o<3?a(i):o>3?a(t,n,i):a(t,n))||i;return o>3&&i&&Object.defineProperty(t,n,i),i};var i=n(14);var a=n(7);var s=n(11);var c=n(15);var d=n(13);var l=n(4);var u=n(6);var g=n(16);var f=n(20);var p=n(30);var h=n(18);var v=n(26);var m=n(19);var C=h.CallEvents.Updated;var y=n(31);var L=n(1);var S;(function(e){e[e["offer"]="offer"]="offer";e[e["answer"]="answer"]="answer";e[e["pranswer"]="pranswer"]="pranswer";e[e["rollback"]="rollback"]="rollback"})(S||(S={}));var E;(function(e){e[e["controlling"]="controlling"]="controlling";e[e["controlled"]="controlled"]="controlled"})(E||(E={}));var _=function(e){r(t,e);function t(t,n,r){var o=this;e.call(this,t,n,r);this.iceTimer=null;this.needTransportRestart=true;this.ICE_TIMEOUT=2e4;this.RENEGOTIATION_TIMEOUT=15e3;var i=d.PCFactory.get().iceConfig;var a=i;if(a!==null)a.rtcpMuxPolicy="negotiate";else{a={gatherPolicy:"all",iceServers:[],rtcpMuxPolicy:"negotiate"}}this.impl=new RTCPeerConnection(a,{optional:[{DtlsSrtpKeyAgreement:"true"}]});if(typeof this.impl.ontrack!=="undefined"){this.impl.ontrack=function(e){return o.onAddTrack(e)}}else if(typeof this.impl.onaddtrack!=="undefined"){this.impl.onaddtrack=function(e){return o.onAddTrack(e)}}else{this.impl.onaddstream=function(e){return o.onAddStream(e)}}this.impl.onicecandidate=function(e){o.onICECandidate(e["candidate"])};this.rtpSenders=[];this.renegotiationInProgress=false;this.impl.onnegotiationneeded=function(e){return o.onRenegotiation()};this.impl.onsignalingstatechange=function(e){return o.onSignalingStateChange()};this.impl.oniceconnectionstatechange=function(e){return o.onConnectionChange()};this.iceRole=E.controlling;this._remoteStreams=[];this.banReinviteAnswer=false;this._call=g.CallManager.get().calls[this.id];if(typeof this._call!="undefined")this.onHold=!this._call.active();else this.onHold=false;this.rtcCollectingCycle=setInterval(function(){o.getPCStats()},g.CallManager.get().rtcStatsCollectionInterval);if(typeof this._call!=="undefined"){var s=this._call.headers()[m.Constants.CALLSTATSIOID_HEADER];if(typeof s==="undefined")s=this._call.id();v.CallstatsIo.get().addNewFabric(this.impl,this._call.number(),r?v.CallstatsIoFabricUsage.multiplex:v.CallstatsIoFabricUsage.audio,s)}this.needTransportRestart=false}t.prototype.onSignalingStateChange=function(){this.log.info("Signal state changed to "+this.impl.signalingState+" for PC:"+this.id);if(this.impl.signalingState==="stable"){}};t.prototype.getPCStats=function(){var e=this;a.default.getRTCStats(this.impl).then(function(t){if(typeof e._call!=="undefined")e._call.dispatchEvent({name:"RTCStatsReceived",stats:t})})};t.prototype.onConnectionChange=function(){if(this.impl.iceConnectionState==="completed"){if(typeof this._call!=="undefined"){this._call.dispatchEvent({name:"ICECompleted",call:this._call})}}if(this.impl.iceConnectionState==="completed"||this.impl.iceConnectionState==="connected"){this.iceTimer&&clearTimeout(this.iceTimer);this.iceTimer=null}};t.prototype.onRenegotiation=function(){var e=this;if(typeof this.impl==="undefined")return;if(this.impl.connectionState==="disconnected"||this.impl.connectionState==="failed"){this.log.info("Renegotiation requested on closed PeerConnection");return}if(this.impl.localDescription===null){this.log.info("Renegotiation needed, but no local SD, skipping");return}if(this.impl.iceConnectionState!=="connected"&&this.impl.iceConnectionState!=="completed"){this.log.info("Renegotiation requested while ice state is "+this.impl.iceConnectionState+". Postponing");setTimeout(this.onRenegotiation,100);return}if(this.renegotiationInProgress){this.log.info("Renegotiation in progress. Queueing");return}else{this.log.info("Renegotiation started")}if(this.renegotiationInProgress===false){this.renegotiationInProgress=true;this.renegotiationTimer=setTimeout(function(){clearTimeout(e.renegotiationTimer);e._call.dispatchEvent({name:C,result:false,call:e._call});e.renegotiationInProgress=false},this.RENEGOTIATION_TIMEOUT);var t=this.getReceiveOptions();this.updateHoldState();this.impl.createOffer(t).then(function(t){t=d.PCFactory.get().addBandwidthParams(t);t=y.SDPMuggle.removeTelephoneEvents(t);t=y.SDPMuggle.removeDoubleOpus(t);t=y.SDPMuggle.fixVideoRecieve(t,e.videoEnabled.receiveVideo);return t}).then(function(t){e.srcLocalSDP=t.sdp;e.pendingOffer=t;return t}).then(function(){var t={tracks:e._getTrackKind()};u.VoxSignaling.get().callRemoteFunction(f.RemoteFunction.reInvite,e._call.id(),{},e.pendingOffer.sdp,t)}).catch(function(t){e.log.error("Error when renegatiation start "+t.message)})}else{this.log.error("Another renegatiation in progress")}};t.prototype.getReceiveOptions=function(){return{offerToReceiveAudio:!this.onHold,offerToReceiveVideo:this.videoEnabled.receiveVideo&&!this.onHold}};t.prototype.updateHoldState=function(){var e=this;this.impl.getLocalStreams().forEach(function(t){t.getTracks().forEach(function(t){t.enabled=!e.onHold})});this.impl.getRemoteStreams().forEach(function(t){t.getTracks().forEach(function(t){t.enabled=!e.onHold})})};t.prototype.onICECandidate=function(e){if(e&&e!==null){this.sendLocalCandidateToPeer("a="+e.candidate,e.sdpMLineIndex)}else{this.log.info("End of candidates")}};t.prototype.onAddTrack=function(e){var t=e.track.kind;var n=new MediaStream([e.track]);var r=this.renderStream(n,t);if(t==="video"&&typeof this.videoRendered==="undefined")this.videoRendered=r;else if(typeof this.audioRendered==="undefined")this.audioRendered=r;this.updateHoldState();this._remoteStreams.push(n);this.renderers.push(r);this.mapRenderer(n,r)};t.prototype.mapRenderer=function(e,t){var n=this;e.getTracks().forEach(function(r){r.onended=function(){n.checkStreamActive(e,t)}})};t.prototype.checkStreamActive=function(e,t){if(!e.getTracks().some(function(e){return e.readyState==="live"})){c.Renderer.get().releaseElement(t)}};t.prototype.onAddStream=function(e){var t=s.UserMediaManager.getVideoTracks(e.stream).length?"video":"audio";var n=this.renderStream(e.stream,t);if(t==="video"&&typeof this.videoRendered==="undefined")this.videoRendered=n;else if(typeof this.audioRendered==="undefined")this.audioRendered=n;this.updateHoldState();this._remoteStreams.push(e.stream);this.renderers.push(n);this.mapRenderer(e.stream,n)};t.prototype.renderStream=function(e,t){var n=document.body;var r=e.getTracks();if(t=="video"&&typeof L.Client.getInstance().remoteVideoContainerId!=="undefined")n=document.getElementById(L.Client.getInstance().remoteVideoContainerId);if(this.checkMediaAttached(t))n=null;var o=c.Renderer.get().getElement(r[0].id,t==="video",n);if(e.oninactive)e.oninactive(function(){a.default.detachMedia(o)});if(typeof this.sinkId!=="undefined")o.setSinkId(this.sinkId);a.default.attachMedia(e,o);if(typeof this._call!=="undefined")this._call.dispatchEvent({name:h.CallEvents.MediaElementCreated,call:this._call,element:o,type:t});return o};t.prototype.checkMediaAttached=function(e){return this._remoteStreams.length>0&&this._remoteStreams.reduce(function(t,n){if(e==="audio")return t&&n.getAudioTracks().length>0;else if(e==="video")return t&&n.getVideoTracks().length>0;else return t},true)};t.prototype.wireRemoteStream=function(e){return new Promise(function(e,t){t(new Error("Not implemented"))})};t.prototype._processRemoteAnswer=function(e,t){var n=this;this.iceTimer=setTimeout(function(){n._call.notifyICETimeout()},this.ICE_TIMEOUT);this.pendingEvent=[e,t];if(this.impl.remoteDescription!==null)if(this.impl.remoteDescription.sdp!="")return;var r=new RTCSessionDescription({sdp:t,type:S.answer});this.srcRemoteSDP=t;r=y.SDPMuggle.removeTIAS(r);return this.impl.setRemoteDescription(r)};t.prototype._getLocalOffer=function(){var e=this;this.iceRole=E.controlling;return new Promise(function(t,n){var r=e.getReceiveOptions();e.impl.createOffer(r).then(function(t){t=d.PCFactory.get().addBandwidthParams(t);return e.codecRearrange(t)}).then(function(t){e.srcLocalSDP=t.sdp;return e.impl.setLocalDescription(t)}).then(function(){t(e.impl.localDescription)}).catch(function(e){n(e)})})};t.prototype._getLocalAnswer=function(){var e=this;this.iceRole=E.controlled;return new Promise(function(t,n){var r={mandatory:e.getReceiveOptions()};e.impl.createAnswer(r).then(function(t){t=d.PCFactory.get().addBandwidthParams(t);t=y.SDPMuggle.fixVideoRecieve(t,e.videoEnabled.receiveVideo);return e.codecRearrange(t)}).then(function(t){e.srcLocalSDP=t.sdp;return e.impl.setLocalDescription(t)}).then(function(){t({type:S.answer,sdp:e.impl.localDescription.sdp})}).catch(function(e){n(e)})})};t.prototype._setRemoteDescription=function(e){var t=new RTCSessionDescription({sdp:e,type:S.offer});t=y.SDPMuggle.removeTIAS(t);this.srcRemoteSDP=e;return this.impl.setRemoteDescription(t)};t.prototype._processRemoteOffer=function(e){var t=this;this.iceRole=E.controlled;return new Promise(function(n,r){var o=new RTCSessionDescription({sdp:e,type:S.offer});t.srcRemoteSDP=e;o=y.SDPMuggle.removeTIAS(o);t.impl.setRemoteDescription(o).then(function(){var e={mandatory:t.getReceiveOptions()};return t.impl.createAnswer(e)}).then(function(e){return t.codecRearrange(e)}).then(function(e){t.srcLocalSDP=e.sdp;return t.impl.setLocalDescription(e)}).then(function(){n(t.impl.localDescription.sdp)}).catch(function(e){r(e)})})};t.prototype._close=function(){var e=this;clearInterval(this.rtcCollectingCycle);this.impl.onnegotiationneeded=null;if(this.impl.removeTrack)this.rtpSenders.forEach(function(t){e.impl.removeTrack(t)});else this.impl.getLocalStreams().forEach(function(t){t.getTracks().forEach(function(e){e.stop();t.removeTrack(e)});e.impl.removeStream(t)});if(this.impl.signalingState!=="closed"){this.impl.close()}if(typeof this._call!=="undefined")v.CallstatsIo.get().sendFabricEvent(this.impl,v.CallstatsIoFabricEvent.fabricTerminated,this._call.id());this._localStream=null;this._remoteStreams=null};t.prototype._addRemoteCandidate=function(e,t){var n=this;return new Promise(function(r,o){try{n.impl.addIceCandidate(new RTCIceCandidate({candidate:e.substring(2),sdpMLineIndex:t})).then(function(){r()}).catch(function(){r()})}catch(i){r()}})};t.prototype._bindLocalMedia=function(){var e=this;if(typeof this._localStream!=="undefined"){if(typeof this.impl.removeTrack!=="undefined"){this._localStream.getTracks().forEach(function(t){e.rtpSenders.push(e.impl.addTrack(t,e._localStream))})}else{this.impl.addStream(this._localStream)}if(!!this._call){var t=a.default.getDTMFSender(this.impl,this._call.id());if(t)this.dtmfSender=t}this.updateHoldState()}};t.prototype._addMediaStream=function(e){var t=this;if(typeof this.shareScreenMedia==="undefined")this.shareScreenMedia=[];if(typeof this.shareScreenMediaTracks==="undefined")this.shareScreenMediaTracks=[];this.shareScreenMedia.push(e);e.getTracks().forEach(function(e){t.shareScreenMediaTracks.push(e.id)});if(typeof this.impl.removeTrack!=="undefined"){e.getTracks().forEach(function(e){t.rtpSenders.push(t.impl.addTrack(e,t._localStream))})}else{this.impl.addStream(e)}};t.prototype._unbindLocalMegia=function(){var e=this;this.needTransportRestart=true;if(typeof this.impl.removeTrack!=="undefined"){this.rtpSenders.forEach(function(t){if(e.shareScreenMediaTracks){if(e.shareScreenMediaTracks.indexOf(t.track.id)===-1){e.impl.removeTrack(t)}}else{e.impl.removeTrack(t)}})}else{this.impl.removeStream(this._localStream)}if(this._localStream)this._localStream.getTracks().forEach(function(t){t.stop();e._localStream.removeTrack(t)});this._localStream=null};t.prototype._handleReinvite=function(e,t){var n=this;return new Promise(function(r,o){if(n.banReinviteAnswer){o();return}if(n.renegotiationInProgress===false){n.renegotiationInProgress=true;var i=new RTCSessionDescription({sdp:t,type:S.offer});n.srcRemoteSDP=t;i=y.SDPMuggle.removeTIAS(i);n.impl.setRemoteDescription(i).then(function(){var e={mandatory:n.getReceiveOptions()};return n.impl.createAnswer(e)}).then(function(e){e=y.SDPMuggle.removeDoubleOpus(e);e=y.SDPMuggle.fixVideoRecieve(e,n.videoEnabled.receiveVideo);n.srcLocalSDP=e.sdp;return n.impl.setLocalDescription(e)}).then(function(){var t={tracks:n._getTrackKind()};u.VoxSignaling.get().callRemoteFunction(f.RemoteFunction.acceptReInvite,n._call.id(),e,n.impl.localDescription.sdp,t);n.renegotiationInProgress=false;n._call.dispatchEvent({name:C,result:true,call:n._call});n.updateHoldState();r()}).catch(function(e){o(e);n.renegotiationInProgress=false})}else if(n.renegotiationInProgress===true){var a=new RTCSessionDescription({sdp:t,type:S.answer});n.renegotiationInProgress=false;n.srcRemoteSDP=t;a=y.SDPMuggle.removeTIAS(a);n.impl.setLocalDescription(n.pendingOffer).then(function(){return n.impl.setRemoteDescription(a)}).then(function(){clearTimeout(n.renegotiationTimer);n._call.dispatchEvent({name:C,result:true,call:n._call});n.updateHoldState();r()}).catch(function(e){clearTimeout(n.renegotiationTimer);n._call.dispatchEvent({name:C,result:false,call:n._call});n.renegotiationInProgress=false;n.log.error(JSON.stringify(e))})}else{o(new Error("Universe was broken!"))}})};t.prototype.codecRearrange=function(e){var t=this;return new Promise(function(n,r){var o=g.CallManager.get().calls[t.id];if(typeof o!=="undefined"){var i=new p.CodecSorter(e.sdp);var a=i.getUserCodecList();if(typeof o.rearangeCodecs!=="undefined"){o.rearangeCodecs(a).then(function(t){i.setUserCodecList(t);n({type:e.type,sdp:i.getSDP()})},function(e){t.log.error(JSON.stringify(e));r(e)})}else{t.log.info("No sdp transformer registered");i.setUserCodecList(a);n({type:e.type,sdp:i.getSDP()})}}else{n(e)}})};t.prototype._sendDTMF=function(e,t,n){if(typeof this.dtmfSender!=="undefined"){this.dtmfSender.insertDTMF(e,t,n)}};t.prototype._hold=function(e){v.CallstatsIo.get().sendFabricEvent(this.impl,e?v.CallstatsIoFabricEvent.fabricHold:v.CallstatsIoFabricEvent.fabricResume,this._call.id());this.onHold=e;this.onRenegotiation()};t.prototype._getDirections=function(){var e={};e["local"]=y.SDPMuggle.detectDirections(this.impl.localDescription.sdp);e["remote"]=y.SDPMuggle.detectDirections(this.impl.remoteDescription.sdp);return e};t.prototype._getStreamActivity=function(){var e={};e["local"]=this.getMediaActivity(this.impl.getLocalStreams());e["remote"]=this.getMediaActivity(this.impl.getRemoteStreams());return e};t.prototype.getMediaActivity=function(e){return e.map(function(e){return e.getTracks().map(function(e){return{id:e.id,kind:e.kind,mutted:e.muted,active:e.enabled,label:e.label}})})};t.prototype._hdnFRSPrep=function(){this.banReinviteAnswer=true};t.prototype._hdnFRS=function(){this.renegotiationInProgress=false;this.onRenegotiation()};t.prototype._getTrackKind=function(){var e=this;var t={};this.impl.getLocalStreams().forEach(function(n){n.getTracks().forEach(function(n){if(n.kind!=="video")t[n.id]=n.kind;else if(e.shareScreenMedia&&e.shareScreenMedia.some(function(e){return e.getTracks().some(function(e){return e.id===n.id})}))t[n.id]="sharing";else t[n.id]="video"})});return t};t.prototype._stopSharing=function(){var e=this;if(typeof this.impl.removeTrack!=="undefined"){this.impl.getSenders().forEach(function(t){if(e.shareScreenMediaTracks.indexOf(t.track.id)!==-1)e.impl.removeTrack(t)})}else{this.shareScreenMedia.forEach(function(t){e.impl.removeStream(t)})}this.shareScreenMedia.forEach(function(e){e.getTracks().forEach(function(t){t.stop();e.removeTrack(t)})});this.shareScreenMediaTracks=[];this.shareScreenMedia=[]};o([l.LogManager.d_trace(l.LogCategory.RTC)],t.prototype,"onSignalingStateChange",null);o([l.LogManager.d_trace(l.LogCategory.RTC)],t.prototype,"getPCStats",null);o([l.LogManager.d_trace(l.LogCategory.RTC)],t.prototype,"onConnectionChange",null);o([l.LogManager.d_trace(l.LogCategory.RTC)],t.prototype,"onRenegotiation",null);o([l.LogManager.d_trace(l.LogCategory.RTC)],t.prototype,"onICECandidate",null);o([l.LogManager.d_trace(l.LogCategory.RTC)],t.prototype,"onAddTrack",null);o([l.LogManager.d_trace(l.LogCategory.RTC)],t.prototype,"onAddStream",null);o([l.LogManager.d_trace(l.LogCategory.RTC)],t.prototype,"wireRemoteStream",null);o([l.LogManager.d_trace(l.LogCategory.RTC)],t.prototype,"_processRemoteAnswer",null);o([l.LogManager.d_trace(l.LogCategory.RTC)],t.prototype,"_getLocalOffer",null);o([l.LogManager.d_trace(l.LogCategory.RTC)],t.prototype,"_getLocalAnswer",null);o([l.LogManager.d_trace(l.LogCategory.RTC)],t.prototype,"_setRemoteDescription",null);o([l.LogManager.d_trace(l.LogCategory.RTC)],t.prototype,"_processRemoteOffer",null);o([l.LogManager.d_trace(l.LogCategory.RTC)],t.prototype,"_close",null);o([l.LogManager.d_trace(l.LogCategory.RTC)],t.prototype,"_addRemoteCandidate",null);o([l.LogManager.d_trace(l.LogCategory.RTC)],t.prototype,"_bindLocalMedia",null);o([l.LogManager.d_trace(l.LogCategory.RTC)],t.prototype,"_unbindLocalMegia",null);o([l.LogManager.d_trace(l.LogCategory.RTC)],t.prototype,"_handleReinvite",null);o([l.LogManager.d_trace(l.LogCategory.RTC)],t.prototype,"codecRearrange",null);o([l.LogManager.d_trace(l.LogCategory.RTC)],t.prototype,"_sendDTMF",null);return t}(i.PeerConnection);t.WebRTCPC=_},function(e,t){"use strict";var n=function(){function e(e){this.originalSDP=e}e.splitSections=function(e){var t=e.split("\nm=");return t.map(function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"})};e.prototype.getCodecList=function(){this.originalCodecList={prefix:"",sections:[],sufix:""};var t=RegExp.prototype.test.bind(/^([a-z])=(.*)/);var n=e.splitSections(this.originalSDP);this.originalCodecList.prefix=n[0];for(var r=1;r<n.length;r++){var o={kind:"audio",firstLine:"",prefix:"",sufix:"",codec:[]};var i=n[r].split("\na=rtpmap");i=i.map(function(e,t){return(t>0?"a=rtpmap"+e:e).trim()+"\r\n"});o.prefix=i.shift();var a=i.pop();a=a.split(/(\r\n|\r|\n)/).filter(t);var s=true;i.push("");while(s){s=false;if(a.length!==0){var c=a.shift();if(c.indexOf("a=rtpmap")===0||c.indexOf("a=rtcp-fb")===0||c.indexOf("a=fmtp")===0||c.indexOf("a=x-caps")===0||c.indexOf("a=maxptime")===0){i[i.length-1]+=c+"\r\n";s=true}else a.unshift(c)}}for(var d=0;d<i.length;d++){o.codec.push(i[d].split(/(\r\n|\r|\n)/).filter(t))}var l=o.prefix.split(/(\r\n|\r|\n)/).filter(t);o.firstLine=l.shift();var u=o.firstLine.split(" ");u.splice(-1*o.codec.length,o.codec.length);o.kind=u[0].substring(2);o.prefix=l.join("\r\n")+"\r\n";o.firstLine=u.join(" ");if(a.length>0)o.sufix=a.join("\r\n")+"\r\n";this.originalCodecList.sections.push(o)}return this.originalCodecList};e.prototype.getUserCodecList=function(){if(typeof this.originalCodecList==="undefined")this.getCodecList();var t={sections:[]};t.sections=this.originalCodecList.sections.filter(function(e){return e.kind==="video"||e.kind==="audio"}).map(function(t,n,r){var o={kind:t.kind,codec:t.codec.map(function(t){return e.codecToUserCodec(t)})};var i=[];for(var a=0,s=o.codec;a<s.length;a++){var c=s[a];if(i.indexOf(c)===-1)i.push(c)}o.codec=i;return o});return t};e.codecToUserCodec=function(e){var t=e[0].split(" ");t.shift();return t.join(" ")};e.prototype.setUserCodecList=function(t){if(typeof this.originalCodecList==="undefined")this.getCodecList();for(var n=0;n<t.sections.length;n++){for(var r=0;r<this.originalCodecList.sections.length;r++){if(t.sections[n].kind===this.originalCodecList.sections[r].kind){this.originalCodecList.sections[r].codec=e.resortSection(t.sections[n].codec,this.originalCodecList.sections[r].codec)}}}};e.resortSection=function(t,n){var r=[];for(var o=0;o<t.length;o++){for(var i=0;i<n.length;i++){if(t[o]===e.codecToUserCodec(n[i])){r.push(n[i])}}}return r};e.prototype.getSDP=function(){var e=this.originalCodecList.prefix;for(var t=0;t<this.originalCodecList.sections.length;t++){var n="";var r=[];for(var o=0;o<this.originalCodecList.sections[t].codec.length;o++){r.push(this.originalCodecList.sections[t].codec[o][0].split(" ")[0].substring(9));n+=this.originalCodecList.sections[t].codec[o].join("\r\n")+"\r\n"}e+=this.originalCodecList.sections[t].firstLine+" "+r.join(" ")+"\r\n";e+=this.originalCodecList.sections[t].prefix;e+=n;e+=this.originalCodecList.sections[t].sufix}return e};e.downOpusBandwidth=function(e){return new Promise(function(t,n){var r=RegExp.prototype.test.bind(/^([a-z])=(.*)/);var o=e.sdp.split(/(\r\n|\r|\n)/).filter(r);var i=false;for(var a=0;a<o.length;a++){if(o[a].indexOf("a=fmtp:114")!==-1){o[a]="a=fmtp:114 minptime=10; useinbandfec=1; sprop-maxcapturerate=8000";i=true}if(o[a].indexOf("a=fmtp:111")!==-1){o[a]="a=fmtp:111 minptime=10; useinbandfec=1; sprop-maxcapturerate=8000";i=true}}if(!i){n(e)}e.sdp=o.join("\r\n")+"\r\n";t(e)})};return e}();t.CodecSorter=n},function(e,t){"use strict";var n=function(){function e(){}e.detectDirections=function(t){var n=[];var r=t.split(/(\r\n|\r|\n)/).filter(e.validLine);var o="";r.forEach(function(e){if(e.indexOf("m=")===0){var t=e.substr(2);o=t.split(" ")[0]}if(o!==""&&(e==="a=sendrecv"||e==="a=sendonly"||e==="a=recvonly"||e==="a=inactive")){n.push({type:o,direction:e.substr(2)});o=""}});return n};e.removeTelephoneEvents=function(t){if(t.sdp.indexOf("a=rtpmap:127 telephone-event/8000")!==-1){var n=t.sdp.split(/(\r\n|\r|\n)/).filter(e.validLine);var r=-1;for(var o=0;o<n.length;o++){if(n[o].indexOf("m=audio")!==-1){var i=n[o];if(typeof i==="string")n[o]=i.replace(" 127","")}if(n[o].indexOf("a=rtpmap:127 telephone-event/8000")!==-1)r=o}n.splice(r,1);t.sdp=n.join("\r\n")+"\r\n"}return t};e.removeDoubleOpus=function(t){if(t.sdp.indexOf("a=rtpmap:109 opus")!==-1&&t.sdp.indexOf("a=rtpmap:111 opus")!==-1){var n=t.sdp.split(/(\r\n|\r|\n)/).filter(e.validLine);var r=-1;for(var o=0;o<n.length;o++){if(n[o].indexOf("m=audio")!==-1){var i=n[o];if(typeof i==="string")n[o]=i.replace(" 109","")}if(n[o].indexOf("a=rtpmap:109 opus")!==-1)r=o}n.splice(r,1);t.sdp=n.join("\r\n")+"\r\n"}return t};e.removeTIAS=function(t){if(t.sdp.indexOf("b=TIAS")!==-1){var n=t.sdp.split(/(\r\n|\r|\n)/).filter(e.validLine);var r=[];n.forEach(function(e,t){if(e.indexOf("b=TIAS")!==-1)r.unshift(t)});r.forEach(function(e){return n.splice(e,1)});t.sdp=n.join("\r\n")+"\r\n"}return t};e.fixVideoRecieve=function(t,n){var r=t.sdp.indexOf("m=video");if(r!==-1&&!n){var o=t.sdp.split(/(\r\n|\r|\n)/).filter(e.validLine);var i=null;o=o.map(function(e,t){if(i===null){if(e.indexOf("m=video")!==-1)i=t}else{if(e==="a=sendrecv")e="a=sendonly";else if(e==="a=recvonly")e="a=inactive"}return e});t.sdp=o.join("\r\n")+"\r\n"}return t};e.validLine=RegExp.prototype.test.bind(/^([a-z])=(.*)/);return e}();t.SDPMuggle=n},function(e,t){"use strict";var n=function(){function e(){}e.attachStream=function(e,t){t.srcObject=e;t.play()};e.detachStream=function(e){e.pause();e.src=""};e.getScreenMedia=function(){return new Promise(function(e,t){t(new Error("Screen sharing not allowed for you platform"))})};e.getRTCStats=function(e){return new Promise(function(e,t){t(new Error("RTCStats sharing not allowed for you platform"))})};return e}();t.Edge=n},function(e,t,n){"use strict";var r=n(27);var o=n(1);var i=function(){function e(){}e.attachStream=function(e,t){t.srcObject=e;t.load();if(t instanceof HTMLVideoElement)t.play().catch(function(e){});else{t.play();var n=o.Client.getInstance()._defaultSinkId;if(n!=null)t.setSinkId(n)}};e.detachStream=function(e){if(e instanceof HTMLVideoElement){var t=e.pause();if(typeof t!="undefined")t.catch(function(e){})}else e.pause();e.src=""};e.getDTMFSender=function(e,t){if(!!e.createDTMFSender)return e.createDTMFSender(e.getLocalStreams()[0].getAudioTracks()[0]);else return new r.SignalingDTMFSender(t)};e.getScreenMedia=function(){return new Promise(function(e,t){window.postMessage("get-sourceId","*");window.addEventListener("message",function(n){if(n.origin==window.location.origin){if(n.data=="PermissionDeniedError"){t(new Error("PermissionDeniedError"))}if(typeof n.data!="string"&&typeof n.data.sourceId!="undefined"){
var r={audio:false,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:screen.width>1920?screen.width:1920,maxHeight:screen.height>1080?screen.height:1080,chromeMediaSourceId:n.data.sourceId},optional:[{googTemporalLayeredScreencast:true}]}};navigator.mediaDevices.getUserMedia(r).then(function(t){e(t)}).catch(function(e){t(e)})}}})})};e.getRTCStats=function(e){return new Promise(function(t,n){var r=[];e.getStats().then(function(e){e.forEach(function(e){if(e.type=="ssrc"){var t={};t.id=e.id;t.type=e.type;t.timestamp=e.timestamp;r.push(t)}});t(r)}).catch(n)})};return e}();t.Safari=i},function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var o=arguments.length,i=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,a;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")i=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)if(a=e[s])i=(o<3?a(i):o>3?a(t,n,i):a(t,n))||i;return o>3&&i&&Object.defineProperty(t,n,i),i};var o=n(4);var i=n(35);var a=n(6);var s=function(){function e(){var t=this;if(e.instance){throw new Error("Error - use Client.getMessagingInstance()")}this.eventListeners=[];this.query=[];setInterval(function(){t.updateQuery()},220)}e.prototype.handleWsData=function(e){var t=["onCreateConversation","onEditConversation","onRemoveConversation","onJoinConversation","onLeaveConversation","onGetConversation","onSendMessage","onEditMessage","onRemoveMessage","onTyping","onRetransmitEvents","onEditUser","onGetUser","isRead","isDelivered","onError","onSubscribe","onUnSubscribe","onSetStatus"];if(t.indexOf(e.event)!=-1)this.dispatchEvent(e.event,e);else throw new Error("Unknown messaging event "+e.event+" with payload "+JSON.stringify(e.payload))};e.get=function(){e.instance=e.instance||new e;return e.instance};e.prototype.sendPayload=function(e,t){var n={service:i.MsgService.Chat,event:e,payload:t};this.query.push(n);return true};e.prototype.updateQuery=function(){if(this.query.length){var e=this.query.splice(0,1);a.VoxSignaling.get().sendRaw(e[0])}};e.prototype.addEventListener=function(e,t){if(typeof this.eventListeners[e]=="undefined")this.eventListeners[e]=[];this.eventListeners[e].push(t)};e.prototype.removeEventListener=function(e,t){if(typeof this.eventListeners[e]=="undefined")return;if(typeof t==="function")for(var n=0;n<this.eventListeners[e].length;n++)if(this.eventListeners[e][n]==t){this.eventListeners[e].splice(n,1);break}else this.eventListeners[e]=[]};e.prototype.dispatchEvent=function(e,t){if(typeof this.eventListeners[e]!="undefined")for(var n=0;n<this.eventListeners[e].length;n++)if(typeof this.eventListeners[e][n]=="function")this.eventListeners[e][n](t.payload)};e.prototype.on=function(e,t){this.addEventListener(e,t)};e.prototype.off=function(e,t){this.removeEventListener(e,t)};r([o.LogManager.d_trace(o.LogCategory.MESSAGING)],e.prototype,"handleWsData",null);r([o.LogManager.d_trace(o.LogCategory.MESSAGING)],e.prototype,"sendPayload",null);return e}();t.MsgSignaling=s},function(e,t){"use strict";(function(e){e[e["Chat"]="chat"]="Chat"})(t.MsgService||(t.MsgService={}));var n=t.MsgService;(function(e){e[e["createConversation"]="createConversation"]="createConversation";e[e["editConversation"]="editConversation"]="editConversation";e[e["removeConversation"]="removeConversation"]="removeConversation";e[e["joinConversation"]="joinConversation"]="joinConversation";e[e["leaveConversation"]="leaveConversation"]="leaveConversation";e[e["getConversation"]="getConversation"]="getConversation";e[e["getConversations"]="getConversations"]="getConversations";e[e["sendMessage"]="sendMessage"]="sendMessage";e[e["editMessage"]="editMessage"]="editMessage";e[e["removeMessage"]="removeMessage"]="removeMessage";e[e["typingMessage"]="typingMessage"]="typingMessage";e[e["editUser"]="editUser"]="editUser";e[e["getUser"]="getUser"]="getUser";e[e["getUsers"]="getUsers"]="getUsers";e[e["retransmitEvents"]="retransmitEvents"]="retransmitEvents";e[e["isRead"]="isRead"]="isRead";e[e["isDelivered"]="isDelivered"]="isDelivered";e[e["addParticipants"]="addParticipants"]="addParticipants";e[e["editParticipants"]="editParticipants"]="editParticipants";e[e["removeParticipants"]="removeParticipants"]="removeParticipants";e[e["addModerators"]="addModerators"]="addModerators";e[e["removeModerators"]="removeModerators"]="removeModerators";e[e["subscribe"]="subscribe"]="subscribe";e[e["unSubscribe"]="unSubscribe"]="unSubscribe";e[e["setStatus"]="setStatus"]="setStatus"})(t.MsgAction||(t.MsgAction={}));var r=t.MsgAction;(function(e){e[e["onCreateConversation"]="onCreateConversation"]="onCreateConversation";e[e["onEditConversation"]="onEditConversation"]="onEditConversation";e[e["onRemoveConversation"]="onRemoveConversation"]="onRemoveConversation";e[e["onJoinConversation"]="onJoinConversation"]="onJoinConversation";e[e["onLeaveConversation"]="onLeaveConversation"]="onLeaveConversation";e[e["onGetConversation"]="onGetConversation"]="onGetConversation";e[e["onSendMessage"]="onSendMessage"]="onSendMessage";e[e["onEditMessage"]="onEditMessage"]="onEditMessage";e[e["onRemoveMessage"]="onRemoveMessage"]="onRemoveMessage";e[e["onTyping"]="onTyping"]="onTyping";e[e["onRetransmitEvents"]="onRetransmitEvents"]="onRetransmitEvents";e[e["onEditUser"]="onEditUser"]="onEditUser";e[e["onGetUser"]="onGetUser"]="onGetUser";e[e["onError"]="onError"]="onError";e[e["isRead"]="isRead"]="isRead";e[e["isDelivered"]="isDelivered"]="isDelivered";e[e["onSubscribe"]="onSubscribe"]="onSubscribe";e[e["onUnSubscribe"]="onUnSubscribe"]="onUnSubscribe";e[e["onSetStatus"]="onSetStatus"]="onSetStatus"})(t.MsgEvent||(t.MsgEvent={}));var o=t.MsgEvent},function(e,t){"use strict";var n=function(){function e(){this.eventListeners={}}e.prototype.addEventListener=function(e,t){if(typeof this.eventListeners[e]=="undefined")this.eventListeners[e]=[];this.eventListeners[e].push(t)};e.prototype.dispatchEvent=function(e){var t=e.name;if(typeof this.eventListeners[t]!="undefined"){for(var n=0;n<this.eventListeners[t].length;n++){if(typeof this.eventListeners[t][n]=="function"){this.eventListeners[t][n](e)}}}};e.prototype.removeEventListener=function(e,t){if(typeof this.eventListeners[e]=="undefined")return;if(typeof t==="function"){for(var n=0;n<this.eventListeners[e].length;n++){if(this.eventListeners[e][n]==t){this.eventListeners[e].splice(n,1);break}}}else{this.eventListeners[e]=[]}};e.prototype.on=function(e,t){this.addEventListener(e,t)};e.prototype.off=function(e,t){this.removeEventListener(e,t)};return e}();t.Callbackable=n},function(e,t,n){"use strict";var r=n(2);var o=r.Events.ConnectionFailed;var i=n(16);var a=n(6);var s=n(20);var c=r.Events.ConnectionEstablished;var d=n(11);var l=n(24);var u=n(5);var g=n(18);var f=function(){function e(e){var t=this;this.client=e;this.currentCall=null;this.onConnectionFailed=null;this.onConnectionEstablished=null;this.onCheckComplete=null;this.onCallFailed=null;this.onCallConnected=null;this.onCallEnded=null;this.onCallRinging=null;this.onCallMediaStarted=null;this.onVoicemail=null;this.onNetStatsReceived=null;i.CallManager.get().protocolVersion=="2";e.on(o,function(e){return t.runLegacyCallback(t.onConnectionFailed,e)});e.on(c,function(e){return t.runLegacyCallback(t.onConnectionEstablished,e)});a.VoxSignaling.get().setRPCHandler(l.RemoteEvent.handlePreFlightCheckResult,function(e,n,r){return t.onCheckComplete(e,n,r)});a.VoxSignaling.get().setRPCHandler(l.RemoteEvent.handleVoicemail,function(e){return t.runLegacyCallback(t.onVoicemail,e)})}e.prototype.connectTo=function(e,t,n,r){var o=a.VoxSignaling.get();u.Authenticator.get().ziAuthorized(true);o.lagacyConnectTo(e,t,n,r)};e.prototype.connect=function(){};e.prototype.requestMedia=function(e,t,n,r){var o=d.UserMediaManager.get();o.enableAudio(true);o.queryMedia().then(function(e){d.UserMediaManager.get().updateLocalVideo(e);if(typeof t=="function")t(e)}).catch(function(e){if(typeof n=="function")n(e)})};e.prototype.hangupCall=function(e,t){i.CallManager.get().calls[e].hangup(t);a.VoxSignaling.get().callRemoteFunction(s.RemoteFunction.disconnectCall,e,{})};e.prototype.callTo=function(e,t,n,r){this.currentCall=this.client.call({number:e,video:t,extraHeaders:n,extraParams:r});this.bindCurrentCall();return this.currentCall.id()};e.prototype.voicemailPromptFinished=function(e){a.VoxSignaling.get().callRemoteFunction(s.RemoteFunction.zPromptFinished,e)};e.prototype.makeid=function(e){var t="";var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(var r=0;r<e;r++)t+=n.charAt(Math.floor(Math.random()*n.length));return t};e.prototype.muteMicrophone=function(e){var t=i.CallManager.get();for(var n in t.calls){if(e)t.calls[n].muteMicrophone();else t.calls[n].unmuteMicrophone()}};e.prototype.sendDigit=function(e,t){a.VoxSignaling.get().callRemoteFunction(s.RemoteFunction.sendDTMF,e,t)};e.prototype.startPreFlightCheck=function(e,t){a.VoxSignaling.get().callRemoteFunction(s.RemoteFunction.zStartPreFlightCheck,!!e,!!t)};e.prototype.runLegacyCallback=function(e,t){if(typeof e!=="undefined"&&e!==null){e(t)}};e.prototype.bindCurrentCall=function(){var e=this;window["currentCall"]=this.currentCall;this.currentCall.on(g.CallEvents.Failed,function(t){e.runLegacyCallback(e.onCallFailed,t);e.unbindCurrentCall()});this.currentCall.on(g.CallEvents.Connected,function(t){e.runLegacyCallback(e.onCallConnected,t);e.runLegacyCallback(e.onCallMediaStarted,t);var n=i.CallManager.get();setTimeout(function(){var e=document.getElementById(window["currentCall"].peerConnection.impl.getRemoteStreams()[0].getTracks()[0].id);e.srcObject=window["currentCall"].peerConnection.impl.getRemoteStreams()[0];e.load();e.play()},1e3)});this.currentCall.on(g.CallEvents.Disconnected,function(t){e.runLegacyCallback(e.onCallEnded,t);e.unbindCurrentCall()});this.client.on(r.Events.NetStatsReceived,function(t){return e.onNetStatsReceived(t)})};e.prototype.unbindCurrentCall=function(){this.currentCall.off(g.CallEvents.Failed);this.currentCall.off(g.CallEvents.Connected);this.currentCall.off(g.CallEvents.Disconnected);this.currentCall.off(g.CallEvents.ProgressToneStart);this.currentCall.off(g.CallEvents.Connected);this.client.off(r.Events.NetStatsReceived)};return e}();t.ZingayaAPI=f},function(e,t,n){"use strict";var r=n(6);var o=n(20);var i=function(){function e(){}e.register=function(e){return new Promise(function(t,n){var i=r.VoxSignaling.get().callRemoteFunction(o.RemoteFunction.registerPushToken,e);if(i)t();else n()})};e.unregister=function(e){return new Promise(function(t,n){var i=r.VoxSignaling.get().callRemoteFunction(o.RemoteFunction.unregisterPushToken,e);if(i)t();else n()})};e.incomingPush=function(e){return new Promise(function(t,n){var i=r.VoxSignaling.get().callRemoteFunction(o.RemoteFunction.pushFeedback,e);if(i)t();else n()})};return e}();t.PushService=i},function(e,t){"use strict";var n=function(){function e(t){this.str=t||e.getNewGUIDString()}e.prototype.toString=function(){return this.str};e.getNewGUIDString=function(){var e=(new Date).getTime();if(window.performance&&typeof window.performance.now==="function"){e+=performance.now()}return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=(e+Math.random()*16)%16|0;e=Math.floor(e/16);return(t=="x"?n:n&3|8).toString(16)})};return e}();t.GUID=n},function(e,t,n){(function(t){"use strict";var r=n(41);e.exports=r({window:t.window})}).call(t,function(){return this}())},function(e,t,n){"use strict";e.exports=function(e){var t=e&&e.window;var r=n(42);var o=r.log;var i=r.detectBrowser(t);var a={browserDetails:i,extractVersion:r.extractVersion,disableLog:r.disableLog};var s=n(43)||null;var c=n(45)||null;var d=n(49)||null;var l=n(51)||null;switch(i.browser){case"chrome":if(!s||!s.shimPeerConnection){o("Chrome shim is not included in this adapter release.");return a}o("adapter.js shimming chrome.");a.browserShim=s;s.shimGetUserMedia(t);s.shimMediaStream(t);r.shimCreateObjectURL(t);s.shimSourceObject(t);s.shimPeerConnection(t);s.shimOnTrack(t);s.shimGetSendersWithDtmf(t);break;case"firefox":if(!d||!d.shimPeerConnection){o("Firefox shim is not included in this adapter release.");return a}o("adapter.js shimming firefox.");a.browserShim=d;d.shimGetUserMedia(t);r.shimCreateObjectURL(t);d.shimSourceObject(t);d.shimPeerConnection(t);d.shimOnTrack(t);break;case"edge":if(!c||!c.shimPeerConnection){o("MS edge shim is not included in this adapter release.");return a}o("adapter.js shimming edge.");a.browserShim=c;c.shimGetUserMedia(t);r.shimCreateObjectURL(t);c.shimPeerConnection(t);c.shimReplaceTrack(t);break;case"safari":if(!l){o("Safari shim is not included in this adapter release.");return a}o("adapter.js shimming safari.");a.browserShim=l;l.shimCallbacksAPI(t);l.shimAddStream(t);l.shimOnAddStream(t);l.shimGetUserMedia(t);break;default:o("Unsupported browser!");break}return a}},function(e,t){"use strict";var n=true;var r={disableLog:function(e){if(typeof e!=="boolean"){return new Error("Argument type: "+typeof e+". Please use a boolean.")}n=e;return e?"adapter.js logging disabled":"adapter.js logging enabled"},log:function(){if(typeof window==="object"){if(n){return}if(typeof console!=="undefined"&&typeof console.log==="function"){console.log.apply(console,arguments)}}},extractVersion:function(e,t,n){var r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)},detectBrowser:function(e){var t=e&&e.navigator;var n={};n.browser=null;n.version=null;if(typeof e==="undefined"||!e.navigator){n.browser="Not a browser.";return n}if(t.mozGetUserMedia){n.browser="firefox";n.version=this.extractVersion(t.userAgent,/Firefox\/(\d+)\./,1)}else if(t.webkitGetUserMedia){if(e.webkitRTCPeerConnection){n.browser="chrome";n.version=this.extractVersion(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2)}else{if(t.userAgent.match(/Version\/(\d+).(\d+)/)){n.browser="safari";n.version=this.extractVersion(t.userAgent,/AppleWebKit\/(\d+)\./,1)}else{n.browser="Unsupported webkit-based browser "+"with GUM support but no WebRTC support.";return n}}}else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/)){n.browser="edge";n.version=this.extractVersion(t.userAgent,/Edge\/(\d+).(\d+)$/,2)}else if(t.mediaDevices&&t.userAgent.match(/AppleWebKit\/(\d+)\./)){n.browser="safari";n.version=this.extractVersion(t.userAgent,/AppleWebKit\/(\d+)\./,1)}else{n.browser="Not a supported browser.";return n}return n},shimCreateObjectURL:function(e){var t=e&&e.URL;if(!(typeof e==="object"&&e.HTMLMediaElement&&"srcObject"in e.HTMLMediaElement.prototype)){return undefined}var n=t.createObjectURL.bind(t);var r=t.revokeObjectURL.bind(t);var o=new Map,i=0;t.createObjectURL=function(e){if("getTracks"in e){var t="polyblob:"+ ++i;o.set(t,e);console.log("URL.createObjectURL(stream) is deprecated! "+"Use elem.srcObject = stream instead!");return t}return n(e)};t.revokeObjectURL=function(e){r(e);o.delete(e)};var a=Object.getOwnPropertyDescriptor(e.HTMLMediaElement.prototype,"src");Object.defineProperty(e.HTMLMediaElement.prototype,"src",{get:function(){return a.get.apply(this)},set:function(e){this.srcObject=o.get(e)||null;return a.set.apply(this,[e])}});var s=e.HTMLMediaElement.prototype.setAttribute;e.HTMLMediaElement.prototype.setAttribute=function(){if(arguments.length===2&&(""+arguments[0]).toLowerCase()==="src"){this.srcObject=o.get(arguments[1])||null}return s.apply(this,arguments)}}};e.exports={log:r.log,disableLog:r.disableLog,extractVersion:r.extractVersion,shimCreateObjectURL:r.shimCreateObjectURL,detectBrowser:r.detectBrowser.bind(r)}},function(e,t,n){"use strict";var r=n(42);var o=r.log;var i={shimMediaStream:function(e){e.MediaStream=e.MediaStream||e.webkitMediaStream},shimOnTrack:function(e){if(typeof e==="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(t){var n=this;if(this._ontrack){this.removeEventListener("track",this._ontrack);this.removeEventListener("addstream",this._ontrackpoly)}this.addEventListener("track",this._ontrack=t);this.addEventListener("addstream",this._ontrackpoly=function(t){t.stream.addEventListener("addtrack",function(r){var o;if(e.RTCPeerConnection.prototype.getReceivers){o=n.getReceivers().find(function(e){return e.track.id===r.track.id})}else{o={track:r.track}}var i=new Event("track");i.track=r.track;i.receiver=o;i.streams=[t.stream];n.dispatchEvent(i)});t.stream.getTracks().forEach(function(r){var o;if(e.RTCPeerConnection.prototype.getReceivers){o=n.getReceivers().find(function(e){return e.track.id===r.id})}else{o={track:r}}var i=new Event("track");i.track=r;i.receiver=o;i.streams=[t.stream];this.dispatchEvent(i)}.bind(this))}.bind(this))}})}},shimGetSendersWithDtmf:function(e){if(typeof e==="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders||[]};var t=e.RTCPeerConnection.prototype.addStream;var n=e.RTCPeerConnection.prototype.removeStream;if(!e.RTCPeerConnection.prototype.addTrack){e.RTCPeerConnection.prototype.addTrack=function(t,n){var r=this;if(r.signalingState==="closed"){throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError")}var o=[].slice.call(arguments,1);if(o.length!==1||!o[0].getTracks().find(function(e){return e===t})){throw new DOMException("The adapter.js addTrack polyfill only supports a single "+" stream which is associated with the specified track.","NotSupportedError")}r._senders=r._senders||[];var i=r._senders.find(function(e){return e.track===t});if(i){throw new DOMException("Track already exists.","InvalidAccessError")}r._streams=r._streams||{};var a=r._streams[n.id];if(a){a.addTrack(t);r.removeStream(a);r.addStream(a)}else{var s=new e.MediaStream([t]);r._streams[n.id]=s;r.addStream(s)}var c={track:t,get dtmf(){if(this._dtmf===undefined){if(t.kind==="audio"){this._dtmf=r.createDTMFSender(t)}else{this._dtmf=null}}return this._dtmf}};r._senders.push(c);return c}}e.RTCPeerConnection.prototype.addStream=function(e){var n=this;n._senders=n._senders||[];t.apply(n,[e]);e.getTracks().forEach(function(e){n._senders.push({track:e,get dtmf(){if(this._dtmf===undefined){if(e.kind==="audio"){this._dtmf=n.createDTMFSender(e)}else{this._dtmf=null}}return this._dtmf}})})};e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;t._senders=t._senders||[];n.apply(t,[e]);e.getTracks().forEach(function(e){var n=t._senders.find(function(t){return t.track===e});if(n){t._senders.splice(t._senders.indexOf(n),1)}})}}},shimSourceObject:function(e){var t=e&&e.URL;if(typeof e==="object"){if(e.HTMLMediaElement&&!("srcObject"in e.HTMLMediaElement.prototype)){Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(e){var n=this;this._srcObject=e;if(this.src){t.revokeObjectURL(this.src)}if(!e){this.src="";return undefined}this.src=t.createObjectURL(e);e.addEventListener("addtrack",function(){if(n.src){t.revokeObjectURL(n.src)}n.src=t.createObjectURL(e)});e.addEventListener("removetrack",function(){if(n.src){t.revokeObjectURL(n.src)}n.src=t.createObjectURL(e)})}})}}},shimPeerConnection:function(e){var t=r.detectBrowser(e);if(!e.RTCPeerConnection){e.RTCPeerConnection=function(t,n){o("PeerConnection");if(t&&t.iceTransportPolicy){t.iceTransports=t.iceTransportPolicy}return new e.webkitRTCPeerConnection(t,n)};e.RTCPeerConnection.prototype=e.webkitRTCPeerConnection.prototype;if(e.webkitRTCPeerConnection.generateCertificate){Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.webkitRTCPeerConnection.generateCertificate}})}}else{var n=e.RTCPeerConnection;e.RTCPeerConnection=function(e,t){if(e&&e.iceServers){var r=[];for(var o=0;o<e.iceServers.length;o++){var i=e.iceServers[o];if(!i.hasOwnProperty("urls")&&i.hasOwnProperty("url")){console.warn("RTCIceServer.url is deprecated! Use urls instead.");i=JSON.parse(JSON.stringify(i));i.urls=i.url;r.push(i)}else{r.push(e.iceServers[o])}}e.iceServers=r}return new n(e,t)};e.RTCPeerConnection.prototype=n.prototype;Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return n.generateCertificate}})}var i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,t,n){var r=this;var o=arguments;if(arguments.length>0&&typeof e==="function"){return i.apply(this,arguments)}if(i.length===0&&(arguments.length===0||typeof arguments[0]!=="function")){return i.apply(this,[])}var a=function(e){var t={};var n=e.result();n.forEach(function(e){var n={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(function(t){n[t]=e.stat(t)});t[n.id]=n});return t};var s=function(e){return new Map(Object.keys(e).map(function(t){return[t,e[t]]}))};if(arguments.length>=2){var c=function(e){o[1](s(a(e)))};return i.apply(this,[c,arguments[0]])}return new Promise(function(e,t){i.apply(r,[function(t){e(s(a(t)))},t])}).then(t,n)};if(t.version<51){["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=arguments;var t=this;var r=new Promise(function(r,o){n.apply(t,[e[0],r,o])});if(e.length<2){return r}return r.then(function(){e[1].apply(null,[])},function(t){if(e.length>=3){e[2].apply(null,[t])}})}})}if(t.version<52){["createOffer","createAnswer"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=this;if(arguments.length<1||arguments.length===1&&typeof arguments[0]==="object"){var t=arguments.length===1?arguments[0]:undefined;return new Promise(function(r,o){n.apply(e,[r,o,t])})}return n.apply(this,arguments)}})}["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){arguments[0]=new(t==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]);return n.apply(this,arguments)}});var a=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){if(!arguments[0]){if(arguments[1]){arguments[1].apply(null)}return Promise.resolve()}return a.apply(this,arguments)}}};e.exports={shimMediaStream:i.shimMediaStream,shimOnTrack:i.shimOnTrack,shimGetSendersWithDtmf:i.shimGetSendersWithDtmf,shimSourceObject:i.shimSourceObject,shimPeerConnection:i.shimPeerConnection,shimGetUserMedia:n(44)}},function(e,t,n){"use strict";var r=n(42);var o=r.log;e.exports=function(e){var t=r.detectBrowser(e);var n=e&&e.navigator;var i=function(e){if(typeof e!=="object"||e.mandatory||e.optional){return e}var t={};Object.keys(e).forEach(function(n){if(n==="require"||n==="advanced"||n==="mediaSource"){return}var r=typeof e[n]==="object"?e[n]:{ideal:e[n]};if(r.exact!==undefined&&typeof r.exact==="number"){r.min=r.max=r.exact}var o=function(e,t){if(e){return e+t.charAt(0).toUpperCase()+t.slice(1)}return t==="deviceId"?"sourceId":t};if(r.ideal!==undefined){t.optional=t.optional||[];var i={};if(typeof r.ideal==="number"){i[o("min",n)]=r.ideal;t.optional.push(i);i={};i[o("max",n)]=r.ideal;t.optional.push(i)}else{i[o("",n)]=r.ideal;t.optional.push(i)}}if(r.exact!==undefined&&typeof r.exact!=="number"){t.mandatory=t.mandatory||{};t.mandatory[o("",n)]=r.exact}else{["min","max"].forEach(function(e){if(r[e]!==undefined){t.mandatory=t.mandatory||{};t.mandatory[o(e,n)]=r[e]}})}});if(e.advanced){t.optional=(t.optional||[]).concat(e.advanced)}return t};var a=function(e,r){e=JSON.parse(JSON.stringify(e));if(e&&typeof e.audio==="object"){var a=function(e,t,n){if(t in e&&!(n in e)){e[n]=e[t];delete e[t]}};e=JSON.parse(JSON.stringify(e));a(e.audio,"autoGainControl","googAutoGainControl");a(e.audio,"noiseSuppression","googNoiseSuppression");e.audio=i(e.audio)}if(e&&typeof e.video==="object"){var s=e.video.facingMode;s=s&&(typeof s==="object"?s:{ideal:s});var c=t.version<61;if(s&&(s.exact==="user"||s.exact==="environment"||s.ideal==="user"||s.ideal==="environment")&&!(n.mediaDevices.getSupportedConstraints&&n.mediaDevices.getSupportedConstraints().facingMode&&!c)){delete e.video.facingMode;var d;if(s.exact==="environment"||s.ideal==="environment"){d=["back","rear"]}else if(s.exact==="user"||s.ideal==="user"){d=["front"]}if(d){return n.mediaDevices.enumerateDevices().then(function(t){t=t.filter(function(e){return e.kind==="videoinput"});var n=t.find(function(e){return d.some(function(t){return e.label.toLowerCase().indexOf(t)!==-1})});if(!n&&t.length&&d.indexOf("back")!==-1){n=t[t.length-1]}if(n){e.video.deviceId=s.exact?{exact:n.deviceId}:{ideal:n.deviceId}}e.video=i(e.video);o("chrome: "+JSON.stringify(e));return r(e)})}}e.video=i(e.video)}o("chrome: "+JSON.stringify(e));return r(e)};var s=function(e){return{name:{PermissionDeniedError:"NotAllowedError",InvalidStateError:"NotReadableError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotReadableError",MediaDeviceKillSwitchOn:"NotReadableError"}[e.name]||e.name,message:e.message,constraint:e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};var c=function(e,t,r){a(e,function(e){n.webkitGetUserMedia(e,t,function(e){r(s(e))})})};n.getUserMedia=c;var d=function(e){return new Promise(function(t,r){n.getUserMedia(e,t,r)})};if(!n.mediaDevices){n.mediaDevices={getUserMedia:d,enumerateDevices:function(){return new Promise(function(t){var n={audio:"audioinput",video:"videoinput"};return e.MediaStreamTrack.getSources(function(e){t(e.map(function(e){return{label:e.label,kind:n[e.kind],deviceId:e.id,groupId:""}}))})})},getSupportedConstraints:function(){return{deviceId:true,echoCancellation:true,facingMode:true,frameRate:true,height:true,width:true}}}}if(!n.mediaDevices.getUserMedia){n.mediaDevices.getUserMedia=function(e){return d(e)}}else{var l=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(e){return a(e,function(e){return l(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length){t.getTracks().forEach(function(e){e.stop()});throw new DOMException("","NotFoundError")}return t},function(e){return Promise.reject(s(e))})})}}if(typeof n.mediaDevices.addEventListener==="undefined"){n.mediaDevices.addEventListener=function(){o("Dummy mediaDevices.addEventListener called.")}}if(typeof n.mediaDevices.removeEventListener==="undefined"){n.mediaDevices.removeEventListener=function(){o("Dummy mediaDevices.removeEventListener called.")}}}},function(e,t,n){"use strict";var r=n(42);var o=n(46);e.exports={shimGetUserMedia:n(48),shimPeerConnection:function(e){var t=r.detectBrowser(e);if(e.RTCIceGatherer){if(!e.RTCIceCandidate){e.RTCIceCandidate=function(e){return e}}if(!e.RTCSessionDescription){e.RTCSessionDescription=function(e){return e}}if(t.version<15025){var n=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set:function(e){n.set.call(this,e);var t=new Event("enabled");t.enabled=e;this.dispatchEvent(t)}})}}e.RTCPeerConnection=o(e,t.version)},shimReplaceTrack:function(e){if(e.RTCRtpSender&&!("replaceTrack"in e.RTCRtpSender.prototype)){e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack}}}},function(e,t,n){"use strict";var r=n(47);function o(e){var t=e.filter(function(e){return e.kind==="audio"});var n=e.filter(function(e){return e.kind==="video"});e=[];while(t.length||n.length){if(t.length){e.push(t.shift())}if(n.length){e.push(n.shift())}}return e}function i(e,t){var n=false;e=JSON.parse(JSON.stringify(e));return e.filter(function(e){if(e&&(e.urls||e.url)){var r=e.urls||e.url;if(e.url&&!e.urls){console.warn("RTCIceServer.url is deprecated! Use urls instead.")}var o=typeof r==="string";if(o){r=[r]}r=r.filter(function(e){var r=e.indexOf("turn:")===0&&e.indexOf("transport=udp")!==-1&&e.indexOf("turn:[")===-1&&!n;if(r){n=true;return true}return e.indexOf("stun:")===0&&t>=14393});delete e.url;e.urls=o?r[0]:r;return!!r.length}return false})}function a(e,t){var n={codecs:[],headerExtensions:[],fecMechanisms:[]};var r=function(e,t){e=parseInt(e,10);for(var n=0;n<t.length;n++){if(t[n].payloadType===e||t[n].preferredPayloadType===e){return t[n]}}};var o=function(e,t,n,o){var i=r(e.parameters.apt,n);var a=r(t.parameters.apt,o);return i&&a&&i.name.toLowerCase()===a.name.toLowerCase()};e.codecs.forEach(function(r){for(var i=0;i<t.codecs.length;i++){var a=t.codecs[i];if(r.name.toLowerCase()===a.name.toLowerCase()&&r.clockRate===a.clockRate){if(r.name.toLowerCase()==="rtx"&&r.parameters&&a.parameters.apt){if(!o(r,a,e.codecs,t.codecs)){continue}}a=JSON.parse(JSON.stringify(a));a.numChannels=Math.min(r.numChannels,a.numChannels);n.codecs.push(a);a.rtcpFeedback=a.rtcpFeedback.filter(function(e){for(var t=0;t<r.rtcpFeedback.length;t++){if(r.rtcpFeedback[t].type===e.type&&r.rtcpFeedback[t].parameter===e.parameter){return true}}return false});break}}});e.headerExtensions.forEach(function(e){for(var r=0;r<t.headerExtensions.length;r++){var o=t.headerExtensions[r];if(e.uri===o.uri){n.headerExtensions.push(o);break}}});return n}function s(e,t,n){return{offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(n)!==-1}e.exports=function(e,t){var n=function(n){var r=this;var o=document.createDocumentFragment();["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){r[e]=o[e].bind(o)});this.needNegotiation=false;this.onicecandidate=null;this.onaddstream=null;this.ontrack=null;this.onremovestream=null;this.onsignalingstatechange=null;this.oniceconnectionstatechange=null;this.onicegatheringstatechange=null;this.onnegotiationneeded=null;this.ondatachannel=null;this.canTrickleIceCandidates=null;this.localStreams=[];this.remoteStreams=[];this.getLocalStreams=function(){return r.localStreams};this.getRemoteStreams=function(){return r.remoteStreams};this.localDescription=new e.RTCSessionDescription({type:"",sdp:""});this.remoteDescription=new e.RTCSessionDescription({type:"",sdp:""});this.signalingState="stable";this.iceConnectionState="new";this.iceGatheringState="new";this.iceOptions={gatherPolicy:"all",iceServers:[]};if(n&&n.iceTransportPolicy){switch(n.iceTransportPolicy){case"all":case"relay":this.iceOptions.gatherPolicy=n.iceTransportPolicy;break;default:break}}this.usingBundle=n&&n.bundlePolicy==="max-bundle";if(n&&n.iceServers){this.iceOptions.iceServers=i(n.iceServers,t)}this._config=n||{};this.transceivers=[];this._localIceCandidatesBuffer=[]};n.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this.dispatchEvent(e);if(this.onicegatheringstatechange!==null){this.onicegatheringstatechange(e)}};n.prototype._emitBufferedCandidates=function(){var e=this;var t=r.splitSections(e.localDescription.sdp);this._localIceCandidatesBuffer.forEach(function(n){var r=!n.candidate||Object.keys(n.candidate).length===0;if(r){for(var o=1;o<t.length;o++){if(t[o].indexOf("\r\na=end-of-candidates\r\n")===-1){t[o]+="a=end-of-candidates\r\n"}}}else{t[n.candidate.sdpMLineIndex+1]+="a="+n.candidate.candidate+"\r\n"}e.localDescription.sdp=t.join("");e.dispatchEvent(n);if(e.onicecandidate!==null){e.onicecandidate(n)}if(!n.candidate&&e.iceGatheringState!=="complete"){var i=e.transceivers.every(function(e){return e.iceGatherer&&e.iceGatherer.state==="completed"});if(i&&e.iceGatheringStateChange!=="complete"){e.iceGatheringState="complete";e._emitGatheringStateChange()}}});this._localIceCandidatesBuffer=[]};n.prototype.getConfiguration=function(){return this._config};n.prototype._createTransceiver=function(e){
var t=this.transceivers.length>0;var n={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,wantReceive:true};if(this.usingBundle&&t){n.iceTransport=this.transceivers[0].iceTransport;n.dtlsTransport=this.transceivers[0].dtlsTransport}else{var r=this._createIceAndDtlsTransports();n.iceTransport=r.iceTransport;n.dtlsTransport=r.dtlsTransport}this.transceivers.push(n);return n};n.prototype.addTrack=function(t,n){var r;for(var o=0;o<this.transceivers.length;o++){if(!this.transceivers[o].track&&this.transceivers[o].kind===t.kind){r=this.transceivers[o]}}if(!r){r=this._createTransceiver(t.kind)}r.track=t;r.stream=n;r.rtpSender=new e.RTCRtpSender(t,r.dtlsTransport);this._maybeFireNegotiationNeeded();return r.rtpSender};n.prototype.addStream=function(e){var n=this;if(t>=15025){this.localStreams.push(e);e.getTracks().forEach(function(t){n.addTrack(t,e)})}else{var r=e.clone();e.getTracks().forEach(function(e,t){var n=r.getTracks()[t];e.addEventListener("enabled",function(e){n.enabled=e.enabled})});r.getTracks().forEach(function(e){n.addTrack(e,r)});this.localStreams.push(r)}this._maybeFireNegotiationNeeded()};n.prototype.removeStream=function(e){var t=this.localStreams.indexOf(e);if(t>-1){this.localStreams.splice(t,1);this._maybeFireNegotiationNeeded()}};n.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})};n.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})};n.prototype._createIceGatherer=function(t,n){var o=this;var i=new e.RTCIceGatherer(o.iceOptions);i.onlocalcandidate=function(e){var a=new Event("icecandidate");a.candidate={sdpMid:t,sdpMLineIndex:n};var s=e.candidate;var c=!s||Object.keys(s).length===0;if(c){if(i.state===undefined){i.state="completed"}}else{s.component=1;a.candidate.candidate=r.writeCandidate(s)}var d=r.splitSections(o.localDescription.sdp);if(!c){d[a.candidate.sdpMLineIndex+1]+="a="+a.candidate.candidate+"\r\n"}else{d[a.candidate.sdpMLineIndex+1]+="a=end-of-candidates\r\n"}o.localDescription.sdp=d.join("");var l=o._pendingOffer?o._pendingOffer:o.transceivers;var u=l.every(function(e){return e.iceGatherer&&e.iceGatherer.state==="completed"});switch(o.iceGatheringState){case"new":if(!c){o._localIceCandidatesBuffer.push(a)}if(c&&u){o._localIceCandidatesBuffer.push(new Event("icecandidate"))}break;case"gathering":o._emitBufferedCandidates();if(!c){o.dispatchEvent(a);if(o.onicecandidate!==null){o.onicecandidate(a)}}if(u){o.dispatchEvent(new Event("icecandidate"));if(o.onicecandidate!==null){o.onicecandidate(new Event("icecandidate"))}o.iceGatheringState="complete";o._emitGatheringStateChange()}break;case"complete":break;default:break}};return i};n.prototype._createIceAndDtlsTransports=function(){var t=this;var n=new e.RTCIceTransport(null);n.onicestatechange=function(){t._updateConnectionState()};var r=new e.RTCDtlsTransport(n);r.ondtlsstatechange=function(){t._updateConnectionState()};r.onerror=function(){Object.defineProperty(r,"state",{value:"failed",writable:true});t._updateConnectionState()};return{iceTransport:n,dtlsTransport:r}};n.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;if(t){delete t.onlocalcandidate;delete this.transceivers[e].iceGatherer}var n=this.transceivers[e].iceTransport;if(n){delete n.onicestatechange;delete this.transceivers[e].iceTransport}var r=this.transceivers[e].dtlsTransport;if(r){delete r.ondtlssttatechange;delete r.onerror;delete this.transceivers[e].dtlsTransport}};n.prototype._transceive=function(e,n,o){var i=a(e.localCapabilities,e.remoteCapabilities);if(n&&e.rtpSender){i.encodings=e.sendEncodingParameters;i.rtcp={cname:r.localCName,compound:e.rtcpParameters.compound};if(e.recvEncodingParameters.length){i.rtcp.ssrc=e.recvEncodingParameters[0].ssrc}e.rtpSender.send(i)}if(o&&e.rtpReceiver){if(e.kind==="video"&&e.recvEncodingParameters&&t<15019){e.recvEncodingParameters.forEach(function(e){delete e.rtx})}i.encodings=e.recvEncodingParameters;i.rtcp={cname:e.rtcpParameters.cname,compound:e.rtcpParameters.compound};if(e.sendEncodingParameters.length){i.rtcp.ssrc=e.sendEncodingParameters[0].ssrc}e.rtpReceiver.receive(i)}};n.prototype.setLocalDescription=function(t){var n=this;if(!s("setLocalDescription",t.type,this.signalingState)){var o=new Error("Can not set local "+t.type+" in state "+this.signalingState);o.name="InvalidStateError";if(arguments.length>2&&typeof arguments[2]==="function"){e.setTimeout(arguments[2],0,o)}return Promise.reject(o)}var i;var c;if(t.type==="offer"){if(this._pendingOffer){i=r.splitSections(t.sdp);c=i.shift();i.forEach(function(e,t){var o=r.parseRtpParameters(e);n._pendingOffer[t].localCapabilities=o});this.transceivers=this._pendingOffer;delete this._pendingOffer}}else if(t.type==="answer"){i=r.splitSections(n.remoteDescription.sdp);c=i.shift();var d=r.matchPrefix(c,"a=ice-lite").length>0;i.forEach(function(e,t){var o=n.transceivers[t];var i=o.iceGatherer;var s=o.iceTransport;var l=o.dtlsTransport;var u=o.localCapabilities;var g=o.remoteCapabilities;var f=r.isRejected(e);if(!f&&!o.isDatachannel){var p=r.getIceParameters(e,c);var h=r.getDtlsParameters(e,c);if(d){h.role="server"}if(!n.usingBundle||t===0){s.start(i,p,d?"controlling":"controlled");l.start(h)}var v=a(u,g);n._transceive(o,v.codecs.length>0,false)}})}this.localDescription={type:t.type,sdp:t.sdp};switch(t.type){case"offer":this._updateSignalingState("have-local-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+t.type+'"')}var l=arguments.length>1&&typeof arguments[1]==="function";if(l){var u=arguments[1];e.setTimeout(function(){u();if(n.iceGatheringState==="new"){n.iceGatheringState="gathering";n._emitGatheringStateChange()}n._emitBufferedCandidates()},0)}var g=Promise.resolve();g.then(function(){if(!l){if(n.iceGatheringState==="new"){n.iceGatheringState="gathering";n._emitGatheringStateChange()}e.setTimeout(n._emitBufferedCandidates.bind(n),500)}});return g};n.prototype.setRemoteDescription=function(n){var o=this;if(!s("setRemoteDescription",n.type,this.signalingState)){var i=new Error("Can not set remote "+n.type+" in state "+this.signalingState);i.name="InvalidStateError";if(arguments.length>2&&typeof arguments[2]==="function"){e.setTimeout(arguments[2],0,i)}return Promise.reject(i)}var a={};var c=[];var d=r.splitSections(n.sdp);var l=d.shift();var u=r.matchPrefix(l,"a=ice-lite").length>0;var g=r.matchPrefix(l,"a=group:BUNDLE ").length>0;this.usingBundle=g;var f=r.matchPrefix(l,"a=ice-options:")[0];if(f){this.canTrickleIceCandidates=f.substr(14).split(" ").indexOf("trickle")>=0}else{this.canTrickleIceCandidates=false}d.forEach(function(i,s){var d=r.splitLines(i);var f=r.getKind(i);var p=r.isRejected(i);var h=d[0].substr(2).split(" ")[2];var v=r.getDirection(i,l);var m=r.parseMsid(i);var C=r.getMid(i)||r.generateIdentifier();if(f==="application"&&h==="DTLS/SCTP"){o.transceivers[s]={mid:C,isDatachannel:true};return}var y;var L;var S;var E;var _;var M;var T;var R;var P;var I=r.parseRtpParameters(i);var b;var A;if(!p){b=r.getIceParameters(i,l);A=r.getDtlsParameters(i,l);A.role="client"}T=r.parseRtpEncodingParameters(i);var w=r.parseRtcpParameters(i);var O=r.matchPrefix(i,"a=end-of-candidates",l).length>0;var N=r.matchPrefix(i,"a=candidate:").map(function(e){return r.parseCandidate(e)}).filter(function(e){return e.component==="1"||e.component===1});if((n.type==="offer"||n.type==="answer")&&!p&&g&&s>0&&o.transceivers[s]){o._disposeIceAndDtlsTransports(s);o.transceivers[s].iceGatherer=o.transceivers[0].iceGatherer;o.transceivers[s].iceTransport=o.transceivers[0].iceTransport;o.transceivers[s].dtlsTransport=o.transceivers[0].dtlsTransport;if(o.transceivers[s].rtpSender){o.transceivers[s].rtpSender.setTransport(o.transceivers[0].dtlsTransport)}if(o.transceivers[s].rtpReceiver){o.transceivers[s].rtpReceiver.setTransport(o.transceivers[0].dtlsTransport)}}if(n.type==="offer"&&!p){y=o.transceivers[s]||o._createTransceiver(f);y.mid=C;if(!y.iceGatherer){y.iceGatherer=g&&s>0?o.transceivers[0].iceGatherer:o._createIceGatherer(C,s)}if(O&&(!g||s===0)){y.iceTransport.setRemoteCandidates(N)}R=e.RTCRtpReceiver.getCapabilities(f);if(t<15019){R.codecs=R.codecs.filter(function(e){return e.name!=="rtx"})}M=[{ssrc:(2*s+2)*1001}];if(v==="sendrecv"||v==="sendonly"){_=new e.RTCRtpReceiver(y.dtlsTransport,f);P=_.track;if(m){if(!a[m.stream]){a[m.stream]=new e.MediaStream;Object.defineProperty(a[m.stream],"id",{get:function(){return m.stream}})}Object.defineProperty(P,"id",{get:function(){return m.track}});a[m.stream].addTrack(P);c.push([P,_,a[m.stream]])}else{if(!a.default){a.default=new e.MediaStream}a.default.addTrack(P);c.push([P,_,a.default])}}y.localCapabilities=R;y.remoteCapabilities=I;y.rtpReceiver=_;y.rtcpParameters=w;y.sendEncodingParameters=M;y.recvEncodingParameters=T;o._transceive(o.transceivers[s],false,v==="sendrecv"||v==="sendonly")}else if(n.type==="answer"&&!p){y=o.transceivers[s];L=y.iceGatherer;S=y.iceTransport;E=y.dtlsTransport;_=y.rtpReceiver;M=y.sendEncodingParameters;R=y.localCapabilities;o.transceivers[s].recvEncodingParameters=T;o.transceivers[s].remoteCapabilities=I;o.transceivers[s].rtcpParameters=w;if((u||O)&&N.length){S.setRemoteCandidates(N)}if(!g||s===0){S.start(L,b,"controlling");E.start(A)}o._transceive(y,v==="sendrecv"||v==="recvonly",v==="sendrecv"||v==="sendonly");if(_&&(v==="sendrecv"||v==="sendonly")){P=_.track;if(m){if(!a[m.stream]){a[m.stream]=new e.MediaStream}a[m.stream].addTrack(P);c.push([P,_,a[m.stream]])}else{if(!a.default){a.default=new e.MediaStream}a.default.addTrack(P);c.push([P,_,a.default])}}else{delete y.rtpReceiver}}});this.remoteDescription={type:n.type,sdp:n.sdp};switch(n.type){case"offer":this._updateSignalingState("have-remote-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+n.type+'"')}Object.keys(a).forEach(function(t){var n=a[t];if(n.getTracks().length){o.remoteStreams.push(n);var r=new Event("addstream");r.stream=n;o.dispatchEvent(r);if(o.onaddstream!==null){e.setTimeout(function(){o.onaddstream(r)},0)}c.forEach(function(t){var r=t[0];var i=t[1];if(n.id!==t[2].id){return}var a=new Event("track");a.track=r;a.receiver=i;a.streams=[n];o.dispatchEvent(a);if(o.ontrack!==null){e.setTimeout(function(){o.ontrack(a)},0)}})}});e.setTimeout(function(){if(!(o&&o.transceivers)){return}o.transceivers.forEach(function(e){if(e.iceTransport&&e.iceTransport.state==="new"&&e.iceTransport.getRemoteCandidates().length>0){console.warn("Timeout for addRemoteCandidate. Consider sending "+"an end-of-candidates notification");e.iceTransport.addRemoteCandidate({})}})},4e3);if(arguments.length>1&&typeof arguments[1]==="function"){e.setTimeout(arguments[1],0)}return Promise.resolve()};n.prototype.close=function(){this.transceivers.forEach(function(e){if(e.iceTransport){e.iceTransport.stop()}if(e.dtlsTransport){e.dtlsTransport.stop()}if(e.rtpSender){e.rtpSender.stop()}if(e.rtpReceiver){e.rtpReceiver.stop()}});this._updateSignalingState("closed")};n.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this.dispatchEvent(t);if(this.onsignalingstatechange!==null){this.onsignalingstatechange(t)}};n.prototype._maybeFireNegotiationNeeded=function(){var t=this;if(this.signalingState!=="stable"||this.needNegotiation===true){return}this.needNegotiation=true;e.setTimeout(function(){if(t.needNegotiation===false){return}t.needNegotiation=false;var e=new Event("negotiationneeded");t.dispatchEvent(e);if(t.onnegotiationneeded!==null){t.onnegotiationneeded(e)}},0)};n.prototype._updateConnectionState=function(){var e=this;var t;var n={"new":0,closed:0,connecting:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};this.transceivers.forEach(function(e){n[e.iceTransport.state]++;n[e.dtlsTransport.state]++});n.connected+=n.completed;t="new";if(n.failed>0){t="failed"}else if(n.connecting>0||n.checking>0){t="connecting"}else if(n.disconnected>0){t="disconnected"}else if(n.new>0){t="new"}else if(n.connected>0||n.completed>0){t="connected"}if(t!==e.iceConnectionState){e.iceConnectionState=t;var r=new Event("iceconnectionstatechange");this.dispatchEvent(r);if(this.oniceconnectionstatechange!==null){this.oniceconnectionstatechange(r)}}};n.prototype.createOffer=function(){var n=this;if(this._pendingOffer){throw new Error("createOffer called while there is a pending offer.")}var i;if(arguments.length===1&&typeof arguments[0]!=="function"){i=arguments[0]}else if(arguments.length===3){i=arguments[2]}var a=this.transceivers.filter(function(e){return e.kind==="audio"}).length;var s=this.transceivers.filter(function(e){return e.kind==="video"}).length;if(i){if(i.mandatory||i.optional){throw new TypeError("Legacy mandatory/optional constraints not supported.")}if(i.offerToReceiveAudio!==undefined){if(i.offerToReceiveAudio===true){a=1}else if(i.offerToReceiveAudio===false){a=0}else{a=i.offerToReceiveAudio}}if(i.offerToReceiveVideo!==undefined){if(i.offerToReceiveVideo===true){s=1}else if(i.offerToReceiveVideo===false){s=0}else{s=i.offerToReceiveVideo}}}this.transceivers.forEach(function(e){if(e.kind==="audio"){a--;if(a<0){e.wantReceive=false}}else if(e.kind==="video"){s--;if(s<0){e.wantReceive=false}}});while(a>0||s>0){if(a>0){this._createTransceiver("audio");a--}if(s>0){this._createTransceiver("video");s--}}var c=o(this.transceivers);var d=r.writeSessionBoilerplate();c.forEach(function(o,i){var a=o.track;var s=o.kind;var d=r.generateIdentifier();o.mid=d;if(!o.iceGatherer){o.iceGatherer=n.usingBundle&&i>0?c[0].iceGatherer:n._createIceGatherer(d,i)}var l=e.RTCRtpSender.getCapabilities(s);if(t<15019){l.codecs=l.codecs.filter(function(e){return e.name!=="rtx"})}l.codecs.forEach(function(e){if(e.name==="H264"&&e.parameters["level-asymmetry-allowed"]===undefined){e.parameters["level-asymmetry-allowed"]="1"}});var u=[{ssrc:(2*i+1)*1001}];if(a){if(t>=15019&&s==="video"){u[0].rtx={ssrc:(2*i+1)*1001+1}}}if(o.wantReceive){o.rtpReceiver=new e.RTCRtpReceiver(o.dtlsTransport,s)}o.localCapabilities=l;o.sendEncodingParameters=u});if(this._config.bundlePolicy!=="max-compat"){d+="a=group:BUNDLE "+c.map(function(e){return e.mid}).join(" ")+"\r\n"}d+="a=ice-options:trickle\r\n";c.forEach(function(e,t){d+=r.writeMediaSection(e,e.localCapabilities,"offer",e.stream);d+="a=rtcp-rsize\r\n"});this._pendingOffer=c;var l=new e.RTCSessionDescription({type:"offer",sdp:d});if(arguments.length&&typeof arguments[0]==="function"){e.setTimeout(arguments[0],0,l)}return Promise.resolve(l)};n.prototype.createAnswer=function(){var n=r.writeSessionBoilerplate();if(this.usingBundle){n+="a=group:BUNDLE "+this.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"}this.transceivers.forEach(function(e,o){if(e.isDatachannel){n+="m=application 0 DTLS/SCTP 5000\r\n"+"c=IN IP4 0.0.0.0\r\n"+"a=mid:"+e.mid+"\r\n";return}if(e.stream){var i;if(e.kind==="audio"){i=e.stream.getAudioTracks()[0]}else if(e.kind==="video"){i=e.stream.getVideoTracks()[0]}if(i){if(t>=15019&&e.kind==="video"){e.sendEncodingParameters[0].rtx={ssrc:(2*o+2)*1001+1}}}}var s=a(e.localCapabilities,e.remoteCapabilities);var c=s.codecs.filter(function(e){return e.name.toLowerCase()==="rtx"}).length;if(!c&&e.sendEncodingParameters[0].rtx){delete e.sendEncodingParameters[0].rtx}n+=r.writeMediaSection(e,s,"answer",e.stream);if(e.rtcpParameters&&e.rtcpParameters.reducedSize){n+="a=rtcp-rsize\r\n"}});var o=new e.RTCSessionDescription({type:"answer",sdp:n});if(arguments.length&&typeof arguments[0]==="function"){e.setTimeout(arguments[0],0,o)}return Promise.resolve(o)};n.prototype.addIceCandidate=function(t){if(!t){for(var n=0;n<this.transceivers.length;n++){this.transceivers[n].iceTransport.addRemoteCandidate({});if(this.usingBundle){return Promise.resolve()}}}else{var o=t.sdpMLineIndex;if(t.sdpMid){for(var i=0;i<this.transceivers.length;i++){if(this.transceivers[i].mid===t.sdpMid){o=i;break}}}var a=this.transceivers[o];if(a){var s=Object.keys(t.candidate).length>0?r.parseCandidate(t.candidate):{};if(s.protocol==="tcp"&&(s.port===0||s.port===9)){return Promise.resolve()}if(s.component&&!(s.component==="1"||s.component===1)){return Promise.resolve()}a.iceTransport.addRemoteCandidate(s);var c=r.splitSections(this.remoteDescription.sdp);c[o+1]+=(s.type?t.candidate.trim():"a=end-of-candidates")+"\r\n";this.remoteDescription.sdp=c.join("")}}if(arguments.length>1&&typeof arguments[1]==="function"){e.setTimeout(arguments[1],0)}return Promise.resolve()};n.prototype.getStats=function(){var t=[];this.transceivers.forEach(function(e){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(n){if(e[n]){t.push(e[n].getStats())}})});var n=arguments.length>1&&typeof arguments[1]==="function"&&arguments[1];var r=function(e){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};return new Promise(function(o){var i=new Map;Promise.all(t).then(function(t){t.forEach(function(e){Object.keys(e).forEach(function(t){e[t].type=r(e[t]);i.set(t,e[t])})});if(n){e.setTimeout(n,0,i)}o(i)})})};return n}},function(e,t){"use strict";var n={};n.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)};n.localCName=n.generateIdentifier();n.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})};n.splitSections=function(e){var t=e.split("\nm=");return t.map(function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"})};n.matchPrefix=function(e,t){return n.splitLines(e).filter(function(e){return e.indexOf(t)===0})};n.parseCandidate=function(e){var t;if(e.indexOf("a=candidate:")===0){t=e.substring(12).split(" ")}else{t=e.substring(10).split(" ")}var n={foundation:t[0],component:t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],port:parseInt(t[5],10),type:t[7]};for(var r=8;r<t.length;r+=2){switch(t[r]){case"raddr":n.relatedAddress=t[r+1];break;case"rport":n.relatedPort=parseInt(t[r+1],10);break;case"tcptype":n.tcpType=t[r+1];break;default:break}}return n};n.writeCandidate=function(e){var t=[];t.push(e.foundation);t.push(e.component);t.push(e.protocol.toUpperCase());t.push(e.priority);t.push(e.ip);t.push(e.port);var n=e.type;t.push("typ");t.push(n);if(n!=="host"&&e.relatedAddress&&e.relatedPort){t.push("raddr");t.push(e.relatedAddress);t.push("rport");t.push(e.relatedPort)}if(e.tcpType&&e.protocol.toLowerCase()==="tcp"){t.push("tcptype");t.push(e.tcpType)}return"candidate:"+t.join(" ")};n.parseRtpMap=function(e){var t=e.substr(9).split(" ");var n={payloadType:parseInt(t.shift(),10)};t=t[0].split("/");n.name=t[0];n.clockRate=parseInt(t[1],10);n.numChannels=t.length===3?parseInt(t[2],10):1;return n};n.writeRtpMap=function(e){var t=e.payloadType;if(e.preferredPayloadType!==undefined){t=e.preferredPayloadType}return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(e.numChannels!==1?"/"+e.numChannels:"")+"\r\n"};n.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),uri:t[1]}};n.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+" "+e.uri+"\r\n"};n.parseFmtp=function(e){var t={};var n;var r=e.substr(e.indexOf(" ")+1).split(";");for(var o=0;o<r.length;o++){n=r[o].trim().split("=");t[n[0].trim()]=n[1]}return t};n.writeFmtp=function(e){var t="";var n=e.payloadType;if(e.preferredPayloadType!==undefined){n=e.preferredPayloadType}if(e.parameters&&Object.keys(e.parameters).length){var r=[];Object.keys(e.parameters).forEach(function(t){r.push(t+"="+e.parameters[t])});t+="a=fmtp:"+n+" "+r.join(";")+"\r\n"}return t};n.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}};n.writeRtcpFb=function(e){var t="";var n=e.payloadType;if(e.preferredPayloadType!==undefined){n=e.preferredPayloadType}if(e.rtcpFeedback&&e.rtcpFeedback.length){e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})}return t};n.parseSsrcMedia=function(e){var t=e.indexOf(" ");var n={ssrc:parseInt(e.substr(7,t-7),10)};var r=e.indexOf(":",t);if(r>-1){n.attribute=e.substr(t+1,r-t-1);n.value=e.substr(r+1)}else{n.attribute=e.substr(t+1)}return n};n.getMid=function(e){var t=n.matchPrefix(e,"a=mid:")[0];if(t){return t.substr(6)}};n.getDtlsParameters=function(e,t){var r=n.splitLines(e);r=r.concat(n.splitLines(t));var o=r.filter(function(e){return e.indexOf("a=fingerprint:")===0})[0].substr(14);var i={role:"auto",fingerprints:[{algorithm:o.split(" ")[0].toLowerCase(),value:o.split(" ")[1]}]};return i};n.writeDtlsParameters=function(e,t){var n="a=setup:"+t+"\r\n";e.fingerprints.forEach(function(e){n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"});return n};n.getIceParameters=function(e,t){var r=n.splitLines(e);r=r.concat(n.splitLines(t));var o={usernameFragment:r.filter(function(e){return e.indexOf("a=ice-ufrag:")===0})[0].substr(12),password:r.filter(function(e){return e.indexOf("a=ice-pwd:")===0})[0].substr(10)};return o};n.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\n"+"a=ice-pwd:"+e.password+"\r\n"};n.parseRtpParameters=function(e){var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]};var r=n.splitLines(e);var o=r[0].split(" ");for(var i=3;i<o.length;i++){var a=o[i];var s=n.matchPrefix(e,"a=rtpmap:"+a+" ")[0];if(s){var c=n.parseRtpMap(s);var d=n.matchPrefix(e,"a=fmtp:"+a+" ");c.parameters=d.length?n.parseFmtp(d[0]):{};c.rtcpFeedback=n.matchPrefix(e,"a=rtcp-fb:"+a+" ").map(n.parseRtcpFb);t.codecs.push(c);switch(c.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(c.name.toUpperCase());break;default:break}}}n.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(n.parseExtmap(e))});return t};n.writeRtpDescription=function(e,t){var r="";r+="m="+e+" ";r+=t.codecs.length>0?"9":"0";r+=" UDP/TLS/RTP/SAVPF ";r+=t.codecs.map(function(e){if(e.preferredPayloadType!==undefined){return e.preferredPayloadType}return e.payloadType}).join(" ")+"\r\n";r+="c=IN IP4 0.0.0.0\r\n";r+="a=rtcp:9 IN IP4 0.0.0.0\r\n";t.codecs.forEach(function(e){r+=n.writeRtpMap(e);r+=n.writeFmtp(e);r+=n.writeRtcpFb(e)});var o=0;t.codecs.forEach(function(e){if(e.maxptime>o){o=e.maxptime}});if(o>0){r+="a=maxptime:"+o+"\r\n"}r+="a=rtcp-mux\r\n";t.headerExtensions.forEach(function(e){r+=n.writeExtmap(e)});return r};n.parseRtpEncodingParameters=function(e){var t=[];var r=n.parseRtpParameters(e);var o=r.fecMechanisms.indexOf("RED")!==-1;var i=r.fecMechanisms.indexOf("ULPFEC")!==-1;var a=n.matchPrefix(e,"a=ssrc:").map(function(e){return n.parseSsrcMedia(e)}).filter(function(e){return e.attribute==="cname"});var s=a.length>0&&a[0].ssrc;var c;var d=n.matchPrefix(e,"a=ssrc-group:FID").map(function(e){var t=e.split(" ");t.shift();return t.map(function(e){return parseInt(e,10)})});if(d.length>0&&d[0].length>1&&d[0][0]===s){c=d[0][1]}r.codecs.forEach(function(e){if(e.name.toUpperCase()==="RTX"&&e.parameters.apt){var n={ssrc:s,codecPayloadType:parseInt(e.parameters.apt,10),rtx:{ssrc:c}};t.push(n);if(o){n=JSON.parse(JSON.stringify(n));n.fec={ssrc:c,mechanism:i?"red+ulpfec":"red"};t.push(n)}}});if(t.length===0&&s){t.push({ssrc:s})}var l=n.matchPrefix(e,"b=");if(l.length){if(l[0].indexOf("b=TIAS:")===0){l=parseInt(l[0].substr(7),10)}else if(l[0].indexOf("b=AS:")===0){l=parseInt(l[0].substr(5),10)}t.forEach(function(e){e.maxBitrate=l})}return t};n.parseRtcpParameters=function(e){var t={};var r;var o=n.matchPrefix(e,"a=ssrc:").map(function(e){return n.parseSsrcMedia(e)}).filter(function(e){return e.attribute==="cname"})[0];if(o){t.cname=o.value;t.ssrc=o.ssrc}var i=n.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=i.length>0;t.compound=i.length===0;var a=n.matchPrefix(e,"a=rtcp-mux");t.mux=a.length>0;return t};n.parseMsid=function(e){var t;var r=n.matchPrefix(e,"a=msid:");if(r.length===1){t=r[0].substr(7).split(" ");return{stream:t[0],track:t[1]}}var o=n.matchPrefix(e,"a=ssrc:").map(function(e){return n.parseSsrcMedia(e)}).filter(function(e){return e.attribute==="msid"});if(o.length>0){t=o[0].value.split(" ");return{stream:t[0],track:t[1]}}};n.writeSessionBoilerplate=function(){return"v=0\r\n"+"o=thisisadapterortc 8169639915646943137 2 IN IP4 127.0.0.1\r\n"+"s=-\r\n"+"t=0 0\r\n"};n.writeMediaSection=function(e,t,r,o){var i=n.writeRtpDescription(e.kind,t);i+=n.writeIceParameters(e.iceGatherer.getLocalParameters());i+=n.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),r==="offer"?"actpass":"active");i+="a=mid:"+e.mid+"\r\n";if(e.rtpSender&&e.rtpReceiver){i+="a=sendrecv\r\n"}else if(e.rtpSender){i+="a=sendonly\r\n"}else if(e.rtpReceiver){i+="a=recvonly\r\n"}else{i+="a=inactive\r\n"}if(e.rtpSender){var a="msid:"+o.id+" "+e.rtpSender.track.id+"\r\n";i+="a="+a;i+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+a;if(e.sendEncodingParameters[0].rtx){i+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+a;i+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n"}}i+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+n.localCName+"\r\n";if(e.rtpSender&&e.sendEncodingParameters[0].rtx){i+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+n.localCName+"\r\n"}return i};n.getDirection=function(e,t){var r=n.splitLines(e);for(var o=0;o<r.length;o++){switch(r[o]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[o].substr(2);default:}}if(t){return n.getDirection(t)}return"sendrecv"};n.getKind=function(e){var t=n.splitLines(e);var r=t[0].split(" ");return r[0].substr(2)};n.isRejected=function(e){return e.split(" ",2)[1]==="0"};e.exports=n},function(e,t){"use strict";e.exports=function(e){var t=e&&e.navigator;var n=function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}};var r=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return r(e).catch(function(e){return Promise.reject(n(e))})}}},function(e,t,n){"use strict";var r=n(42);var o={shimOnTrack:function(e){if(typeof e==="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){if(this._ontrack){this.removeEventListener("track",this._ontrack);this.removeEventListener("addstream",this._ontrackpoly)}this.addEventListener("track",this._ontrack=e);this.addEventListener("addstream",this._ontrackpoly=function(e){e.stream.getTracks().forEach(function(t){var n=new Event("track");n.track=t;n.receiver={track:t};n.streams=[e.stream];this.dispatchEvent(n)}.bind(this))}.bind(this))}})}},shimSourceObject:function(e){if(typeof e==="object"){if(e.HTMLMediaElement&&!("srcObject"in e.HTMLMediaElement.prototype)){Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(e){this.mozSrcObject=e}})}}},shimPeerConnection:function(e){var t=r.detectBrowser(e);if(typeof e!=="object"||!(e.RTCPeerConnection||e.mozRTCPeerConnection)){return}if(!e.RTCPeerConnection){e.RTCPeerConnection=function(n,r){if(t.version<38){if(n&&n.iceServers){var o=[];for(var i=0;i<n.iceServers.length;i++){var a=n.iceServers[i];if(a.hasOwnProperty("urls")){for(var s=0;s<a.urls.length;s++){var c={url:a.urls[s]};if(a.urls[s].indexOf("turn")===0){c.username=a.username;c.credential=a.credential}o.push(c)}}else{o.push(n.iceServers[i])}}n.iceServers=o}}return new e.mozRTCPeerConnection(n,r)};e.RTCPeerConnection.prototype=e.mozRTCPeerConnection.prototype;if(e.mozRTCPeerConnection.generateCertificate){Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.mozRTCPeerConnection.generateCertificate}})}e.RTCSessionDescription=e.mozRTCSessionDescription;e.RTCIceCandidate=e.mozRTCIceCandidate}["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){arguments[0]=new(t==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]);return n.apply(this,arguments)}});var n=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){if(!arguments[0]){if(arguments[1]){arguments[1].apply(null)}return Promise.resolve()}return n.apply(this,arguments)};var o=function(e){var t=new Map;Object.keys(e).forEach(function(n){t.set(n,e[n]);t[n]=e[n]});return t};var i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"};var a=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,n,r){return a.apply(this,[e||null]).then(function(e){if(t.version<48){e=o(e)}if(t.version<53&&!n){try{e.forEach(function(e){e.type=i[e.type]||e.type})}catch(r){if(r.name!=="TypeError"){throw r}e.forEach(function(t,n){e.set(n,Object.assign({},t,{type:i[t.type]||t.type}))})}}return e}).then(n,r)}}};e.exports={shimOnTrack:o.shimOnTrack,shimSourceObject:o.shimSourceObject,shimPeerConnection:o.shimPeerConnection,shimGetUserMedia:n(50)}},function(e,t,n){"use strict";var r=n(42);var o=r.log;e.exports=function(e){var t=r.detectBrowser(e);var n=e&&e.navigator;var i=e&&e.MediaStreamTrack;var a=function(e){return{name:{InternalError:"NotReadableError",NotSupportedError:"TypeError",PermissionDeniedError:"NotAllowedError",SecurityError:"NotAllowedError"}[e.name]||e.name,message:{"The operation is insecure.":"The request is not allowed by the "+"user agent or the platform in the current context."}[e.message]||e.message,constraint:e.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}};var s=function(e,r,i){var s=function(e){if(typeof e!=="object"||e.require){return e}var t=[];Object.keys(e).forEach(function(n){if(n==="require"||n==="advanced"||n==="mediaSource"){return}var r=e[n]=typeof e[n]==="object"?e[n]:{ideal:e[n]};if(r.min!==undefined||r.max!==undefined||r.exact!==undefined){t.push(n)}if(r.exact!==undefined){if(typeof r.exact==="number"){r.min=r.max=r.exact}else{e[n]=r.exact}delete r.exact}if(r.ideal!==undefined){e.advanced=e.advanced||[];var o={};if(typeof r.ideal==="number"){o[n]={min:r.ideal,max:r.ideal}}else{o[n]=r.ideal}e.advanced.push(o);delete r.ideal;if(!Object.keys(r).length){delete e[n]}}});if(t.length){e.require=t}return e};e=JSON.parse(JSON.stringify(e));if(t.version<38){o("spec: "+JSON.stringify(e));if(e.audio){e.audio=s(e.audio)}if(e.video){e.video=s(e.video)}o("ff37: "+JSON.stringify(e))}return n.mozGetUserMedia(e,r,function(e){i(a(e))})};var c=function(e){return new Promise(function(t,n){s(e,t,n)})};if(!n.mediaDevices){n.mediaDevices={getUserMedia:c,addEventListener:function(){},removeEventListener:function(){}}}n.mediaDevices.enumerateDevices=n.mediaDevices.enumerateDevices||function(){return new Promise(function(e){var t=[{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}];e(t)})};if(t.version<41){var d=n.mediaDevices.enumerateDevices.bind(n.mediaDevices);n.mediaDevices.enumerateDevices=function(){return d().then(undefined,function(e){if(e.name==="NotFoundError"){return[]}throw e})}}if(t.version<49){var l=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(e){return l(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length){t.getTracks().forEach(function(e){e.stop()});throw new DOMException("The object can not be found here.","NotFoundError")}return t},function(e){return Promise.reject(a(e))})}}if(!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){
var u=function(e,t,n){if(t in e&&!(n in e)){e[n]=e[t];delete e[t]}};var g=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(e){if(typeof e==="object"&&typeof e.audio==="object"){e=JSON.parse(JSON.stringify(e));u(e.audio,"autoGainControl","mozAutoGainControl");u(e.audio,"noiseSuppression","mozNoiseSuppression")}return g(e)};if(i&&i.prototype.getSettings){var f=i.prototype.getSettings;i.prototype.getSettings=function(){var e=f.apply(this,arguments);u(e,"mozAutoGainControl","autoGainControl");u(e,"mozNoiseSuppression","noiseSuppression");return e}}if(i&&i.prototype.applyConstraints){var p=i.prototype.applyConstraints;i.prototype.applyConstraints=function(e){if(this.kind==="audio"&&typeof e==="object"){e=JSON.parse(JSON.stringify(e));u(e,"autoGainControl","mozAutoGainControl");u(e,"noiseSuppression","mozNoiseSuppression")}return p.apply(this,[e])}}}n.getUserMedia=function(e,r,o){if(t.version<44){return s(e,r,o)}console.warn("navigator.getUserMedia has been replaced by "+"navigator.mediaDevices.getUserMedia");n.mediaDevices.getUserMedia(e).then(r,o)}}},function(e,t){"use strict";var n={shimAddStream:function(e){if(typeof e==="object"&&e.RTCPeerConnection&&!("addStream"in e.RTCPeerConnection.prototype)){e.RTCPeerConnection.prototype.addStream=function(e){var t=this;e.getTracks().forEach(function(n){t.addTrack(n,e)})}}},shimOnAddStream:function(e){if(typeof e==="object"&&e.RTCPeerConnection&&!("onaddstream"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){if(this._onaddstream){this.removeEventListener("addstream",this._onaddstream);this.removeEventListener("track",this._onaddstreampoly)}this.addEventListener("addstream",this._onaddstream=e);this.addEventListener("track",this._onaddstreampoly=function(e){var t=e.streams[0];if(!this._streams){this._streams=[]}if(this._streams.indexOf(t)>=0){return}this._streams.push(t);var n=new Event("addstream");n.stream=e.streams[0];this.dispatchEvent(n)}.bind(this))}})}},shimCallbacksAPI:function(e){if(typeof e!=="object"||!e.RTCPeerConnection){return}var t=e.RTCPeerConnection.prototype;var n=t.createOffer;var r=t.createAnswer;var o=t.setLocalDescription;var i=t.setRemoteDescription;var a=t.addIceCandidate;t.createOffer=function(e,t){var r=arguments.length>=2?arguments[2]:arguments[0];var o=n.apply(this,[r]);if(!t){return o}o.then(e,t);return Promise.resolve()};t.createAnswer=function(e,t){var n=arguments.length>=2?arguments[2]:arguments[0];var o=r.apply(this,[n]);if(!t){return o}o.then(e,t);return Promise.resolve()};var s=function(e,t,n){var r=o.apply(this,[e]);if(!n){return r}r.then(t,n);return Promise.resolve()};t.setLocalDescription=s;s=function(e,t,n){var r=i.apply(this,[e]);if(!n){return r}r.then(t,n);return Promise.resolve()};t.setRemoteDescription=s;s=function(e,t,n){var r=a.apply(this,[e]);if(!n){return r}r.then(t,n);return Promise.resolve()};t.addIceCandidate=s},shimGetUserMedia:function(e){var t=e&&e.navigator;if(!t.getUserMedia){if(t.webkitGetUserMedia){t.getUserMedia=t.webkitGetUserMedia.bind(t)}else if(t.mediaDevices&&t.mediaDevices.getUserMedia){t.getUserMedia=function(e,n,r){t.mediaDevices.getUserMedia(e).then(n,r)}.bind(t)}}}};e.exports={shimCallbacksAPI:n.shimCallbacksAPI,shimAddStream:n.shimAddStream,shimOnAddStream:n.shimOnAddStream,shimGetUserMedia:n.shimGetUserMedia}},function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var o=arguments.length,i=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,a;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")i=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)if(a=e[s])i=(o<3?a(i):o>3?a(t,n,i):a(t,n))||i;return o>3&&i&&Object.defineProperty(t,n,i),i};var o=n(4);var i=n(53);var a=n(34);var s=n(35);var c=n(55);var d=n(54);var l=n(5);var u=n(56);var g=function(){function e(){var t=this;if(e.instance){throw new Error("Error - use Client.getIM()")}this.eventListeners={};this.signalling=a.MsgSignaling.get();this.cm=d.ConversationManager.get();this.signalling.addEventListener(s.MsgEvent.onError,function(e){t.dispatchEvent(c.MessagingEvents.onError,e)});d.ConversationManager.get();this.signalling.addEventListener(s.MsgEvent.onEditUser,function(e){var n=e.object;var r={user:{customData:n.custom_data,privateCustomData:n.private_custom_data,userId:n.user_id},userId:e.user_id,seq:e.seq,onIncomingEvent:e.on_incoming_event};t.dispatchEvent(c.MessagingEvents.onEditUser,r)});this.signalling.addEventListener(s.MsgEvent.onGetUser,function(e){var n=e.object;var r={user:{conversationsList:n.conversations_list,customData:n.custom_data,privateCustomData:n.private_custom_data,userId:n.user_id},userId:e.user_id,seq:e.seq,onIncomingEvent:e.on_incoming_event};t.dispatchEvent(c.MessagingEvents.onGetUser,r)});this.signalling.addEventListener(s.MsgEvent.onSubscribe,function(e){t.dispatchEvent(c.MessagingEvents.onSubscribe,{users:e.users})});this.signalling.addEventListener(s.MsgEvent.onUnSubscribe,function(e){t.dispatchEvent(c.MessagingEvents.onUnSubscribe,{users:e.users})});this.signalling.addEventListener(s.MsgEvent.onSetStatus,function(e){t.dispatchEvent(c.MessagingEvents.onSetStatus,{user:{userId:e.object.user_id,online:e.object.online,timestamp:e.object.timestamp},userId:e.user_id,seq:e.seq,onIncomingEvent:e.on_incoming_event})});this.awaitPromiseList=[]}e.getInstance=function(){e.instance=e.instance||new e;return e.instance};e.prototype.createConversation=function(e,t,n,r,o,i){this.cm.createConversation(e,t,n,r,o,i)};e.prototype.getConversation=function(e){this.cm.getConversation(e)};e.prototype.getConversations=function(e){if(e.length>30){o.LogManager.get().writeMessage(o.LogCategory.MESSAGING,"Rate limit",o.LogLevel.ERROR,"you can get maximum 30 conversation in one getConversations");return}return this.cm.getConversations(e)};e.prototype.getRawConversations=function(e){return this.cm.getConversations(e)};e.prototype.removeConversation=function(e){this.cm.removeConversation(e)};e.prototype.joinConversation=function(e){this.signalling.sendPayload(s.MsgAction.joinConversation,{uuid:e})};e.prototype.leaveConversation=function(e){this.signalling.sendPayload(s.MsgAction.leaveConversation,{uuid:e})};e.prototype.getUser=function(e){this.signalling.sendPayload(s.MsgAction.getUser,{user_id:e})};e.prototype.getMe=function(){return d.ConversationManager.extractUserName(l.Authenticator.get().username())};e.prototype.editUser=function(e,t){var n={user_id:d.ConversationManager.extractUserName(l.Authenticator.get().username())};if(e)n["custom_data"]=e;if(t)n["private_custom_data"]=t;this.signalling.sendPayload(s.MsgAction.editUser,n)};e.prototype.getUsers=function(e){this.signalling.sendPayload(s.MsgAction.getUsers,{users:e})};e.prototype.addEventListener=function(e,t){if(typeof this.eventListeners[e]==="undefined")this.eventListeners[e]=[];this.eventListeners[e].push(t)};e.prototype.removeEventListener=function(e,t){if(typeof this.eventListeners[e]==="undefined")return;if(typeof t==="function"){for(var n=0;n<this.eventListeners[e].length;n++){if(this.eventListeners[e][n]===t){this.eventListeners[e].splice(n,1);break}}}else{this.eventListeners[e]=[]}};e.prototype.dispatchEvent=function(e,t){t.name=c.MessagingEvents[e];if(typeof this.eventListeners[e]!=="undefined")this.eventListeners[e].forEach(function(e){if(typeof e==="function")e(t)});if(typeof this.awaitPromiseList[e]!=="undefined"&&this.awaitPromiseList[e].length!=0){var n=this.awaitPromiseList[e].splice(0,1);n.resolve(t);window.clearTimeout(n.expire)}};e.prototype.on=function(e,t){this.addEventListener(e,t)};e.prototype.off=function(e,t){this.removeEventListener(e,t)};e.prototype.registerPromise=function(e,t,n){if(typeof this.awaitPromiseList[e]==="undefined")this.awaitPromiseList[e]=[];this.awaitPromiseList[e].push({resolve:t,reject:n,expire:setTimeout(function(){n()},2e4)})};e.prototype.createConversationFromCache=function(e){if(typeof e==="undefined")return null;return i.Conversation.createFromCache(e)};e.prototype.createMessageFromCache=function(e){if(typeof e==="undefined")return null;return u.Message.createFromCache(e)};e.prototype.subscribe=function(e){this.signalling.sendPayload(s.MsgAction.subscribe,{users:e})};e.prototype.unSubscribe=function(e){this.signalling.sendPayload(s.MsgAction.unSubscribe,{users:e})};e.prototype.setPresence=function(e){this.setStatus(e)};e.prototype.setStatus=function(e){this.signalling.sendPayload(s.MsgAction.setStatus,{online:e})};r([o.LogManager.d_trace(o.LogCategory.MESSAGING)],e.prototype,"createConversation",null);r([o.LogManager.d_trace(o.LogCategory.MESSAGING)],e.prototype,"getConversation",null);r([o.LogManager.d_trace(o.LogCategory.MESSAGING)],e.prototype,"getConversations",null);r([o.LogManager.d_trace(o.LogCategory.MESSAGING)],e.prototype,"getRawConversations",null);r([o.LogManager.d_trace(o.LogCategory.MESSAGING)],e.prototype,"removeConversation",null);r([o.LogManager.d_trace(o.LogCategory.MESSAGING)],e.prototype,"joinConversation",null);r([o.LogManager.d_trace(o.LogCategory.MESSAGING)],e.prototype,"leaveConversation",null);r([o.LogManager.d_trace(o.LogCategory.MESSAGING)],e.prototype,"getUser",null);r([o.LogManager.d_trace(o.LogCategory.MESSAGING)],e.prototype,"getMe",null);r([o.LogManager.d_trace(o.LogCategory.MESSAGING)],e.prototype,"editUser",null);r([o.LogManager.d_trace(o.LogCategory.MESSAGING)],e.prototype,"getUsers",null);r([o.LogManager.d_trace(o.LogCategory.MESSAGING)],e.prototype,"addEventListener",null);r([o.LogManager.d_trace(o.LogCategory.MESSAGING)],e.prototype,"removeEventListener",null);r([o.LogManager.d_trace(o.LogCategory.MESSAGING)],e.prototype,"dispatchEvent",null);r([o.LogManager.d_trace(o.LogCategory.MESSAGING)],e.prototype,"on",null);r([o.LogManager.d_trace(o.LogCategory.MESSAGING)],e.prototype,"off",null);r([o.LogManager.d_trace(o.LogCategory.MESSAGING)],e.prototype,"registerPromise",null);r([o.LogManager.d_trace(o.LogCategory.MESSAGING)],e.prototype,"createConversationFromCache",null);r([o.LogManager.d_trace(o.LogCategory.MESSAGING)],e.prototype,"createMessageFromCache",null);r([o.LogManager.d_trace(o.LogCategory.MESSAGING)],e.prototype,"subscribe",null);r([o.LogManager.d_trace(o.LogCategory.MESSAGING)],e.prototype,"unSubscribe",null);r([o.LogManager.d_trace(o.LogCategory.MESSAGING)],e.prototype,"setPresence",null);r([o.LogManager.d_trace(o.LogCategory.MESSAGING)],e.prototype,"setStatus",null);r([o.LogManager.d_trace(o.LogCategory.MESSAGING)],e,"getInstance",null);return e}();t.Messenger=g},function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var o=arguments.length,i=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,a;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")i=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)if(a=e[s])i=(o<3?a(i):o>3?a(t,n,i):a(t,n))||i;return o>3&&i&&Object.defineProperty(t,n,i),i};var o=n(39);var i=n(54);var a=n(55);var s=n(4);var c=n(56);var d=n(34);var l=n(35);var u=a.MessagingEvents.onEditConversation;var g=n(52);var f=function(){function e(e,t,n,r,o){this._distinct=t;this._publicJoin=n;this._participants=e;this._customData=r;this._moderators=o}Object.defineProperty(e.prototype,"lastRead",{get:function(){return this._lastRead},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"uuid",{get:function(){return this._uuid},set:function(e){throw Error("You can't change UUID for conversation.")},enumerable:true,configurable:true});e.prototype.getPayload=function(){if(typeof this._uuid=="undefined")throw Error("You must create UUID with createUUID() function!");var e={uuid:this._uuid,participants:this.prepareParticipants(this._participants)};if(typeof this._title!="undefined")e["title"]=this._title;else e["title"]="";if(typeof this._moderators!="undefined")e["moderators"]=this._moderators;else e["moderators"]=[];if(typeof this._lastRead!="undefined")e["last_readed"]=this._lastRead;if(typeof this._distinct!="undefined")e["distinct"]=this._distinct;else e["distinct"]=false;if(typeof this._publicJoin!="undefined")e["enable_public_join"]=this._publicJoin;else e["enable_public_join"]=false;if(typeof this._customData!="undefined")e["custom_data"]=this._customData;else e["custom_data"]={};if(typeof this._createdAt!="undefined")e["created_at"]=this._createdAt;return e};e.prototype.getSimplePayload=function(){if(typeof this._uuid=="undefined")throw Error("You must create UUID with createUUID() function!");return{uuid:this._uuid,title:typeof this._title!="undefined"?this._title:"",distinct:typeof this._distinct!="undefined"?this._distinct:false,enable_public_join:typeof this._publicJoin!="undefined"?this._publicJoin:false,custom_data:typeof this._customData!="undefined"?this._customData:{}}};e.prototype.prepareParticipants=function(e){var t=[];for(var n=0,r=e;n<r.length;n++){var o=r[n];if(typeof o.userId!="undefined"){var a={user_id:i.ConversationManager.extractUserName(o.userId)};a["can_write"]=typeof o.canWrite=="undefined"?true:o.canWrite;a["can_manage_participants"]=typeof o.canManageParticipants=="undefined"?false:o.canManageParticipants;t.push(a)}}return t};e.prototype.createUUID=function(){if(typeof this._uuid!="undefined")throw Error("UUID already created!");this._uuid=(new o.GUID).toString()};e.createFromBus=function(t,n){var r=new e([]);r._lastSeq=n;r._uuid=t.uuid;r._title=t.title;r._moderators=t.moderators;r._createdAt=t.created_at;r._lastRead=t.last_read;r._distinct=t.distinct;r._publicJoin=t.public_join;if(t.participants)r._participants=t.participants.map(function(e){return{userId:e.user_id,canWrite:e.can_write,canManageParticipants:e.can_manage_participants}});if(t.custom_data)r._customData=t.custom_data;r._lastUpdate=t.last_update;return r};e.createFromCache=function(t){var n=new e([]);n._uuid=t.uuid;n._lastSeq=t.seq;n._lastUpdate=t.lastUpdate;n._title=t.title;n._moderators=t.moderators;n._createdAt=t.createdAt;n._lastRead=t.lastRead;n._distinct=t.distinct;n._publicJoin=t.publicJoin;n._participants=t.participants;n._customData=t.customData;return n};e.prototype.toCache=function(){return{uuid:this._uuid,seq:this._lastSeq,lastUpdate:this._lastUpdate,moderators:this._moderators,title:this._title,createdAt:this._createdAt,lastRead:this._lastRead,distinct:this._distinct,publicJoin:this._publicJoin,participants:this._participants,customData:this._customData}};Object.defineProperty(e.prototype,"title",{get:function(){return this._title},set:function(e){this._title=e},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"distinct",{get:function(){return this._distinct},set:function(e){this._distinct=e},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"publicJoin",{get:function(){return this._publicJoin},set:function(e){this._publicJoin=e},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"customData",{get:function(){return this._customData},set:function(e){this._customData=e},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"moderators",{get:function(){return this._moderators},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"createdAt",{get:function(){return this._createdAt},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"participants",{get:function(){return this._participants},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"lastSeq",{get:function(){return this._lastSeq},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"lastUpdate",{get:function(){return this._lastUpdate},enumerable:true,configurable:true});e.prototype.sendMessage=function(e,t){var n=new c.Message(e,t);n.sendTo(this);return n};e.prototype.typing=function(){var e=this;if(this._debounceLock)return false;setTimeout(function(){e._debounceLock=false},1e4);this._debounceLock=true;d.MsgSignaling.get().sendPayload(l.MsgAction.typingMessage,{conversation:this._uuid});return true};e.prototype.markAsRead=function(e){d.MsgSignaling.get().sendPayload(l.MsgAction.isRead,{conversation:this._uuid,seq:e});this._lastRead=e};e.prototype.markAsDelivered=function(e){d.MsgSignaling.get().sendPayload(l.MsgAction.isDelivered,{conversation:this._uuid,seq:e})};e.prototype.remove=function(){i.ConversationManager.get().removeConversation(this._uuid)};e.prototype.update=function(){i.ConversationManager.get().editConversation(this)};e.prototype.setTitle=function(e){this._title=e;i.ConversationManager.get().editConversation(this)};e.prototype.setPublicJoin=function(e){this._publicJoin=e;i.ConversationManager.get().editConversation(this)};e.prototype.setDistinct=function(e){this._distinct=e;i.ConversationManager.get().editConversation(this)};e.prototype.setCustomData=function(e){};e.prototype.addParticipants=function(e){var t=this;return new Promise(function(n,r){if(e.length==0)r();d.MsgSignaling.get().sendPayload(l.MsgAction.addParticipants,{uuid:t._uuid,participants:t.prepareParticipants(e)});g.Messenger.getInstance().registerPromise(u,n,r)})};e.prototype.editParticipants=function(e){var t=this;return new Promise(function(n,r){if(e.length==0)r();d.MsgSignaling.get().sendPayload(l.MsgAction.editParticipants,{uuid:t._uuid,participants:t.prepareParticipants(e)});g.Messenger.getInstance().registerPromise(u,n,r)})};e.prototype.removeParticipants=function(e){var t=this;return new Promise(function(n,r){if(e.length==0)r();d.MsgSignaling.get().sendPayload(l.MsgAction.removeParticipants,{uuid:t._uuid,participants:e.map(function(e){if(typeof e.userId!=="undefined")return e.userId})});g.Messenger.getInstance().registerPromise(u,n,r)})};e.prototype.addModerators=function(e){var t=this;return new Promise(function(n,r){if(e.length==0)r();d.MsgSignaling.get().sendPayload(l.MsgAction.addModerators,{uuid:t._uuid,moderators:e});g.Messenger.getInstance().registerPromise(u,n,r)})};e.prototype.removeModerators=function(e){var t=this;return new Promise(function(n,r){if(e.length==0)r();d.MsgSignaling.get().sendPayload(l.MsgAction.removeModerators,{uuid:t._uuid,moderators:e});g.Messenger.getInstance().registerPromise(u,n,r)})};e.prototype.retransmitEvents=function(e,t){e=e|0;t=t|0;d.MsgSignaling.get().sendPayload(l.MsgAction.retransmitEvents,{uuid:this._uuid,eventsFrom:e,eventsTo:t})};e.prototype.updateSeq=function(e){if(e>this._lastSeq){this._lastSeq=e}this._lastUpdate=Date.now()/1e3|0};r([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e.prototype,"getPayload",null);r([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e.prototype,"getSimplePayload",null);r([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e.prototype,"prepareParticipants",null);r([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e.prototype,"createUUID",null);r([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e.prototype,"toCache",null);r([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e.prototype,"markAsRead",null);r([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e.prototype,"markAsDelivered",null);r([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e.prototype,"remove",null);r([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e.prototype,"update",null);r([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e.prototype,"addParticipants",null);r([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e.prototype,"editParticipants",null);r([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e.prototype,"removeParticipants",null);r([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e.prototype,"addModerators",null);r([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e.prototype,"removeModerators",null);r([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e.prototype,"retransmitEvents",null);r([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e.prototype,"updateSeq",null);r([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e,"createFromBus",null);r([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e,"createFromCache",null);return e}();t.Conversation=f},function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var o=arguments.length,i=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,a;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")i=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)if(a=e[s])i=(o<3?a(i):o>3?a(t,n,i):a(t,n))||i;return o>3&&i&&Object.defineProperty(t,n,i),i};var o=n(53);var i=n(34);var a=n(35);var s=n(55);var c=n(4);var d=n(52);var l=n(56);var u=function(){function e(){var t=this;if(e.instance)throw new Error("Error - use ConversationManager.get()");this.signalling=i.MsgSignaling.get();this.awaitingConversations={};this.signalling.addEventListener(a.MsgEvent.onEditConversation,function(e){t.resolveEvent(e,s.MessagingEvents.onEditConversation)});this.signalling.addEventListener(a.MsgEvent.onGetConversation,function(e){t.resolveEvent(e,s.MessagingEvents.onGetConversation)});this.signalling.addEventListener(a.MsgEvent.onRemoveConversation,function(e){t.resolveEvent(e,s.MessagingEvents.onRemoveConversation)});this.signalling.addEventListener(a.MsgEvent.onCreateConversation,function(e){t.resolveEvent(e,s.MessagingEvents.onCreateConversation)});this.signalling.addEventListener(a.MsgEvent.onSendMessage,function(e){t.resolveMessageEvent(e,s.MessagingEvents.onSendMessage)});this.signalling.addEventListener(a.MsgEvent.onEditMessage,function(e){t.resolveMessageEvent(e,s.MessagingEvents.onEditMessage)});this.signalling.addEventListener(a.MsgEvent.onRemoveMessage,function(e){t.resolveMessageEvent(e,s.MessagingEvents.onRemoveMessage)});this.signalling.addEventListener(a.MsgEvent.isRead,function(e){var t=e.object;d.Messenger.getInstance().dispatchEvent(s.MessagingEvents.isRead,{conversation:t.conversation,timestamp:new Date(t.timestamp*1e3),userId:e.user_id,seq:t.seq,onIncomingEvent:e.on_incoming_event,name:s.MessagingEvents[s.MessagingEvents.isRead]})});this.signalling.addEventListener(a.MsgEvent.isDelivered,function(e){var t=e.object;d.Messenger.getInstance().dispatchEvent(s.MessagingEvents.isDelivered,{conversation:t.conversation,timestamp:new Date(t.timestamp*1e3),userId:e.user_id,seq:t.seq,onIncomingEvent:e.on_incoming_event,name:s.MessagingEvents[s.MessagingEvents.isDelivered]})});this.signalling.addEventListener(a.MsgEvent.onTyping,function(e){d.Messenger.getInstance().dispatchEvent(s.MessagingEvents.onTyping,{name:s.MessagingEvents[s.MessagingEvents.onTyping],conversation:e.object.conversation,userId:e.user_id,onIncomingEvent:e.on_incoming_event})});this.signalling.addEventListener(a.MsgEvent.onRetransmitEvents,function(e){d.Messenger.getInstance().dispatchEvent(s.MessagingEvents.onRetransmitEvents,{events:e.object.map(function(e){if(e.event){if(e.event.indexOf("Message")==-1)return{name:e.event,conversation:o.Conversation.createFromBus(e.payload.object,e.payload.seq),userId:e.payload.user_id,seq:e.payload.seq,onIncomingEvent:e.payload.on_incoming_event};else return{name:e.event,message:l.Message.createFromBus(e.payload.object,e.payload.seq),userId:e.payload.user_id,seq:e.payload.seq,onIncomingEvent:e.payload.on_incoming_event}}}),userId:e.user_id,seq:e.seq,onIncomingEvent:e.on_incoming_event})});this._converasationList=[]}e.prototype.resolveEvent=function(e,t){if(s.MessagingEvents[t]===s.MessagingEvents[s.MessagingEvents.onRemoveConversation]){var n=e.object;d.Messenger.getInstance().dispatchEvent(t,{name:s.MessagingEvents[t],uuid:n.uuid,userId:e.user_id,seq:e.seq,onIncomingEvent:e.on_incoming_event});return}var r=o.Conversation.createFromBus(e.object,e.seq);this.registerConversation(r);if(typeof r!="undefined")r.updateSeq(e.seq);d.Messenger.getInstance().dispatchEvent(t,{name:s.MessagingEvents[t],conversation:r,userId:e.user_id,seq:e.seq,onIncomingEvent:e.on_incoming_event});if(t===s.MessagingEvents.onGetConversation&&typeof this.awaitingConversations[r.uuid]!=="undefined"){this.awaitingConversations[r.uuid](r);delete this.awaitingConversations[r.uuid]}};e.prototype.resolveMessageEvent=function(e,t){var n=this;l.Message.createFromBus(e.object,e.seq).then(function(r){if(typeof n._converasationList[r.conversation]!="undefined")n._converasationList[r.conversation].updateSeq(e.seq);d.Messenger.getInstance().dispatchEvent(t,{name:s.MessagingEvents[t],message:r,userId:e.user_id,seq:e.seq,onIncomingEvent:e.on_incoming_event})})};e.get=function(){e.instance=e.instance||new e;return e.instance};e.extractUserName=function(e){var t=e.split("@");t[1]=t[1].split(".").splice(0,2).join(".");return t.join("@")};e.prototype.createConversation=function(e,t,n,r,i,s){var c=new o.Conversation(e,n,r,i,s);c.title=t;c.createUUID();this.signalling.sendPayload(a.MsgAction.createConversation,c.getPayload())};e.prototype.registerConversation=function(e){this._converasationList.filter(function(t){return t.uuid!==e.uuid});this._converasationList.push(e)};e.prototype.removeConversation=function(e){this.signalling.sendPayload(a.MsgAction.removeConversation,{uuid:e})};e.prototype.editConversation=function(e){this.signalling.sendPayload(a.MsgAction.editConversation,e.getSimplePayload())};e.prototype.getConversation=function(e){this.signalling.sendPayload(a.MsgAction.getConversation,{uuid:e})};e.prototype.getConversationByUUID=function(e){var t=this;return new Promise(function(n,r){for(var o=0,i=t._converasationList;o<i.length;o++){var a=i[o];if(a.uuid===e){d.Messenger.getInstance().dispatchEvent(s.MessagingEvents.onGetConversation,{conversation:a});n(a);return}}t.awaitingConversations[e]=n})};e.deserialize=function(e){return o.Conversation.createFromCache(e)};e.serialize=function(e){return e.toCache()};e.prototype.getConversations=function(e){this.signalling.sendPayload(a.MsgAction.getConversations,{uuids:e})};r([c.LogManager.d_trace(c.LogCategory.MESSAGING)],e.prototype,"resolveEvent",null);r([c.LogManager.d_trace(c.LogCategory.MESSAGING)],e.prototype,"resolveMessageEvent",null);r([c.LogManager.d_trace(c.LogCategory.MESSAGING)],e.prototype,"createConversation",null);r([c.LogManager.d_trace(c.LogCategory.MESSAGING)],e.prototype,"registerConversation",null);r([c.LogManager.d_trace(c.LogCategory.MESSAGING)],e.prototype,"removeConversation",null);r([c.LogManager.d_trace(c.LogCategory.MESSAGING)],e.prototype,"editConversation",null);r([c.LogManager.d_trace(c.LogCategory.MESSAGING)],e.prototype,"getConversation",null);r([c.LogManager.d_trace(c.LogCategory.MESSAGING)],e.prototype,"getConversationByUUID",null);r([c.LogManager.d_trace(c.LogCategory.MESSAGING)],e.prototype,"getConversations",null);r([c.LogManager.d_trace(c.LogCategory.MESSAGING)],e,"get",null);r([c.LogManager.d_trace(c.LogCategory.MESSAGING)],e,"extractUserName",null);r([c.LogManager.d_trace(c.LogCategory.MESSAGING)],e,"deserialize",null);r([c.LogManager.d_trace(c.LogCategory.MESSAGING)],e,"serialize",null);return e}();t.ConversationManager=u},function(e,t){"use strict";(function(e){e[e["onCreateConversation"]="onCreateConversation"]="onCreateConversation";e[e["onEditConversation"]="onEditConversation"]="onEditConversation";e[e["onRemoveConversation"]="onRemoveConversation"]="onRemoveConversation";e[e["onGetConversation"]="onGetConversation"]="onGetConversation";e[e["onSendMessage"]="onSendMessage"]="onSendMessage";e[e["onEditMessage"]="onEditMessage"]="onEditMessage";e[e["onRemoveMessage"]="onRemoveMessage"]="onRemoveMessage";e[e["onTyping"]="Typing"]="onTyping";e[e["onEditUser"]="onEditUser"]="onEditUser";e[e["onGetUser"]="onGetUser"]="onGetUser";e[e["onError"]="onError"]="onError";e[e["onRetransmitEvents"]="onRetransmitEvents"]="onRetransmitEvents";e[e["isRead"]="isRead"]="isRead";e[e["isDelivered"]="isDelivered"]="isDelivered";e[e["onSubscribe"]="onSubscribe"]="onSubscribe";e[e["onUnSubscribe"]="onUnSubscribe"]="onUnSubscribe";e[e["onSetStatus"]="onSetStatus"]="onSetStatus"})(t.MessagingEvents||(t.MessagingEvents={}));var n=t.MessagingEvents},function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var o=arguments.length,i=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,a;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")i=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)if(a=e[s])i=(o<3?a(i):o>3?a(t,n,i):a(t,n))||i;return o>3&&i&&Object.defineProperty(t,n,i),i};var o=n(39);var i=n(34);var a=n(35);var s=n(4);var c=function(){function e(e,t){this._text=e;this._payload=t;this._uuid=(new o.GUID).toString()}e.prototype.sendTo=function(e){this._conversation=e.uuid;i.MsgSignaling.get().sendPayload(a.MsgAction.sendMessage,this.getPayload())};e.prototype.getPayload=function(){var e={uuid:this._uuid,text:this._text,conversation:this._conversation};if(typeof this._payload!=="undefined")e["payload"]=this._payload;else e["payload"]=[];return e};Object.defineProperty(e.prototype,"uuid",{get:function(){return this._uuid},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"conversation",{get:function(){return this._conversation},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"text",{get:function(){return this._text},set:function(e){this._text=e},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"payload",{get:function(){return this._payload},set:function(e){this._payload=e},enumerable:true,configurable:true});e.prototype.update=function(){i.MsgSignaling.get().sendPayload(a.MsgAction.editMessage,this.getPayload())};e.prototype.remove=function(){i.MsgSignaling.get().sendPayload(a.MsgAction.removeMessage,{uuid:this._uuid,conversation:this.conversation})};Object.defineProperty(e.prototype,"seq",{get:function(){return this._seq},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"sender",{get:function(){return this._sender},enumerable:true,configurable:true});e.createFromBus=function(t,n){return new Promise(function(r,o){var i=new e(t.text,t.payload);i._uuid=t.uuid;i._conversation=t.conversation;i._sender=t.sender;i._seq=n;r(i)})};e.createFromCache=function(t){var n=new e(t.text,t.payload);n._uuid=t.uuid;n._conversation=t.conversation;n._sender=t.sender;n._seq=t.seq;return n};e.prototype.toCache=function(){return{seq:this._seq,uuid:this._uuid,text:this._text,payload:this._payload,conversation:this._conversation,sender:this._sender}};r([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e.prototype,"sendTo",null);r([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e.prototype,"getPayload",null);r([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e.prototype,"update",null);r([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e.prototype,"remove",null);r([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e.prototype,"toCache",null);r([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e,"createFromBus",null);r([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e,"createFromCache",null);return e}();t.Message=c},function(e,t){"use strict";(function(e){e[e["Offline"]="OFFLINE"]="Offline";e[e["Online"]="ONLINE"]="Online";e[e["Ready"]="READY"]="Ready";e[e["InService"]="IN_SERVICE"]="InService";e[e["AfterService"]="AFTER_SERVICE"]="AfterService";e[e["Timeout"]="TIMEOUT"]="Timeout";e[e["DND"]="DND"]="DND"})(t.OperatorACDStatuses||(t.OperatorACDStatuses={}));var n=t.OperatorACDStatuses}]);
//# sourceMappingURL=voximplant.map.js