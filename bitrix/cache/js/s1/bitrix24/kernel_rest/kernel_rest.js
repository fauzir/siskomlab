; /* /bitrix/js/rest/marketplace.min.js?15113165413936*/
; /* /bitrix/js/rest/applayout.min.js?151131654112466*/

; /* Start:"a:4:{s:4:"full";s:48:"/bitrix/js/rest/applayout.min.js?151131654112466";s:6:"source";s:28:"/bitrix/js/rest/applayout.js";s:3:"min";s:32:"/bitrix/js/rest/applayout.min.js";s:3:"map";s:32:"/bitrix/js/rest/applayout.map.js";}"*/
(function(){BX.namespace("BX.rest");if(!!BX.rest.AppLayout){return}BX.rest.AppLayout=function(e){this.params={firstRun:!!e.firstRun,appHost:e.appHost,appProto:e.appProto,authId:e.authId,authExpires:e.authExpires,refreshId:e.refreshId,placement:e.placement,formName:e.formName,frameName:e.frameName,loaderName:e.loaderName,layoutName:e.layoutName,ajaxUrl:e.ajaxUrl,controlUrl:e.controlUrl,isAdmin:!!e.isAdmin,staticHtml:!!e.staticHtml,id:e.id,appId:e.appId,appV:e.appV,appI:e.appI,appSid:e.appSid,memberId:e.memberId,restPath:e.restPath,proto:e.proto,userOptions:e.userOptions,appOptions:e.appOptions,placementOptions:e.placementOptions};this.userSelectorControl=[null,null];this.userSelectorControlCallback=null;this.bAccessLoaded=false;this._appOptionsStack=[];this.expandPopup=null;this.expandPopupContent=null;this._inited=false;this._destroyed=false;this.deniedInterface=[];this.selectUserCallback_1_value=[];this.messageInterface=new(BX.rest.AppLayout.initializePlacement(this.params.placement));BX.bind(window,"message",BX.proxy(this.receiveMessage,this))};BX.rest.AppLayout.prototype={init:function(){if(!this._inited&&!!document.forms[this.params.formName]){var e=BX(this.params.loaderName);BX.bind(BX(this.params.frameName),"load",function(){BX.addClass(e,"app-loading-msg-loaded");BX.removeClass(this,"app-loading");setTimeout(function(){BX.remove(e)},300)});if(this.params.staticHtml){BX(this.params.frameName).src=document.forms[this.params.formName].action}else{document.forms[this.params.formName].submit()}this._inited=true}},destroy:function(){BX.unbind(window,"message",BX.proxy(this.receiveMessage,this));BX(this.params.frameName).parentNode.removeChild(BX(this.params.frameName));this._destroyed=true},receiveMessage:function(t){t=t||window.event;if(t.origin!=this.params.appProto+"://"+this.params.appHost){return}var s=e(t.data,":"),a=[];if(s[3]!=this.params.appSid){return}if(s[1]){a=JSON.parse(s[1])}if(!!this.messageInterface[s[0]]&&!BX.util.in_array(s[0],this.deniedInterface)){var i=s[2];var n=!i?BX.DoNothing:BX.delegate(function(e){var t=BX(this.params.frameName);if(!!t&&!!t.contentWindow){t.contentWindow.postMessage(i+":"+(typeof e=="undefined"?"":JSON.stringify(e)),this.params.appProto+"://"+this.params.appHost)}},this);this.messageInterface[s[0]].apply(this,[a,n])}},denyInterface:function(e){this.deniedInterface=BX.util.array_merge(this.deniedInterface,e)},sendAppOptions:function(){if(this._appOptionsStack.length>0){var e=this._appOptionsStack;this._appOptionsStack=[];var t=[];for(var s=0;s<e.length;s++){t.push({name:e[s][0],value:e[s][1]})}var a={action:"set_option",id:this.params.id,sessid:BX.bitrix_sessid(),options:t};BX.ajax({method:"POST",dataType:"json",data:a,url:this.params.ajaxUrl,onsuccess:function(t){for(var s=0;s<e.length;s++){e[s][2](t)}}})}},loadControl:function(e,t,s){if(!t){t={}}t.control=e;t.sessid=BX.bitrix_sessid();BX.ajax({method:"POST",url:this.params.controlUrl,data:t,processScriptsConsecutive:true,onsuccess:s})},reInstall:function(){BX.proxy(this.messageInterface.setInstallFinish,this)({value:false})},selectUserCallback_0:function(e){var t=BX.util.array_values(e);if(!!t&&t.length>0){BX.defer(this.userSelectorControl[0].close,this.userSelectorControl[0])();if(!!this.userSelectorControlCallback){this.userSelectorControlCallback.apply(this,[t[0]])}}},selectUserCallback_1:function(e){if(e===true){var t=BX.util.array_values(this.selectUserCallback_1_value);BX.defer(this.userSelectorControl[1].close,this.userSelectorControl[1])();if(!!this.userSelectorControlCallback){this.userSelectorControlCallback.apply(this,[t])}}else{this.selectUserCallback_1_value=e}},hideUpdate:function(e,t){BX.userOptions.save("app_options","params_"+this.params.appId+"_"+this.params.appV,"skip_update_"+e,1);t()},adjustPopup:function(){if(!!this.expandPopup&&this.expandPopup.isShown()){var e=this.expandPopupContent;var t=BX.GetWindowInnerSize();e.style.height=t.innerHeight-180+"px";e.style.width=t.innerWidth-140+"px";this.expandPopup.adjustPosition()}else{BX.unbind(window,"resize",BX.proxy(this.adjustPopup,this))}}};BX.rest.AppLayout.initizalizePlacementInterface=function(e){var t=function(){};BX.extend(t,e);t.prototype.events=BX.clone(t.superclass.events);return t};BX.rest.AppLayout.initializePlacement=function(e){e=(e+"").toUpperCase();if(!BX.rest.AppLayout.placementInterface[e]){BX.rest.AppLayout.placementInterface[e]=BX.rest.AppLayout.initizalizePlacementInterface(e==="DEFAULT"?BX.rest.AppLayout.MessageInterface:BX.rest.AppLayout.MessageInterfacePlacement)}return BX.rest.AppLayout.placementInterface[e]};BX.rest.AppLayout.initializePlacementByEvent=function(e,t){BX.addCustomEvent(t,function(t){var s=BX.rest.AppLayout.initializePlacement(e);if(!!t.events){for(var a=0;a<t.events.length;a++){s.prototype.events.push(t.events[a])}}for(var i in t){if(i!=="events"&&t.hasOwnProperty(i)){s.prototype[i]=t[i]}}})};BX.rest.AppLayout.MessageInterface=function(){};BX.rest.AppLayout.MessageInterface.prototype={events:[],getInitData:function(e,t){t({LANG:BX.message("LANGUAGE_ID"),DOMAIN:location.host,PROTOCOL:this.params.proto,PATH:this.params.restPath,AUTH_ID:this.params.authId,AUTH_EXPIRES:this.params.authExpires,REFRESH_ID:this.params.refreshId,MEMBER_ID:this.params.memberId,FIRST_RUN:this.params.firstRun,IS_ADMIN:this.params.isAdmin,INSTALL:this.params.appI,USER_OPTIONS:this.params.userOptions,APP_OPTIONS:this.params.appOptions,PLACEMENT:this.params.placement,PLACEMENT_OPTIONS:this.params.placementOptions});this.params.firstRun=false},getInterface:function(e,t){var s={command:[],event:[]};for(var a in this.messageInterface){if(a!=="events"&&a!=="constructor"&&!BX.rest.AppLayout.MessageInterfacePlacement.prototype[a]&&!BX.util.in_array(a,this.deniedInterface)){s.command.push(a)}}for(var i=0;i<this.messageInterface.events.length;i++){s.event.push(this.messageInterface.events[i])}t(s)},refreshAuth:function(e,t){e={action:"access_refresh",id:this.params.id,sessid:BX.bitrix_sessid()};BX.ajax.loadJSON(this.params.ajaxUrl,e,BX.delegate(function(e){if(!!e["access_token"]){this.params.authId=e["access_token"];this.params.authExpires=e["expires_in"];this.params.refreshId=e["refresh_token"];t({AUTH_ID:this.params.authId,AUTH_EXPIRES:this.params.authExpires,REFRESH_ID:this.params.refreshId})}else{alert("Unable to get new token! Reload page, please!")}},this))},resizeWindow:function(e,t){var s=BX(this.params.layoutName);e.width=e.width=="100%"?e.width:(parseInt(e.width)||100)+"px";e.height=parseInt(e.height);if(!!e.width){s.style.width=e.width}if(!!e.height){s.style.height=e.height+"px"}var a=BX.pos(s);t({width:a.width,height:a.height})},setTitle:function(e,t){if(!!this.expandPopup&&this.expandPopup.isShown()){this.expandPopup.setTitleBar(e.title)}else{BX.ajax.UpdatePageTitle(e.title)}t(e)},setScroll:function(e,t){if(!!e&&typeof e.scroll!="undefined"&&e.scroll>=0){window.scrollTo(BX.GetWindowScrollPos().scrollLeft,parseInt(e.scroll))}t(e)},setUserOption:function(e,t){this.params.userOptions[e.name]=e.value;BX.userOptions.save("app_options","options_"+this.params.appId,e.name,e.value);t(e)},setAppOption:function(e,t){if(this.params.isAdmin){this._appOptionsStack.push([e.name,e.value,t]);BX.defer(this.sendAppOptions,this)()}},setInstall:function(e,t){BX.userOptions.save("app_options","params_"+this.params.appId+"_"+this.params.appV,"install",!!e["install"]?1:0);t(e)},setInstallFinish:function(e,t){var s={action:"set_installed",v:typeof e.value=="undefined"||e.value!==false?"Y":"N",sessid:BX.bitrix_sessid()};BX.ajax.loadJSON(this.params.ajaxUrl,s,function(e){var t=window.location.href.replace(/(\?|&)install_finished=[^&]*/gi,"$1");window.location=(t+(t.indexOf("?")==-1?"?":"&")+"install_finished="+(!!e.result?"Y":"N")).replace("&&","&").replace("?&","?")})},selectUser:function(e,t){this.userSelectorControlCallback=t;var s=parseInt(e.mult+0);if(s){if(this.userSelectorControl[s]){this.userSelectorControl[s].close();this.userSelectorControl[s].destroy();this.userSelectorControl[s]=null}}else if(!!this.userSelectorControl[s]){this.userSelectorControl[s].show();return}var a={name:"USER_"+s,onchange:"user_selector_cb_"+parseInt(Math.random()*1e5),site_id:BX.message("SITE_ID")};if(s){a.mult=true}window[a.onchange]=BX.delegate(this["selectUserCallback_"+s],this);this.loadControl("user_selector",a,BX.delegate(function(t){this.userSelectorControl[s]=BX.PopupWindowManager.create("app-user-popup-"+s,null,{autoHide:true,content:t,zIndex:2e3});if(s){this.userSelectorControl[s].setButtons([new BX.PopupWindowButton({text:BX.message("REST_ALT_USER_SELECT"),className:"popup-window-button-accept",events:{click:function(){window[a.onchange](true)}}})])}this.userSelectorControl[parseInt(e.mult+0)].show();BX("USER_"+s+"_selector_content").style.display="block"},this))},selectAccess:function(e,t){if(!this.bAccessLoaded){this.loadControl("access_selector",{},BX.defer(function(){this.bAccessLoaded=true;BX.defer(this.messageInterface.selectAccess,this)(e,t)},this))}else{BX.Access.Init({groups:{disabled:true}});e.value=e.value||[];var s={};for(var a=0;a<e.value.length;a++){s[e.value[a]]=true}BX.Access.SetSelected(s);BX.Access.ShowForm({callback:function(e){var s=[];for(var a in e){if(e.hasOwnProperty(a)){for(var i in e[a]){if(e[a].hasOwnProperty(i)){s.push(e[a][i])}}}}t(s)}})}},selectCRM:function(e,t,s){if(!s){this.loadControl("crm_selector",{entityType:e.entityType,multiple:!!e.multiple?"Y":"N",value:e.value},BX.delegate(function(){BX.defer(this.messageInterface.selectCRM,this)(e,t,true)},this));return}if(!window.obCrm){setTimeout(BX.delegate(function(){BX.proxy(this.messageInterface.selectCRM,this)(e,t,true)},this),500)}else{obCrm["restCrmSelector"].Open();obCrm["restCrmSelector"].AddOnSaveListener(function(e){t(e);obCrm["restCrmSelector"].Clear()})}},reloadWindow:function(){window.location.reload()},imCallTo:function(e){BXIM.callTo(e.userId,!!e.video)},imPhoneTo:function(e){BXIM.phoneTo(e.phone)},imOpenMessenger:function(e){BXIM.openMessenger(e.dialogId)},imOpenHistory:function(e){BXIM.openHistory(e.dialogId)},openApplication:function(e,t){if(this.expandPopup&&this.expandPopup.isShown()){return}if(!!this.expandPopup){this.expandPopup.destroy();this.expandPopup=null}this.expandPopup=new BX.PopupWindow("rest_app_"+this.params.appSid,null,{closeByEsc:false,closeIcon:true,titleBar:BX.message("JS_CORE_LOADING"),events:{onPopupClose:function(){BX.rest.AppLayout.get("DEFAULT").destroy();t()}},overlay:{opacity:50}});this.expandPopupContent=BX.create("DIV",{props:{className:"app-expand-popup"},html:'<div class="app-loading-popup"></div>'});this.expandPopup.setContent(this.expandPopupContent);this.expandPopup.show();BX.ajax.post(BX.message("REST_APPLICATION_URL").replace("#id#",parseInt(this.params.id)),{sessid:BX.bitrix_sessid(),popup:1,param:e,parentsid:this.params.appSid},BX.delegate(function(e){this.expandPopupContent.innerHTML=e;BX.bind(window,"resize",BX.proxy(this.adjustPopup,this));this.adjustPopup()},this))},closeApplication:function(e,t){if(!!this.expandPopup){this.expandPopup.close()}}};BX.rest.AppLayout.MessageInterfacePlacement=BX.rest.AppLayout.initizalizePlacementInterface(BX.rest.AppLayout.MessageInterface);BX.rest.AppLayout.MessageInterfacePlacement.prototype.placementBindEvent=function(e,t){if(!!e.event&&BX.util.in_array(e.event,this.messageInterface.events)){var s=BX.delegate(function(){if(!this._destroyed){t.apply(this,arguments)}else{BX.removeCustomEvent(e.event,s)}},this);BX.addCustomEvent(e.event,s)}};BX.rest.layoutList={};BX.rest.placementList={};BX.rest.AppLayout.placementInterface={};BX.rest.AppLayout.get=function(e){return BX.rest.layoutList[e]};BX.rest.AppLayout.set=function(e,t,s){e=(e+"").toUpperCase();s.appSid=t;s.placement=e;BX.rest.layoutList[t]=new BX.rest.AppLayout(s);return BX.rest.layoutList[t]};BX.rest.AppLayout.getPlacement=function(e){return BX.rest.placementList[(e+"").toUpperCase()]};BX.rest.AppLayout.setPlacement=function(e,t){BX.rest.placementList[(e+"").toUpperCase()]=t};BX.rest.AppLayout.initialize=function(e,t){e=(e+"").toUpperCase();BX.rest.layoutList[e]=BX.rest.layoutList[t];BX.rest.layoutList[e].init()};BX.rest.AppLayout.destroy=function(e){var t=BX.rest.AppLayout.get(e);if(!!t){t.destroy()}BX.rest.layoutList[t.params.appSid]=null;if(!!BX.rest.AppLayout.placementInterface[e]){BX.rest.layoutList[e]=null}};function e(e,t){var s=e.split(t);return[s[0],s.slice(1,s.length-2).join(t),s[s.length-2],s[s.length-1]]}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:49:"/bitrix/js/rest/marketplace.min.js?15113165413936";s:6:"source";s:30:"/bitrix/js/rest/marketplace.js";s:3:"min";s:34:"/bitrix/js/rest/marketplace.min.js";s:3:"map";s:34:"/bitrix/js/rest/marketplace.map.js";}"*/
BX.namespace("BX.rest.Marketplace");BX.rest.Marketplace=function(){var e="/bitrix/tools/rest.php";var t=function(t,n,o){n.action=t;n.sessid=BX.bitrix_sessid();BX.ajax({dataType:"json",method:"POST",url:e,data:n,onsuccess:o,onfailure:function(e,t){o({error:e+(!!t?": "+t:"")})}})};return{install:function(e){e=e||{url:location.href};var n=false;var o=BX.PopupWindowManager.create("BXAppInstallPopup",null,{autoHide:false,zIndex:0,offsetLeft:0,offsetTop:0,overlay:true,draggable:{restrict:true},closeByEsc:true,closeIcon:{right:"12px",top:"10px"},buttons:[button=new BX.PopupWindowButton({text:BX.message("REST_MP_APP_INSTALL"),className:"popup-window-button-accept",events:{click:function(){if(!n){return}if(BX("mp_detail_license")&&!BX("mp_detail_license").checked||BX("mp_detail_confidentiality")&&!BX("mp_detail_confidentiality").checked){BX("mp_detail_error").innerHTML=BX.message("MARKETPLACE_LICENSE_ERROR");return}if(BX.hasClass(button.buttonNode,"popup-window-button-wait")){return}var o=document.forms["left-menu-preset-form"];BX.addClass(button.buttonNode,"popup-window-button-wait");var i={code:e.CODE};if(!!e.VERSION){i.version=e.VERSION}if(!!e.CHECK_HASH){i.check_hash=e.CHECK_HASH;i.install_hash=e.INSTALL_HASH}t("install",i,BX.delegate(function(e){if(!!e.error){BX("mp_error").innerHTML=e.error+(!!e.error_description?"<br /><br />"+e.error_description:"");BX.show(BX("mp_error"))}else if(!!e.redirect){top.location.href=e.redirect}else{top.location.href=BX.util.remove_url_param(top.location.href,["install"])}},this))}}}),new BX.PopupWindowButtonLink({text:BX.message("REST_MP_APP_INSTALL_CANCEL"),className:"popup-window-button-link-cancel",events:{click:function(){this.popupWindow.close()}}})],content:'<div style="width:450px;height:230px; background: url(/bitrix/js/rest/images/loader.gif) no-repeat center;"></div>',events:{onAfterPopupShow:function(){BX.ajax.post(e.url||location.href,{install:1,sessid:BX.bitrix_sessid()},BX.delegate(function(e){n=true;this.setContent(e);BX.defer(this.adjustPosition,this)()},this))}}});o.show()},uninstallConfirm:function(e){var t=BX.PopupWindowManager.create("mp_delete_confirm_popup",null,{content:'<div class="mp_delete_confirm"><div class="mp_delete_confirm_text">'+BX.message("REST_MP_DELETE_CONFIRM")+'</div><div class="mp_delete_confirm_cb"><input type="checkbox" name="delete_data" id="delete_data">&nbsp;<label for="delete_data">'+BX.message("REST_MP_DELETE_CONFIRM_CLEAN")+"</label></div></div>",closeByEsc:true,closeIcon:{top:"1px",right:"10px"},buttons:[new BX.PopupWindowButton({text:BX.message("REST_MP_APP_DELETE"),className:"popup-window-button-decline",events:{click:function(){BX.rest.Marketplace.uninstall(e,BX("delete_data").checked,BX.delegate(this.popupWindow.close,this.popupWindow))}}}),new BX.PopupWindowButtonLink({text:BX.message("JS_CORE_WINDOW_CANCEL"),className:"popup-window-button-link-cancel",events:{click:function(){this.popupWindow.close()}}})]});t.show()},uninstall:function(e,n,o){t("uninstall",{code:e,clean:n},function(e){if(!!e.error){alert(e.error)}else{BX.reload()}if(!!o){o()}})},reinstall:function(e,n){t("reinstall",{id:e},function(e){if(!!e.error){alert(e.error)}else if(!!e.redirect){BX.reload(e.redirect)}else{alert(BX.message("REST_MP_APP_REINSTALLED"))}if(!!n){n()}})},buy:function(e,t){var n=[];for(var o=0;o<t.length;o++){n.push({text:t[o].TEXT,href:t[o].LINK,className:"menu-popup-no-icon"})}BX.PopupMenu.show("user-menu",e,n,{offsetTop:9,offsetLeft:43,angle:true})},setRights:function(e,n){BX.Access.Init({other:{disabled:false,disabled_g2:true,disabled_cr:true},groups:{disabled:true},socnetgroups:{disabled:true}});var o={app_id:e};if(!!n){o.site_id=n}t("get_app_rigths",o,function(o){BX.Access.SetSelected(o,"bind");BX.Access.ShowForm({bind:"bind",showSelected:true,callback:function(o){var i={app_id:e,rights:o};if(!!n){i.site_id=n}t("set_app_rights",i,function(e){})}})})}}}();
/* End */
;
//# sourceMappingURL=kernel_rest.map.js