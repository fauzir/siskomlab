
; /* Start:"a:4:{s:4:"full";s:93:"/bitrix/components/bitrix/socialnetwork.admin.set/templates/.default/script.js?15113165822527";s:6:"source";s:78:"/bitrix/components/bitrix/socialnetwork.admin.set/templates/.default/script.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
var waitDiv = null;
var waitPopup = null;
var waitTimeout = null;
var waitTime = 500;

function __SASSetAdmin()
{
	__SASShowWait();
	BX.ajax({
		url: '/bitrix/components/bitrix/socialnetwork.admin.set/ajax.php',
		method: 'POST',
		dataType: 'json',
		data: {'ACTION': 'SET', 'sessid': BX.bitrix_sessid(), 'site': BX.util.urlencode(BX.message('SASSiteId'))},
		onsuccess: function(data) { __SASProcessAJAXResponse(data); }
	});
}

function __SASProcessAJAXResponse(data)
{
	if (data["SUCCESS"] != "undefined" && data["SUCCESS"] == "Y")
	{
		BX.reload();
		return false;
	}
	else if (data["ERROR"] != "undefined" && data["ERROR"].length > 0)
	{
		if (data["ERROR"].indexOf("SESSION_ERROR", 0) === 0)
		{
			__SASShowError(BX.message('SASErrorSessionWrong'));
			BX.reload();
		}
		else if (data["ERROR"].indexOf("CURRENT_USER_NOT_ADMIN", 0) === 0)
		{
			__SASShowError(BX.message('SASErrorNotAdmin'));
			return false;
		}
		else if (data["ERROR"].indexOf("CURRENT_USER_NOT_AUTH", 0) === 0)
		{
			__SASShowError(BX.message('SASErrorCurrentUserNotAuthorized'));
			return false;
		}
		else if (data["ERROR"].indexOf("SONET_MODULE_NOT_INSTALLED", 0) === 0)
		{
			__SASShowError(BX.message('SASErrorModuleNotInstalled'));
			return false;
		}
		else
		{
			__SASShowError(data["ERROR"]);
			return false;		
		}
	}
}
				
function __SASShowError(errorText) 
{
	__SASCloseWait();

	var errorPopup = new BX.PopupWindow('sas-error' + Math.random(), window, {
		autoHide: true,
		lightShadow: false,
		zIndex: 2,
		content: BX.create('DIV', {props: {'className': 'sonet-adminset-error-text-block'}, html: errorText}),
		closeByEsc: true,
		closeIcon: true
	});
	errorPopup.show();

}

function __SASShowWait(timeout)
{
	if (timeout !== 0)
	{
		return (waitTimeout = setTimeout(function(){
			__SASShowWait(0)
		}, 50));
	}

	if (!waitPopup)
	{
		waitPopup = new BX.PopupWindow('sas_wait', window, {
			autoHide: true,
			lightShadow: true,
			zIndex: 2,
			content: BX.create('DIV', {
				props: {
					className: 'sonet-adminset-wait-cont'
				},
				children: [
					BX.create('DIV', {
						props: {
							className: 'sonet-adminset-wait-icon'
						}
					}),
					BX.create('DIV', {
						props: {
							className: 'sonet-adminset-wait-text'
						},
						html: BX.message('SASWaitTitle')
					})
				]
			})
		});
	}
	else
		waitPopup.setBindElement(window);

	waitPopup.show();
}

function __SASCloseWait()
{
	if (waitTimeout)
	{
		clearTimeout(waitTimeout);
		waitTimeout = null;
	}

	if (waitPopup)
		waitPopup.close();
}
/* End */
;
; /* Start:"a:4:{s:4:"full";s:87:"/bitrix/components/bitrix/tasks.iframe.popup/templates/wrap/logic.min.js?15113165981319";s:6:"source";s:68:"/bitrix/components/bitrix/tasks.iframe.popup/templates/wrap/logic.js";s:3:"min";s:72:"/bitrix/components/bitrix/tasks.iframe.popup/templates/wrap/logic.min.js";s:3:"map";s:72:"/bitrix/components/bitrix/tasks.iframe.popup/templates/wrap/logic.map.js";}"*/
"use strict";BX.namespace("Tasks.Component");(function(){if(typeof BX.Tasks.Component.IframePopup!="undefined"){return}BX.Tasks.Component.IframePopup={};BX.Tasks.Component.IframePopup.SideSlider=BX.Tasks.Component.extend({sys:{code:"iframe-popup-side-slider"},methods:{bindEvents:function(){BX.addCustomEvent(window,"tasksTaskEvent",this.onTaskGlobalEvent.bind(this));BX.bindDelegate(this.scope(),"click",{className:"js-id-copy-page-url"},this.onCopyUrl.bind(this))},onCopyUrl:function(o){o=o||window.event;this.onCopyUrlByNode(o.target,this.getWindowHref())},onCopyUrlByNode:function(o,e){this.timeoutIds=this.timeoutIds||[];if(!BX.clipboard.copy(e)){return}var t={content:BX.message("TASKS_TIP_TEMPLATE_LINK_COPIED"),darkMode:true,autoHide:true,zIndex:1e3,angle:true,offsetLeft:20,bindOptions:{position:"top"}};var n=new BX.PopupWindow("tasks_clipboard_copy",o,t);n.show();var i;while(i=this.timeoutIds.pop())clearTimeout(i);i=setTimeout(function(){n.close()},1500);this.timeoutIds.push(i)},getWindowHref:function(){return BX.util.remove_url_param(window.location.href,["IFRAME","IFRAME_TYPE"])},onTaskGlobalEvent:function(o,e){if(BX.type.isNotEmptyString(o)){e=e||{};if(!e.options.STAY_AT_PAGE){window.top.BX.onCustomEvent("BX.Bitrix24.PageSlider:close",[false])}}}}})}).call(this);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:79:"/bitrix/components/bitrix/tasks.task/templates/view/logic.min.js?15113165989454";s:6:"source";s:60:"/bitrix/components/bitrix/tasks.task/templates/view/logic.js";s:3:"min";s:64:"/bitrix/components/bitrix/tasks.task/templates/view/logic.min.js";s:3:"map";s:64:"/bitrix/components/bitrix/tasks.task/templates/view/logic.map.js";}"*/
"use strict";BX.namespace("Tasks.Component");(function(){if(typeof BX.Tasks.Component.TaskView!="undefined"){return}BX.Tasks.Component.TaskView=function(t){this.parameters=t||{};this.taskId=this.parameters.taskId;this.stageId=parseInt(this.parameters.stageId);this.stages=this.parameters.stages||{};this.layout={favorite:BX("task-detail-favorite"),switcher:BX("task-switcher"),switcherTabs:[],elapsedTime:BX("task-switcher-elapsed-time"),createButton:BX("task-detail-create-button"),importantButton:BX("task-detail-important-button"),stagesWrap:BX("tasksStagesWrap"),stages:BX("tasksStages")};this.messages=this.parameters.messages||{};for(var e in this.messages){BX.message[e]=this.messages[e]}this.paths=this.parameters.paths||{};this.createButtonMenu=[];this.query=new BX.Tasks.Util.Query;this.query.bindEvent("executed",BX.proxy(this.onQueryExecuted,this));BX.addCustomEvent(window,"tasksTaskEvent",this.onTaskEvent.bind(this));BX.addCustomEvent(window,"onChangeProjectLink",BX.delegate(this.onChangeProjectLink,this));this.initFavorite();this.initCreateButton();this.initSwitcher();this.initViewer();this.initAjaxErrorHandler();this.initImportantButton();this.initStages();this.fireTaskEvent();this.temporalCommentFix()};BX.Tasks.Component.TaskView.prototype.temporalCommentFix=function(){BX.addCustomEvent(window,"OnUCFormResponse",function(t,e,s){if(BX.type.isNotEmptyString(t)&&t.indexOf("TASK_")===0&&BX.proxy_context&&BX.proxy_context.jsonFailure===true){if(s&&s["handler"]&&s.handler["oEditor"]&&s.handler.oEditor["DenyBeforeUnloadHandler"]){s.handler.oEditor.DenyBeforeUnloadHandler()}BX.reload()}})};BX.Tasks.Component.TaskView.prototype.fireTaskEvent=function(){if(this.parameters.eventTaskUgly!=null){BX.Tasks.Util.fireGlobalTaskEvent(this.parameters.componentData.EVENT_TYPE,{ID:this.parameters.eventTaskUgly.id},{STAY_AT_PAGE:true},this.parameters.eventTaskUgly)}};BX.Tasks.Component.TaskView.prototype.initImportantButton=function(){if(this.parameters.can.TASK.ACTION.EDIT){BX.bind(this.layout.importantButton,"click",BX.Tasks.passCtx(this.onImportantButtonClick,this))}};BX.Tasks.Component.TaskView.prototype.initStages=function(){if(this.layout.stages&&this.stages){var t=this.parameters.can.TASK.ACTION.SORT;var e=this.stages.length>0;BX.cleanNode(this.layout.stages);for(var s=0,a=this.stages.length;s<a;s++){this.layout.stages.appendChild(BX.create("div",{props:{className:"task-section-status-step"},children:[BX.create("div",{props:{className:"task-section-status-step-item"},children:[this.stages[s].TEXT_LAYOUT=BX.create("div",{attrs:{"data-stageId":this.stages[s].ID},props:{className:"task-section-status-step-item-text"},text:this.stages[s].TITLE,events:t?{click:BX.delegate(this.setStageHadnler,this)}:null,style:!t?{cursor:"default"}:null})]})]}))}if(e){BX.show(this.layout.stagesWrap);if(this.stageId>0){this.setStage(this.stageId)}else{this.setStage(this.stages[0].ID)}}else{BX.hide(this.layout.stagesWrap)}}};BX.Tasks.Component.TaskView.prototype.onChangeProjectLink=function(t,e){t=parseInt(t);this.stageId=0;if(t===0){this.stages=[];this.initStages()}else{var s={entityId:t,entityType:"G"};this.query.run("task.stages.canmovetask",s).then(function(t){if(t.isSuccess()){this.parameters.can.TASK.ACTION.SORT=t.data===true}}.bind(this));var s={entityId:t,numeric:true};this.query.run("task.stages.get",s).then(function(t){if(t.isSuccess()){this.stages=t.data;this.initStages()}}.bind(this));this.query.execute()}};BX.Tasks.Component.TaskView.prototype.getStageData=function(t){t=parseInt(t);if(this.stages){for(var e in this.stages){if(parseInt(this.stages[e].ID)===t){return this.stages[e]}}}return null};BX.Tasks.Component.TaskView.prototype.setStageHadnler=function(){var t=BX.data(BX.proxy_context,"stageId");this.setStage(t);this.saveStage(t)};BX.Tasks.Component.TaskView.prototype.saveStage=function(t){t=parseInt(t);if(t===this.stageId){return}this.stageId=t;var e={id:this.taskId,stageId:t};this.query.run("task.stages.movetask",e).then(function(t){if(t.isSuccess()){BX.Tasks.Util.fireGlobalTaskEvent("UPDATE_STAGE",{ID:e.id,STAGE_ID:e.stageId},{STAY_AT_PAGE:true},{id:e.id})}}.bind(this));this.query.execute()};BX.Tasks.Component.TaskView.prototype.setStage=function(t){var e=this.getStageData(t);t=parseInt(t);if(this.stages&&e){var s="#"+e["COLOR"];var a=true;var i;for(var n=0,o=this.stages.length;n<o;n++){i=this.stages[n].TEXT_LAYOUT;if(a){i.style.color=this.calculateTextColor(s);i.style.backgroundColor=s;i.style.borderBottomColor=s}else{i.style.backgroundColor="";i.style.borderBottomColor="#"+this.stages[n].COLOR}if(parseInt(this.stages[n].ID)===t){a=false}}}};BX.Tasks.Component.TaskView.prototype.calculateTextColor=function(t){var e=["00c4fb","47d1e2","75d900","ffab00","ff5752","468ee5","1eae43"];var s,a,i;if(BX.util.in_array(t.toLowerCase(),e)){return"#fff"}else{var n=t.split("");if(n.length==3){n=[n[0],n[0],n[1],n[1],n[2],n[2]]}n="0x"+n.join("");s=n>>16&255;a=n>>8&255;i=n&255}var o=.21*s+.72*a+.07*i;return o<145?"#fff":"#333"};BX.Tasks.Component.TaskView.prototype.initCreateButton=function(){BX.bind(this.layout.createButton,"click",this.onCreateButtonClick.bind(this));var t=this.paths;var e=this;this.createButtonMenu=[{text:this.messages.addTask,className:"menu-popup-item menu-popup-no-icon",href:this.paths.newTask},{text:this.messages.addTaskByTemplate,className:"menu-popup-item menu-popup-no-icon menu-popup-item-submenu",events:{onSubMenuShow:function(){if(this.subMenuLoaded){return}var s=new BX.Tasks.Util.Query({autoExec:true});var a=this.getSubMenu();a.removeMenuItem("loading");s.add("task.template.find",{parameters:{select:["ID","TITLE"]}},{},BX.delegate(function(s,a){this.subMenuLoaded=true;if(!s.checkHasErrors()){var i=t.newTask+(t.newTask.indexOf("?")!==-1?"&":"?")+"TEMPLATE=";var n=[];if(a.RESULT.DATA.length>0){BX.Tasks.each(a.RESULT.DATA,function(t,e){n.push({text:BX.util.htmlspecialchars(t.TITLE),href:i+t.ID})}.bind(this))}else{n.push({text:e.messages.tasksAjaxEmpty})}this.addSubMenu(n);this.showSubMenu()}else{this.addSubMenu([{text:e.messages.tasksAjaxErrorLoad}]);this.showSubMenu()}},this))}},items:[{id:"loading",text:"TASKS_AJAX_LOAD_TEMPLATES"}]},{delimiter:true},{text:this.messages.addSubTask,className:"menu-popup-item menu-popup-no-icon",href:this.paths.newSubTask},{delimiter:true},{text:this.messages.listTaskTemplates,className:"menu-popup-item menu-popup-no-icon",href:this.paths.taskTemplates}]};BX.Tasks.Component.TaskView.prototype.onImportantButtonClick=function(t){var e=BX.data(t,"priority");var s=e==2?1:2;this.query.run("task.update",{id:this.parameters.taskId,data:{PRIORITY:s}}).then(function(e){if(e.isSuccess()){BX.data(t,"priority",s);BX.toggleClass(t,"no")}}.bind(this));this.query.execute()};BX.Tasks.Component.TaskView.prototype.onCreateButtonClick=function(){BX.PopupMenu.show("task-detail-create-button",this.layout.createButton,this.createButtonMenu,{angle:{position:"top",offset:40}})};BX.Tasks.Component.TaskView.prototype.onTaskEvent=function(t,e){e=e||{};var s=e.task||{};if(t=="UPDATE"&&s.ID==this.parameters.taskId){if(BX.type.isNotEmptyString(s.REAL_STATUS)){this.setStatus(s.REAL_STATUS)}}};BX.Tasks.Component.TaskView.prototype.setStatus=function(t){var e=BX("task-detail-status-below-name");if(e){var s=BX.message("TASKS_STATUS_"+t);e.innerHTML=s.substr(0,1).toLowerCase()+s.substr(1)}};BX.Tasks.Component.TaskView.prototype.initFavorite=function(){BX.bind(this.layout.favorite,"click",BX.proxy(this.onFavoriteClick,this))};BX.Tasks.Component.TaskView.prototype.onFavoriteClick=function(){var t=BX.hasClass(this.layout.favorite,"task-detail-favorite-active")?"task.favorite.delete":"task.favorite.add";this.query.deleteAll();this.query.add(t,{taskId:this.taskId},{code:t});this.query.execute();BX.toggleClass(this.layout.favorite,"task-detail-favorite-active")};BX.Tasks.Component.TaskView.prototype.initSwitcher=function(){if(!this.layout.switcher){return}var t=this.layout.switcher.getElementsByClassName("task-switcher");var e=this.layout.switcher.parentNode.getElementsByClassName("task-switcher-block");for(var s=0;s<t.length;s++){var a=t[s];var i=e[s];BX.bind(a,"click",BX.proxy(this.onSwitch,this));this.layout.switcherTabs.push({title:a,block:i})}BX.addCustomEvent("TaskElapsedTimeUpdated",BX.proxy(function(t,e,s,a){this.layout.elapsedTime.innerText=BX.Tasks.Util.formatTimeAmount(a.time)},this))};BX.Tasks.Component.TaskView.prototype.onSwitch=function(){var t=BX.proxy_context;if(BX.hasClass(t,"task-switcher-selected")){return false}for(var e=0;e<this.layout.switcherTabs.length;e++){var s=this.layout.switcherTabs[e].title;var a=this.layout.switcherTabs[e].block;if(s===t){BX.addClass(s,"task-switcher-selected");BX.addClass(a,"task-switcher-block-selected")}else{BX.removeClass(s,"task-switcher-selected");BX.removeClass(a,"task-switcher-block-selected")}}return false};BX.Tasks.Component.TaskView.prototype.onQueryExecuted=function(t){};BX.Tasks.Component.TaskView.prototype.initViewer=function(){var t=["task-detail-description","task-detail-files","task-comments-block","task-files-block"];for(var e=0;e<t.length;e++){var s=BX(t[e]);if(s){top.BX.viewElementBind(s,{},function(t){return BX.type.isElementNode(t)&&(t.getAttribute("data-bx-viewer")||t.getAttribute("data-bx-image"))})}}};BX.Tasks.Component.TaskView.prototype.initAjaxErrorHandler=function(){BX.addCustomEvent("TaskAjaxError",function(t){BX.Tasks.alert(t).then(function(){BX.reload()})})}}).call(this);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:94:"/bitrix/components/bitrix/tasks.list.controls/templates/.default/script.min.js?151131659816636";s:6:"source";s:74:"/bitrix/components/bitrix/tasks.list.controls/templates/.default/script.js";s:3:"min";s:78:"/bitrix/components/bitrix/tasks.list.controls/templates/.default/script.min.js";s:3:"map";s:78:"/bitrix/components/bitrix/tasks.list.controls/templates/.default/script.map.js";}"*/
BX.namespace("BX.Tasks");(function(){if(BX.Tasks.ListControlsNS)return;BX.Tasks.ListControlsNS={ready:false,params:{appendUrlParams:{SW_FF:"FOR"}},init:function(){this.ready=true},menu:{menus:{},create:function(t){this.menus[t]={items:[]}},show:function(t,e,s){if(!self.ready)return;if(!this.menus[t])return;if(!this.menus[t].items.length)return;if(typeof s=="undefined")s={};var i=BX.pos(e);var a=BX.clone(this.menus[t].items);var o=[];if(s.useAppendParams){for(var r in self.params.appendUrlParams){o.push(r+"="+self.params.appendUrlParams[r])}for(var n=0;n<a.length;n++){if(typeof a[n].href=="undefined"){a[n].href=""}a[n].href=BX.util.add_url_param(a[n].href,self.params.appendUrlParams)}}BX.PopupMenu.show("task-top-panel-menu"+t+o.join("_"),e,a,{autoHide:true,offsetTop:4,events:{onPopupClose:function(t){}}})},addItem:function(t,e,s,i){this.menus[t].items.push({text:e,className:s,href:i})},addDelimiter:function(t){this.menus[t].items.push({delimiter:true})}},createGanttHint:function(){var t=BX("gantt-hint");var e=BX("gantt-hint-close");if(BX.type.isElementNode(t)&&BX.type.isElementNode(e)){BX.bind(e,"click",function(){BX.remove(t);BX.userOptions.save("tasks","task_list","enable_gantt_hint","N",false)})}},createViewModeHint:function(){this.viewModeHint=BX.PopupWindowManager.create("view_mode_hint",BX("task-top-panel-view-mode-selector"),{offsetTop:-1,autoHide:true,closeByEsc:false,angle:{position:"bottom",offset:24},events:{onPopupClose:BX.delegate(this.onViewModeHintClose,this)},content:BX.create("DIV",{attrs:{className:"task-hint-popup-contents"},children:[BX.create("SPAN",{attrs:{className:"task-hint-popup-title"},text:BX.message("TASKS_PANEL_VM_HINT_TITLE")}),BX.create("P",{text:BX.message("TASKS_PANEL_VM_HINT_BODY")}),BX.create("P",{children:[BX.create("A",{props:{href:"javascript:void(0)"},text:BX.message("TASKS_PANEL_VM_HINT_DISABLE"),events:{click:BX.delegate(this.onViewModeDisableHint,this)}})]})]})});this.viewModeHint.show()},onViewModeDisableHint:function(t){if(this.viewModeHint){this.viewModeHint.close();BX.userOptions.save("tasks","task_list","enable_viewmode_hint","N",false)}return BX.PreventDefault(t)},onViewModeHintClose:function(){if(this.viewModeHint){this.viewModeHint.destroy();this.viewModeHint=null}}};var self=BX.Tasks.ListControlsNS;BX.Tasks.QuickForm=function(t,e){var s=BX(t);if(!s){throw"BX.Tasks.QuickForm: wrong container id"}this.parameters=e||{};this.layout={container:s,form:BX("task-new-item-form"),responsible:BX("task-new-item-responsible"),responsibleId:BX("task-new-item-responsible-id"),deadline:BX("task-new-item-deadline"),menu:BX("task-new-item-menu"),title:BX("task-new-item-title"),projectLink:BX("task-new-item-project-link"),projectClearing:BX("task-new-item-project-clearing"),projectId:BX("task-new-item-project-id"),descriptionBlock:BX("task-new-item-description-block"),descriptionLink:BX("task-new-item-description-link"),description:BX("task-new-item-description"),saveButton:BX("task-new-item-save"),cancelButton:BX("task-new-item-cancel")};this.messages=this.parameters.messages||{};this.canManageTask=this.parameters.canManageTask!==false;this.canAddMailUsers=this.parameters.canAddMailUsers===true;if(this.canManageTask){BX.bind(this.layout.title,"keypress",BX.proxy(this.fireEnterKey,this));BX.bind(this.layout.menu,"click",BX.proxy(this.show,this));BX.bind(this.layout.cancelButton,"click",BX.proxy(this.hide,this));BX.bind(this.layout.saveButton,"click",BX.proxy(this.submit,this));BX.bind(this.layout.descriptionLink,"click",BX.proxy(this.toggleDescription,this));BX.bind(this.layout.deadline,"click",BX.proxy(this.calendar,this));BX.bind(this.layout.deadline,"focus",BX.proxy(this.calendar,this))}else{this.disable()}this.query=new BX.Tasks.Util.Query({url:"/bitrix/components/bitrix/tasks.task.list/ajax.php"});this.query.bindEvent("executed",BX.proxy(this.onQueryExecuted,this));this.operation="taskQuickAdd";this.errorPopup=null;this.notification=new BX.Tasks.QuickForm.Notification(this);this.projectSelector=new BX.Tasks.QuickForm.ProjectSelector("task-new-item-project-selector",this);this.userSelector=new BX.Tasks.QuickForm.UserSelector("task-new-item-user-selector",this)};BX.Tasks.QuickForm.prototype.submit=function(){var t=this.layout.title.value;if(BX.util.trim(t).length===0){return false}var e={title:t,deadline:this.layout.deadline.value,description:this.layout.description.value,columnsOrder:window.tasksListNS&&tasksListNS.getColumnsOrder?tasksListNS.getColumnsOrder():null,project:this.layout.projectId.value,pathToUser:BX.message("TASKS_PATH_TO_USER_PROFILE"),pathToTask:BX.message("TASKS_PATH_TO_TASK"),siteId:BX.message("SITE_ID"),nameTemplate:this.parameters.nameTemplate,filter:this.parameters.filter,order:this.parameters.order,navigation:this.parameters.navigation,select:this.parameters.select,ganttMode:this.parameters.ganttMode};var s=this.userSelector.getUserId();var i=this.userSelector.getUserEmail();if(s>0){e.responsibleId=s}else if(this.canAddMailUsers&&i.length){e.userEmail=i;e.userName=this.userSelector.getUserName();e.userLastName=this.userSelector.getUserLastName()}this.disable();this.query.deleteAll();this.query.add("ui.listcontrols.add",{data:e,parameters:{}},{code:this.operation});this.query.execute()};BX.Tasks.QuickForm.prototype.onQueryExecuted=function(result){if(!result.success){return this.showError(result.clientProcessErrors,result.serverProcessErrors)}else if(!result.data[this.operation]){return this.showError("Could not process this operation.")}else if(!result.data[this.operation].SUCCESS){return this.showError(result.data[this.operation].ERRORS)}var data=result.data[this.operation].RESULT;var taskId=data["taskId"];var found=data.position&&data.position.found===true;if(found){if(data.task){var task=null;try{eval("result = "+data.task);task=result}catch(e){}this.insertIntoGantt(task,data.position)}else if(data.html){this.insertIntoList(data.html,data.position)}this.highlight(taskId,false)}var title=data["taskRaw"]&&data["taskRaw"]["TITLE"]?data["taskRaw"]["TITLE"]:"";var path=data["taskPath"];this.notification.show(taskId,title,path,found);this.enable();this.clear();this.focus()};BX.Tasks.QuickForm.prototype.insertIntoGantt=function(t,e){if(!window.ganttChart||!t){return}BX.onCustomEvent("onTaskListTaskAdd",[t]);if(t.projectId&&!ganttChart.getProjectById(t.projectId)){ganttChart.addProjectFromJSON({id:t.projectId,name:t.projectName,opened:true,canCreateTasks:t.projectCanCreateTasks,canEditTasks:t.projectCanEditTasks})}var s=ganttChart.addTaskFromJSON(t);if(s.parentTaskId){var i=ganttChart.getTaskById(s.parentTaskId);if(i){i.expand()}}var a=ganttChart.getTaskById(e.nextTaskId);var o=ganttChart.getTaskById(e.prevTaskId);if(a&&a.projectId===s.projectId){ganttChart.moveTask(s.id,a.id)}else if(o&&o.projectId===s.projectId){ganttChart.moveTask(s.id,o.id,true)}};BX.Tasks.QuickForm.prototype.insertIntoList=function(t,e){var s=document.createElement("div");s.innerHTML="<table>"+t+"</table>";var i=s.firstChild.getElementsByTagName("tr");var a=s.firstChild.getElementsByTagName("script");var o=BX.create("script",{props:{type:"text/javascript"},html:a[0].innerHTML});var r=i[0];var n=BX("task-list-table-body");var l=this.projectSelector.projectId;if(l&&!BX("task-project-"+l)){var u=__CreateProjectRow({id:l,title:BX.util.htmlspecialcharsback(this.projectSelector.projectName)});var c=this.getNextProject(n,l);if(c!==null){n.insertBefore(u,c)}else{n.appendChild(u)}}var p=BX("task-"+e.nextTaskId);var h=BX("task-"+e.prevTaskId);var d=p?parseInt(p.getAttribute("data-project-id"),10):null;var m=h?parseInt(h.getAttribute("data-project-id"),10):null;if(p&&d===l){n.insertBefore(r,p);n.insertBefore(o,p)}else if(h&&m===l){var f=BX.findNextSibling(h,{tagName:"tr",className:"task-depth-0"});if(f){n.insertBefore(r,f);n.insertBefore(o,f)}else{n.appendChild(r);n.appendChild(o)}}else{c=this.getNextProject(n,l);if(c){n.insertBefore(r,c);n.insertBefore(o,c)}else{n.appendChild(r);n.appendChild(o)}}var k=BX("task-list-no-tasks");if(k){k.style.display="none"}};BX.Tasks.QuickForm.prototype.getNextProject=function(t,e){var s=BX.findChildrenByClassName(t,"task-list-project-item");if(!e&&s.length){return s[0]}var i=null;for(var a=0;a<s.length;a++){if(parseInt(s[a].getAttribute("data-project-id"),10)>e){i=s[a];break}}return i};BX.Tasks.QuickForm.prototype.showError=function(){if(this.errorPopup===null){this.errorPopup=new BX.PopupWindow(this.operation,null,{lightShadow:true,buttons:[new BX.PopupWindowButton({text:BX.message("JS_CORE_WINDOW_CLOSE"),className:"",events:{click:BX.proxy(this.onPopupErrorClose,this)}})]})}var t=[];for(var e=0;e<arguments.length;e++){var s=arguments[e];if(BX.type.isArray(s)){t=BX.util.array_merge(t,s)}else if(BX.type.isString(s)){t.push(s)}}var i="";for(e=0;e<t.length;e++){i+=(typeof t[e].MESSAGE!=="undefined"?t[e].MESSAGE:t[e])+"<br>"}this.errorPopup.setContent("<div class='task-new-item-error-popup'>"+i+"</div>");this.errorPopup.show()};BX.Tasks.QuickForm.prototype.onPopupErrorClose=function(){this.errorPopup.close();this.enable();this.clear();this.focus()};BX.Tasks.QuickForm.prototype.calendar=function(t){BX.PreventDefault(t);var e=this.layout.deadline;BX.calendar({node:e,field:e.name,bTime:true,bSetFocus:false,value:BX.CJSTask.ui.getInputDateTimeValue(e),bHideTimebar:false,callback_after:function(){var t=BX.CJSTask.ui.extractDefaultTimeFromDataAttribute(e);e.value=BX.CJSTask.addTimeToDateTime(e.value,t)}});BX.SocNetLogDestination.closeDialog()};BX.Tasks.QuickForm.prototype.show=function(){BX.addClass(this.layout.container,"task-top-panel-righttop-open");this.focus()};BX.Tasks.QuickForm.prototype.hide=function(){BX.removeClass(this.layout.container,"task-top-panel-righttop-open");this.focus()};BX.Tasks.QuickForm.prototype.toggleDescription=function(t){BX.toggleClass(this.layout.descriptionBlock,"task-top-panel-leftmiddle-open");if(BX.hasClass(this.layout.descriptionBlock,"task-top-panel-leftmiddle-open")){this.layout.description.focus()}else{this.focus()}BX.PreventDefault(t)};BX.Tasks.QuickForm.prototype.fireEnterKey=function(t){t=t||window.event;if(t.keyCode===13){this.submit();BX.PreventDefault(t)}};BX.Tasks.QuickForm.prototype.disable=function(){this.layout.title.disabled=true;this.layout.deadline.disabled=true;this.layout.responsible.disabled=true;this.layout.description.disabled=true;BX.addClass(this.layout.saveButton,"webform-small-button-wait webform-button-disable")};BX.Tasks.QuickForm.prototype.enable=function(){this.layout.title.disabled=false;this.layout.deadline.disabled=false;this.layout.responsible.disabled=false;this.layout.description.disabled=false;BX.removeClass(this.layout.saveButton,"webform-small-button-wait webform-button-disable")};BX.Tasks.QuickForm.prototype.clear=function(){this.layout.title.value="";this.layout.deadline.value="";this.layout.description.value=""};BX.Tasks.QuickForm.prototype.focus=function(){this.layout.title.focus()};BX.Tasks.QuickForm.prototype.highlight=function(t,e){if(window.ganttChart){var s=ganttChart.getTaskById(t);if(s){s.highlight();if(e===true){s.scrollIntoView(false)}}}else{var i=BX("task-"+t);if(i){BX.addClass(i,"task-list-item-highlighted");setTimeout(function(){BX.removeClass(i,"task-list-item-highlighted")},1e3);if(e===true){i.scrollIntoView(false)}}}};BX.Tasks.QuickForm.Notification=function(t){this.form=t;this.taskId=0;this.layout={block:BX("task-new-item-notification"),message:BX("task-new-item-message"),openLink:BX("task-new-item-open"),highlightLink:BX("task-new-item-highlight"),hideLink:BX("task-new-item-notification-hide")};BX.bind(this.layout.hideLink,"click",BX.proxy(this.hide,this));BX.bind(this.layout.highlightLink,"click",BX.proxy(this.highlight,this))};BX.Tasks.QuickForm.Notification.prototype.show=function(t,e,s,i){this.taskId=t;this.layout.message.innerHTML=e;this.layout.openLink.href=s;if(i){this.layout.highlightLink.style.display="inline"}else{this.layout.highlightLink.style.display="none"}BX.addClass(this.layout.block,"task-top-notification-active")};BX.Tasks.QuickForm.Notification.prototype.hide=function(){BX.removeClass(this.layout.block,"task-top-notification-active")};BX.Tasks.QuickForm.Notification.prototype.highlight=function(){this.form.highlight(this.taskId,true)};BX.Tasks.QuickForm.ProjectSelector=function(t,e){this.id=t;this.form=e;this.projectName=this.form.layout.projectLink.innerHTML;this.projectId=parseInt(this.form.layout.projectId.value,10);var s=this.form.parameters.destination||{};BX.SocNetLogDestination.init({name:t,searchInput:null,departmentSelectDisable:true,bindMainPopup:{node:this.form.layout.projectLink},bindSearchPopup:{node:this.form.layout.projectLink},callback:{select:BX.proxy(this.onSelect,this)},items:{users:{},groups:{},department:{},departmentRelation:{},sonetgroups:s["SONETGROUPS"]||{}},itemsLast:{users:{},groups:{},department:{},sonetgroups:s["LAST"]["SONETGROUPS"]||{}},itemsSelected:{}});BX.bind(this.form.layout.projectLink,"click",BX.proxy(this.openDialog,this));BX.bind(this.form.layout.projectClearing,"click",BX.proxy(this.clearProject,this))};BX.Tasks.QuickForm.ProjectSelector.prototype.openDialog=function(){if(!BX.SocNetLogDestination.isOpenDialog()){BX.SocNetLogDestination.openDialog(this.id)}BX.PreventDefault(event)};BX.Tasks.QuickForm.ProjectSelector.prototype.onSelect=function(t){this.projectId=parseInt(t.entityId,10);this.projectName=t.name;this.form.layout.projectId.value=this.projectId;this.form.layout.projectLink.innerHTML=this.projectName;BX.addClass(this.form.layout.projectClearing,"task-top-panel-tab-close-active");BX.SocNetLogDestination.deleteLastItem(this.id);BX.SocNetLogDestination.closeDialog()};BX.Tasks.QuickForm.ProjectSelector.prototype.clearProject=function(){this.form.layout.projectLink.innerHTML=this.form.messages.taskInProject;this.form.layout.projectId.value=0;this.projectId=0;this.projectName="";BX.removeClass(this.form.layout.projectClearing,"task-top-panel-tab-close-active");BX.SocNetLogDestination.closeDialog()};BX.Tasks.QuickForm.UserSelector=function(t,e){this.id=t;this.form=e;this.userId=this.form.layout.responsibleId.value;this.userNameFormatted=this.form.layout.responsible.value;this.userEmail="";this.userName="";this.userLastName="";var s=this.form.parameters.destination||{};BX.SocNetLogDestination.init({name:t,searchInput:this.form.layout.responsible,departmentSelectDisable:true,bindMainPopup:{node:this.form.layout.responsible},bindSearchPopup:{node:this.form.layout.responsible},allowAddUser:this.form.canAddMailUsers,callback:{select:BX.proxy(this.onSelect,this)},items:{users:s["USERS"],department:s["DEPARTMENT"]||{},departmentRelation:s["DEPARTMENT_RELATION"]||{}},itemsLast:{users:s["LAST"]["USERS"]},itemsSelected:s["SELECTED"]||{}});BX.bind(this.form.layout.responsible,"focus",BX.proxy(this.openDialog,this));BX.bind(this.form.layout.responsible,"click",BX.proxy(this.openDialog,this));BX.bind(this.form.layout.responsible,"blur",BX.proxy(this.onBlur,this));var i={formName:this.id,inputName:this.form.layout.responsible.getAttribute("id")};BX.bind(this.form.layout.responsible,"keyup",BX.proxy(BX.SocNetLogDestination.BXfpSearch,i));BX.bind(this.form.layout.responsible,"keydown",BX.proxy(BX.SocNetLogDestination.BXfpSearchBefore,i))};BX.Tasks.QuickForm.UserSelector.prototype.getUserId=function(){return this.userId};BX.Tasks.QuickForm.UserSelector.prototype.getUserEmail=function(){return this.userEmail};BX.Tasks.QuickForm.UserSelector.prototype.getUserName=function(){return this.userName};BX.Tasks.QuickForm.UserSelector.prototype.getUserLastName=function(){return this.userLastName};BX.Tasks.QuickForm.UserSelector.prototype.openDialog=function(t){BX.calendar.get().Close();BX.PreventDefault(t);this.form.layout.responsible.value="";if(!BX.SocNetLogDestination.isOpenDialog()){BX.SocNetLogDestination.openDialog(this.id)}};BX.Tasks.QuickForm.UserSelector.prototype.onSelect=function(t,e,s){this.userId=t.entityId||0;this.userNameFormatted=BX.util.htmlspecialcharsback(t.name);var i=t.params||{};this.userEmail=i.email||"";this.userName=i.name||"";this.userLastName=i.lastName||"";this.form.layout.responsible.value=this.userNameFormatted;this.form.layout.responsibleId.value=this.userId;BX.SocNetLogDestination.deleteLastItem(this.id);BX.SocNetLogDestination.closeDialog()};BX.Tasks.QuickForm.UserSelector.prototype.onBlur=function(){setTimeout(BX.proxy(function(){if(!BX.SocNetLogDestination.isOpenDialog()&&!BX.SocNetLogDestination.isOpenSearch()&&this.form.layout.responsible.value.length<=0){this.form.layout.responsible.value=this.userNameFormatted;this.form.layout.responsibleId.value=this.userId}},this),100)}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:96:"/bitrix/components/bitrix/tasks.widget.checklist/templates/.default/logic.min.js?151131659813899";s:6:"source";s:76:"/bitrix/components/bitrix/tasks.widget.checklist/templates/.default/logic.js";s:3:"min";s:80:"/bitrix/components/bitrix/tasks.widget.checklist/templates/.default/logic.min.js";s:3:"map";s:80:"/bitrix/components/bitrix/tasks.widget.checklist/templates/.default/logic.map.js";}"*/
"use strict";BX.namespace("Tasks.Component");(function(){if(typeof BX.Tasks.Component.TasksWidgetCheckList!="undefined"){return}BX.Tasks.Component.TasksWidgetCheckList=BX.Tasks.Component.extend({sys:{code:"checklist"},options:{confirmDelete:false},methods:{construct:function(){this.callConstruct(BX.Tasks.Component);this.getManager()},getManager:function(){return this.subInstance("manager",function(){var t=new this.constructor.ItemManager({scope:this.scope(),data:this.option("data"),preRendered:true,confirmDelete:this.option("confirmDelete"),enableSync:this.option("enableSync"),entityRoute:this.option("entityRoute"),entityId:this.option("entityId")});t.bindEvent("change",this.onManagerChange.bind(this));return t})},bindEvents:function(){this.bindControl("toggle-complete","click",this.onCompleteTogglerClick.bind(this))},onCompleteTogglerClick:function(){var t=this.control("is-items-complete");this.toggleCompleted(BX.hasClass(t,"invisible"))},onManagerChange:function(t){var e=0;var i=0;var n=1;var o=1;this.getManager().each(function(t){if(!t.isSeparator()){if(t.isChecked()){i++}e++;t.data().NUMBER=o++}t.data().SORT=t.data().SORT_INDEX=n++;t.sort(t.data().NUMBER)});this.control("total-counter").innerHTML=e;BX.Tasks.each(this.controlAll("complete-counter"),function(t){t.innerHTML=i});this.showHideCompleted(!i);if(!i){this.toggleCompleted(false)}BX[i?"removeClass":"addClass"](this.control("top-counter-set"),"invisible")},showHideCompleted:function(t){this.changeCSSFlag("hidden",t,this.control("complete-block"))},toggleCompleted:function(t){var e=this.control("is-items-complete");BX.Tasks.Util.fadeSlideToggleByClass(e);this.changeCSSFlag("down",t,this.control("toggle-complete"))},count:function(){return this.getManager().count()},openForm:function(){this.getManager().openAddForm()}}});BX.Tasks.Component.TasksWidgetCheckList.ItemManager=BX.Tasks.Util.ItemSet.extend({sys:{code:"checklist-is"},options:{controlBind:"class",itemFx:"vertical",confirmDelete:false,useDragNDrop:true,enableSync:false},methods:{bindEvents:function(){this.callMethod(BX.Tasks.Util.ItemSet,"bindEvents");this.bindControl("add-separator","click",this.onAddSeparatorClick.bind(this));this.vars.formInitialized=false},bindItemActions:function(){this.callMethod(BX.Tasks.Util.ItemSet,"bindItemActions");this.bindOnItemEx("i-toggle","click",this.onItemToggleClick);this.bindOnItemEx("i-toggle","change",this.onItemToggleChange);this.bindOnItemEx("i-edit","click",this.onItemEditClick);this.bindOnItemEx("i-apply","click",this.onItemApplyClick);this.bindOnItemEx("i-new-title","keypress",this.onItemNewTitleKeyPress)},bindDNDDropZones:function(t){this.callMethod(BX.Tasks.Util.ItemSet,"bindDNDDropZones",arguments);t.bindDropZone(this.control("items-complete"))},onDragNDropItemRelocatedAfter:function(t,e,i){var n=this.getItemByNode(e);if(n){var o=[];var s=n.isChecked();var r=i.zone==this.control("items-complete");if(r!=s){n.isChecked(r);o.push([r?"complete":"renew",{id:n.value()}])}var a=null;if(i.after!==null){a=this.getItemByNode(i.after)}if(r&&a===null){a=this.findLastUnCheckedItem()}if(!a||a.value()!=n.value()){o.push(["moveAfter",{id:n.value(),afterId:a?a.value():0}])}this.getSyncer().perform(o);this.callMethod(BX.Tasks.Util.ItemSet,"onDragNDropItemRelocatedAfter",arguments)}},onItemDeleteByCross:function(t){if(t.isEditMode()){this.toggleItemMode(false,t)}else{var e=arguments;if(this.option("confirmDelete")){BX.Tasks.confirmDelete(BX.message("TASKS_TTDP_CHECKLIST_ENTITY_NAME")).then(function(){this.deleteItemRemote.apply(this,e)}.bind(this))}else{this.deleteItemRemote.apply(this,e)}}},deleteItemRemote:function(t){var e=arguments;this.getSyncer().perform([["delete",{id:t.value()}]]).then(function(){this.callMethod(BX.Tasks.Util.ItemSet,"onItemDeleteByCross",e)}.bind(this))},onItemEditClick:function(t){this.toggleItemMode(false,t)},onItemApplyClick:function(t){this.toggleItemMode(true,t)},onItemToggleClick:function(t,e,i){if(t.isLockedCheck()){BX.eventReturnFalse(i||Window.event)}},onItemToggleChange:function(t){var e=function(t){this.getSyncer().perform([[t.isChecked()?"complete":"renew",{id:t.value()}]])}.bind(this);this.getStriker().toggle(t.control("title"),function(){t.isChecked(true);e(t);this.insertItemBefore(t,this.findItemBefore(t,true),true)}.bind(this),function(){t.isChecked(false);e(t);this.insertItemBefore(t,this.findItemBefore(t,false),false)}.bind(this))},onItemNewTitleKeyPress:function(t,e,i){i=i||Window.event;if(BX.Tasks.Util.isEnter(i)){this.toggleItemMode(true,t);BX.eventReturnFalse(i)}},insertItemBefore:function(t,e,i){var n=new BX.Promise;var o=this.control(i?"items-complete":"items");if(o){t.isLockedCheck(true);t.disappear().then(function(){if(e===null){BX.append(t.scope(),o)}else{o.insertBefore(t.scope(),e.scope())}t.appear().then(function(){t.isLockedCheck(false);n.resolve();this.fireEvent("change",[this.vars.order])}.bind(this),function(){t.isLockedCheck(false)})}.bind(this),function(){t.isLockedCheck(false)})}else{n.reject()}return n},findItemBefore:function(t,e){var i=t.data().SORT;var n=null;var o=this.first();this.each(function(t){if(!(e&&!t.isChecked())&&!(!e&&t.isChecked())){o=t}if(o.data().SORT>i){n=t;return false}});return n},findLastUnCheckedItem:function(){var t=0;var e=false;this.each(function(i){if(i.sort()>t&&!i.isChecked()){t=i.sort();e=i.value()}});return e===null?null:this.get(e)},openAddForm:function(){var t=this.control("add-item-form");if(t){if(!this.vars.formInitialized){this.bindControl("form-close","click",this.onFormCloseClick.bind(this));this.bindControl("form-submit","click",this.onFormSubmitClick.bind(this));this.bindControl("form-title","keypress",this.onFormTitleKeyPress.bind(this));this.vars.formInitialized=true}this.addItemByForm();this.clearForm();this.toggleForm(true).then(function(){if(!BX.hasClass(this.control("add-item-form"),"invisible")){this.focusForm()}}.bind(this))}},onAddSeparatorClick:function(){this.addItemRemote(this.makeItemData("==="))},onFormCloseClick:function(){this.toggleForm();this.clearForm()},onFormSubmitClick:function(){this.addItemByForm()},onFormTitleKeyPress:function(t){t=t||Window.event;if(BX.Tasks.Util.isEnter(t)){this.addItemByForm();BX.eventReturnFalse(t)}},addItemByForm:function(){var t=this.control("form-title").value;if(!t.length){return false}if(!this.opts.enableSync){t=BX.util.htmlspecialchars(t)}this.addItemRemote(this.makeItemData(t));return true},addItemRemote:function(t){this.lockInput();this.getSyncer().perform([["add",{data:{_OWNER_ENTITY_ID_:this.option("entityId"),TITLE:t.TITLE}},{code:"item-add"}]]).then(function(e){if(e){var i=e.getData()["item-add"].RESULT;var n=0;if("DATA"in i){n=i.DATA.ID}else{n=i.ID}t.VALUE=parseInt(n);t.DISPLAY=i.DATA.DISPLAY;t.TITLE=i.DATA.TITLE}this.addItem(t);this.clearForm();this.unLockInput();this.focusForm()}.bind(this),function(){this.unLockInput()}.bind(this))},clearForm:function(){this.control("form-title").value=""},toggleForm:function(t){var e=this.control("add-item-form");if(t&&!BX.hasClass(e,"invisible")){var i=new BX.Promise;i.resolve();return i}return BX.Tasks.Util.fadeSlideToggleByClass(this.control("add-item-form"))},focusForm:function(){this.control("form-title").focus()},lockInput:function(){BX.Tasks.Util.disable(this.control("form-title"))},unLockInput:function(){BX.Tasks.Util.enable(this.control("form-title"))},toggleItemMode:function(t,e){if(e.isEditMode()){if(t){var i=e.control("new-title").value;if(!i.length){return}e.lockInput();debugger;this.getSyncer().perform([["update",{id:e.value(),data:{TITLE:i}},{code:"item-update"}]]).then(function(t){if(t){var n=t.getData()["item-update"].RESULT;e.title(n.DATA.TITLE,n.DATA.DISPLAY)}else{e.title(i,BX.util.htmlspecialchars(i))}e.toggleMode();e.unLockInput()},function(){e.unLockInput()})}else{e.toggleMode()}}else{e.control("new-title").value=BX.util.htmlspecialcharsback(e.data().TITLE);e.toggleMode()}},makeItemData:function(t){var e=this.getGreatestSort();return{CHECKED:0,SORT:e["sort"]+1,SORT_INDEX:e["sort"]+1,NUMBER:e["number"]+1,TITLE:t,ACTION_UPDATE:true,ACTION_DELETE:true,ACTION_TOGGLE:true}},getGreatestSort:function(){var t={sort:0,number:0};this.each(function(e){var i=e.data().SORT;var n=e.data().NUMBER;if(i>t.sort){t.sort=i}if(!e.isSeparator()&&n>t.number){t.number=n}});return t},getItemClass:function(){return this.constructor.Item},getStriker:function(){return this.subInstance("striker",function(){return new t({duration:500,postTimeout:100})})},getSyncer:function(){return this.subInstance("sync",function(){return new e({enabled:this.option("enableSync"),routePrefix:this.option("entityRoute")})})},getItemDeleteControlId:function(){return"i-delete"}}});BX.Tasks.Component.TasksWidgetCheckList.ItemManager.Item=BX.Tasks.Util.ItemSet.Item.extend({sys:{code:"checklist-is-i"},options:{controlBind:"class"},methods:{isEditMode:function(){return!!this.vars.modeEdit},lockInput:function(){BX.Tasks.Util.disable(this.control("new-title"))},unLockInput:function(){BX.Tasks.Util.enable(this.control("new-title"))},toggleMode:function(){this.setCSSMode("mode",this.vars.modeEdit?"read":"edit");this.vars.modeEdit=!this.vars.modeEdit},title:function(t,e){if(typeof t!="undefined"){this.data().TITLE=t;this.data().DISPLAY=e;this.control("title").innerHTML=this.data().DISPLAY;this.control("title-field").value=this.data().TITLE;if(this.constructor.isSeparatorValue(t)){this.data().APPEARANCE="a-separator";this.setCSSMode("a","separator")}return}return this.data().TITLE},sort:function(t){if(typeof t!="undefined"){t=parseInt(t);this.control("number").innerHTML=t;this.control("sort-fld").value=this.data().SORT;return}return this.data().SORT},isChecked:function(t){if(typeof t!="undefined"){t=!!t;this.data().CHECKED=t?"1":"0";this.data().IS_COMPLETE=t?"Y":"N";this.control("toggle").checked=t;var e=t?"1":"0";if(this.parent().parent().option("compatibilityMode")){e=t?"Y":"N"}this.control("complete-fld").value=e;if(t){this.changeCSSFlag("stroke-out",true,this.control("title"))}else{this.parent().getStriker().unStrike(this.control("title"))}}return this.data().CHECKED=="1"},isLockedCheck:function(t){if(typeof t!=="undefined"){this.vars.checkLocked=!!t;return}return this.vars.checkLocked},isSeparator:function(){return this.constructor.isSeparatorValue(this.data().TITLE)}},methodsStatic:{extractValue:function(t){if("VALUE"in t){return t.VALUE}t.VALUE="n"+Math.abs(BX.util.hashCode(Math.random().toString()+Math.random().toString()));if(!("ID"in t)){t.ID=""}return t.VALUE},prepareDataSt:function(t){t.DISPLAY=t.DISPLAY||t.TITLE;t.APPEARANCE=this.isSeparatorValue(t.TITLE)?"a-separator":"a-generic";var e=t.CHECKED=="1";t.READONLY=t.ACTION_UPDATE?"":"noedit";t.CHECKED_ATTRIBUTE=e?"checked":"";t.DISABLED_ATTRIBUTE="";t.IS_COMPLETE=e?"Y":"N";t.STROKE_CSS=e?"stroke-out":"";if(this.isSeparatorValue(t.TITLE)){t.NUMBER=0}t.SORT_INDEX=t.SORT;t.ITEM_SET_INVISIBLE="invisible";return t},isSeparatorValue:function(t){t=t.toString().replace(/^\s+/,"").replace(/\s+$/,"");return!!t.match(/^(-|=|_|\*|\+){3,}$/)}}});var t=function(t){this.duration=t.duration||500;this.postTimeout=t.postTimeout||1;this.textChunkSize=t.textChunkSize||20;this.animations={}};t.prototype={addAnimation:function(t){var e=BX.util.hashCode(Math.random().toString()+Math.random().toString());this.animations[e]=t;return e},getAnimation:function(t){return this.animations[t]},removeAnimation:function(t,e){var i=this.getAnimation(t);if(i){clearTimeout(i.timer);var n=i.pr;delete this.animations[t];if(e){n.fulfill()}else{n.reject()}return n}return null},getAnimationKeyByBlock:function(t){var e=null;BX.Tasks.each(this.animations,function(i,n){if(i.block===t){e=n;return false}});return e},toggle:function(t,e,i){var n=this.getAnimationKeyByBlock(t);if(!n){if(BX.hasClass(t,"stroke-out")){this.unStrike(t).then(i)}else{this.strike(t).then(e)}}else{this.cancelStrikeAnimation(t,n)}},strike:function(t){var e=new BX.Promise;var i=t.childNodes.length;if(!i){e.resolve();return}var n=[];var o,s;for(o=0;o<t.childNodes.length;){var r=t.childNodes[o];if(r.nodeType==Node.TEXT_NODE){n=this.strSplit(r.textContent,this.textChunkSize);for(s=0;s<n.length;s++){t.insertBefore(BX.create("span",{text:n[s]}),r)}t.removeChild(r);o+=n.length}else{o++}}var a=t.childNodes.length;var l=this.addAnimation({block:t,tmOut:Math.floor(this.duration/a),k:0,length:a,pr:e,timer:null});var c=this.getAnimation(l);var h=function(){c.timer=setTimeout(function(){BX.addClass(c.block.childNodes[c.k],"chunk-stroke-out");c.k++;if(c.k<c.length){h()}else{c.timer=setTimeout(function(){this.removeAnimation(l,true);BX.addClass(c.block,"stroke-out")}.bind(this),this.postTimeout)}}.bind(this),c.tmOut)}.bind(this);h();return e},unStrike:function(t){this.clearStrike(t);var e=new BX.Promise;e.fulfill();return e},clearStrike:function(t){for(k=0;k<t.childNodes.length;k++){BX.removeClass(t.childNodes[k],"chunk-stroke-out")}BX.removeClass(t,"stroke-out")},cancelStrikeAnimation:function(t,e){if(!e){e=this.getAnimationKeyByBlock(t)}if(e){this.clearStrike(t);return this.removeAnimation(e,false)}return null},strSplit:function(t,e){var i=[];var n="";var o=0;while(t.length){if(o>100){break}n=t.substr(0,e);t=t.slice(e);if(!t.length&&n.length<4&&i.length>0){i[i.length-1]+=n}else{i.push(n)}o++}return i}};var e=function(t){this.enabled=!!t.enabled;this.prefix=t.routePrefix||"";this.sLock=false;this.query=null};e.prototype={getQuery:function(){if(this.query===null){this.query=new BX.Tasks.Util.Query}return this.query},perform:function(t){var e=new BX.Promise;if(!this.enabled){e.resolve();return e}if(this.sLock){e.reject();return e}var i=this.getQuery();this.sLock=true;var n=[];for(var o=0;o<t.length;o++){n.push({m:this.prefix+".checklist."+t[o][0],args:t[o][1],rp:t[o][2]})}i.load(n).execute().then(function(t){this.sLock=false;e.resolve(t)}.bind(this),function(t){this.sLock=false;e.reject(t)}.bind(this));return e}}}).call(this);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:104:"/bitrix/components/bitrix/tasks.widget.member.selector/templates/projectlink/logic.min.js?15113165981911";s:6:"source";s:85:"/bitrix/components/bitrix/tasks.widget.member.selector/templates/projectlink/logic.js";s:3:"min";s:89:"/bitrix/components/bitrix/tasks.widget.member.selector/templates/projectlink/logic.min.js";s:3:"map";s:89:"/bitrix/components/bitrix/tasks.widget.member.selector/templates/projectlink/logic.map.js";}"*/
"use strict";BX.namespace("Tasks.Component");(function(){if(typeof BX.Tasks.Component.TasksWidgetMemberSelectorProjectLink!="undefined"){return}BX.Tasks.Component.TasksWidgetMemberSelectorProjectLink=BX.Tasks.Component.extend({sys:{code:"ms-plink"},options:{entityRoute:""},methods:{bindEvents:function(){this.bindDelegateControl("deselect","click",this.onDeSelect.bind(this));this.bindDelegateControl("open-form","click",this.onOpenForm.bind(this))},onDeSelect:function(){this.setItem(0)},setItem:function(e,t){e=parseInt(e);if(e){BX.removeClass(this.control("item"),"invisible");BX.addClass(this.control("open-form"),"invisible");this.control("item-link").innerHTML=BX.util.htmlspecialchars(t);this.control("item-link").setAttribute("href",this.option("path").SG.toString().replace("{{ID}}",e))}else{BX.addClass(this.control("item"),"invisible");BX.removeClass(this.control("open-form"),"invisible")}this.saveId(e)},onOpenForm:function(){this.getSelector().open()},saveId:function(e){var t=this.option("entityRoute");if(!t){return}var n=this.option("entityId");e=parseInt(e);this.callRemote(t+".update",{id:n,data:{GROUP_ID:e}},{},function(){BX.Tasks.Util.fireGlobalTaskEvent("UPDATE",{ID:n},{STAY_AT_PAGE:true},{id:n});BX.onCustomEvent(this,"onChangeProjectLink",[e,n])})},onSelectorItemSelected:function(e){this.setItem(e.id,BX.util.htmlspecialcharsback(e.nameFormatted));this.getSelector().close();this.getSelector().deselectItem(e.id)},getSelector:function(){return this.subInstance("socnet",function(){var e=new BX.Tasks.Integration.Socialnetwork.NetworkSelector({scope:this.control("open-form"),id:this.id()+"socnet-sel",mode:"group",query:this.getQuery(),useSearch:true,useAdd:false,controlBind:this.option("controlBind"),parent:this,popupOffsetTop:5,popupOffsetLeft:40});e.bindEvent("item-selected",this.onSelectorItemSelected.bind(this));return e})}}})}).call(this);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:89:"/bitrix/components/bitrix/tasks.widget.buttons/templates/task/logic.min.js?15113165987761";s:6:"source";s:70:"/bitrix/components/bitrix/tasks.widget.buttons/templates/task/logic.js";s:3:"min";s:74:"/bitrix/components/bitrix/tasks.widget.buttons/templates/task/logic.min.js";s:3:"map";s:74:"/bitrix/components/bitrix/tasks.widget.buttons/templates/task/logic.map.js";}"*/
BX.namespace("Tasks.Component");(function(){if(typeof BX.Tasks.Component.TasksWidgetButtonsTask!="undefined"){return}BX.Tasks.Component.TasksWidgetButtonsTask=BX.Tasks.Util.Widget.extend({sys:{code:"task-view-b"},options:{goToListOnDelete:true},methods:{construct:function(){this.callConstruct(BX.Tasks.Util.Widget);this.vars.data=this.option("data")||{};this.vars.can=this.option("can")||{};this.vars.publicMode=this.option("publicMode")||false;this.vars.overtime=null;this.vars.buttonActionEnabled=true;this.vars.time=0;if(this.vars.data.TIME_ELAPSED){this.vars.time=parseInt(this.vars.data.TIME_ELAPSED)}this.bindEvents();this.getDayPlan()},bindEvents:function(){this.bindDelegateControl("open-menu","click",this.passCtx(this.onMenuOpen));this.bindDelegateControl("button","click",this.passCtx(this.onButtonPressed))},onMenuOpen:function(t){if(!this.vars.buttonActionEnabled){return}BX.PopupMenu.show(this.code(),t,this.getTaskMenu(),{closeByEsc:true})},onButtonPressed:function(t){if(!this.vars.buttonActionEnabled){return}var e=BX.data(t,"action");if(BX.type.isNotEmptyString(e)){this.doDynamicAction(e)}},getQuery:function(){if(!this.instances.query){this.instances.query=new BX.Tasks.Util.Query({autoExec:true})}return this.instances.query},getDayPlan:function(){if(!this.instances.dayplan){var t=BX.clone(this.option("data"));var e=this.option("taskId");t.ID=e;var s={};s[e]=t;this.instances.dayplan=new BX.Tasks.DayPlan({query:this.getQuery(),registerDispatcher:true,id:"buttons-dayplan",data:s});this.instances.dayplan.bindEvent("other-task-on-timer",BX.delegate(this.showTimerConfirm,this));this.instances.dayplan.bindEvent("task-timer-toggle",BX.delegate(this.onTaskTimerToggled,this));this.instances.dayplan.bindEvent("task-plan-toggle",BX.delegate(this.onTaskPlanToggled,this));this.instances.dayplan.bindEvent("task-timer-tick",BX.delegate(this.onTaskTimerTick,this))}return this.instances.dayplan},getUserSelector:function(){if(!this.instances.selector){this.instances.selector=new BX.Tasks.Integration.Socialnetwork.NetworkSelector({scope:this.control("open-menu"),mode:"user",query:this.getQuery(),useSearch:true,parent:this});this.instances.selector.bindEvent("item-selected",BX.delegate(this.onSelectorItemSelected,this))}return this.instances.selector},onSelectorItemSelected:function(t){this.instances.selector.close();if(t.id){this.doDynamicAction("DELEGATE",{userId:t.id})}},doMenuAction:function(t,e,s){var i=s.code;if(i){if(i=="COPY"){window.location=this.option("copyUrl")}else if(i=="CREATE_SUBTASK"){window.location=this.option("createSubtaskUrl")}else{if(i=="DELETE"){BX.Tasks.confirmDelete(BX.message("TASKS_COMMON_TASK_ALT_A")).then(function(){this.doDynamicAction(i)}.bind(this))}else if(i=="DELEGATE"){this.getUserSelector().open()}else{this.doDynamicAction(i)}}}t.popupWindow.close()},doDynamicAction:function(t,e){e=e||{};this.togglePanelActivity(false);if(t=="START_TIMER"||t=="PAUSE_TIMER"){this.getDayPlan()[t=="START_TIMER"?"startTimer":"stopTimer"](this.option("taskId"),true,e.force||false)}else if(t=="DAYPLAN.ADD"){this.getDayPlan().addToPlan(this.option("taskId"))}else{this.doDynamicTaskAction(t,e)}this.reFetchTaskData(t)},doDynamicTaskAction:function(t,e){var s=this.option("taskId");e=e||{};e["id"]=s;this.getQuery().add("task."+t.toLowerCase(),e,{},BX.delegate(function(t,e){if(!t.checkHasErrors()){if(e.OPERATION=="task.delete"){BX.Tasks.Util.fireGlobalTaskEvent("DELETE",{ID:s});if(this.option("goToListOnDelete")){window.location=this.option("listUrl")}}}},this))},reFetchTaskData:function(t){if(t!="DELETE"&&t!="DAYPLAN.ADD"){var e=this.option("taskId");this.getQuery().add("task.get",{id:e,parameters:{ENTITY_SELECT:["DAYPLAN"]}},{code:"task_data"},BX.delegate(function(s,i){if(!s.checkHasErrors()){if(t=="DELEGATE"){window.location.reload()}else if(t=="DEFER"){this.getDayPlan().stopTimer(e,false)}this.updateTaskData(i.RESULT.DATA);this.updatePlanner();this.togglePanelActivity(true)}},this))}else{if(t=="DAYPLAN.ADD"){this.updateTaskData({ACTION:{"DAYPLAN.ADD":false}})}this.togglePanelActivity(true)}},updateTaskData:function(t){BX.PopupMenu.destroy(this.code());if(t.ACTION){BX.mergeEx(this.vars.can,t.ACTION)}BX.mergeEx(this.vars.data,t);this.updateButtons();var e=BX.clone(this.vars.data);e.ID=this.option("taskId");BX.Tasks.Util.fireGlobalTaskEvent("UPDATE",e,{STAY_AT_PAGE:true})},updateButtons:function(){var t=this.vars.can;var e=this.vars.data;var s={"timer-start":t["DAYPLAN.TIMER.TOGGLE"]&&!e.TIMER_IS_RUNNING_FOR_CURRENT_USER,"timer-pause":t["DAYPLAN.TIMER.TOGGLE"]&&e.TIMER_IS_RUNNING_FOR_CURRENT_USER,"timer-running":e.TIMER_IS_RUNNING_FOR_CURRENT_USER,"timer-visible":t["DAYPLAN.TIMER.TOGGLE"],pause:!t["DAYPLAN.TIMER.TOGGLE"]&&t.PAUSE,start:!t["DAYPLAN.TIMER.TOGGLE"]&&t.START,complete:t.COMPLETE,approve:t.APPROVE,disapprove:t.DISAPPROVE,edit:t.EDIT&&!this.vars.publicMode,"more-button":!this.vars.publicMode||t.RENEW};this.toggleCSSMap(s)},onTaskTimerTick:function(t,e,s){if(t!=this.option("taskId")){return}if(this.vars.overtime==null){var i=parseInt(this.vars.data.TIME_ESTIMATE);if(!isNaN(i)&&i&&e>i){this.vars.overtime=true;this.changeCSSFlag("timer-overtime",this.vars.overtime)}}this.control("time-elapsed").innerHTML=BX.Tasks.Util.formatTimeAmount(e)},onTaskTimerToggled:function(t,e,s){if(t!=this.option("taskId")){return}this.addToData(s);this.updateButtons()},onTaskPlanToggled:function(t,e){if(t!=this.option("taskId")){return}this.updateTaskData({ACTION:{"DAYPLAN.ADD":true}})},showTimerConfirm:function(t,e){if(t!=this.option("taskId")){return}e=e||{};var s=BX.message("TASKS_TASK_CONFIRM_START_TIMER");s=s.replace("{{TITLE}}",BX.type.isNotEmptyString(e.title)?BX.util.htmlspecialchars(e.title):BX.message("TASKS_UNKNOWN"));BX.Tasks.confirm(s,BX.delegate(function(t){if(t){this.doDynamicAction("START_TIMER",{force:true})}},this),{title:BX.message("TASKS_TASK_CONFIRM_START_TIMER_TITLE")})},togglePanelActivity:function(t){this.changeCSSFlag("inactive",!t);this.vars.buttonActionEnabled=t},getTaskMenu:function(){var t=[];var e=this.vars.can;if(this.vars.publicMode){if(e.RENEW){t.push({code:"RENEW",text:BX.message("TASKS_RENEW_TASK"),title:BX.message("TASKS_RENEW_TASK"),className:"menu-popup-item-reopen",onclick:this.passCtx(this.doMenuAction)})}return t}t.push({code:"COPY",text:BX.message("TASKS_COPY_TASK"),title:BX.message("TASKS_COPY_TASK_EX"),className:"menu-popup-item-copy",onclick:this.passCtx(this.doMenuAction)},{code:"CREATE_SUBTASK",text:BX.message("TASKS_ADD_SUBTASK"),title:BX.message("TASKS_ADD_SUBTASK"),className:"menu-popup-item-create",onclick:this.passCtx(this.doMenuAction)});if(e["DAYPLAN.ADD"]){t.push({code:"DAYPLAN.ADD",text:BX.message("TASKS_ADD_TASK_TO_TIMEMAN"),title:BX.message("TASKS_ADD_TASK_TO_TIMEMAN_EX"),className:"menu-popup-item-add-to-tm",onclick:this.passCtx(this.doMenuAction)})}if(e.DELEGATE){t.push({code:"DELEGATE",text:BX.message("TASKS_DELEGATE_TASK"),title:BX.message("TASKS_DELEGATE_TASK"),className:"menu-popup-item-delegate",onclick:this.passCtx(this.doMenuAction)})}if(e.DEFER){t.push({code:"DEFER",text:BX.message("TASKS_DEFER_TASK"),title:BX.message("TASKS_DEFER_TASK"),className:"menu-popup-item-hold",onclick:this.passCtx(this.doMenuAction)})}if(e.RENEW){t.push({code:"RENEW",text:BX.message("TASKS_RENEW_TASK"),title:BX.message("TASKS_RENEW_TASK"),className:"menu-popup-item-reopen",onclick:this.passCtx(this.doMenuAction)})}if(e.REMOVE){t.push({code:"DELETE",text:BX.message("TASKS_DELETE_TASK"),title:BX.message("TASKS_DELETE_TASK"),className:"menu-popup-item-delete",onclick:this.passCtx(this.doMenuAction)})}return t},addToData:function(t){this.vars.overtime=null;BX.mergeEx(this.vars.data,t||{})},updatePlanner:function(){this.getDayPlan().updatePlanner()}}})}).call(this);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:87:"/bitrix/components/bitrix/forum.comments/templates/.default/script.min.js?1511316498678";s:6:"source";s:69:"/bitrix/components/bitrix/forum.comments/templates/.default/script.js";s:3:"min";s:73:"/bitrix/components/bitrix/forum.comments/templates/.default/script.min.js";s:3:"map";s:73:"/bitrix/components/bitrix/forum.comments/templates/.default/script.map.js";}"*/
(function(i){i.__fcOnUCFormClear=function(e){i.LHEPostForm.reinitDataBefore(e.editorId)};i.__fcOnUCFormAfterShow=function(e,t,r){var n={MID:e.id[1],ENTITY_XML_ID:e.id[0],ENTITY_TYPE:e.entitiesId[e.id[0]][0],ENTITY_ID:e.entitiesId[e.id[0]][1]},I;for(I in n){if(n.hasOwnProperty(I)&&typeof I=="string"&&(I.indexOf("MID")===0||I.indexOf("ENTITY")===0)){if(!e.form[I])e.form.appendChild(BX.create("INPUT",{attrs:{name:I,type:"hidden"}}));e.form[I].value=n[I]}}var o=r?r["UF"]:{};if(r&&r["FILES"]){o["FILES"]={USER_TYPE_ID:"file",FIELD_NAME:"FILE_NEW[]",VALUE:r["FILES"],CID:BX.message("FCCID")}}i.LHEPostForm.reinitData(e.editorId,t,o)}})(window);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:89:"/bitrix/components/bitrix/main.post.list/templates/.default/script.min.js?151131647236210";s:6:"source";s:69:"/bitrix/components/bitrix/main.post.list/templates/.default/script.js";s:3:"min";s:73:"/bitrix/components/bitrix/main.post.list/templates/.default/script.min.js";s:3:"map";s:73:"/bitrix/components/bitrix/main.post.list/templates/.default/script.map.js";}"*/
(function(){window["UC"]=window["UC"]||{};if(window["FCList"])return;var safeEditing=true,safeEditingCurrentObj=null,quoteData=null,repo={commentExemplarId:{}};window.FCList=function(e,t){this.CID=e["CID"];this.ENTITY_XML_ID=e["ENTITY_XML_ID"];this.container=e["container"];this.nav=e["nav"];this.mid=e["mid"];this.order=e["order"];this.status="ready";this.msg=!!this.nav?this.nav.innerHTML:"";this.params=t||{};this.pullNewRecords={};this.rights=e["rights"];this.DATE_TIME_FORMAT=this.params["DATE_TIME_FORMAT"]||null;this.comments={};this.bindEvents=[[this.nav,"click",BX.proxy(function(e){BX.eventCancelBubble(e);BX.PreventDefault(e);this.get();return false},this)]];this.exemplarId=BX.util.getRandomString(20);this.windowEvents={OnUCUserIsWriting:BX.delegate(function(t,i,s){if(this.ENTITY_XML_ID==t){BX.ajax({url:this.url.activity,method:"POST",data:{AJAX_POST:"Y",ENTITY_XML_ID:this.ENTITY_XML_ID,COMMENT_EXEMPLAR_ID:s,MODE:"PUSH&PULL",sessid:BX.bitrix_sessid(),sign:e["sign"],PATH_TO_USER:this.params["PATH_TO_USER"],AVATAR_SIZE:this.params["AVATAR_SIZE"],NAME_TEMPLATE:this.params["NAME_TEMPLATE"],SHOW_LOGIN:this.params["SHOW_LOGIN"]}})}},this),OnUCAfterRecordAdd:BX.delegate(function(e,t){if(this.ENTITY_XML_ID==e){this.add(t["messageId"],t,true,"simple")}},this),OnUCFormSubmit:BX.delegate(function(e,t,i,s){if(this.ENTITY_XML_ID==e){s["EXEMPLAR_ID"]=this.exemplarId;this.pullNewRecords[e+"-0"]="busy"}},this),OnUCFormResponse:BX.delegate(function(e,t){if(this.ENTITY_XML_ID==e){this.pullNewRecords[e+"-0"]="ready";this.pullNewRecords[e+"-"+t]="done"}},this),OnUCUserQuote:BX.delegate(function(e){if(this.ENTITY_XML_ID==e&&this.quote&&this.quote.popup){this.quote.popup.hide()}},this),"onPullEvent-unicomments":BX.delegate(function(e,t){if(this.ENTITY_XML_ID==t["ENTITY_XML_ID"]&&(t["USER_ID"]+""!=BX.message("USER_ID")+""||t["EXEMPLAR_ID"]&&t["EXEMPLAR_ID"]!=this.exemplarId||typeof t["AUX"]!="undefined"&&BX.util.in_array(t["AUX"],["createtask","fileversion"]))){if(e==="comment"&&t["ID"]){if(t["COMMENT_EXEMPLAR_ID"])repo.commentExemplarId[t["ENTITY_XML_ID"]+"_"+t["COMMENT_EXEMPLAR_ID"]]=true;this.pullNewRecord(t)}else if(e==="answer"&&t["USER_ID"]+""!==BX.message("USER_ID")+""&&(!t["COMMENT_EXEMPLAR_ID"]||repo.commentExemplarId[t["ENTITY_XML_ID"]+"_"+t["COMMENT_EXEMPLAR_ID"]]!==true)){this.pullNewAuthor(t["USER_ID"],t["NAME"],t["AVATAR"])}}},this)};if(this.params&&this.params["NOTIFY_TAG"]&&!!this.params["NOTIFY_TEXT"]&&!!window["UC"]["Informer"]){this.windowEvents["OnUCCommentWasPulled"]=BX.delegate(function(e,t){if(this.ENTITY_XML_ID==e[0]){window["UC"]["Informer"].check(e,t,this.params["NOTIFY_TAG"],this.params["NOTIFY_TEXT"])}},this);window["UC"]["InformerTags"][this.params["NOTIFY_TAG"]]=window["UC"]["InformerTags"][this.params["NOTIFY_TAG"]]||[]}var i;for(i=0;i<this.bindEvents.length;i++){BX.bind(this.bindEvents[i][0],this.bindEvents[i][1],this.bindEvents[i][2])}for(i in this.windowEvents){if(this.windowEvents.hasOwnProperty(i)){BX.addCustomEvent(window,i,this.windowEvents[i])}}var s=/%23com(\d+)/gi.exec(location.href),n=parseInt(location.hash&&location.hash.indexOf("#com")>=0?location.hash.replace("#com",""):s?s[1]:0);if(n>0)this.checkHash(n);if(this.params["BIND_VIEWER"]=="Y"&&BX["viewElementBind"]){BX.viewElementBind(BX("record-"+this.ENTITY_XML_ID+"-new").parentNode,{},function(e){return BX.type.isElementNode(e)&&(e.getAttribute("data-bx-viewer")||e.getAttribute("data-bx-image"))})}this.init(e);if(this.mid>0&&BX("record-"+[this.ENTITY_XML_ID,this.mid].join("-")+"-cover")){var o=BX("record-"+[this.ENTITY_XML_ID,this.mid].join("-")+"-cover").parentNode.firstChild,a=new RegExp("record-("+this.ENTITY_XML_ID+")-([0-9]+)-cover","gi");while(BX(o)){if(o["hasAttribute"]&&o.hasAttribute("id")&&a.test(o.getAttribute("id"))){(o.getAttribute("id")+"").replace(a,function(e,t,i){traceForReading([t,i])})}o=o.nextSibling}}if(repo[this.ENTITY_XML_ID])repo[this.ENTITY_XML_ID].destroy();repo[this.ENTITY_XML_ID]=this;return this};window.FCList.prototype={url:{activity:"/bitrix/components/bitrix/main.post.list/activity.php"},destroy:function(){var e,t;while((t=this.bindEvents.pop())&&t){BX.unbindAll(t[0]);t[0]=null;t[2]=null}for(e in this.windowEvents){if(this.windowEvents.hasOwnProperty(e)){BX.removeCustomEvent(window,e,this.windowEvents[e]);this.windowEvents[e]=null}}this.windowEvents=null;delete repo[this.ENTITY_XML_ID];BX.onCustomEvent(window,"OnUCHasBeenDestroyed",[this.ENTITY_XML_ID,this])},init:function(){if(this.params["SHOW_POST_FORM"]=="Y"){this.quote.show=BX.delegate(function(e,t){setTimeout(BX.delegate(function(){this.quoteShow(e,t)},this),50)},this);var e=BX("record-"+this.ENTITY_XML_ID+"-new"),t=BX.findChildren(e.parentNode,{tagName:"DIV",className:"feed-com-block-cover"},false);t=!!t?t:[];t.push(e);if(!!this.container)t.push(this.container);for(var i=0;i<t.length;i++){BX.bind(t[i],"mouseup",this.quote.show)}var s=BX("record-"+this.ENTITY_XML_ID+"-switcher");if(s&&!s.bxDndIsBound){s.bxDndIsBound="Y";BX.bind(s,"dragenter",BX.delegate(this.reply,this))}BX.addCustomEvent(window,"onQuote"+this.ENTITY_XML_ID,this.quote.show)}},quote:{show:BX.DoNothing(),popup:null},quoteCheck:function(){var e="",t,i=null;if(window.getSelection){t=window.getSelection();e=t.toString()}else if(document.selection){t=document.selection;e=t.createRange().text}if(e!=""){var s=BX("record-"+this.ENTITY_XML_ID+"-new"),n=BX.findParent(t.focusNode,{tagName:"DIV",className:"feed-com-block-cover"},s.parentNode),o=BX.findParent(t.anchorNode,{tagName:"DIV",className:"feed-com-block-cover"},s.parentNode);if(n!=o||BX(n)&&!n.hasAttribute("id")){e=""}else if(BX(n)){var a=BX(n.getAttribute("id").replace(/\-cover$/,"-actions-reply"));if(a){i={id:parseInt(a.getAttribute("bx-mpl-author-id")),name:a.getAttribute("bx-mpl-author-name")}}}}if(e==""){if(!!this.quote.popup)this.quote.popup.hide();return false}return{text:e,author:i}},quoteShow:function(e,t){t=t||this.quoteCheck();if(!t||!t["text"]){quoteData=null;return}quoteData=t;if(this.quote.popup==null){this.quote.popup=new MPLQuote({id:this.ENTITY_XML_ID,closeByEsc:true,autoHide:true,autoHideTimeout:2500,events:{click:BX.delegate(function(e){BX.PreventDefault(e);BX.eventCancelBubble(e);safeEditingCurrentObj=safeEditing;BX.onCustomEvent(window,"OnUCUserQuote",[this.ENTITY_XML_ID,t["author"],t["text"],safeEditingCurrentObj]);this.quote.popup.hide();return false},this)},classEvents:{onQuoteHide:BX.proxy(function(){quoteData=null;this.quote.popup=null},this)}})}this.quote.popup.show(e)},display:function(e,t){var i=0,s=0,n=0,o=this.container;e=e=="hide"?"hide":"show";if(e=="hide"){i=parseInt(this.container.offsetHeight);n=i/2e3;n=n<.3?.3:n>.5?.5:n;o.style.overflow="hidden";new BX["easing"]({duration:n*1e3,start:{height:i,opacity:100},finish:{height:s,opacity:0},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(e){o.style.maxHeight=e.height+"px";o.style.opacity=e.opacity/100},complete:BX.proxy(function(){o.style.cssText="";o.style.display="none";BX.onCustomEvent(this,"OnUCListWasHidden",[this,[],o])},this)}).animate()}else{i=parseInt(t||20);o.style.display="block";o.style.overflow="hidden";o.style.maxHeight=i;s=parseInt(this.container.offsetHeight);n=(s-i)/(2e3-i);n=n<.3?.3:n>.8?.8:n;new BX["easing"]({duration:n*1e3,start:{height:i,opacity:i>0?100:0},finish:{height:s,opacity:100},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(e){o.style.maxHeight=e.height+"px";o.style.opacity=e.opacity/100},complete:BX.proxy(function(){o.style.cssText="";o.style.maxHeight="none";BX.onCustomEvent(this,"OnUCListWasShown",[this,[],o])},this)}).animate()}},get:function(){if(this.status=="done"){if(this.nav.getAttribute("bx-visibility-status")=="visible"){this.display("hide");BX.adjust(this.nav,{attrs:{"bx-visibility-status":"none"},html:this.msg})}else{this.display("show");BX.adjust(this.nav,{attrs:{"bx-visibility-status":"visible"},html:BX.message("BLOG_C_HIDE")})}}else if(this.status=="ready"){this.send()}return false},send:function(){this.status="busy";BX.addClass(this.nav,"feed-com-all-hover");var e=BX.ajax.prepareData({AJAX_POST:"Y",ENTITY_XML_ID:this.ENTITY_XML_ID,MODE:"LIST",FILTER:this.order=="ASC"?{">ID":this.mid}:{"<ID":this.mid},sessid:BX.bitrix_sessid()}),t=BX.util.htmlspecialcharsback(this.nav.getAttribute("href"));t=t.indexOf("#")!==-1?t.substr(0,t.indexOf("#")):t;var i={url:t,data:e};BX.onCustomEvent(this,"OnUCListHasToBeEnlarged",[this,i]);t=i.url;e=i.data;BX.ajax({url:t+(t.indexOf("?")!==-1?"&":"?")+e,method:"GET",dataType:"json",data:"",onsuccess:BX.proxy(this.build,this),onfailure:BX.proxy(this.complete,this)})},build:function(e){this.status="ready";this.wait("hide");BX.removeClass(this.nav,"feed-com-all-hover");if(!!e&&e["status"]=="success"){var t=!!e["navigation"]?BX.create("DIV",{html:e["navigation"]}):null,i=BX.processHTML(e["messageList"],false);var s=this.container.offsetHeight,n=BX.create("DIV",{html:i.HTML});if(this.order=="ASC"||!this.container.firstChild){this.container.appendChild(n)}else{this.container.insertBefore(n,this.container.firstChild)}BX.onCustomEvent(window,"OnUCFeedChanged",[[this.ENTITY_XML_ID,this.mid]]);this.display("show",s);if(!!t)t=t.firstChild;if(!!t)BX.adjust(this.nav,{attrs:{href:t.getAttribute("href")},html:t.innerHTML});else{BX.adjust(this.nav,{attrs:{href:"#","bx-visibility-status":"visible"},html:BX.message("BLOG_C_HIDE"),events:{click:function(e){BX.eventCancelBubble(e);BX.PreventDefault(e);return false}}});this.status="done"}var o=0,a=BX.delegate(function(){o++;if(o<100){if(this.container.childNodes.length>0){BX.ajax.processScripts(i.SCRIPT);var t=n.firstChild,s=n.lastChild,r=0,d=0;if(t&&t.hasAttribute("id")){r=parseInt(t.getAttribute("id").replace("record-"+this.ENTITY_XML_ID+"-","").replace("-cover",""));r=r>0?r:0}if(s&&s.hasAttribute("id")){d=parseInt(s.getAttribute("id").replace("record-"+this.ENTITY_XML_ID+"-","").replace("-cover",""));d=d>0?d:0}if(r>d){d=d+r;r=d-r;d=d-r}n.setAttribute("bx-mpl-min",r+"");n.setAttribute("bx-mpl-max",d+"");n.setAttribute("bx-mpl-loaded","Y");BX.onCustomEvent(this,"OnUCListWasBuilt",[this,e,n])}else BX.defer(a)()}},this);BX.defer(a)()}},complete:function(){this.status="done";BX.removeClass(this.nav,"feed-com-all-hover");this.wait("hide")},wait:function(e){e=e=="show"?"show":"hide";return e},reply:function(e){safeEditingCurrentObj=safeEditing;if(BX.type.isElementNode(e))BX.onCustomEvent(window,"OnUCUserReply",[this.ENTITY_XML_ID,e.getAttribute("bx-mpl-author-id"),e.getAttribute("bx-mpl-author-name"),safeEditingCurrentObj]);else BX.onCustomEvent(window,"OnUCUserReply",[this.ENTITY_XML_ID,undefined,undefined,safeEditingCurrentObj])},add:function(e,t,i,s){if(!(!!t&&!!e&&parseInt(e[1])>0))return false;var n=BX("record-"+e.join("-")+"-cover"),o=!!t["message"]?t["message"]:window.fcParseTemplate({messageFields:t["messageFields"]},{RIGHTS:this.rights,DATE_TIME_FORMAT:this.DATE_TIME_FORMAT,VIEW_URL:this.params.VIEW_URL,EDIT_URL:this.params.EDIT_URL,MODERATE_URL:this.params.MODERATE_URL,DELETE_URL:this.params.DELETE_URL,AUTHOR_URL:this.params.AUTHOR_URL,AUTHOR_URL_PARAMS:this.params.AUTHOR_URL_PARAMS,NAME_TEMPLATE:this.params.NAME_TEMPLATE,SHOW_LOGIN:this.params.SHOW_LOGIN},this.getTemplate()),a=BX.processHTML(o,false),r,d=BX("record-"+e[0]+"-new"),l=["MODERATE","EDIT","DELETE"],c=false,h=0;for(var u in l){if(l.hasOwnProperty(u)){if(this.rights[l[u]]=="OWNLAST"){c=true;break}}}if(c){r=!!d.lastChild&&d.lastChild.className=="feed-com-block-cover"?[d.lastChild]:[];var T,E;if(this.addCheckPreviousNodes!==true){r=BX.findChildren(d.parentNode,{tagName:"DIV",className:"feed-com-block-cover"},false);var m=BX.findChildren(d,{tagName:"DIV",className:"feed-com-block-cover"},false);r=!!r?r:[];m=!!m?m:[];while(m.length>0&&(T=m.pop())&&!!T)r.push(T);this.addCheckPreviousNodes=true}while((T=r.pop())&&T){E=BX(T.id.replace("-cover","-actions"));if(!!E){if(this.rights["EDIT"]=="OWNLAST")E.setAttribute("bx-mpl-edit-show","N");if(this.rights["MODERATE"]=="OWNLAST")E.setAttribute("bx-mpl-moderate-show","N");if(this.rights["DELETE"]=="OWNLAST")E.setAttribute("bx-mpl-delete-show","N")}}}var p=false;if(!n){n=BX.create("DIV",{attrs:{id:"record-"+e.join("-")+"-cover",className:"feed-com-block-cover"},style:{opacity:0,height:0,overflow:"hidden"},html:a.HTML});d.appendChild(n);p=true}else{var f=BX.create("DIV",{attrs:{id:"record-"+e.join("-")+"-cover",className:"feed-com-block-cover"},style:{display:"none"},html:a.HTML}),X=n;n.parentNode.insertBefore(f,n);n.removeAttribute("id");h=n.scrollHeight;BX.hide(n);BX.show(f);n=f;setTimeout(function(){BX.remove(X)},1e3)}if(s!=="simple"){var _=BX.pos(n),I=BX.GetWindowScrollPos(),B=BX.GetWindowInnerSize();new BX["easing"]({duration:1e3,start:{opacity:p?0:100,height:h},finish:{opacity:100,height:n.scrollHeight},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(e){n.style.height=e.height+"px";n.style.opacity=e.opacity/100;if(I.scrollTop>0&&_.top<I.scrollTop+B.innerHeight)window.scrollTo(0,I.scrollTop+e.height)},complete:function(){n.style.cssText=""}}).animate()}else{new BX["easing"]({duration:500,start:{height:h,opacity:p?0:100},finish:{height:n.scrollHeight,opacity:100},transition:BX.easing.makeEaseOut(BX.easing.transitions.cubic),step:function(e){n.style.height=e.height+"px";n.style.opacity=e.opacity/100},complete:BX.proxy(function(){n.style.cssText="";BX.onCustomEvent(this,"OnUCRecordWasShown",[this.ENTITY_XML_ID,e,n])},this)}).animate()}var A=0,R=function(){A++;if(A<100){var i=BX("record-"+e.join("-")+"-cover");if(i&&i.childNodes.length>0){BX.ajax.processScripts(a.SCRIPT);if(this.params["BIND_VIEWER"]=="Y"&&BX["viewElementBind"]){BX.viewElementBind(i,{},function(e){return BX.type.isElementNode(e)&&(e.getAttribute("data-bx-viewer")||e.getAttribute("data-bx-image"))})}}else BX.defer(R,this)()}BX.onCustomEvent(window,"OnUCRecordHasDrawn",[this.ENTITY_XML_ID,e,t["messageFields"]]);BX.onCustomEvent(window,"OnUCFeedChanged",[e])};BX.defer(R,this)();return true},pullNewAuthor:function(e,t,i){BX.onCustomEvent(window,"OnUCUsersAreWriting",[this.ENTITY_XML_ID,e,t,i])},pullNewRecord:function(e){var t=[this.ENTITY_XML_ID,parseInt(e["ID"])];if(!!this.pullNewRecords[t.join("-")]&&this.pullNewRecords[t.join("-")]=="busy")return true;else if(!!this.pullNewRecords[t[0]+"-0"]&&this.pullNewRecords[t[0]+"-0"]=="busy")return setTimeout(BX.proxy(function(){this.pullNewRecord(e)},this),100);BX.onCustomEvent(window,"OnUCBeforeCommentWillBePulled",[t,e]);if(e["NEED_REQUEST"]=="Y"){if(e["URL"]["LINK"].indexOf("#GROUPS_PATH#")>=0&&!!BX.message("MPL_WORKGROUPS_PATH"))e["URL"]["LINK"]=e["URL"]["LINK"].replace("#GROUPS_PATH#",BX.message("MPL_WORKGROUPS_PATH"));this.pullNewRecords[t.join("-")]="busy";var i=BX.ajax.prepareData({AJAX_POST:"Y",ENTITY_XML_ID:this.ENTITY_XML_ID,MODE:"RECORD",FILTER:{ID:e["ID"]},sessid:BX.bitrix_sessid()}),s=e["URL"]["LINK"];s=s.indexOf("#")!==-1?s.substr(0,s.indexOf("#")):s;BX.ajax({url:s+(s.indexOf("?")!==-1?"&":"?")+i,method:"GET",dataType:"json",data:"",onsuccess:BX.delegate(function(i){if(!!BX("record-"+t.join("-")+"-cover"))return;this.add([this.ENTITY_XML_ID,parseInt(e["ID"])],i);var s=BX("record-"+t.join("-")+"-cover"),n=BX.findChild(s,{className:"feed-com-block"},true,false);BX.addClass(s,"comment-new-answer");BX.addClass(n,"feed-com-block-pointer-to-new feed-com-block-new");this.pullNewRecords[t.join("-")]="done";if(BX("record-"+t[0]+"-corner")){BX.addClass(BX("record-"+t[0]+"-corner"),BX.hasClass(n,"feed-com-block-new")?"feed-post-block-yellow-corner":"");BX("record-"+t[0]+"-corner").removeAttribute("id")}BX.onCustomEvent(window,"OnUCCommentWasPulled",[t,i])},this)})}else if(e["ACTION"]=="DELETE"){if(BX("record-"+this.ENTITY_XML_ID+"-"+e["ID"]))BX.fx.hide(BX("record-"+this.ENTITY_XML_ID+"-"+e["ID"]),"scroll",{time:.2});BX.onCustomEvent(window,"OnUCommentWasDeleted",[this.ENTITY_XML_ID,[this.ENTITY_XML_ID,e["ID"]],e]);BX.onCustomEvent(window,"OnUCFeedChanged",[e["ID"]])}else if(e["ACTION"]=="HIDE"){var n=BX("record-"+this.ENTITY_XML_ID+"-"+e["ID"]),o=n?BX.findChild(n,{tagName:"DIV",className:"feed-com-block"},true):null;if(BX(o)){if(BX.hasClass(o,"blog-comment-user-"+BX.message("USER_ID"))){BX.removeClass(o,"feed-com-block-approved");BX.addClass(o,"feed-com-block-hidden")}else{BX.fx.hide(n,"scroll",{time:.2});BX.onCustomEvent(window,"OnUCommentWasHidden",[this.ENTITY_XML_ID,[this.ENTITY_XML_ID,e["ID"]],e]);BX.onCustomEvent(window,"OnUCFeedChanged",[e["ID"]])}}}else if(e["ACTION"]=="EDIT"&&!BX("record-"+this.ENTITY_XML_ID+"-"+e["ID"])){BX.DoNothing()}else{if(e&&!(e["AUTHOR"]&&e["AUTHOR"]["ID"]+""==BX.message("USER_ID")+""))e["NEW"]="Y";this.add(t,{messageFields:e});var a=BX("record-"+t.join("-")+"-cover"),r=BX.findChild(a,{className:"feed-com-block"},true,false);if(BX("record-"+t[0]+"-corner")){BX.addClass(BX("record-"+t[0]+"-corner"),e["NEW"]=="Y"?"feed-post-block-yellow-corner":"");BX("record-"+t[0]+"-corner").removeAttribute("id")}BX.addClass(a,"comment-new-answer");if(e["NEW"]=="Y"){BX.addClass(r,"feed-com-block-pointer-to-new feed-com-block-new")}this.pullNewRecords[t.join("-")]="done";BX.onCustomEvent(window,"OnUCCommentWasPulled",[t,{messageFields:e}])}return true},act:function(url,id,act){if(url.substr(0,1)!="/"){try{eval(url);return false}catch(e){}if(BX.type.isFunction(url)){url(this,id,act);return false}}this.showWait(id);act=act==="EDIT"?"EDIT":act==="DELETE"?"DELETE":"MODERATE";id=parseInt(id);var data=BX.ajax.prepareData({sessid:BX.bitrix_sessid(),MODE:"RECORD",NOREDIRECT:"Y",AJAX_POST:"Y",FILTER:{ID:id},ENTITY_XML_ID:this.ENTITY_XML_ID});url=url.indexOf("#")!==-1?url.substr(0,url.indexOf("#")):url;BX.ajax({method:"GET",url:url+(url.indexOf("?")!==-1?"&":"?")+data,data:"",dataType:"json",onsuccess:BX.proxy(function(e){this.closeWait(id);if(e["status"]=="error"){this.showError(id,e["message"]||"Unknown error.")}else{if(act!=="EDIT"){var t=BX("record-"+this.ENTITY_XML_ID+"-"+id+"-cover");if(!!e["message"]&&!!t){var i=BX.processHTML(e["message"],false);t.innerHTML=i.HTML;var s=0,n=function(){s++;if(s<100){if(t.childNodes.length>0)BX.ajax.processScripts(i.SCRIPT);else BX.defer(n)()}};BX.defer(n)();e["okMessage"]=""}else if(act=="DELETE"&&!!e["okMessage"]){BX.hide(BX("record-"+this.ENTITY_XML_ID+"-"+id));BX.onCustomEvent(window,"OnUCommentWasDeleted",[this.ENTITY_XML_ID,[this.ENTITY_XML_ID,id]])}}BX.onCustomEvent(window,"OnUCAfterRecordEdit",[this.ENTITY_XML_ID,id,e,act]);BX.onCustomEvent(window,"OnUCFeedChanged",[id])}this.busy=false},this),onfailure:BX.delegate(function(e){this.closeWait(id);this.showError(id,e)},this)});return false},showError:function(e,t){if(this.errorWindow)this.errorWindow.close();this.errorWindow=new BX.PopupWindow("bx-comments-error",null,{autoHide:false,zIndex:200,overlay:{opacity:50,backgroundColor:"#000000"},buttons:[new BX.PopupWindowButton({text:BX.message("MPL_CLOSE"),events:{click:BX.delegate(function(){if(this.errorWindow)this.errorWindow.close()},this)}})],closeByEsc:true,titleBar:{content:BX.create("span",{props:{className:"popup-window-titlebar-text feed-error-title"},html:'<div class="feed-error-icon"></div>'+BX.message("MPL_ERROR_OCCURRED")})},closeIcon:true,contentColor:"white",content:'<div class="feed-error-block">'+t+"</div>"});this.errorWindow.show()},checkHash:function(e){var t=[this.ENTITY_XML_ID,e],i=BX("record-"+t.join("-")+"-cover");if(!!i){var s=BX.pos(i);window.scrollTo(0,s["top"]);i=BX.findChild(i,{className:"feed-com-block"},true,false);BX.removeClass(i,"feed-com-block-pointer-to-new feed-com-block-new");BX.addClass(i,"feed-com-block-pointer")}},getTemplate:function(){return BX.message("MPL_RECORD_TEMPLATE")},showWait:function(e){window.fcShowWait(BX("record-"+this.ENTITY_XML_ID+"-"+e+"-actions"))},closeWait:function(e){window.fcCloseWait(BX("record-"+this.ENTITY_XML_ID+"-"+e+"-actions")||null)}};window.FCList.getQuoteData=function(){return quoteData};window.FCList.getInstance=function(e,t){if(!repo[e["ENTITY_XML_ID"]])new window.FCList(e,t);return repo[e["ENTITY_XML_ID"]]};window["fcExpandComment"]=function(e,t){if(!BX("record-"+e+"-text")){return}var i=BX("record-"+e+"-text"),s=i.parentNode,n=200,o=parseInt(i.offsetHeight),a={height:n},r={height:o};if(!!t)BX.remove(t);var d=(o-n)/(2e3-n);d=d<.3?.3:d>.8?.8:d;s.style.maxHeight=a.height+"px";s.style.overflow="hidden";new BX["easing"]({duration:d*1e3,start:a,finish:r,transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(e){s.style.maxHeight=e.height+"px";s.style.opacity=e.opacity/100},complete:function(){s.style.cssText="";s.style.maxHeight="none";BX.onCustomEvent(window,"OnUCRecordWasExpanded",[s]);BX.LazyLoad.showImages(true)}}).animate();BX.onCustomEvent(window,"OnUCFeedChanged",[e.split("-")])};var lastWaitElement=null;window["fcShowWait"]=function(e){if(e&&!BX.type.isElementNode(e))e=null;e=e||this;if(BX.type.isElementNode(e)){BX.defer(function(){e.disabled=true})();var t=BX.findParent(e,BX.is_relative);e.bxwaiter=(t||document.body).appendChild(BX.create("DIV",{props:{className:"feed-com-loader"},style:{position:"absolute"}}));lastWaitElement=e;return e.bxwaiter}return true};window["fcCloseWait"]=function(e){if(e&&!BX.type.isElementNode(e))e=null;e=e||lastWaitElement||this;if(BX.type.isElementNode(e)){if(e.bxwaiter&&e.bxwaiter.parentNode){e.bxwaiter.parentNode.removeChild(e.bxwaiter);e.bxwaiter=null}e.disabled=false;if(lastWaitElement==e)lastWaitElement=null}};window["fcShowActions"]=function(e,t,i){var s=[];if(i.getAttribute("bx-mpl-view-show")=="Y"){s.push({text:BX.message("MPL_MES_HREF"),href:i.getAttribute("bx-mpl-view-url").replace(/\\#(.+)$/gi,"")+"#com"+t});s.push({text:'<span id="record-popup-'+e+"-"+t+'-link-text">'+BX.message("B_B_MS_LINK")+"</span>"+'<span id="record-popup-'+e+"-"+t+'-link-icon-animate" class="comment-menu-link-icon-wrap">'+'<span class="comment-menu-link-icon" id="record-popup-'+e+"-"+t+'-link-icon-done" style="display: none;">'+"</span>"+"</span>",onclick:function(){var s="record-popup-"+e+"-"+t+"-link",n=i.getAttribute("bx-mpl-view-url").replace(/#(.+)$/gi,"")+"#com"+t,o=BX(s+"-text"),a=BX(s+"-icon-done");n=(n.indexOf("http")<0?location.protocol+"//"+location.host:"")+n;if(BX.clipboard.isCopySupported()){if(o&&o.getAttribute("data-block-click")=="Y"){return}BX.clipboard.copy(n);if(o&&a){a.style.display="inline-block";BX.removeClass(BX(s+"-icon-animate"),"comment-menu-link-icon-animate");BX.adjust(BX(s+"-text"),{attrs:{"data-block-click":"Y"}});setTimeout(function(){BX.addClass(BX(s+"-icon-animate"),"comment-menu-link-icon-animate")},1);setTimeout(function(){BX.adjust(BX(s+"-text"),{attrs:{"data-block-click":"N"}})},500)}return}var r=BX.proxy_context,d=parseInt(!!r.getAttribute("bx-height")?r.getAttribute("bx-height"):r.offsetHeight);if(r.getAttribute("bx-status")!="shown"){r.setAttribute("bx-status","shown");if(!BX(s)&&!!BX(s+"-text")){var l=BX(s+"-text"),c=BX.pos(l),h=BX.pos(l.parentNode),u=BX.findChildren(l.parentNode.parentNode.parentNode,{className:"menu-popup-item-text"},true);c["height"]=h["height"]-1;if(u){var T=0,E;for(var m=0;m<u.length;m++){E=BX.pos(u[m]);T=Math.max(T,E["width"])}h["width"]=T}BX.adjust(r,{attrs:{"bx-height":r.offsetHeight},style:{overflow:"hidden",display:"block"},children:[BX.create("BR"),BX.create("DIV",{attrs:{id:s},children:[BX.create("SPAN",{attrs:{className:"menu-popup-item-left"}}),BX.create("SPAN",{attrs:{className:"menu-popup-item-icon"}}),BX.create("SPAN",{attrs:{className:"menu-popup-item-text"},children:[BX.create("INPUT",{attrs:{id:s+"-input",type:"text",value:n},style:{height:h["height"]+"px",width:h["width"]+"px"},events:{click:function(e){this.select();BX.PreventDefault(e)}}})]})]}),BX.create("SPAN",{className:"menu-popup-item-right"})]})}new BX["fx"]({time:.2,step:.05,type:"linear",start:d,finish:d*2,callback:BX.delegate(function(e){this.style.height=e+"px"},r)}).start();BX.fx.show(BX(s),.2);BX(s+"-input").select()}else{r.setAttribute("bx-status","hidden");new BX["fx"]({time:.2,step:.05,type:"linear",start:r.offsetHeight,finish:d,callback:BX.delegate(function(e){this.style.height=e+"px"},r)}).start();BX.fx.hide(BX(s),.2)}}})}if(i.getAttribute("bx-mpl-edit-show")=="Y")s.push({text:BX.message("BPC_MES_EDIT"),onclick:function(){window["UC"][e].act(i.getAttribute("bx-mpl-edit-url"),t,"EDIT");this.popupWindow.close();return false}});if(i.getAttribute("bx-mpl-moderate-show")=="Y"){var n=i.getAttribute("bx-mpl-moderate-approved")=="hidden";s.push({text:n?BX.message("BPC_MES_SHOW"):BX.message("BPC_MES_HIDE"),onclick:function(){window["UC"][e].act(i.getAttribute("bx-mpl-moderate-url").replace("#action#",n?"show":"hide").replace("#ACTION#",n?"SHOW":"HIDE"),t,"MODERATE");this.popupWindow.close()}})}if(i.getAttribute("bx-mpl-delete-show")=="Y"){s.push({text:BX.message("BPC_MES_DELETE"),onclick:function(){if(window.confirm(BX.message("BPC_MES_DELETE_POST_CONFIRM")))window["UC"][e].act(i.getAttribute("bx-mpl-delete-url"),t,"DELETE");this.popupWindow.close();return false}})}if(i.getAttribute("bx-mpl-createtask-show")=="Y"&&typeof oLF!="undefined"){s.push({text:BX.message("BPC_MES_CREATE_TASK"),onclick:function(){oLF.createTask({entityType:"BLOG_COMMENT",entityId:t});this.popupWindow.close();return false}})}if(s.length>0){for(var o in s){if(s.hasOwnProperty(o)){s[o]["className"]="blog-comment-popup-menu"}}BX.PopupMenu.show("action-"+e+"-"+t,i,s,{offsetLeft:-18,offsetTop:2,lightShadow:false,angle:{position:"top",offset:50},events:{onPopupClose:function(){this.destroy();BX.PopupMenu.Data["action-"+e+"-"+t]=null}}})}};window["fcParseTemplate"]=function(e,t,i){t=t||{};t["RIGHTS"]=t["RIGHTS"]||{};for(var s=0,n=["MODERATE","EDIT","DELETE"];s<n.length;s++){t["RIGHTS"][n[s]]=BX.util.in_array(t["RIGHTS"][n[s]],["Y","ALL","OWN","OWNLAST"])?t["RIGHTS"][n[s]]:"N"}t["DATE_TIME_FORMAT"]=!!t["DATE_TIME_FORMAT"]?t["DATE_TIME_FORMAT"]:"d F Y G:i";t["TIME_FORMAT"]=!!t["DATE_TIME_FORMAT"]&&t["DATE_TIME_FORMAT"].indexOf("a")>=0?"g:i a":"G:i";t["VIEW_URL"]=t["VIEW_URL"]||"";t["EDIT_URL"]=t["EDIT_URL"]||"";t["MODERATE_URL"]=t["MODERATE_URL"]||"";t["DELETE_URL"]=t["DELETE_URL"]||"";t["AUTHOR_URL"]=t["AUTHOR_URL"]||"";t["NAME_TEMPLATE"]=t["NAME_TEMPLATE"]||"";t["SHOW_LOGIN"]=t["SHOW_LOGIN"]||"";var o=e&&e["messageFields"]?e["messageFields"]:e,a={ID:"",FULL_ID:"",ENTITY_XML_ID:"",NEW:"old",APPROVED:"Y",DATE:"",TEXT:"",CLASSNAME:"",VIEW_URL:"",VIEW_SHOW:"N",EDIT_URL:"",EDIT_SHOW:"N",MODERATE_URL:"",MODERATE_SHOW:"N",DELETE_URL:"",DELETE_SHOW:"N",CREATETASK_SHOW:"N",BEFORE_HEADER:"",BEFORE_ACTIONS:"",AFTER_ACTIONS:"",AFTER_HEADER:"",BEFORE:"",AFTER:"",BEFORE_RECORD:"",AFTER_RECORD:"",AUTHOR_ID:0,AUTHOR_AVATAR_IS:"N",AUTHOR_AVATAR:"",AUTHOR_URL:"",AUTHOR_NAME:"",AUTHOR_EXTRANET_STYLE:"",SHOW_POST_FORM:"Y",VOTE_ID:"",AUTHOR_TOOLTIP_PARAMS:"","background:url('') no-repeat center;":""};if(!!o&&!!e["messageFields"]){o["AUTHOR"]=!!o["AUTHOR"]?o["AUTHOR"]:{};var r=parseInt(o["POST_TIMESTAMP"])+parseInt(BX.message("USER_TZ_OFFSET"))+parseInt(BX.message("SERVER_TZ_OFFSET"));var d=[["today",t["TIME_FORMAT"].indexOf("today")<0?"today, "+t["TIME_FORMAT"]:t["TIME_FORMAT"]],["yesterday",t["TIME_FORMAT"].indexOf("yesterday")<0?"yesterday, "+t["TIME_FORMAT"]:t["TIME_FORMAT"]],["",t["DATE_TIME_FORMAT"]]];var l="";if(typeof o["AUTHOR"]["TYPE"]!="undefined"){if(o["AUTHOR"]["TYPE"]=="EMAIL"){l=" feed-com-name-email"}else if(o["AUTHOR"]["TYPE"]=="EXTRANET"){l=" feed-com-name-extranet"}}else if(o["AUTHOR"]["IS_EXTRANET"]=="Y"){l=" feed-com-name-extranet"}var c=!!o.AUX&&o.AUX.length>0?BX.CommentAux.getLiveText(o.AUX,!!o.AUX_LIVE_PARAMS?o.AUX_LIVE_PARAMS:{}):o["POST_MESSAGE_TEXT"].replace(/\001/gi,"").replace(/#/gi,"");a={ID:o["ID"],FULL_ID:o["FULL_ID"].join("-"),ENTITY_XML_ID:o["ENTITY_XML_ID"],NEW:o["NEW"]=="Y"?"new":"old",APPROVED:o["APPROVED"]!="Y"?"hidden":"approved",DATE:BX.date.format(d,r,false,true),TEXT:c,CLASSNAME:o["CLASSNAME"]?" "+o["CLASSNAME"]:"",VIEW_URL:t["VIEW_URL"].replace("#ID#",o["ID"]).replace("#id#",o["ID"]),VIEW_SHOW:t["VIEW_URL"]!==""?"Y":"N",EDIT_URL:t["EDIT_URL"].replace("#ID#",o["ID"]).replace("#id#",o["ID"]),EDIT_SHOW:(!o.AUX||o.AUX.length<=0)&&(t["RIGHTS"]["EDIT"]=="Y"||t["RIGHTS"]["EDIT"]=="ALL"||t["RIGHTS"]["EDIT"]=="OWN"&&BX.message("USER_ID")==o["AUTHOR"]["ID"])?"Y":"N",MODERATE_URL:t["MODERATE_URL"].replace("#ID#",o["ID"]).replace("#id#",o["ID"]),MODERATE_SHOW:t["RIGHTS"]["MODERATE"]=="Y"||t["RIGHTS"]["MODERATE"]=="ALL"||t["RIGHTS"]["MODERATE"]=="OWN"&&BX.message("USER_ID")==o["AUTHOR"]["ID"]?"Y":"N",DELETE_URL:t["DELETE_URL"].replace("#ID#",o["ID"]).replace("#id#",o["ID"]),DELETE_SHOW:t["RIGHTS"]["DELETE"]=="Y"||t["RIGHTS"]["DELETE"]=="ALL"||t["RIGHTS"]["DELETE"]=="OWN"&&BX.message("USER_ID")==o["AUTHOR"]["ID"]?"Y":"N",CREATETASK_SHOW:(!o.AUX||o.AUX.length<=0)&&t["RIGHTS"]["CREATETASK"]=="Y"?"Y":"N",BEFORE_HEADER:o["BEFORE_HEADER"],BEFORE_ACTIONS:o["BEFORE_ACTIONS"],AFTER_ACTIONS:o["AFTER_ACTIONS"],AFTER_HEADER:o["AFTER_HEADER"],BEFORE:o["BEFORE"],AFTER:o["AFTER"],BEFORE_RECORD:o["BEFORE_RECORD"],AFTER_RECORD:o["AFTER_RECORD"],AUTHOR_ID:o["AUTHOR"]["ID"],AUTHOR_AVATAR_IS:!!o["AUTHOR"]["AVATAR"]?"Y":"N",AUTHOR_AVATAR:!!o["AUTHOR"]["AVATAR"]?o["AUTHOR"]["AVATAR"]:"/bitrix/images/1.gif",AUTHOR_URL:t["AUTHOR_URL"].replace("#ID#",o["ID"]).replace("#id#",o["ID"]).replace("#USER_ID#",o["AUTHOR"]["ID"]).replace("#user_id#",o["AUTHOR"]["ID"])+(typeof o["AUTHOR"]["EXTERNAL_AUTH_ID"]!="undefined"&&o["AUTHOR"]["EXTERNAL_AUTH_ID"]=="email"&&typeof t["AUTHOR_URL_PARAMS"]!="undefined"?(t["AUTHOR_URL"].indexOf("?")>=0?"&":"?")+"entityType="+t["AUTHOR_URL_PARAMS"]["entityType"]+"&entityId="+t["AUTHOR_URL_PARAMS"]["entityId"]:""),AUTHOR_NAME:BX.formatName(o["AUTHOR"],t["NAME_TEMPLATE"],t["SHOW_LOGIN"]),AUTHOR_EXTRANET_STYLE:l,VOTE_ID:o["RATING"]&&o["RATING"]["VOTE_ID"]?o["RATING"]["VOTE_ID"]:"",AUTHOR_TOOLTIP_PARAMS:typeof o["AUTHOR_TOOLTIP_PARAMS"]!="undefined"?o["AUTHOR_TOOLTIP_PARAMS"]:"{}","background:url('') no-repeat center;":""}}else{for(s in a){if(a.hasOwnProperty(s)){a[s]=!!e[s]?e[s]:a[s]}}}for(s in a){if(a.hasOwnProperty(s)){a[s]=!!a[s]?a[s]:""}}a["SHOW_POST_FORM"]=BX("record-"+a["ENTITY_XML_ID"]+"-0-placeholder")?"Y":"N";for(var h in a){if(a.hasOwnProperty(h)){i=i.replace(new RegExp("#"+h+"#","g"),a[h])}}return i.replace("background:url('') no-repeat center;","").replace(/\001/gi,"#")};window["fcPull"]=function(e,t){BX.ajax({url:"/bitrix/components/bitrix/main.post.list/templates/.default/component_epilog.php",method:"POST",data:{AJAX_POST:"Y",ENTITY_XML_ID:e,MODE:"PUSH&PULL",sessid:BX.bitrix_sessid(),DATA:t}})};var newCommentsToCheckForReading={data:[],screen:{},timeout:0},traceForReading=function(e){newCommentsToCheckForReading.data.push(e);newCommentsToCheckForReading.screen=newCommentsToCheckForReading.screen||{scrollTop:BX.GetWindowScrollPos().scrollTop,time:(new Date).getTime()};newCommentsToCheckForReading.screen["checked"]=false;newCommentsToCheckForReading.timeout=newCommentsToCheckForReading.timeout||setTimeout(markReadComments,1e3)};BX.addCustomEvent(window,"OnUCRecordHasDrawn",function(e,t){traceForReading(t)});var markReadComments=function(){var e=BX.GetWindowScrollPos();if(e.scrollTop!=newCommentsToCheckForReading.screen["scrollTop"]){newCommentsToCheckForReading.screen["time"]=(new Date).getTime();newCommentsToCheckForReading.screen["scrollTop"]=e.scrollTop;newCommentsToCheckForReading.screen["checked"]=false}else if(!newCommentsToCheckForReading.screen["checked"]&&(new Date).getTime()-newCommentsToCheckForReading.screen["time"]>3e3){newCommentsToCheckForReading.screen["time"]=(new Date).getTime();newCommentsToCheckForReading.screen["checked"]=true;var t=0,i=BX.GetWindowInnerSize(),s=[],n,o,a,r;for(r=0;r<newCommentsToCheckForReading.data.length;r++){n=BX("record-"+newCommentsToCheckForReading.data[r].join("-")+"-cover");if(n){o=BX.pos(n);if(o.top>=e.scrollTop&&o.top<=e.scrollTop+i.innerHeight-20){BX.onCustomEvent(window,"OnUCCommentWasRead",[newCommentsToCheckForReading.data[r],n]);BX.removeClass(n,"comment-new-answer");a=BX.findChild(n,{className:"feed-com-block"},true,false);BX.removeClass(a,"feed-com-block-pointer-to-new feed-com-block-new");BX.addClass(a,"feed-com-block-read");

t++}else{s.push(newCommentsToCheckForReading.data[r])}}}newCommentsToCheckForReading.data=s;if(t>0)BX.onCustomEvent(window,"onCounterDecrement",[t])}if(newCommentsToCheckForReading.data.length>0)newCommentsToCheckForReading.timeout=setTimeout(markReadComments,1e3);else{newCommentsToCheckForReading.timeout=0}};var MPLQuote=function(e){this.params=e;this.id=e["id"];this.closeByEsc=!!e["closeByEsc"];this.autoHide=!!e["autoHide"];this.autoHideTimeout=!!e["autoHideTimeout"]?parseInt(e["autoHideTimeout"]):0;if(this.params.classEvents){for(var t in this.params.classEvents)if(this.params.classEvents.hasOwnProperty(t))BX.addCustomEvent(this,t,this.params.classEvents[t])}this.node=document.createElement("A");BX.adjust(this.node,{props:{id:this.id},style:{zIndex:BX.PopupWindow.getOption("popupZindex")+this.params.zIndex,position:"absolute",display:"none",top:"0px",left:"0px"},attrs:{className:"mpl-quote-block",href:"#"},events:this.params.events});document.body.appendChild(this.node)};MPLQuote.prototype={show:function(e){var t=this.getPosition(this.node,e);BX.adjust(this.node,{style:{top:t.y+"px",left:t.x+"px",display:"block"}});BX.addClass(this.node,"mpl-quote-block-show");if(this.closeByEsc&&!this.isCloseByEscBinded){this.isCloseByEscBinded=BX.delegate(this._onKeyUp,this);BX.bind(document,"keyup",this.isCloseByEscBinded)}if(this.params.autoHide&&!this.isAutoHideBinded){setTimeout(BX.proxy(function(){BX.bind(this.node,"click",this.cancelBubble);this.isAutoHideBinded=BX.delegate(this.hide,this);BX.bind(document,"click",this.isAutoHideBinded)},this),0)}if(this.autoHideTimeout>0&&this.autoHideTimeoutInt<=0){if(!this.autoHideTimeoutBinded)this.autoHideTimeoutBinded=BX.delegate(this.hide,this);this.autoHideTimeoutInt=setTimeout(this.autoHideTimeoutBinded,this.autoHideTimeout)}},hide:function(e){if(!this.isShown())return;if(e&&!(BX.getEventButton(e)&BX.MSLEFT))return;this.node.style.display="none";if(this.isCloseByEscBinded){BX.unbind(document,"keyup",this.isCloseByEscBinded);this.isCloseByEscBinded=false}if(this.autoHideTimeout>0){clearTimeout(this.autoHideTimeoutInt);this.autoHideTimeoutInt=0}setTimeout(BX.proxy(this._hide,this),0)},_hide:function(){BX.onCustomEvent(this,"onQuoteHide",[this]);if(this.params.autoHide&&this.isAutoHideBinded){BX.unbind(this.node,"click",this.cancelBubble);BX.unbind(document,"click",this.isAutoHideBinded);this.isAutoHideBinded=false}BX.remove(this.node)},getPosition:function(e,t){var i;if(t.pageX==null){var s=document.documentElement,n=document.body;var o=t.clientX+(s&&s.scrollLeft||n&&n.scrollLeft||0)-(s.clientLeft||0);var a=t.clientY+(s&&s.scrollTop||n&&n.scrollTop||0)-(s.clientTop||0);i={x:o,y:a}}else{i={x:t.pageX,y:t.pageY}}return{x:i.x+5,y:i.y-16}},isShown:function(){return this.node.style.display=="block"},cancelBubble:function(e){if(!e)e=window.event;if(e.stopPropagation)e.stopPropagation();else e.cancelBubble=true},_onKeyUp:function(e){e=e||window.event;if(e.keyCode==27)this.hide(e)}};window.mplCheckForQuote=function(e,t,i,s){e=document.all?window.event:e;var n="",o,a=null;if(window.getSelection){o=window.getSelection();n=o.toString()}else if(document.selection){o=document.selection;n=o.createRange().text}if(n!=""){var r=BX.findParent(o.focusNode,{tagName:t.tagName,className:t.className},t),d=BX.findParent(o.anchorNode,{tagName:t.tagName,className:t.className},t);if(r!=d||r!=t){n=""}else{if(!!s&&BX(s,true)){var l=BX(s,true);if(!!l&&l.hasAttribute("bx-post-author-id")){a={id:parseInt(l.getAttribute("bx-post-author-id")),name:l.innerHTML}}}}}if(n!=""){BX.onCustomEvent(window,"onQuote"+i,[e,{text:n,author:a}]);return true}return false};window.mplReplaceUserPath=function(e){if(typeof e!="string"||e.length<=0){return""}if(BX("MPL_IS_EXTRANET_SITE")=="Y"){e=e.replace("/company/personal/user/","/extranet/contacts/personal/user/")}else{e=e.replace("/extranet/contacts/personal/user/","/company/personal/user/")}e=e.replace(new RegExp("[\\w/]*/mobile/users/\\?user_id=(\\d+)","igm"),BX("MPL_IS_EXTRANET_SITE")=="Y"?"/extranet/contacts/personal/user/$1/":"/company/personal/user/$1/");return e};BX.onCustomEvent("main.post.list/default",["script.js"])})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:99:"/bitrix/components/bitrix/main.post.list/templates/.default/scripts_for_form.min.js?151131647214797";s:6:"source";s:79:"/bitrix/components/bitrix/main.post.list/templates/.default/scripts_for_form.js";s:3:"min";s:83:"/bitrix/components/bitrix/main.post.list/templates/.default/scripts_for_form.min.js";s:3:"map";s:83:"/bitrix/components/bitrix/main.post.list/templates/.default/scripts_for_form.map.js";}"*/
(function(){window["UC"]=window["UC"]||{};if(!!window["FCForm"])return;window.FCForm=function(e){this.url="";this.lhe="";this.entitiesId={};this.form=BX(e["formId"]);this.handler=window.LHEPostForm.getHandler(e["editorId"]);this.editorName=e["editorName"];this.editorId=e["editorId"];this.windowEvents={OnUCUnlinkForm:BX.delegate(function(e){if(!!e&&!!this.entitiesId[e]){var t={},i=true;for(var s in this.entitiesId){if(this.entitiesId.hasOwnProperty(s)&&s!=e){i=false;t[s]=this.entitiesId[s]}}this.entitiesId=t;if(i&&!!this.windowEvents){for(s in this.windowEvents){if(this.windowEvents.hasOwnProperty(s)&&s)BX.removeCustomEvent(window,s,this.windowEvents[s])}this.windowEventsSet=false}}},this),OnUCUserQuote:BX.delegate(function(e,t,i,s,n){var o=BX.util.htmlspecialchars(i);if(this.entitiesId[e]){if(!this._checkTextSafety([e,0],s))return;this.show([e,0]);if(n!==true){this.handler.exec(this.windowEvents.OnUCUserQuote,[e,t,i,s,true])}else if(!this.handler.oEditor.toolbar.controls.Quote){BX.DoNothing()}else if(!t&&!i){this.handler.oEditor.action.Exec("quote")}else{i=o;if(this.handler.oEditor.GetViewMode()=="wysiwyg"){i=i.replace(/\n/g,"<br/>");if(t){if(t.id>0){t='<span id="'+this.handler.oEditor.SetBxTag(false,{tag:"postuser",params:{value:t.id}})+'" class="bxhtmled-metion">'+t.name.replace(/</gi,"&lt;").replace(/>/gi,"&gt;")+"</span>"}else{t="<span>"+t.name.replace(/</gi,"&lt;").replace(/>/gi,"&gt;")+"</span>"}t=t!==""?t+BX.message("MPL_HAVE_WRITTEN")+"<br/>":"";i=t+i}}else if(this.handler.oEditor.bbCode){if(t){if(t.id>0){t="[USER="+t.id+"]"+t.name+"[/USER]"}else{t=t.name}t=t!==""?t+BX.message("MPL_HAVE_WRITTEN")+"\n":"";i=t+i}}if(this.handler.oEditor.action.actions.quote.setExternalSelectionFromRange){this.handler.oEditor.action.actions.quote.setExternalSelectionFromRange();var r=this.handler.oEditor.action.actions.quote.getExternalSelection();if(r===""&&o!==""){r=o}r=(BX.type.isNotEmptyString(t)?t:"")+r;if(BX.type.isNotEmptyString(r))this.handler.oEditor.action.actions.quote.setExternalSelection(r)}else{this.handler.oEditor.action.actions.quote.setExternalSelection(i)}this.handler.oEditor.action.Exec("quote")}}},this),OnUCUserReply:BX.delegate(function(e,t,i,s){if(!this._checkTextSafety([e,0],s))return;if(this.entitiesId[e]){this.show([e,0]);if(t>0){this.handler.exec(window.BxInsertMention,[{item:{entityId:t,name:i},type:"users",formID:this.form.id,editorId:this.editorId,bNeedComa:true,insertHtml:true}])}}},this),OnUCAfterRecordEdit:BX.delegate(function(e,t,i,s){if(!!this.entitiesId[e]){if(s==="EDIT"){this.show([e,t],i["messageBBCode"],i["messageFields"]);this.editing=true}else{this.hide(true);if(!!i["errorMessage"]){this.id=[e,t];this.showError(i["errorMessage"])}else if(!!i["okMessage"]){this.id=[e,t];this.showNote(i["okMessage"]);this.id=null}}}},this),OnUCUsersAreWriting:BX.delegate(function(e,t,i,s,n){if(!!this.entitiesId[e]){this.showAnswering([e,0],t,i,s,n)}},this),OnUCRecordHasDrawn:BX.delegate(function(e,t,i){if(!!this.entitiesId[e]){var s=parseInt(i&&i["AUTHOR"]?i["AUTHOR"]["ID"]:0);if(s>0)this.hideAnswering([e,0],s)}},this)};this.linkEntity(e["entitiesId"]);BX.remove(BX("micro"+e["editorName"]));BX.remove(BX("micro"+e["editorId"]));this.eventNode=this.handler.eventNode;if(this.eventNode){BX.addCustomEvent(this.eventNode,"OnBeforeHideLHE",BX.delegate(function(){BX.removeClass(document.documentElement,"bx-ios-fix-frame-focus");if(top&&top["document"])BX.removeClass(top["document"]["documentElement"],"bx-ios-fix-frame-focus");if(!!this.id&&!!BX("uc-writing-"+this.form.id+"-"+this.id[0]))BX.hide(BX("uc-writing-"+this.form.id+"-"+this.id[0]))},this));BX.addCustomEvent(this.eventNode,"OnAfterHideLHE",BX.delegate(function(){var e=this._getPlacehoder();if(e){BX.hide(e)}e=this._getSwitcher();if(e){BX.show(e);BX.focus(e.firstChild)}this.__content_length=0;if(!!this.id){BX.onCustomEvent(this.eventNode,"OnUCFormAfterHide",[this]);this.showAnswering(this.id)}clearTimeout(this._checkWriteTimeout);this._checkWriteTimeout=0;this.clear();BX.onCustomEvent(window,"OnUCFeedChanged",[this.id])},this));BX.addCustomEvent(this.eventNode,"OnBeforeShowLHE",BX.delegate(function(){if(BX.browser.IsIOS()&&BX.browser.IsMobile()){BX.addClass(window["document"]["documentElement"],"bx-ios-fix-frame-focus");if(top&&top["document"])BX.addClass(top["document"]["documentElement"],"bx-ios-fix-frame-focus")}var e=this._getPlacehoder();if(e){BX.show(e)}e=this._getSwitcher();if(e){BX.hide(e)}if(!!this.id&&!!BX("uc-writing-"+this.form.id+"-"+this.id[0]))BX.hide(BX("uc-writing-"+this.form.id+"-"+this.id[0]))},this));BX.addCustomEvent(this.eventNode,"OnAfterShowLHE",BX.delegate(function(e,t){this._checkWrite(e,t);if(!!this.id)this.showAnswering(this.id);BX.onCustomEvent(window,"OnUCFeedChanged",[this.id])},this));BX.addCustomEvent(this.eventNode,"OnClickSubmit",BX.delegate(this.submit,this));BX.addCustomEvent(this.eventNode,"OnClickCancel",BX.delegate(this.cancel,this));BX.onCustomEvent(this.eventNode,"OnUCFormInit",[this])}this.id=null;this.jsCommentId=null};window.FCForm.prototype={linkEntity:function(e){if(!!e){for(var t in e){if(e.hasOwnProperty(t)){BX.onCustomEvent(window,"OnUCUnlinkForm",[t]);this.entitiesId[t]=e[t]}}}if(!this.windowEventsSet&&!!this.entitiesId){BX.addCustomEvent(window,"OnUCUnlinkForm",this.windowEvents.OnUCUnlinkForm);BX.addCustomEvent(window,"OnUCUserReply",this.windowEvents.OnUCUserReply);BX.addCustomEvent(window,"OnUCUserQuote",this.windowEvents.OnUCUserQuote);BX.addCustomEvent(window,"OnUCAfterRecordEdit",this.windowEvents.OnUCAfterRecordEdit);BX.addCustomEvent(window,"OnUCUsersAreWriting",this.windowEvents.OnUCUsersAreWriting);BX.addCustomEvent(window,"OnUCRecordHasDrawn",this.windowEvents.OnUCRecordHasDrawn);this.windowEventsSet=true}},_checkTextSafety:function(e,t){if(t===true){t=e;if(this.id&&this.id.join("-")!=e.join("-")&&this.handler.editorIsLoaded&&this.handler.oEditor.IsContentChanged())return window.confirm(BX.message("MPL_SAFE_EDIT"));return true}return t===false},_checkWrite:function(e,t){if(this.handler.editorIsLoaded&&this._checkWriteTimeout!==false){this.__content_length=this.__content_length>0?this.__content_length:0;var i=this.handler.oEditor.GetContent(),s=BX.delegate(function(){this._checkWrite(e,t)},this),n=2e3;if(i.length>=4&&this.__content_length!=i.length&&!!this.id){BX.onCustomEvent(window,"OnUCUserIsWriting",[this.id[0],this.id[1],this.jsCommentId]);n=3e4}this._checkWriteTimeout=setTimeout(s,n);this.__content_length=i.length}},_getPlacehoder:function(e){e=!!e?e:this.id;return!!e?BX("record-"+e.join("-")+"-placeholder"):null},_getSwitcher:function(e){e=!!e?e:this.id;return!!e?BX("record-"+e[0]+"-switcher"):null},hide:function(e){if(this.eventNode.style.display!="none"){BX.onCustomEvent(this.eventNode,"OnShowLHE",[e===true?false:"hide"])}if(e){document.body.appendChild(this.form)}},clear:function(){this.editing=false;var e=this._getPlacehoder();if(!!e)BX.hide(e);var t=BX.findChildren(e,{tagName:"DIV",className:"feed-add-error"},true);if(!!t){e=t.pop();do{BX.remove(e)}while((e=t.pop())&&e)}BX.onCustomEvent(this.eventNode,"OnUCFormClear",[this]);var i=BX.findChild(this.form,{className:"wduf-placeholder-tbody"},true,false);if(i!==null&&typeof i!="undefined")BX.cleanNode(i,false);i=BX.findChild(this.form,{className:"wduf-selectdialog"},true,false);if(i!==null&&typeof i!="undefined")BX.hide(i);i=BX.findChild(this.form,{className:"file-placeholder-tbody"},true,false);if(i!==null&&typeof i!="undefined")BX.cleanNode(i,false);this.id=null;this.jsCommentId=null},show:function(e,t,i){if(this.id&&!!e&&this.id.join("-")==e.join("-"))return true;else this.hide(true);this.id=e;this.jsCommentId=BX.util.getRandomString(20);var s=this._getPlacehoder();s.appendChild(this.form);BX.onCustomEvent(this.eventNode,"OnUCFormBeforeShow",[this,t,i]);BX.onCustomEvent(this.eventNode,"OnShowLHE",["show"]);BX.onCustomEvent(this.eventNode,"OnUCFormAfterShow",[this,t,i]);return true},submit:function(){if(this.busy===true)return"busy";var e=this.handler.editorIsLoaded?this.handler.oEditor.GetContent():"";if(!e){this.showError(BX.message("JERROR_NO_MESSAGE"));return false}this.showWait();this.busy=true;var t={};window.convertFormToArray(this.form,t);t["REVIEW_TEXT"]=e;t["NOREDIRECT"]="Y";t["MODE"]="RECORD";t["AJAX_POST"]="Y";t["id"]=this.id;if(this.jsCommentId!==null)t["COMMENT_EXEMPLAR_ID"]=this.jsCommentId;t["SITE_ID"]=BX.message("SITE_ID");t["LANGUAGE_ID"]=BX.message("LANGUAGE_ID");if(this.editing===true){t["REVIEW_ACTION"]="EDIT";t["FILTER"]={ID:this.id[1]}}BX.onCustomEvent(this.eventNode,"OnUCFormSubmit",[this,t]);BX.onCustomEvent(window,"OnUCFormSubmit",[this.id[0],this.id[1],this,t]);BX.ajax({method:"POST",url:this.form.action,data:t,dataType:"json",onsuccess:BX.proxy(function(e){this.closeWait();var t=e,i=this.id[0];BX.onCustomEvent(this.eventNode,"OnUCFormResponse",[this,e]);if(!!this.OnUCFormResponseData)e=this.OnUCFormResponseData;if(!!e){if(e["errorMessage"]){this.showError(e["errorMessage"])}else if(e["status"]=="error"){this.showError(BX.type.isNotEmptyString(e["message"])?e["message"]:"")}else{BX.onCustomEvent(window,"OnUCAfterRecordAdd",[this.id[0],e,t]);this.hide(true)}}this.busy=false;BX.onCustomEvent(window,"OnUCFormResponse",[i,e["messageId"],this,e])},this),onfailure:BX.delegate(function(){this.closeWait();this.busy=false;BX.onCustomEvent(window,"OnUCFormResponse",[this.id[0],this.id[1],this,[]])},this)})},cancel:function(){},showError:function(e){if(!e)return;var t=this._getPlacehoder(),i=BX.findChildren(t,{tagName:"DIV",className:"feed-add-error"},true);if(!!i){var s=i.pop();do{BX.remove(s);BX.remove(s)}while((s=i.pop())&&!!s)}t.insertBefore(BX.create("div",{attrs:{"class":"feed-add-error"},html:'<span class="feed-add-info-text"><span class="feed-add-info-icon"></span>'+"<b>"+BX.message("FC_ERROR")+"</b><br />"+e+"</span>"}),t.firstChild);BX.show(t)},showNote:function(e){if(!e)return;var t=this._getPlacehoder(),i=BX.findChildren(t,{tagName:"DIV",className:"feed-add-successfully"},true),s=null;if(!!i){while((s=i.pop())&&!!s){BX.remove(s)}}t.insertBefore(BX.create("div",{attrs:{"class":"feed-add-successfully"},html:'<span class="feed-add-info-text"><span class="feed-add-info-icon"></span>'+e+"</span>"}),t.firstChild);BX.show(t)},showWait:function(){var e=BX("lhe_button_submit_"+this.form.id);if(!!e){BX.addClass(e,"feed-add-button-load");BX.addClass(e,"feed-add-button-press");BX.defer(function(){e.disabled=true})()}},closeWait:function(){var e=BX("lhe_button_submit_"+this.form.id);if(!!e){e.disabled=false;BX.removeClass(e,"feed-add-button-press");BX.removeClass(e,"feed-add-button-load")}},objAnswering:null,showAnswering:function(e,t,i,s,n){t=t>0?t:0;if(t<=0)return;var o="uc-writing-"+this.form.id+"-"+e[0],r=BX(o+"-area"),a=this._getSwitcher(e),d=BX.localStorage.get("ucAnsweringStorage");d=!!d?d:{};if(!r&&a){r=BX.create("DIV",{attrs:{id:o+"-area",className:"feed-com-writers"},html:'<div id="'+o+'-users" class="feed-com-writers-wrap"></div><div class="feed-com-writers-pen"></div>'});a.appendChild(r)}if(!!r){if(t>0){if(!n){d["userId"+t]={id:e[0],userId:t,name:i,avatar:s,time:new Date};BX.localStorage.set("ucAnsweringStorage",d,3e3)}if(!BX(o+"-user-"+t)){BX.adjust(BX(o+"-users"),{children:[BX.create("DIV",{attrs:{className:"feed-com-avatar",id:o+"-user-"+t,title:i},children:[BX.create("IMG",{attrs:{src:s&&s.length>0?s:"/bitrix/images/1.gif"}})]})]})}}if(BX(o+"-users").childNodes.length>0){if(BX(r.parentNode).style.display=="none"){var h=BX("lhe_buttons_"+this.form.id);if(!h||h.style.display=="none")h=this.form;h.appendChild(r)}else if(r.parentNode!=a)a.appendChild(r);if(this.objAnswering&&this.objAnswering.name!="show")this.objAnswering.stop();if(!this.objAnswering||this.objAnswering.name!="show"){r.style.display="inline-block";this.objAnswering=new BX["easing"]({duration:500,start:{opacity:0},finish:{opacity:100},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(e){r.style.opacity=e.opacity/100}});this.objAnswering.name="show";this.objAnswering.animate()}var l=setTimeout(BX.delegate(function(){this.hideAnswering(e,t)},this),!!n?n:40500);if(BX(o+"-user-"+t)){clearTimeout(BX(o+"-user-"+t).getAttribute("bx-check-timeout"));BX(o+"-user-"+t).setAttribute("bx-check-timeout",l+"")}}}},hideAnswering:function(e,t){var i="uc-writing-"+this.form.id+"-"+e[0],s=BX(i+"-area"),n=BX(i+"-user-"+t,false);if(n&&s){if(BX(i+"-users").childNodes.length>1){new BX["easing"]({duration:500,start:{opacity:100},finish:{opacity:0},transition:BX["easing"].makeEaseOut(BX["easing"].transitions.quart),step:function(e){n.style.opacity=e.opacity/100},complete:function(){if(!!n&&!!n.parentNode)n.parentNode.removeChild(n)}}).animate()}else{if(this.objAnswering&&this.objAnswering.name!="hide")this.objAnswering.stop();if(!this.objAnswering||this.objAnswering.name!="hide"){this.objAnswering=new BX["easing"]({duration:500,start:{opacity:100},finish:{opacity:0},transition:BX["easing"].makeEaseOut(BX.easing.transitions.quart),step:function(e){s.style.opacity=e.opacity/100},complete:function(){s.style.display="none";if(!!n&&!!n.parentNode)n.parentNode.removeChild(n)}});this.objAnswering.name="hide";this.objAnswering.animate()}}}}};window.convertFormToArray=function(e,t){t=!!t?t:[];if(!!e){var i,s=[],n=e.elements.length;for(i=0;i<n;i++){var o=e.elements[i];if(o.disabled)continue;switch(o.type.toLowerCase()){case"text":case"textarea":case"password":case"hidden":case"select-one":s.push({name:o.name,value:o.value});break;case"radio":case"checkbox":if(o.checked)s.push({name:o.name,value:o.value});break;case"select-multiple":for(var r=0;r<o.options.length;r++){if(o.options[r].selected)s.push({name:o.name,value:o.options[r].value})}break;default:break}}var a=t;i=0;while(i<s.length){var d=s[i].name.indexOf("[");if(d==-1){a[s[i].name]=s[i].value;a=t;i++}else{var h=s[i].name.substring(0,d);var l=s[i].name.substring(d+1);if(!a[h])a[h]=[];var f=l.indexOf("]");if(f==-1){a=t;i++}else if(f===0){a=a[h];s[i].name=""+a.length}else{a=a[h];s[i].name=l.substring(0,f)+l.substring(f+1)}}}}return t};window.FCForm.onUCUsersAreWriting=function(){BX.ready(function(){var e=null,t=null,i=BX.localStorage.get("ucAnsweringStorage");if(!!i){for(var s in i){if(i.hasOwnProperty(s)){e=i[s];if(!!e&&e.userId>0){t=new Date-e.time;if(t<3e4){BX.onCustomEvent(window,"OnUCUsersAreWriting",[e.id,e.userId,e.name,e.avatar,t])}}}}}})};window["fRefreshCaptcha"]=function(e){var t=null,i=BX.findChild(e,{attr:{name:"captcha_code"}},true),s=BX.findChild(e,{attr:{name:"captcha_word"}},true),n=BX.findChild(e,{className:"comments-reply-field-captcha-image"},true);if(n)t=BX.findChild(n,{tag:"img"});if(i&&s&&t){s.value="";BX.ajax.getCaptcha(function(e){i.value=e["captcha_sid"];t.src="/bitrix/tools/captcha.php?captcha_code="+e["captcha_sid"]})}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:96:"/bitrix/components/bitrix/main.post.list/templates/.default/scripts_for_im.min.js?15113164728286";s:6:"source";s:77:"/bitrix/components/bitrix/main.post.list/templates/.default/scripts_for_im.js";s:3:"min";s:81:"/bitrix/components/bitrix/main.post.list/templates/.default/scripts_for_im.min.js";s:3:"map";s:81:"/bitrix/components/bitrix/main.post.list/templates/.default/scripts_for_im.map.js";}"*/
(function(){window["UC"]=!!window["UC"]?window["UC"]:{};if(!!window["UC"]["Informer"])return;window.SPC=function(){this.stack=[];this.stackTimeout=null;this.stackPopup={};this.stackPopupTimeout={};this.stackPopupTimeout2={};this.stackPopupId=0;this.stackOverflow=false;this.notifyShow=0;this.notifyHideTime=5e3;this.notifyHeightCurrent=10;this.notifyHeightMax=0;this.notifyGarbageTimeout=null;this.notifyAutoHide=true;this.notifyAutoHideTimeout=null};var t=window.SPC;t.prototype.add=function(t){if(typeof t!="object"||!t.html)return false;if(BX.type.isDomNode(t.html))t.html=t.html.outerHTML;this.stack.push(t);if(!this.stackOverflow)this.setShowTimer(300);return true};t.prototype.remove=function(t){delete this.stack[t]};t.prototype.show=function(){this.notifyHeightMax=document.body.offsetHeight;var t=BX.GetWindowInnerSize();for(var e=0;e<this.stack.length;e++){if(typeof this.stack[e]=="undefined")continue;var i=new BX.PopupWindow("bx-sbpc-notify-flash-"+this.stackPopupId,{top:0,left:0},{lightShadow:true,zIndex:200,events:{onPopupClose:BX.delegate(function(){BX.proxy_context.popupContainer.style.opacity=0;this.notifyShow--;this.notifyHeightCurrent-=BX.proxy_context.popupContainer.offsetHeight+10;this.stackOverflow=false;setTimeout(BX.delegate(function(){this.destroy()},BX.proxy_context),1500)},this),onPopupDestroy:BX.delegate(function(){BX.unbindAll(BX.findChild(BX.proxy_context.popupContainer,{className:"bx-spbc-notifier-item-delete"},true));BX.unbindAll(BX.proxy_context.popupContainer);delete this.stackPopup[BX.proxy_context.uniquePopupId];delete this.stackPopupTimeout[BX.proxy_context.uniquePopupId];delete this.stackPopupTimeout2[BX.proxy_context.uniquePopupId]},this)},bindOnResize:false,content:BX.create("div",{props:{className:"bx-notifyManager-item-sbpc"},html:this.stack[e].html})});i.notifyParams=this.stack[e];i.notifyParams.id=e;i.show();BX.removeClass(i.popupContainer.firstChild,"popup-window");if(BX("workarea")){var o=BX.pos(BX("workarea"));i.popupContainer.style.left=o.left-223+"px"}else i.popupContainer.style.left=10+"px";i.popupContainer.style.opacity=0;if(this.notifyHeightMax<this.notifyHeightCurrent+i.popupContainer.offsetHeight+10){if(this.notifyShow>0){i.destroy();this.stackOverflow=true;break}}BX.addClass(i.popupContainer,"bx-notifyManager-animation-spbc");new BX.easing({duration:500,start:{opacity:0},finish:{opacity:100},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(t){i.popupContainer.style.opacity=t.opacity/100}}).animate();i.popupContainer.style.top=t.innerHeight-this.notifyHeightCurrent-i.popupContainer.offsetHeight-10+"px";this.notifyHeightCurrent=this.notifyHeightCurrent+i.popupContainer.offsetHeight+10;this.stackPopupId++;this.notifyShow++;this.remove(e);this.stackPopupTimeout[i.uniquePopupId]=null;BX.bind(i.popupContainer,"mouseover",BX.delegate(function(){this.clearAutoHide()},this));BX.bind(i.popupContainer,"mouseout",BX.delegate(function(){this.setAutoHide(this.notifyHideTime/2)},this));BX.bind(i.popupContainer,"contextmenu",BX.delegate(function(t){if(this.stackPopup[BX.proxy_context.id].notifyParams.tag)this.closeByTag(this.stackPopup[BX.proxy_context.id].notifyParams.tag);else this.stackPopup[BX.proxy_context.id].close();return BX.PreventDefault(t)},this));var s=BX.findChildren(i.popupContainer,{tagName:"a"},true);for(var n=0;n<s.length;n++){if(s[n].href!="#")s[n].target="_blank"}BX.bind(BX.findChild(i.popupContainer,{className:"bx-spbc-notifier-item-delete"},true),"click",BX.delegate(function(t){var e=BX.proxy_context.parentNode.parentNode.parentNode.parentNode.id.replace("popup-window-content-","");if(this.stackPopup[e].notifyParams.close)this.stackPopup[e].notifyParams.close(this.stackPopup[e]);this.stackPopup[e].close();if(this.notifyAutoHide===false){this.clearAutoHide();this.setAutoHide(this.notifyHideTime/2)}return BX.PreventDefault(t)},this));if(i.notifyParams.click){i.popupContainer.style.cursor="pointer";BX.bind(i.popupContainer,"click",BX.delegate(function(t){this.notifyParams.click(this);return BX.PreventDefault(t)},i))}this.stackPopup[i.uniquePopupId]=i}if(this.stack.length>0){this.clearAutoHide(true);this.setAutoHide(this.notifyHideTime)}this.garbage()};t.prototype.closeByTag=function(t){for(var e=0;e<this.stack.length;e++){if(typeof this.stack[e]!="undefined"&&this.stack[e].tag==t){delete this.stack[e]}}for(e in this.stackPopup){if(this.stackPopup.hasOwnProperty(e))if(this.stackPopup[e].notifyParams.tag==t)this.stackPopup[e].close()}};t.prototype.setShowTimer=function(t){clearTimeout(this.stackTimeout);this.stackTimeout=setTimeout(BX.delegate(this.show,this),t)};t.prototype.setAutoHide=function(t){this.notifyAutoHide=true;clearTimeout(this.notifyAutoHideTimeout);this.notifyAutoHideTimeout=setTimeout(BX.delegate(function(){for(var e in this.stackPopupTimeout){if(this.stackPopupTimeout.hasOwnProperty(e)){this.stackPopupTimeout[e]=setTimeout(BX.delegate(function(){this.close()},this.stackPopup[e]),t-1e3);this.stackPopupTimeout2[e]=setTimeout(BX.delegate(function(){this.setShowTimer(300)},this),t-700)}}},this),1e3)};t.prototype.clearAutoHide=function(t){clearTimeout(this.notifyGarbageTimeout);this.notifyAutoHide=false;t=t===true;var e;if(t){clearTimeout(this.stackTimeout);for(e in this.stackPopupTimeout){if(this.stackPopupTimeout.hasOwnProperty(e)){clearTimeout(this.stackPopupTimeout[e]);clearTimeout(this.stackPopupTimeout2[e])}}}else{clearTimeout(this.notifyAutoHideTimeout);this.notifyAutoHideTimeout=setTimeout(BX.delegate(function(){clearTimeout(this.stackTimeout);for(var t in this.stackPopupTimeout){if(this.stackPopupTimeout.hasOwnProperty(t)){clearTimeout(this.stackPopupTimeout[t]);clearTimeout(this.stackPopupTimeout2[t])}}},this),300)}};t.prototype.garbage=function(){clearTimeout(this.notifyGarbageTimeout);this.notifyGarbageTimeout=setTimeout(BX.delegate(function(){var t=[];for(var e=0;e<this.stack.length;e++){if(typeof this.stack[e]!="undefined")t.push(this.stack[e])}this.stack=t},this),1e4)};t.prototype.check=function(t,e,i,o){if(t[1]<=0||!window["UC"]["Informer"]||!BX.type.isNotEmptyString(o))return;var s=/(\d+)/g.exec(t[0]),n=BX("record-"+t.join("-")+"-cover");s=!!s?parseInt(s):0;if(s<=0||!n)return false;else if(BX.util.in_array(s,window["UC"]["InformerTags"][i]))return true;window["UC"]["InformerTags"][i].push(s);var a=!!e&&!!e["messageFields"]?e["messageFields"]:false;if(!a)return;var r=BX.pos(n),p=BX.GetWindowScrollPos(),u=BX.GetWindowInnerSize();if(r.top<p.scrollTop||r.top>p.scrollTop+u.innerHeight-20){setTimeout(function(){if(parseInt(a["AUTHOR"]["ID"])!=parseInt(BX.message("USER_ID"))){var e=BX.create("div",{props:{className:"bx-spbc-notifier-item"},children:[BX.create("span",{props:{className:"bx-spbc-notifier-item-content"},children:[BX.create("span",{props:{className:"bx-spbc-notifier-item-avatar"},children:[!!a["AUTHOR"]["AVATAR"]?BX.create("img",{props:{className:"bx-spbc-notifier-item-avatar-img"},attrs:{src:a["AUTHOR"]["AVATAR"]}}):""]}),BX.create("a",{attrs:{href:"#"},props:{className:"bx-spbc-notifier-item-delete"}}),BX.create("span",{props:{className:"bx-spbc-notifier-item-name"},html:a["AUTHOR"]["NAME"]}),BX.create("span",{props:{className:"bx-spbc-notifier-item-time"},html:a["POST_TIME"]}),BX.create("span",{props:{className:"bx-spbc-notifier-item-text"}}),BX.create("span",{props:{className:"bx-spbc-notifier-item-text2"},html:'"'+o+'"'})]})]}),i=BX.GetWindowScrollPos();window["UC"]["Informer"].add({html:e,tag:"im-record-"+t.join("-"),click:BX.delegate(function(){var e=BX.pos(BX("record-"+t.join("-")));new BX.easing({duration:500,start:{scroll:i.scrollTop},finish:{scroll:e.top-100},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(t){window.scrollTo(0,t.scroll)}}).animate()},this)})}},50)}};t.NativeNotify=function(){return window.webkitNotifications&&window.webkitNotifications.checkPermission()==0};window["UC"]["Informer"]=new t;window["UC"]["InformerTags"]={};t.notifyManagerShow=function(){BX.ready(function(){BX.addCustomEvent("onNotifyManagerShow",function(t){if(t.originalTag){var e=t.originalTag.lastIndexOf("|"),i=t.originalTag.substr(0,e);if(!!window["UC"]["InformerTags"][i]){var o=parseInt(t.originalTag.substr(e+1));window["UC"]["InformerTags"][i].push(o)}}})})}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:89:"/bitrix/components/bitrix/main.post.form/templates/.default/script.min.js?151131647264627";s:6:"source";s:69:"/bitrix/components/bitrix/main.post.form/templates/.default/script.js";s:3:"min";s:73:"/bitrix/components/bitrix/main.post.form/templates/.default/script.min.js";s:3:"map";s:73:"/bitrix/components/bitrix/main.post.form/templates/.default/script.map.js";}"*/
(function(){if(window["LHEPostForm"])return;var e={controller:{},handler:{}};BX.addCustomEvent(window,"BFileDLoadFormControllerWasBound",function(t){e.controller[t.id]=true});BX.addCustomEvent(window,"WDLoadFormControllerInit",function(t){e.controller[t.CID]=t});BX.addCustomEvent(window,"WDLoadFormControllerWasBound",function(t){e.controller[t.CID]=true});BX.addCustomEvent(window,"DiskDLoadFormControllerInit",function(t){e.controller[t.CID]=t});BX.addCustomEvent(window,"DiskLoadFormControllerWasBound",function(t){e.controller[t.CID]=true});BX.addCustomEvent(window,"OnEditorInitedBefore",function(t){if(e.handler[t.id]){t.__lhe_flags=["OnEditorInitedBefore"];if(e.handler[t.id]["params"]&&e.handler[t.id]["params"]["LHEJsObjName"])window[e.handler[t.id].params["LHEJsObjName"]]=t;e.handler[t.id].OnEditorInitedBefore(t)}});var t=function(t){if(e.handler[t.id]&&e.handler[t.id].editorIsLoaded!==true){e.handler[t.id].editorIsLoaded=true;e.handler[t.id].exec();BX.onCustomEvent(e.handler[t.id],"OnEditorIsLoaded",[e.handler[t.id],t])}};BX.addCustomEvent(window,"OnCreateIframeAfter",t);BX.addCustomEvent(window,"OnEditorInitedAfter",function(i,n){if(e.handler[i.id]){i.__lhe_flags.push("OnEditorInitedAfter");e.handler[i.id].OnEditorInitedAfter(i);if(e.handler[i.id].editorIsLoaded!==true&&n&&i.sandbox&&i.sandbox.inited)t.apply(i,[i])}});BX.util.object_search=function(e,t){for(var i in t){if(t.hasOwnProperty(i)){if(t[i]==e)return true;else if(typeof t[i]=="object"&&t[i]!==null){var n=BX.util.object_search_key(e,t[i]);if(n!==false)return n}}}return false};var i=function(e,t,i){i=i&&i.length>0?i:[];if(typeof t=="object"&&t.length>0){var n;while((n=t.pop())&&n&&t.length>0){i.push(n)}t=n}i.push(t);this.exist=true;this.bxTag=e;this.tag=t;this.tags=i;this.regexp=new RegExp("\\[("+i.join("|")+")=((?:\\s|\\S)*?)(?:\\s*?WIDTH=(\\d+)\\s*?HEIGHT=(\\d+))?\\]","ig");this.code="["+t+"=#ID##ADDITIONAL#]";this.wysiwyg='<span style="color: #2067B0; border-bottom: 1px dashed #2067B0; margin:0 2px;" id="#ID#"#ADDITIONAL#>#NAME#</span>'},n=function(t,i,n){this.CID=this.id=i;this.parser=t.parser["disk_file"]||null;this.params=n;this.node=BX("diskuf-selectdialog-"+i);this.handler=e.controller[i];this.manager=t;this.eventNode=this.manager.eventNode;this.parserName="disk_file";this.prefixNode="disk-edit-attach";this.prefixHTMLNode="disk-attach-";this.props={valueEditClassName:"wd-inline-file",securityCID:"disk-upload-cid"};this.storage="disk";this.fileToAttach={};this.xmlToAttach={};this.events={onInit:"DiskDLoadFormControllerInit",onShow:"DiskLoadFormController",onBound:"DiskLoadFormControllerWasBound"}};n.prototype={parser:false,eventNode:null,values:{},initialized:false,functionsToExec:[],exec:function(e,t){if(typeof e=="function")this.functionsToExec.push([e,t]);if(this.handler&&this.handler!==true){var i;while((i=this.functionsToExec.shift())&&i)i[0].apply(this,i[1])}},init:function(){if(this.initialized!==true){this.values={};this.functionsToExec=[];this.initialized=true;this.bindMainEvents(this.manager);if(this.parser!==null){this.bindEvents(this.manager);return this.initValues()}}return false},initValues:function(){var e=BX.findChildren(this.node,{className:this.props.valueEditClassName},true);if(e&&e.length>0){this.exec(this.runCheckText);return true}return false},bindMainEvents:function(t){var i=null;BX.addCustomEvent(t.eventNode,"onReinitializeBefore",BX.proxy(this.clean,this));BX.addCustomEvent(t.eventNode,"onShowControllers",BX.proxy(function(e){i=e;BX.onCustomEvent(t.eventNode,this.events.onShow,[e])},this));if(!e.controller[this.id]){var o=BX.delegate(function(e){if(e["UID"]==this.id||e["id"]==this.id){if(i==="show"||i==="hide"){BX.onCustomEvent(t.eventNode,this.events.onShow,[i]);i=null}BX.removeCustomEvent(window,this.events.onBound,o)}},this);BX.addCustomEvent(window,this.events.onBound,o)}if(BX["DD"]&&this.storage=="disk"){var s=BX.delegate(function(e){if((e["UID"]==this.id||e["id"]==this.id)&&this.manager["dropZoneExists"]!==true){BX.removeCustomEvent(window,this.events.onBound,s);this.manager["dropZoneExists"]=true;var i=this.eventNode,o=this.id;n.dndCatcher=n.dndCatcher||{};n.dndCatcher[o]={"catch":true,files:[],dropZone:null,dropZoneMicro:null,initdrag:BX.delegate(function(){n.dndCatcher[o].dropZone=new BX.DD.dropFiles(t.eventNode);BX.addCustomEvent(t.eventNode,"OnImageDataUriHandle",BX.delegate(function(e,t){if(BX["UploaderUtils"]){var i=BX.UploaderUtils.dataURLToBlob(t.src);if(i&&i.size>0&&i.type.indexOf("image/")==0){i.name=i.name||t.title||"image."+i.type.substr(6);i.referrerToEditor=t;if(n.dndCatcher[o]["catch"]===true)n.dndCatcher[o]["drop"]([i]);else if(this.handler&&this.handler["addFile"])this.handler.addFile(i);BX.onCustomEvent(e,"OnImageDataUriCaught",[t])}}},this));BX.addCustomEvent(n.dndCatcher[o].dropZone,"dropFiles",n.dndCatcher[o]["drop"]);BX.addCustomEvent(n.dndCatcher[o].dropZone,"dragEnter",n.dndCatcher[o]["dragover"]);BX.addCustomEvent(n.dndCatcher[o].dropZone,"dragLeave",n.dndCatcher[o]["dragleave"]);if(BX("micro"+t.__divId)){n.dndCatcher[o].dropZoneMicro=new BX.DD.dropFiles(BX("micro"+t.__divId));BX.addCustomEvent(n.dndCatcher[o].dropZoneMicro,"dragEnter",function(){BX.onCustomEvent(t.eventNode,"OnShowLHE",["justShow"])})}BX.unbind(document,"dragover",n.dndCatcher[o]["initdrag"]);BX.onCustomEvent(t.eventNode,"onDropZoneExists",[])},this),dragover:BX.delegate(function(){BX.addClass(t.eventNode,"feed-add-post-dnd-over");BX.onCustomEvent(t.eventNode,"dragover",[])},this),dragleave:BX.delegate(function(){BX.removeClass(t.eventNode,"feed-add-post-dnd-over");BX.onCustomEvent(t.eventNode,"dragleave",[])},this),dragenterwindow:BX.delegate(function(){BX.addClass(t.eventNode,"feed-add-post-dnd-ready");if(BX("micro"+t.__divId)){BX.addClass(BX("micro"+t.__divId),"feed-add-post-micro-dnd-ready")}BX.onCustomEvent(t.eventNode,"dragenterwindow",[])},this),dragleavewindow:BX.delegate(function(e){BX.removeClass(t.eventNode,"feed-add-post-dnd-ready");if(BX("micro"+t.__divId)){BX.removeClass(BX("micro"+t.__divId),"feed-add-post-micro-dnd-ready")}BX.onCustomEvent(t.eventNode,"dragleavewindow",[])},this),drop:BX.delegate(function(e){BX.onCustomEvent(t.eventNode,"drop",[]);BX.onCustomEvent(window,"dragWindowLeave");BX.onCustomEvent(window,"__dragWindowLeave");var i=0;if(e&&e.length>0){if(n.dndCatcher[o]["catch"]===true){n.dndCatcher[o].files=e;i=1}else{i=2}BX.onCustomEvent(t.eventNode,this.events.onShow,["show"]);BX.removeClass(t.eventNode,"feed-add-post-dnd-ready feed-add-post-dnd-over")}return i},this)};BX.ready(function(){n.dndCatcher[o]["initdrag"]()});BX.addCustomEvent(i,"OnIframeDrop",BX.delegate(function(e){BX.PreventDefault(e);if(e["dataTransfer"]&&e["dataTransfer"]["files"]){if(n.dndCatcher[o].drop(e["dataTransfer"]["files"])===2){this.handler.agent.onChange(e["dataTransfer"]["files"])}}},this));BX.addCustomEvent(i,"OnIframeDragOver",n.dndCatcher[o].dragover);BX.addCustomEvent(i,"OnIframeDragLeave",n.dndCatcher[o].dragleave);if(!window["bxMpfDndCatcher"]){window["bxMpfDndCatcher"]=true;var a=false,r=function(){if(a===false){a=true;BX.bind(document,"dragleave",l);BX.bind(document,"dragover",l);BX.bind(document,"mouseout",d);BX.onCustomEvent(window,"dragWindowEnter")}},d=function(e){BX.unbind(document,"dragleave",l);BX.unbind(document,"dragover",l);BX.unbind(document,"mouseout",d);a=false;BX.onCustomEvent(window,"dragWindowLeave")},l=function(e){if(h>0){clearTimeout(h);h=0}BX.fixEventPageXY(e);var t=true;if(e.pageX>0&&e.pageY>0){var i=BX.GetWindowSize();if(e.pageY<i.scrollHeight&&e.pageX<i.scrollWidth){var n=e.pageY-i.scrollTop,o=e.pageX-i.scrollLeft;if(0<n&&n<i.innerHeight-20&&0<o&&o<i.innerWidth-20){t=false}}}if(t){d(e)}else{h=setTimeout(function(){l({type:"intervalLimit"})},100)}},h=0;BX.bind(document,"dragenter",function(e){if(window["bxMpfDndCatcher"]>0){clearTimeout(window["bxMpfDndCatcher"])}var t=true;if(e&&e["dataTransfer"]&&e["dataTransfer"]["types"]){for(var i=0;i<e["dataTransfer"]["types"].length;i++){if(e["dataTransfer"]["types"][i]=="Files"){t=true;break}}}if(t){r()}});BX.addCustomEvent(window,"__dragWindowLeave",d);BX.bind(document,"dragover",function(e){return BX.PreventDefault(e)});BX.bind(document,"drop",function(e){d(e);return BX.PreventDefault(e)})}BX.addCustomEvent(window,"dragWindowEnter",n.dndCatcher[o].dragenterwindow);BX.addCustomEvent(window,"dragWindowLeave",n.dndCatcher[o].dragleavewindow);this.__initCatcher=BX.delegate(function(e,i){if(e==this.id){BX.removeCustomEvent(t.eventNode,"onControllerInitialized",this.__initCatcher);i.agent.initDropZone(t.eventNode);if(n.dndCatcher[e].files.length>0){i.agent.onChange(n.dndCatcher[e].files);n.dndCatcher[e].files=[]}n.dndCatcher[e]["catch"]=false;this.__initCatcher=null}},this);BX.addCustomEvent(t.eventNode,"onControllerInitialized",this.__initCatcher)}},this);BX.addCustomEvent(window,this.events.onBound,s);if(e.controller[this.id])s(e.controller[this.id])}},bindEvents:function(e){this._catchHandler=BX.delegate(function(t){BX.removeCustomEvent(this.eventNode,this.events.onInit,this._catchHandler);this.handler=t;var i=BX.findChild(BX(e.formID),{attr:{id:this.props.securityCID}},true,false);if(i)i.value=this.handler.CID;this.exec();var n=BX.delegate(function(){BX.onCustomEvent(e.eventNode,"onUploadsHasBeenChanged",arguments)},this);BX.addCustomEvent(this.handler.agent,"onFileIsInited",n);BX.addCustomEvent(this.handler.agent,"ChangeFileInput",n);BX.onCustomEvent(e.eventNode,"onControllerInitialized",[this.id,t])},this);if(typeof this.handler!="object"||!this.handler)BX.addCustomEvent(e.eventNode,this.events.onInit,this._catchHandler);else this._catchHandler(this.handler);BX.addCustomEvent(e.eventNode,"OnFileUploadSuccess",BX.delegate(function(e,t,i){if(this.id==t.CID||this.id==t.id){i=i||{};i.usePostfix=true;this.addFile(e,i,t)}},this));BX.addCustomEvent(e.eventNode,"OnFileUploadFailed",BX.delegate(function(e,t,i){if(this.id==t.CID||this.id==t.id){this.failFile(e,i,t)}},this));BX.addCustomEvent(e.eventNode,"OnFileUploadRemove",BX.delegate(function(e,t){if(this.id==t.CID||this.id==t.id){this.deleteFile(e,{usePostfix:true},t)}},this));BX.addCustomEvent(this,"onFileIsInText",BX.proxy(function(e,t){this.adjustFile(this.checkFile(e),t)},this))},addFile:function(e,t,i){var n=this.checkFile(e.element_id,e,t);if(n){setTimeout(BX.proxy(function(){this.bindFile(n);this.adjustFile(n,false)},this),100);BX.onCustomEvent(this.eventNode,"onFileIsAdded",[n,this,i,t])}else{this.failFile(this,t,i)}return true},failFile:function(e,t,i){BX.onCustomEvent(this.eventNode,"onFileIsFailed",[this,i,t])},checkFile:function(e,t){e=""+(typeof e=="object"?e.id:e);if(typeof t=="object"&&t!==null&&e&&t.element_name&&BX(t.place)){var i={id:e,name:t.element_name,url:t.element_url,type:"isnotimage/xyz",isImage:false,place:BX(t.place,true),xmlID:BX(t.place,true).getAttribute("bx-attach-xml-id"),fileID:BX(t.place,true).getAttribute("bx-attach-file-id")},n;if(/(\.png|\.jpg|\.jpeg|\.gif|\.bmp)$/i.test(t.element_name)&&(n=BX.findChild(i.place,{className:"files-preview",tagName:"IMG"},true,false))&&n){i.type="image/xyz";i.lowsrc=n.src;i.element_url=i.src=n.src.replace(/\Wwidth=(\d+)/,"").replace(/\Wheight=(\d+)/,"");i.isImage=true;i.width=parseInt(n.getAttribute("data-bx-full-width")||n.getAttribute("data-bx-width"));i.height=parseInt(n.getAttribute("data-bx-full-height")||n.getAttribute("data-bx-height"))}if(i.xmlID)this.xmlToAttach[i.xmlID+""]=e;if(i.fileID)this.fileToAttach[i.fileID+""]=e;this.values[e]=i}return this.values[e]||false},bindFile:function(e){var t=e.place;if(typeof e=="object"&&t&&!t.hasAttribute("bx-file-is-bound")){var i=BX.findChild(t,{className:"f-wrap"},true,false),n=BX.findChild(t,{className:"files-preview"},true,false);if(i){BX.bind(i,"click",BX.delegate(function(){this.insertFile(e.id)},this));i.style.cursor="pointer";i.title=BX.message("MPF_FILE")}if(n){BX.bind(n,"click",BX.delegate(function(){this.insertFile(e.id)},this))}}},adjustFile:function(e,t){var i=e.place;if(t===true||t===false){if(!e.info)e.info=BX.findChild(e.place,{className:"files-info"},true,false);i=e.info;if(BX.type.isDomNode(i)){var n="check-in-text-"+e.id,o=BX(n),s=t===false?{attrs:{"bx-file-is-in-text":"N"},props:{className:"insert-btn"},html:'<span class="insert-btn-text">'+BX.message("MPF_FILE_INSERT_IN_TEXT")+"</span>"}:{attrs:{"bx-file-is-in-text":"Y"},props:{className:"insert-text"},html:'<span class="insert-btn-text">'+BX.message("MPF_FILE_IN_TEXT")+"</span>"};if(!o){s.attrs.id=n;s.events={click:BX.proxy(function(){this.insertFile(e.id)},this)};i.appendChild(BX.create("SPAN",s))}else{BX.adjust(o,s)}}}},insertFile:function(e){BX.onCustomEvent(this.eventNode,"onFileIsInserted",[this.checkFile(e),this])},deleteFile:function(e,t){e=this.checkFile(e,t);if(e){BX.onCustomEvent(this.eventNode,"onFileIsDeleted",[e,this]);this.values[e.id].place=null;delete this.values[e.id].place;this.values[e.id]=null;delete this.values[e.id];e=null;return true}return false},reinitValues:function(e,t){var i,n,o={};while((i=t.pop())&&i){n=BX(this.prefixHTMLNode+i);n=n?n.tagName=="A"?n:BX.findChild(n,{tagName:"IMG"},true):null;if(n){o["E"+i]={type:"file",id:i,name:n.getAttribute("data-bx-title"),size:n.getAttribute("data-bx-size"),sizeInt:n.getAttribute("data-bx-size"),width:n.getAttribute("data-bx-width"),height:n.getAttribute("data-bx-height"),storage:"disk",previewUrl:n.tagName=="A"?"":n.getAttribute("data-bx-src"),fileId:n.getAttribute("bx-attach-file-id")};if(n.hasAttribute("bx-attach-xml-id"))o["E"+i]["xmlId"]=n.getAttribute("bx-attach-xml-id")}}this.handler.selectFile({},{},o);this.runCheckText()},runCheckText:function(){if(!this._checkText)this._checkText=BX.delegate(this.checkText,this);this.manager.exec(this._checkText)},checkText:function(){var e,t=this.manager.getContent(),i=[],n,o;if(t!=""){e=t;for(o in this.xmlToAttach){if(this.xmlToAttach.hasOwnProperty(o)){t=t.replace(new RegExp("\\&\\#91\\;DOCUMENT ID=("+o+")([WIDTHHEIGHT=0-9 ]*)\\&\\#93\\;","gim"),"["+this.parser["tag"]+"="+this.xmlToAttach[o]+"$2]").replace(new RegExp("\\[DOCUMENT ID=("+o+")([WIDTHHEIGHT=0-9 ]*)\\]","gim"),"["+this.parser["tag"]+"="+this.xmlToAttach[o]+"$2]")}}for(o in this.fileToAttach){if(this.fileToAttach.hasOwnProperty(o)){t=t.replace(new RegExp("\\&\\#91\\;"+this.parser["tag"]+"=("+o+")([WIDTHHEIGHT=0-9 ]*)\\&\\#93\\;","gim"),"["+this.parser["tag"]+"="+this.fileToAttach[o]+"$2]").replace(new RegExp("\\["+this.parser["tag"]+"=("+o+")([WIDTHHEIGHT=0-9 ]*)\\]","gim"),"["+this.parser["tag"]+"="+this.fileToAttach[o]+"$2]")}}n=new RegExp("(?:\\&\\#91\\;)("+this.parser["tags"].join("|")+")=([a-z=0-9 ]+)(?:\\&\\#93\\;)","gim");if(n.test(t)){for(o in this.values){if(this.values.hasOwnProperty(o)){i.push(o)}}if(i.length>0){n=new RegExp("(?:\\&\\#91\\;|\\[)("+this.parser["tags"].join("|")+")=("+i.join("|")+")([WIDTHHEIGHT=0-9 ]*)(?:\\&\\#93\\;|\\])","gim");if(n.test(t))t=t.replace(n,BX.delegate(function(e,t,i,n){return"["+t+"="+i+n+"]"},this))}}if(e!=t)BX.onCustomEvent(this.eventNode,"onFileIsDetected",[t,this])}return t},clean:function(){if(this.handler&&this.handler.values){var e,t,i,n=BX(this.manager.formID);while((e=this.handler.values.pop())&&e){BX.remove(e)}if(this.handler.params&&this.handler.params.controlName){t=BX.findChildren(n,{tagName:"INPUT",attribute:{name:this.handler.params.controlName}},true)}if(t){for(i=0;i<t.length;i++){BX.remove(t[i])}}}},reinit:function(e,t){var i=[],n,o;for(n in t){if(t.hasOwnProperty(n)){if(t[n]["USER_TYPE_ID"]==this.parserName&&t[n]["VALUE"]){for(o in t[n]["VALUE"]){if(t[n]["VALUE"].hasOwnProperty(o)){i.push(t[n]["VALUE"][o])}}}}}if(i.length>0){this.exec(this.reinitValues,[e,i]);return true}return false}};var o=function(e,t,i){o.superclass.constructor.apply(this,arguments);this.parser=e.parser["webdav_element"]||null;this.node=BX("wduf-selectdialog-"+t);this.manager=e;this.parserName="webdav_element";this.prefixNode="wd-doc";this.prefixHTMLNode="wdif-doc-";this.storage="webdav";this.events={onInit:"WDLoadFormControllerInit",onShow:"WDLoadFormController",onBound:"WDLoadFormControllerWasBound"}};BX.extend(o,n);o.prototype.reinitValues=function(e,t){var i,n,o={};this.waitAnswerFromServer=[];while((i=t.pop())&&i){n=BX(this.prefixHTMLNode+i);n=n?n.tagName=="A"?n:BX.findChild(n,{tagName:"IMG"},true):null;if(n){o["E"+i]={type:"file",id:i,name:n.getAttribute("alt"),storage:"webdav",size:n.getAttribute("data-bx-size"),sizeInt:1,ext:"",link:n.getAttribute("data-bx-document")};if(n.hasAttribute("bx-attach-xml-id"))o["E"+i]["xmlId"]=n.getAttribute("bx-attach-xml-id");this.waitAnswerFromServer.push(i)}}if(this.waitAnswerFromServer.length>0){if(!this._defferCheckText)this._defferCheckText=BX.delegate(this.defferCheckText,this);BX.addCustomEvent(this.eventNode,"OnFileUploadSuccess",this._defferCheckText);this.handler.WDFD_SelectFile({},{},o)}};o.prototype.defferCheckText=function(e){var t=BX.util.array_search(e.element_id,this.waitAnswerFromServer);if(t>=0){this.runCheckText();this.waitAnswerFromServer=BX.util.deleteFromArray(this.waitAnswerFromServer,t)}if(this.waitAnswerFromServer.length<=0)BX.removeCustomEvent(this.eventNode,"OnFileUploadSuccess",this._defferCheckText)};var s=function(e,t,i){s.superclass.constructor.apply(this,arguments);this.parser=e.parser["file"]?e.parser["file"]:e.parser["postimage"]["exist"]?e.parser["postimage"]:null;this.postfix=i["postfix"]||"";this.node=BX("file-selectdialog-"+t);this.parserName="file";this.prefixNode="wd-doc";this.prefixHTMLNode="file-doc-";this.props={valueEditClassName:"file-inline-file",securityCID:"upload-cid"};this.storage="bfile";this.events={onInit:"BFileDLoadFormControllerInit",onShow:"BFileDLoadFormController",onBound:"BFileDLoadFormControllerWasBound"}};BX.extend(s,n);s.prototype.initValues=function(e){var t;if(e!==true){t=BX.findChildren(this.node,{className:this.props.valueEditClassName},true);if(t&&t.length>1){this.exec(this.initValues,[true]);return true}return false}t=this.handler.agent.values||[];var i,n,o,s,a={},r="/bitrix/components/bitrix/main.file.input/file.php?mfi_mode=down&cid="+this.handler.CID+"&sessid="+BX.bitrix_sessid();for(var d=0;d<t.length;d++){s=parseInt(t[d].getAttribute("id").replace(this.prefixNode,""));if(a["id"+s])continue;a["id"+s]="Y";if(s>0){n=BX.findChild(t[d],{className:"f-wrap"},true,false);if(!n)continue;o={element_id:s,element_name:n.innerHTML,parser:this.parser.bxTag,storage:"bfile",element_url:r+"&fileID="+s};i=this.addFile(o,{usePostfix:true,hasPreview:false})}}this.runCheckText();return true};s.prototype.checkFile=function(e,t,i){e=""+(typeof e=="object"?e.id:e);e=e+(i&&i["usePostfix"]===true?this.postfix:"");if(typeof t=="object"&&t!==null&&e&&t.element_name&&BX(this.prefixNode+t.element_id,true)){var n={id:e,name:t.element_name,url:t.element_url,type:"isnotimage/xyz",isImage:false,place:BX(this.prefixNode+t.element_id,true)},o;if((t["element_type"]&&t["element_type"].indexOf("image/")===0||/(\.png|\.jpg|\.jpeg|\.gif|\.bmp)$/i.test(t.element_name))&&((o=BX.findChild(n.place,{tagName:"IMG"},true,false))&&o||i&&i["hasPreview"]===false)){n.type="image/xyz";n.src=t["element_thumbnail"]||t["element_url"];n.isImage=true;n.hasPreview=false;n.lowsrc="";n.width="";n.height="";if(BX(o)){n.hasPreview=true;n.lowsrc=t["element_thumbnail"]||o["src"];n.width=parseInt(o.getAttribute("data-bx-full-width"));n.height=parseInt(o.getAttribute("data-bx-full-height"))}}else if(this.parser.bxTag=="postimage"){return false}this.values[e]=n}return this.values[e]||false};s.prototype.bindFile=function(e){var t=e&&e["place"]?e["place"]:null;if(typeof e=="object"&&t&&!t.hasAttribute("bx-file-is-bound")){if(e.isImage&&e.hasPreview){var i=BX.findChild(t,{className:"feed-add-img-title"},true,false),n=BX.findChild(t,{className:"feed-add-img-wrap"},true,false);if(n){BX.bind(n,"click",BX.proxy(function(){this.insertFile(e)},this));n.style.cursor="pointer";n.title=BX.message("MPF_IMAGE")}if(i){BX.bind(i,"click",BX.delegate(function(){this.insertFile(e)},this));i.style.cursor="pointer";i.title=BX.message("MPF_IMAGE")}}else s.superclass.bindFile.apply(this,arguments)}};s.prototype.clean=function(){s.superclass.clean.apply(this,arguments);if(this["handler"]&&this.handler["agent"]&&this.handler.agent["inputName"]){var e,t,i=BX(this.manager.formID);e=BX.findChildren(i,{tagName:"INPUT",attribute:{name:this.handler.agent.inputName+"[]"}},true);if(e){for(t=0;t<e.length;t++){BX.remove(e[t])}}}};var a=function(t,i){this.params=i;this.formID=t;this.showPinButton=!!BX("lhe_button_editor_"+this.formID);if(this.showPinButton){this.params.showPanelEditor=!!this.params.pinEditorPanel}this.oEditorId=i["LHEJsObjId"];this.__divId=i["LHEJsObjName"]||i["LHEJsObjId"];e.handler[this.oEditorId]=this;this.oEditor=a.getEditor(this.oEditorId);this.urlPreview=this.initUrlPreview(i);this.eventNode=BX("div"+this.__divId);BX.addCustomEvent(this.eventNode,"OnShowLHE",BX.delegate(this.OnShowLHE,this));BX.addCustomEvent(this.eventNode,"OnButtonClick",BX.delegate(this.OnButtonClick,this));BX.addCustomEvent(this.eventNode,"OnAfterShowLHE",function(e,t){if(t.oEditor&&t.oEditor["AllowBeforeUnloadHandler"])t.oEditor.AllowBeforeUnloadHandler();if(t.monitoringWakeUp===true)t.monitoringStart()});BX.addCustomEvent(this.eventNode,"OnAfterHideLHE",function(e,t){t.monitoringWakeUp=t.monitoringStop();if(t.oEditor&&t.oEditor["DenyBeforeUnloadHandler"])t.oEditor.DenyBeforeUnloadHandler()});this.initParsers(i);this.initFiles(t,i);BX.ready(BX.delegate(function(){if(BX("lhe_button_submit_"+t,true)){BX.bind(BX("lhe_button_submit_"+t,true),"mousedown",function(){BX.addClass(this,"feed-add-button-press")});BX.bind(BX("lhe_button_submit_"+t,true),"mouseup",function(){BX.removeClass(this,"feed-add-button-press")});BX.bind(BX("lhe_button_submit_"+t,true),"click",BX.proxy(function(e){BX.onCustomEvent(this.eventNode,"OnButtonClick",["submit"]);return BX.PreventDefault(e)},this))}if(BX("lhe_button_cancel_"+t,true)){BX.bind(BX("lhe_button_cancel_"+t,true),"mousedown",function(){BX.addClass(this,"feed-add-button-press")});BX.bind(BX("lhe_button_cancel_"+t,true),"mouseup",function(){BX.removeClass(this,"feed-add-button-press")});BX.bind(BX("lhe_button_cancel_"+t,true),"click",BX.proxy(function(e){BX.onCustomEvent(this.eventNode,"OnButtonClick",["cancel"]);return BX.PreventDefault(e)},this))}},this));this.inited=true;BX.addCustomEvent(BX(this.formID),"onAutoSavePrepare",function(e){e.FORM.setAttribute("bx-lhe-autosave-prepared","Y")});BX.onCustomEvent(this,"onInitialized",[this,t,i,this.parsers]);BX.onCustomEvent(this.eventNode,"onInitialized",[this,t,i,this.parsers]);if(this.oEditor&&this.oEditor.inited&&!this.oEditor["__lhe_flags"]){BX.onCustomEvent(this.oEditor,"OnEditorInitedBefore",[this.oEditor]);BX.onCustomEvent(this.oEditor,"OnEditorInitedAfter",[this.oEditor,true])}};a.prototype={editorIsLoaded:false,arFiles:{},parser:{},controllers:{},exec:function(e,t){this.functionsToExec=this.functionsToExec||[];if(typeof e=="function")this.functionsToExec.push([e,t]);if(this.editorIsLoaded===true){var i;while((i=this.functionsToExec.shift())&&i)i[0].apply(this,i[1])}},initParsers:function(e){this.parser={postimage:{exist:false,bxTag:"postimage",tag:"IMG ID",tags:["IMG ID"],regexp:/\[(IMG ID)=((?:\s|\S)*?)(?:\s*?WIDTH=(\d+)\s*?HEIGHT=(\d+))?\]/gi,code:"[IMG ID=#ID##ADDITIONAL#]",wysiwyg:'<img id="#ID#" src="'+'#SRC#" lowsrc="'+'#LOWSRC#" title=""#ADDITIONAL# />'}};var t=e["parsers"]?e["parsers"]:{};for(var n in t){if(t.hasOwnProperty(n)&&/[a-z]/gi.test(n+"")){this.parser[n]=new i(n,t[n])}}if(BX.util.object_search("UploadImage",t)){this.parser["postimage"]["exist"]=true}if(typeof e["arSize"]=="object"){var o="";if(e["arSize"]["width"])o+="max-width:"+e["arSize"]["width"]+"px;";if(e["arSize"]["height"])o+="max-height:"+e["arSize"]["height"]+"px;";if(o!=="")this.parser["postimage"]["wysiwyg"]=this.parser["postimage"]["wysiwyg"].replace("#ADDITIONAL#",' style="'+o+'" #ADDITIONAL#')}},initFiles:function(e,t){this.arFiles={};this.controllers={common:{postfix:"",storage:"bfile",parser:"postimage",node:window,obj:null,init:false}};if(!t["CID"]||typeof t["CID"]!=="object")return;BX.addCustomEvent(this.eventNode,"onFileIsAdded",BX.delegate(this.OnFileUploadSuccess,this));BX.addCustomEvent(this.eventNode,"onFileIsFailed",BX.delegate(this.OnFileUploadFailed,this));BX.addCustomEvent(this.eventNode,"onFileIsDeleted",BX.delegate(this.OnFileUploadRemove,this));BX.addCustomEvent(this.eventNode,"onFileIsDetected",BX.delegate(this.setContent,this));BX.addCustomEvent(this.eventNode,"onFileIsInserted",BX.delegate(this.insertFile,this));var i,a,r;for(a in t["CID"]){if(t["CID"].hasOwnProperty(a)){i=t["CID"][a]["parser"];if(i=="disk_file")this.controllers[a]=new n(this,a,t["CID"][a]);else if(i=="webdav_element")this.controllers[a]=new o(this,a,t["CID"][a]);else if(i=="file")this.controllers[a]=new s(this,a,t["CID"][a]);if(this.controllers[a]&&this.controllers[a].init()&&!r)r=true}}BX.ready(BX.delegate(function(){BX.bind(BX("bx-b-uploadfile-"+e),"click",BX.proxy(this.controllerInit,this));if(r)this.controllerInit("show")},this))},controllerInit:function(e){this.controllerInitStatus=e=="show"||e=="hide"?e:this.controllerInitStatus=="show"?"hide":"show";BX.onCustomEvent(this.eventNode,"onShowControllers",[this.controllerInitStatus])},initUrlPreview:function(){if(this.params["urlPreviewId"]&&window["BXUrlPreview"]&&BX(this.params["urlPreviewId"])){return new BXUrlPreview(BX(this.params["urlPreviewId"]))}return null},getContent:function(){return this.oEditor?this.oEditor.GetContent():""},setContent:function(e){if(this.oEditor)this.oEditor.SetContent(e)},OnFileUploadSuccess:function(e,t,i,n){if(this.controllers[t.id]){var o=t.parser.bxTag+e.id;this.arFiles[o]=this.arFiles[o]||[];this.arFiles[o].push(t.id);if(n&&n["referrerToEditor"]){var s=this.getFileToInsert(e,t);BX.onCustomEvent(n["referrerToEditor"],"OnImageDataUriCaughtUploaded",[s]);BX.onCustomEvent(this.oEditor,"OnImageDataUriCaughtUploaded",[n["referrerToEditor"],e,s])}else if(i===true&&e.isImage&&this.insertImageAfterUpload){if(!this._insertFile)this._insertFile=BX.delegate(this.insertFile,this);this.exec(this._insertFile,arguments)}}},OnFileUploadFailed:function(e,t,i){if(i&&i["referrerToEditor"]){BX.onCustomEvent(i["referrerToEditor"],"OnImageDataUriCaughtFailed",[]);BX.onCustomEvent(this.editor,"OnImageDataUriCaughtFailed",[i["referrerToEditor"]])}},OnFileUploadRemove:function(e,t){if(this.controllers[t.id]){var i=t.parser.bxTag+e.id;if(this.arFiles[i]){var n=BX.util.array_search(t.id,this.arFiles[i]);this.arFiles[i]=BX.util.deleteFromArray(this.arFiles[i],n);if(!this.arFiles[i]||this.arFiles[i].length<=0){this.arFiles[i]=null;delete this.arFiles[i];if(!this._deleteFile)this._deleteFile=BX.delegate(this.deleteFile,this);this.exec(this._deleteFile,arguments)}}}},showPanelEditor:function(e,t){if(e==undefined)e=!this.oEditor.toolbar.IsShown();this.params.showPanelEditor=e;var i=BX("lhe_button_editor_"+this.formID),n=BX("panel-close"+this.__divId);if(n){this.oEditor.dom.cont.appendChild(n)}if(e){this.oEditor.dom.toolbarCont.style.opacity="inherit";this.oEditor.toolbar.Show();if(i)BX.addClass(i,"feed-add-post-form-btn-active");if(n)n.style.display=""}else{this.oEditor.toolbar.Hide();if(i)BX.removeClass(i,"feed-add-post-form-btn-active");if(n)n.style.display="none"}if(t!==false)BX.userOptions.save("main.post.form","postEdit","showBBCode",e?"Y":"N")},monitoring:{interval:null,text:"",savedText:"",files:[],savedFiles:[]},monitoringStart:function(){if(this.monitoring.interval===null){if(!this._monitoringStart){this._monitoringStart=BX.delegate(this.checkFilesInText,this);BX.addCustomEvent(this.oEditor,"OnContentChanged",BX.proxy(function(e){this.monitoring.text=e},this))}this.monitoring.interval=setInterval(this._monitoringStart,1e3)}},monitoringStop:function(){var e=this.monitoring.interval!==null;if(this.monitoring.interval!==null)clearInterval(this.monitoring.interval);this.monitoring.interval=null;return e},monitoringSetStatus:function(e,t,i){if(this.arFiles[e+t]){var n;for(var o=0;o<this.arFiles[e+t].length;o++){this.monitoring.files.push(e+t);n=this.arFiles[e+t][o];BX.onCustomEvent(this.controllers[n],"onFileIsInText",[t,i])}}},checkFilesInText:function(){if(this.monitoring.text!==this.monitoring.savedText){this.monitoring.savedText=this.monitoring.text;this.monitoring.files=[];var e=this.monitoring.savedText,t,i=function(e,t){return function(i,n,o){e.monitoring.files.push([t,o].join("/"))}};for(t in this.parser){if(this.parser.hasOwnProperty(t)){if(!this.parser[t]["checkFilesInText"]){this.parser[t]["checkFilesInText"]=i(this,t)}e.replace(this.parser[t]["regexp"],this.parser[t]["checkFilesInText"])}}if(this.monitoring.savedFiles.join(",")!==this.monitoring.files.join(",")){var n={},o;while(o=this.monitoring.savedFiles.pop()){n[o]=null}for(t=0;t<this.monitoring.files.length;t++){o=this.monitoring.files[t];n[o]=n[o]>=0?n[o]+1:1}for(t in n){if(n.hasOwnProperty(t)){o=t.split("/");this.monitoringSetStatus(o[0],o[1],n[t]>0)}}}this.monitoring.savedFiles=this.monitoring.files;if(this.monitoring.savedFiles.length<=0)this.monitoringStop()}},checkFile:function(e,t){var i=false;if(typeof e=="string"){var n=typeof t=="string"?t:t.parser;if(!!this.arFiles[n+e]){var o=this.arFiles[n+e][0];t=this.controllers[o];i={file:t.values[e],controller:t}}}else if(this.controllers[t.id]){i={file:e,controller:t}}return i},insertFile:function(e,t){var i=this.oEditor;if(i&&e){var n=i.GetViewMode(),o=this.getFileToInsert(e,t);if(n=="wysiwyg"){i.InsertHtml(o.replacement);setTimeout(BX.delegate(i.AutoResizeSceleton,i),500);setTimeout(BX.delegate(i.AutoResizeSceleton,i),1e3)}else if(n=="code"&&i.bbCode){i.textareaView.Focus();i.textareaView.WrapWith(false,false,o.replacement)}o["callback"]()}},getFileToInsert:function(e,t){var i=this.oEditor;if(i&&e){var n=e["id"],o="",s=t.parser,a=i.GetViewMode(),r=this.parser[s.bxTag][a];if(e["isImage"]){r=a=="wysiwyg"?this.parser["postimage"][a]:r;if(e.width>0&&e.height>0&&i.sEditorMode=="html"){o=' style="width:'+e.width+"px;height:"+e.height+"px;\" onload=\"this.style.width='auto';this.style.height='auto';\""}}if(a=="wysiwyg"){r=r.replace("#ID#",i.SetBxTag(false,{tag:s.bxTag,params:{value:n}})).replace("#SRC#",e.src).replace("#URL#",e.url).replace("#LOWSRC#",e.lowsrc||"").replace("#NAME#",e.name).replace("#ADDITIONAL#",o)+"<span>&nbsp;</span>"}else if(a=="code"&&i.bbCode){r=r.replace("#ID#",n).replace("#ADDITIONAL#","")}return{replacement:r,callback:BX.proxy(function(){this.monitoringSetStatus(t.parser.bxTag,e.id,true);this.monitoringStart()},this)}}return{replacement:"",callback:BX.DoNothing}},deleteFile:function(e,t){var i=this.oEditor,n=t.parser,o=e.id,s=i.GetContent();if(n&&s.indexOf("="+o)>=0){if(i.GetViewMode()=="wysiwyg"){var a=i.GetIframeDoc(),r,d;for(r in i["bxTags"]){if(i["bxTags"].hasOwnProperty(r)){if(typeof i.bxTags[r]=="object"&&i.bxTags[r]["params"]&&i.bxTags[r]["params"]["value"]==e.id){d=a.getElementById(r);if(d)d.parentNode.removeChild(d)}}}i.SaveContent()}else{s=s.replace(n.regexp,function(t,i,n){return n==e.id?"":t});i.SetContent(s);i.Focus()}this.monitoringSetStatus(n.bxTag,e.id,false)}},reinit:function(e,t){BX.onCustomEvent(this.eventNode,"onReinitializeBefore",[this,e,t]);this.arFiles={};delete this.monitoringWakeUp;this.monitoringStop();this.oEditor.CheckAndReInit(e||"");BX.onCustomEvent(this.eventNode,"onReinitialize",[this,e,t]);var i,n=false;for(i in this.controllers){if(this.controllers.hasOwnProperty(i)){if(this.controllers[i]["init"]&&this.controllers[i].reinit(e,t))n=true}}this.controllerInit(n?"show":"hide");if(this.params["~height"]){this.oEditor.SetConfigHeight(this.params["~height"]);this.oEditor.ResizeSceleton()}if(this.urlPreview){this.urlPreview.detachUrlPreview();var o;for(var s in t){if(t.hasOwnProperty(s)&&t[s].hasOwnProperty("USER_TYPE_ID")&&t[s]["USER_TYPE_ID"]==="url_preview"){o=t[s]["VALUE"]}}if(o)this.urlPreview.attachUrlPreview({id:o})}},Parse:function(e,t,i){var n=this.parser[e],o=this;if(n){t=t.replace(n.regexp,function(t,s,a,r,d){var l=o.checkFile(a,e);if(l&&(l=l.file)&&l){var h="",u=l.isImage?o.parser.postimage.wysiwyg:n.wysiwyg;

o.monitoringStart();if(l.isImage){r=parseInt(r);d=parseInt(d);h=r&&d?' width="'+r+'" height="'+d+'"':"";if(h===""&&l["width"]>0&&l["height"]>0){h=' style="width:'+l["width"]+"px;height:"+l["height"]+"px;\" onload=\"this.style.width='auto';this.style.height='auto';\""}}return u.replace("#ID#",i.SetBxTag(false,{tag:e,params:{value:a}})).replace("#NAME#",l.name).replace("#SRC#",l.src).replace("#LOWSRC#",l.lowsrc).replace("#ADDITIONAL#",h).replace("#WIDTH#",parseInt(r)).replace("#HEIGHT#",parseInt(d))}return t})}return t},Unparse:function(e,t){var i="",n=e.tag;if(this.parser[n]){var o=parseInt(t.node.hasAttribute("width")?t.node.getAttribute("width"):0),s=parseInt(t.node.hasAttribute("height")?t.node.getAttribute("height"):0),a="";if(o>0&&s>0){a=" WIDTH="+o+" HEIGHT="+s}i=this.parser[n]["code"].replace("#ID#",e.params.value).replace("#ADDITIONAL#",a).replace("#WIDTH#",o).replace("#HEIGHT#",s)}return i},OnShowLHE:function(e,t,i){var n=this.__divId;e=e===false?false:e==="hide"?"hide":e==="justShow"?"justShow":true;this.oEditor=this.oEditor||a.getEditor(this.oEditorId);if(!this.oEditor)return;this.oEditor.Init();var o=BX("micro"+n),s=this.eventNode;if(o){o.style.display=e===true||e==="justShow"?"none":"block"}if(e=="hide"){BX.onCustomEvent(this.eventNode,"OnBeforeHideLHE",[e,this]);if(this.eventNode.style.display=="none"){BX.onCustomEvent(this.eventNode,"OnAfterHideLHE",[e,this])}else{new BX["easing"]({duration:200,start:{opacity:100,height:this.eventNode.scrollHeight},finish:{opacity:0,height:20},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:function(e){s.style.height=e.height+"px";s.style.opacity=e.opacity/100},complete:BX.proxy(function(){this.eventNode.style.cssText="";this.eventNode.style.display="none";BX.onCustomEvent(s,"OnAfterHideLHE",[e,this])},this)}).animate()}}else if(e){BX.onCustomEvent(this.eventNode,"OnBeforeShowLHE",[e,this]);if(e=="justShow"){this.eventNode.style.display="block";BX.onCustomEvent(this.eventNode,"OnAfterShowLHE",[e,this]);if(i!==false)this.oEditor.Focus()}else if(this.eventNode.style.display=="block"){BX.onCustomEvent(this.eventNode,"OnAfterShowLHE",[e,this]);if(i!==false)this.oEditor.Focus()}else{BX.adjust(this.eventNode,{style:{display:"block",overflow:"hidden",height:"20px",opacity:.1}});new BX["easing"]({duration:200,start:{opacity:10,height:20},finish:{opacity:100,height:s.scrollHeight},transition:BX["easing"].makeEaseOut(BX.easing.transitions.quad),step:function(e){s.style.height=e.height+"px";s.style.opacity=e.opacity/100},complete:BX.proxy(function(){BX.onCustomEvent(s,"OnAfterShowLHE",[e,this]);this.oEditor.Focus();this.eventNode.style.cssText=""},this)}).animate()}}else{BX.onCustomEvent(this.eventNode,"OnBeforeHideLHE",[e,this]);this.eventNode.style.display="none";BX.onCustomEvent(this.eventNode,"OnAfterHideLHE",[e,this])}},OnButtonClick:function(e){if(e!="cancel"){BX.onCustomEvent(this.eventNode,"OnClickSubmit",[this])}else{BX.onCustomEvent(this.eventNode,"OnClickCancel",[this]);BX.onCustomEvent(this.eventNode,"OnShowLHE",["hide"])}},OnEditorInitedBefore:function(e){var t=this;this.oEditor=e;e.formID=this.formID;if(this.params)this.params["~height"]=e.config["height"];BX.addCustomEvent(e,"OnCtrlEnter",function(){e.SaveContent();if(t.params&&t.params["ctrlEnterHandler"]&&typeof window[t.params["ctrlEnterHandler"]]=="function")window[t.params["ctrlEnterHandler"]]();else BX.submit(BX(t.formID))});var i=this.params.parsers?this.params.parsers:[];if(BX.util.object_search("Spoiler",i)){e.AddButton({id:"spoiler",name:BX.message("spoilerText"),iconClassName:"spoiler",disabledForTextarea:false,src:BX.message("MPF_TEMPLATE_FOLDER")+"/images/lhespoiler.png",toolbarSort:205,handler:function(){var e=this,t=false;if(!e.editor.bbCode||!e.editor.synchro.IsFocusedOnTextarea()){t=e.editor.action.actions.formatBlock.exec("formatBlock","blockquote","bx-spoiler",false,{bxTagParams:{tag:"spoiler"}})}else{t=e.editor.action.actions.formatBbCode.exec("quote",{tag:"SPOILER"})}return t}});e.AddParser({name:"spoiler",obj:{Parse:function(e,t,i){if(/\[(cut|spoiler)(([^\]])*)\]/gi.test(t)){t=t.replace(/[\001-\006]/gi,"").replace(/\[cut(((?:=)[^\]]*)|)\]/gi,"$1").replace(/\[\/cut]/gi,"").replace(/\[spoiler([^\]]*)\]/gi,"$1").replace(/\[\/spoiler]/gi,"");var n=/(?:\001([^\001]*)\001)([^\001-\004]+)\002/gi,o=/(?:\003([^\003]*)\003)([^\001-\004]+)\004/gi,s=function(e,t){e=e.replace(/^(="|='|=)/gi,"").replace(/("|')?$/gi,"");return'<blockquote class="bx-spoiler" id="'+i.SetBxTag(false,{tag:"spoiler"})+'" title="'+e+'">'+t+"</blockquote>"},a=function(e,t,i){return s(t,i)};while(t.match(n)||t.match(o)){t=t.replace(n,a).replace(o,a)}}t=t.replace(/\001([^\001]*)\001/gi,"[cut$1]").replace(/\003([^\003]*)\003/gi,"[spoiler$1]").replace(/\002/gi,"[/cut]").replace(/\004/gi,"[/spoiler]");return t},UnParse:function(t,i){if(t.tag=="spoiler"){var n="",o;for(o=0;o<i.node.childNodes.length;o++){n+=e.bbParser.GetNodeHtml(i.node.childNodes[o])}n=BX.util.trim(n);if(n!="")return"[SPOILER"+(i.node.hasAttribute("title")?"="+i.node.getAttribute("title"):"")+"]"+n+"[/SPOILER]"}return""}}})}if(BX.util.object_search("MentionUser",i)){e.AddParser({name:"postuser",obj:{Parse:function(t,i){i=i.replace(/\[USER\s*=\s*(\d+)\]((?:\s|\S)*?)\[\/USER\]/gi,function(t,i,n){n=BX.util.trim(n);if(n=="")return"";return'<span id="'+e.SetBxTag(false,{tag:"postuser",params:{value:parseInt(i)}})+'" class="bxhtmled-metion">'+n+"</span>"});return i},UnParse:function(t,i){if(t.tag=="postuser"){var n="",o;for(o=0;o<i.node.childNodes.length;o++){n+=e.bbParser.GetNodeHtml(i.node.childNodes[o])}n=BX.util.trim(n);if(n!="")return"[USER="+t.params.value+"]"+n+"[/USER]"}return""}}})}var n=function(i,n){return t.Parse(i,n,e)},o=function(e,i){return t.Unparse(e,i)};for(var s in this.parser){if(this.parser.hasOwnProperty(s)){e.AddParser({name:s,obj:{Parse:n,UnParse:o}})}}if(this.showPinButton){this.pinEditorPanel=this.params&&this.params.pinEditorPanel===true;var a="toolbar_pin";var r=function(e,i){r.superclass.constructor.apply(this,arguments);this.id=a;this.title=BX.message("MPF_PIN_EDITOR_PANNEL");this.className+=" "+(t.pinEditorPanel?"bxhtmled-button-toolbar-pined":"bxhtmled-button-toolbar-pin");this.Create();if(i)i.appendChild(this.GetCont())};BX.extend(r,window.BXHtmlEditor.Button);r.prototype.OnClick=function(){BX.removeClass(this.pCont,"bxhtmled-button-toolbar-pined");BX.removeClass(this.pCont,"bxhtmled-button-toolbar-pin");if(t.pinEditorPanel){t.pinEditorPanel=false;BX.addClass(this.pCont,"bxhtmled-button-toolbar-pin")}else{t.pinEditorPanel=true;BX.addClass(this.pCont,"bxhtmled-button-toolbar-pined")}BX.userOptions.save("main.post.form","postEdit","pinEditorPanel",t.pinEditorPanel?"Y":"N")};window.BXHtmlEditor.Controls[a]=r;BX.addCustomEvent(e,"GetControlsMap",function(e){e.push({id:a,compact:true,hidden:false,sort:500,checkWidth:true,offsetWidth:32,wrap:"right"})})}},OnEditorInitedAfter:function(e){BX.addCustomEvent(e,"OnIframeDrop",BX.proxy(function(){BX.onCustomEvent(this.eventNode,"OnIframeDrop",arguments)},this));BX.addCustomEvent(e,"OnIframeDragOver",BX.proxy(function(){BX.onCustomEvent(this.eventNode,"OnIframeDragOver",arguments)},this));BX.addCustomEvent(e,"OnIframeDragLeave",BX.proxy(function(){BX.onCustomEvent(this.eventNode,"OnIframeDragLeave",arguments)},this));BX.addCustomEvent(e,"OnImageDataUriHandle",BX.proxy(function(){BX.onCustomEvent(this.eventNode,"OnImageDataUriHandle",arguments)},this));BX.addCustomEvent(e,"OnAfterUrlConvert",this.OnAfterUrlConvert.bind(this));BX.addCustomEvent(e,"OnBeforeCommandExec",this.OnBeforeCommandExec.bind(this));e.contextMenu.items["postimage"]=e.contextMenu.items["postdocument"]=e.contextMenu.items["postfile"]=[{TEXT:BX.message("BXEdDelFromText"),bbMode:true,ACTION:function(){var t=e.contextMenu.GetTargetItem("postimage");if(!t)t=e.contextMenu.GetTargetItem("postdocument");if(!t)t=e.contextMenu.GetTargetItem("postfile");if(t&&t.element){e.selection.RemoveNode(t.element)}e.contextMenu.Hide()}}];if(!this.params["lazyLoad"]){BX.onCustomEvent(this.eventNode,"OnShowLHE",["justShow",e,false])}if(e.toolbar.controls&&e.toolbar.controls.FontSelector){e.toolbar.controls.FontSelector.SetWidth(45)}BX.addCustomEvent(BX(this.formID),"onAutoSavePrepare",function(t){var i=t;setTimeout(function(){BX.addCustomEvent(e,"OnContentChanged",BX.proxy(function(e){this["mpfTextContent"]=e;this.Init()},i))},1500)});BX.addCustomEvent(BX(this.formID),"onAutoSave",BX.proxy(function(e,t){if(BX.type.isNotEmptyString(e["mpfTextContent"]))t["text"+this.formID]=e["mpfTextContent"]},this));BX.addCustomEvent(BX(this.formID),"onAutoSaveRestore",BX.proxy(function(t,i){if(i["text"+this.formID]&&/[^\s]+/gi.test(i["text"+this.formID])){e.CheckAndReInit(i["text"+this.formID])}},this));if(BX(this.formID)&&BX(this.formID).hasAttribute("bx-lhe-autosave-prepared")&&BX(this.formID).BXAUTOSAVE){BX(this.formID).removeAttribute("bx-lhe-autosave-prepared");setTimeout(BX.proxy(function(){BX(this.formID).BXAUTOSAVE.Prepare()},this),100)}var t=this.formID,i=this.params;this.showPanelEditor(i.showPanelEditor,false);if(!e.mainPostFormCustomized){e.mainPostFormCustomized=true;BX.addCustomEvent(e,"OnIframeKeydown",function(i){if(window.onKeyDownHandler){window.onKeyDownHandler(i,e,t)}});BX.addCustomEvent(e,"OnIframeKeyup",function(i){if(window.onKeyUpHandler){window.onKeyUpHandler(i,e,t)}});if(window["BXfpdStopMent"+t]){BX.addCustomEvent(e,"OnIframeClick",function(){window["BXfpdStopMent"+t]()})}if(e&&e.textareaView.GetCursorPosition){BX.addCustomEvent(e,"OnTextareaKeyup",function(i){if(window.onTextareaKeyUpHandler){window.onTextareaKeyUpHandler(i,e,t)}});BX.addCustomEvent(e,"OnTextareaKeydown",function(i){if(window.onTextareaKeyDownHandler){window.onTextareaKeyDownHandler(i,e,t)}})}}},OnAfterUrlConvert:function(e){if(this.urlPreview){this.urlPreview.attachUrlPreview({url:e})}},OnBeforeCommandExec:function(e,t,i,n){if(this.urlPreview&&t=="createLink"&&BX.type.isPlainObject(n)&&n.hasOwnProperty("href")){this.urlPreview.attachUrlPreview({url:n.href})}}};a.getEditor=function(e){return window["BXHtmlEditor"]?window["BXHtmlEditor"].Get(typeof e=="object"?e.id:e):null};a.getHandler=function(t){return e.handler[typeof t=="object"?t.id:t]};a.unsetHandler=function(t){var i=typeof t=="object"?t.id:t;if(!e.handler[i])return;if(e.handler[i].oEditor)e.handler[i].oEditor.Destroy();e.handler[i]=null};a.reinitData=function(e,t,i){var n=a.getHandler(e);if(n)n.exec(n.reinit,[t,i]);return false};a.reinitDataBefore=function(e){var t=a.getHandler(e);if(t&&t["eventNode"])BX.onCustomEvent(t.eventNode,"onReinitializeBefore",[t])};window.LHEPostForm=a;window.BXPostFormTags=function(e,t){this.popup=null;this.formID=e;this.buttonID=t;this.sharpButton=null;this.addNewLink=null;this.tagsArea=null;this.hiddenField=null;this.popupContent=null;BX.ready(BX.proxy(this.init,this))};window.BXPostFormTags.prototype.init=function(){this.sharpButton=BX(this.buttonID);this.addNewLink=BX("post-tags-add-new-"+this.formID);this.tagsArea=BX("post-tags-block-"+this.formID);this.tagsContainer=BX("post-tags-container-"+this.formID);this.hiddenField=BX("post-tags-hidden-"+this.formID);this.popupContent=BX("post-tags-popup-content-"+this.formID);this.popupInput=BX.findChild(this.popupContent,{tag:"input"});var e=BX.findChildren(this.tagsContainer,{className:"feed-add-post-del-but"},true);for(var t=0,i=e.length;t<i;t++){BX.bind(e[t],"click",BX.proxy(this.onTagDelete,{obj:this,tagBox:e[t].parentNode,tagValue:e[t].parentNode.getAttribute("data-tag")}))}BX.bind(this.sharpButton,"click",BX.proxy(this.onButtonClick,this));BX.bind(this.addNewLink,"click",BX.proxy(this.onAddNewClick,this))};window.BXPostFormTags.prototype.onTagDelete=function(){BX.remove(this.tagBox);this.obj.hiddenField.value=this.obj.hiddenField.value.replace(this.tagValue+",","").replace("  "," ")};window.BXPostFormTags.prototype.show=function(){if(this.popup===null){this.popup=new BX.PopupWindow("bx-post-tag-popup",this.addNewLink,{content:this.popupContent,lightShadow:false,offsetTop:8,offsetLeft:10,autoHide:true,angle:true,closeByEsc:true,zIndex:-840,buttons:[new BX.PopupWindowButton({text:BX.message("TAG_ADD"),events:{click:BX.proxy(this.onTagAdd,this)}})]});BX.bind(this.popupInput,"keydown",BX.proxy(this.onKeyPress,this));BX.bind(this.popupInput,"keyup",BX.proxy(this.onKeyPress,this))}this.popup.show();BX.focus(this.popupInput)};window.BXPostFormTags.prototype.addTag=function(e){var t=BX.type.isNotEmptyString(e)?e.split(","):this.popupInput.value.split(",");var i=[];for(var n=0;n<t.length;n++){var o=BX.util.trim(t[n]);if(o.length>0){var s=this.hiddenField.value.split(",");if(!BX.util.in_array(o,s)){var a;var r=BX.create("span",{children:[a=BX.create("span",{attrs:{"class":"feed-add-post-del-but"}})],attrs:{"class":"feed-add-post-tags"}});r.insertBefore(document.createTextNode(o),a);this.tagsContainer.insertBefore(r,this.addNewLink);BX.bind(a,"click",BX.proxy(this.onTagDelete,{obj:this,tagBox:r,tagValue:o}));this.hiddenField.value+=o+",";i.push(o)}}}return i};window.BXPostFormTags.prototype.onTagAdd=function(){this.addTag();this.popupInput.value="";this.popup.close()};window.BXPostFormTags.prototype.onAddNewClick=function(e){e=e||window.event;this.show();BX.PreventDefault(e)};window.BXPostFormTags.prototype.onButtonClick=function(e){e=e||window.event;BX.show(this.tagsArea);this.show();BX.PreventDefault(e)};window.BXPostFormTags.prototype.onKeyPress=function(e){e=e||window.event;var t=e.keyCode?e.keyCode:e.which?e.which:null;if(t==13){setTimeout(BX.proxy(this.onTagAdd,this),0)}};window.BXPostFormImportant=function(e,t,i){if(i){this.formID=e;this.buttonID=t;this.inputName=i;this.fireButton=null;this.activeBlock=null;this.hiddenField=null;BX.ready(BX.proxy(this.init,this))}return false};window.BXPostFormImportant.prototype.init=function(){this.fireButton=BX(this.buttonID);this.activeBlock=BX(this.buttonID+"-active");var e=BX(this.formID);if(e){this.hiddenField=e[this.inputName];if(this.hiddenField&&this.hiddenField.value==1){this.showActive()}}BX.bind(this.fireButton,"click",BX.proxy(function(e){e=e||window.event;this.showActive();BX.PreventDefault(e)},this));BX.bind(this.activeBlock,"click",BX.proxy(function(e){e=e||window.event;this.hideActive();BX.PreventDefault(e)},this))};window.BXPostFormImportant.prototype.showActive=function(e){BX.hide(this.fireButton);BX.show(this.activeBlock,"inline-block");if(this.hiddenField){this.hiddenField.value=1}return false};window.BXPostFormImportant.prototype.hideActive=function(e){BX.hide(this.activeBlock);BX.show(this.fireButton,"inline-block");if(this.hiddenField){this.hiddenField.value=0}return false};var r=null;window.MPFbuttonShowWait=function(e){if(e&&!BX.type.isElementNode(e))e=null;e=e||this;e=e?e.tagName=="A"?e:e.parentNode:e;if(e){BX.addClass(e,"feed-add-button-load");r=e;BX.defer(function(){e.disabled=true})()}};window.MPFbuttonCloseWait=function(e){if(e&&!BX.type.isElementNode(e))e=null;e=e||r||this;if(e){e.disabled=false;BX.removeClass(e,"feed-add-button-load");r=null}};window.__mpf_wd_getinfofromnode=function(e,t){var i=BX.findChild(BX((e["prefixNode"]||"wd-doc")+e.element_id),{className:"files-preview",tagName:"IMG"},true,false);if(i){e.lowsrc=i.src;e.element_url=i.src.replace(/\Wwidth=(\d+)/,"").replace(/\Wheight\=(\d+)/,"");e.width=parseInt(i.getAttribute("data-bx-full-width"));e.height=parseInt(i.getAttribute("data-bx-full-height"))}else if(t.urlGet){e.element_url=t.urlGet.replace("#element_id#",e.element_id).replace("#ELEMENT_ID#",e.element_id).replace("#element_name#",e.element_name).replace("#ELEMENT_NAME#",e.element_name)}};var d={listen:false,plus:false,text:"",bSearch:false};window.BXfpdSelectCallback=function(e,t,i,n,o,s){BX.SocNetLogDestination.BXfpSelectCallback({item:e,type:t,bUndeleted:n,containerInput:BX("feed-add-post-destination-item"),valueInput:BX("feed-add-post-destination-input"),formName:o,tagInputName:"bx-destination-tag",tagLink1:BX.message("BX_FPD_LINK_1"),tagLink2:BX.message("BX_FPD_LINK_2"),state:typeof s!="undefined"?s:null})};window.BXfpdUnSelectCallback=function(e,t,i,n){BX.SocNetLogDestination.BXfpUnSelectCallback.call({formName:n,inputContainerName:"feed-add-post-destination-item",inputName:"feed-add-post-destination-input",tagInputName:"bx-destination-tag",tagLink1:BX.message("BX_FPD_LINK_1"),tagLink2:BX.message("BX_FPD_LINK_2")},e)};window.BXfpdOpenDialogCallback=function(e){BX.SocNetLogDestination.BXfpOpenDialogCallback.call({inputBoxName:"feed-add-post-destination-input-box",inputName:"feed-add-post-destination-input",tagInputName:"bx-destination-tag"})};window.BXfpdCloseDialogCallback=function(e){BX.SocNetLogDestination.BXfpCloseDialogCallback.call({inputBoxName:"feed-add-post-destination-input-box",inputName:"feed-add-post-destination-input",tagInputName:"bx-destination-tag"})};window.BXfpdCloseSearchCallback=function(e){BX.SocNetLogDestination.BXfpCloseSearchCallback.call({inputBoxName:"feed-add-post-destination-input-box",inputName:"feed-add-post-destination-input",tagInputName:"bx-destination-tag"})};window.onKeyDownHandler=function(e,t,i){var n=e.keyCode;if(!window["BXfpdStopMent"+i])return true;if(n==107||(e.shiftKey||e.modifiers>3)&&BX.util.in_array(n,[187,50,107,43,61])||e.altKey&&BX.util.in_array(n,[76])){setTimeout(function(){var e=t.selection.GetRange(),n=t.GetIframeDoc(),o=e?e.endContainer.textContent:"",s=o?o.slice(e.endOffset-1,e.endOffset):"",a=o?o.slice(e.endOffset-2,e.endOffset-1):"";if((s=="@"||s=="+")&&(!a||BX.util.in_array(a,["+","@",",","("])||a.length==1&&BX.util.trim(a)==="")){d.listen=true;d.listenFlag=true;d.text="";d.leaveContent=true;e.setStart(e.endContainer,e.endOffset-1);e.setEnd(e.endContainer,e.endOffset);t.selection.SetSelection(e);var r=BX.create("SPAN",{props:{id:"bx-mention-node"}},n);t.selection.Surround(r,e);e.setStart(r,1);e.setEnd(r,1);t.selection.SetSelection(e);if(!BX.SocNetLogDestination.isOpenDialog()){BX.SocNetLogDestination.openDialog(window["BXSocNetLogDestinationFormNameMent"+i],{bindNode:l(r,t)})}}},10)}if(d.listen){var o=d.bSearch?"search":BX.SocNetLogDestination.obTabSelected[window["BXSocNetLogDestinationFormNameMent"+i]];if(n==t.KEY_CODES["enter"]){BX.SocNetLogDestination.selectCurrentItem(o,window["BXSocNetLogDestinationFormNameMent"+i]);t.iframeKeyDownPreventDefault=true;BX.PreventDefault(e)}else if(n==t.KEY_CODES["left"]){BX.SocNetLogDestination.moveCurrentItem(o,window["BXSocNetLogDestinationFormNameMent"+i],"left");t.iframeKeyDownPreventDefault=true;BX.PreventDefault(e)}else if(n==t.KEY_CODES["right"]){BX.SocNetLogDestination.moveCurrentItem(o,window["BXSocNetLogDestinationFormNameMent"+i],"right");t.iframeKeyDownPreventDefault=true;BX.PreventDefault(e)}else if(n==t.KEY_CODES["up"]){BX.SocNetLogDestination.moveCurrentItem(o,window["BXSocNetLogDestinationFormNameMent"+i],"up");t.iframeKeyDownPreventDefault=true;BX.PreventDefault(e)}else if(n==t.KEY_CODES["down"]){BX.SocNetLogDestination.moveCurrentItem(o,window["BXSocNetLogDestinationFormNameMent"+i],"down");t.iframeKeyDownPreventDefault=true;BX.PreventDefault(e)}}if(!d.listen&&d.listenFlag&&n===t.KEY_CODES["enter"]){var s=t.selection.GetRange();if(s.collapsed){var a=s.endContainer,r=t.GetIframeDoc();if(a){if(a.className!=="bxhtmled-metion"){a=BX.findParent(a,function(e){return e.className=="bxhtmled-metion"},r.body)}if(a&&a.className=="bxhtmled-metion"){t.selection.SetAfter(a)}}}}};window.onKeyUpHandler=function(e,t,i){var n=e.keyCode,o,s,a;if(!window["BXfpdStopMent"+i])return true;if(d.listen===true){if(n==t.KEY_CODES["escape"]){window["BXfpdStopMent"+i]()}else if(n!==t.KEY_CODES["enter"]&&n!==t.KEY_CODES["left"]&&n!==t.KEY_CODES["right"]&&n!==t.KEY_CODES["up"]&&n!==t.KEY_CODES["down"]){o=t.GetIframeDoc();var r=o.getElementById("bx-mention-node");if(r){a=BX.util.trim(t.util.GetTextContent(r));var h=a;a=a.replace(/^[\+@]*/,"");d.bSearch=a.length>0;BX.SocNetLogDestination.search(a,true,window["BXSocNetLogDestinationFormNameMent"+i],BX.message("MPF_NAME_TEMPLATE"),{bindNode:l(r,t)});if(d.leaveContent&&d._lastText&&h===""){window["BXfpdStopMent"+i]()}else if(d.leaveContent&&d.lastText&&h!==""&&a===""){d.bSearch=false;window["BXfpdStopMent"+i]();BX.SocNetLogDestination.openDialog(window["BXSocNetLogDestinationFormNameMent"+i],{bindNode:l(r,t)})}d.lastText=a;d._lastText=h}else{window["BXfpdStopMent"+i]()}}}else{if(!e.shiftKey&&(n===t.KEY_CODES["space"]||n===t.KEY_CODES["escape"]||n===188||n===190)){s=t.selection.GetRange();if(s.collapsed){var u=s.endContainer;o=t.GetIframeDoc();if(u){if(u.className!=="bxhtmled-metion"){u=BX.findParent(u,function(e){return e.className=="bxhtmled-metion"},o.body)}if(u&&u.className=="bxhtmled-metion"){a=t.util.GetTextContent(u);var f=a.match(/[\s\.\,]$/);if(f||n===t.KEY_CODES["escape"]){u.innerHTML=a.replace(/[\s\.\,]$/,"");var c=BX.create("SPAN",{html:f||t.INVISIBLE_SPACE},o);t.util.InsertAfter(c,u);t.selection.SetAfter(c)}}}}}}};window.onTextareaKeyDownHandler=function(e,t,i){var n=e.keyCode;if(d.listen&&n==t.KEY_CODES["enter"]){BX.SocNetLogDestination.selectFirstSearchItem(window["BXSocNetLogDestinationFormNameMent"+i]);t.textareaKeyDownPreventDefault=true;BX.PreventDefault(e)}};window.onTextareaKeyUpHandler=function(e,t,i){var n,o,s=e.keyCode;if(d.listen===true){if(s==27){window["BXfpdStopMent"+i]()}else if(s!==13){o=t.textareaView.GetValue(false);n=t.textareaView.GetCursorPosition();if(o.indexOf("+")!==-1||o.indexOf("@")!==-1){var a=o.substr(0,n),r=Math.max(a.lastIndexOf("+"),a.lastIndexOf("@"));if(r>=0){var l=a.substr(r),h=l;l=l.replace(/^[\+@]*/,"");if(BX.SocNetLogDestination&&!BX.SocNetLogDestination.isOpenDialog()){BX.SocNetLogDestination.openDialog(window["BXSocNetLogDestinationFormNameMent"+i])}d.bSearch=l.length>0;if(BX.SocNetLogDestination)BX.SocNetLogDestination.search(l,true,window["BXSocNetLogDestinationFormNameMent"+i],BX.message("MPF_NAME_TEMPLATE"));if(d.leaveContent&&d._lastText&&h===""){window["BXfpdStopMent"+i]()}else if(d.leaveContent&&d.lastText&&h!==""&&l===""){window["BXfpdStopMent"+i]();if(BX.SocNetLogDestination)BX.SocNetLogDestination.openDialog(window["BXSocNetLogDestinationFormNameMent"+i])}d.lastText=l;d._lastText=h}}}}else{if(s==16){var u=this;this.shiftPressed=true;if(this.shiftTimeout)this.shiftTimeout=clearTimeout(this.shiftTimeout);this.shiftTimeout=setTimeout(function(){u.shiftPressed=false},100)}if(s==107||(e.shiftKey||e.modifiers>3||this.shiftPressed)&&BX.util.in_array(s,[187,50,107,43,61])){n=t.textareaView.element.selectionStart;if(n>0){o=t.textareaView.element.value;var f=o.substr(n-1,1);if(f&&(f==="+"||f==="@")){d.listen=true;d.listenFlag=true;d.text="";d.textarea=true;if(!BX.SocNetLogDestination.isOpenDialog()){BX.SocNetLogDestination.openDialog(window["BXSocNetLogDestinationFormNameMent"+i])}}}}}};var l=function(e,t){var i=BX.pos(e),n=BX.pos(t.dom.areaCont),o=BX.GetWindowScrollPos(t.GetIframeDoc()),s=n.top+i.bottom-o.scrollTop+2,a=n.left+i.right-o.scrollLeft;return{top:s,left:a}};window.BxInsertMention=function(e){var t=e.item,i=e.type,n=e.formID,o=e.editorId,s=e.bNeedComa,r=a.getEditor(o),l;if(i=="users"&&t&&t.entityId>0&&r){if(r.GetViewMode()=="wysiwyg"){var h=r.GetIframeDoc(),u=r.selection.GetRange(),f=h.getElementById("bx-mention-node"),c=BX.create("SPAN",{props:{className:"bxhtmled-metion"},text:BX.util.htmlspecialcharsback(t.name)},h);l=BX.create("SPAN",{html:s?",&nbsp;":"&nbsp;"},h);r.SetBxTag(c,{tag:"postuser",params:{value:t.entityId}});if(f){r.util.ReplaceNode(f,c)}else{r.selection.InsertNode(c,u)}if(c&&c.parentNode){var p=BX.findParent(c,{className:"bxhtmled-metion"},h.body);if(p){r.util.InsertAfter(c,p)}}if(c&&c.parentNode){r.util.InsertAfter(l,c);r.selection.SetAfter(l)}}else if(r.GetViewMode()=="code"&&r.bbCode){r.textareaView.Focus();var m=r.textareaView.GetValue(false),B=r.textareaView.GetCursorPosition(),g=m.substr(0,B),X=Math.max(g.lastIndexOf("+"),g.lastIndexOf("@"));if(X>=0&&B>X){r.textareaView.SetValue(m.substr(0,X)+m.substr(B));r.textareaView.element.setSelectionRange(X,X)}r.textareaView.WrapWith(false,false,"[USER="+t.entityId+"]"+t.name+"[/USER]"+(s?", ":" "))}if(e.fireAddEvent===true){BX.onCustomEvent(window,"onMentionAdd",[t])}delete BX.SocNetLogDestination.obItemsSelected[window["BXSocNetLogDestinationFormNameMent"+n]][t.id];window["BXfpdStopMent"+n]();d["text"]="";if(r.GetViewMode()=="wysiwyg"){r.Focus();r.selection.SetAfter(l)}}};window.MPFMentionInit=function(e,t){if(!t["items"]["departmentRelation"]){t["items"]["departmentRelation"]=BX.SocNetLogDestination.buildDepartmentRelation(t["items"]["department"])}window["departmentRelation"]=t["items"]["departmentRelation"];if(t.initDestination===true){window.BXSocNetLogDestinationFormName="destination"+(""+(new Date).getTime()).substr(6);window.BXSocNetLogDestinationDisableBackspace=null;BX.SocNetLogDestination.init({name:window.BXSocNetLogDestinationFormName,searchInput:BX("feed-add-post-destination-input"),extranetUser:t["extranetUser"],bindMainPopup:{node:BX("feed-add-post-destination-container"),offsetTop:"5px",offsetLeft:"15px"},bindSearchPopup:{node:BX("feed-add-post-destination-container"),offsetTop:"5px",offsetLeft:"15px"},callback:{select:window.BXfpdSelectCallback,unSelect:BX.delegate(BX.SocNetLogDestination.BXfpUnSelectCallback,{formName:window.BXSocNetLogDestinationFormName,inputContainerName:"feed-add-post-destination-item",inputName:"feed-add-post-destination-input",tagInputName:"bx-destination-tag",tagLink1:BX.message("BX_FPD_LINK_1"),tagLink2:BX.message("BX_FPD_LINK_2")}),openDialog:BX.delegate(BX.SocNetLogDestination.BXfpOpenDialogCallback,{inputBoxName:"feed-add-post-destination-input-box",inputName:"feed-add-post-destination-input",tagInputName:"bx-destination-tag"}),closeDialog:BX.delegate(BX.SocNetLogDestination.BXfpCloseDialogCallback,{inputBoxName:"feed-add-post-destination-input-box",inputName:"feed-add-post-destination-input",tagInputName:"bx-destination-tag"}),openSearch:BX.delegate(BX.SocNetLogDestination.BXfpOpenDialogCallback,{inputBoxName:"feed-add-post-destination-input-box",inputName:"feed-add-post-destination-input",tagInputName:"bx-destination-tag"})},items:t["items"],itemsLast:t["itemsLast"],itemsSelected:t["itemsSelected"],isCrmFeed:t["isCrmFeed"],useClientDatabase:!!t["useClientDatabase"],destSort:t["destSort"],allowAddUser:t["allowAddUser"],allowAddCrmContact:t["allowAddCrmContact"],allowSearchCrmEmailUsers:typeof t["allowSearchCrmEmailUsers"]!="undefined"?!!t["allowSearchCrmEmailUsers"]:false,userNameTemplate:typeof t["userNameTemplate"]!="undefined"?t["userNameTemplate"]:"",allowSonetGroupsAjaxSearch:typeof t["allowSonetGroupsAjaxSearch"]!="undefined"?t["allowSonetGroupsAjaxSearch"]:false,allowSonetGroupsAjaxSearchFeatures:typeof t["allowSonetGroupsAjaxSearchFeatures"]!="undefined"?t["allowSonetGroupsAjaxSearchFeatures"]:{}});BX.bind(BX("feed-add-post-destination-input"),"keyup",BX.delegate(BX.SocNetLogDestination.BXfpSearch,{formName:window.BXSocNetLogDestinationFormName,inputName:"feed-add-post-destination-input",tagInputName:"bx-destination-tag"}));BX.bind(BX("feed-add-post-destination-input"),"paste",BX.delegate(BX.SocNetLogDestination.BXfpSearch,{formName:window.BXSocNetLogDestinationFormName,inputName:"feed-add-post-destination-input",tagInputName:"bx-destination-tag"}));BX.bind(BX("feed-add-post-destination-input"),"keydown",BX.delegate(BX.SocNetLogDestination.BXfpSearchBefore,{formName:window.BXSocNetLogDestinationFormName,inputName:"feed-add-post-destination-input"}));BX.bind(BX("bx-destination-tag"),"focus",function(e){BX.SocNetLogDestination.openDialog(window.BXSocNetLogDestinationFormName,{bByFocusEvent:true});return BX.PreventDefault(e)});BX.bind(BX("feed-add-post-destination-container"),"click",function(e){BX.SocNetLogDestination.openDialog(window.BXSocNetLogDestinationFormName);return BX.PreventDefault(e)});BX.addCustomEvent(window,"onMentionAdd",function(e){if(!BX.type.isPlainObject(BX.SocNetLogDestination.obItems[window.BXSocNetLogDestinationFormName]["users"][e.id])){BX.SocNetLogDestination.obItems[window.BXSocNetLogDestinationFormName]["users"][e.id]=e}BX.addCustomEvent(window,"BX.SocNetLogDestination:onBeforeSelectItemFocus",function(e){if(e.id==window.BXSocNetLogDestinationFormName){e.blockFocus=true}});BX.SocNetLogDestination.selectItem(window.BXSocNetLogDestinationFormName,null,null,e.id,"users",false)});if(t["itemsHidden"]){for(var i in t["itemsHidden"]){if(t["itemsHidden"].hasOwnProperty(i)){window.BXfpdSelectCallback({id:(typeof t["itemsHidden"][i]["PREFIX"]!="undefined"?t["itemsHidden"][i]["PREFIX"]:"SG")+t["itemsHidden"][i]["ID"],name:t["itemsHidden"][i]["NAME"]},typeof t["itemsHidden"][i]["TYPE"]!="undefined"?t["itemsHidden"][i]["TYPE"]:"sonetgroups","",true,"","init")}}}BX.SocNetLogDestination.BXfpSetLinkName({formName:window.BXSocNetLogDestinationFormName,tagInputName:"bx-destination-tag",tagLink1:BX.message("BX_FPD_LINK_1"),tagLink2:BX.message("BX_FPD_LINK_2")})}window["BXfpdSelectCallbackMent"+e]=function(i,n,o){window.BxInsertMention({item:i,type:n,formID:e,editorId:t.editorId,fireAddEvent:t.initDestination})};window["BXfpdStopMent"+e]=function(){BX.SocNetLogDestination.closeDialog();BX.SocNetLogDestination.closeSearch();clearTimeout(BX.SocNetLogDestination.searchTimeout);BX.SocNetLogDestination.searchOnSuccessHandle=false};window["BXfpdOnDialogOpen"+e]=function(){d.listen=true;d.listenFlag=true};window["BXfpdOnDialogClose"+e]=function(){d.listen=false;setTimeout(function(){d.listenFlag=false;if(!d.listen){var e=a.getEditor(t.editorId);if(e){var i=e.GetIframeDoc(),n=i.getElementById("bx-mention-node");if(n){e.selection.SetAfter(n);if(d.leaveContent){e.util.ReplaceWithOwnChildren(n)}else{BX.remove(n)}}e.Focus()}}},100)};window["BXSocNetLogDestinationFormNameMent"+e]="mention"+(""+(new Date).getTime()).substr(5);window["BXSocNetLogDestinationDisableBackspace"]=null;var n=BX("bx-b-mention-"+e);if(typeof t["items"]["extranetRoot"]!="undefined"){t["items"]["departmentExtranet"]=BX.clone(t["items"]["department"]);for(var o in t["items"]["extranetRoot"]){if(t["items"]["extranetRoot"].hasOwnProperty(o)){t["items"]["departmentExtranet"][o]=t["items"]["extranetRoot"][o]}}t["items"]["departmentRelationExtranet"]=BX.SocNetLogDestination.buildDepartmentRelation(t["items"]["departmentExtranet"])}BX.SocNetLogDestination.init({name:window["BXSocNetLogDestinationFormNameMent"+e],searchInput:n,extranetUser:t["extranetUser"],bindMainPopup:{node:n,offsetTop:"1px",offsetLeft:"12px"},bindSearchPopup:{node:n,offsetTop:"1px",offsetLeft:"12px"},callback:{select:window["BXfpdSelectCallbackMent"+e],openDialog:window["BXfpdOnDialogOpen"+e],closeDialog:window["BXfpdOnDialogClose"+e],openSearch:window["BXfpdOnDialogOpen"+e],closeSearch:window["BXfpdOnDialogClose"+e]},items:{users:t["items"]["mentionUsers"],groups:{},sonetgroups:{},department:typeof t["items"]["departmentExtranet"]!="undefined"?t["items"]["departmentExtranet"]:t["items"]["department"],departmentRelation:typeof t["items"]["departmentRelationExtranet"]!="undefined"?t["items"]["departmentRelationExtranet"]:t["items"]["departmentRelation"]},itemsLast:{users:t["itemsLast"]["mentionUsers"],sonetgroups:{},department:{},groups:{}},itemsSelected:{},destSort:typeof t["mentionDestSort"]!="undefined"&&t["mentionDestSort"]?t["mentionDestSort"]:{},departmentSelectDisable:true,obWindowClass:"bx-lm-mention",obWindowCloseIcon:false,useClientDatabase:!!t["useClientDatabase"],userNameTemplate:typeof t["userNameTemplate"]!="undefined"?t["userNameTemplate"]:""});BX.ready(function(){var i=BX("bx-b-mention-"+e);if(BX.browser.IsIE()&&!BX.browser.IsIE9()){i.style.width="1px";i.style.marginRight="0"}BX.bind(i,"mousedown",function(n){if(d.listen!==true){var o=a.getEditor(t.editorId),s=o.GetIframeDoc();if(o.GetViewMode()=="wysiwyg"&&s){d.listen=true;d.listenFlag=true;d.text="";d.leaveContent=false;var r=o.selection.GetRange(),l=s.getElementById("bx-mention-node");if(l){BX.remove(l)}o.InsertHtml('<span id="bx-mention-node">'+o.INVISIBLE_SPACE+"</span>",r);setTimeout(function(){if(!BX.SocNetLogDestination.isOpenDialog()){BX.SocNetLogDestination.openDialog(window["BXSocNetLogDestinationFormNameMent"+e],{
bindNode:i})}var t=s.getElementById("bx-mention-node");if(t){r.setStart(t,0);if(t.firstChild&&t.firstChild.nodeType==3&&t.firstChild.nodeValue.length>0){r.setEnd(t,1)}else{r.setEnd(t,0)}o.selection.SetSelection(r)}o.Focus()},100)}else if(o.GetViewMode()=="code"){d.listen=true;d.listenFlag=true;d.text="";d.leaveContent=false;setTimeout(function(){if(!BX.SocNetLogDestination.isOpenDialog()){BX.SocNetLogDestination.openDialog(window["BXSocNetLogDestinationFormNameMent"+e],{bindNode:i})}},100)}BX.onCustomEvent(i,"mentionClick")}})})}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:71:"/bitrix/components/bitrix/system.field.edit/script.min.js?1511316472814";s:6:"source";s:53:"/bitrix/components/bitrix/system.field.edit/script.js";s:3:"min";s:57:"/bitrix/components/bitrix/system.field.edit/script.min.js";s:3:"map";s:57:"/bitrix/components/bitrix/system.field.edit/script.map.js";}"*/
function addElement(e,n){if(document.getElementById("main_"+e)){var d=document.getElementById("main_"+e).getElementsByTagName("div");if(d&&d.length>0&&d[0]){var t=d[0].parentNode;t.appendChild(d[d.length-1].cloneNode(true))}}}function addElementFile(e,n){var d=document.getElementById("main_"+e);var t=document.getElementById("main_add_"+e);if(d&&t){t=t.cloneNode(true);t.id="";t.style.display="";d.appendChild(t)}}function addElementDate(e,n){var d=document.getElementById("date_container_"+n);var t=document.getElementById("hidden_"+n).innerHTML;if(d&&t){var a=e[n].fieldName;var i=e[n].index;t=t.replace(/[#]FIELD_NAME[#]/g,a+"["+i+"]");t=t.replace(/[\%]23FIELD_NAME[\%]23/g,escape(a+"["+i+"]"));var l=d.appendChild(document.createElement("DIV"));l.innerHTML+=t;e[n].index++}}
/* End */
;
; /* Start:"a:4:{s:4:"full";s:87:"/bitrix/components/bitrix/disk.uf.file/templates/.default/script.min.js?151131648427406";s:6:"source";s:67:"/bitrix/components/bitrix/disk.uf.file/templates/.default/script.js";s:3:"min";s:71:"/bitrix/components/bitrix/disk.uf.file/templates/.default/script.min.js";s:3:"map";s:71:"/bitrix/components/bitrix/disk.uf.file/templates/.default/script.map.js";}"*/
(function(e){var t=false,i=false,s=0,o=null,n=null,a={};BX.namespace("BX.Disk");if(BX.Disk.UF)return;BX.Disk.UF=function(){var t=function(t){this.dialogName="DiskFileDialog";this.params=t;this.CID=t["UID"];this.controller=t.controller;this.values=t.values||[];this.prefix="diskuf-doc";this.onUploaderIsAlmostInited=BX.delegate(this.onUploaderIsAlmostInited,this);BX.addCustomEvent(e,"onUploaderIsAlmostInited",this.onUploaderIsAlmostInited);this.agent=BX.Uploader.getInstance({id:t["UID"],streams:3,allowUpload:"A",uploadFormData:"N",uploadMethod:"immediate",uploadFileUrl:t["urlUpload"],showImage:false,sortItems:false,input:t["input"],dropZone:t["dropZone"],placeHolder:t["placeHolder"],queueFields:{thumb:{tagName:"TR",className:"wd-inline-file"}},fields:{thumb:{tagName:"",template:BX.message("DISK_TMPLT_THUMB")}}});this.urlSelect=!!t["urlSelect"]?t["urlSelect"]:null;this.urlRenameFile=!!t["urlRenameFile"]?t["urlRenameFile"]:null;this.urlDeleteFile=!!t["urlDeleteFile"]?t["urlDeleteFile"]:null;this.urlSelect=this._addUrlParam(this.urlSelect,"dialog2=Y&ACTION=SELECT&MULTI=Y");this.urlUpload=!!t["urlUpload"]?t["urlUpload"]:null;this.urlShow=!!t["urlShow"]?t["urlShow"]:null;this.params.controlName=this.params.controlName||"FILES[]";this.init();return this};t.prototype={_addUrlParam:function(e,t){if(!e)return null;if(e.indexOf(t)==-1)e+=(e.indexOf("?")==-1?"?":"&")+t;return e},_camelToSNAKE:function(e){var t={},i,s;for(i in e){s=i.replace(/(.)([A-Z])/g,"$1_$2").toUpperCase();t[s]=e[i];t[i]=e[i]}return t},onUploaderIsAlmostInited:function(t,i){if(this.CID!=i["id"])return;BX.removeCustomEvent(e,"onUploaderIsAlmostInited",this.onUploaderIsAlmostInited);var s=BX.findChild(this.controller,{className:"diskuf-simple"},true),o=BX.findChild(this.controller,{className:"diskuf-extended"},true);if(t=="BX.UploaderSimple"){BX.remove(o);BX.show(s)}else{BX.remove(s);BX.show(o)}i.input=BX.findChild(this.controller,{className:"diskuf-fileUploader"},true);i.dropZone=BX.findChild(this.controller,{className:"diskuf-extended"},false);this.params.placeHolder=i["placeHolder"]=BX.findChild(this.controller,{className:"diskuf-placeholder-tbody"},true)},init:function(){this._onItemIsAdded=BX.delegate(this.onItemIsAdded,this);this._onFileIsAppended=BX.delegate(this.onFileIsAppended,this);this._onFileIsAttached=BX.delegate(this.onFileIsAttached,this);this._onFileIsBound=BX.delegate(this.onFileIsBound,this);this._onFileIsInited=BX.delegate(this.onFileIsInited,this);this._onError=BX.delegate(this.onError,this);BX.addCustomEvent(this.agent,"onItemIsAdded",this._onItemIsAdded);BX.addCustomEvent(this.agent,"onFileIsInited",this._onFileIsInited);BX.addCustomEvent(this.agent,"onError",this._onError);this._onUploadProgress=BX.delegate(this.onUploadProgress,this);this._onUploadDone=BX.delegate(this.onUploadDone,this);this._onUploadError=BX.delegate(this.onUploadError,this);this._onUploadRestore=BX.delegate(this.onUploadRestore,this);BX.onCustomEvent(BX(this.controller.parentNode),"DiskDLoadFormControllerInit",[this]);var e=[],t=[],i;for(var s=0;s<this.values.length;s++){i=BX.findChild(this.values[s],{className:"f-wrap"},true);if(!!i){e.push({name:i.innerHTML});t.push(this.values[s])}}this.values=[];this.agent.onAttach(e,t);var o=BX.findChild(this.controller,{className:"diskuf-selector-link"},true);if(!!o){BX.bind(o,"click",BX.proxy(this.showSelectDialog,this))}var n=BX.findChildren(this.controller,{className:"diskuf-selector-link-cloud"},true);if(!!n){for(var a in n){if(!n.hasOwnProperty(a))continue;BX.bind(n[a],"click",BX.proxy(this.showSelectDialogCloudImport,this))}}return false},addFile:function(e){return this.agent&&this.agent.onChange([e])},onItemIsAdded:function(){BX.removeCustomEvent(this.agent,"onItemIsAdded",this._onItemIsAdded);BX.show(BX.findParent(this.params.placeHolder,{className:"diskuf-files-block"}))},onFileIsInited:function(e,t){BX.addCustomEvent(t,"onFileIsAttached",this._onFileIsAttached);BX.addCustomEvent(t,"onFileIsAfterCreated",function(e,t,i,s){if(t&&!t.sizeInt){e.size=" "}});BX.addCustomEvent(t,"onFileIsAppended",this._onFileIsAppended);BX.addCustomEvent(t,"onFileIsBound",this._onFileIsBound);BX.addCustomEvent(t,"onUploadProgress",this._onUploadProgress);BX.addCustomEvent(t,"onUploadDone",this._onUploadDone);BX.addCustomEvent(t,"onUploadError",this._onUploadError)},onFileIs:function(e,t,i){this.bindEventsHandlers(e,t,i);var s={element_id:i.element_id,element_name:i.element_name||t.name,element_url:i.element_name||i.previewUrl||i.preview_url,place:e,storage:"disk"};this.values.push(e);BX.onCustomEvent(this.params.controller.parentNode,"OnFileUploadSuccess",[s,this,t.file,t]);t.__disk_element_id=i.element_id;BX.onCustomEvent(t,"OnFileUploadSuccess",[s,this])},onFileIsAppended:function(e,t){var i=this.agent.getItem(e),s=i.node;this.bindEventsHandlers(s,t,{})},onFileIsBound:function(e,t){var i=this.agent.getItem(e),s=i.node,o=s.getAttribute("id").replace("disk-edit-attach","");this.onFileIs(s,t,{element_id:o})},onFileIsAttached:function(e,t,i,s){if(!!s["sizeFormatted"])s["size"]=s["sizeFormatted"];if(!s.hasOwnProperty("service")){this.onUploadDone(t,{file:s});return}BX.Disk.ExternalLoader.startLoad({file:{id:s.id,name:s.name,service:s.service},onFinish:BX.delegate(function(e){var i=this.agent.getItem(t.id).node;BX.hide(i);var s={id:e.ufId,name:e.name,storage:e.storage,ext:t.ext,size:e.sizeFormatted,previewUrl:e.previewUrl,preview_url:e.previewUrl,element_url:e.previewUrl,size_int:parseInt(e.size,10)};var o;var n=BX.message("DISK_TMPLT_THUMB2").replace("#control_name#",this.params.controlName).replace("#CONTROL_NAME#",this.params.controlName);for(var a in s){o=s[a];if(s.hasOwnProperty(a)){if(a.toLowerCase()=="size"){if(s.hasOwnProperty("size_int")){if(parseInt(s["size_int"],10)==0||isNaN(s["size_int"])){o=""}}if(s.hasOwnProperty("SIZE_INT")||isNaN(s["SIZE_INT"])){if(parseInt(s["SIZE_INT"],10)==0){o=""}}}n=n.replace(new RegExp("#"+a.toLowerCase()+"#","gi"),o).replace(new RegExp("#"+a.toUpperCase()+"#","gi"),o)}}var l={id:"disk-edit-attach"+s.id,"bx-agentFileId":t.id},r;r=BX.create("TR",{attrs:l,props:{className:"wd-inline-file"},html:n});var d=BX.findChild(r,{className:"files-name-edit-btn"},true);if(d){BX.remove(d)}i.parentNode.insertBefore(r,i);s.element_id=s.id;this.agent.onAttach([s],[r]);t.deleteFile()},this),onProgress:BX.delegate(function(e){this.onUploadProgress(t,e)},this)})},onUploadProgress:function(e,t){t=Math.min(t,98);var i=e.id;if(!e.__progressBarWidth)e.__progressBarWidth=5;if(t>e.__progressBarWidth){e.__progressBarWidth=Math.ceil(t);e.__progressBarWidth=e.__progressBarWidth>100?100:e.__progressBarWidth;if(BX("wdu"+i+"Progressbar"))BX.adjust(BX("wdu"+i+"Progressbar"),{style:{width:e.__progressBarWidth+"%"}});if(BX("wdu"+i+"ProgressbarText"))BX.adjust(BX("wdu"+i+"ProgressbarText"),{text:e.__progressBarWidth+"%"})}},onUploadDone:function(e,t){if(t["file"]&&t["file"]["attachId"]&&t["file"]["attachId"]!=t["file"]["id"]){t["file"]["id"]=t["file"]["attachId"];delete t["file"]["attachId"]}var i=this.agent.getItem(e.id).node,s=this._camelToSNAKE(t["file"]);if(BX(i)){var o=BX.message("DISK_TMPLT_THUMB2").replace("#control_name#",this.params.controlName).replace("#CONTROL_NAME#",this.params.controlName),n;for(var a in s){if(s.hasOwnProperty(a)){n=s[a];if(a.toLowerCase()=="size"){if(s.hasOwnProperty("size_int")){if(parseInt(s["size_int"],10)==0){n=""}}if(s.hasOwnProperty("SIZE_INT")){if(parseInt(s["SIZE_INT"],10)==0){n=""}}}o=o.replace(new RegExp("#"+a.toLowerCase()+"#","gi"),n).replace(new RegExp("#"+a.toUpperCase()+"#","gi"),n)}}o=o.replace(new RegExp("#(width|height)#","gi"),"0").replace(new RegExp("#preview_url#","gi"),"javascript:void(0);");var l={id:"disk-edit-attach"+s.id,"bx-agentFileId":e.id},r;if(s["XML_ID"])l["bx-attach-xml-id"]=s["XML_ID"];if(s["FILE_ID"])l["bx-attach-file-id"]="n"+s["FILE_ID"];r=BX.create("TR",{attrs:l,props:{className:"wd-inline-file"},html:o});if(!t.file.canChangeName){var d=BX.findChild(r,{className:"files-name-edit-btn"},true);if(d){BX.remove(d)}}i.parentNode.replaceChild(r,i);s.element_id=s.id;this.onFileIs(r,e,s)}else{this.onUploadError(e,t,this.agent)}},onUploadError:function(e,t,i){var s=this.agent.getItem(e.id);if(!!s&&(s=s.node)&&BX(s)&&(i==true||!BX(s).hasAttribute("bx-disk-error"))){BX(s).setAttribute("bx-disk-error","Y");BX.adjust(s,{props:{className:"error-load"}});var o=t&&t["error"]?t["error"]:"Uploading error";s.cells[1].innerHTML="";s.cells[2].innerHTML='<span class="info-icon"></span><span class="error-text">'+o+"</span>";BX.onCustomEvent(e,"OnFileUploadFailed",[s,this]);BX.onCustomEvent(this.params.controller.parentNode,"OnFileUploadFailed",[s,this,e.file,e])}},onError:function(e,t,i){var s="Uploading error.",o=s,n,a;if(i){if(i["error"]&&typeof i["error"]=="string")o=i["error"];else if(i["message"]&&typeof i["message"]=="string")o=i["message"];else if(BX.type.isArray(i["errors"])&&i["errors"].length>0){o=[];for(var l=0;l<i["errors"].length;l++){if(typeof i["errors"][l]=="object"&&i["errors"][l]["message"])o.push(i["errors"][l]["message"])}if(o.length<=0)o.push("Uploading error.");o=o.join(" ")}}e.files=e.files||{};for(a in e.files){if(e.files.hasOwnProperty(a)){n=this.agent.queue.items.getItem(a);this.onUploadError(n,{error:o},o!=s)}}},onBlurRenameInput:function(e){var t=e.target||e.srcElement;var i=BX.findChild(t.parentNode,{className:"files-name-edit-btn"},true);if(!!i)BX.fireEvent(i,"click")},bindEventsHandlers:function(t,i,s){var o=s.element_id,n="file-action-control",a=BX.findChild(t,{className:"files-path"},true),l=BX.findChild(t,{className:"files-name-edit-btn"},true),r=BX.findChild(t,{className:"f-wrap"},true);if(!!l&&!!a&&!!r&&!a.getAttribute(n)){a.setAttribute(n,"enabled");BX.show(a,"inline");BX.hide(BX.findChild(t,{className:"files-placement"},true));BX.bind(a,"click",BX.delegate(function(){this.move(o,r.innerHTML,t)},this))}if(!!l){BX.bind(l,"click",BX.delegate(function(){BX.toggleClass(l.parentNode,"files-name-editable");this.rename(o,t)},this));var d=BX.findChild(t,{className:"files-name-edit-inp"},true);if(d){BX.bind(d,"keydown",BX.delegate(function(i){var s=(i||e.event).keyCode||(i||e.event).charCode;if(s==13){BX.unbind(d,"blur",BX.proxy(this.onBlurRenameInput,this));BX.toggleClass(l.parentNode,"files-name-editable");this.rename(o,t);return BX.PreventDefault(i)}if(s==27){BX.unbind(d,"blur",BX.proxy(this.onBlurRenameInput,this));BX.toggleClass(l.parentNode,"files-name-editable");this.revertRename(o,t);return BX.PreventDefault(i)}},this))}}var h=BX.findChild(t,{className:"feed-add-post-loading"},true),u=BX.delegate(function(){this.deleteFile(t,i)},this),c=BX.create("SPAN",{props:{className:"del-but"},events:{click:u}});if(!!h){var m=BX.findChild(h,{className:"del-but"},true);if(!!m)BX.bind(m,"click",u);else h.appendChild(c.cloneNode(true))}if(!BX.findChild(t,{className:"files-info"},true)){t.appendChild(BX.create("TD",{props:{className:"files-info"}}))}if(!BX.findChild(t,{className:"files-del-btn"},true)){t.appendChild(BX.create("TD",{props:{className:"files-del-btn"},children:[c]}))}if(!c.hasAttribute("bx-bound")){c.setAttribute("bx-bound","Y");BX.bind(c,"click",u);BX.onCustomEvent(t,"OnMkClose",[t])}},deleteFile:function(e,t){if(!!t.__disk_element_id){BX.Disk.ajax({url:this.urlDeleteFile,method:"POST",dataType:"json",data:{attachedId:t.__disk_element_id},onsuccess:function(e){}});BX.onCustomEvent(this.controller.parentNode,"OnFileUploadRemove",[t.__disk_element_id,this])}BX.removeCustomEvent(t,"onFileIsAttached",this._onFileIsAttached);BX.removeCustomEvent(t,"onFileIsAppended",this._onFileIsAppended);BX.removeCustomEvent(t,"onFileIsBound",this._onFileIsBound);BX.removeCustomEvent(t,"onUploadProgress",this._onUploadProgress);BX.removeCustomEvent(t,"onUploadDone",this._onUploadDone);BX.removeCustomEvent(t,"onUploadError",this._onUploadError);delete t.hash;t.deleteFile("deleteFile");BX.remove(e)},move:function(e,t,i){var s=this._addUrlParam(this.urlSelect.replace("ACTION=SELECT","").replace("MULTI=Y",""),"ID=E"+e+"&NAME="+t+"&wish=fakemove");while(s.indexOf("&&")>=0)s=s.replace("&&","&");if(!this._checkFileName){this._checkFileName=BX.proxy(this.checkFileName,this);this._selectFolder=BX.proxy(this.selectFolder,this);this._openSection=BX.proxy(this.openSection,this);this._selectItem=BX.proxy(this.selectItem,this);this._unSelectItem=BX.proxy(this.unSelectItem,this)}var o=i||BX("disk-edit-attach"+e),n=BX.findChild(o,{className:"f-wrap"},true);BX.DiskFileDialog.arParams={};BX.DiskFileDialog.arParams[this.dialogName]={element_id:e,element_name:n.innerHTML};BX.addCustomEvent(BX.DiskFileDialog,"loadItems",this._openSection);BX.addCustomEvent(BX.DiskFileDialog,"selectItem",this._selectItem);BX.addCustomEvent(BX.DiskFileDialog,"unSelectItem",this._unSelectItem);return BX.ajax.get(s,"dialogName="+this.dialogName,BX.delegate(function(){setTimeout(BX.delegate(function(){BX.DiskFileDialog.obCallback[this.dialogName]={saveButton:this._selectFolder};BX.DiskFileDialog.openDialog(this.dialogName)},this),100)},this))},rename:function(e,t){if(!this.urlRenameFile){return}var i=BX.findChild(t,{className:"files-name-editable"},true);var s=BX.findChild(t,{className:"files-name-edit-inp"},true);var o=BX.findChild(t,{className:"f-wrap"},true);var n=o.textContent||o.innerText;var a=n.split(".").pop();var l=s.value+"."+a;if(!!i){BX.focus(s);BX.bind(s,"blur",BX.proxy(this.onBlurRenameInput,this))}else if(s.value&&l!==n){BX.adjust(o,{text:l});var r=t.getAttribute("bx-agentFileId");var d=r?this.agent.getItem(r):null;if(!!d){d.item.file.name=l;d.item.name=l}var h=this.manager?this.manager.checkFile("disk_file"+e):null;if(!!h){h.name=l}BX.Disk.ajax({url:this.urlRenameFile,method:"POST",dataType:"json",data:{newName:l,attachedId:e},onsuccess:function(e){}})}},revertRename:function(e,t){if(!this.urlRenameFile){return}var i=BX.findChild(t,{className:"files-name-editable"},true);var s=BX.findChild(t,{className:"files-name-edit-inp"},true);var o=BX.findChild(t,{className:"f-wrap"},true);var n=o.textContent||o.innerText;var a=n.split(".");var l=a.pop();s.value=a.join(".")},showMovedFile:function(e,t,i){if(!e)return false;var s,o=e,n=BX("disk-edit-attach"+o),a=BX.findChild(n,{className:"files-path"},true);BX.cleanNode(a);i=i.split("/").join(" / ");a.innerHTML=i;var l=parseInt(a.offsetWidth);var r=parseInt(a.parentNode.offsetWidth)-150,d;s=r/(l/i.length);if(l>r){d=Math.floor(s/2)+1;i=i.substr(0,d)+" ... "+i.substr(i.length-d);a.innerHTML=i}var h=BX("diskuf-doc"+o);if(!!h){var u=this._fileUnserialize(h.value);u.section=t["sectionID"];u.iblock=t["iblockID"];h.value=this._fileSerialize(u)}return true},_fileUnserialize:function(e){if(!BX.type.isString(e))return false;var t=e.split("|");return{id:t[0]||0,section:t[1]||0,iblock:t[2]||0}},_fileSerialize:function(e){var t=[e.id,e.section,e.iblock];return t.join("|")},selectFolder:function(e,t,i,s){var o=false,n=false,a,l,r;if(BX.DiskFileDialog.arParams&&BX.DiskFileDialog.arParams[this.dialogName]&&BX.DiskFileDialog.arParams[this.dialogName]["element_id"])o=BX.DiskFileDialog.arParams[this.dialogName]["element_id"];var d=BX.delegate(function(e,t,i,s){BX.Disk.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam("/bitrix/tools/disk/uf.php","action","moveUploadedFile"),data:{attachedId:e,targetFolderId:t},onsuccess:BX.delegate(function(t){if(!t||t.status!="success"){BX.Disk.showModalWithStatusAction(t);return}this.showMovedFile(e,i,s)},this)})},this);for(a in i){if(i.hasOwnProperty(a)&&i[a].type==="folder"){l=e.name+i[a].path;r={sectionID:a,iblockID:e.iblock_id};d(o,i[a].id,r,l);n=true}}if(!n){l=e.name;r={sectionID:e.section_id,iblockID:e.iblock_id};if(!!s&&!!s.path&&s.path!="/"){l+=s.path;r.sectionID=s.id;if(!!s){d(o,s.id,r,l)}}}BX.removeCustomEvent(BX.DiskFileDialog,"loadItems",this._openSection);BX.removeCustomEvent(BX.DiskFileDialog,"loadItemsDone",this._checkFileName);BX.removeCustomEvent(BX.DiskFileDialog,"selectItem",this._selectItem);BX.removeCustomEvent(BX.DiskFileDialog,"unSelectItem",this._unSelectItem)},checkFileName:function(e){if(this.noticeTimeout){clearTimeout(this.noticeTimeout);this.noticeTimeout=null}if(!!e&&e!=this.dialogName)return;var t=BX.DiskFileDialog.arParams[this.dialogName]["element_name"];var i=false,s;for(s in BX.DiskFileDialog.obItems[this.dialogName]){if(BX.DiskFileDialog.obItems[this.dialogName].hasOwnProperty(s)){if(BX.DiskFileDialog.obItems[this.dialogName][s]["name"]==t)i=true;if(i)break}}if(i)BX.DiskFileDialog.showNotice(BX.message("DISK_FILE_EXISTS"),this.dialogName);else BX.DiskFileDialog.closeNotice(this.dialogName)},selectItem:function(e,t,i){if(i!=this.dialogName)return;var s=t.substr(1);var o=BX.DiskFileDialog.obCurrentTab[i].link;o=o.replace("/index.php","")+"/element/upload/"+s+"/?use_light_view=Y&AJAX_CALL=Y&SIMPLE_UPLOAD=Y&IFRAME=Y&sessid="+BX.bitrix_sessid()+"&SECTION_ID="+s+"&CHECK_NAME="+BX.DiskFileDialog.arParams[this.dialogName]["element_name"];o=o.replace("/files/lib/","/files/");BX.ajax.loadJSON(o,BX.delegate(function(e){var t=e.permission===true&&e["okmsg"]!="";if(this.noticeTimeout){clearTimeout(this.noticeTimeout);this.noticeTimeout=null}this.noticeTimeout=setTimeout(BX.delegate(function(){if(t){BX.DiskFileDialog.showNotice(this.msg.file_exists,this.dialogName)}else{BX.DiskFileDialog.closeNotice(this.dialogName)}},this),200)},this))},unSelectItem:function(){if(this.noticeTimeout){clearTimeout(this.noticeTimeout);this.noticeTimeout=null}this.noticeTimeout=setTimeout(BX.delegate(function(){this.checkFileName()},this),200)},openSection:function(e,t){if(t==this.dialogName){BX.DiskFileDialog.target[t]=this._addUrlParam(e,"dialog2=Y")}},openSectionCloud:function(e,t){if(t==this.dialogName){BX.DiskFileDialog.target[t]=this._addUrlParam(e,"dialog2=Y");BX.DiskFileDialog.target[t]=this._addUrlParam(BX.DiskFileDialog.target[t],"cloudImport=1")}},selectFile:function(e,t,i){var s=[],o;for(o in i){if(i.hasOwnProperty(o)){if(i[o].type=="file"&&!BX(this.prefix+o)){i[o].sizeFormatted=i[o]["size"];i[o].size=i[o]["sizeInt"];if(!i[o]["ext"])i[o]["ext"]=i[o]["name"].split(".").pop();if(!i[o]["storage"])i[o]["storage"]="";s.push(i[o])}}}this.agent.onAttach(s,s);BX.removeCustomEvent(BX.DiskFileDialog,"loadItems",this._openSection)},selectCloudFile:function(e,t,i){var s=[],o;for(o in i){if(i.hasOwnProperty(o)){if(i[o].type=="file"&&!BX(this.prefix+o)){if(i[o].hasOwnProperty("provider")){i[o].service=i[o].provider}else{i[o].service=n}i[o].sizeFormatted=i[o]["size"];i[o].size=i[o]["sizeInt"];if(!i[o]["ext"])i[o]["ext"]=i[o]["name"].split(".").pop();if(!i[o]["storage"])i[o]["storage"]="";s.push(i[o])}}}this.agent.onAttach(s,s);BX.removeCustomEvent(BX.DiskFileDialog,"loadItems",this._openSection)},showSelectDialog:function(){this._openSection=BX.proxy(this.openSection,this);this._selectFile=BX.proxy(this.selectFile,this);BX.addCustomEvent(BX.DiskFileDialog,"loadItems",this._openSection);BX.ajax.get(this.urlSelect,"dialogName="+this.dialogName,BX.delegate(function(){setTimeout(BX.delegate(function(){BX.DiskFileDialog.obCallback[this.dialogName]={saveButton:this._selectFile};BX.DiskFileDialog.openDialog(this.dialogName)},this),10)},this))},showSelectDialogCloudImport:function(e){var t=e.target||e.srcElement;if(!BX.hasClass(t,"diskuf-selector-link-cloud")){t=BX.findParent(t,{className:"diskuf-selector-link-cloud"})}if(!t||!t.getAttribute("data-bx-doc-handler"))return;n=t.getAttribute("data-bx-doc-handler");this._openSection=BX.proxy(this.openSectionCloud,this);this._selectFile=BX.proxy(this.selectFile,this);this._selectCloudFile=BX.proxy(this.selectCloudFile,this);BX.addCustomEvent(BX.DiskFileDialog,"loadItems",this._openSection);BX.ajax.get(this.urlSelect,"&cloudImport=1&service="+n+"&dialogName="+this.dialogName,BX.delegate(function(){setTimeout(BX.delegate(function(){BX.DiskFileDialog.obCallback[this.dialogName]={saveButton:this._selectCloudFile};BX.DiskFileDialog.openDialog(this.dialogName)},this),10)},this))}};return t}();BX.Disk.UF.dndCatcher={};BX.Disk.UF.add=function(e){e["controller"]=BX("diskuf-selectdialog-"+e["UID"]);if(e["controller"]&&BX.isNodeInDom(e["controller"])){e["values"]=BX.findChildren(e["controller"],{className:"wd-inline-file"},true);var t=BX(e["controller"]).parentNode;BX.onCustomEvent(e["controller"],"DiskLoadFormControllerWasBound",[e,"DiskLoadFormControllerWasBound"]);if(!BX(e["controller"]).hasAttribute("bx-disk-load-is-bound")){BX(e["controller"]).setAttribute("bx-disk-load-is-bound","Y");BX.addCustomEvent(t,"DiskLoadFormController",function(t){BX.Disk.UF.initialize(t,e)})}if(!!e["values"]&&e["values"].length>0&&!e["hideSelectDialog"])BX.onCustomEvent(e["controller"].parentNode,"DiskLoadFormController",["show"])}};BX.Disk.UF.initialize=function(e,t){e=e==="show"||e==="hide"?e:t["controller"].style.display!="none"?"hide":"show";if(!t["controller"].loaded){t["controller"].loaded=true;a[t["UID"]]=new BX.Disk.UF(t)}if(e=="show"){if(t["controller"].style.display!="block"){BX.fx.show(t["controller"],"fade",{time:.2});if(t["switcher"]&&t["switcher"].style.display!="none")BX.fx.hide(t["switcher"],"fade",{time:.1});BX.onCustomEvent(t["controller"],"onControllerIsShown",[t["controller"],a[t["UID"]]]);o=a[t["UID"]]}}else if(t["controller"].style.display!="none"){o=null;BX.fx.hide(t["controller"],"fade",{time:.2});BX.onCustomEvent(t["controller"],"onControllerIsHidden",[t["controller"],a[t["UID"]]])}return a[t["UID"]]};var l=function(e){if(!BX(e)||e.hasAttribute("bx-is-bound"))return;e.setAttribute("bx-is-bound","Y");this.img=e;this.node=e.parentNode.parentNode.parentNode;BX.unbindAll(e);BX.unbindAll(this.node);BX.show(this.node);BX.remove(this.node.nextSibling);this.id="wufdp_"+Math.random();BX.bind(this.node,"mouseover",BX.delegate(function(){this.turnOn()},this));BX.bind(this.node,"mouseout",BX.delegate(function(){this.turnOff()},this))};l.prototype={turnOn:function(){this.timeout=setTimeout(BX.delegate(function(){this.show()},this),500)},turnOff:function(){clearTimeout(this.timeout);this.timeout=null;this.hide()},show:function(){if(this.popup!=null)this.popup.close();if(this.popup==null){var e={width:this.img.naturalWidth,height:this.img.naturalHeight};if(BX["UploaderUtils"]){var t=BX.UploaderUtils.scaleImage(e,{width:parseInt(BX.message("DISK_THUMB_WIDTH")),height:parseInt(BX.message("DISK_THUMB_HEIGHT"))});e=t.destin}this.popup=new BX.PopupWindow("bx-wufd-preview-img-"+this.id,this.img.parentNode,{lightShadow:true,offsetTop:-7,offsetLeft:(51-28)/2+14,autoHide:true,closeByEsc:true,bindOptions:{position:"top"},events:{onPopupClose:function(){this.destroy()},onPopupDestroy:BX.proxy(function(){this.popup=null},this)},content:BX.create("DIV",{props:e,children:[BX.create("IMG",{props:e,attrs:{src:this.img.src}})]})});this.popup.show()}this.popup.setAngle({position:"bottom"});this.popup.bindOptions.forceBindPosition=true;this.popup.adjustPosition();this.popup.bindOptions.forceBindPosition=false},hide:function(){if(this.popup!=null)this.popup.close()}};BX.addCustomEvent("onDiskPreviewIsReady",function(e){new l(e)});BX.Disk.UF.runImport=function(e){BX.Disk.showActionModal({text:BX.message("DISK_UF_FILE_STATUS_PROCESS_LOADING"),showLoaderIcon:true,autoHide:false});BX.Disk.ExternalLoader.reloadLoadAttachedObject({attachedObject:{id:e.id,name:e.name,service:e.service},onFinish:BX.delegate(function(e){if(e.hasOwnProperty("hasNewVersion")&&!e.hasNewVersion){BX.Disk.showActionModal({text:BX.message("DISK_UF_FILE_STATUS_HAS_LAST_VERSION"),showSuccessIcon:true,autoHide:true})}else if(e.status==="success"){BX.Disk.showActionModal({text:BX.message("DISK_UF_FILE_STATUS_SUCCESS_LOADING"),showSuccessIcon:true,autoHide:true})}else{BX.Disk.showActionModal({text:BX.message("DISK_UF_FILE_STATUS_FAIL_LOADING"),autoHide:true})}},this),onProgress:BX.delegate(function(e){},this)}).start()};BX.Disk.UF.disableAutoCommentToAttachedObject=function(e){var t=e.attachedId;BX.Disk.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam("/bitrix/tools/disk/uf.php","action","disableAutoCommentToAttachedObject"),data:{attachedId:t},onsuccess:BX.delegate(function(e){},this)})};BX.Disk.UF.enableAutoCommentToAttachedObject=function(e){var t=e.attachedId;BX.Disk.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam("/bitrix/tools/disk/uf.php","action","enableAutoCommentToAttachedObject"),data:{attachedId:t},onsuccess:BX.delegate(function(e){},this)})};e.DiskCreateDocument=function(e){if(!o){return false}if(!e){return false}var t=new BX.CViewer({createDoc:true});var i=t.createBlankElementByParams({docType:e,editUrl:BX.message("DISK_CREATE_BLANK_URL"),renameUrl:BX.message("DISK_RENAME_FILE_URL")});t.setCurrent(i);i.afterSuccessCreate=function(e){var t={};var i=e.name.split(".");i.pop();t["E"+e.objectId]={type:"file",id:"n"+e.objectId,name:e.name,label:i.join("."),storage:e.folderName,size:e.size,sizeInt:e.sizeInt,ext:e.extension,canChangeName:true,link:e.link};setTimeout(function(){o.selectFile({},{},t)},200)};t.runActionByCurrentElement("create",{obElementViewer:t});try{BX.PreventDefault()}catch(s){}return false};e.DiskOpenMenuCreateService=function(e){var t=new BX.CViewer({});t.openMenu("disk_open_menu_with_services",BX(e),[BX.CViewer.isDisabledLocalEdit?null:{text:BX.message("DISK_FOLDER_TOOLBAR_LABEL_LOCAL_BDISK_EDIT"),className:"bx-viewer-popup-item item-b24",href:"#",onclick:BX.delegate(function(t){if(BX.CViewer.isEnableLocalEditInDesktop()){this.setEditService("l");BX.adjust(e,{text:BX.message("DISK_FOLDER_TOOLBAR_LABEL_LOCAL_BDISK_EDIT")});BX.PopupMenu.destroy("disk_open_menu_with_services")}else{this.helpDiskDialog()}return BX.PreventDefault(t)},t)},{text:t.getNameEditService("google"),className:"bx-viewer-popup-item item-gdocs",href:"#",onclick:BX.delegate(function(t){this.setEditService("google");BX.adjust(e,{text:this.getNameEditService("google")});BX.PopupMenu.destroy("disk_open_menu_with_services");return BX.PreventDefault(t)},t)},{text:t.getNameEditService("office365"),className:"bx-viewer-popup-item item-office365",href:"#",onclick:BX.delegate(function(t){this.setEditService("office365");BX.adjust(e,{text:this.getNameEditService("office365")});BX.PopupMenu.destroy("disk_open_menu_with_services");return BX.PreventDefault(t)},t)},{text:t.getNameEditService("skydrive"),className:"bx-viewer-popup-item item-office",href:"#",onclick:BX.delegate(function(t){this.setEditService("skydrive");BX.adjust(e,{text:this.getNameEditService("skydrive")});BX.PopupMenu.destroy("disk_open_menu_with_services");return BX.PreventDefault(t)},t)}],{offsetTop:0,offsetLeft:25})};e.DiskOpenMenuImportService=function(e,t){var i=[];for(var s in t){if(!t.hasOwnProperty(s))continue;i.push({text:t[s].name,code:t[s].id,href:"#",onclick:function(e,t){var i=t.layout.item;BX.addClass(i,"diskuf-selector-link-cloud");i.setAttribute("data-bx-doc-handler",t.code);BX.onCustomEvent("onManualChooseCloudImport",[{target:i}]);BX.removeClass(i,"diskuf-selector-link-cloud");i.removeAttribute("data-bx-doc-handler");BX.PopupMenu.destroy("disk_open_menu_with_import_services");return BX.PreventDefault(e)}})}var o=new BX.CViewer({});o.openMenu("disk_open_menu_with_import_services",BX(e),i,{offsetTop:0,offsetLeft:25});return BX.PreventDefault()};e.DiskActionFileMenu=function(e,t,i){s++;BX.PopupMenu.show("bx-viewer-wd-popup"+s+"_"+e,BX(t),i,{angle:{position:"top",offset:25},autoHide:true});return false};e.WDInlineElementClickDispatcher=function(e,t){var i=BX(t);if(i){BX.fireEvent(i,"click")}return false}})(window);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:97:"/bitrix/components/bitrix/tasks.task.detail.parts/templates/flat/time/logic.min.js?15113165988353";s:6:"source";s:78:"/bitrix/components/bitrix/tasks.task.detail.parts/templates/flat/time/logic.js";s:3:"min";s:82:"/bitrix/components/bitrix/tasks.task.detail.parts/templates/flat/time/logic.min.js";s:3:"map";s:82:"/bitrix/components/bitrix/tasks.task.detail.parts/templates/flat/time/logic.map.js";}"*/
BX.namespace("Tasks.Component");(function(){if(typeof BX.Tasks.Component.TaskElapsedTime!="undefined"){return}BX.Tasks.Component.TaskElapsedTime=function(e,t){this.container=BX(e);if(!this.container){return}this.parameters=t||{};this.messages=this.parameters.messages||{};this.template=this.parameters.template||"";this.nameTemplate=this.parameters.nameTemplate||"";this.pathToUserProfile=this.parameters.pathToUserProfile||"";this.ajaxPendingResponse=false;this.records={};var s=BX.type.isArray(this.parameters.records)?this.parameters.records:[];for(var a=0;a<s.length;a++){var i=s[a];var r=BX(i.rowId);this.addRecord(i.id,r,i.date,i.time,i.comment)}this.layout={addLinkRow:BX.findChildByClassName(this.container,"task-time-add-link-row",true),addLink:BX.findChildByClassName(this.container,"task-dashed-link",true),sendButton:BX.findChildByClassName(this.container,"task-table-edit-ok",true),cancelButton:BX.findChildByClassName(this.container,"task-table-edit-remove",true),formRow:BX.findChildByClassName(this.container,"task-time-form-row",true),lastRow:null};this.form={};var o=this.layout.formRow.getElementsByTagName("input");for(a=0;a<o.length;a++){var n=o[a];var d=n.getAttribute("name");this.form[d]=n;BX.bind(n,"keypress",BX.proxy(this.catchEnterKey,this))}this.query=new BX.Tasks.Util.Query({url:"/bitrix/components/bitrix/tasks.task.list/ajax.php"});this.query.bindEvent("executed",BX.proxy(this.onQueryExecuted,this));BX.bind(this.layout.addLink,"click",BX.proxy(this.add,this));BX.bind(this.layout.sendButton,"click",BX.proxy(this.send,this));BX.bind(this.layout.cancelButton,"click",BX.proxy(this.cancel,this));BX.bind(this.form.date,"click",function(){BX.calendar({node:this,field:this,form:"",bTime:true,value:this.value,bHideTime:false})});BX.bind(this.container,"click",BX.proxy(this.captureClick,this))};BX.Tasks.Component.TaskElapsedTime.prototype.add=function(){this.moveForm(this.layout.addLinkRow);this.setForm("","","1","00","00","")};BX.Tasks.Component.TaskElapsedTime.prototype.edit=function(e){var t=this.getRecordById(e);if(t){this.moveForm(t.row);this.setForm(t.id,t.date,t.hours,t.minutes,t.seconds,t.comment)}};BX.Tasks.Component.TaskElapsedTime.prototype.getRecordById=function(e){if(this.records[e]){return this.records[e]}return null};BX.Tasks.Component.TaskElapsedTime.prototype.getRecordByRow=function(e){for(var t in this.records){if(this.records.hasOwnProperty(t)&&this.records[t].row===e){return this.records[t]}}return null};BX.Tasks.Component.TaskElapsedTime.prototype.addRecord=function(e,t,s,a,i){if(!e||!BX.type.isDomNode(t)){return}a=parseInt(a,10);a=BX.type.isNumber(a)?a:0;var r=this.getTime(a);this.records[e]={row:t,id:e,date:s,hours:r.hours,minutes:r.minutes,seconds:r.seconds,time:a,comment:i}};BX.Tasks.Component.TaskElapsedTime.prototype.deleteRecord=function(e){delete this.records[e]};BX.Tasks.Component.TaskElapsedTime.prototype.delete=function(e){if(this.ajaxPendingResponse){return}this.query.deleteAll();this.query.add("task.elapsedtime.delete",{id:e},{code:"task.elapsedtime.delete"});this.query.execute();this.ajaxPendingResponse=true};BX.Tasks.Component.TaskElapsedTime.prototype.send=function(){if(this.ajaxPendingResponse){return}var e=parseInt(this.form.id.value,10);var t=parseInt(this.form.hours.value,10);var s=parseInt(this.form.minutes.value,10);var a=parseInt(this.form.seconds.value,10);t=BX.type.isNumber(t)?t:0;s=BX.type.isNumber(s)?s:0;var i={COMMENT_TEXT:BX.util.trim(this.form.comment.value),CREATED_DATE:this.form.date.value,SECONDS:t*3600+s*60+a};this.enable(false);this.query.deleteAll();if(e>0){this.query.add("task.elapsedtime.update",{id:e,data:i,parameters:{RETURN_ENTITY:true}},{code:"task.elapsedtime.update"})}else{i.TASK_ID=this.parameters.taskId;this.query.add("task.elapsedtime.add",{data:i,parameters:{RETURN_ENTITY:true}},{code:"task.elapsedtime.add"})}this.query.execute();this.ajaxPendingResponse=true};BX.Tasks.Component.TaskElapsedTime.prototype.onQueryExecuted=function(e){this.ajaxPendingResponse=false;if(!e.success||!e.data){return false}for(var t in e.data){if(!e.data.hasOwnProperty(t)){continue}if(!e.data[t].SUCCESS){return false}if(t==="task.elapsedtime.add"||t==="task.elapsedtime.update"){this.cancel();this.enable();var s=e.data[t]["RESULT"]["DATA"];var a=e.data[t]["RESULT"]["CAN"];var i="";if(a["MODIFY"]){i+=" task-time-table-edit"}if(a["REMOVE"]){i+=" task-time-table-remove"}var r=s["SOURCE"];var o="";if(r==2){o=this.messages.sourceManual;i+=" task-time-table-manually"}else if(r==1){o=this.messages.sourceUndefined;i+=" task-time-table-unknown"}var n=BX.formatName({NAME:s["USER_NAME"],LAST_NAME:s["USER_LAST_NAME"],SECOND_NAME:s["USER_SECOND_NAME"],LOGIN:s["USER_LOGIN"]},this.nameTemplate,"Y");var d=s["ID"];var l=BX.formatDate(BX.parseDate(s["CREATED_DATE"]),BX.message("FORMAT_DATETIME"));var m=s["COMMENT_TEXT"];var p=s["SECONDS"];p=this.getTime(p);var h=this.pathToUserProfile.replace("#user_id#",s["USER_ID"]);var u=BX.Tasks.Util.Template.compile(this.template);var f=u.getNode({rowId:"",rowClass:i,sourceNote:o,userName:n,date:l,timeFormatted:BX.Tasks.Util.formatTimeAmount(p.time),comment:m,pathToUserProfile:h});var c=this.getRecordById(d);var T=this.layout.addLinkRow;if(c){T=BX.findNextSibling(c.row);BX.remove(c.row)}this.addRecord(d,f[0],l,p.time,m);T.parentNode.insertBefore(f[0],T)}else if(t==="task.elapsedtime.delete"){var y=e.data[t]["ARGUMENTS"]||{};var k=this.getRecordById(y.id);if(k){k.row.parentNode.removeChild(k.row);this.deleteRecord(k.id)}}}var B=this.getSummary();BX.onCustomEvent("TaskElapsedTimeUpdated",[B.hours,B.minutes,this.records,B])};BX.Tasks.Component.TaskElapsedTime.prototype.getTime=function(e){var t=e>=0?1:-1;var s=Math.floor(t*Math.floor(Math.abs(e)/3600));var a=t*Math.floor(Math.abs(e)/60)%60;return{hours:s,minutes:a,seconds:e-s*3600-a*60,time:e}};BX.Tasks.Component.TaskElapsedTime.prototype.getSummary=function(){var e=0;for(var t in this.records){if(this.records.hasOwnProperty(t)){e+=this.records[t].time}}return this.getTime(e)};BX.Tasks.Component.TaskElapsedTime.prototype.showError=function(){var e=new BX.PopupWindow("task-elapsed-time-error-popup",null,{lightShadow:true,overlay:true,buttons:[new BX.PopupWindowButton({text:BX.message("JS_CORE_WINDOW_CLOSE"),className:"",events:{click:function(){BX.reload();this.popupWindow.close()}}})]});var t=[];for(var s=0;s<arguments.length;s++){var a=arguments[s];if(BX.type.isArray(a)){t=BX.util.array_merge(t,a)}else if(BX.type.isString(a)){t.push(a)}}var i="";for(s=0;s<t.length;s++){i+=(typeof t[s].MESSAGE!=="undefined"?t[s].MESSAGE:t[s])+"<br>"}e.setContent("<div class='task-detail-error-popup' style='width: 300px; margin: 15px; color: red; word-wrap: break-word;'>"+i+"</div>");e.show()};BX.Tasks.Component.TaskElapsedTime.prototype.cancel=function(){if(this.layout.lastRow){this.layout.lastRow.style.display=""}this.layout.formRow.style.display="none";this.layout.addLinkRow.style.display=""};BX.Tasks.Component.TaskElapsedTime.prototype.setForm=function(e,t,s,a,i,r){this.form.id.value=e;this.form.date.value=t;this.form.hours.value=s;this.form.minutes.value=a;this.form.seconds.value=i;this.form.comment.value=r;this.layout.formRow.style.display="";this.form.hours.focus();this.form.hours.select()};BX.Tasks.Component.TaskElapsedTime.prototype.moveForm=function(e){var t=BX.findNextSibling(e,{tag:"tr"});if(t){e.parentNode.insertBefore(this.layout.formRow,t)}else{e.parentNode.appendChild(this.layout.formRow)}if(this.layout.lastRow){this.layout.lastRow.style.display=""}this.layout.lastRow=e;this.layout.lastRow.style.display="none"};BX.Tasks.Component.TaskElapsedTime.prototype.captureClick=function(e){e=e||window.event;var t=e.target||e.srcElement;if(!BX.type.isDomNode(t)){return}if(BX.hasClass(t,"task-table-edit")||BX.hasClass(t,"task-table-remove")){var s=BX.findParent(t,{tagName:"tr"});var a=this.getRecordByRow(s);a=a||{};if(BX.hasClass(t,"task-table-edit")){this.edit(a.id)}else if(BX.hasClass(t,"task-table-remove")){this.delete(a.id)}BX.PreventDefault(e)}};BX.Tasks.Component.TaskElapsedTime.prototype.catchEnterKey=function(e){e=e||window.event;if(e.keyCode===13){this.send();BX.PreventDefault(e)}};BX.Tasks.Component.TaskElapsedTime.prototype.enable=function(e){var t=e===false;for(var s in this.form){if(this.form.hasOwnProperty(s)){this.form[s].disabled=t}}}}).call(this);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:100:"/bitrix/components/bitrix/tasks.task.detail.parts/templates/flat/sidebar/logic.min.js?15113165986614";s:6:"source";s:81:"/bitrix/components/bitrix/tasks.task.detail.parts/templates/flat/sidebar/logic.js";s:3:"min";s:85:"/bitrix/components/bitrix/tasks.task.detail.parts/templates/flat/sidebar/logic.min.js";s:3:"map";s:85:"/bitrix/components/bitrix/tasks.task.detail.parts/templates/flat/sidebar/logic.map.js";}"*/
BX.namespace("Tasks.Component");(function(){if(typeof BX.Tasks.Component.TaskViewSidebar!="undefined"){return}BX.Tasks.Component.TaskViewSidebar=function(t){this.layout={};this.parameters=t||{};this.taskId=this.parameters.taskId;this.messages=this.parameters.messages||{};this.workingTime=this.parameters.workingTime||{start:{hours:0,minutes:0},end:{hours:0,minutes:0}};this.can=this.parameters.can||{};this.allowTimeTracking=this.parameters.allowTimeTracking===true;this.user=this.parameters.user||{};this.isAmAuditor=this.parameters.iAmAuditor;this.auditorCtrl=null;this.pathToTasks=this.parameters.pathToTasks;this.initDeadline();this.initReminder();this.initMark();this.initTime();this.initTags();this.initAuditorThing();BX.addCustomEvent(window,"tasksTaskEvent",BX.delegate(this.onTaskEvent,this))};BX.Tasks.Component.TaskViewSidebar.prototype.initAuditorThing=function(){if(!this.can.EDIT){BX.Tasks.Util.Dispatcher.find("auditor-selector").then(function(t){this.auditorCtrl=t;t.bindControl("header-button","click",this.onToggleImAuditor.bind(this))}.bind(this))}};BX.Tasks.Component.TaskViewSidebar.prototype.onToggleImAuditor=function(){if(this.isAmAuditor){BX.Tasks.confirm(BX.message("TASKS_TTDP_TEMPLATE_USER_VIEW_LEAVE_AUDITOR_CONFIRM")).then(function(){this.syncAuditor()}.bind(this))}else{this.syncAuditor()}};BX.Tasks.Component.TaskViewSidebar.prototype.syncAuditor=function(){var t=this.taskId;var e=new BX.Tasks.Util.Query;e.run("task."+(this.isAmAuditor?"leaveauditor":"enterauditor"),{id:t}).then(function(t){if(t.isSuccess()){this.user.entityType="U";if(this.isAmAuditor){this.auditorCtrl.deleteItem(this.user)}else{this.auditorCtrl.addItem(this.user)}this.isAmAuditor=!this.isAmAuditor;this.auditorCtrl.setHeaderButtonLabelText(this.isAmAuditor?BX.message("TASKS_TTDP_TEMPLATE_USER_VIEW_LEAVE_AUDITOR"):BX.message("TASKS_TTDP_TEMPLATE_USER_VIEW_ENTER_AUDITOR"))}}.bind(this));e.run("task.checkcanread",{id:t}).then(function(t){if(t.isSuccess()){var e=t.getData();if(!e.READ){if(this.pathToTasks){window.document.location=this.pathToTasks}else{BX.reload()}}}}.bind(this));e.execute()};BX.Tasks.Component.TaskViewSidebar.prototype.onTaskEvent=function(t,e){e=e||{};var i=e.task||{};if(t=="UPDATE"&&i.ID==this.parameters.taskId){if(BX.type.isNotEmptyString(i.REAL_STATUS)&&BX.type.isNotEmptyString(i.STATUS_CHANGED_DATE)){this.setStatus(i.REAL_STATUS,i.STATUS_CHANGED_DATE)}}};BX.Tasks.Component.TaskViewSidebar.prototype.setStatus=function(t,e){var i=BX("task-detail-status-name");var a=BX("task-detail-status-date");i.innerHTML=BX.message("TASKS_STATUS_"+t);a.innerHTML=(t!=4&&t!=5?BX.message("TASKS_SIDEBAR_START_DATE")+" ":"")+BX.util.htmlspecialchars(e)};BX.Tasks.Component.TaskViewSidebar.prototype.initDeadline=function(){this.deadline=BX.type.isNotEmptyString(this.parameters.deadline)?this.parameters.deadline:"";this.layout.deadline=BX("task-detail-deadline");this.layout.deadlineClear=BX("task-detail-deadline-clear");if(!this.layout.deadline){return}BX.bind(this.layout.deadline,"click",BX.proxy(this.onDeadlineClick,this));BX.bind(this.layout.deadlineClear,"click",BX.proxy(this.clearDeadline,this))};BX.Tasks.Component.TaskViewSidebar.prototype.onDeadlineClick=function(t){var e=new Date;var i=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),this.workingTime.end.hours,this.workingTime.end.minutes));BX.calendar({node:this.layout.deadline,field:"",form:"",bTime:true,value:this.deadline?this.deadline:i,bHideTimebar:false,callback_after:BX.proxy(function(t,e){this.setDeadline(t)},this)})};BX.Tasks.Component.TaskViewSidebar.prototype.setDeadline=function(t){this.deadline=BX.calendar.ValueToString(t,true,false);this.layout.deadline.innerHTML=BX.date.format(BX.date.convertBitrixFormat(BX.message("FORMAT_DATETIME").replace(":SS","").replace("/SS","")),t,null,false);this.layout.deadlineClear.style.display="";this.updateDeadline()};BX.Tasks.Component.TaskViewSidebar.prototype.clearDeadline=function(){this.deadline="";this.layout.deadline.innerHTML=this.messages.emptyDeadline;this.layout.deadlineClear.style.display="none";this.updateDeadline()};BX.Tasks.Component.TaskViewSidebar.prototype.updateDeadline=function(){var t=new BX.Tasks.Util.Query;t.add("task.update",{id:this.taskId,data:{DEADLINE:this.deadline}},{},BX.delegate(function(){BX.onCustomEvent(window,"tasksTaskEventChangeDeadline",[this.taskId,this.deadline]);BX.Tasks.Util.fireGlobalTaskEvent("UPDATE",{ID:this.taskId},{STAY_AT_PAGE:true},{id:this.taskId,deadline:this.deadline})},this));t.execute()};BX.Tasks.Component.TaskViewSidebar.prototype.addReminder=function(){BX.onCustomEvent(window,"tasksTaskEventAddReminder",[this.layout.reminderAdd])};BX.Tasks.Component.TaskViewSidebar.prototype.initReminder=function(){this.layout.reminderAdd=BX("task-detail-reminder-add");BX.bind(this.layout.reminderAdd,"click",BX.delegate(this.addReminder,this))};BX.Tasks.Component.TaskViewSidebar.prototype.initMark=function(){if(!this.can["EDIT"]){return}this.mark=this.parameters.mark||"NULL";this.layout.mark=BX("task-detail-mark");if(this.layout.mark){BX.bind(this.layout.mark,"click",BX.proxy(this.onMarkClick,this))}};BX.Tasks.Component.TaskViewSidebar.prototype.onMarkClick=function(){BX.TaskGradePopup.show(this.taskId,this.layout.mark,{listValue:this.mark},{events:{onPopupChange:BX.proxy(this.onMarkChange,this)}})};BX.Tasks.Component.TaskViewSidebar.prototype.onMarkChange=function(){var t=BX.proxy_context;this.layout.mark.className="task-detail-sidebar-item-mark-"+t.listValue.toLowerCase();this.layout.mark.innerHTML=t.listItem.name;var e=new BX.Tasks.Util.Query;e.add("task.update",{id:this.taskId,data:{MARK:t.listValue==="NULL"?"":t.listValue}});var i=this.taskId;e.execute().then(function(){BX.Tasks.Util.fireGlobalTaskEvent("UPDATE",{ID:i},{STAY_AT_PAGE:true},{id:i})})};BX.Tasks.Component.TaskViewSidebar.prototype.initTime=function(){if(!this.allowTimeTracking){return}BX.Tasks.Util.Dispatcher.bindEvent("buttons-dayplan","task-timer-tick",BX.delegate(this.onTaskTimerTick,this))};BX.Tasks.Component.TaskViewSidebar.prototype.onTaskTimerTick=function(t,e){if(t!=this.taskId){return}var i=BX("task-detail-spent-time-"+this.taskId);if(i){i.innerHTML=BX.Tasks.Util.formatTimeAmount(e)}};BX.Tasks.Component.TaskViewSidebar.prototype.initTags=function(){BX.addCustomEvent("onTaskTagSelect",BX.proxy(this.saveTags,this))};BX.Tasks.Component.TaskViewSidebar.prototype.saveTags=function(t){var e="";for(var i=0,a=t.length;i<a;i++){if(i>0){e+=", "}e+=t[i].name}var s=new BX.Tasks.Util.Query;s.add("task.update",{id:this.taskId,data:{TAGS:e}});s.execute()}}).call(this);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:101:"/bitrix/components/bitrix/tasks.task.detail.parts/templates/flat/reminder/logic.min.js?15113165989236";s:6:"source";s:82:"/bitrix/components/bitrix/tasks.task.detail.parts/templates/flat/reminder/logic.js";s:3:"min";s:86:"/bitrix/components/bitrix/tasks.task.detail.parts/templates/flat/reminder/logic.min.js";s:3:"map";s:86:"/bitrix/components/bitrix/tasks.task.detail.parts/templates/flat/reminder/logic.map.js";}"*/
BX.namespace("Tasks.Component");(function(){if(typeof BX.Tasks.Component.TaskDetailPartsReminder!="undefined"){return}BX.Tasks.Component.TaskDetailPartsReminder=BX.Tasks.Util.ItemSet.extend({sys:{code:"reminder"},constants:{UNIT_DAY:"D",UNIT_HOUR:"H"},methods:{construct:function(){this.callConstruct(BX.Tasks.Util.ItemSet);this.vars.editItemValue=0;this.instances.windows={};this.instances.form=new e({scope:this.control("form"),id:this.id()+"-form",parent:this});this.setTaskId(this.option("taskId"));this.setTaskDeadLine(this.option("taskDeadline"));this.instances.form.bindEvent("save",BX.delegate(this.onItemApply,this));this.bindEvent("setTaskDeadLine",BX.delegate(this.setTaskDeadLine,this));BX.addCustomEvent(window,"tasksTaskEventChangeDeadline",BX.delegate(this.onTaskDeadLineChange,this));BX.addCustomEvent(window,"tasksTaskEventAddReminder",BX.delegate(this.openAddForm,this))},extractItemValue:function(){return this.vars.idOffset++},extractItemDisplay:function(){return"1"},openUpdateForm:function(t){var e=this.vars.items[t];this.vars.editItemValue=t;this.instances.form.open(e.scope(),e.vars.data)},createItem:function(e){e=t.prepareData(e);var i=this.getNodeByTemplate("item",e)[0];BX.append(i,this.control("items"));var s=new t({scope:i,data:e,auxData:this.option("auxData"),parent:this});return s},setTaskId:function(t){this.vars.taskId=t?t:0},setTaskDeadLine:function(t){var e=0;if(BX.type.isNotEmptyString(t)){e=this.dateStringToStamp(t)}this.instances.form.setDeadLineStamp(e)},openAddForm:function(t){this.vars.editItemValue=0;this.instances.form.open(t)},onTaskDeadLineChange:function(t,e){if(t==this.vars.taskId){this.setTaskDeadLine(e)}},onItemApply:function(t){if(this.vars.editItemValue!=0){this.vars.items[this.vars.editItemValue].update(t);this.syncAllIfCan()}else{this.addItem(t)}},fireChangeEvent:function(t){this.callMethod(BX.Tasks.Util.ItemSet,"fireChangeEvent",arguments);if(!t.load){this.syncAllIfCan()}},getDateDiff:function(t,e){if(!BX.type.isNumber(t)){t=this.dateStringToStamp(t)}if(!BX.type.isNumber(e)){e=this.dateStringToStamp(e)}var i=e-t;var s=this.UNIT_HOUR;if(i%86400==0){s=this.UNIT_DAY;i=Math.floor(i/86400)}else{i=Math.floor(i/3600)}return{diff:i,unit:s}},dateStampToString:function(t,e){var i=new Date(t*1e3);return BX.date.format(e,i,false,true)},dateStringToStamp:function(t){var e=BX.parseDate(t,true);if(e!=null){return Math.floor(parseInt(e.getTime())/1e3)}return 0},syncAll:function(){var t=this.getQuery();if(t&&parseInt(this.option("taskId"))){var e=[];for(var i in this.vars.items){e.push(this.vars.items[i].data())}t.add("task.update",{id:parseInt(this.option("taskId")),data:{SE_REMINDER:e}},{code:"update_reminder"})}}}});var t=BX.Tasks.Util.ItemSet.Item.extend({sys:{code:"item"},methods:{construct:function(){this.callConstruct(BX.Tasks.Util.ItemSet.Item);this.vars.data=this.option("data");this.vars.randomTag=Math.round(Math.random()*1e5);this.bindEvents()},bindEvents:function(){this.bindDelegateControl("edit","click",BX.delegate(this.onEditClick,this))},data:function(){return{TRANSPORT:this.vars.data.TRANSPORT,TYPE:this.vars.data.TYPE,REMIND_DATE:this.vars.data.REMIND_DATE,RECEPIENT_TYPE:this.vars.data.RECEPIENT_TYPE}},value:function(){return this.vars.data.VALUE},display:function(){return this.vars.data.DISPLAY},update:function(e){e=t.prepareData(e);this.control("transport").value=e.TRANSPORT;this.control("type").value=e.TYPE;this.control("remind-date").value=e.REMIND_DATE;this.control("recipient-type").value=e.RECEPIENT_TYPE;this.control("edit").innerHTML=e.REMINDER_TEXT;BX[e.TRANSPORT=="J"?"addClass":"removeClass"](this.control("info"),"transport-j");this.vars.data=BX.mergeEx(this.vars.data,e)},"delete":function(){var t=this.value();BX.remove(this.sys.scope);this.sys.scope=null;this.ctrls=null;this.vars.data=null;return t},onEditClick:function(t){this.parent().openUpdateForm(this.value());BX.PreventDefault(t)},onDeleteClick:function(t){this.parent().deleteItem(this.value());BX.PreventDefault(t)}}});t.prepareData=function(t){var e="";if(t.RECEPIENT_TYPE=="R"||t.RECEPIENT_TYPE=="O"||t.RECEPIENT_TYPE=="S"){e=BX.message("TASKS_TTDP_TEMPLATE_REMINDER_RECEPIENT_TYPE_"+t.RECEPIENT_TYPE)}t.REMINDER_TEXT=t.REMIND_DATE+" "+e;t.TRANSPORT_CLASS=t.TRANSPORT=="J"?"transport-j":"";return t};var e=BX.Tasks.Util.Widget.extend({sys:{code:"form"},constants:{REMINDER_TYPE_DEADLINE:"D",REMINDER_TYPE_COMMON:"A"},methods:{construct:function(){this.callConstruct(BX.Tasks.Util.Widget);this.vars.data={TYPE:"A",RECEPIENT_TYPE:"R",REMIND_DATE:"",TRANSPORT:"J"};this.vars.deadLine=0;this.vars.formatValue=BX.date.convertBitrixFormat(BX.message("FORMAT_DATETIME"))},load:function(t){if(!BX.type.isNotEmptyString(t.REMIND_DATE)){return}this.setType(t.TYPE);this.setRecipientType(t.RECEPIENT_TYPE);this.setTransportType(t.TRANSPORT);if(t.TYPE==this.REMINDER_TYPE_DEADLINE){var e=this.parent().getDateDiff(t.REMIND_DATE,this.vars.deadLine);this.setUnit(e.unit);this.setMultiplier(e.diff)}else{this.setDate(t.REMIND_DATE,true)}},reset:function(){this.setType("A");this.setRecipientType("R");this.setDate("",true);this.setTransportType("J");this.setMultiplier(1);this.setUnit(this.parent().UNIT_DAY)},open:function(t,e){var i=this.getWindow(t);if(typeof e!="undefined"){this.load(e)}else{this.reset()}this.changeCSSFlag("mode-update",typeof e!="undefined");i.show()},close:function(){this.getWindow().close();this.reset()},getWindow:function(t){if(typeof this.instances.window=="undefined"){this.instances.window=new BX.PopupWindow(this.id(),t,{autoHide:true,closeByEsc:true,content:this.scope(),overlay:false,lightShadow:true,closeIcon:true,draggable:false,titleBar:false,angle:{position:"top"},offsetTop:12,offsetLeft:45,events:{onPopupClose:BX.delegate(this.onFormClose,this)}});this.bindControl("change-type","click",this.passCtx(this.onChangeType));this.bindControl("change-recipient","change",this.passCtx(this.onChangeRecipientType));this.bindDelegateControl("change-transport","click",this.passCtx(this.onChangeTransportType));this.bindControl("submit","click",BX.delegate(this.onSubmit,this))}if(typeof this.instances.datepicker=="undefined"){var e=this.control("date");if(BX.type.isElementNode(e)){var i=new BX.Tasks.Util.DatePicker({scope:e,defaultTime:this.optionP("auxData").COMPANY_WORKTIME.HOURS.START});i.bindEvent("change",BX.delegate(this.onChangeRemindDate,this));i.bindEvent("open",BX.delegate(this.closeTypeSubWindow,this));this.instances.datepicker=i}}if(BX.type.isElementNode(t)){this.instances.window.setBindElement(t)}return this.instances.window},setDeadLineStamp:function(t){this.vars.deadLine=t;this.toggleDeadLineMode()},onChangeRemindDate:function(t,e){this.setDate(e,false)},setMultiplier:function(t){this.control("time-multiplier").value=t},setUnit:function(t){this.control("time-unit").value=t},setDate:function(t,e){if(typeof t=="undefined"){return}this.vars.data.REMIND_DATE=t;if(e){this.instances.datepicker.setValue(t)}},setType:function(t){if(!t){return}this.vars.data.TYPE=t;this.setCSSMode("type",t.toLowerCase())},setRecipientType:function(t){if(!t){return}this.vars.data.RECEPIENT_TYPE=t;this.control("change-recipient").value=t},setTransportType:function(t){if(!t){return}this.vars.data.TRANSPORT=t;this.setCSSMode("transport",t.toLowerCase())},toggleDeadLineMode:function(){var t=this.vars.deadLine<=0;if(t){if(this.vars.data.TYPE==this.REMINDER_TYPE_DEADLINE){this.setType(this.REMINDER_TYPE_COMMON);this.setDate(0,"")}}this.changeCSSFlag("no-deadline",t)},getDeadLineOffset:function(){var t=parseInt(this.control("time-multiplier").value);if(isNaN(t)){t=0}var e=this.control("time-unit").value=="D"?86400:3600;return this.parent().dateStampToString(this.vars.deadLine-t*e,this.vars.formatValue)},onSubmit:function(){if(this.vars.data.TYPE==this.REMINDER_TYPE_DEADLINE){this.vars.data.REMIND_DATE=this.getDeadLineOffset()}if(this.vars.data.REMIND_DATE.length==""){return}this.fireEvent("save",[BX.clone(this.vars.data)]);this.close()},onFormClose:function(){this.closeTypeSubWindow();this.closeCalendarSubWindow()},closeTypeSubWindow:function(){if(typeof this.instances.typeWindow!="undefined"&&this.instances.typeWindow!=null){this.instances.typeWindow.popupWindow.close()}},closeCalendarSubWindow:function(){if(typeof this.instances.datepicker!="undefined"&&this.instances.datepicker!=null){this.instances.datepicker.closeCalendar()}},onChangeTransportType:function(t){var e=BX.data(t,"transport");if(typeof e!="undefined"&&e!=null){this.setTransportType(e)}},onChangeRecipientType:function(t){this.setRecipientType(t.value)},onChangeType:function(t){var e=this;var i=[{text:BX.message("TASKS_TTDP_TEMPLATE_REMINDER_TYPE_A"),title:BX.message("TASKS_TTDP_TEMPLATE_REMINDER_TYPE_A_EX"),className:"menu-popup-no-icon",onclick:function(){e.setType("A");this.popupWindow.close()}},{text:BX.message("TASKS_TTDP_TEMPLATE_REMINDER_TYPE_D"),title:BX.message("TASKS_TTDP_TEMPLATE_REMINDER_TYPE_D_EX"),className:"menu-popup-no-icon",onclick:function(){e.setType("D");this.popupWindow.close()}}];var s=this.id()+"-form-transport";BX.PopupMenu.show(s,t,i,{offsetTop:0,events:{onPopupShow:BX.delegate(this.closeCalendarSubWindow,this)}});this.instances.typeWindow=BX.PopupMenu.getMenuById(s)}}})})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:97:"/bitrix/components/bitrix/tasks.widget.member.selector/templates/view/logic.min.js?15113165982419";s:6:"source";s:78:"/bitrix/components/bitrix/tasks.widget.member.selector/templates/view/logic.js";s:3:"min";s:82:"/bitrix/components/bitrix/tasks.widget.member.selector/templates/view/logic.min.js";s:3:"map";s:82:"/bitrix/components/bitrix/tasks.widget.member.selector/templates/view/logic.map.js";}"*/
"use strict";BX.namespace("Tasks.Component");(function(){if(typeof BX.Tasks.Component.TasksWidgetMemberSelectorView!="undefined"){return}BX.Tasks.Component.TasksWidgetMemberSelectorView=BX.Tasks.Component.extend({sys:{code:"mem-sel"},methods:{bindEvents:function(){this.getManager()},setHeaderButtonLabelText:function(e){this.control("header-button").innerHTML=BX.util.htmlspecialchars(e)},getManager:function(){return this.subInstance("mgr",function(){var e=new this.constructor.Manager({scope:this.scope(),data:this.option("data"),query:this.getQuery(),nameTemplate:this.option("nameTemplate"),min:this.option("min"),max:this.option("max"),path:this.option("path")});e.bindEvent("change-by-user",this.onChangeByUser.bind(this));return e})},onChangeByUser:function(){if(this.option("enableSync")){var e=parseInt(this.option("entityId"));var t=this.option("entityRoute");var n=this.option("fieldName");if(!e||!t||!n){return}var a={id:e,data:{}};var s=[];this.getManager().each(function(e){s.push({ID:e.value(),NAME:e.data().NAME,LAST_NAME:e.data().LAST_NAME,EMAIL:e.data().EMAIL})});a.data[n]=s;this.callRemote(t+".update",a).then(function(){BX.Tasks.Util.fireGlobalTaskEvent("UPDATE",{ID:e},{STAY_AT_PAGE:true},{id:e})})}},addItem:function(e){this.getManager().addItem(e)},deleteItem:function(e){this.getManager().deleteItem(this.getManager().extractItemValue(e))}}});BX.Tasks.Component.TasksWidgetMemberSelectorView.Manager=BX.Tasks.UserItemSet.extend({sys:{code:"mem-sel-is"},options:{preRendered:true,autoSync:true,role:false,multiple:false,useSearch:true,forceTop:true,useAdd:true,controlBind:"class",itemFx:"vertical",useSmartCodeNaming:true},methods:{construct:function(){this.callConstruct(BX.Tasks.UserItemSet);this.fireUserTriggeredChangeDebounce=BX.debounce(this.fireUserTriggeredChangeDebounce,800)},prepareData:function(e){e=this.callMethod(BX.Tasks.UserItemSet,"prepareData",arguments);e.AVATAR_CSS=e.AVATAR?"background: url('"+e.AVATAR+"') center no-repeat; background-size: 35px;":"";return e},onClose:function(){if(this.vars.changed){this.fireUserTriggeredChange()}this.vars.changed=false},onItemDeleteClicked:function(e){var t=this.doOnItem(e,this.deleteItem);if(t){this.fireUserTriggeredChangeDebounce()}},fireUserTriggeredChangeDebounce:function(){this.fireUserTriggeredChange()},fireUserTriggeredChange:function(){this.fireEvent("change-by-user")}}})}).call(this);
/* End */
;; /* /bitrix/components/bitrix/socialnetwork.admin.set/templates/.default/script.js?15113165822527*/
; /* /bitrix/components/bitrix/tasks.iframe.popup/templates/wrap/logic.min.js?15113165981319*/
; /* /bitrix/components/bitrix/tasks.task/templates/view/logic.min.js?15113165989454*/
; /* /bitrix/components/bitrix/tasks.list.controls/templates/.default/script.min.js?151131659816636*/
; /* /bitrix/components/bitrix/tasks.widget.checklist/templates/.default/logic.min.js?151131659813899*/
; /* /bitrix/components/bitrix/tasks.widget.member.selector/templates/projectlink/logic.min.js?15113165981911*/
; /* /bitrix/components/bitrix/tasks.widget.buttons/templates/task/logic.min.js?15113165987761*/
; /* /bitrix/components/bitrix/forum.comments/templates/.default/script.min.js?1511316498678*/
; /* /bitrix/components/bitrix/main.post.list/templates/.default/script.min.js?151131647236210*/
; /* /bitrix/components/bitrix/main.post.list/templates/.default/scripts_for_form.min.js?151131647214797*/
; /* /bitrix/components/bitrix/main.post.list/templates/.default/scripts_for_im.min.js?15113164728286*/
; /* /bitrix/components/bitrix/main.post.form/templates/.default/script.min.js?151131647264627*/
; /* /bitrix/components/bitrix/system.field.edit/script.min.js?1511316472814*/
; /* /bitrix/components/bitrix/disk.uf.file/templates/.default/script.min.js?151131648427406*/
; /* /bitrix/components/bitrix/tasks.task.detail.parts/templates/flat/time/logic.min.js?15113165988353*/
; /* /bitrix/components/bitrix/tasks.task.detail.parts/templates/flat/sidebar/logic.min.js?15113165986614*/
; /* /bitrix/components/bitrix/tasks.task.detail.parts/templates/flat/reminder/logic.min.js?15113165989236*/
; /* /bitrix/components/bitrix/tasks.widget.member.selector/templates/view/logic.min.js?15113165982419*/

//# sourceMappingURL=page_8f59fe20f1feb9f163c2b744c6eb56e5.map.js