
; /* Start:"a:4:{s:4:"full";s:97:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/script.min.js?151131647237595";s:6:"source";s:77:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/script.js";s:3:"min";s:81:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/script.min.js";s:3:"map";s:81:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/script.map.js";}"*/
BX.namespace("BX.Main");if(typeof BX.Main.interfaceButtons==="undefined"){BX.Main.interfaceButtons=function(t,e){this.classItem="main-buttons-item";this.classItemSublink="main-buttons-item-sublink";this.classItemText="main-buttons-item-text";this.classItemCounter="main-buttons-item-counter";this.classItemIcon="main-buttons-item-icon";this.classItemMore="main-buttons-item-more";this.classOnDrag="main-buttons-drag";this.classDropzone="main-buttons-submenu-dropzone";this.classSeporator="main-buttons-submenu-separator";this.classHiddenLabel="main-buttons-hidden-label";this.classSubmenuItem="main-buttons-submenu-item";this.classItemDisabled="main-buttons-disabled";this.classItemOver="over";this.classItemActive="main-buttons-item-active";this.classSubmenu="main-buttons-submenu";this.classSecret="secret";this.classItemLocked="locked";this.submenuIdPrefix="main_buttons_popup_";this.submenuWindowIdPrefix="menu-popup-";this.classSettingMenuItem="main-buttons-submenu-setting";this.classEditState="main-buttons-edit";this.classEditItemButton="main-buttons-item-edit-button";this.classDragItemButton="main-buttons-item-drag-button";this.classSettingsApplyButton="main-buttons-submenu-settings-apply";this.classSettingsResetButton="main-buttons-submenu-settings-reset";this.classSetHome="main-buttons-set-home";this.classSetHide="main-buttons-set-hide";this.classManage="main-buttons-manage";this.classContainer="main-buttons";this.classSubmenuNoHiddenItem="main-buttons-submenu-item-no-hidden";this.classDefaultSubmenuItem="menu-popup-item";this.classInner="main-buttons-inner-container";this.listContainer=null;this.pinContainer=null;this.dragItem=null;this.overItem=null;this.moreButton=null;this.messages=null;this.licenseParams=null;this.isSubmenuShown=false;this.isSubmenuShownOnDragStart=false;this.isSettingsEnabled=true;this.containerId=e.containerId;this.tmp={};this.init(t,e);return{getItemById:BX.delegate(this.getItemById,this),getAllItems:BX.delegate(this.getAllItems,this),getHiddenItems:BX.delegate(this.getHiddenItems,this),getVisibleItems:BX.delegate(this.getVisibleItems,this),getDisabledItems:BX.delegate(this.getDisabledItems,this),getMoreButton:BX.delegate(this.getMoreButton,this),adjustMoreButtonPosition:BX.delegate(this.adjustMoreButtonPosition,this),showSubmenu:BX.delegate(this.showSubmenu,this),closeSubmenu:BX.delegate(this.closeSubmenu,this),refreshSubmenu:BX.delegate(this.refreshSubmenu,this),getCurrentSettings:BX.delegate(this.getCurrentSettings,this),saveSettings:BX.delegate(this.saveSettings,this),setCounterValueByItemId:BX.delegate(this.setCounterValueByItemId,this),getCounterValueByItemId:BX.delegate(this.getCounterValueByItemId,this),updateCounter:BX.delegate(this.updateCounter,this),getActive:BX.delegate(this.getActive,this),isEditEnabled:BX.delegate(this.isEditEnabled,this),isActiveInMoreMenu:BX.delegate(this.isActiveInMoreMenu,this),isSettingsEnabled:this.isSettingsEnabled,classes:{item:this.classItem,itemText:this.classItemText,itemCounter:this.classItemCounter,itemIcon:this.classItemIcon,itemDisabled:this.classItemDisabled,itemOver:this.classItemOver,itemActive:this.classItemActive,itemLocked:this.classItemLocked,submenu:this.classSubmenu,submenuItem:this.classSubmenuItem,containerOnDrag:this.classOnDrag,classSettingMenuItem:this.classSettingMenuItem},itemsContainer:this.listContainer,itemsContainerId:this.listContainer.id}};BX.Main.interfaceButtons.prototype={init:function(t,e){this.listContainer=BX(this.getId());if(!BX.type.isPlainObject(e)){throw"BX.MainButtons: params is not Object"}if(!("containerId"in e)||!BX.type.isNotEmptyString(e.containerId)){throw"BX.MainButtons: containerId not set in params"}if(!BX.type.isDomNode(this.listContainer)){throw"BX.MainButtons: #"+e.containerId+" is not dom node"}if("classes"in e&&BX.type.isPlainObject(e.classes)){this.setCustomClasses(e.classes)}if("messages"in e&&BX.type.isPlainObject(e.messages)){this.setMessages(e.messages)}if("licenseWindow"in e&&BX.type.isPlainObject(e.licenseWindow)){this.setLicenseWindowParams(e.licenseWindow)}if("disableSettings"in e&&e.disableSettings==="true"){this.isSettingsEnabled=false;this.visibleControlMoreButton()}this.moreButton=this.getMoreButton();if(this.isSettingsEnabled){this.dragAndDropInit()}this.adjustMoreButtonPosition();this.bindOnClickOnMoreButton();this.bindOnScrollWindow();this.setContainerHeight();BX.bind(this.getContainer(),"click",BX.delegate(this._onDocumentClick,this));BX.addCustomEvent("onPullEvent-main",BX.delegate(this._onPush,this));this.updateMoreButtonCounter();if(this.isActiveInMoreMenu()){this.activateItem(this.moreButton)}var s=this.getVisibleItems();var i=BX.type.isArray(s)&&s.length>0?s[0]:null;var n=BX.Buttons.Utils.getByTag(i,"a");if(!BX.type.isDomNode(n)){return}var a=n.getAttribute("href");if(a.charAt(0)==="?"){a=n.pathname+n.search}if(!this.lastHomeLink){this.lastHomeLink=a}this.bindOnResizeFrame()},_onDocumentClick:function(t){var e=this.getItem(t);var s,i,n,a,o,u;if(this.isDragButton(t.target)){t.preventDefault();t.stopPropagation()}if(BX.type.isDomNode(e)){if(!this.isSublink(t.target)){s=this.dataValue(e,"onclick");if(BX.type.isNotEmptyString(s)){t.preventDefault();this.execScript(s)}}if(this.isSettings(e)){this.enableEdit();BX.hide(this.getSettingsButton());BX.show(this.getSettingsApplyButton())}if(this.isApplySettingsButton(e)){t.preventDefault();t.stopPropagation();this.disableEdit();BX.show(this.getSettingsButton());BX.hide(this.getSettingsApplyButton())}if(this.isResetSettingsButton(e)){this.resetSettings()}if(this.isLocked(e)){t.preventDefault();this.showLicenseWindow()}if(this.isEditButton(t.target)){var r,h;t.preventDefault();t.stopPropagation();if(this.isSubmenuItem(e)){e=this.getItemAlias(e)}try{r=JSON.parse(BX.data(e,"item"))}catch(l){}h=this.getItemEditMenu();if(h&&h.popupWindow.isShown()&&this.lastEditNode===e){h.popupWindow.close()}else{this.showItemEditMenu(r,t.target)}this.lastEditNode=e}if(this.isSetHide(e)){o=this.getVisibleItems();u=BX.type.isArray(o)?o.length:null;a=this.editItemData.ID.replace(this.listContainer.id+"_","");i=this.getItemById(a);n=this.getItemAlias(i);i=this.isVisibleItem(i)?i:n;if(this.isDisabled(n)){this.enableItem(n)}else if(!this.isDisabled(n)&&u>2){this.disableItem(n)}if(u===2){BX.onCustomEvent(window,"BX.Main.InterfaceButtons:onHideLastVisibleItem",[i,this])}this.refreshSubmenu();this.saveSettings();this.adjustMoreButtonPosition();if(this.isEditEnabled()){this.enableEdit();BX.hide(this.getSettingsButton());BX.show(this.getSettingsApplyButton())}this.editMenu.popupWindow.close()}if(this.isSetHome(e)){a=this.editItemData.ID.replace(this.listContainer.id+"_","");i=this.getItemById(a);n=this.getItemAlias(i);if(this.isDisabled(n)){this.enableItem(n)}this.listContainer.insertBefore(i,BX.firstChild(this.listContainer));this.adjustMoreButtonPosition();this.refreshSubmenu();this.saveSettings();if(this.isEditEnabled()){this.enableEdit();BX.hide(this.getSettingsButton());BX.show(this.getSettingsApplyButton())}this.editMenu.popupWindow.close()}}if(this.isEditEnabled()){this.getSubmenu().popupWindow.setAutoHide(false)}},isActiveInMoreMenu:function(){var t=this.getHiddenItems();var e=this.getDisabledItems();var s=t.concat(e);return s.some(function(t){var e;try{e=JSON.parse(BX.data(t,"item"))}catch(s){}return BX.type.isPlainObject(e)&&("IS_ACTIVE"in e&&e.IS_ACTIVE===true||e.IS_ACTIVE==="true"||e.IS_ACTIVE==="Y")},this)},_onPush:function(t,e){if(t==="user_counter"&&e&&BX.message("SITE_ID")in e){var s=e[BX.message("SITE_ID")];for(var i in s){if(s.hasOwnProperty(i)){this.updateCounter(i,s[i])}}}},bindOnScrollWindow:function(){BX.bind(window,"scroll",BX.delegate(this._onScroll,this))},getActive:function(){var t=this.getAllItems();var e,s;var i=null;if(BX.type.isArray(t)){t.forEach(function(t){try{e=JSON.parse(BX.data(t,"item"))}catch(s){e=null}if(BX.type.isPlainObject(e)&&"IS_ACTIVE"in e&&(e.IS_ACTIVE===true||e.IS_ACTIVE==="true"||e.IS_ACTIVE==="Y")){i=e}},this)}if(BX.type.isPlainObject(i)){s=BX(i.ID);if(BX.type.isDomNode(s)){i.NODE=s}else{i.NODE=null}}return i},isSetHome:function(t){return BX.hasClass(t,this.classSetHome)},isSetHide:function(t){return BX.hasClass(t,this.classSetHide)},getSettingsButton:function(){return BX.Buttons.Utils.getByClass(this.getSubmenuContainer(),this.classSettingMenuItem)},getSettingsApplyButton:function(){return BX.Buttons.Utils.getByClass(this.getSubmenuContainer(),this.classSettingsApplyButton)},isApplySettingsButton:function(t){return BX.hasClass(t,this.classSettingsApplyButton)},enableEdit:function(){var t=this.getSubmenu();if(t&&"popupWindow"in t){t.popupWindow.setAutoHide(false)}BX.addClass(this.listContainer,this.classEditState);BX.addClass(this.getSubmenuContainer(),this.classEditState);this.isEditEnabledState=true},disableEdit:function(){var t=this.getSubmenu();if(t&&"popupWindow"in t){t.popupWindow.setAutoHide(true)}BX.removeClass(this.listContainer,this.classEditState);BX.removeClass(this.getSubmenuContainer(),this.classEditState);this.isEditEnabledState=false},isEditEnabled:function(){return this.isEditEnabledState},showItemEditMenu:function(t,e){if(BX.type.isPlainObject(t)&&"ID"in t){var s=[this.listContainer.id,"_edit_item"].join("");var i=BX.PopupMenu.getMenuById(s);if(i){BX.PopupMenu.destroy(s)}i=this.createItemEditMenu(t,s,e);i.popupWindow.show()}},getContainer:function(){if(!BX.type.isDomNode(this.container)){this.container=BX(this.containerId).parentNode}return this.container},getItemEditMenu:function(){return BX.PopupMenu.getMenuById([this.listContainer.id,"_edit_item"].join(""))},createItemEditMenu:function(t,e,s){var i;var n=[{text:this.message("MIB_SET_HOME"),className:"main-buttons-set-home menu-popup-no-icon"}];var a=t.ID.replace(this.listContainer.id+"_","");var o=this.getItemById(a);if(this.isDisabled(o)){n.push({text:this.message("MIB_SET_SHOW"),className:"main-buttons-set-hide menu-popup-no-icon"})}else{n.push({text:this.message("MIB_SET_HIDE"),className:"main-buttons-set-hide menu-popup-no-icon"})}var u=BX.pos(s);var r={menuId:e,anchor:s,menuItems:n,settings:{autoHide:true,offsetTop:0,offsetLeft:u.width/2,zIndex:20,angle:{position:"top",offset:u.width/2}}};i=BX.PopupMenu.create(r.menuId,r.anchor,r.menuItems,r.settings);if(this.isVisibleItem(o)){t.NODE=o}else{t.NODE=this.getItemAlias(o)}this.editItemData=t;if("menuItems"in i&&BX.type.isArray(i.menuItems)){i.menuItems.forEach(function(t){BX.bind(t.layout.item,"click",BX.delegate(this._onDocumentClick,this))},this)}BX.onCustomEvent(window,"BX.Main.InterfaceButtons:onBeforeCreateEditMenu",[i,t,this]);this.editMenu=i;return i},setHome:function(){var t=this.getVisibleItems();var e=BX.type.isArray(t)&&t.length>0?t[0]:null;var s=BX.Buttons.Utils.getByTag(e,"a");if(!BX.type.isDomNode(s)){return}var i=s.getAttribute("href");if(i.charAt(0)==="?"){i=s.pathname+s.search}if(!this.lastHomeLink){this.lastHomeLink=i}if(this.lastHomeLink!==i){BX.userOptions.save("ui",this.listContainer.id,"firstPageLink",i);BX.onCustomEvent("BX.Main.InterfaceButtons:onFirstItemChange",[i,e])}this.lastHomeLink=i},isEditButton:function(t){return BX.hasClass(t,this.classEditItemButton)},isDragButton:function(t){return BX.hasClass(t,this.classDragItemButton)},isResetSettingsButton:function(t){return BX.hasClass(t,this.classSettingsResetButton)},getContainerHeight:function(){var t=this.getAllItems().map(function(t){var e=getComputedStyle(t);return BX.height(t)+parseInt(e.marginTop)+parseInt(e.marginBottom)});return Math.max.apply(Math,t)},setContainerHeight:function(){var t=this.getContainerHeight();BX.height(this.listContainer,t)},setLicenseWindowParams:function(t){this.licenseParams=t||{}},message:function(t){var e;try{e=this.messages[t]}catch(s){e=""}return e},setCustomClasses:function(t){if(!BX.type.isPlainObject(t)){return}this.classItem=t.item||this.classItem;this.classItemSublink=t.itemSublink||this.classItemSublink;this.classItemText=t.itemText||this.classItemText;this.classItemCounter=t.itemCounter||this.classItemCounter;this.classItemIcon=t.itemIcon||this.classItemIcon;this.classItemMore=t.itemMore||this.classItemMore;this.classItemOver=t.itemOver||this.classItemOver;this.classItemActive=t.itemActive||this.classItemActive;this.classItemDisabled=t.itemDisabled||this.classItemDisabled;this.classOnDrag=t.onDrag||this.classOnDrag;this.classDropzone=t.dropzone||this.classDropzone;this.classSeporator=t.separator||this.classSeporator;this.classSubmenuItem=t.submenuItem||this.classSubmenuItem;this.classSubmenu=t.submenu||this.classSubmenu;this.classSecret=t.secret||this.classSecret;this.classItemLocked=t.itemLocked||this.classItemLocked},setMessages:function(t){if(!BX.type.isPlainObject(t)){return}this.messages=t},makeFullItemId:function(t){if(!BX.type.isNotEmptyString(t)){return}return[this.listContainer.id,t.replace("-","_")].join("_")},getItemById:function(t){var e=null;var s;if(BX.type.isNotEmptyString(t)){s=this.makeFullItemId(t);e=BX.Buttons.Utils.getBySelector(this.listContainer,"#"+s)}return e},getItemCounterObject:function(t){var e=null;if(BX.type.isDomNode(t)){e=BX.Buttons.Utils.getByClass(t,this.classItemCounter)}return e},setCounterValue:function(t,e){var s=this.getItemCounterObject(t);if(BX.type.isDomNode(s)){s.innerText=e>99?"99+":e>0?e:"";t.dataset.counter=e}this.updateMoreButtonCounter()},updateCounter:function(t,e){var s,i,n;var a=null;var o=this.getAllItems();if(BX.type.isArray(o)){o.forEach(function(e){try{i=JSON.parse(BX.data(e,"item"))}catch(s){i={}}if(BX.type.isPlainObject(i)&&"COUNTER_ID"in i&&i.COUNTER_ID===t){a=e}},this)}s=this.getItemCounterObject(a);if(BX.type.isDomNode(s)){a=this.getItem(s);s.innerText=e>99?"99+":e>0?e:"";a.dataset.counter=e}n=this.getItemAlias(a);if(BX.type.isDomNode(n)){s=this.getItemCounterObject(n);if(BX.type.isDomNode(s)){s.innerText=e>99?"99+":e>0?e:"";n.dataset.counter=e}}this.updateMoreButtonCounter()},setCounterValueByItemId:function(t,e){var s=e!==null?parseFloat(e):null;var i,n;if(!BX.type.isNotEmptyString(t)){throw"Bad first arg. Need string as item id"}if(s!==null&&!BX.type.isNumber(s)){throw"Bad two arg. Need number counter value - Integer, Float or string with number"}i=this.getItemById(t);if(!BX.type.isDomNode(i)){console.info("Not found node with id #"+t);return}n=this.getItemAlias(i);this.setCounterValue(i,s);this.setCounterValue(n,s)},getCounterValueByItemId:function(t){var e,s;var i=NaN;if(!BX.type.isNotEmptyString(t)){throw"Bad first arg. Need string item id"}else{e=this.getItemById(t);i=this.dataValue(e,"counter");i=parseFloat(i);if(!BX.type.isNumber(i)){s=this.getItemCounterObject(e);i=parseFloat(s.innerText)}}return i},setMoreButtonCounter:function(t){var e=this.getItemCounterObject(this.moreButton);var s=t>99?"99+":t>0?t:"";s=parseInt(s);s=BX.type.isNumber(s)?s:"";e.innerText=s},bindOnClickOnMoreButton:function(){BX.bind(this.moreButton,"click",BX.delegate(this._onClickMoreButton,this))},bindOnResizeFrame:function(){window.frames["maininterfacebuttonstmpframe-"+this.getId()].onresize=BX.throttle(this._onResizeHandler,20,this)},getId:function(){return BX.Buttons.Utils.getByClass(this.getContainer(),this.classInner).id},getAllItems:function(){return BX.Buttons.Utils.getByClass(this.listContainer,this.classItem,true)},getVisibleItems:function(){var t=this.getAllItems();var e=this;var s=[];if(t&&t.length){s=t.filter(function(t){return e.isVisibleItem(t)&&!e.isDisabled(t)})}return s},getHiddenItems:function(){var t=this.getAllItems();var e=[];var s=this;if(t&&t.length){e=t.filter(function(t){return!s.isVisibleItem(t)&&!s.isDisabled(t)})}return e},getDisabledItems:function(){return this.getAllItems().filter(function(t){return this.isDisabled(t)},this)},getMoreButton:function(){var t=null;this.getAllItems().forEach(function(e){!t&&BX.hasClass(e,this.classItemMore)&&(t=e)},this);return t},getLastVisibleItem:function(){var t=this.getVisibleItems();var e=null;if(BX.type.isArray(t)&&t.length){e=t[t.length-1]}if(!BX.type.isDomNode(e)){e=null}return e},adjustMoreButtonPosition:function(){var t=this.getLastVisibleItem();var e=this.isMoreButton(t);if(!e){this.listContainer.insertBefore(this.moreButton,t)}this.updateMoreButtonCounter()},getSubmenuId:function(t){var e="";if(BX.type.isDomNode(this.listContainer)&&BX.type.isNotEmptyString(this.listContainer.id)){e=this.submenuIdPrefix+this.listContainer.id}if(t){e=this.submenuWindowIdPrefix+e}return e},getSubmenuItemText:function(t){var e,s,i;if(!BX.type.isDomNode(t)){return null}e=this.findChildrenByClassName(t,this.classItemText);s=this.findChildrenByClassName(t,this.classItemCounter);if(BX.type.isDomNode(s)&&BX.type.isDomNode(e)){s.dataset.counter=this.dataValue(t,"counter");i=e.outerHTML+s.outerHTML}else{e=this.dataValue(t,"text");s=this.dataValue(t,"counter");i=e}return i},getLockedClass:function(t){var e="";if(BX.type.isDomNode(t)&&this.isLocked(t)){e=this.classItemLocked}return e},getSubmenuItems:function(){var t=this.getAllItems();var e=this.getHiddenItems();var s=this.getDisabledItems();var i=[];var n,a;if(t.length){t.forEach(function(t){if(e.indexOf(t)===-1&&s.indexOf(t)===-1){i.push({text:this.getSubmenuItemText(t),href:this.dataValue(t,"url"),title:t.getAttribute("title"),className:[this.classSubmenuItem,this.getIconClass(t),this.classSecret,this.getAliasLink(t),this.getLockedClass(t)].join(" ")})}},this)}if(e.length){e.forEach(function(t){try{n=JSON.parse(this.dataValue(t,"item"))}catch(e){n=null}a=[this.classSubmenuItem,this.getIconClass(t),this.getAliasLink(t),this.getLockedClass(t)];if(BX.type.isPlainObject(n)&&("IS_ACTIVE"in n&&n.IS_ACTIVE===true||n.IS_ACTIVE==="true"||n.IS_ACTIVE==="Y")){a.push(this.classItemActive)}i.push({text:this.getSubmenuItemText(t),href:this.dataValue(t,"url"),title:t.getAttribute("title"),className:a.join(" ")})},this)}if(this.isSettingsEnabled){i.push({text:"<span>"+this.message("MIB_HIDDEN")+"</span>",className:[this.classSeporator,this.classSubmenuItem,this.classHiddenLabel].join(" ")});if(!s.length){i.push({text:"<span>"+this.message("MIB_NO_HIDDEN")+"</span>",className:[this.classSubmenuItem,this.classSubmenuNoHiddenItem].join(" ")})}if(s.length){s.forEach(function(t){try{n=JSON.parse(this.dataValue(t,"item"))}catch(e){n=null}a=[this.classSubmenuItem,this.classItemDisabled,this.getIconClass(t),this.getAliasLink(t),this.getLockedClass(t)];if(BX.type.isPlainObject(n)&&("IS_ACTIVE"in n&&n.IS_ACTIVE===true||n.IS_ACTIVE==="true"||n.IS_ACTIVE==="Y")){a.push(this.classItemActive)}i.push({text:this.getSubmenuItemText(t),href:this.dataValue(t,"url"),title:t.getAttribute("title"),className:a.join(" ")})},this)}i.push({text:"<span>"+this.message("MIB_MANAGE")+"</span>",className:[this.classSeporator,this.classSubmenuItem,this.classHiddenLabel,this.classManage].join(" ")});i.push({text:this.message("MIB_SETTING_MENU_ITEM"),className:[this.classSettingMenuItem,this.classSubmenuItem].join(" ")});i.push({text:this.message("MIB_APPLY_SETTING_MENU_ITEM"),className:[this.classSettingsApplyButton,this.classSubmenuItem].join(" ")});i.push({text:this.message("MIB_RESET_SETTINGS"),className:[this.classSettingsResetButton,this.classSubmenuItem].join(" ")})}return i},getSubmenuArgs:function(){var t=this.getSubmenuId();var e=this.moreButton;var s=BX.pos(e);var i=this.getSubmenuItems();var n={autoHide:true,offsetLeft:s.width/2-80,angle:{position:"top",offset:100},zIndex:20,events:{onPopupClose:BX.delegate(this._onSubmenuClose,this)}};return[t,e,i,n]},visibleControlMoreButton:function(){var t=this.getHiddenItems();if(!t.length||t.length===1&&this.isMoreButton(t[0])){this.getMoreButton().style.display="none"}else{this.getMoreButton().style.display=""}},createSubmenu:function(){var t=BX.PopupMenu.create.apply(BX.PopupMenu,this.getSubmenuArgs());if(this.isSettingsEnabled){this.dragAndDropInitInSubmenu()}t.menuItems.forEach(function(t){BX.bind(t.layout.item,"click",BX.delegate(this._onDocumentClick,this))},this);return t},showSubmenu:function(){var t=this.getSubmenu();if(t!==null){t.popupWindow.show()}else{this.destroySubmenu();t=this.createSubmenu();t.popupWindow.show()}this.setSubmenuShown(true);this.activateItem(this.moreButton);if(this.isEditEnabled()){t.popupWindow.setAutoHide(false)}},closeSubmenu:function(){var t=this.getSubmenu();if(t===null){return}t.popupWindow.close();if(!this.isActiveInMoreMenu()){this.deactivateItem(this.moreButton)}this.setSubmenuShown(false)},getSubmenu:function(){return BX.PopupMenu.getMenuById(this.getSubmenuId())},destroySubmenu:function(){BX.PopupMenu.destroy(this.getSubmenuId())},refreshSubmenu:function(){var t=this.getSubmenu();var e;if(t===null){return}e=this.getSubmenuArgs();if(BX.type.isArray(e)){this.destroySubmenu();this.createSubmenu();this.showSubmenu()}},setSubmenuShown:function(t){this.isSubmenuShown=false;if(BX.type.isBoolean(t)){this.isSubmenuShown=t}},activateItem:function(t){if(!BX.type.isDomNode(t)){return}if(!BX.hasClass(t,this.classItemActive)){BX.addClass(t,this.classItemActive)}},deactivateItem:function(t){if(!BX.type.isDomNode(t)){return}if(BX.hasClass(t,this.classItemActive)){BX.removeClass(t,this.classItemActive)}},getCurrentSettings:function(){var t={};this.getAllItems().forEach(function(e,s){t[e.id]={sort:s,isDisabled:this.isDisabled(e)}},this);return t},saveSettings:function(){var t=this.getCurrentSettings();var e="settings";var s;if(!BX.type.isPlainObject(t)){return}if(BX.type.isDomNode(this.listContainer)){if("id"in this.listContainer){s=this.listContainer.id;t=JSON.stringify(t);BX.userOptions.save("ui",s,e,t);this.setHome()}}},resetSettings:function(){var t=null;var e=BX.PopupWindowManager.create(this.listContainer.id+"_reset_popup",null,{content:this.message("MIB_RESET_ALERT"),autoHide:false,overlay:true,closeByEsc:true,closeIcon:true,draggable:{restrict:true},titleBar:this.message("MIB_RESET_SETTINGS"),buttons:[t=new BX.PopupWindowButton({text:this.message("MIB_RESET_BUTTON"),className:"popup-window-button-create",events:{click:function(){if(BX.hasClass(t.buttonNode,"popup-window-button-wait")){return}BX.addClass(t.buttonNode,"popup-window-button-wait");this.handleResetSettings(function(s){if(s){BX.removeClass(t.buttonNode,"popup-window-button-wait");e.setContent(s)}else{var i="settings";BX.userOptions.save("ui",this.listContainer.id,i,JSON.stringify({}));BX.userOptions.save("ui",this.listContainer.id,"firstPageLink","");window.location.reload()}}.bind(this))}.bind(this)}}),new BX.PopupWindowButtonLink({text:this.message("MIB_CANCEL_BUTTON"),className:"popup-window-button-link-cancel",events:{click:function(){this.popupWindow.close()}}})]});e.show()},handleResetSettings:function(t){var e=[];BX.onCustomEvent("BX.Main.InterfaceButtons:onBeforeResetMenu",[e,this]);var s=new BX.Promise;var i=s;for(var n=0;n<e.length;n++){s=s.then(e[n])}s.then(function(e){t(null,e)},function(e){t(e,null)});i.fulfill()},moveButtonAlias:function(t){var e,s;if(!t||!this.dragItem){return}e=this.getItemAlias(this.dragItem);s=this.getItemAlias(t);if(this.isListItem(e)){if(!s){this.listContainer.appendChild(e)}else{this.listContainer.insertBefore(e,s)}}},moveButton:function(t){var e;if(!BX.type.isDomNode(t)||!BX.type.isDomNode(this.dragItem)){return}if(this.isListItem(t)){if(this.isDisabled(this.dragItem)){this.dragItem.dataset.disabled="false"}if(BX.type.isDomNode(t)){this.listContainer.insertBefore(this.dragItem,t)}else{this.listContainer.appendChild(this.dragItem)}}if(this.isSubmenuItem(t)){if(this.isDisabled(this.dragItem)&&!this.isDisabled(t)){this.enableItem(this.dragItem)}e=this.getSubmenuContainer();e.insertBefore(this.dragItem,t)}},getSubmenuContainer:function(){var t=this.getSubmenu();var e=null;if(t!==null){e=t.itemsContainer}return e},findNextSiblingByClass:function(t,e){var s=t;for(;!!t;t=t.nextElementSibling){if(e){if(BX.hasClass(t,e)&&t!==s){return t}}else{return null}}},findParentByClassName:function(t,e){for(;t&&t!==document;t=t.parentNode){if(e){if(BX.hasClass(t,e)){return t}}else{return null}}},findChildrenByClassName:function(t,e){var s=null;if(BX.type.isDomNode(t)&&BX.type.isNotEmptyString(e)){s=BX.Buttons.Utils.getByClass(t,e)}return s},dragAndDropInit:function(){this.getAllItems().forEach(function(t,e){if(!this.isSeparator(t)&&!this.isSettings(t)&&!this.isApplySettingsButton(t)&&!this.isResetSettingsButton(t)){t.setAttribute("draggable","true");t.setAttribute("tabindex","-1");t.dataset.link="item"+e;BX.bind(t,"dragstart",BX.delegate(this._onDragStart,this));BX.bind(t,"dragend",BX.delegate(this._onDragEnd,this));BX.bind(t,"dragenter",BX.delegate(this._onDragEnter,this));BX.bind(t,"dragover",BX.delegate(this._onDragOver,this));BX.bind(t,"dragleave",BX.delegate(this._onDragLeave,this));BX.bind(t,"drop",BX.delegate(this._onDrop,this))}BX.bind(t,"mouseover",BX.delegate(this._onMouse,this));BX.bind(t,"mouseout",BX.delegate(this._onMouse,this))},this)},dragAndDropInitInSubmenu:function(){var t=this.getSubmenu();var e=t.menuItems;e.forEach(function(t){if(!this.isSeparator(t.layout.item)&&!this.isSettings(t.layout.item)&&!this.isApplySettingsButton(t.layout.item)&&!this.isResetSettingsButton(t.layout.item)){t.layout.item.draggable=true;t.layout.item.dataset.sortable=true;BX.bind(t.layout.item,"dragstart",BX.delegate(this._onDragStart,this));BX.bind(t.layout.item,"dragenter",BX.delegate(this._onDragEnter,this));BX.bind(t.layout.item,"dragover",BX.delegate(this._onDragOver,this));BX.bind(t.layout.item,"dragleave",BX.delegate(this._onDragLeave,this));BX.bind(t.layout.item,"dragend",BX.delegate(this._onDragEnd,this));BX.bind(t.layout.item,"drop",BX.delegate(this._onDrop,this))}if(BX.hasClass(t.layout.item,this.classHiddenLabel)&&!BX.hasClass(t.layout.item,this.classManage)){BX.bind(t.layout.item,"dragover",BX.delegate(this._onDragOver,this))}},this)},getItem:function(t){if(!BX.type.isDomNode(t)){if(!t||!BX.type.isDomNode(t.target)){return null}}else{t={target:t}}var e=this.findParentByClassName(t.target,this.classItem);if(!BX.type.isDomNode(e)){e=this.findParentByClassName(t.target,this.classDefaultSubmenuItem)}return e},setOpacity:function(t){if(!BX.type.isDomNode(t)){return}BX.style(t,"opacity",".1")},unsetOpacity:function(t){if(!BX.type.isDomNode(t)){return}BX.style(t,"opacity","1")},setDragStyles:function(){BX.addClass(this.listContainer,this.classOnDrag);BX.addClass(BX(this.getSubmenuId(true)),this.classOnDrag);this.setOpacity(this.dragItem)},unsetDragStyles:function(){var t=this.getSubmenu();this.getAllItems().forEach(function(t){this.unsetOpacity(t);BX.removeClass(t,"over")},this);if(t&&"menuItems"in t&&BX.type.isArray(t.menuItems)&&t.menuItems.length){t.menuItems.forEach(function(t){this.unsetOpacity(t);BX.removeClass(t.layout.item,"over")},this)}BX.removeClass(this.listContainer,this.classOnDrag);BX.removeClass(BX(this.getSubmenuId(true)),this.classOnDrag)},getIconClass:function(t){var e="";if(BX.type.isDomNode(t)&&"dataset"in t&&"class"in t.dataset&&BX.type.isNotEmptyString(t.dataset.class)){e=t.dataset.class}return e},disableItem:function(t){var e=this.getItemAlias(t);if(t&&"dataset"in t){t.dataset.disabled="true";if(e){e.dataset.disabled="true"}}},enableItem:function(t){var e;if(!BX.type.isDomNode(t)){return}if(this.isSubmenuItem(t)){BX.removeClass(t,this.classItemDisabled);e=this.getItemAlias(t);if(BX.type.isDomNode(e)){e.dataset.disabled="false"}}},getAliasLink:function(t){return this.dataValue(t,"link")||""},getItemAlias:function(t){var e=null;if(!BX.type.isDomNode(t)){return e}var s=this.getAllItems();var i=this.isSubmenuItem(t);var n=this.isListItem(t);if(!i&&!n){return e}if(i){s.forEach(function(s){BX.hasClass(t,this.getAliasLink(s))&&(e=s)},this)}if(n){e=BX.Buttons.Utils.getByClass(document,this.getAliasLink(t))}return e},hideItem:function(t){!!t&&BX.addClass(t,this.classSecret)},showItem:function(t){!!t&&BX.removeClass(t,this.classSecret)},fakeDragItem:function(){var t=null;if(!BX.type.isDomNode(this.dragItem)||!BX.type.isDomNode(this.overItem)){return}if(this.isDragToSubmenu()){t=this.getItemAlias(this.dragItem);if(t!==this.dragItem){this.listContainer.appendChild(this.dragItem);this.dragItem=t;this.showItem(this.dragItem);this.adjustMoreButtonPosition();this.updateSubmenuItems();this.tmp.moved=false;this.tmp.movetToSubmenu=true;this.setOpacity(this.dragItem)}}if(this.isDragToList()&&!this.tmp.movetToSubmenu){t=this.getItemAlias(this.dragItem);if(t!==this.dragItem){this.hideItem(this.dragItem);this.dragItem=t;this.adjustMoreButtonPosition();this.updateSubmenuItems();this.setOpacity(this.dragItem)}}this.tmp.movetToSubmenu=false},updateSubmenuItems:function(){var t=this.getHiddenItems();var e=this.getDisabledItems();var s=this;var i=[];var n,a,o;n=this.getSubmenu();if(n===null){return}a=n.menuItems;if(!BX.type.isArray(a)||!a.length){return}i=e.concat(t);a.forEach(function(t){o=[].some.call(i,function(e){return BX.hasClass(t.layout.item,s.dataValue(e,"link"))||s.isDisabled(t.layout.item)||s.isSeparator(t.layout.item)||s.isDropzone(t.layout.item)});if(o||(s.isSettings(t.layout.item)||s.isApplySettingsButton(t.layout.item)||s.isResetSettingsButton(t.layout.item)||s.isNotHiddenItem(t.layout.item)||s.isSeparator(t.layout.item)||t.layout.item===s.dragItem)&&!s.isMoreButton(t.layout.item)){s.showItem(t.layout.item)}else{s.hideItem(t.layout.item)}})},isNotHiddenItem:function(t){return BX.hasClass(t,this.classSubmenuNoHiddenItem)},getNotHidden:function(){return BX.Buttons.Utils.getByClass(this.getSubmenuContainer(),this.classSubmenuNoHiddenItem)},setOverStyles:function(t){if(BX.type.isDomNode(t)&&!BX.hasClass(t,this.classItemOver)){BX.addClass(t,this.classItemOver)}},unsetOverStyles:function(t){if(BX.type.isDomNode(t)&&BX.hasClass(t,this.classItemOver)){BX.removeClass(t,this.classItemOver)}},dataValue:function(t,e){var s="";var i;if(BX.type.isDomNode(t)){i=BX.data(t,e);if(typeof i!=="undefined"){s=i}}return s},execScript:function(script){if(BX.type.isNotEmptyString(script)){eval(script)}},showLicenseWindow:function(){var t;if(!B24.licenseInfoPopup){return}t=B24.licenseInfoPopup;t.init({B24_LICENSE_BUTTON_TEXT:this.message("MIB_LICENSE_BUY_BUTTON"),B24_TRIAL_BUTTON_TEXT:this.message("MIB_LICENSE_TRIAL_BUTTON"),IS_FULL_DEMO_EXISTS:this.licenseParams.isFullDemoExists,HOST_NAME:this.licenseParams.hostname,AJAX_URL:this.licenseParams.ajaxUrl,LICENSE_ALL_PATH:this.licenseParams.licenseAllPath,LICENSE_DEMO_PATH:this.licenseParams.licenseDemoPath,FEATURE_GROUP_NAME:this.licenseParams.featureGroupName,AJAX_ACTIONS_URL:this.licenseParams.ajaxActionsUrl,B24_FEATURE_TRIAL_SUCCESS_TEXT:this.message("MIB_LICENSE_WINDOW_TRIAL_SUCCESS_TEXT")});t.show("main-buttons",this.message("MIB_LICENSE_WINDOW_HEADER_TEXT"),this.message("MIB_LICENSE_WINDOW_TEXT"))},_onDragStart:function(t){var e=this.getVisibleItems();var s=BX.type.isArray(e)?e.length:null;this.dragItem=this.getItem(t);if(!BX.type.isDomNode(this.dragItem)){return}if(s===2&&this.isListItem(this.dragItem)){t.preventDefault();BX.onCustomEvent(window,"BX.Main.InterfaceButtons:onHideLastVisibleItem",[this.dragItem,this]);return}if(this.isMoreButton(this.dragItem)||this.isSeparator(this.dragItem)||this.isNotHiddenItem(this.dragItem)){t.preventDefault();return}this.isSubmenuShownOnDragStart=!!this.isSubmenuShown;if(this.isListItem(this.dragItem)){this.showSubmenu()}this.setDragStyles();if(!this.isEditEnabled()){this.enableEdit()}},_onDragEnd:function(t){t.preventDefault();var e=this.getItem(t);var s,i;if(!BX.type.isDomNode(e)){return}this.unsetDragStyles();if(!this.isSubmenuShownOnDragStart){this.refreshSubmenu();if(!this.isEditEnabled()){this.closeSubmenu()}}else{this.refreshSubmenu()}s=BX.findNextSibling(this.dragItem,BX.delegate(function(t){return this.isVisibleItem(t)},this));i=BX.findPreviousSibling(this.dragItem,BX.delegate(function(t){return this.isVisibleItem(t)},this));if(BX.type.isDomNode(i)&&(BX.hasClass(i,this.classHiddenLabel)||this.isDisabled(i)&&this.isSubmenuItem(i))||(BX.type.isDomNode(s)&&BX.hasClass(s,this.classManage)||this.isDisabled(s)&&this.isSubmenuItem(s))){this.disableItem(this.dragItem);this.refreshSubmenu()}if(this.isEditEnabled()){this.enableEdit();BX.show(this.getSettingsApplyButton());BX.hide(this.getSettingsButton())}else{this.disableEdit();

BX.hide(this.getSettingsApplyButton());BX.show(this.getSettingsButton())}this.updateMoreButtonCounter();this.saveSettings();this.dragItem=null;this.overItem=null;this.tmp.moved=false},updateMoreButtonCounter:function(){var t,e,s,i;t=this.getHiddenItems();i=this.getDisabledItems();t=t.concat(i);e=0;if(BX.type.isArray(t)){t.forEach(function(t){e+=parseInt(this.dataValue(t,"counter"))||0},this)}if(BX.type.isNumber(e)){this.setMoreButtonCounter(e)}},_onDragEnter:function(t){var e=this.getItem(t);if(BX.type.isDomNode(e)&&this.isNotHiddenItem(e)){this.setOverStyles(e)}},_onDragOver:function(t){t.preventDefault();var e=null;this.overItem=this.getItem(t);if(!BX.type.isDomNode(this.overItem)||!BX.type.isDomNode(this.dragItem)||this.overItem===this.dragItem||this.isNotHiddenItem(this.overItem)){return}this.fakeDragItem();if(this.isNext(t)&&this.isGoodPosition(t)&&!this.isMoreButton(this.overItem)){e=this.findNextSiblingByClass(this.overItem,this.classItem);if(this.isMoreButton(e)&&!this.tmp.moved){e=e.previousElementSibling;this.tmp.moved=true}if(!BX.type.isDomNode(e)){e=this.findNextSiblingByClass(this.overItem,this.classSubmenuItem)}if(BX.type.isDomNode(e)){this.moveButton(e);this.moveButtonAlias(e);this.adjustMoreButtonPosition();this.updateSubmenuItems()}}if(!this.isNext(t)&&this.isGoodPosition(t)&&!this.isMoreButton(this.overItem)||!this.isGoodPosition(t)&&this.isMoreButton(this.overItem)&&this.getVisibleItems().length===1){this.moveButton(this.overItem);this.moveButtonAlias(this.overItem);this.adjustMoreButtonPosition();this.updateSubmenuItems()}},_onDragLeave:function(t){var e=this.getItem(t);if(BX.type.isDomNode(e)){this.unsetOverStyles(t.target)}},_onDrop:function(t){var e=this.getItem(t);if(!BX.type.isDomNode(e)){return}if(this.isNotHiddenItem(e)||this.isDisabled(e)){this.disableItem(this.dragItem);this.adjustMoreButtonPosition()}this.unsetDragStyles();t.preventDefault()},getIndex:function(t,e){return[].indexOf.call(t||[],e)},_onSubmenuClose:function(){this.setSubmenuShown(false);if(this.isEditEnabled()){this.activateItem(this.moreButton)}else{if(!this.isActiveInMoreMenu()){this.deactivateItem(this.moreButton)}}},_onResizeHandler:function(){this.adjustMoreButtonPosition();this.updateSubmenuItems();if(!this.isSettingsEnabled){this.visibleControlMoreButton()}},_onClickMoreButton:function(t){t.preventDefault();this.showSubmenu()},_onMouse:function(t){var e=this.getItem(t);if(t.type==="mouseover"&&!BX.hasClass(e,this.classItemOver)){BX.addClass(e,this.classItemOver)}if(t.type==="mouseout"&&BX.hasClass(e,this.classItemOver)){BX.removeClass(e,this.classItemOver)}},getSettingsResetButton:function(){return BX.Buttons.Utils.getByClass(this.getSubmenuContainer(),this.classSettingsResetButton)},_onScroll:function(){if(BX.style(this.pinContainer,"position")==="fixed"){this.closeSubmenu()}},isDisabled:function(t){var e=false;if(BX.type.isDomNode(t)){e=this.dataValue(t,"disabled")==="true"||BX.hasClass(t,this.classItemDisabled)}return e},isSettings:function(t){var e=false;if(BX.type.isDomNode(t)){e=BX.hasClass(t,this.classSettingMenuItem)}return e},isLocked:function(t){var e=false;if(BX.type.isDomNode(t)){e=this.dataValue(t,"locked")==="true"||BX.hasClass(t,this.classItemLocked)}return e},isDropzone:function(t){return BX.hasClass(t,this.classDropzone)},isNext:function(t){var e=this.dragItem.getBoundingClientRect();var s=this.overItem.getBoundingClientRect();var i=getComputedStyle(this.dragItem);var n=parseInt(i.marginRight.replace("px",""));var a=null;if(this.isListItem(this.overItem)){a=t.clientX>s.left-n&&t.clientX>e.right}if(this.isSubmenuItem(this.overItem)){a=t.clientY>e.top}return a},isGoodPosition:function(t){var e=this.overItem;var s,i;if(!BX.type.isDomNode(e)){return false}s=e.getBoundingClientRect();if(this.isListItem(e)){i=this.isNext(t)&&t.clientX>=s.left+s.width/2||!this.isNext(t)&&t.clientX<=s.left+s.width/2}if(this.isSubmenuItem(e)){i=this.isNext(t)&&t.clientY>=s.top+s.height/2||!this.isNext(t)&&t.clientY<=s.top+s.height/2}return i},isSubmenuItem:function(t){return BX.hasClass(t,this.classSubmenuItem)},isVisibleItem:function(t){if(!BX.type.isDomNode(t)){return false}return t.offsetTop===0},isMoreButton:function(t){var e=false;if(BX.type.isDomNode(t)&&BX.hasClass(t,this.classItemMore)){e=true}return e},isListItem:function(t){var e=false;if(BX.type.isDomNode(t)&&BX.hasClass(t,this.classItem)){e=true}return e},isSublink:function(t){var e=false;if(BX.type.isDomNode(t)){e=BX.hasClass(t,this.classItemSublink)}return e},isSeparator:function(t){var e=false;if(BX.type.isDomNode(t)){e=BX.hasClass(t,this.classSeporator)}return e},isDragToSubmenu:function(){return!this.isSubmenuItem(this.dragItem)&&this.isSubmenuItem(this.overItem)},isDragToList:function(){return this.isSubmenuItem(this.dragItem)&&!this.isSubmenuItem(this.overItem)}}}if(typeof BX.Main.interfaceButtonsManager==="undefined"){BX.Main.interfaceButtonsManager={data:{},init:function(t){var e=null;if(!BX.type.isPlainObject(t)||!("containerId"in t)){throw"BX.Main.interfaceButtonsManager: containerId not set in params Object"}e=BX(t.containerId);if(BX.type.isDomNode(e)){this.data[t.containerId]=new BX.Main.interfaceButtons(e,t)}else{BX(BX.delegate(function(){e=BX(t.containerId);if(!BX.type.isDomNode(e)){throw"BX.Main.interfaceButtonsManager: container is not dom node"}this.data[t.containerId]=new BX.Main.interfaceButtons(e,t)},this))}},getById:function(t){var e=null;if(BX.type.isString(t)&&BX.type.isNotEmptyString(t)){try{e=this.data[t]}catch(s){}}return e},getObjects:function(){return this.data}}}
/* End */
;
; /* Start:"a:4:{s:4:"full";s:94:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.min.js?1511316472575";s:6:"source";s:76:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.js";s:3:"min";s:80:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.min.js";s:3:"map";s:80:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Buttons");BX.Buttons.Utils={getByClass:function(e,t,l){var n=[];if(t){n=(e||document.body).getElementsByClassName(t);if(!l){n=n.length?n[0]:null}else{n=[].slice.call(n)}}return n},getByTag:function(e,t,l){var n=[];if(t){n=(e||document.body).getElementsByTagName(t);if(!l){n=n.length?n[0]:null}else{n=[].slice.call(n)}}return n},getBySelector:function(e,t,l){var n=[];if(t){if(!l){n=(e||document.body).querySelector(t)}else{n=(e||document.body).querySelectorAll(t);n=[].slice.call(n)}}return n}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:85:"/bitrix/components/bitrix/crm.contact.menu/templates/.default/script.js?1511316478484";s:6:"source";s:71:"/bitrix/components/bitrix/crm.contact.menu/templates/.default/script.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/

function contact_delete(title, message, btnTitle, path)
{
	var d;
	d = new BX.CDialog({
		title: title,
		head: '',
		content: message,
		resizable: false,
		draggable: true,
		height: 70,
		width: 300
	});
	
	var _BTN = [	
		{
			title: btnTitle,
			id: 'crmOk',
			'action': function () 
			{
				window.location.href = path;
				BX.WindowManager.Get().Close();
			}
		},
		BX.CDialog.btnCancel
	];	
	d.ClearButtons();
	d.SetButtons(_BTN);
	d.Show();
}
/* End */
;
; /* Start:"a:4:{s:4:"full";s:88:"/bitrix/components/bitrix/crm.interface.toolbar/templates/type2/script.js?15113164783136";s:6:"source";s:73:"/bitrix/components/bitrix/crm.interface.toolbar/templates/type2/script.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
if(typeof(BX.InterfaceToolBar) === "undefined")
{
	BX.InterfaceToolBar = function()
	{
		this._id = "";
		this._settings = null;
		this._container = null;
		this._moreBtn = null;
		this._prefix = "";
	};

	BX.InterfaceToolBar.prototype =
	{
		initialize: function(id, settings)
		{
			this._id = id;
			this._settings = settings ? settings : BX.CrmParamBag.create(null);
			var container = this._container = BX(this.getSetting("containerId", ""));
			if(container)
			{
				var btnClassName = this.getSetting("moreButtonClassName", "");
				if(BX.type.isNotEmptyString(btnClassName))
				{
					var moreBtn = this._moreBtn = BX.findChild(container, { "className": btnClassName }, true, false);
					if(moreBtn)
					{
						BX.bind(moreBtn, 'click', BX.delegate(this._onMoreButtonClick, this));
					}
				}
			}

			this._prefix = this.getSetting("prefix", "");
		},
		getId: function()
		{
			return this._id;
		},
		getSetting: function(name, defaultval)
		{
			return this._settings.getParam(name, defaultval);
		},
		setButtonVisible: function(code, visible)
		{
			var button = this._getButtonByCode(code);
			if(BX.type.isDomNode(button))
			{
				button.style.display = visible ? "" : "none";
			}
		},
		_getButtonByCode: function(code)
		{
			return BX(this._prefix !== "" ? (this._prefix + code) : code);
		},
		_onMoreButtonClick: function(e)
		{
			var items = this.getSetting('items', null);
			if(!BX.type.isArray(items))
			{
				return;
			}

			var hdlrRx1 = /return\s+false(\s*;)?\s*$/;
			var hdlrRx2 = /;\s*$/;

			this._menuId = this._id.toLowerCase();
			var menuItems = [];
			for(var i = 0; i < items.length; i++)
			{
				var item = items[i];

				var isSeparator = typeof(item["SEPARATOR"]) !== "undefined" ? item["SEPARATOR"] : false;
				if(isSeparator)
				{
					menuItems.push({"delimiter": true });
					continue;
				}

				var hdlr = typeof(item["ONCLICK"]) !== "undefined" ? item["ONCLICK"] : "";
				if(BX.type.isNotEmptyString(hdlr))
				{
					if(!hdlrRx1.test(hdlr))
					{
						if(!hdlrRx2.test(hdlr))
						{
							hdlr += ";";
						}
						hdlr += " return false;";
					}
				}
				menuItems.push(
					{
						"text":  typeof(item["TEXT"]) !== "undefined" ? item["TEXT"] : "",
						"title":  typeof(item["TITLE"]) !== "undefined" ? item["TITLE"] : "",
						"href" : typeof(item["LINK"]) !== "undefined" ? item["LINK"] : "#",
						"onclick": hdlr
					}
				);
			}

			if(typeof(BX.PopupMenu.Data[this._menuId]) !== "undefined")
			{
				BX.PopupMenu.Data[this._menuId].popupWindow.destroy();
				delete BX.PopupMenu.Data[this._menuId];
			}

			var btnPos = BX.pos(this._moreBtn);
			this._menu = BX.PopupMenu.show(
				this._menuId,
				this._moreBtn,
				menuItems,
				{
					"offsetTop": Math.round(btnPos.height / 8),
					"offsetLeft": Math.round(btnPos.width / 2),
					"angle": { "position": "top", "offset": 0 }
				}
			);

			return BX.PreventDefault(e);
		}
	};

	BX.InterfaceToolBar.items = {};
	BX.InterfaceToolBar.create = function(id, settings)
	{
		var self = new BX.InterfaceToolBar();
		self.initialize(id, settings);
		this.items[id] = self;

		return self;
	};
}

/* End */
;
; /* Start:"a:4:{s:4:"full";s:85:"/bitrix/components/bitrix/crm.field_multi.edit/templates/new/script.js?15113164784279";s:6:"source";s:70:"/bitrix/components/bitrix/crm.field_multi.edit/templates/new/script.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
if(typeof(BX.CrmFieldMultiEditor) === "undefined")
{
	BX.CrmFieldMultiEditor = function()
	{
		this._id = "";
		this._mnemonic = "";
		this._typeName = "";
		this._referenceData = {};
		this._container = null;
	};

	BX.CrmFieldMultiEditor.prototype =
	{
		initialize: function(id, mnemonic, typeName, referenceData, container)
		{
			this._id = id;
			this._mnemonic = mnemonic;
			this._typeName = typeName;
			this._referenceData = referenceData ? referenceData : {};

			if(!container)
			{
				throw "CrmFieldMultiEditor: Container is not defined!";
			}
			this._container = container;
		},
		getId: function()
		{
			return this._id;
		},
		getItemCount: function()
		{
			var itemContainers = BX.findChildren(this._container, { tagName:"DIV", className:"bx-crm-edit-fm-item" }, false);
			return itemContainers ? itemContainers.length : 0;
		},
		createItem: function()
		{
			var itemCount = this.getItemCount();

			var select = BX.create(
				"SELECT",
				{
					props:
					{
						name: this._mnemonic + "[" + this._typeName + "]" + "[n" + (itemCount + 1) + "][VALUE_TYPE]",
						size: 1
					},
					attrs: { className:"bx-crm-edit-input bx-crm-edit-input-small" }
				}
			);

			var data = this._referenceData;
			var refValData =  typeof(data["REFERENCE_ID"]) != "undefined" ? data["REFERENCE_ID"] : [];
			var refTextData =  typeof(data["REFERENCE"]) != "undefined" ? data["REFERENCE"] : [];
			for(var i = 0; i < refValData.length; i++)
			{
				var option;
				if(!BX.browser.IsIE())
				{
					option = BX.create(
							"OPTION",
							{
								props: { value:refValData[i] },
								text : refTextData[i]
							}
					);

					select.add(option, null);
				}
				else
				{
					option = BX.create("OPTION");

					try
					{
						// for IE earlier than version 8
						select.add(option, select.options[null]);
					}
					catch (e)
					{
						select.add(option);
					}

					option.innerHTML = BX.util.htmlspecialchars(refTextData[i]);
					option.value = refValData[i];
				}
			}

			this._container.insertBefore(
				BX.create(
					"DIV",
					{
						attrs: { className: "bx-crm-edit-fm-item" },
						children:
							[
								BX.create(
									"INPUT",
									{
										props:
										{
											type: "text",
											name: this._mnemonic + "[" + this._typeName + "]" + "[n" + (itemCount + 1) + "][VALUE]"
										},
										attrs: { className:"bx-crm-edit-input" }
									}
								),
								select,
								BX.create(
									"DIV",
									{
										attrs: { className:"delete-action" },
										events:
										{
											click: BX.delegate(this.onItemDelete, this)
										}
									}
								)
							]
					}
				),
				BX.findChild(this._container, { className: "bx-crm-edit-fm-add" }, true, false)
			);

			BX.onCustomEvent(
				window,
				'CrmFieldMultiEditorItemCreated',
				[this, this._id]
			);
		},
		_deleteItem: function(wrapper)
		{
			if(wrapper)
			{
				var input = BX.findChild(wrapper, { tagName:"INPUT", className: "bx-crm-edit-input" }, true, false);
				if(input)
				{
					input.value = "";
				}

				BX.addClass(wrapper, "bx-crm-edit-fm-item-deleted");
				BX.removeClass(wrapper, "bx-crm-edit-fm-item");
			}

			BX.onCustomEvent(
				window,
				'CrmFieldMultiEditorItemDeleted',
				[this, this._id]
			);

			if(this.getItemCount() === 0)
			{
				this.createItem();
			}
		},
		deleteItem: function(id)
		{
			this._deleteItem(
				BX.findParent(
					BX.findChild(this._container, { tagName:"INPUT", attribute:{ name:this._prepareValueInputName(id) }  }, true, false),
					{ tagName:"DIV", className:"bx-crm-edit-fm-item" }
				)
			);
		},
		onItemDelete: function(e)
		{
			if(!e)
			{
				e = window.event;
			}

			this._deleteItem(
				BX.findParent(
					e.target,
					{ tagName:"DIV", className:"bx-crm-edit-fm-item" }
				)
			);
		},
		_prepareValueInputName: function(id)
		{
			return this._mnemonic + "[" + this._typeName + "]" + "[" + id + "][VALUE]";
		}
	};

	BX.CrmFieldMultiEditor.items = {};
	BX.CrmFieldMultiEditor.create = function(id, mnemonic, typeName, referenceData, container)
	{
		var self = new BX.CrmFieldMultiEditor();
		self.initialize(id, mnemonic, typeName, referenceData, container);
		this.items[id] = self;
		return self;
	};
}

/* End */
;
; /* Start:"a:4:{s:4:"full";s:100:"/bitrix/components/bitrix/crm.requisite.form.editor/templates/.default/script.min.js?151131647823419";s:6:"source";s:80:"/bitrix/components/bitrix/crm.requisite.form.editor/templates/.default/script.js";s:3:"min";s:84:"/bitrix/components/bitrix/crm.requisite.form.editor/templates/.default/script.min.js";s:3:"map";s:84:"/bitrix/components/bitrix/crm.requisite.form.editor/templates/.default/script.map.js";}"*/
BX.namespace("BX.Crm");if(typeof BX.Crm.RequisiteFormEditor==="undefined"){BX.Crm.RequisiteFormEditor=function(e){this.containerId=e.containerId;this.container=BX(this.containerId);this.requisiteEntityTypeId=e.requisiteEntityTypeId;this.requisiteEntityId=e.requisiteEntityId;this.presetList=e.presetList;this.presetLastSelectedId=e.presetLastSelectedId;this.requisiteDataList=e.requisiteDataList;this.visible=!!e.visible;this.messages=e.messages||{};this.presetSelector=null;this.requisitePopupManager=null;this.requisitePopupAjaxUrl=e.requisitePopupAjaxUrl;this.requisiteFormEditorAjaxUrl=e.requisiteFormEditorAjaxUrl;this.blockArea=null};BX.Crm.RequisiteFormEditor.prototype={initialize:function(){if(this.container){if(this.visible)this.container.style.display="block";this.requisiteEditHandler=BX.delegate(this.onRequisiteEdit,this);if(!this.blockArea){this.blockArea=new BX.Crm.RequisiteFormEditorBlockArea({container:this.container,nextNode:null,editor:this,requisiteDataList:this.requisiteDataList,ajaxUrl:this.requisiteFormEditorAjaxUrl,requisiteEditHandler:this.requisiteEditHandler})}if(!this.presetSelector){this.presetSelector=new BX.Crm.RequisitePresetSelectorClass({editor:this,container:this.container,nextNode:this.blockArea?this.blockArea.getWrapperNode():null,containerId:this.containerId,requisiteEntityTypeId:this.requisiteEntityTypeId,requisiteEntityId:this.requisiteEntityId,presetList:this.presetList,presetLastSelectedId:this.presetLastSelectedId,requisiteEditHandler:this.requisiteEditHandler})}}},getMessage:function(e){return this.messages[e]},onRequisiteEdit:function(e,t,i,s,r,n,a,o){if(BX.type.isNumber(a)&&a>=0||BX.type.isNotEmptyString(a))a=parseInt(a);else a=-1;r=BX.type.isNotEmptyString(r)?r:"";n=BX.type.isNotEmptyString(n)?n:"";o=!!o;if(!this.requisitePopupManager){this.requisitePopupManager=new BX.Crm.RequisitePopupFormManagerClass({editor:this,blockArea:this.blockArea,requisiteEntityTypeId:e,requisiteEntityId:t,requisiteId:s,requisiteData:r,requisiteDataSign:n,presetId:i,requisitePopupAjaxUrl:this.requisitePopupAjaxUrl,popupDestroyCallback:BX.delegate(this.onRequisitePopupDestroy,this),blockIndex:a,copyMode:o});this.requisitePopupManager.openPopup()}},onRequisitePopupDestroy:function(){if(this.requisitePopupManager){this.requisitePopupManager.destroy();this.requisitePopupManager=null}}};BX.Crm.RequisiteFormEditor.items={};BX.Crm.RequisiteFormEditor.create=function(e,t){var i=new BX.Crm.RequisiteFormEditor(t);i.initialize();this.items[e]=i;return i}}if(typeof BX.Crm.RequisiteFormEditorBlockArea==="undefined"){BX.Crm.RequisiteFormEditorBlockArea=function(e){this.editor=e.editor;this.requisiteDataList=e.requisiteDataList;this.ajaxUrl=e.ajaxUrl;this.container=e.container;this.nextNode=e.nextNode;this.requisiteEditHandler=e.requisiteEditHandler;this.wrapper=null;this.blockList=[];if(this.container){this.wrapper=BX.create("DIV",{attrs:{"class":"crm-offer-requisite-blocks"}});if(this.wrapper){if(this.nextNode)this.container.insertBefore(this.wrapper,this.nextNode);else this.container.appendChild(this.wrapper)}}if(this.requisiteDataList&&this.requisiteDataList instanceof Array){var t;for(var i=0;i<this.requisiteDataList.length;i++){if(this.requisiteDataList[i]["requisiteId"]&&this.requisiteDataList[i]["requisiteData"]&&this.requisiteDataList[i]["requisiteDataSign"]){this.addBlock(this.requisiteDataList[i]["requisiteId"],this.requisiteDataList[i]["requisiteData"],this.requisiteDataList[i]["requisiteDataSign"])}}}};BX.Crm.RequisiteFormEditorBlockArea.prototype={getWrapperNode:function(){return this.wrapper},addBlock:function(e,t,i){var s=this.blockList.length;var r=new BX.Crm.RequisiteFormEditorBlock({editor:this.editor,blockArea:this,blockIndex:s,ajaxUrl:this.ajaxUrl,container:this.wrapper,nextNode:null,requisiteEditHandler:this.requisiteEditHandler,requisiteId:e,requisiteData:t,requisiteDataSign:i});if(r)this.blockList[s]=r},updateBlock:function(e,t,i,s){e=BX.type.isNumber(e)&&e>=0||BX.type.isNotEmptyString(e)?parseInt(e):-1;if(e>=0){var r=this.blockList[e];if(r){r.update({requisiteId:t,requisiteData:i,requisiteDataSign:s})}}},onBlockDestroy:function(e){if(e>=0&&this.blockList&&this.blockList.length>e){this.blockList.splice(e,1);this.reindexBlocks(e)}},reindexBlocks:function(e){for(var t=e;t<this.blockList.length;t++)this.blockList[t].setIndex(t)}}}if(typeof BX.Crm.RequisiteFormEditorBlock==="undefined"){BX.Crm.RequisiteFormEditorBlock=function(e){this.editor=e.editor;this.blockArea=e.blockArea;this.blockIndex=e.blockIndex;this.ajaxUrl=e.ajaxUrl;this.container=e.container;this.nextNode=e.nextNode;this.requisiteId=parseInt(e.requisiteId);this.requisiteDataJson=e.requisiteData;this.requisiteDataSign=e.requisiteDataSign;this.requisiteEditHandler=e.requisiteEditHandler;this.requisiteData=null;this.entityTypeId=0;this.entityId=0;this.presetId=0;this.viewData=null;this.isRequestRunning=false;this.wrapper=null;this.closeButtonNode=null;this.closeButtonClickHandler=null;this.requisiteDataInputNode=null;this.requisiteDataSignInputNode=null;this.initialize()};BX.Crm.RequisiteFormEditorBlock.prototype={update:function(e){this.requisiteId=parseInt(e.requisiteId);this.requisiteDataJson=e.requisiteData;this.requisiteDataSign=e.requisiteDataSign;this.requisiteData=null;this.entityTypeId=0;this.entityId=0;this.presetId=0;this.viewData=null;this.isRequestRunning=false;this.initialize()},initialize:function(){this.requisiteData=BX.parseJSON(this.requisiteDataJson,this);if(this.requisiteData&&this.requisiteData["fields"]){this.entityTypeId=parseInt(this.requisiteData["fields"]["ENTITY_TYPE_ID"]);this.entityId=parseInt(this.requisiteData["fields"]["ENTITY_ID"]);this.presetId=parseInt(this.requisiteData["fields"]["PRESET_ID"])}if(this.requisiteData&&this.requisiteData["viewData"]){this.viewData=this.requisiteData["viewData"]}if(this.container){this.clean();if(!this.wrapper){this.wrapper=BX.create("DIV",{attrs:{"class":"crm-offer-requisite","data-tab-block":"tabBlock"}});if(this.wrapper){if(this.nextNode)this.container.insertBefore(this.wrapper,this.nextNode);else this.container.appendChild(this.wrapper)}}}if(this.wrapper){if(this.viewData&&this.viewData["title"]){var e=BX.create("DIV",{attrs:{"class":"crm-offer-requisite-title",style:"cursor: pointer;"},html:BX.util.htmlspecialchars(this.viewData["title"])});this.wrapper.appendChild(e);var t=BX.create("SPAN",{attrs:{"class":"crm-offer-tab-close-btn","data-tab-block":"closeBtn"}});this.wrapper.appendChild(t);if(this.viewData["fields"]){var i,s,r,n;var a=this.viewData["fields"];if(a instanceof Array&&a.length>0){i=BX.create("TABLE",{attrs:{"class":"crm-offer-tab-table"}});for(n=0;n<a.length;n++){s=i.insertRow(-1);r=s.insertCell(-1);r.className="crm-offer-tab-cell";r.innerHTML=(a[n]["title"]?BX.util.htmlspecialchars(a[n]["title"]):"")+":";r=s.insertCell(-1);r.className="crm-offer-tab-cell";r.innerHTML=a[n]["textValue"]?BX.util.nl2br(BX.util.htmlspecialchars(a[n]["textValue"])):""}this.wrapper.appendChild(i)}}if(t){this.closeButtonNode=t;this.closeButtonClickHandler=BX.delegate(this.onCloseButtonClick,this);BX.bind(this.closeButtonNode,"click",this.closeButtonClickHandler)}if(e){this.titleNode=e;this.titleClickHandler=BX.delegate(this.onBlockTitleClick,this);BX.bind(this.titleNode,"click",this.titleClickHandler)}}if(this.requisiteId===0&&this.requisiteDataJson&&this.requisiteDataSign){this.requisiteDataInputNode=BX.create("INPUT",{attrs:{type:"hidden",name:"REQUISITE_DATA["+this.blockIndex+"]",value:this.requisiteDataJson}});this.wrapper.appendChild(this.requisiteDataInputNode);this.requisiteDataSignInputNode=BX.create("INPUT",{attrs:{type:"hidden",name:"REQUISITE_DATA_SIGN["+this.blockIndex+"]",value:this.requisiteDataSign}});this.wrapper.appendChild(this.requisiteDataSignInputNode)}}},getWrapperNode:function(){return this.wrapper},onCloseButtonClick:function(){if(this.requisiteId>0)this.startRequisiteDeleteRequest(this.requisiteId);else this.destroy()},onBlockTitleClick:function(){if(this.requisiteEditHandler)this.requisiteEditHandler(this.entityTypeId,this.entityId,this.presetId,this.requisiteId,this.requisiteDataJson,this.requisiteDataSign,this.blockIndex)},startRequisiteDeleteRequest:function(e){e=parseInt(e);if(this.isRequestRunning)return;this.isRequestRunning=true;BX.ajax({url:this.ajaxUrl,method:"POST",dataType:"json",data:{action:"deleteRequisite",requisite_id:e},onsuccess:BX.delegate(this.onRequisiteDeleteRequestSuccess,this),onfailure:BX.delegate(this.onRequestFailure,this)})},setIndex:function(e){this.blockIndex=e;if(this.requisiteDataInputNode)this.requisiteDataInputNode.setAttribute("name","REQUISITE_DATA["+this.blockIndex+"]");if(this.requisiteDataSignInputNode)this.requisiteDataSignInputNode.setAttribute("name","REQUISITE_DATA_SIGN["+this.blockIndex+"]")},onRequisiteDeleteRequestSuccess:function(e){var t=false;var i=4;if(e&&e["status"]){if(e["status"]==="success"&&e["response"]&&e["response"]["id"]&&parseInt(e["response"]["id"])==this.requisiteId){t=true}else if(e["status"]==="error"&&e["errors"]&&e["errors"][0]&&e["errors"][0]["code"]&&parseInt(e["errors"][0]["code"])===i){t=true}}this.isRequestRunning=false;if(t)this.destroy()},onRequestFailure:function(e){this.isRequestRunning=false},clean:function(e){e=!!e;if(this.wrapper){if(this.requisiteDataInputNode){BX.cleanNode(this.requisiteDataInputNode,true);this.requisiteDataInputNode=null}if(this.requisiteDataSignInputNode){BX.cleanNode(this.requisiteDataSignInputNode,true);this.requisiteDataSignInputNode=null}if(this.titleNode){BX.unbind(this.titleNode,"click",this.titleClickHandler);this.titleClickHandler=null;this.titleNode=null}if(this.closeButtonNode){BX.unbind(this.closeButtonNode,"click",this.closeButtonClickHandler);this.closeButtonClickHandler=null;this.closeButtonNode=null}BX.cleanNode(this.wrapper,e)}},destroy:function(){this.clean(true);if(this.blockArea)this.blockArea.onBlockDestroy(this.blockIndex)}}}if(typeof BX.setTextContent==="undefined"){BX.setTextContent=function(e,t){if(e){if(e.textContent!==undefined)e.textContent=t;else e.innerText=t}}}if(typeof BX.Crm.RequisiteFormManager==="undefined"){BX.Crm.RequisiteFormManager=function(){this._id="";this._settings={};this._entityTypeId=0;this._entityId=0;this._countryId=0;this._container=null;this._isVisible=true;this._presetList=null;this._presetSelector=null;this._presetLastSelectedId=0;this._presetSelectHandler=BX.delegate(this.onPresetSelect,this);this._pseudoIdSequence=0;this._fieldNameTemplate="";this._enableFieldMasquerading=false;this._formCreateHandler=BX.delegate(this.onFormCreate,this);this._forms={};this._isRequestRunning=false;this._requestForm=null;this._formLoaderUrl="";this._serviceUrl=""};BX.Crm.RequisiteFormManager.prototype={initialize:function(e,t){this._id=BX.type.isNotEmptyString(e)?e:"crm_requisite_form_manager";this._settings=t?t:{};this._container=BX(this.getSetting("containerId",""));if(!this._container){throw"BX.Crm.RequisiteFormManager: Could not find container."}this._formLoaderUrl=this.getSetting("formLoaderUrl","");if(!BX.type.isNotEmptyString(this._formLoaderUrl)){throw"BX.Crm.RequisiteFormManager: Could not find parameter 'formLoaderUrl' in settings."}this._serviceUrl=this.getSetting("serviceUrl","");if(!BX.type.isNotEmptyString(this._serviceUrl)){throw"BX.Crm.RequisiteFormManager: Could not find parameter 'serviceUrl' in settings."}this._fieldNameTemplate=this.getSetting("fieldNameTemplate","");this._enableFieldMasquerading=this._fieldNameTemplate!=="";this._entityTypeId=parseInt(this.getSetting("entityTypeId",0));this._entityId=parseInt(this.getSetting("entityId",0));this._presetList=this.getSetting("presetList",null);if(!BX.type.isArray(this._presetList)){this._presetList=[]}this._countryId=parseInt(this.getSetting("countryId",0));if(isNaN(this._countryId)||this._countryId<0){this._countryId=0}this._presetLastSelectedId=parseInt(this.getSetting("presetLastSelectedId",0));this._isVisible=!!this.getSetting("isVisible",true);this._container.style.display=this._isVisible?"":"none";this._presetSelector=new BX.Crm.RequisitePresetSelectorClass({editor:this,id:this._id,container:this._container,position:"top",requisiteEntityTypeId:this._entityTypeId,requisiteEntityId:this._entityId,presetList:this._presetList,presetLastSelectedId:this._presetLastSelectedId,requisiteEditHandler:this._presetSelectHandler});BX.addCustomEvent(window,"CrmRequisiteEditFormCreate",this._formCreateHandler)},getId:function(){return this._id},getSetting:function(e,t){return this._settings.hasOwnProperty(e)?this._settings[e]:t},getMessage:function(e){var t=BX.Crm.RequisiteFormManager.messages;return t.hasOwnProperty(e)?t[e]:e},getEntityTypeId:function(){return this._entityTypeId},getEntityId:function(){return this._entityId},onPresetSelect:function(e,t,i){this.startLoadRequest({presetId:parseInt(i),requisiteId:0,requisitePseudoId:"n"+(this._pseudoIdSequence++).toString()})},onFormCreate:function(e){var t=e["formId"];if(this._forms[t]){delete this._forms[t]}var i=BX.type.isNumber(e["elementId"])?e["elementId"]:0;var s=BX.type.isBoolean(e["enableFieldMasquerading"])?e["enableFieldMasquerading"]:this._enableFieldMasquerading;var r=BX.type.isNotEmptyString(e["fieldNameTemplate"])?e["fieldNameTemplate"]:this._fieldNameTemplate;var n=BX.type.isNotEmptyString(e["containerId"])?e["containerId"]:"container_"+t;var a=BX.type.isNumber(e["countryId"])?e["countryId"]:this._countryId;var o=BX.type.isBoolean(e["enableClientResolution"])?e["enableClientResolution"]:false;var l=BX.Crm.RequisiteInnerForm.create(t,{manager:this,settingManagerId:t.toLowerCase(),countryId:a,enableClientResolution:o,containerId:n,elementId:i,enableFieldMasquerading:s,fieldNameTemplate:r,serviceUrl:this._serviceUrl});if(i<=0){var d=this.getTopmostForm();if(d){this._container.insertBefore(l.getWrapper(),d.getWrapper());var u=d.getSort();if(u>0){u--}l.setSort(u)}}this._forms[t]=l},getTopmostForm:function(){var e=null;for(var t in this._forms){if(!this._forms.hasOwnProperty(t)){continue}var i=this._forms[t];if(e===null||e.getSort()>i.getSort()){e=i}}return e},reloadForm:function(e){this.startLoadRequest({presetId:e.getPresetId(),requisiteId:e.getElementId(),requisitePseudoId:e.getElementPseudoId(),form:e})},startLoadRequest:function(e){if(this._isRequestRunning){return}this._isRequestRunning=true;if(typeof e["form"]!=="undefined"){this._requestForm=e["form"]}var t={entityTypeId:this._entityTypeId,entityId:this._entityId};var i=BX.type.isNumber(e["presetId"])?e["presetId"]:0;if(i>0){t["presetId"]=i}var s=BX.type.isNumber(e["requisiteId"])?e["requisiteId"]:0;if(s>0){t["requisiteId"]=s}var r=BX.type.isNotEmptyString(e["requisitePseudoId"])?e["requisitePseudoId"]:"";if(r!==""){t["requisitePseudoId"]=e["requisitePseudoId"]}if(this._enableFieldMasquerading){t["fieldNameTemplate"]=BX.util.urlencode(this._fieldNameTemplate)}BX.ajax({url:BX.util.add_url_param(this._formLoaderUrl,t),method:"GET",dataType:"html",data:{},onsuccess:BX.delegate(this.onLoadRequestSuccess,this),onfailure:BX.delegate(this.onRequestFailure,this)})},onLoadRequestSuccess:function(e){var t=null;this._isRequestRunning=false;if(this._requestForm){t=this._requestForm.getNextSiblingWrapper();this._requestForm.release(true);this._requestForm=null}var i=BX.create("DIV",{html:e});while(i.childNodes.length>0){var s=i.childNodes[0];if(t){this._container.insertBefore(i.removeChild(s),t)}else{this._container.appendChild(i.removeChild(s))}}},onRequestFailure:function(e){this._isRequestRunning=false;this._requestForm=null}};if(typeof BX.Crm.RequisiteFormManager.messages==="undefined"){BX.Crm.RequisiteFormManager.messages={}}BX.Crm.RequisiteFormManager.items={};BX.Crm.RequisiteFormManager.create=function(e,t){var i=new BX.Crm.RequisiteFormManager;i.initialize(e,t);return this.items[i.getId()]=i}}if(typeof BX.Crm.RequisiteInnerForm==="undefined"){BX.Crm.RequisiteInnerForm=function(){this._id="";this._settings={};this._manager=null;this._serviceUrl="";this._containerId="";this._elementId=0;this._pseudoId=null;this._sort=-1;this._presetId=-1;this._countryId=0;this._enableClientResolution=false;this._enableFieldMasquerading=false;this._multiAddressEditor=null;this._fieldNameTemplate="";this._settingManagerId="";this._settingManager="";this._settingManagerCreateHandler=BX.delegate(this.onFormSettingManagerCreate,this);this._settingManagerSaveHandler=BX.delegate(this.onFormSettingManagerSave,this);this._settingManagerSectionEditHandler=BX.delegate(this.onFormSettingManagerSectionEdit,this);this._settingManagerSectionRemoveHandler=BX.delegate(this.onFormSettingManagerSectionRemove,this);this._settingManagerFormReloadHandler=BX.delegate(this.onFormSettingManagerFormReload,this);this._settingManagerFormReloadHandler=BX.delegate(this.onFormSettingManagerFormReload,this);this._addressCreateHandler=BX.delegate(this.onAddressCreate,this);this._isMarkedAsDeleted=false};BX.Crm.RequisiteInnerForm.prototype={initialize:function(e,t){this._id=BX.type.isNotEmptyString(e)?e:"crm_requisite_form_manager";this._settings=t?t:{};this._countryId=this.getSetting("countryId",0);this._enableClientResolution=this.getSetting("enableClientResolution",false);this._manager=this.getSetting("manager",null);if(!this._manager){throw"BX.Crm.RequisiteInnerForm: Could not find parameter 'manager' in settings."}this._serviceUrl=this.getSetting("serviceUrl","");if(!BX.type.isNotEmptyString(this._serviceUrl)){throw"BX.Crm.RequisiteInnerForm: Could not find parameter 'serviceUrl' in settings."}this._containerId=this.getSetting("containerId","");this._elementId=parseInt(this.getSetting("elementId",0));this._enableFieldMasquerading=!!this.getSetting("enableFieldMasquerading",false);this._fieldNameTemplate=this.getSetting("fieldNameTemplate","");this._settingManagerId=this.getSetting("settingManagerId","");if(this._settingManagerId===""){this._settingManagerId=this._id}this._settingManager=BX.CrmFormSettingManager.getItemById(this._settingManagerId,true);if(this._settingManager){this.bind()}else{BX.addCustomEvent(window,"CrmFormSettingManagerCreate",this._settingManagerCreateHandler)}var i="";var s="";switch(this._countryId){case 1:i=BX.Crm.RequisiteFieldType.itin;s="RQ_INN";break;case 14:i=BX.Crm.RequisiteFieldType.sro;s="RQ_EDRPOU";break}if(s.length>0){var r=this.getFieldControl(s);if(r&&this._enableClientResolution){BX.Crm.RequisiteFieldController.create(s,{countryId:this._countryId,typeId:i,input:r,serviceUrl:this._serviceUrl,callbacks:{onFieldsLoad:BX.delegate(this.setupFields,this)}})}}var n=BX.CrmMultipleAddressEditor.getItemsByFormId(this._id);if(n.length>0){this._multiAddressEditor=n[0];BX.addCustomEvent(this._multiAddressEditor,"CrmMultipleAddressItemCreated",this._addressCreateHandler)}},release:function(e){e=!!e;this.unbind();if(this._settingManager){var t=this._settingManager.getManager();t.release(e);delete BX.CrmEditFormManager.items[t.getId()];this._settingManager=null}if(e){var i=this.getContainer();if(i){BX.remove(i.parentNode)}}},getId:function(){return this._id},getSetting:function(e,t){return this._settings.hasOwnProperty(e)?this._settings[e]:t},getContainer:function(){return BX(this._containerId)},getWrapper:function(){var e=this.getContainer();return BX.type.isElementNode(e)?e.parentNode:null},getNextSiblingWrapper:function(){var e=this.getWrapper();return BX.type.isElementNode(e)?BX.findNextSibling(e,{className:"crm-offer-requisite-form-wrap"}):null},bind:function(){if(this._settingManager){BX.addCustomEvent(this._settingManager,"CrmFormSettingManagerSave",this._settingManagerSaveHandler);BX.addCustomEvent(this._settingManager,"CrmFormSettingManagerSectionEditEnd",this._settingManagerSectionEditHandler);BX.addCustomEvent(this._settingManager,"CrmFormSettingManagerSectionRemove",this._settingManagerSectionRemoveHandler);BX.addCustomEvent(this._settingManager,"CrmFormSettingManagerReloadForm",this._settingManagerFormReloadHandler)}},unbind:function(){if(this._settingManager){BX.removeCustomEvent(this._settingManager,"CrmFormSettingManagerSave",this._settingManagerSaveHandler);BX.removeCustomEvent(this._settingManager,"CrmFormSettingManagerSectionEditEnd",this._settingManagerSectionEditHandler);BX.removeCustomEvent(this._settingManager,"CrmFormSettingManagerSectionRemove",this._settingManagerSectionRemoveHandler);BX.removeCustomEvent(this._settingManager,"CrmFormSettingManagerReloadForm",this._settingManagerFormReloadHandler)}},getElementId:function(){return this._elementId},getFieldControl:function(e){var t=document.getElementsByName(this.resolveFieldInputName(e));return t.length>0?t[0]:null},getFieldValue:function(e){var t=this.getFieldControl(e);return t!==null?t.value:""},setFieldValue:function(e,t){var i=this.getFieldControl(e);if(i!==null){i.value=t}},setupFields:function(e){if(BX.type.isFunction(window["cssQuery"])){var t=window["cssQuery"]("input[type=text],textarea",this.getContainer());for(var i=0;i<t.length;i++){t[i].value=""}}for(var s in e){if(!e.hasOwnProperty(s)){continue}if(s!=="RQ_ADDR"){this.setFieldValue(s,e[s])}else if(this._multiAddressEditor){var r=e[s];for(var n in r){if(!r.hasOwnProperty(n)){continue}var a=r[n];var o=parseInt(n);var l=this._multiAddressEditor.getItemByTypeId(o);if(l===null){l=this._multiAddressEditor.createItem(o,this._id)}l.setup(a)}}}},getElementPseudoId:function(){if(this._pseudoId===null){this._pseudoId=this.getFieldValue("PSEUDO_ID","")}return this._pseudoId},getPresetId:function(){if(this._presetId<0){this._presetId=parseInt(this.getFieldValue("PRESET_ID"));if(isNaN(this._presetId)){this._presetId=0}}return this._presetId},getSort:function(){if(this._sort<0){this._sort=parseInt(this.getFieldValue("SORT"));if(isNaN(this._sort)){this._sort=0}}return this._sort},setSort:function(e){if(!BX.type.isNumber(e)){e=parseInt(e);if(isNaN(e)){e=0}}this._sort=e;this.setFieldValue("SORT",this._sort)},resolveFieldInputName:function(e){if(this._enableFieldMasquerading&&this._fieldNameTemplate!==""){return this._fieldNameTemplate.replace(/#FIELD_NAME#/g,e)}return e},markAsDeleted:function(){if(this._isMarkedAsDeleted){return}this._isMarkedAsDeleted=true;var e=this.getContainer();if(e){e.appendChild(BX.create("INPUT",{props:{name:this.resolveFieldInputName("DELETED"),type:"hidden",value:"Y"}}));var t=e.parentNode;t.style.display="none"}},isMarkedAsDeleted:function(){return this._isMarkedAsDeleted},onFormSettingManagerCreate:function(e){if(e.getId().toLowerCase()===this._settingManagerId.toLowerCase()){this._settingManager=e;this.bind();BX.removeCustomEvent(window,"CrmFormSettingManagerCreate",this._settingManagerCreateHandler)}},onFormSettingManagerSave:function(e,t){if(this._settingManager===e&&this._enableFieldMasquerading){BX.CrmFormSettingManager.replaceIdentity(t["data"],"rawId")}},onFormSettingManagerSectionEdit:function(e,t){if(this._settingManager===e){t["cancel"]=true;var i=t["section"];var s=i.getAssociatedField();if(s){var r=BX(s["id"]);if(r){r.value=i.getName()}}}},onFormSettingManagerSectionRemove:function(e,t){if(this._settingManager===e){t["cancel"]=true;this.markAsDeleted()}},onFormSettingManagerFormReload:function(e,t){t["cancel"]=true;this._manager.reloadForm(this)},onAddressCreate:function(e,t){if(t.getOriginatorId()===this._id){return}var i=this._manager.getEntityTypeId();var s=this._manager.getEntityId();if(i>0&&s>0){t.setupByEntity(i,s)}}};BX.Crm.RequisiteInnerForm.create=function(e,t){var i=new BX.Crm.RequisiteInnerForm;i.initialize(e,t);return i}}
/* End */
;
; /* Start:"a:4:{s:4:"full";s:136:"/bitrix/components/bitrix/crm.interface.form.tactile/templates/.default/bitrix/main.interface.form/tactile/script.min.js?151131647891026";s:6:"source";s:116:"/bitrix/components/bitrix/crm.interface.form.tactile/templates/.default/bitrix/main.interface.form/tactile/script.js";s:3:"min";s:120:"/bitrix/components/bitrix/crm.interface.form.tactile/templates/.default/bitrix/main.interface.form/tactile/script.min.js";s:3:"map";s:120:"/bitrix/components/bitrix/crm.interface.form.tactile/templates/.default/bitrix/main.interface.form/tactile/script.map.js";}"*/
if(typeof BX.CrmFormMode==="undefined"){BX.CrmFormMode={undefined:0,view:1,edit:2}}if(typeof BX.CrmEditFormManager==="undefined"){BX.CrmEditFormManager=function(){this._id="";this._settings=null;this._form=null;this._formId="";this._tabId="";this._mode=BX.CrmFormMode.edit;this._prefix="";this._isModal=false;this._dragPriority=-1;this._inShortListOptionEnabled=false;this._settingsManager=null;this._userFieldManager=null};BX.CrmEditFormManager.prototype={initialize:function(e,t){this._id=BX.type.isNotEmptyString(e)?e:BX.util.getRandomString(8);this._settings=t?t:{};this._form=this.getSetting("form",null);this._formId=this.getSetting("formId","");this._tabId=this.getSetting("tabId","");if(!BX.type.isNotEmptyString(this._tabId)){this._tabId="tab_1"}if(!BX.type.isNotEmptyString(this._formId)){throw"Error: The 'formId' parameter is not defined in settings or empty."}this._mode=this.getSetting("mode",BX.CrmFormMode.edit);this._prefix=this.getSetting("prefix","");this._isModal=this.getSetting("isModal",false)===true;this._dragPriority=parseInt(this.getSetting("dragPriority",-1));this._inShortListOptionEnabled=this.getSetting("enableInShortListOption",false)===true;this._settingsManager=BX.CrmFormSettingManager.create(this._id,{formId:this._formId,manager:this,form:this._form,prefix:this._prefix,sectionWrapperId:this.getSetting("sectionWrapperId",""),undoContainerId:this.getSetting("undoContainerId",""),tabId:this._tabId,metaData:this.getSetting("metaData",{}),hiddenMetaData:this.getSetting("hiddenMetaData",{}),isSettingsApplied:this.getSetting("isSettingsApplied",false),canCreateUserField:this.getSetting("canCreateUserField",false),canCreateSection:this.getSetting("canCreateSection",false),canSaveSettingsForAll:this.getSetting("canSaveSettingsForAll",false),inShortListOptionEnabled:this._inShortListOptionEnabled,isModal:this._isModal,enableFieldDrag:this.getSetting("enableFieldDrag",true),enableSectionDrag:this.getSetting("enableSectionDrag",true),dragPriority:this._dragPriority});var i=this.getSetting("userFieldEntityId","");if(BX.type.isNotEmptyString(i)){this._userFieldManager=BX.CrmFormUserFieldManager.create(this._id,{manager:this,serviceUrl:this.getSetting("userFieldServiceUrl"),serverTime:this.getSetting("serverTime"),entityId:i,canCreate:this.getSetting("canCreateUserField",false),addFieldButton:this._formId+"_add_field"})}BX.addCustomEvent(window,"CrmQuickPanelViewExpanded",BX.delegate(this._onQuickPanelViewExpand,this))},release:function(e){this._settingsManager.release(e);if(this._userFieldManager.getManager()===this){this._userFieldManager.release()}},getSetting:function(e,t){return this._settings.hasOwnProperty(e)?this._settings[e]:t},getId:function(){return this._id},getMode:function(){return this._mode},getSettingsManager:function(){return this._settingsManager},getUserFieldManager:function(){return this._userFieldManager},_onQuickPanelViewExpand:function(e,t){this._settingsManager.setViewModeVisibility(t)}};BX.CrmEditFormManager.items={};BX.CrmEditFormManager.create=function(e,t){var i=new BX.CrmEditFormManager;i.initialize(e,t);this.items[i.getId()]=i;return i}}if(typeof BX.CrmFormSettingManager==="undefined"){BX.CrmFormSettingManager=function(){this._id="";this._settings=null;this._manager=null;this._form=null;this._formId="";this._prefix="";this._sectionWrapperId="";this._undoContainerId="";this._menuButton=null;this._menu=null;this._menuId="";this._isMenuShown=false;this._tabId="";this._metaData=null;this._hiddenMetaData=null;this._editData=null;this._isSettingsApplied=false;this._isModal=false;this._dragPriority=-1;this._inShortListOptionEnabled=false;this._enableSectionDrag=true;this._enableFieldDrag=true;this._draggableFieldContextId="";this._draggableSectionContextId="";this._dragDropUndoData=null;this._sectionSettings={};this._fieldSettings={};this._temporaryFields={};this._temporaryFieldCounter=0;this._temporarySection=null;this._placeHolder=null;this._dragContainer=null;this._canCreateUserField=false;this._canCreateSection=false;this._needToReload=false;this._fieldDropHandler=BX.delegate(this._onFieldDrop,this);this._sectionDropHandler=BX.delegate(this._onSectionDrop,this)};BX.CrmFormSettingManager.prototype={initialize:function(e,t){this._id=BX.type.isNotEmptyString(e)?e:BX.util.getRandomString(8);this._settings=t?t:{};this._form=this.getSetting("form",null);this._formId=this.getSetting("formId","");if(!BX.type.isNotEmptyString(this._formId)){throw"Error: The 'formId' parameter is not defined in settings or empty."}this._prefix=this.getSetting("prefix","");this._menuButton=BX(this._formId+"_menu");if(this._menuButton){BX.bind(this._menuButton,"click",BX.delegate(this._onMenuButtonClick,this))}this._menuId=this._id.toLowerCase()+"_main_menu";this._sectionWrapperId=this.getSetting("sectionWrapperId","");this._undoContainerId=this.getSetting("undoContainerId","");this._tabId=this.getSetting("tabId","");if(!BX.type.isNotEmptyString(this._tabId)){this._tabId="tab_1"}this._metaData=this.getSetting("metaData",null);if(!BX.type.isPlainObject(this._metaData)){throw"Error: The 'metaData' parameter is not defined in settings or empty."}this._hiddenMetaData=this.getSetting("hiddenMetaData",null);if(BX.type.isArray(this._hiddenMetaData)){this._hiddenMetaData={}}else if(!BX.type.isPlainObject(this._hiddenMetaData)){throw"Error: The 'hiddenMetaData' parameter is not defined in settings or empty."}this._manager=this.getSetting("manager",null);this._canCreateUserField=this.getSetting("canCreateUserField",false);this._canCreateSection=this.getSetting("canCreateSection",false);this._inShortListOptionEnabled=this.getSetting("inShortListOptionEnabled",false)===true;this._dragPriority=parseInt(this.getSetting("dragPriority",-1));this._isModal=this.getSetting("isModal",false)===true;if(this._isModal&&this._dragPriority===-1){this._dragPriority=1}this._isSettingsApplied=this.getSetting("isSettingsApplied",false);var i=this.getFormId().toLowerCase()+"_";this._draggableFieldContextId=i+BX.CrmFormFieldDragItem.contextId;this._draggableSectionContextId=i+BX.CrmFormSectionDragItem.contextId;this._enableSectionDrag=this.getSetting("enableSectionDrag",true);this._enableFieldDrag=this.getSetting("enableFieldDrag",true);this._initializeFromMetaData();this._dragContainer=BX.CrmFormSectionDragContainer.create(this._id,{manager:this,node:BX(this._sectionWrapperId),contextId:this._draggableSectionContextId});this._dragContainer.addDragFinishListener(this._sectionDropHandler);BX.onCustomEvent(window,"CrmFormSettingManagerCreate",[this]);if(!this._isModal){var n=BX.CrmDragDropBin.getInstance();BX.addCustomEvent(n,"CrmDragDropBinItemDrop",BX.delegate(this._onDragDropBinItemDrop,this))}},_initializeFromMetaData:function(){this._editData=[];for(var e in this._metaData){if(!this._metaData.hasOwnProperty(e)){continue}var t=BX.clone(this._metaData[e]);var i=[];var n=BX.type.isPlainObject(this._metaData[e]["fields"])?this._metaData[e]["fields"]:{};for(var r in n){if(n.hasOwnProperty(r)){i.push(BX.clone(n[r]))}}t["fields"]=i;this._editData.push(t)}var s=this._metaData.hasOwnProperty(this._tabId)?this._metaData[this._tabId]:null;if(!(s&&typeof s==="object")){throw"Error: Could not find '"+this._tabId+"' in metaData."}var o=s["fields"];if(BX.type.isPlainObject(o)){var a=!this._isModal;for(var d in o){if(!o.hasOwnProperty(d)){continue}var l=o[d];var h=BX.type.isNotEmptyString(l["type"])?l["type"]:"";if(h==="section"){if(!this.getSectionNode(d)){continue}this._sectionSettings[d]=BX.CrmFormSectionSetting.create(d,{manager:this,data:l,draggableFieldContextId:this._draggableFieldContextId,draggableSectionContextId:this._draggableSectionContextId,enableDrag:this._enableSectionDrag,enableDragDropBin:a})}else{if(!this.getFieldNode(d)){continue}this._fieldSettings[d]=BX.CrmFormFieldSetting.create(d,{manager:this,data:l,draggableContextId:this._draggableFieldContextId,enableDrag:this._enableFieldDrag,enableDragDropBin:a,inShortListOptionEnabled:this._inShortListOptionEnabled})}}}if(!this.hasSections()){this.createTemporarySection()}},release:function(e){e=!!e;for(var t in this._fieldSettings){if(this._fieldSettings.hasOwnProperty(t)){this._fieldSettings[t].release(e)}}this._fieldSettings={};for(var i in this._sectionSettings){if(this._sectionSettings.hasOwnProperty(i)){this._sectionSettings[i].release(e)}}this._sectionSettings={}},getSetting:function(e,t){return this._settings.hasOwnProperty(e)?this._settings[e]:t},getId:function(){return this._id},getFormId:function(){return this._formId},getFormNodeId:function(){return"form_"+this._formId},getForm:function(){return BX(this.getFormNodeId())},getFormMode:function(){return this._manager.getMode()},getTabId:function(){return this._tabId},getManager:function(){return this._manager},hasHiddenFields:function(){for(var e in this._hiddenMetaData){if(!this._hiddenMetaData.hasOwnProperty(e)){continue}var t=this._hiddenMetaData[e];var i=BX.type.isNotEmptyString(t["type"])?t["type"]:"";if(i!=="section"){return true}}return false},getHiddenFieldInfos:function(){var e=[];for(var t in this._hiddenMetaData){if(!this._hiddenMetaData.hasOwnProperty(t)){continue}var i=this._hiddenMetaData[t];var n=BX.type.isNotEmptyString(i["type"])?i["type"]:"";if(n==="section"){continue}e.push(i)}return e},canCreateUserField:function(){return this._canCreateUserField},createTemporaryField:function(e,t){this._temporaryFieldCounter++;var i=this.getMessage("newFieldName")+" "+this._temporaryFieldCounter.toString();var n=this._manager.getUserFieldManager().createTemporaryField({type:e,label:i});var r=t.getContentsNode();var s=r.rows.length-1;var o=n.getFieldName();var a="text";if(e==="boolean"){a="checkbox"}else if(e==="datetime"){a="date"}var d=BX.CrmFormFieldSetting.create(o,{manager:this,data:{id:o,type:a,userFieldType:e,name:i,isRQ:this._inShortListOptionEnabled?true:false},draggableContextId:this._draggableFieldContextId,inShortListOptionEnabled:this._inShortListOptionEnabled,isTemporary:true,editMode:true,node:BX.CrmFormFieldRenderer.renderUserFieldRow(n,r,{index:s,prefix:this._prefix,enableDrag:this._enableFieldDrag})});this._temporaryFields[o]={field:d,section:t}},canCreateSection:function(){return this._canCreateSection},createSection:function(e){var t=0;if(this._temporarySection!==e){var i=this.getSectionLocation(e.getId());t=i.index;if(t<0){return}t+=i.length+1}var n="section_"+BX.util.getRandomString(8).toLocaleLowerCase();var r={type:"section",id:n,name:this.getMessage("newSectionName")};var s=this._editData.length;for(var o=0;o<s;o++){var a=this._editData[o];if(a["id"]!==this._tabId){continue}var d=a["fields"];if(!BX.type.isArray(d)){return}if(t>=d.length){d.push(r)}else{d.splice(t,0,r)}}var l=BX.CrmFormFieldRenderer.renderSectionTable(r,{canCreateSection:this.canCreateSection(),canCreateUserField:this.canCreateUserField(),containerNode:BX(this._sectionWrapperId),index:this._temporarySection!==e?this.getSectionRootIndex(e.getId())+1:0,prefix:this._prefix});this._sectionSettings[n]=BX.CrmFormSectionSetting.create(n,{manager:this,data:r,draggableFieldContextId:this._draggableFieldContextId,draggableSectionContextId:this._draggableSectionContextId,editMode:true});var h=l.rows[0];h.draggable=true;h.setAttribute("data-dragdrop-id",n);h.setAttribute("data-dragdrop-context","field");var u=this.save(false);if(u&&this._temporarySection){this._temporarySection.release(true);this._temporarySection=null}return u},createTemporarySection:function(){if(!this.canCreateSection()){return}var e="section_"+BX.util.getRandomString(8).toLocaleLowerCase();var t={type:"section",id:e};BX.CrmFormFieldRenderer.renderSectionTable(t,{canCreateSection:true,canCreateUserField:false,canRestoreField:false,containerNode:BX(this._sectionWrapperId),index:0,prefix:this._prefix});this._temporarySection=BX.CrmFormSectionSetting.create(e,{manager:this,data:t,draggableFieldContextId:this._draggableFieldContextId,draggableSectionContextId:this._draggableSectionContextId,isTemporary:true})},createDragEffectNode:function(e){var t=e.getId();var i=BX.findChild(e.getNode(),{tagName:"SPAN",className:"crm-offer-info-label"},true,false);if(i){t=i.innerHTML.replace(/:\s*$/,"")}return BX.create("DIV",{attrs:{className:"crm-offer-draggable-item"},children:[BX.create("SPAN",{attrs:{className:"crm-offer-drg-btn"}}),BX.create("SPAN",{attrs:{className:"crm-offer-title-text"},html:t})]})},getTabFields:function(){var e=this._editData.length;for(var t=0;t<e;t++){var i=this._editData[t];if(i["id"]!==this._tabId){continue}return i["fields"]}return null},getFields:function(){return this._fieldSettings},getField:function(e){return this._fieldSettings.hasOwnProperty(e)?this._fieldSettings[e]:null},getFieldSection:function(e){if(!BX.type.isNotEmptyString(e)){return null}var t=this._editData.length;for(var i=0;i<t;i++){var n=this._editData[i];if(n["id"]!==this._tabId){continue}var r=n["fields"];if(!BX.type.isArray(r)){return-1}var s=r.length;var o="";for(var a=0;a<s;a++){var d=r[a];if(d["type"]==="section"){o=d["id"];continue}if(d["id"]===e){return this._sectionSettings.hasOwnProperty(o)?this._sectionSettings[o]:null}}}return null},getFieldIndex:function(e){if(!BX.type.isNotEmptyString(e)){return-1}var t=this._editData.length;for(var i=0;i<t;i++){var n=this._editData[i];if(n["id"]!==this._tabId){continue}var r=n["fields"];if(!BX.type.isArray(r)){return-1}var s=r.length;for(var o=0;o<s;o++){var a=r[o];if(a["id"]===e){return o}}}return-1},setFieldIndex:function(e,t,i){if(!BX.type.isNotEmptyString(e)||!BX.type.isNumber(t)||t<0){return false}i=parseInt(i);if(isNaN(i)||i<0){i=this.getFieldIndex(e)}if(i<0){return false}if(t===i){return true}var n=this._editData.length;for(var r=0;r<n;r++){var s=this._editData[r];if(s["id"]!==this._tabId){continue}var o=s["fields"];if(!BX.type.isArray(o)){return false}var a=o[i];o.splice(i,1);if(t-i>1){t--}if(t>=o.length){o.push(a)}else{o.splice(t,0,a)}}return this.save(false)},hasField:function(e){return this._fieldSettings.hasOwnProperty(e)},hasSection:function(e){return this._sectionSettings.hasOwnProperty(e)},removeField:function(e){var t=this._removeField(e)&&this.save(false);if(t){this._dragDropUndoData=null;BX.cleanNode(BX(this._undoContainerId),false)}return t},restoreField:function(e,t){if(!BX.type.isNotEmptyString(e)){return false}if(!BX.type.isNotEmptyString(t)){return false}if(!this._hiddenMetaData.hasOwnProperty(e)){return false}var i=this._hiddenMetaData[e];var n=this.getSectionLocation(t);var r=n.index;if(r<0){return false}r+=n.length+1;var s=this._editData.length;for(var o=0;o<s;o++){var a=this._editData[o];if(a["id"]!==this._tabId){continue}var d=a["fields"];if(!BX.type.isArray(d)){return false}if(r>=d.length){d.push(i)}else{d.splice(r,0,i)}}this._needToReload=true;this.save(false);return true},getSectionLocation:function(e){if(!BX.type.isNotEmptyString(e)){return{index:-1,length:0,fields:[]}}var t=this._editData.length;for(var i=0;i<t;i++){var n=this._editData[i];if(n["id"]!==this._tabId){continue}var r=n["fields"];if(!BX.type.isArray(r)){return{index:-1,length:0,fields:[]}}var s=[];var o=-1;var a=0;var d=r.length;for(var l=0;l<d;l++){var h=r[l];if(h["type"]==="section"){if(o>=0){break}else if(h["id"]===e){o=l}}else if(o>=0){s.push(h["id"]);a++}}return{index:o,length:a,fields:s}}return{index:-1,length:0,fields:[]}},getSectionIndex:function(e){var t=this.getSectionLocation(e);return t.index},setSectionIndex:function(e,t,i){if(!BX.type.isNotEmptyString(e)){return false}if(!BX.type.isNumber(t)||t<0){return false}if(!i){i=this.getSectionLocation(e)}var n=i.index;if(n<0){return false}if(t===n){return true}var r=this._editData.length;for(var s=0;s<r;s++){var o=this._editData[s];if(o["id"]!==this._tabId){continue}var a=o["fields"];if(!BX.type.isArray(a)){return false}var d=a[n];var l=[];var h=i.length;if(h>0){var u=n+h;for(var c=n+1;c<=u;c++){l.push(a[c])}a.splice(n+1,h)}a.splice(n,1);if(t>=n){t-=i.length+1}if(t>=a.length){a.push(d);for(var f=0;f<l.length;f++){a.push(l[f])}}else{a.splice(t,0,d);for(var _=0;_<l.length;_++){a.splice(t+_+1,0,l[_])}}}return this.save(false)},getSectionFieldIds:function(e){var t=this.getSectionLocation(e);return t.fields},getSectionRootIndex:function(e){var t=this._editData.length;var i=0;for(var n=0;n<t;n++){var r=this._editData[n];if(r["id"]!==this._tabId){continue}var s=r["fields"];if(!BX.type.isArray(s)){return-1}var o=s.length;for(var a=0;a<o;a++){var d=s[a];if(d["type"]!=="section"){continue}if(d["id"]===e){return i}i++}}return-1},getSectionIds:function(){var e=[];var t=this._editData.length;for(var i=0;i<t;i++){var n=this._editData[i];if(n["id"]!==this._tabId){continue}var r=n["fields"];if(!BX.type.isArray(r)){return e}var s=r.length;for(var o=0;o<s;o++){var a=r[o];if(a["type"]!=="section"){continue}e.push(a["id"])}}return e},getSections:function(){var e=[];var t=this.getSectionIds();for(var i=0;i<t.length;i++){var n=t[i];var r=this._sectionSettings.hasOwnProperty(n)?this._sectionSettings[n]:null;if(r){e.push(r)}}return e},hasSections:function(){for(var e in this._sectionSettings){if(this._sectionSettings.hasOwnProperty(e)){return true}}return false},setupField:function(e,t){var i=this.getFieldIndex(e);if(i<0){return false}var n=this.getTabFields();if(!BX.type.isArray(n)){return false}n[i]=t;return this.save(false)},save:function(e){if(!this._form){return false}BX.showWait();this._form.aTabsEdit=BX.clone(this._editData);var t=BX.clone(this._editData);var i={cancel:false,data:t};BX.onCustomEvent(this,"CrmFormSettingManagerSave",[this,i]);if(i["cancel"]){return}t=i["data"];if(!BX.type.isArray(t)){return false}this._form.aTabsEdit=t;var n={callback:BX.delegate(this._onSettingsSave,this)};if(!!e&&this.getSetting("canSaveSettingsForAll",false)){n["setDefaultSettings"]=true;n["deleteUserSettings"]=true}this._form.SaveSettings(n);return true},reset:function(){this._needToReload=true;this._form.EnableSettings(false,BX.delegate(this._onSettingsDisable,this))},setViewModeVisibility:function(e){this._form.SetViewModeVisibility(e)},processFieldEditStart:function(e){},processFieldEditEnd:function(e){var t=e.getId();if(!e.isTemporary()){this.setupField(t,e.getData());return true}this._manager.getUserFieldManager().createField({type:e.getUserFieldType(),name:e.getName()},t,BX.delegate(this._onUserFieldCreate,this));return false},processFieldEditCancelation:function(e){if(!e.isTemporary()){return true}var t=e.getNode();BX.findParent(t,{tagName:"TABLE"}).deleteRow(t.rowIndex);e.release(false);delete this._temporaryFields[e.getId()];return false},processSectionEditStart:function(e){var t={section:e,cancel:false};BX.onCustomEvent(this,"CrmFormSettingManagerSectionEditStart",[this,t]);return!t.cancel},processSectionEditEnd:function(e){var t={section:e,cancel:false};BX.onCustomEvent(this,"CrmFormSettingManagerSectionEditEnd",[this,t]);if(!t.cancel){var i=e.getId();this.setupField(i,e.getData())}return true},processSectionRemove:function(e){var t={section:e,cancel:false};BX.onCustomEvent(this,"CrmFormSettingManagerSectionRemove",[this,t]);if(t.cancel===true){return false}var i=e.getId();var n=this.getSectionLocation(i);if(n.index<0){return false}var r=n.fields;var s,o,a;for(a=0;a<r.length;a++){s=r[a];if(typeof this._fieldSettings[s]==="undefined"){continue}o=this._fieldSettings[s];if(o.isRequired()||o.isPersistent()){BX.NotificationPopup.show("form_setting_section_has_required_fields",{messages:[this.getMessage("sectionHasRequiredFields")]});return false}}for(a=0;a<r.length;a++){s=r[a];if(typeof this._fieldSettings[s]==="undefined"){continue}o=this._fieldSettings[s];delete this._fieldSettings[s];var d=o.getNode();BX.findParent(d,{tagName:"TABLE"}).deleteRow(d.rowIndex);o.release(false);this._removeField(s)}delete this._sectionSettings[i];var l=e.getContentsNode();BX.findParent(l,{tagName:"DIV",className:"crm-offer-main-wrap"}).removeChild(l);e.release(false);var h=this._removeField(i)&&this.save(false);if(h&&!this.hasSections()){this.createTemporarySection()}return h},processFieldRemove:function(e){var t=e.getId();delete this._fieldSettings[t];var i=e.getNode();BX.findParent(i,{tagName:"TABLE"}).deleteRow(i.rowIndex);e.release(false);this.removeField(t);for(var n in this._sectionSettings){if(this._sectionSettings.hasOwnProperty(n)){this._sectionSettings[n].processFieldRemove(e)}}return true},getMessage:function(e){var t=BX.CrmFormSettingManager.messages;return t.hasOwnProperty(e)?t[e]:e},isModal:function(){return this._isModal},getDragPriority:function(){return this._dragPriority},resolveFieldNodeId:function(e){return this.resolveNodeId(e,"wrap")},getFieldNode:function(e){return BX(this.resolveNodeId(e,"wrap"))},resolveSectionNodeId:function(e){return this.resolveNodeId(e,"contents")},getSectionNode:function(e){return BX(this.resolveNodeId(e,"contents"))},getSectionButtonWrapperNode:function(e){return BX(this.resolveNodeId(e,"buttons"))},getSectionButtonNode:function(e,t){return BX(this.resolveNodeId(e,t))},resolveNodeId:function(e,t){var i=e.toLowerCase()+"_"+t;if(this._prefix!==""){i=this._prefix+"_"+i}return i},_findNextDragDropFieldNode:function(e){return BX.findNextSibling(e,{tagName:"TR",className:"crm-offer-row"})},_findNextDragDropSectionNode:function(e){return BX.findNextSibling(e,{tagName:"TABLE",className:"crm-offer-info-table"})},_moveDragDropFieldNode:function(e,t,i){if(!BX.type.isDomNode(i)){i=t.rows[t.rows.length-1]}t.tBodies[0].insertBefore(e,i)},_moveDragDropSectionNode:function(e,t){var i=BX(this._sectionWrapperId);if(BX.type.isDomNode(t)){i.insertBefore(e,t)}else{i.appendChild(e)}},_removeField:function(e){if(!BX.type.isNotEmptyString(e)){return false}var t=this.getFieldIndex(e);if(t<0){return false}var i=this._editData.length;for(var n=0;n<i;n++){var r=this._editData[n];if(r["id"]!==this._tabId){continue}var s=r["fields"];if(!BX.type.isArray(s)){return false}this._hiddenMetaData[e]=s[t];s.splice(t,1)}return true},_onUserFieldCreate:function(e,t,i){if(!BX.type.isNotEmptyString(t)){return}if(typeof this._temporaryFields[t]==="undefined"){return}var n=this._temporaryFields[t]["field"];var r=this._temporaryFields[t]["section"];var s=n.getData();var o=r.getId();var a=s["id"]=i.getFieldName();var d=this.getSectionLocation(o);if(d.index<0){throw"Error: Could not find '"+o+"' section location."}var l=d.index+d.length+1;var h=r.getContentsNode();n.release(false);h.deleteRow(n.getNode().rowIndex);var u=this._editData.length;for(var c=0;c<u;c++){var f=this._editData[c];if(f["id"]!==this._tabId){continue}var _=f["fields"];if(!BX.type.isArray(_)){return}if(l>=_.length){_.push(s)}else{_.splice(l,0,s)}break}var g=BX.CrmFormFieldRenderer.renderUserFieldRow(i,h,{index:h.rows.length-1,prefix:this._prefix,enableDrag:this._enableFieldDrag});this._fieldSettings[a]=BX.CrmFormFieldSetting.create(a,{manager:this,data:s,draggableContextId:this._draggableFieldContextId,inShortListOptionEnabled:this._inShortListOptionEnabled,node:g});g.draggable=true;g.setAttribute("data-dragdrop-id",a);g.setAttribute("data-dragdrop-context","field");this.save(false)},_onDragDropBinItemDrop:function(e,t){if(t instanceof BX.CrmFormFieldDragItem){var i=t.getField();if(i&&this.hasField(i.getId())){i.remove()}}else if(t instanceof BX.CrmFormSectionDragItem){var n=t.getSection();if(n&&this.hasSection(n.getId())){n.remove()}}},getDraggableFieldContextId:function(){return this._draggableFieldContextId},resolveDraggableFieldId:function(e){var t=BX.type.isNotEmptyString(e["contextId"])?e["contextId"]:"";if(t!==this._draggableFieldContextId){return""}var i=typeof e["field"]!=="undefined"?e["field"]:null;return i?i.getId():""},processDraggedFieldDrop:function(e,t){var i=e.getSection();var n=t.getContextData();var r=BX.type.isNotEmptyString(n["contextId"])?n["contextId"]:"";if(r!==this._draggableFieldContextId){return}var s=typeof n["field"]!=="undefined"?n["field"]:null;if(!s){return}var o=this.getSectionLocation(i.getId());if(o.index<0){throw"Error: Could not get section layout info."}var a=s.getId();var d=s.getNode();var l=this.getFieldSection(a);var h=this._findNextDragDropFieldNode(d);var u=i.getContentsNode();var c=i.getPlaceHolder();this._moveDragDropFieldNode(d,u,c?c.getNode():null);var f=-1;var _=c?c.getFieldId():"";if(_!==""){f=this.getFieldIndex(_)}if(f<0){f=o.index+o.length+1}var g=this.getFieldIndex(a);if(g>=0&&this.setFieldIndex(a,f,g)){f=this.getFieldIndex(a);if(f<=g){g++}this._dragDropUndoData={type:"field",id:a,node:d,contentsNode:l?l.getContentsNode():null,anchorNode:h,oldIndex:g,newIndex:f};var p=BX(this._undoContainerId);if(p){BX.cleanNode(p,false);p.appendChild(BX.create("DIV",{props:{className:"crm-view-message"},children:[BX.create("SPAN",{text:this.getMessage("saved")+" "}),BX.create("A",{props:{href:"#"},events:{click:BX.delegate(this._onSettingsChangeUndo,this)},text:this.getMessage("undo")})]}))}}},processDraggedSectionDrop:function(e){var t=e.getContextData();var i=BX.type.isNotEmptyString(t["contextId"])?t["contextId"]:"";if(i!==this._draggableSectionContextId){return}var n=typeof t["section"]!=="undefined"?t["section"]:null;if(!n){return}var r=n.getId();var s=n.getContentsNode();var o=this._findNextDragDropSectionNode(s);var a=this.getPlaceHolder();this._moveDragDropSectionNode(s,a?a.getNode():null);var d=this.getSectionLocation(r);var l=-1;var h=a?a.getSectionId():"";if(h!==""){l=this.getFieldIndex(h)}if(l<0){var u=this.getSectionIds();if(u.length>0){var c=this.getSectionLocation(u[u.length-1]);l=c.index+c.length+1}else{l=d.index}}var f=d.index;if(f>=0&&this.setSectionIndex(r,l,d)){d=this.getSectionLocation(r);l=d.index;if(l<=f){f+=d.length+1}this._dragDropUndoData={type:"section",id:r,node:s,anchorNode:o,oldIndex:f,newIndex:l};var _=BX(this._undoContainerId);if(_){BX.cleanNode(_,false);_.appendChild(BX.create("DIV",{props:{className:"crm-view-message"},children:[BX.create("SPAN",{text:this.getMessage("saved")+" "}),BX.create("A",{props:{href:"#"},events:{click:BX.delegate(this._onSettingsChangeUndo,this)},text:this.getMessage("undo")})]}))}}},getFieldDropCallback:function(){return this._fieldDropHandler},getSectionDropCallback:function(){return this._sectionDropHandler},createPlaceHolder:function(e){var t=e["id"];var i=e["index"];var n=t!==""&&this._sectionSettings.hasOwnProperty(t)?this._sectionSettings[t]:null;var r=BX(this._sectionWrapperId);if(this._placeHolder){if(this._placeHolder.getSectionIndex()===i){return this._placeHolder}r.removeChild(this._placeHolder.getNode());this._placeHolder=null}var s=BX.create("TABLE",{attrs:{className:"crm-offer-info-table"}});if(n){r.insertBefore(s,n.getContentsNode())}else{r.appendChild(s)}this._placeHolder=BX.CrmFormSectionPlaceholder.create({manager:this,node:s,sectionId:t,sectionIndex:i});this._placeHolder.layout();return this._placeHolder},getPlaceHolder:function(){return this._placeHolder},removePlaceHolder:function(){if(this._placeHolder){var e=BX(this._sectionWrapperId);e.removeChild(this._placeHolder.getNode());this._placeHolder=null}},reloadForm:function(){var e={cancel:false};BX.onCustomEvent(this,"CrmFormSettingManagerReloadForm",[this,e]);if(e["cancel"]){return}if(this._form!==null){this._form.Reload()}},_onFieldDrop:function(e,t,i,n){this.processDraggedFieldDrop(e,t)},_onSectionDrop:function(e,t,i,n){this.processDraggedSectionDrop(t)},_onSettingsSave:function(){if(this._isSettingsApplied){BX.closeWait();if(this._needToReload){this.reloadForm()}return}this._form.EnableSettings(true,BX.delegate(this._onSettingsApply,this))},_onSettingsApply:function(){BX.closeWait();this._isSettingsApplied=true;if(this._needToReload){this.reloadForm()}},_onSettingsDisable:function(){BX.closeWait();this._isSettingsApplied=false;if(this._needToReload){this.reloadForm()}},_onResetMenuItemClick:function(){this._closeMenu();this.reset()},_onSaveForAllMenuItemClick:function(){this._closeMenu();this.save(true)},_onMenuButtonClick:function(e){if(!e){e=window.event}this._openMenu();return BX.PreventDefault(e)},_openMenu:function(){if(this._isMenuShown){return}var e=[{id:"reset",text:this.getMessage("resetMenuItem"),onclick:BX.delegate(this._onResetMenuItemClick,this)}];if(this.getSetting("canSaveSettingsForAll",false)){e.push({id:"saveForAll",text:this.getMessage("saveForAllMenuItem"),onclick:BX.delegate(this._onSaveForAllMenuItemClick,this)})}if(typeof BX.PopupMenu.Data[this._menuId]!=="undefined"){BX.PopupMenu.Data[this._menuId].popupWindow.destroy();delete BX.PopupMenu.Data[this._menuId]}this._menu=BX.PopupMenu.create(this._menuId,this._menuButton,e,{autoHide:true,offsetTop:0,offsetLeft:0,angle:{position:"top",offset:10},events:{onPopupClose:BX.delegate(this._onMenuClose,this)}});this._menu.popupWindow.show();this._isMenuShown=true},_closeMenu:function(){if(this._menu&&this._menu.popupWindow){this._menu.popupWindow.close()}},_onMenuClose:function(){this._menu=null;if(typeof BX.PopupMenu.Data[this._menuId]!=="undefined"){BX.PopupMenu.Data[this._menuId].popupWindow.destroy();delete BX.PopupMenu.Data[this._menuId]}this._isMenuShown=false},_onSettingsChangeUndo:function(e){if(this._dragDropUndoData!==null){var t=this._dragDropUndoData["item"];var i,n,r,s,o;if(this._dragDropUndoData["type"]==="field"){i=this._dragDropUndoData["id"];n=this._dragDropUndoData["oldIndex"];r=this._dragDropUndoData["newIndex"];s=this._dragDropUndoData["node"];o=this._dragDropUndoData["anchorNode"];var a=this._dragDropUndoData["contentsNode"];this._moveDragDropFieldNode(s,a,o);this.setFieldIndex(i,n,r)}else if(this._dragDropUndoData["type"]==="section"){i=this._dragDropUndoData["id"];n=this._dragDropUndoData["oldIndex"];r=this._dragDropUndoData["newIndex"];s=this._dragDropUndoData["node"];o=this._dragDropUndoData["anchorNode"];this._moveDragDropSectionNode(s,o);this.setSectionIndex(i,n)}this._dragDropUndoData=null}BX.cleanNode(BX(this._undoContainerId),false);return BX.PreventDefault(e)}};BX.CrmFormSettingManager.replaceIdentity=function(e,t){for(var i=0;i<e.length;i++){for(var n=0;n<e[i]["fields"].length;n++){if(BX.type.isNotEmptyString(e[i]["fields"][n][t])){e[i]["fields"][n]["id"]=e[i]["fields"][n][t];delete e[i]["fields"][n][t]}}}};if(typeof BX.CrmFormSettingManager.messages==="undefined"){BX.CrmFormSettingManager.messages={}}BX.CrmFormSettingManager.items={};BX.CrmFormSettingManager.getItemById=function(e,t){e=BX.type.isNotEmptyString(e)?e:"";if(e===""){throw"CrmFormSettingManager: argument 'id' must be not empty string."}if(typeof this.items[e]!=="undefined"){return this.items[e]}t=!!t;if(t){e=e.toUpperCase();if(typeof this.items[e]!=="undefined"){return this.items[e]}e=e.toLowerCase();if(typeof this.items[e]!=="undefined"){return this.items[e]}}return null};BX.CrmFormSettingManager.create=function(e,t){var i=new BX.CrmFormSettingManager;i.initialize(e,t);this.items[i.getId()]=i;return i}}if(typeof BX.CrmFormFieldSetting==="undefined"){BX.CrmFormFieldSetting=function(){this._id="";this._settings=null;this._manager=null;this._data=null;this._type="";this._userFieldType="";this._isRQ=false;this._node=null;this._dragButton=null;this._editButton=null;this._delButton=null;this._labelWrapper=null;this._dataWrapper=null;this._nameInput=null;this._buttonWrapper=null;this._inShortListOptionWrapper=null;this._inShortListOptionEnabled=false;this._saveButton=null;this._cancelButton=null;this._cover=null;this._enableDrag=true;this._enableDragDropBin=true;this._draggableContextId="";this._dragItem=null;this._editMode=false;this._isTemporary=false;this._editButtonClickHandler=BX.delegate(this._onEditButtonClick,this);this._deleteButtonClickHandler=BX.delegate(this._onDeleteButtonClick,this);this._saveButtonClickHandler=BX.delegate(this._onSaveButtonClick,this);this._cancelButtonClickHandler=BX.delegate(this._onCancelButtonClick,this);this._contextMenuHandler=BX.delegate(this._onContextMenu,this);this._nameKeyPressHandler=null;this._contextMenuId="form_field_setting";this._isContextMenuShown=false};BX.CrmFormFieldSetting.prototype={initialize:function(e,t){this._id=BX.type.isNotEmptyString(e)?e:BX.util.getRandomString(8);this._settings=t?t:{};this._manager=this.getSetting("manager");if(!(this._manager instanceof BX.CrmFormSettingManager)){
throw"Error: The 'manager' argument must be CrmFormSettingManager instance."}this._data=this.getSetting("data");if(!BX.type.isPlainObject(this._data)){throw"Error: The 'data' parameter is not found in settings."}this._type=BX.type.isNotEmptyString(this._data["type"])?this._data["type"]:"text";this._userFieldType=BX.type.isNotEmptyString(this._data["userFieldType"])?this._data["userFieldType"]:"";this._isRQ=this._data["isRQ"]===true;this._inShortList=this._data["inShortList"]===true;this._inShortListOptionEnabled=this.getSetting("inShortListOptionEnabled",false)===true&&this._isRQ;this._inShortListOptionWrapper=null;this._inShortListOptionCheckbox=null;this._node=this._manager.getFieldNode(e);if(!BX.type.isElementNode(this._node)){throw"Error: Could not find field node."}var i=cssQuery("span.crm-offer-drg-btn",this._node);if(i.length>0){this._dragButton=i[0];BX.bind(this._dragButton,"contextmenu",this._contextMenuHandler)}if(this._type==="vertical_container"||this._type==="lhe"){i=cssQuery("span.crm-offer-edit-btn-wrap",this._node);if(i.length>0){var n=i[0];i=cssQuery("span.crm-offer-item-del",n);if(i.length>0){this._delButton=i[0]}i=cssQuery("span.crm-offer-item-edit",n);if(i.length>0){this._editButton=i[0]}}}else{i=cssQuery("span.crm-offer-item-del",this._node);if(i.length>0){this._delButton=i[0]}i=cssQuery("span.crm-offer-item-edit",this._node);if(i.length>0){this._editButton=i[0]}i=cssQuery("div.crm-offer-info-label-wrap",this._node);if(i.length>0){this._labelWrapper=i[0]}}this._enableEdit=!!this._editButton;i=cssQuery("div.crm-offer-info-data-wrap",this._node);if(i.length===0){throw"Error: Could not find data wrapper."}this._dataWrapper=i[0];this._enableDrag=this.getSetting("enableDrag",true);this._enableDragDropBin=this.getSetting("enableDragDropBin",true);this._draggableContextId=this.getSetting("draggableContextId","");this.initializeDragDropAbilities();this._bindEvents();this._isTemporary=this.getSetting("isTemporary",false);this._editMode=this.getSetting("editMode",false);if(this._editMode){this.enableEditMode(true,true);this._manager.processFieldEditStart(this)}this._isVisible=this._node.style.display!=="none"},getSetting:function(e,t){return this._settings.hasOwnProperty(e)?this._settings[e]:t},getId:function(){return this._id},getType:function(){return this._type},getUserFieldType:function(){return this._userFieldType},getName:function(){return BX.type.isNotEmptyString(this._data["name"])?this._data["name"]:this._id},getManager:function(){return this._manager},isInEditMode:function(){return this._editMode},isTemporary:function(){return this._isTemporary},isRequired:function(){return BX.type.isBoolean(this._data["required"])&&this._data["required"]},isPersistent:function(){return BX.type.isBoolean(this._data["persistent"])&&this._data["persistent"]},getNode:function(){return this._node},getData:function(){return this._data},enableEditMode:function(e,t){e=!!e;t=!!t;if(this._editMode===e&&!t){return}this._editMode=e;if(this._type==="vertical_checkbox"||this._type==="checkbox"){this._processBooleanFieldModeChange()}else if(this._type==="vertical_container"||this._type==="lhe"){this._processContainerFieldModeChange()}else if(this._type==="address"||this._type==="multiple_address"){this._processAddressFieldModeChange()}else{this._processTextFieldModeChange()}},release:function(e){this.releaseDragDropAbilities();this._unbindEvents();if(this._nameKeyPressHandler){BX.unbind(this._nameInput,"keydown",this._nameKeyPressHandler);this._nameKeyPressHandler=null}this._dragButton=null;this._editButton=null;this._delButton=null;this._saveButton=null;this._cancelButton=null;if(e&&this._node){this._node=BX.remove(this._node)}},remove:function(){var e=new BX.CDialog({title:this.getMessage("fieldDeleteDlgTitle"),head:"",content:this.getMessage("fieldDeleteDlgContent"),resizable:false,draggable:true,height:70,width:300});e.ClearButtons();e.SetButtons([{title:this.getMessage("deleteButton"),id:"delete",action:BX.delegate(this._onDeleteConfirmationButtonClick,this)},BX.CDialog.btnCancel]);e.Show()},getMessage:function(e){var t=BX.CrmFormFieldSetting.messages;return t.hasOwnProperty(e)?t[e]:e},createGhostNode:function(){var e=BX.create("DIV",{attrs:{className:"crm-offer-draggable-item"}});e.appendChild(BX.create("SPAN",{attrs:{className:"crm-offer-drg-btn"}}));e.appendChild(BX.create("SPAN",{attrs:{className:"crm-offer-title-text"},text:this.getName()}));return e},initializeDragDropAbilities:function(){if(this._dragItem||!this._enableDrag){return}if(!this._dragButton){throw"CrmFormFieldSetting: Could not find drag button."}this._dragItem=BX.CrmFormFieldDragItem.create(this.getId(),{field:this,node:this._dragButton,contextId:this._draggableContextId,enableBin:this._enableDragDropBin,showFieldInDragMode:false,ghostOffset:{x:-8,y:-8}})},releaseDragDropAbilities:function(){if(this._dragItem){this._dragItem.release();this._dragItem=null}},isVisible:function(){return this._isVisible},setVisible:function(e){e=!!e;if(this._isVisible===e){return}this._isVisible=e;this._node.style.display=e?"":"none"},tryCompleteEdit:function(e){if(!this._editMode){return}if(!!e){var t=BX.util.trim(this._nameInput.value);if(t!==""){this._data["name"]=t}if(this._inShortListOptionEnabled){if(this._inShortListOptionCheckbox){this._data["inShortList"]=this._inShortList=this._inShortListOptionCheckbox.checked===true}}}if(this._manager.processFieldEditEnd(this)){this.enableEditMode(false)}},tryCancelEdit:function(){if(this._manager.processFieldEditCancelation(this)){this.enableEditMode(false)}},_bindEvents:function(){if(this._editButton){BX.bind(this._editButton,"click",this._editButtonClickHandler)}if(this._delButton){BX.bind(this._delButton,"click",this._deleteButtonClickHandler)}},_unbindEvents:function(){if(this._editButton){BX.unbind(this._editButton,"click",this._editButtonClickHandler)}if(this._delButton){BX.unbind(this._delButton,"click",this._deleteButtonClickHandler)}if(this._saveButton){BX.unbind(this._saveButton,"click",this._saveButtonClickHandler)}if(this._cancelButton){BX.unbind(this._cancelButton,"click",this._cancelButtonClickHandler)}},_processBooleanFieldModeChange:function(){if(this._editMode){BX.addClass(this._node,"crm-offer-new-item");this._dataWrapper.style.display="none";if(this._nameInput){this._nameInput.style.display=""}else{this._nameInput=BX.create("INPUT",{props:{type:"text",className:"crm-offer-item-inp crm-offer-label-inp",placeholder:this.getMessage("fieldNamePlaceHolder")}});this._dataWrapper.parentNode.insertBefore(this._nameInput,this._dataWrapper)}this._nameInput.value=BX.type.isNotEmptyString(this._data["name"])?this._data["name"]:this._id;this._displayInShortListOption();this._ensureEditButtonsCreated();if(this._buttonWrapper.style.display!==""){this._buttonWrapper.style.display=""}this._nameInput.focus();this._nameInput.setSelectionRange(0,this._nameInput.value.length);this._nameKeyPressHandler=BX.delegate(this._onNameKeyPress,this);BX.bind(this._nameInput,"keydown",this._nameKeyPressHandler)}else{BX.removeClass(this._node,"crm-offer-new-item");this._nameInput.style.display="none";this._buttonWrapper.style.display="none";this._dataWrapper.style.display="";this._hideInShortListOption();var e=cssQuery("label.crm-offer-label",this._dataWrapper);if(e.length>0){e[0].innerHTML=BX.util.htmlspecialchars(BX.type.isNotEmptyString(this._data["name"])?this._data["name"]:this._id)}BX.unbind(this._nameInput,"keydown",this._nameKeyPressHandler);this._nameKeyPressHandler=null}},_processAddressFieldModeChange:function(){var e=cssQuery("div.crm-offer-address-title",this._node);if(e.length===0){throw"Error: Could not find title container."}var t=e[0];e=cssQuery("div.crm-offer-addres-title-contents-wrapper",t);if(e.length===0){throw"Error: Could not find title wrapper."}var i=e[0];if(this._editMode){BX.addClass(this._node,"crm-offer-new-item");i.style.display="none";if(this._nameInput){this._nameInput.style.display=""}else{this._nameInput=BX.create("INPUT",{props:{type:"text",className:"crm-offer-item-inp",placeholder:this.getMessage("fieldNamePlaceHolder")}});t.appendChild(this._nameInput)}this._nameInput.value=BX.type.isNotEmptyString(this._data["name"])?this._data["name"]:this._id;this._displayInShortListOption();this._ensureEditButtonsCreated();if(this._buttonWrapper.style.display!==""){this._buttonWrapper.style.display=""}this._nameInput.focus();this._nameInput.setSelectionRange(0,this._nameInput.value.length);if(this._manager.getFormMode()===BX.CrmFormMode.edit){if(this._cover){this._cover.style.display=""}else{this._cover=BX.create("DIV",{props:{className:"crm-offer-disable-cover"}});this._dataWrapper.appendChild(this._cover)}}}else{this._cover.style.display="none";BX.removeClass(this._node,"crm-offer-new-item");this._nameInput.style.display="none";this._buttonWrapper.style.display="none";i.style.display="";this._hideInShortListOption();e=cssQuery("span.crm-offer-address-title-contents",i);if(e.length===0){throw"Error: Could not find title content."}e[0].innerHTML=BX.util.htmlspecialchars(BX.type.isNotEmptyString(this._data["name"])?this._data["name"]:this._id)}},_processContainerFieldModeChange:function(){var e=cssQuery("div.crm-offer-editor-title",this._node);if(e.length===0){throw"Error: Could not find title container."}var t=e[0];e=cssQuery("div.crm-offer-editor-title-contents-wapper",t);if(e.length===0){throw"Error: Could not find title wrapper."}var i=e[0];if(this._editMode){BX.addClass(this._node,"crm-offer-new-item");i.style.display="none";if(this._nameInput){this._nameInput.style.display=""}else{this._nameInput=BX.create("INPUT",{props:{type:"text",className:"crm-offer-item-inp",placeholder:this.getMessage("fieldNamePlaceHolder")}});t.appendChild(this._nameInput)}this._nameInput.value=BX.type.isNotEmptyString(this._data["name"])?this._data["name"]:this._id;this._displayInShortListOption();this._ensureEditButtonsCreated();if(this._buttonWrapper.style.display!==""){this._buttonWrapper.style.display=""}this._nameInput.focus();this._nameInput.setSelectionRange(0,this._nameInput.value.length);if(this._manager.getFormMode()===BX.CrmFormMode.edit){if(this._cover){this._cover.style.display=""}else{this._cover=BX.create("DIV",{props:{className:"crm-offer-disable-cover"}});this._dataWrapper.appendChild(this._cover)}}}else{this._cover.style.display="none";BX.removeClass(this._node,"crm-offer-new-item");this._nameInput.style.display="none";this._buttonWrapper.style.display="none";i.style.display="";this._hideInShortListOption();e=cssQuery("span.crm-offer-editor-title-contents",i);if(e.length===0){throw"Error: Could not find title content."}e[0].innerHTML=BX.util.htmlspecialchars(BX.type.isNotEmptyString(this._data["name"])?this._data["name"]:this._id)}},_processTextFieldModeChange:function(){if(this._editMode){BX.addClass(this._node,"crm-offer-new-item");this._labelWrapper.style.display="none";if(this._nameInput){this._nameInput.style.display=""}else{this._nameInput=BX.create("INPUT",{props:{type:"text",className:"crm-offer-item-inp",placeholder:this.getMessage("fieldNamePlaceHolder")}});this._labelWrapper.parentNode.insertBefore(this._nameInput,this._labelWrapper)}this._nameInput.value=BX.type.isNotEmptyString(this._data["name"])?this._data["name"]:this._id;this._displayInShortListOption();this._ensureEditButtonsCreated();if(this._buttonWrapper.style.display!==""){this._buttonWrapper.style.display=""}this._nameInput.focus();this._nameInput.setSelectionRange(0,this._nameInput.value.length);if(this._manager.getFormMode()===BX.CrmFormMode.edit){if(this._cover){this._cover.style.display=""}else{this._cover=BX.create("DIV",{props:{className:"crm-offer-disable-cover"}});this._dataWrapper.appendChild(this._cover)}}this._nameKeyPressHandler=BX.delegate(this._onNameKeyPress,this);BX.bind(this._nameInput,"keydown",this._nameKeyPressHandler)}else{if(this._cover){this._cover.style.display="none"}BX.removeClass(this._node,"crm-offer-new-item");this._nameInput.style.display="none";this._buttonWrapper.style.display="none";this._labelWrapper.style.display="";this._hideInShortListOption();var e=cssQuery("span.crm-offer-info-label",this._labelWrapper);if(e.length>0){e[0].innerHTML=BX.util.htmlspecialchars(BX.type.isNotEmptyString(this._data["name"])?this._data["name"]:this._id)}BX.unbind(this._nameInput,"keydown",this._nameKeyPressHandler);this._nameKeyPressHandler=null}},_ensureEditButtonsCreated:function(){if(this._buttonWrapper){return}this._saveButton=BX.create("SPAN",{props:{className:"webform-small-button"},children:[BX.create("SPAN",{props:{className:"webform-small-button-left"}}),BX.create("SPAN",{props:{className:"webform-small-button-text"},text:this.getMessage("saveButton")}),BX.create("SPAN",{props:{className:"webform-small-button-right"}})]});BX.bind(this._saveButton,"click",this._saveButtonClickHandler);this._cancelButton=BX.create("SPAN",{props:{className:"crm-offer-cancel-link"},text:this.getMessage("cancelButton")});BX.bind(this._cancelButton,"click",this._cancelButtonClickHandler);this._buttonWrapper=BX.create("DIV",{props:{className:"crm-offer-item-btn-wrap"},children:[this._saveButton,this._cancelButton]});this._dataWrapper.parentNode.appendChild(this._buttonWrapper)},_displayInShortListOption:function(){if(!this._inShortListOptionEnabled)return;if(!this._inShortListOptionWrapper){var e=this._id+"_inShortListCheckbox";this._inShortListOptionWrapper=BX.create("DIV",{children:[this._inShortListOptionCheckbox=BX.create("INPUT",{attrs:{id:e,type:"checkbox"},props:{checked:this._inShortList}}),BX.create("LABEL",{attrs:{"for":e},html:BX.util.htmlspecialchars(this.getMessage("inShortListOptionTitle"))})]});this._dataWrapper.parentNode.appendChild(this._inShortListOptionWrapper)}if(this._inShortListOptionWrapper.style.display!==""){this._inShortListOptionWrapper.style.display=""}},_hideInShortListOption:function(){if(this._inShortListOptionEnabled){if(this._inShortListOptionWrapper)this._inShortListOptionWrapper.style.display="none";if(this._inShortListOptionCheckbox)this._inShortListOptionCheckbox.checked=this._inShortList}},_onEditButtonClick:function(e){this.enableEditMode(true);this._manager.processFieldEditStart(this)},_onEditMenuItemClick:function(e){this._closeContextMenu();this.enableEditMode(true);this._manager.processFieldEditStart(this)},_onDeleteButtonClick:function(e){this.remove()},_onDeleteMenuItemClick:function(e){this._closeContextMenu();this.remove()},_onDeleteConfirmationButtonClick:function(e){BX.WindowManager.Get().Close();this._manager.processFieldRemove(this)},_onSaveButtonClick:function(e){this.tryCompleteEdit(true)},_onCancelButtonClick:function(e){this.tryCancelEdit()},_onNameKeyPress:function(e){if(!e){e=window.event}if(e.keyCode==13){this.tryCompleteEdit(true);return BX.eventReturnFalse(e)}else if(e.keyCode==27){this.tryCancelEdit();return BX.eventReturnFalse(e)}return true},_onContextMenu:function(e){this._openContextMenu();return BX.eventReturnFalse(e)},_openContextMenu:function(){if(this._isContextMenuShown){return}var e=BX.PopupMenu.getMenuById(this._contextMenuId);if(e){e.popupWindow.close()}var t=[];if(this._enableEdit){t.push({id:"edit",text:this.getMessage("editMenuItem"),onclick:BX.delegate(this._onEditMenuItemClick,this)})}t.push({id:"delete",text:this.getMessage("deleteMenuItem"),onclick:BX.delegate(this._onDeleteMenuItemClick,this)});this._contextMenu=BX.PopupMenu.create(this._contextMenuId,this._dragButton,t,{autoHide:true,offsetTop:0,offsetLeft:0,angle:{position:"top",offset:10},events:{onPopupClose:BX.delegate(this._onContextMenuClose,this)}});this._contextMenu.popupWindow.show();this._isContextMenuShown=true},_closeContextMenu:function(){if(this._contextMenu&&this._contextMenu.popupWindow){this._contextMenu.popupWindow.close()}},_onContextMenuClose:function(){this._contextMenu=null;if(typeof BX.PopupMenu.Data[this._contextMenuId]!=="undefined"){BX.PopupMenu.Data[this._contextMenuId].popupWindow.destroy();delete BX.PopupMenu.Data[this._contextMenuId]}this._isContextMenuShown=false}};if(typeof BX.CrmFormFieldSetting.messages==="undefined"){BX.CrmFormFieldSetting.messages={}}BX.CrmFormFieldSetting.create=function(e,t){var i=new BX.CrmFormFieldSetting;i.initialize(e,t);return i}}if(typeof BX.CrmFormSectionSetting==="undefined"){BX.CrmFormSectionSetting=function(){this._id="";this._settings=null;this._manager=null;this._data=null;this._titleNode=null;this._contentsNode=null;this._buttonsNode=null;this._addSectionButton=null;this._addFieldButton=null;this._restoreFieldButton=null;this._addFieldMenuId="";this._restoreFieldMenuId="";this._enableDrag=true;this._enableDragDropBin=true;this._draggableFieldContextId="";this._draggableSectionContextId="";this._dragButton=null;this._editButton=null;this._editMode=false;this._titleLabel=null;this._titleInput=null;this._nodeMouseOverHandler=BX.delegate(this._onNodeMouseOver,this);this._nodeMouseOutHandler=BX.delegate(this._onNodeMouseOut,this);this._addSectionButtonClickHandler=BX.delegate(this._onAddSectionButtonClick,this);this._addFieldButtonClickHandler=BX.delegate(this._onAddFieldButtonClick,this);this._restoreFieldButtonClickHandler=BX.delegate(this._onRestoreFieldButtonClick,this);this._editButtonClickHandler=BX.delegate(this._onEditButtonClick,this);this._deleteButtonClickHandler=BX.delegate(this._onDeleteButtonClick,this);this._documentClickHandler=BX.delegate(this._onDocumentClick,this);this._titleKeyPressHandler=BX.delegate(this._onTitleKeyPress,this);this._addFieldMenu=null;this._isAddFieldMenuShown=false;this._restoreFieldMenu=null;this._isRestoreFieldMenuShown=false;this._mouseTimeoutId=0;this._isMouseOver=false;this._isVisible=true;this._isFieldsVisible=true;this._isButtonsVisible=true;this._placeHolder=null;this._dragContainer=null;this._dragItem=null;this._contextMenuHandler=BX.delegate(this._onContextMenu,this);this._contextMenuId="";this._isContextMenuShown=false;this._isTemporary=false;this._canCreateSection=false;this._canCreateUserField=false;this._canRestoreField=false};BX.CrmFormSectionSetting.prototype={initialize:function(e,t){if(!BX.type.isNotEmptyString(e)){throw"Error: The 'id' argument is not defined or empty."}this._id=e;this._settings=t?t:{};this._isTemporary=this.getSetting("isTemporary",false);this._manager=this.getSetting("manager");if(!(this._manager instanceof BX.CrmFormSettingManager)){throw"Error: The 'manager' argument must be CrmFormSettingManager instance."}this._data=this.getSetting("data");if(!BX.type.isPlainObject(this._data)){throw"Error: The 'data' parameter is not found in settings."}this._contentsNode=this._manager.getSectionNode(e);if(!BX.type.isElementNode(this._contentsNode)){throw"Error: Could not find section contents node."}var i=cssQuery("div.crm-offer-title",this._contentsNode);if(i.length>0){this._titleNode=i[0]}else{throw"Error: Could not find section title node."}if(this._isTemporary){this._titleNode.style.display="none"}this._canCreateSection=this.getSetting("canCreateSection",this._manager.canCreateSection());this._canCreateUserField=!this._isTemporary&&this.getSetting("canCreateUserField",this._manager.canCreateUserField());this._canRestoreField=!this._isTemporary&&this.getSetting("canRestoreField",this._manager.hasHiddenFields());this._buttonsNode=this._manager.getSectionButtonWrapperNode(e);if(!BX.type.isElementNode(this._buttonsNode)){throw"Error: Could not find section buttons node."}this._addSectionButton=this._manager.getSectionButtonNode(e,"add_section");if(this._canCreateSection&&!BX.type.isElementNode(this._addSectionButton)){throw"Error: Could not find section 'Add Section' button."}this._addFieldButton=this._manager.getSectionButtonNode(e,"add_field");if(this._canCreateUserField&&!BX.type.isElementNode(this._addFieldButton)){throw"Error: Could not find section 'Add Field' button."}this._restoreFieldButton=this._manager.getSectionButtonNode(e,"restore_field");if(this._canRestoreField&&!BX.type.isElementNode(this._restoreFieldButton)){throw"Error: Could not find section 'Show Field' button."}this._addFieldMenuId=this._manager.resolveNodeId(e,"add_field_menu");this._restoreFieldMenuId=this._manager.resolveNodeId(e,"restore_field_menu");i=cssQuery("span.crm-offer-drg-btn",this._contentsNode);if(i.length>0){this._dragButton=i[0];this._contextMenuId=this._id.toLowerCase()+"_context_menu";BX.bind(this._dragButton,"contextmenu",this._contextMenuHandler)}if(!BX.type.isElementNode(this._dragButton)){throw"Error: Could not find section 'Drag' button."}this._editButton=this._manager.getSectionButtonNode(e,"edit");this._enableEdit=!!this._editButton;this._deleteButton=this._manager.getSectionButtonNode(e,"delete");if(!BX.type.isElementNode(this._deleteButton)){throw"Error: Could not find section 'Delete' button."}i=cssQuery("span.crm-offer-title-text",this._titleNode);if(i.length===0){throw"Error: Could not find title label."}this._titleLabel=i[0];this._enableDrag=this.getSetting("enableDrag",true);this._enableDragDropBin=this.getSetting("enableDragDropBin",true);this._draggableFieldContextId=this.getSetting("draggableFieldContextId","");this._draggableSectionContextId=this.getSetting("draggableSectionContextId","");this.initializeDragDropAbilities();this._bindEvents();this._editMode=!this._isTemporary&&this.getSetting("editMode",false);if(this._editMode){if(this._editMode=this._manager.processSectionEditStart(this)){this.enableEditMode(true,true)}}},release:function(e){this._unbindEvents();if(this._editMode){this._enableDocumentClick(false);BX.unbind(this._titleInput,"keydown",this._titleKeyPressHandler)}if(e&&this._contentsNode){this._contentsNode=BX.remove(this._contentsNode)}},getSetting:function(e,t){return this._settings.hasOwnProperty(e)?this._settings[e]:t},getId:function(){return this._id},getName:function(){return BX.type.isNotEmptyString(this._data["name"])?this._data["name"]:this._id},getManager:function(){return this._manager},getTitleNode:function(){return this._titleNode},getContentsNode:function(){return this._contentsNode},getData:function(){return this._data},getAssociatedField:function(){return BX.type.isPlainObject(this._data["associatedField"])?this._data["associatedField"]:null},getMessage:function(e){var t=BX.CrmFormSectionSetting.messages;return t.hasOwnProperty(e)?t[e]:e},isTemporary:function(){return this._isTemporary},enableEditMode:function(e,t){if(this._isTemporary){return}e=!!e;t=!!t;if(this._editMode===e&&!t){return}this._editMode=e;if(this._editMode){this._titleLabel.style.display="none";if(this._titleInput){this._titleInput.style.display=""}else{this._titleInput=BX.create("INPUT",{props:{type:"text",className:"crm-item-table-inp",placeholder:this.getMessage("sectionTitlePlaceHolder")}});this._titleInput.value=BX.type.isNotEmptyString(this._data["name"])?this._data["name"]:this._id;this._titleNode.insertBefore(this._titleInput,this._titleLabel)}this._titleInput.focus();this._titleInput.setSelectionRange(0,this._titleInput.value.length);this._enableDocumentClick(true);BX.bind(this._titleInput,"keydown",this._titleKeyPressHandler)}else{var i=BX.type.isNotEmptyString(this._data["name"])?this._data["name"]:"";if(this._titleInput.value!==i){this._titleInput.value=i}this._titleLabel.innerHTML=BX.util.htmlspecialchars(i!==""?i:this._id);this._titleInput.style.display="none";this._titleLabel.style.display="";this._enableDocumentClick(false);BX.unbind(this._titleInput,"keydown",this._titleKeyPressHandler)}},getFields:function(){var e=[];var t=this._manager.getSectionFieldIds(this._id);for(var i=0;i<t.length;i++){var n=this._manager.getField(t[i]);if(n){e.push(n)}}return e},setVisible:function(e){e=!!e;if(this._isVisible===e){return}this._isVisible=e;this._contentsNode.style.display=e?"":"none"},setFieldsVisible:function(e){e=!!e;if(this._isFieldsVisible===e){return}this._isFieldsVisible=e;var t=this._manager.getSectionFieldIds(this._id);for(var i=0;i<t.length;i++){var n=this._manager.getField(t[i]);if(n){n.setVisible(e)}}},setButtonsVisible:function(e){e=!!e;if(this._isButtonsVisible===e){return}this._isButtonsVisible=e;this._buttonsNode.style.display=e?"":"none"},processFieldRemove:function(e){if(!this._isTemporary){this._canRestoreField=this.getSetting("canRestoreField",this._manager.hasHiddenFields())}},createGhostNode:function(){var e=BX.create("DIV",{attrs:{className:"crm-offer-draggable-item"}});e.appendChild(BX.create("SPAN",{attrs:{className:"crm-offer-drg-btn"}}));e.appendChild(BX.create("SPAN",{attrs:{className:"crm-offer-title-text"},text:this.getName()}));return e},initializeDragDropAbilities:function(){if(!this._dragContainer){this._dragContainer=BX.CrmFormFieldDragContainer.create(this.getId(),{section:this,node:this._contentsNode,contextId:this._draggableFieldContextId,priority:this._manager.getDragPriority()});this._dragContainer.addDragFinishListener(this._manager.getFieldDropCallback())}if(this._enableDrag&&!this._dragItem){this._dragItem=BX.CrmFormSectionDragItem.create(this.getId(),{section:this,node:this._dragButton,contextId:this._draggableSectionContextId,enableBin:this._enableDragDropBin,showSectionInDragMode:false,showFieldsInDragMode:false})}},releaseDragDropAbilities:function(){if(this._dragContainer){this._dragContainer.removeDragFinishListener(this._itemDropHandler);this._dragContainer.release();this._dragContainer=null}if(this._dragItem){this._dragItem.release();this._dragItem=null}},createPlaceHolder:function(e){var t=e["fields"];var i=e["id"];var n=e["index"];var r=t.length;var s=n;if(n>=0){s=n+1}else{s=r+1}if(this._placeHolder){if(this._placeHolder.getFieldIndex()===n){return this._placeHolder}this._contentsNode.deleteRow(this._placeHolder.getNode().rowIndex);this._placeHolder=null}this._placeHolder=BX.CrmFormFieldPlaceholder.create({section:this,node:this._contentsNode.insertRow(s),fieldId:i,fieldIndex:n});this._placeHolder.layout();return this._placeHolder},getPlaceHolder:function(){return this._placeHolder},removePlaceHolder:function(){if(this._placeHolder){this._contentsNode.deleteRow(this._placeHolder.getNode().rowIndex);this._placeHolder=null}},remove:function(){var e=new BX.CDialog({title:this.getMessage("sectionDeleteDlgTitle"),head:"",content:this.getMessage("sectionDeleteDlgContent"),resizable:false,draggable:true,height:70,width:300});e.ClearButtons();e.SetButtons([{title:this.getMessage("deleteButton"),id:"delete",action:BX.delegate(this._onDeleteConfirmationButtonClick,this)},BX.CDialog.btnCancel]);e.Show()},_bindEvents:function(){BX.bind(this._titleNode,"mouseover",this._nodeMouseOverHandler);BX.bind(this._titleNode,"mouseout",this._nodeMouseOutHandler);BX.bind(this._contentsNode,"mouseover",this._nodeMouseOverHandler);BX.bind(this._contentsNode,"mouseout",this._nodeMouseOutHandler);if(this._addSectionButton){BX.bind(this._addSectionButton,"click",this._addSectionButtonClickHandler)}if(this._addFieldButton){BX.bind(this._addFieldButton,"click",this._addFieldButtonClickHandler)}if(this._restoreFieldButton){BX.bind(this._restoreFieldButton,"click",this._restoreFieldButtonClickHandler)}BX.bind(this._editButton,"click",this._editButtonClickHandler);BX.bind(this._deleteButton,"click",this._deleteButtonClickHandler)},_unbindEvents:function(){BX.unbind(this._titleNode,"mouseover",this._nodeMouseOverHandler);BX.unbind(this._titleNode,"mouseout",this._nodeMouseOutHandler);BX.unbind(this._contentsNode,"mouseover",this._nodeMouseOverHandler);BX.unbind(this._contentsNode,"mouseout",this._nodeMouseOutHandler);if(this._addSectionButton){BX.unbind(this._addSectionButton,"click",this._addSectionButtonClickHandler)}if(this._addFieldButton){BX.unbind(this._addFieldButton,"click",this._addFieldButtonClickHandler)}if(this._restoreFieldButton){BX.unbind(this._restoreFieldButton,"click",this._restoreFieldButtonClickHandler)}BX.unbind(this._editButton,"click",this._editButtonClickHandler);BX.unbind(this._deleteButton,"click",this._deleteButtonClickHandler)},_enableDocumentClick:function(e){if(e){var t=this;window.setTimeout(function(){BX.bind(document,"click",t._documentClickHandler)},0)}else{BX.unbind(document,"click",this._documentClickHandler)}},_onAddFieldMenuItemClick:function(e,t){this._closeAddFieldMenu();var i=BX.type.isNotEmptyString(t["id"])?t["id"]:"";if(i==="addSection"){this._manager.createSection(this);return}var n="string";if(i==="addDoubleField"){n="double"}else if(i==="addBooleanField"){n="boolean"}else if(i==="addDatetimeField"){n="datetime"}this._manager.createTemporaryField(n,this)},_openAddFieldMenu:function(){if(this._isAddFieldMenuShown){return}var e=this._manager.canCreateUserField();if(!e){return}var t=BX.delegate(this._onAddFieldMenuItemClick,this);var i=[];if(e){i.push({id:"addStringField",className:"crm-offer-popup-item menu-popup-no-icon",text:this.getMessage("createTextFiledMenuItem"),onclick:t});i.push({id:"addDoubleField",className:"crm-offer-popup-item menu-popup-no-icon",text:this.getMessage("createDoubleFiledMenuItem"),onclick:t});i.push({id:"addBooleanField",className:"crm-offer-popup-item menu-popup-no-icon",text:this.getMessage("createBooleanFiledMenuItem"),onclick:t});i.push({id:"addDatetimeField",className:"crm-offer-popup-item menu-popup-no-icon",text:this.getMessage("createDatetimeFiledMenuItem"),onclick:t});i.push({id:"addDatetimeField",className:"crm-offer-popup-item menu-popup-no-icon",text:this.getMessage("createDatetimeFiledMenuItem"),onclick:t})}if(typeof BX.PopupMenu.Data[this._addFieldMenuId]!=="undefined"){BX.PopupMenu.Data[this._addFieldMenuId].popupWindow.destroy();delete BX.PopupMenu.Data[this._addFieldMenuId]}if(typeof BX.PopupMenu.Data[this._restoreFieldMenuId]!=="undefined"){BX.PopupMenu.Data[this._restoreFieldMenuId].popupWindow.destroy();delete BX.PopupMenu.Data[this._restoreFieldMenuId];this._restoreFieldMenu=null;this._isRestoreFieldMenuShown=false}this._addFieldMenu=BX.PopupMenu.currentItem=BX.PopupMenu.create(this._addFieldMenuId,this._addFieldButton,i,{closeByEsc:true,autoHide:true,offsetTop:0,offsetLeft:0,angle:{position:"top",offset:10},events:{onPopupClose:BX.delegate(this._onAddFieldMenuClose,this)}});this._addFieldMenu.popupWindow.show();this._isAddFieldMenuShown=true},_closeAddFieldMenu:function(){if(this._addFieldMenu&&this._addFieldMenu.popupWindow){this._addFieldMenu.popupWindow.close()}},_openRestoreFieldMenu:function(){if(this._isRestoreFieldMenuShown){return}var e=[];var t=this._manager.getHiddenFieldInfos();if(t.length===0){return}for(var i=0;i<t.length;i++){var n=t[i];e.push({id:n["id"],className:"crm-offer-popup-item menu-popup-no-icon",text:n["name"],onclick:BX.delegate(this._onRestoreFieldMenuItemClick,this)})}if(typeof BX.PopupMenu.Data[this._addFieldMenuId]!=="undefined"){BX.PopupMenu.Data[this._addFieldMenuId].popupWindow.destroy();delete BX.PopupMenu.Data[this._addFieldMenuId];this._addFieldMenu=null;this._isAddFieldMenuShown=false}if(typeof BX.PopupMenu.Data[this._restoreFieldMenuId]!=="undefined"){BX.PopupMenu.Data[this._restoreFieldMenuId].popupWindow.destroy();delete BX.PopupMenu.Data[this._restoreFieldMenuId]}var r=BX.PopupMenu.getCurrentMenu();if(r){BX.PopupMenu.destroy(r.id)}this._restoreFieldMenu=BX.PopupMenu.currentItem=BX.PopupMenu.create(this._restoreFieldMenuId,this._restoreFieldButton,e,{offsetTop:0,offsetLeft:0,angle:{position:"top",offset:10},events:{onPopupClose:BX.delegate(this._onRestoreFieldMenuClose,this)}});this._restoreFieldMenu.popupWindow.show();this._isRestoreFieldMenuShown=true},_onNodeMouseOver:function(e){this._isMouseOver=true;if(this._mouseTimeoutId!==null){window.clearInterval(this._mouseTimeoutId);this._mouseTimeoutId=null}var t=this._canCreateSection||this._canCreateUserField;var i=this._canRestoreField;if(!t&&!i){return}if(this._addFieldButton){this._addFieldButton.style.display=t?"":"none"}if(this._restoreFieldButton){this._restoreFieldButton.style.display=i?"":"none"}var n=this;this._mouseTimeoutId=window.setTimeout(function(){if(n._mouseTimeoutId!=null){n._mouseTimeoutId=null;var e=n._buttonsNode;if(e.style.visibility!=="visible"){e.style.visibility="visible"}}},300)},_onNodeMouseOut:function(e){this._isMouseOver=false;

if(this._isAddFieldMenuShown||this._isRestoreFieldMenuShown){return}if(this._mouseTimeoutId!==null){window.clearInterval(this._mouseTimeoutId);this._mouseTimeoutId=null}var t=this;this._mouseTimeoutId=window.setTimeout(function(){if(t._mouseTimeoutId!=null){t._mouseTimeoutId=null;var e=t._buttonsNode;if(e.style.visibility!=="hidden"){e.style.visibility="hidden"}}},300)},_onDocumentClick:function(e){if(!e){e=window.event}var t=BX.getEventTarget(e);if(t&&this._titleInput===t){return}if(!this._editMode){BX.unbind(document,"click",this._documentClickHandler)}else{this.tryCompleteEdit(true)}},tryCompleteEdit:function(e){if(!this._editMode){return}if(!!e){var t=BX.util.trim(this._titleInput.value);if(t!==""){this._data["name"]=t}}if(this._manager.processSectionEditEnd(this)){this.enableEditMode(false)}},_onTitleKeyPress:function(e){if(!e){e=window.event}if(e.keyCode==13){this.tryCompleteEdit(true);return BX.eventReturnFalse(e)}else if(e.keyCode==27){this.tryCompleteEdit(false);return BX.eventReturnFalse(e)}return true},_onEditButtonClick:function(e){if(!this._editMode&&this._manager.processSectionEditStart(this)){this.enableEditMode(true)}},_onEditMenuItemClick:function(e){this._closeContextMenu();this.enableEditMode(true);this._manager.processFieldEditStart(this)},_onDeleteButtonClick:function(e){this.remove()},_onDeleteMenuItemClick:function(e){this._closeContextMenu();this.remove()},_onDeleteConfirmationButtonClick:function(e){BX.WindowManager.Get().Close();this._manager.processSectionRemove(this)},_onAddSectionButtonClick:function(e){if(!e){e=window.event}this._manager.createSection(this);return BX.PreventDefault(e)},_onAddFieldButtonClick:function(e){if(!e){e=window.event}this._openAddFieldMenu();return BX.PreventDefault(e)},_onRestoreFieldButtonClick:function(e){if(!e){e=window.event}this._openRestoreFieldMenu();return BX.PreventDefault(e)},_onAddFieldMenuClose:function(){this._addFieldMenu=null;if(typeof BX.PopupMenu.Data[this._addFieldMenuId]!=="undefined"){BX.PopupMenu.Data[this._addFieldMenuId].popupWindow.destroy();delete BX.PopupMenu.Data[this._addFieldMenuId]}this._isAddFieldMenuShown=false;if(!this._isMouseOver&&this._buttonsNode.style.visibility!=="hidden"){this._buttonsNode.style.visibility="hidden"}},_onRestoreFieldMenuItemClick:function(e,t){var i=BX.type.isNotEmptyString(t["id"])?t["id"]:"";if(i!==""){this._restoreFieldMenu.popupWindow.close();this._manager.restoreField(i,this._id)}},_onRestoreFieldMenuClose:function(){this._restoreFieldMenu=null;if(typeof BX.PopupMenu.Data[this._restoreFieldMenuId]!=="undefined"){BX.PopupMenu.Data[this._restoreFieldMenuId].popupWindow.destroy();delete BX.PopupMenu.Data[this._restoreFieldMenuId]}this._isRestoreFieldMenuShown=false;if(!this._isMouseOver&&this._buttonsNode.style.visibility!=="hidden"){this._buttonsNode.style.visibility="hidden"}},_onContextMenu:function(e){this._openContextMenu();return BX.eventReturnFalse(e)},_openContextMenu:function(){if(this._isContextMenuShown){return}var e=[];if(this._enableEdit){e.push({id:"edit",text:this.getMessage("editMenuItem"),onclick:BX.delegate(this._onEditMenuItemClick,this)})}e.push({id:"delete",text:this.getMessage("deleteMenuItem"),onclick:BX.delegate(this._onDeleteMenuItemClick,this)});this._contextMenu=BX.PopupMenu.create(this._contextMenuId,this._dragButton,e,{autoHide:true,offsetTop:0,offsetLeft:0,angle:{position:"top",offset:10},events:{onPopupClose:BX.delegate(this._onContextMenuClose,this)}});this._contextMenu.popupWindow.show();this._isContextMenuShown=true},_closeContextMenu:function(){if(this._contextMenu&&this._contextMenu.popupWindow){this._contextMenu.popupWindow.close()}},_onContextMenuClose:function(){this._contextMenu=null;if(typeof BX.PopupMenu.Data[this._contextMenuId]!=="undefined"){BX.PopupMenu.Data[this._contextMenuId].popupWindow.destroy();delete BX.PopupMenu.Data[this._contextMenuId]}this._isContextMenuShown=false}};if(typeof BX.CrmFormSectionSetting.messages==="undefined"){BX.CrmFormSectionSetting.messages={}}BX.CrmFormSectionSetting.create=function(e,t){var i=new BX.CrmFormSectionSetting;i.initialize(e,t);return i}}if(typeof BX.CrmFormUserFieldManager==="undefined"){BX.CrmFormUserFieldManager=function(){this._id="";this._settings=null;this._canCreate=false;this._entityId="";this._manager=null;this._pendingData=null;this._data={};this._fields={}};BX.CrmFormUserFieldManager.prototype={initialize:function(e,t){this._id=BX.type.isNotEmptyString(e)?e:BX.util.getRandomString(8);this._settings=t?t:{};this._entityId=this.getSetting("entityId","");if(!BX.type.isNotEmptyString(this._entityId)){throw"Error: The 'entityId' parameter is not defined in settings or empty."}this._canCreate=this.getSetting("canCreate",false);this._manager=this.getSetting("manager",null)},release:function(){},getSetting:function(e,t){return this._settings.hasOwnProperty(e)?this._settings[e]:t},getId:function(){return this._id},canCreate:function(){return this._canCreate},createField:function(e,t,i){if(!this._canCreate){throw"Error: User is not authorized to create user fields."}if(!BX.type.isPlainObject(e)){throw"Error: The 'params' argument must be a plain object."}var n=BX.type.isNotEmptyString(e["name"])?e["name"]:"";if(n===""){throw"Error: The 'name' parameter is not defined in params or empty."}var r=BX.type.isNotEmptyString(e["type"])?e["type"]:"";if(r===""){r="string"}else if(r!=="string"&&r!=="double"&&r!=="boolean"&&r!=="datetime"){throw"Error: Type '"+r+"' is not supported in current context."}var s={USER_TYPE_ID:r,ENTITY_ID:this._entityId,MULTIPLE:"N",MANDATORY:"N",SHOW_FILTER:"Y",EDIT_FORM_LABEL:n};this._pendingData={fieldData:s,temporaryId:BX.type.isNotEmptyString(t)?t:"",callback:BX.type.isFunction(i)?i:null};this._beginCreateField()},createTemporaryField:function(e){if(!BX.type.isPlainObject(e)){throw"Error: The 'params' argument must be a plain object."}var t=BX.util.getRandomString(8);e["name"]=t;var i=this._prepareFieldData(e);return BX.CrmFormUserField.create(t,{manager:this,fieldData:i})},getImagePath:function(){return this.getSetting("imagePath","/bitrix/js/main/core/images/")},getServerTime:function(){return this.getSetting("serverTime","")},getManager:function(){return this._manager},_prepareFieldData:function(e){if(!BX.type.isPlainObject(e)){throw"Error: The 'params' argument must be a plain object."}var t=BX.type.isNotEmptyString(e["type"])?e["type"]:"";if(t===""){t="string"}else if(t!=="string"&&t!=="double"&&t!=="boolean"&&t!=="datetime"){throw"Error: Type '"+t+"' is not supported in current context."}var i=BX.type.isNotEmptyString(e["name"])?e["name"]:"";if(i===""){throw"Error: The 'name' parameter is not defined in params or empty."}var n=BX.type.isNotEmptyString(e["label"])?e["label"]:"";if(n===""){throw"Error: The 'label' parameter is not defined in params or empty."}return{FIELD_NAME:i,USER_TYPE_ID:t,ENTITY_ID:this._entityId,MULTIPLE:"N",MANDATORY:"N",SHOW_FILTER:"Y",EDIT_FORM_LABEL:n}},_beginCreateField:function(){var e=this.getSetting("serviceUrl","");if(!BX.type.isNotEmptyString(e)){throw"Error: Could not find 'serviceUrl' parameter in settings."}BX.ajax({url:e,method:"POST",dataType:"json",data:{ACTION:"ADD_FIELD",DATA:this._pendingData["fieldData"]},onsuccess:BX.delegate(this._onCreateFieldRequestSuccess,this),onfailure:BX.delegate(this._onCreateFieldRequestFailure,this)})},_onCreateFieldRequestSuccess:function(e){var t=BX.type.isNotEmptyString(e["ERROR"])?e["ERROR"]:"";if(t!==""){alert(t);return}var i=BX.type.isPlainObject(e["RESULT"])?e["RESULT"]:{};var n=this._pendingData["fieldData"];var r=n["ID"]=BX.type.isNotEmptyString(i["ID"])?i["ID"]:"";if(!BX.type.isNotEmptyString(r)){throw"Error: Could not find 'ID' in action result."}var s=n["FIELD_NAME"]=BX.type.isNotEmptyString(i["FIELD_NAME"])?i["FIELD_NAME"]:"";if(!BX.type.isNotEmptyString(s)){throw"Error: Could not find 'FIELD_NAME' in action result."}this._data[s]=n;var o=BX.CrmFormUserField.create(s,{manager:this,fieldData:n});this._fields[s]=o;if(this._pendingData["callback"]){this._pendingData["callback"](this,this._pendingData["temporaryId"],o)}this._pendingData=null},_onCreateFieldRequestFailure:function(e){this._pendingData=null;alert("Could not create user field.")}};BX.CrmFormUserFieldManager.items={};BX.CrmFormUserFieldManager.create=function(e,t){var i=new BX.CrmFormUserFieldManager;i.initialize(e,t);this.items[i.getId()]=i;return i}}if(typeof BX.CrmFormUserField==="undefined"){BX.CrmFormUserField=function(){this._id="";this._fieldData=null;this._settings=null;this._manager=this;this._userTypeId="";this._fieldName="";this._label="";this._elements={}};BX.CrmFormUserField.prototype={initialize:function(e,t){this._id=BX.type.isNotEmptyString(e)?e:BX.util.getRandomString(8);this._settings=t?t:{};this._fieldData=this.getSetting("fieldData",null);if(!BX.type.isPlainObject(this._fieldData)){throw"Error: The 'fieldData' parameter is not found in settings."}this._userTypeId=this.getParam("USER_TYPE_ID");if(!BX.type.isNotEmptyString(this._userTypeId)){throw"Error: The 'USER_TYPE_ID' parameter is not found in field data."}this._fieldName=this.getParam("FIELD_NAME");if(!BX.type.isNotEmptyString(this._fieldName)){throw"Error: The 'FIELD_NAME' parameter is not found in field data."}this._label=this.getParam("EDIT_FORM_LABEL");if(!BX.type.isNotEmptyString(this._label)){this._label=this._fieldName}this._manager=this.getSetting("manager",null);if(!this._manager){throw"Error: The 'manager' parameter is not found in settings."}},getSetting:function(e,t){return this._settings.hasOwnProperty(e)?this._settings[e]:t},getId:function(){return this._id},getParam:function(e){return BX.type.isNotEmptyString(this._fieldData[e])?this._fieldData[e]:""},getUserTypeId:function(){return this._userTypeId},getFieldName:function(){return this._fieldName},getFieldLabel:function(){return this._label},isNeedTitle:function(){return this._userTypeId!=="boolean"},prepareLayout:function(){if(this._userTypeId==="string"){return this._prepareStringFieldLayout()}else if(this._userTypeId==="double"){return this._prepareDoubleFieldLayout()}else if(this._userTypeId==="boolean"){return this._prepareBooleanFieldLayout()}else if(this._userTypeId==="datetime"){return this._prepareDatetimeFieldLayout()}return null},_prepareStringFieldLayout:function(){this._elements["value"]=BX.create("INPUT",{props:{className:"crm-offer-item-inp",type:"text",name:this._fieldName,size:30,value:""}});return[this._elements["value"]]},_prepareDoubleFieldLayout:function(){this._elements["value"]=BX.create("INPUT",{props:{className:"crm-offer-item-inp",type:"text",name:this._fieldName,size:30,value:""}});return[this._elements["value"]]},_prepareBooleanFieldLayout:function(){this._elements["value"]=BX.create("INPUT",{props:{type:"hidden",name:this._fieldName,value:"N"}});var e=this._fieldName.toLowerCase()+"_chbx";this._elements["checkbox"]=BX.create("INPUT",{props:{id:e,name:this._fieldName,type:"checkbox",className:"crm-offer-checkbox",value:"Y"}});this._elements["label"]=BX.create("LABEL",{props:{className:"crm-offer-label"},attrs:{"for":e},text:this._label});return[this._elements["value"],this._elements["checkbox"],this._elements["label"]]},_prepareDatetimeFieldLayout:function(){this._elements["value"]=BX.create("INPUT",{props:{className:"crm-offer-item-inp crm-item-table-date",type:"text",id:this._fieldName,name:this._fieldName,value:""}});BX.bind(this._elements["value"],"click",BX.delegate(this._onDateTimeIconClick,this));return[this._elements["value"]]},_onDateTimeIconClick:function(e){BX.calendar({node:this._elements["value"],field:this._fieldName,bTime:true,serverTime:this._manager.getServerTime(),bHideTimebar:false})}};BX.CrmFormUserField.create=function(e,t){var i=new BX.CrmFormUserField;i.initialize(e,t);return i}}if(typeof BX.CrmFormFieldRenderer==="undefined"){BX.CrmFormFieldRenderer=function(){};BX.CrmFormFieldRenderer.renderUserFieldRow=function(e,t,i){if(!BX.type.isElementNode(t)){throw"Error: The 'table' argument must be DOM element."}var n=BX.type.isNotEmptyString(i["prefix"])?i["prefix"]:"";var r=BX.type.isNumber(i["index"])&&i["index"]>0?i["index"]:-1;var s=BX.type.isBoolean(i["enableDrag"])?i["enableDrag"]:true;var o=e.getFieldName();if(n!==""){n+="_"}n+=o.toLowerCase();var a=t.insertRow(r);a.id=n+"_wrap";a.className="crm-offer-row";var d=a.insertCell(-1);d.className="crm-offer-info-drg-btn";if(!s){d.style.display="none"}d.appendChild(BX.create("SPAN",{props:{className:"crm-offer-drg-btn"}}));d=a.insertCell(-1);d.className="crm-offer-info-left";d.appendChild(BX.create("DIV",{props:{className:"crm-offer-info-label-wrap"},children:[BX.create("SPAN",{props:{className:"crm-offer-info-label-alignment"}}),BX.create("SPAN",{props:{className:"crm-offer-info-label"},text:e.isNeedTitle()?e.getFieldLabel()+":":""})]}));d=a.insertCell(-1);d.className="crm-offer-info-right";d.appendChild(BX.create("DIV",{props:{className:"crm-offer-info-data-wrap"},children:e.prepareLayout()}));d=a.insertCell(-1);d.className="crm-offer-info-right-btn";d.appendChild(BX.create("SPAN",{props:{className:"crm-offer-item-del"}}));d.appendChild(BX.create("SPAN",{props:{className:"crm-offer-item-edit"}}));d=a.insertCell(-1);d.className="crm-offer-last-td";return a};BX.CrmFormFieldRenderer.renderSectionTable=function(e,t){var i=BX.type.isBoolean(t["canCreateSection"])?t["canCreateSection"]:false;var n=BX.type.isBoolean(t["canCreateUserField"])?t["canCreateUserField"]:false;var r=BX.type.isBoolean(t["canRestoreField"])?t["canRestoreField"]:true;var s=BX.type.isNotEmptyString(t["prefix"])?t["prefix"]:"";var o=e["id"];if(s!==""){s+="_"}s+=o.toLowerCase();var a=e["name"];var d=[];var l=BX.create("TABLE",{props:{id:s+"_contents",className:"crm-offer-info-table"}});var h=l.insertRow(-1);h.id=o;var u=h.insertCell(-1);u.setAttribute("colspan","5");u.appendChild(BX.create("DIV",{props:{className:"crm-offer-title"},children:[BX.create("SPAN",{props:{className:"crm-offer-drg-btn"}}),BX.create("SPAN",{props:{className:"crm-offer-title-text"},text:a}),BX.create("SPAN",{props:{className:"crm-offer-title-set-wrap"},text:a,children:[BX.create("SPAN",{props:{id:s+"_edit",className:"crm-offer-title-edit"}}),BX.create("SPAN",{props:{id:s+"_delete",className:"crm-offer-title-del"}})]})]}));h=l.insertRow(-1);h.id=s+"_buttons";h.style.visibility="hidden";u=h.insertCell(-1);u.className="crm-offer-info-drg-btn";u=h.insertCell(-1);u.className="crm-offer-info-left";u=h.insertCell(-1);u.className="crm-offer-info-right";if(n){d.push(BX.create("SPAN",{props:{id:s+"_add_field",className:"crm-offer-info-link"},text:this.getMessage("addFieldButton")}))}if(i){d.push(BX.create("SPAN",{props:{id:s+"_add_section",className:"crm-offer-info-link"},text:this.getMessage("addSectionButton")}))}if(r){d.push(BX.create("SPAN",{props:{id:s+"_restore_field",className:"crm-offer-info-link"},text:this.getMessage("restoreFieldButton")}))}u.appendChild(BX.create("DIV",{props:{className:"crm-offer-item-link-wrap"},children:d}));u=h.insertCell(-1);u.className="crm-offer-info-right-btn";u=h.insertCell(-1);u.className="crm-offer-last-td";var c=BX.type.isElementNode(t["anchorNode"])?t["anchorNode"]:null;var f=BX.type.isElementNode(t["containerNode"])?t["containerNode"]:null;var _=BX.type.isNumber(t["index"])&&t["index"]>0?t["index"]:-1;if(c){var g=BX.findNextSibling(c,{tagName:"TABLE",className:"crm-offer-info-table"});if(g){g.parentNode.insertBefore(l,g)}else{c.parentNode.appendChild(l)}}else if(f){if(_<0){f.appendChild(l)}else{f.insertBefore(l,f.children[_])}}else{throw"CrmFormFieldRenderer: Container node is not defined."}return l};BX.CrmFormFieldRenderer.getMessage=function(e){var t=BX.CrmFormFieldRenderer.messages;return t.hasOwnProperty(e)?t[e]:e};if(typeof BX.CrmFormFieldRenderer.messages==="undefined"){BX.CrmFormFieldRenderer.messages={}}}if(typeof BX.CrmFormFieldPlaceholder==="undefined"){BX.CrmFormFieldPlaceholder=function(){this._settings=null;this._node=null;this._section=null;this._fieldId="";this._fieldIndex=-1};BX.CrmFormFieldPlaceholder.prototype={initialize:function(e){this._settings=e?e:{};this._node=this.getSetting("node",null);this._section=this.getSetting("section",null);this._fieldId=this.getSetting("fieldId","");this._fieldIndex=parseInt(this.getSetting("fieldIndex",-1))},getSetting:function(e,t){return this._settings.hasOwnProperty(e)?this._settings[e]:t},getNode:function(){return this._node},setNode:function(e){this._node=e},getFieldId:function(){return this._fieldId},getFieldIndex:function(){return this._fieldIndex},layout:function(){if(!this._node){throw"CrmFormFieldPlaceholder: The 'node' is not assigned."}var e=this._node;var t=e.insertCell(-1);t.className="crm-offer-table-cap crm-offer-target-place";t.colSpan=5}};BX.CrmFormFieldPlaceholder.create=function(e){var t=new BX.CrmFormFieldPlaceholder;t.initialize(e);return t}}if(typeof BX.CrmFormSectionPlaceholder==="undefined"){BX.CrmFormSectionPlaceholder=function(){this._settings=null;this._node=null;this._manager=null;this._sectionId="";this._sectionIndex=-1};BX.CrmFormSectionPlaceholder.prototype={initialize:function(e){this._settings=e?e:{};this._node=this.getSetting("node",null);this._manager=this.getSetting("manager",null);this._sectionId=this.getSetting("sectionId","");this._sectionIndex=parseInt(this.getSetting("sectionIndex",-1))},getSetting:function(e,t){return this._settings.hasOwnProperty(e)?this._settings[e]:t},getNode:function(){return this._node},setNode:function(e){this._node=e},getSectionId:function(){return this._sectionId},getSectionIndex:function(){return this._sectionIndex},layout:function(){if(!this._node){throw"CrmFormSectionPlaceholder: The 'node' is not assigned."}var e=this._node;var t=e.insertRow(-1);var i=t.insertCell(-1);i.className="crm-offer-table-cap crm-offer-target-place";i.colSpan=5}};BX.CrmFormSectionPlaceholder.create=function(e){var t=new BX.CrmFormSectionPlaceholder;t.initialize(e);return t}}if(typeof BX.CrmFormFieldDragItem==="undefined"){BX.CrmFormFieldDragItem=function(){BX.CrmFormFieldDragItem.superclass.constructor.apply(this);this._field=null;this._showFieldInDragMode=true;this._contextId="";this._enableBin=true};BX.extend(BX.CrmFormFieldDragItem,BX.CrmCustomDragItem);BX.CrmFormFieldDragItem.prototype.doInitialize=function(){this._field=this.getSetting("field");if(!this._field){throw"CrmFormFieldDragItem: The 'field' parameter is not defined in settings or empty."}this._showFieldInDragMode=this.getSetting("showFieldInDragMode",true);var e=this.getSetting("contextId","");this._contextId=e!==""?e:BX.CrmFormFieldDragItem.contextId;this._enableBin=this.getSetting("enableBin",true)};BX.CrmFormFieldDragItem.prototype.getField=function(){return this._field};BX.CrmFormFieldDragItem.prototype.createGhostNode=function(){if(this._ghostNode){return this._ghostNode}this._ghostNode=this._field.createGhostNode();document.body.appendChild(this._ghostNode)};BX.CrmFormFieldDragItem.prototype.removeGhostNode=function(){if(this._ghostNode){document.body.removeChild(this._ghostNode);this._ghostNode=null}};BX.CrmFormFieldDragItem.prototype.getContextId=function(){return this._contextId};BX.CrmFormFieldDragItem.prototype.getContextData=function(){return{contextId:this._contextId,field:this._field}};BX.CrmFormFieldDragItem.prototype.processDragStart=function(){BX.CrmFormSectionDragContainer.enable(false);if(!this._showFieldInDragMode){this._field.getNode().style.display="none"}BX.CrmFormFieldDragContainer.refresh()};BX.CrmFormFieldDragItem.prototype.processDragStop=function(){BX.CrmFormSectionDragContainer.enableAfter(true,300);if(!this._showFieldInDragMode){this._field.getNode().style.display=""}BX.CrmFormFieldDragContainer.refreshAfter(300)};BX.CrmFormFieldDragItem.prototype.isDragDropBinEnabled=function(){return this._enableBin};BX.CrmFormFieldDragItem.contextId="form_field_item";BX.CrmFormFieldDragItem.create=function(e,t){var i=new BX.CrmFormFieldDragItem;i.initialize(e,t);return i}}if(typeof BX.CrmFormSectionDragItem==="undefined"){BX.CrmFormSectionDragItem=function(){BX.CrmFormSectionDragItem.superclass.constructor.apply(this);this._section=null;this._showSectionInDragMode=true;this._showFieldsInDragMode=true;this._contextId="";this._enableBin=true};BX.extend(BX.CrmFormSectionDragItem,BX.CrmCustomDragItem);BX.CrmFormSectionDragItem.prototype.doInitialize=function(){this._section=this.getSetting("section");if(!this._section){throw"CrmFormSectionDragItem: The 'section' parameter is not defined in settings or empty."}this._showSectionInDragMode=this.getSetting("showSectionInDragMode",true);this._showFieldsInDragMode=this.getSetting("showFieldsInDragMode",true);var e=this.getSetting("contextId","");this._contextId=e!==""?e:BX.CrmFormSectionDragItem.contextId;this._enableBin=this.getSetting("enableBin",true)};BX.CrmFormSectionDragItem.prototype.getSection=function(){return this._section};BX.CrmFormSectionDragItem.prototype.createGhostNode=function(){if(this._ghostNode){return this._ghostNode}this._ghostNode=this._section.createGhostNode();document.body.appendChild(this._ghostNode)};BX.CrmFormSectionDragItem.prototype.removeGhostNode=function(){if(this._ghostNode){document.body.removeChild(this._ghostNode);this._ghostNode=null}};BX.CrmFormSectionDragItem.prototype.getContextId=function(){return this._contextId};BX.CrmFormSectionDragItem.prototype.getContextData=function(){return{contextId:this._contextId,section:this._section}};BX.CrmFormSectionDragItem.prototype.processDragStart=function(){BX.CrmFormFieldDragContainer.enable(false);if(!this._showSectionInDragMode){this._section.setVisible(false)}if(!this._showFieldsInDragMode){var e=this._section._manager.getSections();for(var t=0;t<e.length;t++){var i=e[t];i.setFieldsVisible(false);i.setButtonsVisible(false)}}BX.CrmFormSectionDragContainer.refresh()};BX.CrmFormSectionDragItem.prototype.processDragStop=function(){BX.CrmFormFieldDragContainer.enableAfter(true,300);if(!this._showSectionInDragMode){this._section.setVisible(true)}if(!this._showFieldsInDragMode){if(!this._showFieldsInDragMode){var e=this._section._manager.getSections();for(var t=0;t<e.length;t++){var i=e[t];i.setFieldsVisible(true);i.setButtonsVisible(true)}}}BX.CrmFormSectionDragContainer.refreshAfter(300)};BX.CrmFormSectionDragItem.prototype.isDragDropBinEnabled=function(){return this._enableBin};BX.CrmFormSectionDragItem.contextId="form_section_item";BX.CrmFormSectionDragItem.create=function(e,t){var i=new BX.CrmFormSectionDragItem;i.initialize(e,t);return i}}if(typeof BX.CrmFormFieldDragContainer==="undefined"){BX.CrmFormFieldDragContainer=function(){BX.CrmFormFieldDragContainer.superclass.constructor.apply(this);this._section=null;this._contextId="";this._priority=-1};BX.extend(BX.CrmFormFieldDragContainer,BX.CrmCustomDragContainer);BX.CrmFormFieldDragContainer.prototype.doInitialize=function(){this._section=this.getSetting("section");if(!this._section){throw"CrmFormFieldDragContainer: The 'section' parameter is not defined in settings or empty."}var e=this.getSetting("contextId","");this._contextId=e!==""?e:BX.CrmFormFieldDragItem.contextId;var t=parseInt(this.getSetting("priority",-1));this._priority=t>0?t:BX.CrmCustomDragContainer.defaultPriority};BX.CrmFormFieldDragContainer.prototype.getSection=function(){return this._section};BX.CrmFormFieldDragContainer.prototype.getPriority=function(){return this._priority};BX.CrmFormFieldDragContainer.prototype.createPlaceHolder=function(e){var t;var i=this._section.getPlaceHolder();if(i){t=BX.pos(i.getNode());if(e.y>=t.top&&e.y<=t.bottom){return}}var n="";var r=-1;var s=this._section.getFields();for(var o=0;o<s.length;o++){var a=s[o];t=BX.pos(a.getNode());if(e.y>=t.top&&e.y<=t.bottom){if(t.top+t.height/2-e.y>=0){n=a.getId();r=o}else if(o<s.length-1){n=s[o+1].getId();r=o+1}break}}this._section.createPlaceHolder({id:n,index:r,fields:s})};BX.CrmFormFieldDragContainer.prototype.removePlaceHolder=function(){this._section.removePlaceHolder()};BX.CrmFormFieldDragContainer.prototype.isAllowedContext=function(e){return e===this._contextId};BX.CrmFormFieldDragContainer.enable=function(e){for(var t in this.items){if(this.items.hasOwnProperty(t)){this.items[t].enable(e)}}};BX.CrmFormFieldDragContainer.enableAfter=function(e,t){t=parseInt(t);if(t>0){window.setTimeout(function(){BX.CrmFormFieldDragContainer.enable(e)})}else{this.enable(e)}};BX.CrmFormFieldDragContainer.refresh=function(){for(var e in this.items){if(this.items.hasOwnProperty(e)){this.items[e].refresh()}}};BX.CrmFormFieldDragContainer.refreshAfter=function(e){e=parseInt(e);if(e>0){window.setTimeout(function(){BX.CrmFormFieldDragContainer.refresh()},e)}else{this.refresh()}};BX.CrmFormFieldDragContainer.items={};BX.CrmFormFieldDragContainer.create=function(e,t){var i=new BX.CrmFormFieldDragContainer;i.initialize(e,t);this.items[i.getId()]=i;return i}}if(typeof BX.CrmFormSectionDragContainer==="undefined"){BX.CrmFormSectionDragContainer=function(){BX.CrmFormSectionDragContainer.superclass.constructor.apply(this);this._manager=null;this._contextId=""};BX.extend(BX.CrmFormSectionDragContainer,BX.CrmCustomDragContainer);BX.CrmFormSectionDragContainer.prototype.doInitialize=function(){this._manager=this.getSetting("manager");if(!this._manager){throw"CrmFormSectionDragContainer: The 'manager' parameter is not defined in settings or empty."}var e=this.getSetting("contextId","");this._contextId=e!==""?e:BX.CrmFormSectionDragItem.contextId};BX.CrmFormSectionDragContainer.prototype.getManager=function(){return this._manager};BX.CrmFormSectionDragContainer.prototype.createPlaceHolder=function(e){var t;var i=this._manager.getPlaceHolder();if(i){t=BX.pos(i.getNode());if(e.y>=t.top&&e.y<=t.bottom){return}}var n="";var r=-1;var s=this._manager.getSections();for(var o=0;o<s.length;o++){var a=s[o];t=BX.pos(a.getContentsNode());if(e.y>=t.top&&e.y<=t.bottom){if(t.top+t.height/2-e.y>=0){n=a.getId();r=o}else if(o<s.length-1){n=s[o+1].getId();r=o+1}break}}this._manager.createPlaceHolder({id:n,index:r,sections:s})};BX.CrmFormSectionDragContainer.prototype.removePlaceHolder=function(){this._manager.removePlaceHolder()};BX.CrmFormSectionDragContainer.prototype.isAllowedContext=function(e){return e===this._contextId};BX.CrmFormSectionDragContainer.enable=function(e){for(var t in this.items){if(this.items.hasOwnProperty(t)){this.items[t].enable(e)}}};BX.CrmFormSectionDragContainer.enableAfter=function(e,t){t=parseInt(t);if(t>0){window.setTimeout(function(){BX.CrmFormSectionDragContainer.enable(e)})}else{this.enable(e)}};BX.CrmFormSectionDragContainer.refresh=function(){for(var e in this.items){if(this.items.hasOwnProperty(e)){this.items[e].refresh()}}};BX.CrmFormSectionDragContainer.refreshAfter=function(e){e=parseInt(e);if(e>0){window.setTimeout(function(){BX.CrmFormSectionDragContainer.refresh()},e)}else{this.refresh()}};BX.CrmFormSectionDragContainer.items={};BX.CrmFormSectionDragContainer.create=function(e,t){var i=new BX.CrmFormSectionDragContainer;i.initialize(e,t);this.items[i.getId()]=i;return i}}
/* End */
;
; /* Start:"a:4:{s:4:"full";s:100:"/bitrix/components/bitrix/intranet.user.selector.new/templates/.default/users.min.js?151131652313983";s:6:"source";s:80:"/bitrix/components/bitrix/intranet.user.selector.new/templates/.default/users.js";s:3:"min";s:84:"/bitrix/components/bitrix/intranet.user.selector.new/templates/.default/users.min.js";s:3:"map";s:84:"/bitrix/components/bitrix/intranet.user.selector.new/templates/.default/users.map.js";}"*/
(function(){if(window.IntranetUsers)return;window.IntranetUsers=function(e,t,a){this.name=e;this.multiple=t;this.arSelected=[];this.arFixed=[];this.bSubordinateOnly=a;this.ajaxUrl="";this.lastSearchTime=0};IntranetUsers.arStructure={};IntranetUsers.bSectionsOnly=false;IntranetUsers.arEmployees={group:{}};IntranetUsers.arEmployeesData={};IntranetUsers.ajaxUrl="";IntranetUsers.prototype.loadGroup=function(e){var t=BX(this.name+"_group_section_"+e);function a(t){IntranetUsers.arEmployees["group"][e]=t;this.show(e,t,"g")}e=parseInt(e);if(IntranetUsers.arEmployees["group"][e]!=null){this.show(e,IntranetUsers.arEmployees["group"][e],"g")}else{var s=this.getAjaxUrl()+"&MODE=EMPLOYEES&GROUP_ID="+e;BX.ajax.loadJSON(s,BX.proxy(a,this))}BX.toggleClass(t,"company-department-opened");BX.toggleClass(BX(this.name+"_gchildren_"+e),"company-department-children-opened")};IntranetUsers.prototype.load=function(e,t,a,s){this.bSectionsOnly=s;function n(t){IntranetUsers.arStructure[e]=t.STRUCTURE;IntranetUsers.arEmployees[e]=t.USERS;this.show(e,false,"",this.bSectionsOnly)}if(null==t)t=false;if(null==a)a=false;if(null==s)s=false;if(e!="extranet")e=parseInt(e);var r=BX(this.name+"_employee_section_"+e);if(!r.BX_LOADED){if(IntranetUsers.arEmployees[e]!=null){this.show(e,false,"",this.bSectionsOnly)}else{var i=this.getAjaxUrl()+"&MODE=EMPLOYEES&SECTION_ID="+e;BX.ajax.loadJSON(i,BX.proxy(n,this))}}if(a){BX(this.name+"_employee_search_layout").scrollTop=r.offsetTop-40}BX.toggleClass(r,"company-department-opened");BX.toggleClass(BX(this.name+"_children_"+e),"company-department-children-opened")};IntranetUsers.prototype.show=function(e,t,a,s){s=!!s;a=a||"";var n=BX(this.name+"_"+a+"employee_section_"+e);var r=t||IntranetUsers.arEmployees[e];if(n!==null){n.BX_LOADED=true}var i=BX(this.name+"_"+a+"employees_"+e);if(i){if(IntranetUsers.arStructure[e]!=null&&!a){var l=IntranetUsers.arStructure[e];var o=BX(this.name+"_"+a+"children_"+e);if(o){for(var c=0;c<l.length;c++){obSectionRow1=BX.create("div",{props:{className:"company-department"},children:[s?BX.create("span",{props:{className:"company-department-inner",id:this.name+"_employee_section_"+l[c].ID},children:[BX.create("div",{props:{className:"company-department-arrow"},attrs:{onclick:"O_"+this.name+".load("+l[c].ID+", false, false, true)"}}),BX.create("div",{props:{className:"company-department-text"},attrs:{"data-section-id":l[c].ID,onclick:"O_"+this.name+".selectSection("+this.name+"_employee_section_"+l[c].ID+")"},text:l[c].NAME})]}):BX.create("span",{props:{className:"company-department-inner",id:this.name+"_employee_section_"+l[c].ID},attrs:{onclick:"O_"+this.name+".load("+l[c].ID+")"},children:[BX.create("div",{props:{className:"company-department-arrow"}}),BX.create("div",{props:{className:"company-department-text"},text:l[c].NAME})]})]});obSectionRow2=BX.create("div",{props:{className:"company-department-children",id:this.name+"_children_"+l[c].ID},children:[BX.create("div",{props:{className:"company-department-employees",id:this.name+"_employees_"+l[c].ID},children:[BX.create("span",{props:{className:"company-department-employees-loading"},text:BX.message("INTRANET_EMP_WAIT")})]})]});o.appendChild(obSectionRow1);o.appendChild(obSectionRow2)}o.appendChild(i)}}i.innerHTML="";for(var c=0;c<r.length;c++){var d;var p=false;IntranetUsers.arEmployeesData[r[c].ID]={id:r[c].ID,name:r[c].NAME,sub:r[c].SUBORDINATE=="Y"?true:false,sup:r[c].SUPERORDINATE=="Y"?true:false,position:r[c].WORK_POSITION,photo:r[c].PHOTO};var m=BX.create("input",{props:{className:"intranet-hidden-input"}});if(this.multiple){m.name=this.name+"[]";m.type="checkbox"}else{m.name=this.name;m.type="radio"}var h=document.getElementsByName(m.name);var u=0;while(!p&&u<h.length){if(h[u].value==r[c].ID&&h[u].checked){p=true}u++}m.value=r[c].ID;d=BX.create("div",{props:{className:"company-department-employee"+(p?" company-department-employee-selected":"")},events:{click:BX.proxy(this.select,this)},children:[m,BX.create("div",{props:{className:"company-department-employee-avatar"},style:{background:r[c].PHOTO?"url('"+r[c].PHOTO+"') no-repeat center center":"",backgroundSize:r[c].PHOTO?"cover":""}}),BX.create("div",{props:{className:"company-department-employee-icon"}}),BX.create("div",{props:{className:"company-department-employee-info"},children:[BX.create("div",{props:{className:"company-department-employee-name"},text:r[c].NAME}),BX.create("div",{props:{className:"company-department-employee-position"},html:!r[c].HEAD&&!r[c].WORK_POSITION?"&nbsp;":BX.util.htmlspecialchars(r[c].WORK_POSITION)+(r[c].HEAD&&r[c].WORK_POSITION?", ":"")+(r[c].HEAD?BX.message("INTRANET_EMP_HEAD"):"")})]})]});i.appendChild(d)}}};IntranetUsers.prototype.select=function(e){var t;var a=0;var s=e.target||e.srcElement;if(e.currentTarget){t=e.currentTarget}else{t=s;while(!BX.hasClass(t,"finder-box-item")&&!BX.hasClass(t,"company-department-employee")){t=t.parentNode}}var n=BX.findChild(t,{tag:"input"});if(!this.multiple){var r=document.getElementsByName(this.name);for(var a=0;a<r.length;a++){if(r[a].value!=n.value){BX.removeClass(r[a].parentNode,BX.hasClass(r[a].parentNode,"finder-box-item")?"finder-box-item-selected":"company-department-employee-selected")}else{BX.addClass(r[a].parentNode,BX.hasClass(r[a].parentNode,"finder-box-item")?"finder-box-item-selected":"company-department-employee-selected")}}n.checked=true;BX.addClass(t,BX.hasClass(t,"finder-box-item")?"finder-box-item-selected":"company-department-employee-selected");this.searchInput.value=IntranetUsers.arEmployeesData[n.value].name;this.arSelected=[];this.arSelected[n.value]={id:n.value,name:IntranetUsers.arEmployeesData[n.value].name,sub:IntranetUsers.arEmployeesData[n.value].sub,sup:IntranetUsers.arEmployeesData[n.value].sup,position:IntranetUsers.arEmployeesData[n.value].position,photo:IntranetUsers.arEmployeesData[n.value].photo}}else{var r=document.getElementsByName(this.name+"[]");if(!BX.util.in_array(n,r)&&!BX.util.in_array(n.value,this.arFixed)){n.checked=false;BX.toggleClass(n.parentNode,BX.hasClass(n.parentNode,"finder-box-item")?"finder-box-item-selected":"company-department-employee-selected")}for(var a=0;a<r.length;a++){if(r[a].value==n.value&&!BX.util.in_array(n.value,this.arFixed)){r[a].checked=false;BX.toggleClass(r[a].parentNode,BX.hasClass(r[a].parentNode,"finder-box-item")?"finder-box-item-selected":"company-department-employee-selected")}}if(BX.hasClass(n.parentNode,"finder-box-item-selected")||BX.hasClass(n.parentNode,"company-department-employee-selected")){n.checked=true}if(n.checked){var i=BX.findChild(BX(this.name+"_selected_users"),{className:"finder-box-selected-items"});if(!BX(this.name+"_employee_selected_"+n.value)){var l=BX.create("DIV");l.id=this.name+"_employee_selected_"+n.value;l.className="finder-box-selected-item";var o=BX.findChild(t,{tag:"DIV",className:"finder-box-item-text"},true)||BX.findChild(t,{tag:"DIV",className:"company-department-employee-name"},true);l.innerHTML='<div class="finder-box-selected-item-icon" id="'+this.name+"-user-selector-unselect-"+n.value+'" onclick="O_'+this.name+".unselect("+n.value+', this);"></div><span class="finder-box-selected-item-text">'+o.innerHTML+"</span>";i.appendChild(l);var c=BX(this.name+"_current_count");c.innerHTML=parseInt(c.innerHTML)+1;this.arSelected[n.value]={id:n.value,name:IntranetUsers.arEmployeesData[n.value].name,sub:IntranetUsers.arEmployeesData[n.value].sub,sup:IntranetUsers.arEmployeesData[n.value].sup,position:IntranetUsers.arEmployeesData[n.value].position,photo:IntranetUsers.arEmployeesData[n.value].photo}}}else{BX.remove(BX(this.name+"_employee_selected_"+n.value));var c=BX(this.name+"_current_count");c.innerHTML=parseInt(c.innerHTML)-1;this.arSelected[n.value]=null}}var d=BX.util.array_search(n.value,IntranetUsers.lastUsers);if(d>=0)IntranetUsers.lastUsers.splice(d,1);IntranetUsers.lastUsers.unshift(n.value);BX.userOptions.save("intranet","user_search","last_selected",IntranetUsers.lastUsers.slice(0,10));if(this.onSelect){var p=this.arSelected.pop();this.arSelected.push(p);this.onSelect(p)}BX.onCustomEvent(this,"on-change",[this.toObject(this.arSelected)]);if(this.onChange){this.onChange(this.arSelected)}};IntranetUsers.prototype.toObject=function(e){var t={};for(var a in e){a=parseInt(a);if(typeof a=="number"&&e[a]!==null){t[a]=BX.clone(e[a])}}return t};IntranetUsers.prototype.selectSection=function(e){var t=BX(e);if(!t){return false}else{var a=BX.findChild(t,{tag:"div",className:"company-department-text"});if(a){if(this.onSectionSelect){this.onSectionSelect({id:a.getAttribute("data-section-id"),name:a.innerHTML})}}}};IntranetUsers.prototype.unselect=function(e){var t=BX(this.name+"-user-selector-unselect-"+e);var a=document.getElementsByName(this.name+(this.multiple?"[]":""));for(var s=0;s<a.length;s++){if(a[s].value==e){a[s].checked=false;BX.removeClass(a[s].parentNode,BX.hasClass(a[s].parentNode,"finder-box-item")?"finder-box-item-selected":"company-department-employee-selected")}}if(this.multiple){if(t){BX.remove(t.parentNode)}var n=BX(this.name+"_current_count");n.innerHTML=parseInt(n.innerHTML)-1}this.arSelected[e]=null;BX.onCustomEvent(this,"on-change",[this.toObject(this.arSelected)]);if(this.onChange){this.onChange(this.arSelected)}};IntranetUsers.prototype.getSelected=function(){return this.arSelected};IntranetUsers.prototype.setSelected=function(e){for(var t=0,a=this.arSelected.length;t<a;t++){if(this.arSelected[t]&&this.arSelected[t].id)this.unselect(this.arSelected[t].id)}if(!this.multiple){e=[e[0]]}this.arSelected=[];for(var t=0,a=e.length;t<a;t++){this.arSelected[e[t].id]=e[t];var s=BX.create("input",{props:{className:"intranet-hidden-input",value:e[t].id,checked:"checked",name:this.name+(this.multiple?"[]":"")}});BX(this.name+"_last").appendChild(s);if(this.multiple){var n=BX.findChild(BX(this.name+"_selected_users"),{className:"finder-box-selected-items"});var r=BX.create("div",{props:{className:"finder-box-selected-item",id:this.name+"_employee_selected_"+e[t].id},html:'<div class="finder-box-selected-item-icon" id="'+this.name+"-user-selector-unselect-"+e[t].id+'" onclick="O_'+this.name+".unselect("+e[t].id+', this);"></div><span class="finder-box-selected-item-text">'+BX.util.htmlspecialchars(e[t].name)+"</span>"});n.appendChild(r)}var i=document.getElementsByName(this.name+(this.multiple?"[]":""));for(var l=0;l<i.length;l++){if(i[l].value==e[t].id){BX.toggleClass(i[l].parentNode,BX.hasClass(i[l].parentNode,"finder-box-item")?"finder-box-item-selected":"company-department-employee-selected")}}}if(this.multiple){BX.adjust(BX(this.name+"_current_count"),{text:e.length})}};IntranetUsers.prototype.setFixed=function(e){if(typeof e!="object")e=[];this.arFixed=e;var t=BX.findChildren(BX(this.name+"_selected_users"),{className:"finder-box-selected-item-icon"},true);for(i=0;i<t.length;i++){var a=t[i].id.replace(this.name+"-user-selector-unselect-","");BX.adjust(t[i],{style:{visibility:BX.util.in_array(a,this.arFixed)?"hidden":"visible"}})}};IntranetUsers.prototype.search=function(e){this.searchRqstTmt=clearTimeout(this.searchRqstTmt);if(typeof this.searchRqst=="object"){this.searchRqst.abort();this.searchRqst=false}if(!e)e=window.event;if(this.searchInput.value.length>0){this.displayTab("search");var t=this.getAjaxUrl()+"&MODE=SEARCH&SEARCH_STRING="+encodeURIComponent(this.searchInput.value);if(this.bSubordinateOnly)t+="&S_ONLY=Y";var a=this;this.searchRqstTmt=setTimeout(function(){var e=(new Date).getTime();a.lastSearchTime=e;a.searchRqst=BX.ajax.loadJSON(t,BX.proxy(function(t){if(a.lastSearchTime==e)a.showResults(t)},a))},400)}};IntranetUsers.prototype.showResults=function(e){var t=e;var a=BX(this.name+"_search");var s=a.getElementsByTagName("input");for(var n=0,r=s.length;n<r;n++){if(s[n].checked){BX(this.name+"_last").appendChild(s[n])}}if(a){a.innerHTML="";var i=BX.create("table",{props:{className:"finder-box-tab-columns",cellspacing:"0"},children:[BX.create("tbody")]});var l=BX.create("tr");i.firstChild.appendChild(l);var o=BX.create("td");l.appendChild(o);a.appendChild(i);for(var n=0;n<t.length;n++){var c;var d=false;IntranetUsers.arEmployeesData[t[n].ID]={id:t[n].ID,name:t[n].NAME,sub:t[n].SUBORDINATE=="Y"?true:false,sup:t[n].SUPERORDINATE=="Y"?true:false,position:t[n].WORK_POSITION,photo:t[n].PHOTO};var p=BX.create("input",{props:{className:"intranet-hidden-input"}});if(this.multiple){p.name=this.name+"[]";p.type="checkbox"}else{p.name=this.name;p.type="radio"}var s=document.getElementsByName(p.name);var m=0;while(!d&&m<s.length){if(s[m].value==t[n].ID&&s[m].checked){d=true}m++}p.value=t[n].ID;var h=t[n].NAME;var u="finded_anchor_user_id_"+t[n].ID;c=BX.create("div",{props:{className:"finder-box-item"+(d?" finder-box-item-selected":""),id:u},events:{click:BX.proxy(this.select,this)},children:[p,BX.create("div",{props:{className:"finder-box-item-text"},text:h}),BX.create("div",{props:{className:"finder-box-item-icon"}})]});o.appendChild(c);if(n==Math.ceil(t.length/2)-1){o=BX.create("td");i.firstChild.appendChild(o)}BX.tooltip(t[n].ID,u,"")}}};IntranetUsers.prototype.displayTab=function(e){BX.removeClass(BX(this.name+"_last"),"finder-box-tab-content-selected");BX.removeClass(BX(this.name+"_search"),"finder-box-tab-content-selected");BX.removeClass(BX(this.name+"_structure"),"finder-box-tab-content-selected");BX.removeClass(BX(this.name+"_groups"),"finder-box-tab-content-selected");BX.addClass(BX(this.name+"_"+e),"finder-box-tab-content-selected");BX.removeClass(BX(this.name+"_tab_last"),"finder-box-tab-selected");BX.removeClass(BX(this.name+"_tab_search"),"finder-box-tab-selected");BX.removeClass(BX(this.name+"_tab_structure"),"finder-box-tab-selected");BX.removeClass(BX(this.name+"_tab_groups"),"finder-box-tab-selected");BX.addClass(BX(this.name+"_tab_"+e),"finder-box-tab-selected")};IntranetUsers.prototype._onFocus=function(){this.searchInput.value=""};IntranetUsers.prototype.getAjaxUrl=function(){return this.ajaxUrl||IntranetUsers.ajaxUrl}})();
/* End */
;; /* /bitrix/components/bitrix/main.interface.buttons/templates/.default/script.min.js?151131647237595*/
; /* /bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.min.js?1511316472575*/
; /* /bitrix/components/bitrix/crm.contact.menu/templates/.default/script.js?1511316478484*/
; /* /bitrix/components/bitrix/crm.interface.toolbar/templates/type2/script.js?15113164783136*/
; /* /bitrix/components/bitrix/crm.field_multi.edit/templates/new/script.js?15113164784279*/
; /* /bitrix/components/bitrix/crm.requisite.form.editor/templates/.default/script.min.js?151131647823419*/
; /* /bitrix/components/bitrix/crm.interface.form.tactile/templates/.default/bitrix/main.interface.form/tactile/script.min.js?151131647891026*/
; /* /bitrix/components/bitrix/intranet.user.selector.new/templates/.default/users.min.js?151131652313983*/

//# sourceMappingURL=page_2f371ebc978c172d7d732d2226526117.map.js