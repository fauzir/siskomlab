
; /* Start:"a:4:{s:4:"full";s:93:"/bitrix/components/bitrix/socialnetwork.admin.set/templates/.default/script.js?15113165822527";s:6:"source";s:78:"/bitrix/components/bitrix/socialnetwork.admin.set/templates/.default/script.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
var waitDiv = null;
var waitPopup = null;
var waitTimeout = null;
var waitTime = 500;

function __SASSetAdmin()
{
	__SASShowWait();
	BX.ajax({
		url: '/bitrix/components/bitrix/socialnetwork.admin.set/ajax.php',
		method: 'POST',
		dataType: 'json',
		data: {'ACTION': 'SET', 'sessid': BX.bitrix_sessid(), 'site': BX.util.urlencode(BX.message('SASSiteId'))},
		onsuccess: function(data) { __SASProcessAJAXResponse(data); }
	});
}

function __SASProcessAJAXResponse(data)
{
	if (data["SUCCESS"] != "undefined" && data["SUCCESS"] == "Y")
	{
		BX.reload();
		return false;
	}
	else if (data["ERROR"] != "undefined" && data["ERROR"].length > 0)
	{
		if (data["ERROR"].indexOf("SESSION_ERROR", 0) === 0)
		{
			__SASShowError(BX.message('SASErrorSessionWrong'));
			BX.reload();
		}
		else if (data["ERROR"].indexOf("CURRENT_USER_NOT_ADMIN", 0) === 0)
		{
			__SASShowError(BX.message('SASErrorNotAdmin'));
			return false;
		}
		else if (data["ERROR"].indexOf("CURRENT_USER_NOT_AUTH", 0) === 0)
		{
			__SASShowError(BX.message('SASErrorCurrentUserNotAuthorized'));
			return false;
		}
		else if (data["ERROR"].indexOf("SONET_MODULE_NOT_INSTALLED", 0) === 0)
		{
			__SASShowError(BX.message('SASErrorModuleNotInstalled'));
			return false;
		}
		else
		{
			__SASShowError(data["ERROR"]);
			return false;		
		}
	}
}
				
function __SASShowError(errorText) 
{
	__SASCloseWait();

	var errorPopup = new BX.PopupWindow('sas-error' + Math.random(), window, {
		autoHide: true,
		lightShadow: false,
		zIndex: 2,
		content: BX.create('DIV', {props: {'className': 'sonet-adminset-error-text-block'}, html: errorText}),
		closeByEsc: true,
		closeIcon: true
	});
	errorPopup.show();

}

function __SASShowWait(timeout)
{
	if (timeout !== 0)
	{
		return (waitTimeout = setTimeout(function(){
			__SASShowWait(0)
		}, 50));
	}

	if (!waitPopup)
	{
		waitPopup = new BX.PopupWindow('sas_wait', window, {
			autoHide: true,
			lightShadow: true,
			zIndex: 2,
			content: BX.create('DIV', {
				props: {
					className: 'sonet-adminset-wait-cont'
				},
				children: [
					BX.create('DIV', {
						props: {
							className: 'sonet-adminset-wait-icon'
						}
					}),
					BX.create('DIV', {
						props: {
							className: 'sonet-adminset-wait-text'
						},
						html: BX.message('SASWaitTitle')
					})
				]
			})
		});
	}
	else
		waitPopup.setBindElement(window);

	waitPopup.show();
}

function __SASCloseWait()
{
	if (waitTimeout)
	{
		clearTimeout(waitTimeout);
		waitTimeout = null;
	}

	if (waitPopup)
		waitPopup.close();
}
/* End */
;
; /* Start:"a:4:{s:4:"full";s:90:"/bitrix/components/bitrix/tasks.task.list/templates/.default/script.min.js?151131659810817";s:6:"source";s:70:"/bitrix/components/bitrix/tasks.task.list/templates/.default/script.js";s:3:"min";s:74:"/bitrix/components/bitrix/tasks.task.list/templates/.default/script.min.js";s:3:"map";s:74:"/bitrix/components/bitrix/tasks.task.list/templates/.default/script.map.js";}"*/
BX.namespace("BX.Tasks.Grid");BX.Tasks.GridActions={gridId:null,groupSelector:null,registeredTimerNodes:{},initPopupBaloon:function(e,t,r){this.groupSelector=null;BX.bind(BX(t+"_control"),"click",BX.delegate(function(){if(!this.groupSelector){this.groupSelector=new BX.Tasks.Integration.Socialnetwork.NetworkSelector({scope:BX(t+"_control"),id:"group-selector-"+this.gridId,mode:e,query:false,useSearch:true,useAdd:false,parent:this,popupOffsetTop:5,popupOffsetLeft:40});this.groupSelector.bindEvent("item-selected",BX.delegate(function(e){BX(t+"_control").value=BX.util.htmlspecialcharsback(e.nameFormatted)||"";BX(r+"_control").value=e.id||"";this.groupSelector.close()},this))}this.groupSelector.open()},this))},action:function(e,t,r){switch(e){default:this.doAction(e,t,r);break;case"add2Timeman":if(BX.addTaskToPlanner)BX.addTaskToPlanner(t);else if(window.top.BX.addTaskToPlanner)window.top.BX.addTaskToPlanner(t);break;case"delete":BX.Tasks.confirmDelete(BX.message("TASKS_COMMON_TASK_ALT_A")).then(function(){this.doAction(e,t,r)}.bind(this));break}},confirmGroupAction:function(e){BX.Tasks.confirm(BX.message("TASKS_CONFIRM_GROUP_ACTION")).then(function(){BX.Main.gridManager.getById(e).instance.sendSelected()}.bind(this))},doAction:function(e,t,r){r=r||{};r["id"]=t;this.getQuery().add("task."+e.toLowerCase(),r,{},BX.delegate(function(e,r){if(!e.checkHasErrors()){if(r.OPERATION=="task.delete"){BX.Tasks.Util.fireGlobalTaskEvent("DELETE",{ID:t})}if(!this.gridId){window.location.href=window.location.href;return}this.reloadRow(t)}},this))},reloadGrid:function(){if(BX.Bitrix24&&BX.Bitrix24.Slider&&BX.Bitrix24.Slider.getLastOpenPage()){BX.Bitrix24.Slider.destroy(BX.Bitrix24.Slider.getLastOpenPage().getUrl())}var e={apply_filter:"Y",clear_nav:"Y"};var t=BX.Main.gridManager.getById(this.gridId);if(t.hasOwnProperty("instance")){t.instance.reloadTable("POST",e)}},reloadRow:function(e){reloadParams={apply_filter:"Y",clear_nav:"Y"};gridObject=BX.Main.gridManager.getById(this.gridId);if(gridObject.hasOwnProperty("instance"))gridObject.instance.updateRow(e.toString())},getQuery:function(){if(!this.query){this.query=new BX.Tasks.Util.Query({autoExec:true})}return this.query},onDeadlineChangeClick:function(e,t,r){r=r||(new Date).getDate();BX.calendar({node:t,value:r,form:"",bTime:true,currentTime:Math.round(new Date/1e3)-(new Date).getTimezoneOffset()*60,bHideTimebar:true,callback_after:function(e,t){return function(r,i){var s=true;if(typeof i!=="undefined")s=i;BX.CJSTask.batchOperations([{operation:"CTaskItem::update()",taskData:{ID:t,DEADLINE:BX.calendar.ValueToString(r,s)}}],{callbackOnSuccess:function(e,t,r){return function(e){}}(e,t,r)});BX.Tasks.GridActions.reloadRow(t)}}(t,e)})},onMarkChangeClick:function(e,t,r){BX.TaskGradePopup.show(e,t,r,{events:{onPopupClose:this.__onGradePopupClose,onPopupChange:this.__onGradePopupChange}});BX.addClass(t,"task-grade-and-report-selected");return false},__onGradePopupClose:function(){BX.removeClass(this.bindElement,"task-grade-and-report-selected")},__onGradePopupChange:function(){this.bindElement.className="task-grade-and-report"+(this.listValue!=="NULL"?" task-grade-"+this.listItem.className:"")+(this.report?" task-in-report":"");this.bindElement.title=BX.message("TASKS_MARK")+": "+this.listItem.name;BX.Tasks.GridActions.action("update",this.id,{data:{MARK:this.listValue==="NULL"?"":this.listValue}})},renderTimerItem:function(e,t,r,i,s,a){var n="task-timer-inner";var o=t+s;var a=a||false;if(i)n=n+" task-timer-play";else if(a)n=n+" task-timer-pause";else n=n+" task-timer-clock";if(r>0&&o>r)n=n+" task-timer-overdue";return BX.create("span",{props:{id:"task-timer-block-"+e,className:"task-timer-block"},events:{click:function(e,t){return function(){if(BX.hasClass(BX("task-timer-block-inner-"+e),"task-timer-play")){BX.TasksTimerManager.stop(e)}else if(t){BX.TasksTimerManager.start(e)}}}(e,a)},children:[BX.create("span",{props:{id:"task-timer-block-inner-"+e,className:n},children:[BX.create("span",{props:{className:"task-timer-icon"}}),BX.create("span",{props:{id:"task-timer-block-value-"+e,className:"task-timer-time"},text:BX.Tasks.GridActions.renderTimerTimes(o,r,i)})]})]})},renderTimerTimes:function(e,t,r){var i="";var s=false;if(r)s=true;i=BX.Tasks.GridActions.renderSecondsToHHMMSS(e,s);if(t>0)i=i+" / "+BX.Tasks.GridActions.renderSecondsToHHMMSS(t,false);return i},renderSecondsToHHMMSS:function(e,t){var r="00";var i=""+Math.floor(e/3600);var s=""+Math.floor(e/60)%60;var a=0;var n="";n=r.substring(0,2-i.length)+i+":"+r.substring(0,2-s.length)+s;if(t){a=""+e%60;n=n+":"+r.substring(0,2-a.length)+a}return n},redrawTimerNode:function(e,t,r,i,s,a){var n=BX("task-timer-block-"+e);var o=BX.Tasks.GridActions.renderTimerItem(e,t,r,i,s,a);if(n){n.parentNode.replaceChild(o,n)}else{var d=BX("task-timer-block-container-"+e);if(d){if(this.registeredTimerNodes[e]){BX.removeCustomEvent(window,"onTaskTimerChange",this.registeredTimerNodes[e])}d.appendChild(o);if(BX("task-timer-block-"+e)){this.registeredTimerNodes[e]=this.__getTimerChangeCallback(e);BX.addCustomEvent(window,"onTaskTimerChange",this.registeredTimerNodes[e])}}}},removeTimerNode:function(e){var t=BX("task-timer-block-"+e);if(this.registeredTimerNodes[e])BX.removeCustomEvent(window,"onTaskTimerChange",this.registeredTimerNodes[e]);if(t)t.parentNode.removeChild(t)},__getTimerChangeCallback:function(e){var t=null;return function(r){var i=null;var s=null;if(r.action==="refresh_daemon_event"){if(r.taskId!==e){if(t==="paused")return;else i="paused"}else{if(t!=="playing")i="playing";BX.Tasks.GridActions.redrawTimerNode(r.taskId,r.data.TASK.TIME_SPENT_IN_LOGS,r.data.TASK.TIME_ESTIMATE,true,r.data.TIMER.RUN_TIME,true)}}else if(r.action==="start_timer"){if(e==r.taskId&&r.timerData&&e==r.timerData.TASK_ID){i="playing"}else i="paused"}else if(r.action==="stop_timer"){if(e==r.taskId)i="paused"}else if(r.action==="init_timer_data"){if(r.data.TIMER){if(r.data.TIMER.TASK_ID==e){if(r.data.TIMER.TIMER_STARTED_AT>0)i="playing";else i="paused"}else if(r.data.TIMER.TASK_ID>0){i="paused"}}}if(i!==null){s=BX("task-timer-block-inner-"+e);if(s&&!BX.hasClass(s,"task-timer-clock")){if(i==="paused"){BX.removeClass(s,"task-timer-play");BX.addClass(s,"task-timer-pause")}else if(i==="playing"){BX.removeClass(s,"task-timer-pause");BX.addClass(s,"task-timer-play")}}t=i}}}};(function(){"use strict";BX.addCustomEvent("tasksTaskEvent",BX.delegate(function(e,t){BX.Tasks.GridActions.reloadGrid()},this));BX.Tasks.Grid.Sorting=function(e){this.grid=BX.Main.gridManager.getInstanceById(e.gridId);this.currentGroupId=e.currentGroupId;this.treeMode=e.treeMode;BX.message(e.messages);this.init();BX.addCustomEvent("BX.Main.grid:rowDragStart",this.handleRowDragStart.bind(this));BX.addCustomEvent("BX.Main.grid:rowDragMove",this.handleRowDragMove.bind(this));BX.addCustomEvent("BX.Main.grid:rowDragEnd",this.handleRowDragEnd.bind(this))};BX.Tasks.Grid.Sorting.prototype={init:function(){this.dragRow=null;this.targetRow=null;this.error=false;this.targetTask=null;this.before=true;this.newGroup=null;this.newParentId=null},getGrid:function(){return this.grid},getRow:function(e){return this.getGrid().getRows().get(e)},getRowById:function(e){return this.getGrid().getRows().getById(e)},getRows:function(){return this.getGrid().getRows().getBodyChild()},getRowProp:function(e,t){return e.getNode().dataset[t]},getRowType:function(e){return this.getRowProp(e,"type")},getRowGroupId:function(e){return this.getRowProp(e,"groupId")},handleRowDragStart:function(e,t){this.dragRow=this.getRow(e.getDragItem())},handleRowDragMove:function(e,t){this.targetRow=this.getRow(e.getTargetItem());var r=this.targetRow?this.getRowType(this.targetRow):null;this.newParentId=null;this.error=false;var i=null;if(r==="task"){var s=this.targetRow.getParentId();if(s!==this.dragRow.getParentId()){this.newParentId=s}i=this.getGroupByRow(this.targetRow);this.targetTask=this.targetRow;this.before=true}else{if(r==="group"){i=this.getPreviousGroup(this.targetRow)}else{i=this.getLastGroup()}var a=this.getClosestTask(this.targetRow);this.targetTask=a.task;this.before=a.before}this.newGroup=i.id!==this.getGroupByRow(this.dragRow).id?i:null;if(r==="task"&&this.isChildOf(this.targetTask,this.dragRow)){this.error=true}else if(this.newGroup&&(this.getRowProp(this.dragRow,"canEdit")==="false"||!this.newGroup.canCreateTasks)){this.error=true}else if(this.newParentId!==null&&this.getRowProp(this.dragRow,"canEdit")==="false"){this.error=true}this.error?e.disallowMove(BX.message("TASKS_ACCESS_DENIED")):e.allowMove()},handleRowDragEnd:function(e,t){if(!this.error){this.save()}this.init()},save:function(){var e=this.dragRow.getId();var t=this.targetTask?this.targetTask.getId():null;if(e===t){return}var r={sourceId:e,targetId:t,before:this.before,currentGroupId:this.currentGroupId};if(this.newGroup!==null){r.newGroupId=this.newGroup.id;this.setGroupId(this.dragRow,r.newGroupId)}if(this.newParentId!==null&&this.treeMode){r.newParentId=this.newParentId}var i=new BX.Tasks.Util.Query;i.run("task.sorting.move",{data:r}).then(function(e){if(!e.getErrors().isEmpty()){BX.Tasks.confirm(e.getErrors().getMessages().join(" "),function(){BX.reload()},{buttonSet:[]})}});i.execute()},getParentRow:function(e){return this.getRowById(e.getParentId())},isChildOf:function(e,t){var r=this.getParentRow(e);while(r!==null){if(r===t){return true}r=this.getParentRow(r)}return false},getGroupById:function(e){var t=this.getRows();for(var r=0;r<t.length;r++){var i=t[r];if(this.getRowType(i)==="group"&&this.getRowGroupId(i)===String(e)){return this.getGroupByRow(i)}}return this.getDefaultProject()},setGroupId:function(e,t){e.getDataset().groupId=t;var r=e.getChildren();for(var i=0;i<r.length;i++){this.setGroupId(r[i],t)}},getDefaultProject:function(){return{id:"0",canCreateTasks:true}},getGroupByRow:function(e){if(this.getRowType(e)==="group"){return{id:this.getRowGroupId(e),canCreateTasks:this.getRowProp(e,"canCreateTasks")==="true"}}else{return this.getGroupById(this.getRowGroupId(e))}},getLastGroup:function(){var e=null;var t=this.getRows();for(var r=t.length-1;r>=0;r--){var i=t[r];if(this.getRowType(i)==="group"){return this.getGroupByRow(i)}}return this.getDefaultProject()},getPreviousGroup:function(e){var t=null;var r=this.getRows();var i=false;for(var s=r.length-1;s>=0;s--){var a=r[s];if(e===a){i=true;continue}if(i&&this.getRowType(a)==="group"){return this.getGroupByRow(a)}}return this.getDefaultProject()},getClosestTask:function(e){var t=this.getRows();var r=e?e.getIndex()-1:t.length;for(var i=r-1;i>=0;i--){if(this.getRowType(t[i])==="task"&&t[i].getDepth()==="0"){return{task:t[i],before:false}}}for(i=r+1;i<t.length;i++){if(this.getRowType(t[i])==="task"&&t[i].getDepth()==="0"){return{task:t[i],before:true}}}return{task:null,before:true}}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:96:"/bitrix/components/bitrix/tasks.interface.header/templates/.default/script.min.js?15113165981742";s:6:"source";s:77:"/bitrix/components/bitrix/tasks.interface.header/templates/.default/script.js";s:3:"min";s:81:"/bitrix/components/bitrix/tasks.interface.header/templates/.default/script.min.js";s:3:"map";s:81:"/bitrix/components/bitrix/tasks.interface.header/templates/.default/script.map.js";}"*/
BX.namespace("BX.Tasks");BX.Tasks.InterfaceToolbar=function(t){this.gridId=t.gridId;this.grid={};this.containerId=t.containerId;this.container={};this.itemSelector="a.tasks-counter-container";this.params=t||{};this.filterManager=null;this.filterApi=null;this.itemClickHandler=null;return this.init()};BX.Tasks.InterfaceToolbar.prototype={init:function(){this.itemClickHandler=BX.delegate(this.onItemClick,this);this.container=BX(this.containerId);if(!BX.type.isElementNode(this.container)){throw"BX.Tasks.InterfaceToolbar: Could not find container: "+this.containerId}var t=this.container.querySelectorAll(this.itemSelector);for(var e=0,i=t.length;e<i;e++){BX.bind(t[e],"click",this.itemClickHandler)}this.filterManager=BX.Main.filterManager.getById(this.gridId);if(!this.filterManager){alert("BX.Main.filterManager not initialised");return}this.filterApi=this.filterManager.getApi()},onItemClick:function(t){var e=BX.findParent(BX.getEventTarget(t),{tagName:"A",className:"tasks-counter-container"});if(e){var i=e.getAttribute("data-type-id");if(BX.type.isNotEmptyString(i)){var r={counterTypeId:i,cancel:false};this.applyFilter(r);if(r.cancel){return BX.PreventDefault(t)}}}return true},applyFilter:function(t){var e={};switch(t.counterTypeId){case"tasks_my_expired":var i=BX.date.format("d.m.Y",new Date,null,true);e={DEADLINE_datesel:"RANGE",DEADLINE_to:i};break;case"tasks_my_expired_cand":var r=new Date;var a=new Date;r.setUTCHours(r.getUTCHours()-24);var n=BX.date.format("d.m.Y H:i:s",r,null,true);a.setUTCHours(a.getUTCHours()+24);var s=BX.date.format("d.m.Y H:i:s",a,null,true);e={DEADLINE_datesel:"RANGE",DEADLINE_from:n,DEADLINE_to:s};break}this.filterApi.setFields(e);this.filterApi.apply()}};
/* End */
;
; /* Start:"a:4:{s:4:"full";s:95:"/bitrix/components/bitrix/tasks.interface.topmenu/templates/.default/script.min.js?151131659860";s:6:"source";s:78:"/bitrix/components/bitrix/tasks.interface.topmenu/templates/.default/script.js";s:3:"min";s:82:"/bitrix/components/bitrix/tasks.interface.topmenu/templates/.default/script.min.js";s:3:"map";s:82:"/bitrix/components/bitrix/tasks.interface.topmenu/templates/.default/script.map.js";}"*/
BX.namespace("BX.Tasks");
/* End */
;
; /* Start:"a:4:{s:4:"full";s:97:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/script.min.js?151131647237595";s:6:"source";s:77:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/script.js";s:3:"min";s:81:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/script.min.js";s:3:"map";s:81:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/script.map.js";}"*/
BX.namespace("BX.Main");if(typeof BX.Main.interfaceButtons==="undefined"){BX.Main.interfaceButtons=function(t,e){this.classItem="main-buttons-item";this.classItemSublink="main-buttons-item-sublink";this.classItemText="main-buttons-item-text";this.classItemCounter="main-buttons-item-counter";this.classItemIcon="main-buttons-item-icon";this.classItemMore="main-buttons-item-more";this.classOnDrag="main-buttons-drag";this.classDropzone="main-buttons-submenu-dropzone";this.classSeporator="main-buttons-submenu-separator";this.classHiddenLabel="main-buttons-hidden-label";this.classSubmenuItem="main-buttons-submenu-item";this.classItemDisabled="main-buttons-disabled";this.classItemOver="over";this.classItemActive="main-buttons-item-active";this.classSubmenu="main-buttons-submenu";this.classSecret="secret";this.classItemLocked="locked";this.submenuIdPrefix="main_buttons_popup_";this.submenuWindowIdPrefix="menu-popup-";this.classSettingMenuItem="main-buttons-submenu-setting";this.classEditState="main-buttons-edit";this.classEditItemButton="main-buttons-item-edit-button";this.classDragItemButton="main-buttons-item-drag-button";this.classSettingsApplyButton="main-buttons-submenu-settings-apply";this.classSettingsResetButton="main-buttons-submenu-settings-reset";this.classSetHome="main-buttons-set-home";this.classSetHide="main-buttons-set-hide";this.classManage="main-buttons-manage";this.classContainer="main-buttons";this.classSubmenuNoHiddenItem="main-buttons-submenu-item-no-hidden";this.classDefaultSubmenuItem="menu-popup-item";this.classInner="main-buttons-inner-container";this.listContainer=null;this.pinContainer=null;this.dragItem=null;this.overItem=null;this.moreButton=null;this.messages=null;this.licenseParams=null;this.isSubmenuShown=false;this.isSubmenuShownOnDragStart=false;this.isSettingsEnabled=true;this.containerId=e.containerId;this.tmp={};this.init(t,e);return{getItemById:BX.delegate(this.getItemById,this),getAllItems:BX.delegate(this.getAllItems,this),getHiddenItems:BX.delegate(this.getHiddenItems,this),getVisibleItems:BX.delegate(this.getVisibleItems,this),getDisabledItems:BX.delegate(this.getDisabledItems,this),getMoreButton:BX.delegate(this.getMoreButton,this),adjustMoreButtonPosition:BX.delegate(this.adjustMoreButtonPosition,this),showSubmenu:BX.delegate(this.showSubmenu,this),closeSubmenu:BX.delegate(this.closeSubmenu,this),refreshSubmenu:BX.delegate(this.refreshSubmenu,this),getCurrentSettings:BX.delegate(this.getCurrentSettings,this),saveSettings:BX.delegate(this.saveSettings,this),setCounterValueByItemId:BX.delegate(this.setCounterValueByItemId,this),getCounterValueByItemId:BX.delegate(this.getCounterValueByItemId,this),updateCounter:BX.delegate(this.updateCounter,this),getActive:BX.delegate(this.getActive,this),isEditEnabled:BX.delegate(this.isEditEnabled,this),isActiveInMoreMenu:BX.delegate(this.isActiveInMoreMenu,this),isSettingsEnabled:this.isSettingsEnabled,classes:{item:this.classItem,itemText:this.classItemText,itemCounter:this.classItemCounter,itemIcon:this.classItemIcon,itemDisabled:this.classItemDisabled,itemOver:this.classItemOver,itemActive:this.classItemActive,itemLocked:this.classItemLocked,submenu:this.classSubmenu,submenuItem:this.classSubmenuItem,containerOnDrag:this.classOnDrag,classSettingMenuItem:this.classSettingMenuItem},itemsContainer:this.listContainer,itemsContainerId:this.listContainer.id}};BX.Main.interfaceButtons.prototype={init:function(t,e){this.listContainer=BX(this.getId());if(!BX.type.isPlainObject(e)){throw"BX.MainButtons: params is not Object"}if(!("containerId"in e)||!BX.type.isNotEmptyString(e.containerId)){throw"BX.MainButtons: containerId not set in params"}if(!BX.type.isDomNode(this.listContainer)){throw"BX.MainButtons: #"+e.containerId+" is not dom node"}if("classes"in e&&BX.type.isPlainObject(e.classes)){this.setCustomClasses(e.classes)}if("messages"in e&&BX.type.isPlainObject(e.messages)){this.setMessages(e.messages)}if("licenseWindow"in e&&BX.type.isPlainObject(e.licenseWindow)){this.setLicenseWindowParams(e.licenseWindow)}if("disableSettings"in e&&e.disableSettings==="true"){this.isSettingsEnabled=false;this.visibleControlMoreButton()}this.moreButton=this.getMoreButton();if(this.isSettingsEnabled){this.dragAndDropInit()}this.adjustMoreButtonPosition();this.bindOnClickOnMoreButton();this.bindOnScrollWindow();this.setContainerHeight();BX.bind(this.getContainer(),"click",BX.delegate(this._onDocumentClick,this));BX.addCustomEvent("onPullEvent-main",BX.delegate(this._onPush,this));this.updateMoreButtonCounter();if(this.isActiveInMoreMenu()){this.activateItem(this.moreButton)}var s=this.getVisibleItems();var i=BX.type.isArray(s)&&s.length>0?s[0]:null;var n=BX.Buttons.Utils.getByTag(i,"a");if(!BX.type.isDomNode(n)){return}var a=n.getAttribute("href");if(a.charAt(0)==="?"){a=n.pathname+n.search}if(!this.lastHomeLink){this.lastHomeLink=a}this.bindOnResizeFrame()},_onDocumentClick:function(t){var e=this.getItem(t);var s,i,n,a,o,u;if(this.isDragButton(t.target)){t.preventDefault();t.stopPropagation()}if(BX.type.isDomNode(e)){if(!this.isSublink(t.target)){s=this.dataValue(e,"onclick");if(BX.type.isNotEmptyString(s)){t.preventDefault();this.execScript(s)}}if(this.isSettings(e)){this.enableEdit();BX.hide(this.getSettingsButton());BX.show(this.getSettingsApplyButton())}if(this.isApplySettingsButton(e)){t.preventDefault();t.stopPropagation();this.disableEdit();BX.show(this.getSettingsButton());BX.hide(this.getSettingsApplyButton())}if(this.isResetSettingsButton(e)){this.resetSettings()}if(this.isLocked(e)){t.preventDefault();this.showLicenseWindow()}if(this.isEditButton(t.target)){var r,h;t.preventDefault();t.stopPropagation();if(this.isSubmenuItem(e)){e=this.getItemAlias(e)}try{r=JSON.parse(BX.data(e,"item"))}catch(l){}h=this.getItemEditMenu();if(h&&h.popupWindow.isShown()&&this.lastEditNode===e){h.popupWindow.close()}else{this.showItemEditMenu(r,t.target)}this.lastEditNode=e}if(this.isSetHide(e)){o=this.getVisibleItems();u=BX.type.isArray(o)?o.length:null;a=this.editItemData.ID.replace(this.listContainer.id+"_","");i=this.getItemById(a);n=this.getItemAlias(i);i=this.isVisibleItem(i)?i:n;if(this.isDisabled(n)){this.enableItem(n)}else if(!this.isDisabled(n)&&u>2){this.disableItem(n)}if(u===2){BX.onCustomEvent(window,"BX.Main.InterfaceButtons:onHideLastVisibleItem",[i,this])}this.refreshSubmenu();this.saveSettings();this.adjustMoreButtonPosition();if(this.isEditEnabled()){this.enableEdit();BX.hide(this.getSettingsButton());BX.show(this.getSettingsApplyButton())}this.editMenu.popupWindow.close()}if(this.isSetHome(e)){a=this.editItemData.ID.replace(this.listContainer.id+"_","");i=this.getItemById(a);n=this.getItemAlias(i);if(this.isDisabled(n)){this.enableItem(n)}this.listContainer.insertBefore(i,BX.firstChild(this.listContainer));this.adjustMoreButtonPosition();this.refreshSubmenu();this.saveSettings();if(this.isEditEnabled()){this.enableEdit();BX.hide(this.getSettingsButton());BX.show(this.getSettingsApplyButton())}this.editMenu.popupWindow.close()}}if(this.isEditEnabled()){this.getSubmenu().popupWindow.setAutoHide(false)}},isActiveInMoreMenu:function(){var t=this.getHiddenItems();var e=this.getDisabledItems();var s=t.concat(e);return s.some(function(t){var e;try{e=JSON.parse(BX.data(t,"item"))}catch(s){}return BX.type.isPlainObject(e)&&("IS_ACTIVE"in e&&e.IS_ACTIVE===true||e.IS_ACTIVE==="true"||e.IS_ACTIVE==="Y")},this)},_onPush:function(t,e){if(t==="user_counter"&&e&&BX.message("SITE_ID")in e){var s=e[BX.message("SITE_ID")];for(var i in s){if(s.hasOwnProperty(i)){this.updateCounter(i,s[i])}}}},bindOnScrollWindow:function(){BX.bind(window,"scroll",BX.delegate(this._onScroll,this))},getActive:function(){var t=this.getAllItems();var e,s;var i=null;if(BX.type.isArray(t)){t.forEach(function(t){try{e=JSON.parse(BX.data(t,"item"))}catch(s){e=null}if(BX.type.isPlainObject(e)&&"IS_ACTIVE"in e&&(e.IS_ACTIVE===true||e.IS_ACTIVE==="true"||e.IS_ACTIVE==="Y")){i=e}},this)}if(BX.type.isPlainObject(i)){s=BX(i.ID);if(BX.type.isDomNode(s)){i.NODE=s}else{i.NODE=null}}return i},isSetHome:function(t){return BX.hasClass(t,this.classSetHome)},isSetHide:function(t){return BX.hasClass(t,this.classSetHide)},getSettingsButton:function(){return BX.Buttons.Utils.getByClass(this.getSubmenuContainer(),this.classSettingMenuItem)},getSettingsApplyButton:function(){return BX.Buttons.Utils.getByClass(this.getSubmenuContainer(),this.classSettingsApplyButton)},isApplySettingsButton:function(t){return BX.hasClass(t,this.classSettingsApplyButton)},enableEdit:function(){var t=this.getSubmenu();if(t&&"popupWindow"in t){t.popupWindow.setAutoHide(false)}BX.addClass(this.listContainer,this.classEditState);BX.addClass(this.getSubmenuContainer(),this.classEditState);this.isEditEnabledState=true},disableEdit:function(){var t=this.getSubmenu();if(t&&"popupWindow"in t){t.popupWindow.setAutoHide(true)}BX.removeClass(this.listContainer,this.classEditState);BX.removeClass(this.getSubmenuContainer(),this.classEditState);this.isEditEnabledState=false},isEditEnabled:function(){return this.isEditEnabledState},showItemEditMenu:function(t,e){if(BX.type.isPlainObject(t)&&"ID"in t){var s=[this.listContainer.id,"_edit_item"].join("");var i=BX.PopupMenu.getMenuById(s);if(i){BX.PopupMenu.destroy(s)}i=this.createItemEditMenu(t,s,e);i.popupWindow.show()}},getContainer:function(){if(!BX.type.isDomNode(this.container)){this.container=BX(this.containerId).parentNode}return this.container},getItemEditMenu:function(){return BX.PopupMenu.getMenuById([this.listContainer.id,"_edit_item"].join(""))},createItemEditMenu:function(t,e,s){var i;var n=[{text:this.message("MIB_SET_HOME"),className:"main-buttons-set-home menu-popup-no-icon"}];var a=t.ID.replace(this.listContainer.id+"_","");var o=this.getItemById(a);if(this.isDisabled(o)){n.push({text:this.message("MIB_SET_SHOW"),className:"main-buttons-set-hide menu-popup-no-icon"})}else{n.push({text:this.message("MIB_SET_HIDE"),className:"main-buttons-set-hide menu-popup-no-icon"})}var u=BX.pos(s);var r={menuId:e,anchor:s,menuItems:n,settings:{autoHide:true,offsetTop:0,offsetLeft:u.width/2,zIndex:20,angle:{position:"top",offset:u.width/2}}};i=BX.PopupMenu.create(r.menuId,r.anchor,r.menuItems,r.settings);if(this.isVisibleItem(o)){t.NODE=o}else{t.NODE=this.getItemAlias(o)}this.editItemData=t;if("menuItems"in i&&BX.type.isArray(i.menuItems)){i.menuItems.forEach(function(t){BX.bind(t.layout.item,"click",BX.delegate(this._onDocumentClick,this))},this)}BX.onCustomEvent(window,"BX.Main.InterfaceButtons:onBeforeCreateEditMenu",[i,t,this]);this.editMenu=i;return i},setHome:function(){var t=this.getVisibleItems();var e=BX.type.isArray(t)&&t.length>0?t[0]:null;var s=BX.Buttons.Utils.getByTag(e,"a");if(!BX.type.isDomNode(s)){return}var i=s.getAttribute("href");if(i.charAt(0)==="?"){i=s.pathname+s.search}if(!this.lastHomeLink){this.lastHomeLink=i}if(this.lastHomeLink!==i){BX.userOptions.save("ui",this.listContainer.id,"firstPageLink",i);BX.onCustomEvent("BX.Main.InterfaceButtons:onFirstItemChange",[i,e])}this.lastHomeLink=i},isEditButton:function(t){return BX.hasClass(t,this.classEditItemButton)},isDragButton:function(t){return BX.hasClass(t,this.classDragItemButton)},isResetSettingsButton:function(t){return BX.hasClass(t,this.classSettingsResetButton)},getContainerHeight:function(){var t=this.getAllItems().map(function(t){var e=getComputedStyle(t);return BX.height(t)+parseInt(e.marginTop)+parseInt(e.marginBottom)});return Math.max.apply(Math,t)},setContainerHeight:function(){var t=this.getContainerHeight();BX.height(this.listContainer,t)},setLicenseWindowParams:function(t){this.licenseParams=t||{}},message:function(t){var e;try{e=this.messages[t]}catch(s){e=""}return e},setCustomClasses:function(t){if(!BX.type.isPlainObject(t)){return}this.classItem=t.item||this.classItem;this.classItemSublink=t.itemSublink||this.classItemSublink;this.classItemText=t.itemText||this.classItemText;this.classItemCounter=t.itemCounter||this.classItemCounter;this.classItemIcon=t.itemIcon||this.classItemIcon;this.classItemMore=t.itemMore||this.classItemMore;this.classItemOver=t.itemOver||this.classItemOver;this.classItemActive=t.itemActive||this.classItemActive;this.classItemDisabled=t.itemDisabled||this.classItemDisabled;this.classOnDrag=t.onDrag||this.classOnDrag;this.classDropzone=t.dropzone||this.classDropzone;this.classSeporator=t.separator||this.classSeporator;this.classSubmenuItem=t.submenuItem||this.classSubmenuItem;this.classSubmenu=t.submenu||this.classSubmenu;this.classSecret=t.secret||this.classSecret;this.classItemLocked=t.itemLocked||this.classItemLocked},setMessages:function(t){if(!BX.type.isPlainObject(t)){return}this.messages=t},makeFullItemId:function(t){if(!BX.type.isNotEmptyString(t)){return}return[this.listContainer.id,t.replace("-","_")].join("_")},getItemById:function(t){var e=null;var s;if(BX.type.isNotEmptyString(t)){s=this.makeFullItemId(t);e=BX.Buttons.Utils.getBySelector(this.listContainer,"#"+s)}return e},getItemCounterObject:function(t){var e=null;if(BX.type.isDomNode(t)){e=BX.Buttons.Utils.getByClass(t,this.classItemCounter)}return e},setCounterValue:function(t,e){var s=this.getItemCounterObject(t);if(BX.type.isDomNode(s)){s.innerText=e>99?"99+":e>0?e:"";t.dataset.counter=e}this.updateMoreButtonCounter()},updateCounter:function(t,e){var s,i,n;var a=null;var o=this.getAllItems();if(BX.type.isArray(o)){o.forEach(function(e){try{i=JSON.parse(BX.data(e,"item"))}catch(s){i={}}if(BX.type.isPlainObject(i)&&"COUNTER_ID"in i&&i.COUNTER_ID===t){a=e}},this)}s=this.getItemCounterObject(a);if(BX.type.isDomNode(s)){a=this.getItem(s);s.innerText=e>99?"99+":e>0?e:"";a.dataset.counter=e}n=this.getItemAlias(a);if(BX.type.isDomNode(n)){s=this.getItemCounterObject(n);if(BX.type.isDomNode(s)){s.innerText=e>99?"99+":e>0?e:"";n.dataset.counter=e}}this.updateMoreButtonCounter()},setCounterValueByItemId:function(t,e){var s=e!==null?parseFloat(e):null;var i,n;if(!BX.type.isNotEmptyString(t)){throw"Bad first arg. Need string as item id"}if(s!==null&&!BX.type.isNumber(s)){throw"Bad two arg. Need number counter value - Integer, Float or string with number"}i=this.getItemById(t);if(!BX.type.isDomNode(i)){console.info("Not found node with id #"+t);return}n=this.getItemAlias(i);this.setCounterValue(i,s);this.setCounterValue(n,s)},getCounterValueByItemId:function(t){var e,s;var i=NaN;if(!BX.type.isNotEmptyString(t)){throw"Bad first arg. Need string item id"}else{e=this.getItemById(t);i=this.dataValue(e,"counter");i=parseFloat(i);if(!BX.type.isNumber(i)){s=this.getItemCounterObject(e);i=parseFloat(s.innerText)}}return i},setMoreButtonCounter:function(t){var e=this.getItemCounterObject(this.moreButton);var s=t>99?"99+":t>0?t:"";s=parseInt(s);s=BX.type.isNumber(s)?s:"";e.innerText=s},bindOnClickOnMoreButton:function(){BX.bind(this.moreButton,"click",BX.delegate(this._onClickMoreButton,this))},bindOnResizeFrame:function(){window.frames["maininterfacebuttonstmpframe-"+this.getId()].onresize=BX.throttle(this._onResizeHandler,20,this)},getId:function(){return BX.Buttons.Utils.getByClass(this.getContainer(),this.classInner).id},getAllItems:function(){return BX.Buttons.Utils.getByClass(this.listContainer,this.classItem,true)},getVisibleItems:function(){var t=this.getAllItems();var e=this;var s=[];if(t&&t.length){s=t.filter(function(t){return e.isVisibleItem(t)&&!e.isDisabled(t)})}return s},getHiddenItems:function(){var t=this.getAllItems();var e=[];var s=this;if(t&&t.length){e=t.filter(function(t){return!s.isVisibleItem(t)&&!s.isDisabled(t)})}return e},getDisabledItems:function(){return this.getAllItems().filter(function(t){return this.isDisabled(t)},this)},getMoreButton:function(){var t=null;this.getAllItems().forEach(function(e){!t&&BX.hasClass(e,this.classItemMore)&&(t=e)},this);return t},getLastVisibleItem:function(){var t=this.getVisibleItems();var e=null;if(BX.type.isArray(t)&&t.length){e=t[t.length-1]}if(!BX.type.isDomNode(e)){e=null}return e},adjustMoreButtonPosition:function(){var t=this.getLastVisibleItem();var e=this.isMoreButton(t);if(!e){this.listContainer.insertBefore(this.moreButton,t)}this.updateMoreButtonCounter()},getSubmenuId:function(t){var e="";if(BX.type.isDomNode(this.listContainer)&&BX.type.isNotEmptyString(this.listContainer.id)){e=this.submenuIdPrefix+this.listContainer.id}if(t){e=this.submenuWindowIdPrefix+e}return e},getSubmenuItemText:function(t){var e,s,i;if(!BX.type.isDomNode(t)){return null}e=this.findChildrenByClassName(t,this.classItemText);s=this.findChildrenByClassName(t,this.classItemCounter);if(BX.type.isDomNode(s)&&BX.type.isDomNode(e)){s.dataset.counter=this.dataValue(t,"counter");i=e.outerHTML+s.outerHTML}else{e=this.dataValue(t,"text");s=this.dataValue(t,"counter");i=e}return i},getLockedClass:function(t){var e="";if(BX.type.isDomNode(t)&&this.isLocked(t)){e=this.classItemLocked}return e},getSubmenuItems:function(){var t=this.getAllItems();var e=this.getHiddenItems();var s=this.getDisabledItems();var i=[];var n,a;if(t.length){t.forEach(function(t){if(e.indexOf(t)===-1&&s.indexOf(t)===-1){i.push({text:this.getSubmenuItemText(t),href:this.dataValue(t,"url"),title:t.getAttribute("title"),className:[this.classSubmenuItem,this.getIconClass(t),this.classSecret,this.getAliasLink(t),this.getLockedClass(t)].join(" ")})}},this)}if(e.length){e.forEach(function(t){try{n=JSON.parse(this.dataValue(t,"item"))}catch(e){n=null}a=[this.classSubmenuItem,this.getIconClass(t),this.getAliasLink(t),this.getLockedClass(t)];if(BX.type.isPlainObject(n)&&("IS_ACTIVE"in n&&n.IS_ACTIVE===true||n.IS_ACTIVE==="true"||n.IS_ACTIVE==="Y")){a.push(this.classItemActive)}i.push({text:this.getSubmenuItemText(t),href:this.dataValue(t,"url"),title:t.getAttribute("title"),className:a.join(" ")})},this)}if(this.isSettingsEnabled){i.push({text:"<span>"+this.message("MIB_HIDDEN")+"</span>",className:[this.classSeporator,this.classSubmenuItem,this.classHiddenLabel].join(" ")});if(!s.length){i.push({text:"<span>"+this.message("MIB_NO_HIDDEN")+"</span>",className:[this.classSubmenuItem,this.classSubmenuNoHiddenItem].join(" ")})}if(s.length){s.forEach(function(t){try{n=JSON.parse(this.dataValue(t,"item"))}catch(e){n=null}a=[this.classSubmenuItem,this.classItemDisabled,this.getIconClass(t),this.getAliasLink(t),this.getLockedClass(t)];if(BX.type.isPlainObject(n)&&("IS_ACTIVE"in n&&n.IS_ACTIVE===true||n.IS_ACTIVE==="true"||n.IS_ACTIVE==="Y")){a.push(this.classItemActive)}i.push({text:this.getSubmenuItemText(t),href:this.dataValue(t,"url"),title:t.getAttribute("title"),className:a.join(" ")})},this)}i.push({text:"<span>"+this.message("MIB_MANAGE")+"</span>",className:[this.classSeporator,this.classSubmenuItem,this.classHiddenLabel,this.classManage].join(" ")});i.push({text:this.message("MIB_SETTING_MENU_ITEM"),className:[this.classSettingMenuItem,this.classSubmenuItem].join(" ")});i.push({text:this.message("MIB_APPLY_SETTING_MENU_ITEM"),className:[this.classSettingsApplyButton,this.classSubmenuItem].join(" ")});i.push({text:this.message("MIB_RESET_SETTINGS"),className:[this.classSettingsResetButton,this.classSubmenuItem].join(" ")})}return i},getSubmenuArgs:function(){var t=this.getSubmenuId();var e=this.moreButton;var s=BX.pos(e);var i=this.getSubmenuItems();var n={autoHide:true,offsetLeft:s.width/2-80,angle:{position:"top",offset:100},zIndex:20,events:{onPopupClose:BX.delegate(this._onSubmenuClose,this)}};return[t,e,i,n]},visibleControlMoreButton:function(){var t=this.getHiddenItems();if(!t.length||t.length===1&&this.isMoreButton(t[0])){this.getMoreButton().style.display="none"}else{this.getMoreButton().style.display=""}},createSubmenu:function(){var t=BX.PopupMenu.create.apply(BX.PopupMenu,this.getSubmenuArgs());if(this.isSettingsEnabled){this.dragAndDropInitInSubmenu()}t.menuItems.forEach(function(t){BX.bind(t.layout.item,"click",BX.delegate(this._onDocumentClick,this))},this);return t},showSubmenu:function(){var t=this.getSubmenu();if(t!==null){t.popupWindow.show()}else{this.destroySubmenu();t=this.createSubmenu();t.popupWindow.show()}this.setSubmenuShown(true);this.activateItem(this.moreButton);if(this.isEditEnabled()){t.popupWindow.setAutoHide(false)}},closeSubmenu:function(){var t=this.getSubmenu();if(t===null){return}t.popupWindow.close();if(!this.isActiveInMoreMenu()){this.deactivateItem(this.moreButton)}this.setSubmenuShown(false)},getSubmenu:function(){return BX.PopupMenu.getMenuById(this.getSubmenuId())},destroySubmenu:function(){BX.PopupMenu.destroy(this.getSubmenuId())},refreshSubmenu:function(){var t=this.getSubmenu();var e;if(t===null){return}e=this.getSubmenuArgs();if(BX.type.isArray(e)){this.destroySubmenu();this.createSubmenu();this.showSubmenu()}},setSubmenuShown:function(t){this.isSubmenuShown=false;if(BX.type.isBoolean(t)){this.isSubmenuShown=t}},activateItem:function(t){if(!BX.type.isDomNode(t)){return}if(!BX.hasClass(t,this.classItemActive)){BX.addClass(t,this.classItemActive)}},deactivateItem:function(t){if(!BX.type.isDomNode(t)){return}if(BX.hasClass(t,this.classItemActive)){BX.removeClass(t,this.classItemActive)}},getCurrentSettings:function(){var t={};this.getAllItems().forEach(function(e,s){t[e.id]={sort:s,isDisabled:this.isDisabled(e)}},this);return t},saveSettings:function(){var t=this.getCurrentSettings();var e="settings";var s;if(!BX.type.isPlainObject(t)){return}if(BX.type.isDomNode(this.listContainer)){if("id"in this.listContainer){s=this.listContainer.id;t=JSON.stringify(t);BX.userOptions.save("ui",s,e,t);this.setHome()}}},resetSettings:function(){var t=null;var e=BX.PopupWindowManager.create(this.listContainer.id+"_reset_popup",null,{content:this.message("MIB_RESET_ALERT"),autoHide:false,overlay:true,closeByEsc:true,closeIcon:true,draggable:{restrict:true},titleBar:this.message("MIB_RESET_SETTINGS"),buttons:[t=new BX.PopupWindowButton({text:this.message("MIB_RESET_BUTTON"),className:"popup-window-button-create",events:{click:function(){if(BX.hasClass(t.buttonNode,"popup-window-button-wait")){return}BX.addClass(t.buttonNode,"popup-window-button-wait");this.handleResetSettings(function(s){if(s){BX.removeClass(t.buttonNode,"popup-window-button-wait");e.setContent(s)}else{var i="settings";BX.userOptions.save("ui",this.listContainer.id,i,JSON.stringify({}));BX.userOptions.save("ui",this.listContainer.id,"firstPageLink","");window.location.reload()}}.bind(this))}.bind(this)}}),new BX.PopupWindowButtonLink({text:this.message("MIB_CANCEL_BUTTON"),className:"popup-window-button-link-cancel",events:{click:function(){this.popupWindow.close()}}})]});e.show()},handleResetSettings:function(t){var e=[];BX.onCustomEvent("BX.Main.InterfaceButtons:onBeforeResetMenu",[e,this]);var s=new BX.Promise;var i=s;for(var n=0;n<e.length;n++){s=s.then(e[n])}s.then(function(e){t(null,e)},function(e){t(e,null)});i.fulfill()},moveButtonAlias:function(t){var e,s;if(!t||!this.dragItem){return}e=this.getItemAlias(this.dragItem);s=this.getItemAlias(t);if(this.isListItem(e)){if(!s){this.listContainer.appendChild(e)}else{this.listContainer.insertBefore(e,s)}}},moveButton:function(t){var e;if(!BX.type.isDomNode(t)||!BX.type.isDomNode(this.dragItem)){return}if(this.isListItem(t)){if(this.isDisabled(this.dragItem)){this.dragItem.dataset.disabled="false"}if(BX.type.isDomNode(t)){this.listContainer.insertBefore(this.dragItem,t)}else{this.listContainer.appendChild(this.dragItem)}}if(this.isSubmenuItem(t)){if(this.isDisabled(this.dragItem)&&!this.isDisabled(t)){this.enableItem(this.dragItem)}e=this.getSubmenuContainer();e.insertBefore(this.dragItem,t)}},getSubmenuContainer:function(){var t=this.getSubmenu();var e=null;if(t!==null){e=t.itemsContainer}return e},findNextSiblingByClass:function(t,e){var s=t;for(;!!t;t=t.nextElementSibling){if(e){if(BX.hasClass(t,e)&&t!==s){return t}}else{return null}}},findParentByClassName:function(t,e){for(;t&&t!==document;t=t.parentNode){if(e){if(BX.hasClass(t,e)){return t}}else{return null}}},findChildrenByClassName:function(t,e){var s=null;if(BX.type.isDomNode(t)&&BX.type.isNotEmptyString(e)){s=BX.Buttons.Utils.getByClass(t,e)}return s},dragAndDropInit:function(){this.getAllItems().forEach(function(t,e){if(!this.isSeparator(t)&&!this.isSettings(t)&&!this.isApplySettingsButton(t)&&!this.isResetSettingsButton(t)){t.setAttribute("draggable","true");t.setAttribute("tabindex","-1");t.dataset.link="item"+e;BX.bind(t,"dragstart",BX.delegate(this._onDragStart,this));BX.bind(t,"dragend",BX.delegate(this._onDragEnd,this));BX.bind(t,"dragenter",BX.delegate(this._onDragEnter,this));BX.bind(t,"dragover",BX.delegate(this._onDragOver,this));BX.bind(t,"dragleave",BX.delegate(this._onDragLeave,this));BX.bind(t,"drop",BX.delegate(this._onDrop,this))}BX.bind(t,"mouseover",BX.delegate(this._onMouse,this));BX.bind(t,"mouseout",BX.delegate(this._onMouse,this))},this)},dragAndDropInitInSubmenu:function(){var t=this.getSubmenu();var e=t.menuItems;e.forEach(function(t){if(!this.isSeparator(t.layout.item)&&!this.isSettings(t.layout.item)&&!this.isApplySettingsButton(t.layout.item)&&!this.isResetSettingsButton(t.layout.item)){t.layout.item.draggable=true;t.layout.item.dataset.sortable=true;BX.bind(t.layout.item,"dragstart",BX.delegate(this._onDragStart,this));BX.bind(t.layout.item,"dragenter",BX.delegate(this._onDragEnter,this));BX.bind(t.layout.item,"dragover",BX.delegate(this._onDragOver,this));BX.bind(t.layout.item,"dragleave",BX.delegate(this._onDragLeave,this));BX.bind(t.layout.item,"dragend",BX.delegate(this._onDragEnd,this));BX.bind(t.layout.item,"drop",BX.delegate(this._onDrop,this))}if(BX.hasClass(t.layout.item,this.classHiddenLabel)&&!BX.hasClass(t.layout.item,this.classManage)){BX.bind(t.layout.item,"dragover",BX.delegate(this._onDragOver,this))}},this)},getItem:function(t){if(!BX.type.isDomNode(t)){if(!t||!BX.type.isDomNode(t.target)){return null}}else{t={target:t}}var e=this.findParentByClassName(t.target,this.classItem);if(!BX.type.isDomNode(e)){e=this.findParentByClassName(t.target,this.classDefaultSubmenuItem)}return e},setOpacity:function(t){if(!BX.type.isDomNode(t)){return}BX.style(t,"opacity",".1")},unsetOpacity:function(t){if(!BX.type.isDomNode(t)){return}BX.style(t,"opacity","1")},setDragStyles:function(){BX.addClass(this.listContainer,this.classOnDrag);BX.addClass(BX(this.getSubmenuId(true)),this.classOnDrag);this.setOpacity(this.dragItem)},unsetDragStyles:function(){var t=this.getSubmenu();this.getAllItems().forEach(function(t){this.unsetOpacity(t);BX.removeClass(t,"over")},this);if(t&&"menuItems"in t&&BX.type.isArray(t.menuItems)&&t.menuItems.length){t.menuItems.forEach(function(t){this.unsetOpacity(t);BX.removeClass(t.layout.item,"over")},this)}BX.removeClass(this.listContainer,this.classOnDrag);BX.removeClass(BX(this.getSubmenuId(true)),this.classOnDrag)},getIconClass:function(t){var e="";if(BX.type.isDomNode(t)&&"dataset"in t&&"class"in t.dataset&&BX.type.isNotEmptyString(t.dataset.class)){e=t.dataset.class}return e},disableItem:function(t){var e=this.getItemAlias(t);if(t&&"dataset"in t){t.dataset.disabled="true";if(e){e.dataset.disabled="true"}}},enableItem:function(t){var e;if(!BX.type.isDomNode(t)){return}if(this.isSubmenuItem(t)){BX.removeClass(t,this.classItemDisabled);e=this.getItemAlias(t);if(BX.type.isDomNode(e)){e.dataset.disabled="false"}}},getAliasLink:function(t){return this.dataValue(t,"link")||""},getItemAlias:function(t){var e=null;if(!BX.type.isDomNode(t)){return e}var s=this.getAllItems();var i=this.isSubmenuItem(t);var n=this.isListItem(t);if(!i&&!n){return e}if(i){s.forEach(function(s){BX.hasClass(t,this.getAliasLink(s))&&(e=s)},this)}if(n){e=BX.Buttons.Utils.getByClass(document,this.getAliasLink(t))}return e},hideItem:function(t){!!t&&BX.addClass(t,this.classSecret)},showItem:function(t){!!t&&BX.removeClass(t,this.classSecret)},fakeDragItem:function(){var t=null;if(!BX.type.isDomNode(this.dragItem)||!BX.type.isDomNode(this.overItem)){return}if(this.isDragToSubmenu()){t=this.getItemAlias(this.dragItem);if(t!==this.dragItem){this.listContainer.appendChild(this.dragItem);this.dragItem=t;this.showItem(this.dragItem);this.adjustMoreButtonPosition();this.updateSubmenuItems();this.tmp.moved=false;this.tmp.movetToSubmenu=true;this.setOpacity(this.dragItem)}}if(this.isDragToList()&&!this.tmp.movetToSubmenu){t=this.getItemAlias(this.dragItem);if(t!==this.dragItem){this.hideItem(this.dragItem);this.dragItem=t;this.adjustMoreButtonPosition();this.updateSubmenuItems();this.setOpacity(this.dragItem)}}this.tmp.movetToSubmenu=false},updateSubmenuItems:function(){var t=this.getHiddenItems();var e=this.getDisabledItems();var s=this;var i=[];var n,a,o;n=this.getSubmenu();if(n===null){return}a=n.menuItems;if(!BX.type.isArray(a)||!a.length){return}i=e.concat(t);a.forEach(function(t){o=[].some.call(i,function(e){return BX.hasClass(t.layout.item,s.dataValue(e,"link"))||s.isDisabled(t.layout.item)||s.isSeparator(t.layout.item)||s.isDropzone(t.layout.item)});if(o||(s.isSettings(t.layout.item)||s.isApplySettingsButton(t.layout.item)||s.isResetSettingsButton(t.layout.item)||s.isNotHiddenItem(t.layout.item)||s.isSeparator(t.layout.item)||t.layout.item===s.dragItem)&&!s.isMoreButton(t.layout.item)){s.showItem(t.layout.item)}else{s.hideItem(t.layout.item)}})},isNotHiddenItem:function(t){return BX.hasClass(t,this.classSubmenuNoHiddenItem)},getNotHidden:function(){return BX.Buttons.Utils.getByClass(this.getSubmenuContainer(),this.classSubmenuNoHiddenItem)},setOverStyles:function(t){if(BX.type.isDomNode(t)&&!BX.hasClass(t,this.classItemOver)){BX.addClass(t,this.classItemOver)}},unsetOverStyles:function(t){if(BX.type.isDomNode(t)&&BX.hasClass(t,this.classItemOver)){BX.removeClass(t,this.classItemOver)}},dataValue:function(t,e){var s="";var i;if(BX.type.isDomNode(t)){i=BX.data(t,e);if(typeof i!=="undefined"){s=i}}return s},execScript:function(script){if(BX.type.isNotEmptyString(script)){eval(script)}},showLicenseWindow:function(){var t;if(!B24.licenseInfoPopup){return}t=B24.licenseInfoPopup;t.init({B24_LICENSE_BUTTON_TEXT:this.message("MIB_LICENSE_BUY_BUTTON"),B24_TRIAL_BUTTON_TEXT:this.message("MIB_LICENSE_TRIAL_BUTTON"),IS_FULL_DEMO_EXISTS:this.licenseParams.isFullDemoExists,HOST_NAME:this.licenseParams.hostname,AJAX_URL:this.licenseParams.ajaxUrl,LICENSE_ALL_PATH:this.licenseParams.licenseAllPath,LICENSE_DEMO_PATH:this.licenseParams.licenseDemoPath,FEATURE_GROUP_NAME:this.licenseParams.featureGroupName,AJAX_ACTIONS_URL:this.licenseParams.ajaxActionsUrl,B24_FEATURE_TRIAL_SUCCESS_TEXT:this.message("MIB_LICENSE_WINDOW_TRIAL_SUCCESS_TEXT")});t.show("main-buttons",this.message("MIB_LICENSE_WINDOW_HEADER_TEXT"),this.message("MIB_LICENSE_WINDOW_TEXT"))},_onDragStart:function(t){var e=this.getVisibleItems();var s=BX.type.isArray(e)?e.length:null;this.dragItem=this.getItem(t);if(!BX.type.isDomNode(this.dragItem)){return}if(s===2&&this.isListItem(this.dragItem)){t.preventDefault();BX.onCustomEvent(window,"BX.Main.InterfaceButtons:onHideLastVisibleItem",[this.dragItem,this]);return}if(this.isMoreButton(this.dragItem)||this.isSeparator(this.dragItem)||this.isNotHiddenItem(this.dragItem)){t.preventDefault();return}this.isSubmenuShownOnDragStart=!!this.isSubmenuShown;if(this.isListItem(this.dragItem)){this.showSubmenu()}this.setDragStyles();if(!this.isEditEnabled()){this.enableEdit()}},_onDragEnd:function(t){t.preventDefault();var e=this.getItem(t);var s,i;if(!BX.type.isDomNode(e)){return}this.unsetDragStyles();if(!this.isSubmenuShownOnDragStart){this.refreshSubmenu();if(!this.isEditEnabled()){this.closeSubmenu()}}else{this.refreshSubmenu()}s=BX.findNextSibling(this.dragItem,BX.delegate(function(t){return this.isVisibleItem(t)},this));i=BX.findPreviousSibling(this.dragItem,BX.delegate(function(t){return this.isVisibleItem(t)},this));if(BX.type.isDomNode(i)&&(BX.hasClass(i,this.classHiddenLabel)||this.isDisabled(i)&&this.isSubmenuItem(i))||(BX.type.isDomNode(s)&&BX.hasClass(s,this.classManage)||this.isDisabled(s)&&this.isSubmenuItem(s))){this.disableItem(this.dragItem);this.refreshSubmenu()}if(this.isEditEnabled()){this.enableEdit();BX.show(this.getSettingsApplyButton());BX.hide(this.getSettingsButton())}else{this.disableEdit();

BX.hide(this.getSettingsApplyButton());BX.show(this.getSettingsButton())}this.updateMoreButtonCounter();this.saveSettings();this.dragItem=null;this.overItem=null;this.tmp.moved=false},updateMoreButtonCounter:function(){var t,e,s,i;t=this.getHiddenItems();i=this.getDisabledItems();t=t.concat(i);e=0;if(BX.type.isArray(t)){t.forEach(function(t){e+=parseInt(this.dataValue(t,"counter"))||0},this)}if(BX.type.isNumber(e)){this.setMoreButtonCounter(e)}},_onDragEnter:function(t){var e=this.getItem(t);if(BX.type.isDomNode(e)&&this.isNotHiddenItem(e)){this.setOverStyles(e)}},_onDragOver:function(t){t.preventDefault();var e=null;this.overItem=this.getItem(t);if(!BX.type.isDomNode(this.overItem)||!BX.type.isDomNode(this.dragItem)||this.overItem===this.dragItem||this.isNotHiddenItem(this.overItem)){return}this.fakeDragItem();if(this.isNext(t)&&this.isGoodPosition(t)&&!this.isMoreButton(this.overItem)){e=this.findNextSiblingByClass(this.overItem,this.classItem);if(this.isMoreButton(e)&&!this.tmp.moved){e=e.previousElementSibling;this.tmp.moved=true}if(!BX.type.isDomNode(e)){e=this.findNextSiblingByClass(this.overItem,this.classSubmenuItem)}if(BX.type.isDomNode(e)){this.moveButton(e);this.moveButtonAlias(e);this.adjustMoreButtonPosition();this.updateSubmenuItems()}}if(!this.isNext(t)&&this.isGoodPosition(t)&&!this.isMoreButton(this.overItem)||!this.isGoodPosition(t)&&this.isMoreButton(this.overItem)&&this.getVisibleItems().length===1){this.moveButton(this.overItem);this.moveButtonAlias(this.overItem);this.adjustMoreButtonPosition();this.updateSubmenuItems()}},_onDragLeave:function(t){var e=this.getItem(t);if(BX.type.isDomNode(e)){this.unsetOverStyles(t.target)}},_onDrop:function(t){var e=this.getItem(t);if(!BX.type.isDomNode(e)){return}if(this.isNotHiddenItem(e)||this.isDisabled(e)){this.disableItem(this.dragItem);this.adjustMoreButtonPosition()}this.unsetDragStyles();t.preventDefault()},getIndex:function(t,e){return[].indexOf.call(t||[],e)},_onSubmenuClose:function(){this.setSubmenuShown(false);if(this.isEditEnabled()){this.activateItem(this.moreButton)}else{if(!this.isActiveInMoreMenu()){this.deactivateItem(this.moreButton)}}},_onResizeHandler:function(){this.adjustMoreButtonPosition();this.updateSubmenuItems();if(!this.isSettingsEnabled){this.visibleControlMoreButton()}},_onClickMoreButton:function(t){t.preventDefault();this.showSubmenu()},_onMouse:function(t){var e=this.getItem(t);if(t.type==="mouseover"&&!BX.hasClass(e,this.classItemOver)){BX.addClass(e,this.classItemOver)}if(t.type==="mouseout"&&BX.hasClass(e,this.classItemOver)){BX.removeClass(e,this.classItemOver)}},getSettingsResetButton:function(){return BX.Buttons.Utils.getByClass(this.getSubmenuContainer(),this.classSettingsResetButton)},_onScroll:function(){if(BX.style(this.pinContainer,"position")==="fixed"){this.closeSubmenu()}},isDisabled:function(t){var e=false;if(BX.type.isDomNode(t)){e=this.dataValue(t,"disabled")==="true"||BX.hasClass(t,this.classItemDisabled)}return e},isSettings:function(t){var e=false;if(BX.type.isDomNode(t)){e=BX.hasClass(t,this.classSettingMenuItem)}return e},isLocked:function(t){var e=false;if(BX.type.isDomNode(t)){e=this.dataValue(t,"locked")==="true"||BX.hasClass(t,this.classItemLocked)}return e},isDropzone:function(t){return BX.hasClass(t,this.classDropzone)},isNext:function(t){var e=this.dragItem.getBoundingClientRect();var s=this.overItem.getBoundingClientRect();var i=getComputedStyle(this.dragItem);var n=parseInt(i.marginRight.replace("px",""));var a=null;if(this.isListItem(this.overItem)){a=t.clientX>s.left-n&&t.clientX>e.right}if(this.isSubmenuItem(this.overItem)){a=t.clientY>e.top}return a},isGoodPosition:function(t){var e=this.overItem;var s,i;if(!BX.type.isDomNode(e)){return false}s=e.getBoundingClientRect();if(this.isListItem(e)){i=this.isNext(t)&&t.clientX>=s.left+s.width/2||!this.isNext(t)&&t.clientX<=s.left+s.width/2}if(this.isSubmenuItem(e)){i=this.isNext(t)&&t.clientY>=s.top+s.height/2||!this.isNext(t)&&t.clientY<=s.top+s.height/2}return i},isSubmenuItem:function(t){return BX.hasClass(t,this.classSubmenuItem)},isVisibleItem:function(t){if(!BX.type.isDomNode(t)){return false}return t.offsetTop===0},isMoreButton:function(t){var e=false;if(BX.type.isDomNode(t)&&BX.hasClass(t,this.classItemMore)){e=true}return e},isListItem:function(t){var e=false;if(BX.type.isDomNode(t)&&BX.hasClass(t,this.classItem)){e=true}return e},isSublink:function(t){var e=false;if(BX.type.isDomNode(t)){e=BX.hasClass(t,this.classItemSublink)}return e},isSeparator:function(t){var e=false;if(BX.type.isDomNode(t)){e=BX.hasClass(t,this.classSeporator)}return e},isDragToSubmenu:function(){return!this.isSubmenuItem(this.dragItem)&&this.isSubmenuItem(this.overItem)},isDragToList:function(){return this.isSubmenuItem(this.dragItem)&&!this.isSubmenuItem(this.overItem)}}}if(typeof BX.Main.interfaceButtonsManager==="undefined"){BX.Main.interfaceButtonsManager={data:{},init:function(t){var e=null;if(!BX.type.isPlainObject(t)||!("containerId"in t)){throw"BX.Main.interfaceButtonsManager: containerId not set in params Object"}e=BX(t.containerId);if(BX.type.isDomNode(e)){this.data[t.containerId]=new BX.Main.interfaceButtons(e,t)}else{BX(BX.delegate(function(){e=BX(t.containerId);if(!BX.type.isDomNode(e)){throw"BX.Main.interfaceButtonsManager: container is not dom node"}this.data[t.containerId]=new BX.Main.interfaceButtons(e,t)},this))}},getById:function(t){var e=null;if(BX.type.isString(t)&&BX.type.isNotEmptyString(t)){try{e=this.data[t]}catch(s){}}return e},getObjects:function(){return this.data}}}
/* End */
;
; /* Start:"a:4:{s:4:"full";s:94:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.min.js?1511316472575";s:6:"source";s:76:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.js";s:3:"min";s:80:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.min.js";s:3:"map";s:80:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Buttons");BX.Buttons.Utils={getByClass:function(e,t,l){var n=[];if(t){n=(e||document.body).getElementsByClassName(t);if(!l){n=n.length?n[0]:null}else{n=[].slice.call(n)}}return n},getByTag:function(e,t,l){var n=[];if(t){n=(e||document.body).getElementsByTagName(t);if(!l){n=n.length?n[0]:null}else{n=[].slice.call(n)}}return n},getBySelector:function(e,t,l){var n=[];if(t){if(!l){n=(e||document.body).querySelector(t)}else{n=(e||document.body).querySelectorAll(t);n=[].slice.call(n)}}return n}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:96:"/bitrix/components/bitrix/tasks.interface.filter/templates/.default/script.min.js?15113165983824";s:6:"source";s:77:"/bitrix/components/bitrix/tasks.interface.filter/templates/.default/script.js";s:3:"min";s:81:"/bitrix/components/bitrix/tasks.interface.filter/templates/.default/script.min.js";s:3:"map";s:81:"/bitrix/components/bitrix/tasks.interface.filter/templates/.default/script.map.js";}"*/
if(typeof BX.FilterEntitySelector==="undefined"){BX.FilterEntitySelector=function(){this._id="";this._settings={};this._fieldId="";this._control=null;this._selector=null;this._inputKeyPressHandler=BX.delegate(this.keypress,this)};BX.FilterEntitySelector.prototype={initialize:function(t,e){this._id=t;this._settings=e?e:{};this._fieldId=this.getSetting("fieldId","");BX.addCustomEvent(window,"BX.Main.Filter:customEntityFocus",BX.delegate(this.onCustomEntitySelectorOpen,this));BX.addCustomEvent(window,"BX.Main.Filter:customEntityBlur",BX.delegate(this.onCustomEntitySelectorClose,this))},getId:function(){return this._id},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},keypress:function(t){},open:function(t,e){this._selector=new BX.Tasks.Integration.Socialnetwork.NetworkSelector({scope:t,id:this.getId()+"-selector",mode:this.getSetting("mode"),query:e?e:false,useSearch:true,useAdd:false,parent:this,popupOffsetTop:5,popupOffsetLeft:40});this._selector.bindEvent("item-selected",BX.delegate(function(t){this._control.setData(BX.util.htmlspecialcharsback(t.nameFormatted),t.id);if(!this.getSetting("multi")){this._selector.close()}},this));this._selector.open()},close:function(){if(this._selector){this._selector.close()}},onCustomEntitySelectorOpen:function(t){this._control=t;if(this._fieldId!==t.getId()){this._selector=null;this.close()}else{this._selector=t;this.open(t.field)}},onCustomEntitySelectorClose:function(t){if(this._fieldId!==t.getId()){this.close()}}};BX.FilterEntitySelector.closeAll=function(){for(var t in this.items){if(this.items.hasOwnProperty(t)){this.items[t].close()}}};BX.FilterEntitySelector.items={};BX.FilterEntitySelector.create=function(t,e){var i=new BX.FilterEntitySelector(t,e);i.initialize(t,e);this.items[i.getId()]=i;return i}}if(typeof BX.TasksGroupsSelectorInit==="undefined"){BX.TasksGroupsSelectorInit=function(t){var e=null,i=t.selectorId,n=t.buttonAddId,s=t.pathTaskAdd.indexOf("?")===-1?t.pathTaskAdd+"?GROUP_ID=":t.pathTaskAdd+"&GROUP_ID=",o=t.messages,r=t.groups,l=t.currentGroup,d=t.groupLimit;var a=function(t){BX(n).setAttribute("href",s+t)};l.id=parseInt(l.id);l.text=BX.util.htmlspecialchars(l.text);a(l.id);BX.bind(BX(i),"click",function(){if(e===null){var t=[];var n=function(t,s){if(s.id!==l.id){var o=e.getMenuItems();e.addMenuItem({id:l.id,text:l.text,onclick:BX.delegate(n,this)},o.length>0?o[0]["id"]:null);if(s.id!=="wo"){if(e.getMenuItem(s.id)){e.removeMenuItem(s.id)}else if(o.length>=d){e.removeMenuItem(o[o.length-3].id)}}}e.close();l={id:s.id,text:s.text};a(s.id);BX(i+"_text").innerHTML=s.text;BX.onCustomEvent(this,"onTasksGroupSelectorChange",[l])};for(var s=0,c=r.length;s<c;s++){t.push({id:parseInt(r[s]["id"]),text:BX.util.htmlspecialchars(r[s]["text"]),onclick:BX.delegate(n,this)})}if(r.length>0){t.push({delimiter:true});t.push({id:"new",text:o.TASKS_BTN_GROUP_SELECT,onclick:function(){var t=new BX.Tasks.Integration.Socialnetwork.NetworkSelector({scope:BX.proxy_context,id:"group-selector",mode:"group",query:false,useSearch:true,useAdd:false,parent:this,popupOffsetTop:5,popupOffsetLeft:40});t.bindEvent("item-selected",function(e){n(null,{id:e.id,text:e.nameFormatted.length>50?e.nameFormatted.substring(0,50)+"...":e.nameFormatted});t.close()});t.open()}})}e=BX.PopupMenu.create(i,BX(i),t,{autoHide:true,closeByEsc:true})}e.popupWindow.show()})}}if(typeof BX.Tasks.SortManager==="undefined"){BX.Tasks.SortManager={setSort:function(t,e,i){e=e||"asc";if(BX.Main.gridManager!=undefined){var n=BX.Main.gridManager.getById(i).instance;n.sortByColumn({sort_by:t,sort_order:e});if(t==="SORTING"){n.getRows().enableDragAndDrop()}else{n.getRows().disableDragAndDrop()}}else{var s=window.location.toString();window.location.href=BX.util.add_url_param(s,{SORTF:t,SORTD:e})}}}}
/* End */
;
; /* Start:"a:4:{s:4:"full";s:89:"/bitrix/components/bitrix/main.ui.filter/templates/.default/script.min.js?151131647240526";s:6:"source";s:69:"/bitrix/components/bitrix/main.ui.filter/templates/.default/script.js";s:3:"min";s:73:"/bitrix/components/bitrix/main.ui.filter/templates/.default/script.min.js";s:3:"map";s:73:"/bitrix/components/bitrix/main.ui.filter/templates/.default/script.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Main");BX.Main.Filter=function(t,e,s,i,r){this.params=null;this.search=null;this.popup=null;this.presets=null;this.fields=null;this.types=null;this.dateTypes=null;this.settings=null;this.filter=null;this.api=null;this.isAddPresetModeState=false;this.init(t,e,s,i,r)};BX.Main.Filter.prototype={init:function(t,e,s,i,r){try{this.params=t;this.types=s;this.dateTypes=i;this.numberTypes=r;this.settings=new BX.Filter.Settings(e,this);BX.bind(document,"mousedown",BX.delegate(this._onDocumentClick,this));if(this.getParam("GRID_ID")){BX.addCustomEvent("Grid::ready",BX.delegate(this._onGridReady,this))}}catch(a){throw a}BX.bind(document,"keydown",BX.delegate(this._onDocumentKeydown,this));this.getSearch().updatePreset(this.getParam("CURRENT_PRESET"));if(this.getParam("CLEAR_GET")){this.clearGet()}BX.bind(window,"load",BX.delegate(function(){this.settings.get("AUTOFOCUS")&&this.adjustFocus()},this));this.firstInit=true},clearGet:function(){if("history"in window){var t=window.location.toString();var e=BX.util.remove_url_param(t,"apply_filter");window.history.replaceState(null,"",e)}},adjustFocus:function(){this.getSearch().adjustFocus()},_onAddPresetKeydown:function(t){if(BX.Filter.Utils.isKey(t,"enter")){this._onSaveButtonClick()}},_onDocumentKeydown:function(t){if(BX.Filter.Utils.isKey(t,"escape")){if(this.getPopup().isShown()){BX.onCustomEvent(window,"BX.Main.Filter:blur",[this]);this.closePopup();if(this.getParam("VALUE_REQUIRED_MODE")){this.restoreRemovedPreset()}}}},getApi:function(){if(!(this.api instanceof BX.Filter.Api)){this.api=new BX.Filter.Api(this)}return this.api},addSidebarItem:function(t,e,s){var i=this.getPreset();var r=i.getContainer();var a=i.createSidebarItem(t,e,s);var n=i.getPresetNodeById(t);if(BX.type.isDomNode(n)){BX.remove(n);BX.prepend(a,r)}else{r&&r.insertBefore(a,i.getAddPresetField())}BX.bind(a,"click",BX.delegate(i._onPresetClick,i))},saveUserSettings:function(t){var e={FILTER_ID:this.getParam("FILTER_ID"),GRID_ID:this.getParam("GRID_ID"),action:"SET_FILTER_ARRAY"};var s=this.getPreset();var i=s.getCurrentPresetId();var r={};this.params["PRESETS"]=BX.clone(this.editablePresets);r.current_preset=i;s.getPresets().forEach(function(t,e){var i=s.getPresetId(t);if(i&&i!=="tmp_filter"){var a=s.getPreset(i);var n=a.FIELDS.map(function(t){return t.NAME});a.TITLE=BX.util.htmlspecialchars(BX.util.htmlspecialcharsback(a.TITLE));a.SORT=e;s.updatePresetName(t,a.TITLE);r[i]={sort:e,name:a.TITLE,fields:this.preparePresetSettingsFields(a.FIELDS,n)}}},this);this.saveOptions(r,e,null,t)},isForAll:function(){var t=this.getForAllCheckbox();return t&&t.checked},getForAllCheckbox:function(){if(!this.forAllCheckbox){this.forAllCheckbox=BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classForAllCheckbox)}return this.forAllCheckbox},preparePresetSettingsFields:function(t){var e={};var s;(t||[]).forEach(function(t){switch(t.TYPE){case this.types.STRING:{e[t.NAME]=t.VALUE;break}case this.types.SELECT:{e[t.NAME]="VALUE"in t.VALUE?t.VALUE.VALUE:"";break}case this.types.MULTI_SELECT:{if(BX.type.isArray(t.VALUE)&&t.VALUE.length){t.VALUE.forEach(function(s,i){e[t.NAME]=BX.type.isPlainObject(e[t.NAME])?e[t.NAME]:{};e[t.NAME][i]=s.VALUE},this)}break}case this.types.CHECKBOX:{if(BX.type.isArray(t.VALUE)&&t.VALUE.length){t.VALUE.forEach(function(s,i){e[t.NAME]=BX.type.isPlainObject(e[t.NAME])?e[t.NAME]:{};e[t.NAME][i]=s.VALUE},this)}break}case this.types.DATE:{if(BX.type.isPlainObject(t.VALUES)){s=Object.keys(t.VALUES);e[t.NAME+"_datesel"]=t.SUB_TYPE.VALUE;s.forEach(function(s){e[t.NAME+s]=t.VALUES[s]},this)}break}case this.types.NUMBER:{if(BX.type.isPlainObject(t.VALUES)){s=Object.keys(t.VALUES);e[t.NAME+"_numsel"]=t.SUB_TYPE.VALUE;s.forEach(function(s){e[t.NAME+s]=t.VALUES[s]},this)}break}case this.types.CUSTOM_ENTITY:{if(BX.type.isPlainObject(t.VALUES)){e[t.NAME]=t.VALUES._value;e[t.NAME+"_label"]=t.VALUES._label}break}default:{break}}},this);return e},savePreset:function(){var t="filter_"+ +new Date;var e=BX.util.htmlspecialcharsback(this.getPreset().getAddPresetFieldInput().value);this.updatePreset(t,e,null,true);this.addSidebarItem(t,e);this.getPreset().applyPreset(t);this.getPreset().activatePreset(t);this.applyFilter()},updatePreset:function(t,e,s,i,r,a){var n=this.getFilterFieldsValues();var l=this.getPreset().getFields().map(function(t){return BX.data(t,"name")});var o=this.getPreset().getCurrentPresetData();var h={FILTER_ID:this.getParam("FILTER_ID"),GRID_ID:this.getParam("GRID_ID"),action:"SET_FILTER"};var d,u,c,f,g;var p={};d=Object.keys(n);if(!s){p.apply_filter="Y"}else{p.clear_filter="Y"}p.save="Y";p.fields=n;p.rows=l.join(",");p.preset_id=t||o.ID;if(BX.type.isNotEmptyString(e)){p.name=BX.util.htmlspecialchars(e)}else{c=this.getPreset().getPresetNodeById(p.preset_id);f=this.getPreset().getPresetInput(c);if(BX.type.isDomNode(f)&&BX.type.isNotEmptyString(f.value)){p.name=f.value}else{p.name=o.TITLE}}if((!("sort"in p)||!BX.type.isNumber(p.sort))&&i){g=this.getParam("PRESETS");p.sort=g.length+2}if(!s){d.forEach(function(t){if(BX.type.isArray(p.fields[t])){u=p.fields[t].length?{}:"";p.fields[t].forEach(function(t,e){u[e]=t},this);if(u||BX.type.isNumber(u)||BX.type.isBoolean(u)){p.fields[t]=u}}},this)}if(p.preset_id==="tmp_filter"||this.isAddPresetEnabled()||s){this.updateParams(p)}if(BX.type.isFunction(r)){r()}var B=new BX.Promise(null,this);B.setAutoResolve("fulfill",0);B.then(function(){var t=new BX.Promise(null,this);this.saveOptions(p,h,BX.proxy(t.fulfill,t));return t}).then(function(){!!a&&a()});return B},saveFieldsSort:function(){var t={FILTER_ID:this.getParam("FILTER_ID"),GRID_ID:this.getParam("GRID_ID"),action:"SET_FILTER"};var e=this.getPreset().getFields();var s={};s.preset_id="default_filter";if(BX.type.isArray(e)){s.rows=e.map(function(t){return BX.data(t,"name")});s.rows=s.rows.join(",")}this.updateParams(s);this.saveOptions(s,t)},updateParams:function(t){var e,s;var i=[];if(BX.type.isPlainObject(t)&&"preset_id"in t){e=this.getPreset().getPreset(t.preset_id);if(BX.type.isPlainObject(e)){if("name"in t&&BX.type.isNotEmptyString(t.name)){e.TITLE=t.name}if("rows"in t&&!("fields"in t)){t.fields={};t.rows.split(",").forEach(function(e){t.fields[e]=""})}if("fields"in t){e.FIELDS=this.preparePresetFields(t.fields,t.rows)}}else{s=this.getParam("PRESETS");e={ID:t.preset_id,TITLE:t.name,SORT:s.length+2,FIELDS:this.preparePresetFields(t.fields,t.rows)};s.push(e)}}},preparePresetFields:function(t,e){var s,i;var r=[];if(BX.type.isPlainObject(t)){e=BX.type.isNotEmptyString(e)?e.split(","):[];s=e.length?e:Object.keys(t);s.forEach(function(e){e=e.replace("_datesel","").replace("_numsel","");i=BX.clone(this.getFieldByName(e));if(BX.type.isPlainObject(i)){if(i.TYPE===this.types.STRING){i.VALUE=t[e]}if(i.TYPE===this.types.MULTI_SELECT){i.VALUE=this.prepareMultiSelectValue(t[e],i.ITEMS)}if(i.TYPE===this.types.SELECT||i.TYPE===this.types.CHECKBOX){i.VALUE=this.prepareSelectValue(t[e],i.ITEMS)}if(i.TYPE===this.types.DATE){i.SUB_TYPE=this.prepareSelectValue(t[e+"_datesel"],i.SUB_TYPES);i.VALUES={_from:t[e+"_from"],_to:t[e+"_to"],_days:t[e+"_days"],_month:t[e+"_days"],_quarter:t[e+"_quarter"],_year:t[e+"_year"]}}if(i.TYPE===this.types.NUMBER){i.SUB_TYPE=this.prepareSelectValue(t[e+"_numsel"],i.SUB_TYPES);i.VALUES={_from:t[e+"_from"],_to:t[e+"_to"]}}if(i.TYPE===this.types.CUSTOM_ENTITY){if(typeof t[e+"_label"]!=="undefined"){i.VALUES._label=t[e+"_label"]}if(typeof t[e]!=="undefined"){i.VALUES._value=t[e]}}if(i.TYPE===this.types.CUSTOM){i._VALUE=t[e]}r.push(i)}},this)}return r},prepareSelectValue:function(t,e){var s={};var i;if(BX.type.isNotEmptyString(t)&&BX.type.isArray(e)){i=this.prepareMultiSelectValue({0:t},e);s=i.length>0?i[0]:{}}else{s=e[0]}return s},prepareMultiSelectValue:function(t,e){var s=[];if(BX.type.isPlainObject(t)&&BX.type.isArray(e)){var i=Object.keys(t);var r=i.map(function(e){return t[e]});s=e.filter(function(t){return r.some(function(e){return e===t.VALUE})},this)}return s},getFieldByName:function(t){var e=this.getParam("FIELDS");e=e.filter(function(e){return e.NAME===t},this);return e.length>0?e[0]:null},saveOptions:function(t,e,s,i){if(this.isUseCommonPresets()){if(BX.type.isPlainObject(e)){e.common_presets_id=this.getParam("COMMON_PRESETS_ID")}}var r=BX.util.add_url_param(this.getParam("SETTINGS_URL"),e||{});i=BX.type.isBoolean(i)?i:!!this.getSaveForAllCheckbox()&&this.getSaveForAllCheckbox().checked;if(i&&("action"in e&&e.action==="SET_FILTER_ARRAY")){var a={CONFIRM:true,CONFIRM_MESSAGE:this.getParam("MAIN_UI_FILTER__CONFIRM_MESSAGE_FOR_ALL"),CONFIRM_APPLY_BUTTON:this.getParam("MAIN_UI_FILTER__CONFIRM_APPLY_FOR_ALL"),CONFIRM_CANCEL_BUTTON:this.getParam("CONFIRM_CANCEL")};this.confirmDialog(a,BX.delegate(function(){r=BX.util.add_url_param(r,{for_all:"true"});this.disableEdit();this.disableAddPreset();n(r,this,true)},this),BX.delegate(function(){},this))}else{n(r,this)}function n(e,i){BX.ajax.post(e,t,BX.delegate(function(){BX.removeClass(this.getFindButton(),this.settings.classWaitButtonClass);BX.type.isFunction(s)&&s()},i))}},prepareEvent:function(t){var e,s;if(!("path"in t)||!t.path.length){t.path=[t.target];e=0;while((s=t.path[e++].parentNode)!==null){t.path.push(s)}}return t},restoreRemovedPreset:function(){if(this.getParam("VALUE_REQUIRED_MODE")){var t=this.getParam("CURRENT_PRESET");if(BX.type.isPlainObject(t)){var e=t.ID;var s=this.getPreset().getPresetNodeById(e);this.getPreset().applyPreset(e);this.getPreset().activatePreset(s)}}},hasScrollClick:function(t){var e="clientX"in t?t.clientX:"x"in t?t.x:0;return e>=document.documentElement.offsetWidth},isUseCommonPresets:function(){return!!this.getParam("COMMON_PRESETS_ID")},isInsideFilterEvent:function(t){t=this.prepareEvent(t);return(t.path||[]).some(function(t){return BX.type.isDomNode(t)&&(BX.hasClass(t,this.settings.classFilterContainer)||BX.hasClass(t,this.settings.classSearchContainer)||BX.hasClass(t,this.settings.classDefaultPopup)||BX.hasClass(t,this.settings.classPopupOverlay))},this)},_onDocumentClick:function(t){var e=this.getPopup();if(!this.isInsideFilterEvent(t)&&!this.hasScrollClick(t)){if(e&&e.isShown()){this.closePopup();if(this.getParam("VALUE_REQUIRED_MODE")){this.restoreRemovedPreset()}}BX.onCustomEvent(window,"BX.Main.Filter:blur",[this])}},_onAddFieldClick:function(t){var e=this.getFieldsPopup();t.stopPropagation();t.preventDefault();if(e&&!e.isShown()){this.showFieldsPopup();this.syncFields()}else{this.closeFieldListPopup()}},syncFields:function(){var t=this.getPreset().getFields();var e=this.getFieldsPopupItems();var s,i;if(BX.type.isArray(e)&&e.length){e.forEach(function(e){s=BX.data(e,"name").replace("_datesel","").replace("_numsel","");i=t.some(function(t){return BX.data(t,"name")===s});if(i){BX.addClass(e,this.settings.classMenuItemChecked)}else{BX.removeClass(e,this.settings.classMenuItemChecked)}},this)}},getFieldsPopupItems:function(){var t;if(!BX.type.isArray(this.fieldsPopupItems)){t=this.getFieldsPopup();if("contentContainer"in t&&BX.type.isDomNode(t.contentContainer)){this.fieldsPopupItems=BX.Filter.Utils.getByClass(t.contentContainer,this.settings.classMenuItem,true)}}return this.fieldsPopupItems},getFieldListContainerClassName:function(t){var e=this.settings.classPopupFieldList1Column;if(t>6&&t<12){e=this.settings.classPopupFieldList2Column}if(t>12){e=this.settings.classPopupFieldList3Column}return e},prepareFieldsDecl:function(t){return(t||[]).map(function(t){return{block:"main-ui-filter-field-list-item",label:"LABEL"in t?t.LABEL:"",id:"ID"in t?t.ID:"",name:"NAME"in t?t.NAME:"",item:t,onClick:BX.delegate(this._clickOnFieldListItem,this)}},this)},getFieldsListPopupContent:function(){var t=this.getParam("FIELDS");var e=BX.type.isArray(t)?t.length:0;var s={block:this.settings.classPopupFieldList,mix:this.getFieldListContainerClassName(e),content:this.prepareFieldsDecl(t)};return BX.decl(s)},_clickOnFieldListItem:function(t){var e=t.target;var s;if(!BX.hasClass(e,this.settings.classFieldListItem)){e=BX.findParent(e,{"class":this.settings.classFieldListItem},true,false)}if(BX.type.isDomNode(e)){try{s=JSON.parse(BX.data(e,"item"))}catch(i){}if(BX.hasClass(e,this.settings.classMenuItemChecked)){BX.removeClass(e,this.settings.classMenuItemChecked);this.getPreset().removeField(s)}else{if(BX.type.isPlainObject(s)){this.getPreset().addField(s);BX.addClass(e,this.settings.classMenuItemChecked)}}this.syncFields()}},showFieldsPopup:function(){var t=this.getFieldsPopup();this.adjustFieldListPopupPosition();t.show()},closeFieldListPopup:function(){var t=this.getFieldsPopup();t.close()},adjustFieldListPopupPosition:function(){var t=this.getFieldsPopup();var e=BX.pos(this.getAddField());e.forceBindPosition=true;t.adjustPosition(e)},getFieldsPopup:function(){var t=this.getAddField();if(!this.fieldsPopup){this.fieldsPopup=new BX.PopupWindow(this.getParam("FILTER_ID")+"_fields_popup",t,{autoHide:true,offsetTop:4,offsetLeft:0,lightShadow:true,closeIcon:false,closeByEsc:false,noAllPaddings:true,zIndex:13});this.fieldsPopup.setContent(this.getFieldsListPopupContent())}return this.fieldsPopup},_onAddPresetClick:function(){this.enableAddPreset()},enableWaitSate:function(t){t&&BX.addClass(t,this.settings.classWaitButtonClass)},disableWaitState:function(t){t&&BX.removeClass(t,this.settings.classWaitButtonClass)},_onSaveButtonClick:function(){var t=!!this.getSaveForAllCheckbox()&&this.getSaveForAllCheckbox().checked;this.enableWaitSate(this.getFindButton());if(this.isAddPresetEnabled()&&!t){this.savePreset();this.disableAddPreset()}if(this.isEditEnabled()){var e=this.getPreset();e.updateEditablePreset(e.getCurrentPresetId());this.saveUserSettings(t);!t&&this.disableEdit()}},_onCancelButtonClick:function(){this.disableAddPreset();this.getPreset().clearAddPresetFieldInput();this.disableEdit();!!this.getSaveForAllCheckbox()&&(this.getSaveForAllCheckbox().checked=null)},_onGridReady:function(t){if(!this.grid&&t.getContainerId()===this.getParam("GRID_ID")){this.grid=t}},_onFilterMousedown:function(t){var e=t.target;if(this.getFields().isDragButton(e)){var s=BX.Filter.Utils.getByTag(e.parentNode,"input",true);(s||[]).forEach(function(t){BX.fireEvent(t,"blur")});BX.fireEvent(this.getFilter(),"click")}},_onFilterClick:function(t){var e=this.getFields();var s=this.getPreset();var i;if(e.isFieldDelete(t.target)){i=e.getField(t.target);s.removeField(i)}if(e.isFieldValueDelete(t.target)){i=e.getField(t.target);e.clearFieldValue(i)}},getButtonsContainer:function(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classButtonsContainer)},getSaveButton:function(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classSaveButton)},getCancelButton:function(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classCancelButton)},getFindButton:function(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classFindButton)},getResetButton:function(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classResetButton)},getAddPresetButton:function(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classAddPresetButton)},isAddPresetEnabled:function(){return this.isAddPresetModeState},enableAddPreset:function(){var t=this.getPreset();var e=t.getAddPresetField();var s=t.getAddPresetFieldInput();var i=this.getButtonsContainer();BX.show(e);BX.show(i);BX.hide(this.getPresetButtonsContainer());this.hideForAllCheckbox();if(BX.type.isDomNode(s)){s.focus()}BX.addClass(this.getSidebarControlsContainer(),this.settings.classDisabled);this.isAddPresetModeState=true},disableAddPreset:function(){var t=this.getPreset();var e=t.getAddPresetField();var s=this.getButtonsContainer();var i=t.getCurrentPresetId();BX.hide(e);BX.hide(s);BX.show(this.getPresetButtonsContainer());this.showForAllCheckbox();if(BX.type.isNotEmptyString(i)){t.applyPreset(i)}t.getAddPresetFieldInput().value="";BX.removeClass(this.getSidebarControlsContainer(),this.settings.classDisabled);this.isAddPresetModeState=false},getControls:function(){var t=this.getFieldListContainer();var e=null;if(BX.type.isDomNode(t)){e=BX.Filter.Utils.getByClass(t,this.settings.classControl,true)}return e},getFilterFields:function(){var t=this.getFieldListContainer();var e=[];var s=[];if(BX.type.isDomNode(t)){e=BX.Filter.Utils.getByClass(t,this.settings.classField,true);s=BX.Filter.Utils.getByClass(t,this.settings.classFieldGroup,true);if(!BX.type.isArray(e)){e=[]}if(BX.type.isArray(s)){s.forEach(function(t){e.push(t)})}}return e},getFilterFieldsValues:function(){var t=this.getPreset().getFields();var e=this.getSearch();var s={};var i,r;s["FIND"]=e.getInput().value;if(BX.type.isArray(t)&&t.length){t.forEach(function(t){i=BX.data(t,"type");r=BX.data(t,"name");switch(i){case this.types.STRING:{this.prepareControlStringValue(s,t);break}case this.types.NUMBER:{this.prepareControlNumberValue(s,r,t);break}case this.types.DATE:{this.prepareControlDateValue(s,r,t);break}case this.types.SELECT:{this.prepareControlSelectValue(s,r,t);break}case this.types.MULTI_SELECT:{this.prepareControlMultiselectValue(s,r,t);break}case this.types.CUSTOM:{this.prepareControlCustomValue(s,r,t);break}case this.types.CUSTOM_ENTITY:{this.prepareControlCustomEntityValue(s,r,t);break}default:{break}}},this)}return s},prepareControlCustomEntityValue:function(t,e,s){var i=this.fetchSquares(s);var r=this.fetchSquaresData(i);var a=BX.Main.ui.CustomEntity.isMultiple(s);t[e]="";t[e+"_label"]="";if(a){t[e]=[];t[e+"_label"]=[];!!r&&r.forEach(function(s){t[e].push(s._value.toString());t[e+"_label"].push(s._label.toString())})}else{if(r.length){t[e]=r[0]._value.toString();t[e+"_label"]=r[0]._label.toString()}}},fetchSquares:function(t){return!!t?BX.Filter.Utils.getByClass(t,this.settings.classSquare,true):[]},fetchSquaresData:function(t){return t.map(function(t){return JSON.parse(BX.data(t,"item"))},this)},prepareControlCustomValue:function(t,e,s){var i=BX.Filter.Utils.getByTag(s,"input",true);t[e]="";if(BX.type.isArray(i)){i.forEach(function(e){if(BX.type.isNotEmptyString(e.name)){t[e.name]=e.value}})}},prepareControlMultiselectValue:function(t,e,s){var i=BX.Filter.Utils.getByClass(s,this.settings.classMultiSelect);var r=JSON.parse(BX.data(i,"value"));t[e]="";if(BX.type.isArray(r)&&r.length){t[e]={};r.forEach(function(s,i){t[e][i]=s.VALUE})}},prepareControlSelectValue:function(t,e,s){var i=BX.Filter.Utils.getByClass(s,this.settings.classSelect);var r=JSON.parse(BX.data(i,"value"));t[e]=r.VALUE},prepareControlDateValue:function(t,e,s){var i=BX.Filter.Utils.getByClass(s,this.settings.classSelect);var r=e+this.settings.datePostfix;var a=e+this.settings.fromPostfix;var n=e+this.settings.toPostfix;var l=e+this.settings.daysPostfix;var o=e+this.settings.monthPostfix;var h=e+this.settings.quarterPostfix;var d=e+this.settings.yearPostfix;var u,c,f,g;t[r]="";t[a]="";t[n]="";t[l]="";t[o]="";t[h]="";t[d]="";u=JSON.parse(BX.data(i,"value"));t[r]=u.VALUE;switch(u.VALUE){case this.dateTypes.EXACT:{c=BX.Filter.Utils.getByClass(s,this.settings.classDateInput);t[a]=c.value;t[n]=c.value;break}case this.dateTypes.QUARTER:{f=BX.Filter.Utils.getByClass(s,this.settings.classControl,true);if(BX.type.isArray(f)){f.forEach(function(e){g=BX.data(e,"name");if(g&&g.indexOf("_quarter")!==-1){t[h]=JSON.parse(BX.data(e,"value")).VALUE}if(g&&g.indexOf("_year")!==-1){t[d]=JSON.parse(BX.data(e,"value")).VALUE}},this)}break}case this.dateTypes.YEAR:{f=BX.Filter.Utils.getByClass(s,this.settings.classControl,true);if(BX.type.isArray(f)){f.forEach(function(e){g=BX.data(e,"name");if(g&&g.indexOf("_year")!==-1){t[d]=JSON.parse(BX.data(e,"value")).VALUE}},this)}break}case this.dateTypes.MONTH:{f=BX.Filter.Utils.getByClass(s,this.settings.classControl,true);if(BX.type.isArray(f)){f.forEach(function(e){g=BX.data(e,"name");if(g&&g.indexOf("_month")!==-1){t[o]=JSON.parse(BX.data(e,"value")).VALUE}if(g&&g.indexOf("_year")!==-1){t[d]=JSON.parse(BX.data(e,"value")).VALUE}},this)}break}case this.dateTypes.NEXT_DAYS:case this.dateTypes.PREV_DAYS:{var p=BX.Filter.Utils.getByClass(s,this.settings.classNumberInput);if(!!p&&p.name===l){t[l]=p.value}break}case this.dateTypes.RANGE:{c=BX.Filter.Utils.getByClass(s,this.settings.classDateInput,true);c.forEach(function(e){if(e.name===a){t[a]=e.value}else if(e.name===n){t[n]=e.value}},this);break}default:{break}}},prepareControlNumberValue:function(t,e,s){var i=BX.Filter.Utils.getByClass(s,this.settings.classNumberInput,true);var r=BX.Filter.Utils.getByClass(s,this.settings.classSelect);var a=e+this.settings.numberPostfix;var n=e+this.settings.fromPostfix;var l=e+this.settings.toPostfix;var o;t[n]="";t[l]="";o=JSON.parse(BX.data(r,"value"));t[a]=o.VALUE;i.forEach(function(e){if(e.name.indexOf(this.settings.fromPostfix)!==-1){t[n]=e.value||"";if(t[a]==="exact"){t[l]=e.value||""}}else if(e.name.indexOf(this.settings.toPostfix)!==-1){t[l]=e.value||""}},this)},prepareControlStringValue:function(t,e){var s=BX.Filter.Utils.getByClass(e,this.settings.classStringInput);var i;if(BX.type.isDomNode(s)){i=s.name;t[i]=s.value}},showGridAnimation:function(){this.grid&&this.grid.tableFade()},hideGridAnimation:function(){this.grid&&this.grid.tableUnfade()},getPresetId:function(t,e){var s=this.getPreset().getCurrentPresetId();if(!this.isEditEnabled()&&!this.isAddPresetEnabled()&&!e||s==="default_filter"&&!t){s="tmp_filter"}return s},applyFilter:function(t,e){var s=this.getPresetId(t,e);var i=this.getParam("FILTER_ID");var r=new BX.Promise(null,this);var a=this.getPreset();var n=this.getSearch();var l={autoResolve:!this.grid};var o=this;this.showGridAnimation();BX.onCustomEvent(window,"BX.Main.Filter:beforeApply",[i,{},this,r]);this.updatePreset(s,null,t,null).then(function(){n.updatePreset(a.getPreset(s))}).then(function(){var t={apply_filter:"Y",clear_nav:"Y"};var e=BX.delegate(r.fulfill,r);var s=BX.delegate(r.reject,r);o.grid&&o.grid.reloadTable("POST",t,e,s);BX.onCustomEvent(window,"BX.Main.Filter:apply",[i,{},o,r,l]);l.autoResolve&&r.fulfill()});return r},getAddField:function(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classAddField)},getFieldListContainer:function(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classFileldControlList)},getFields:function(){if(!(this.fields instanceof BX.Filter.Fields)){this.fields=new BX.Filter.Fields(this)}return this.fields},getPreset:function(){if(!(this.presets instanceof BX.Filter.Presets)){this.presets=new BX.Filter.Presets(this)}return this.presets},resetControlData:function(t){if(BX.type.isPlainObject(t)){switch(t.TYPE){case this.types.MULTI_SELECT:{t.VALUE=[];break}case this.types.SELECT:{t.VALUE=t.ITEMS[0];break}case this.types.DATE:{t.SUB_TYPE=t.SUB_TYPES[0];t.VALUES={_from:"",_to:"",_days:"",_quarter:"",_year:""};break}case this.types.NUMBER:{t.SUB_TYPE=t.SUB_TYPES[0];t.VALUES={_from:"",_to:""};break}case this.types.CUSTOM_ENTITY:{t.VALUES={_label:"",_value:""};break}case this.types.CUSTOM:{t._VALUE="";break}default:{t.VALUE=""}}}return t},clearControl:function(t){var e=this.getPreset().getField({NAME:t});var s,i;if(BX.type.isDomNode(e)){s=this.getFieldByName(t);s=this.resetControlData(s);i=this.getPreset().createControl(s);BX.insertAfter(i,e);BX.remove(e)}},clearControls:function(t){if(BX.type.isArray(t)){t.forEach(function(t){"name"in t&&this.clearControl(t.name)},this)}else if(BX.type.isPlainObject(t)&&"name"in t){this.clearControl(t.name)}},getTemplate:function(){return BX.html(BX(this.settings.generalTemplateId))},isIe:function(){if(!BX.type.isBoolean(this.ie)){this.ie=BX.hasClass(document.documentElement,"bx-ie")}return this.ie},closePopup:function(){var t=this.getPopup();var e=t.popupContainer;var s=this.settings.get("FILTER_CLOSE_DELAY");var i;setTimeout(BX.delegate(function(){if(!this.isIe()){BX.removeClass(e,this.settings.classAnimationShow);BX.addClass(e,this.settings.classAnimationClose);i=parseFloat(BX.style(e,"animation-duration"));if(BX.type.isNumber(i)){i=i*1e3}setTimeout(function(){t.close()},i)}else{t.close()}},this),s);this.closeFieldListPopup();this.adjustFocus()},showPopup:function(){var t=this.getPopup();var e;if(!t.isShown()){this.isOpened=true;var s=this.settings.get("FILTER_SHOW_DELAY");setTimeout(BX.delegate(function(){t.show();if(!this.isIe()){e=t.popupContainer;BX.removeClass(e,this.settings.classAnimationClose);BX.addClass(e,this.settings.classAnimationShow)}},this),s)}},getSaveForAllCheckbox:function(){if(!this.saveForAllCheckbox&&!!this.getSaveForAllCheckboxContainer()){this.saveForAllCheckbox=BX.Filter.Utils.getBySelector(this.getSaveForAllCheckboxContainer(),'input[type="checkbox"]')}return this.saveForAllCheckbox},getSaveForAllCheckboxContainer:function(){if(!this.saveForAllCheckboxContainer){this.saveForAllCheckboxContainer=BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classForAllCheckbox)}return this.saveForAllCheckboxContainer},showForAllCheckbox:function(){!!this.getSaveForAllCheckboxContainer()&&BX.removeClass(this.getSaveForAllCheckboxContainer(),this.settings.classHide)},hideForAllCheckbox:function(){!!this.getSaveForAllCheckboxContainer()&&BX.addClass(this.getSaveForAllCheckboxContainer(),this.settings.classHide)},getPopupBindElement:function(){if(!this.popupBindElement){var t=this.settings.get("POPUP_BIND_ELEMENT_SELECTOR");var e=null;if(BX.type.isNotEmptyString(t)){e=BX.Filter.Utils.getBySelector(document,t)}this.popupBindElement=!!e?e:this.getSearch().getContainer()}return this.popupBindElement},getPopup:function(){if(!(this.popup instanceof BX.PopupWindow)){this.popup=new BX.PopupWindow(this.getParam("FILTER_ID")+this.settings.searchContainerPostfix,this.getPopupBindElement(),{autoHide:false,offsetTop:parseInt(this.settings.get("POPUP_OFFSET_TOP")),offsetLeft:parseInt(this.settings.get("POPUP_OFFSET_LEFT")),lightShadow:true,closeIcon:false,closeByEsc:false,noAllPaddings:true,zIndex:12});this.popup.setContent(this.getTemplate());BX.bind(this.getFieldListContainer(),"keydown",BX.delegate(this._onFieldsContainerKeydown,this));BX.bind(this.getFilter(),"click",BX.delegate(this._onFilterClick,this));BX.bind(this.getAddPresetButton(),"click",BX.delegate(this._onAddPresetClick,this));BX.bind(this.getPreset().getAddPresetFieldInput(),"keydown",BX.delegate(this._onAddPresetKeydown,this));BX.bind(this.getPreset().getContainer(),"keydown",BX.delegate(this._onPresetInputKeydown,this));BX.bind(this.getSaveButton(),"click",BX.delegate(this._onSaveButtonClick,this));BX.bind(this.getCancelButton(),"click",BX.delegate(this._onCancelButtonClick,this));BX.bind(this.getFindButton(),"click",BX.delegate(this._onFindButtonClick,this));BX.bind(this.getResetButton(),"click",BX.delegate(this._onResetButtonClick,this));BX.bind(this.getAddField(),"click",BX.delegate(this._onAddFieldClick,this));BX.bind(this.getEditButton(),"click",BX.delegate(this._onEditButtonClick,this));BX.bind(this.getRestoreButton(),"click",BX.delegate(this._onRestoreButtonClick,this));BX.bind(this.getRestoreFieldsButton(),"click",BX.delegate(this._onRestoreFieldsButtonClick,this));this.getFilter().addEventListener("mousedown",BX.delegate(this._onFilterMousedown,this),true);this.getPreset().showCurrentPresetFields();this.getPreset().bindOnPresetClick()}return this.popup},_onRestoreFieldsButtonClick:function(){this.restoreDefaultFields()},restoreDefaultFields:function(){var t=this.getPreset().getPreset("default_filter",true);var e=this.getParam("PRESETS");var s=this.getPreset().getCurrentPresetId();var i={FILTER_ID:this.getParam("FILTER_ID"),GRID_ID:this.getParam("GRID_ID"),action:"SET_FILTER"};var r=t.FIELDS.map(function(t){return t.NAME});var a=r.join(",");e.forEach(function(s,i){if(s.ID==="default_filter"){e[i]=BX.clone(t)}},this);if(BX.type.isArray(this.editablePresets)){this.editablePresets.forEach(function(e,s){if(e.ID==="default_filter"){this.editablePresets[s]=BX.clone(t)}},this)}this.getPreset().applyPreset(s);this.updatePreset(s);this.saveOptions({preset_id:"default_filter",rows:a,save:"Y",apply_filter:"N"},i)},getRestoreFieldsButton:function(){if(!this.restoreFieldsButton){this.restoreFieldsButton=BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classRestoreFieldsButton)}return this.restoreFieldsButton},restoreFilter:function(){var t=this.getParam("DEFAULT_PRESETS");var e=this.getParam("PRESETS");var s=false;var i,r,a;if(BX.type.isArray(t)){t.sort(function(t,e){return t.SORT<e.SORT});t.forEach(function(t){s=e.some(function(e,s){if(e.ID===t.ID){i=s;return true}});if(s){e[i]=BX.clone(t)}else{e.push(BX.clone(t))}if(t.ID!=="default_filter"){this.addSidebarItem(t.ID,t.TITLE,t.PINNED);if(t.PINNED){r=t.ID}}},this)}this.saveRestoreFilter();this.disableAddPreset();this.disableEdit();if(!r){r="default_filter"}a=this.getPreset().getPresetNodeById(r);if(a){BX.fireEvent(a,"click")}},saveRestoreFilter:function(){var t={FILTER_ID:this.getParam("FILTER_ID"),GRID_ID:this.getParam("GRID_ID"),action:"RESTORE_FILTER"};var e=this.getParam("PRESETS");var s={};var i;if(BX.type.isArray(e)){e.forEach(function(t,e){i=t.FIELDS.map(function(t){return t.NAME});i=i.join(",");s[t.ID]={name:t.TITLE||null,sort:e,preset_id:t.ID,fields:this.prepareFields(t.FIELDS),rows:i}},this);this.saveOptions(s,t)}},prepareFields:function(t){var e={};var s;if(BX.type.isArray(t)){t.forEach(function(t){if(t.TYPE===this.types.SELECT){e[t.NAME]="VALUE"in t.VALUE?t.VALUE.VALUE:""}if(t.TYPE===this.types.MULTI_SELECT){t.VALUE.forEach(function(s,i){e[t.NAME]=e[t.NAME]||{};e[t.NAME][i]=s.VALUE});e[t.NAME]=e[t.NAME]||""}if(t.TYPE===this.types.DATE||t.TYPE===this.types.NUMBER){s=Object.keys(t.VALUES);s.forEach(function(s){e[t.NAME+s]=t.VALUES[s]});if(t.TYPE===this.types.DATE){e[t.NAME+"_datesel"]="VALUE"in t.SUB_TYPE?t.SUB_TYPE.VALUE:t.SUB_TYPES[0].VALUE}if(t.TYPE===this.types.NUMBER){e[t.NAME+"_numsel"]="VALUE"in t.SUB_TYPE?t.SUB_TYPE.VALUE:t.SUB_TYPES[0].VALUE}}if(t.TYPE===this.types.CUSTOM_ENTITY){e[t.NAME+"_label"]=t.VALUES._label;e[t.NAME+"_value"]=t.VALUES._value}},this)}return e},getRestoreButton:function(){if(!BX.type.isDomNode(this.restoreButton)){this.restoreButton=BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classRestoreButton)}return this.restoreButton},_onPresetInputKeydown:function(t){if(BX.Filter.Utils.isKey(t,"enter")&&t.target.tagName==="INPUT"){BX.fireEvent(this.getSaveButton(),"click")}},_onFieldsContainerKeydown:function(t){if(BX.Filter.Utils.isKey(t,"enter")&&t.target.tagName==="INPUT"){this.applyFilter();this.closePopup()}},_onFindButtonClick:function(){this.getPreset().deactivateAllPresets();this.applyFilter();this.closePopup()},_onResetButtonClick:function(){if(this.getParam("RESET_TO_DEFAULT_MODE")){this.getSearch().clearInput();this.getPreset().applyPinnedPreset()}else{this.resetFilter()}this.closePopup()},resetFilter:function(t){var e=this.getSearch();var s=this.getPreset();if(!t){e.clearInput()}e.removePreset();s.deactivateAllPresets();s.resetPreset(true);e.hideClearButton();e.adjustPlaceholder();return this.applyFilter(true,true)},_onEditButtonClick:function(){if(!this.isEditEnabled()){this.enableEdit()}else{this.disableEdit()}},enableFieldsDragAndDrop:function(){var t=this.getPreset().getFields();this.fieldsList=[];if(BX.type.isArray(t)){this.fieldsList=t.map(this.registerDragItem,this)}},registerDragItem:function(t){var e=this.getDragButton(t);e.onbxdragstart=BX.delegate(this._onFieldDragStart,this);e.onbxdragstop=BX.delegate(this._onFieldDragStop,this);e.onbxdrag=BX.delegate(this._onFieldDrag,this);jsDD.registerObject(e);jsDD.registerDest(e);return t},unregisterDragItem:function(t){var e=this.getDragButton(t);jsDD.unregisterObject(e);jsDD.unregisterDest(e)},_onFieldDragStart:function(){this.dragItem=this.getFields().getField(jsDD.current_node);this.dragIndex=BX.Filter.Utils.getIndex(this.fieldsList,this.dragItem);this.dragRect=this.dragItem.getBoundingClientRect();this.offset=this.dragRect.height;this.dragStartOffset=jsDD.start_y-(this.dragRect.top+BX.scrollTop(window));BX.Filter.Utils.styleForEach(this.fieldsList,{transition:"100ms"});BX.addClass(this.dragItem,this.settings.classPresetOndrag);BX.bind(document,"mousemove",BX.delegate(this._onMouseMove,this));

},_onFieldDragStop:function(){BX.unbind(document,"mousemove",BX.delegate(this._onMouseMove,this));BX.removeClass(this.dragItem,this.settings.classPresetOndrag);BX.Filter.Utils.styleForEach(this.fieldsList,{transition:"",transform:""});BX.Filter.Utils.collectionSort(this.dragItem,this.targetItem);this.fieldsList=this.getPreset().getFields();this.saveFieldsSort()},_onFieldDrag:function(){var t=this;var e,s;this.dragOffset=this.realY-this.dragRect.top-this.dragStartOffset;this.sortOffset=t.realY+BX.scrollTop(window);BX.Filter.Utils.styleForEach([this.dragItem],{transition:"0ms",transform:"translate3d(0px, "+this.dragOffset+"px, 0px)"});this.fieldsList.forEach(function(i,r){if(i){e=i.getBoundingClientRect();s=e.top+BX.scrollTop(window)+e.height/2;if(r>t.dragIndex&&t.sortOffset>s&&i.style.transform!=="translate3d(0px, "+-t.offset+"px, 0px)"&&i.style.transform!==""){t.targetItem=i;BX.style(i,"transform","translate3d(0px, "+-t.offset+"px, 0px)");BX.style(i,"transition","300ms")}if(r<t.dragIndex&&t.sortOffset<s&&i.style.transform!=="translate3d(0px, "+t.offset+"px, 0px)"&&i.style.transform!==""){t.targetItem=i;BX.style(i,"transform","translate3d(0px, "+t.offset+"px, 0px)");BX.style(i,"transition","300ms")}if((r<t.dragIndex&&t.sortOffset>s||r>t.dragIndex&&t.sortOffset<s)&&i.style.transform!=="translate3d(0px, 0px, 0px)"){if(i.style.transform!==""){t.targetItem=i}BX.style(i,"transform","translate3d(0px, 0px, 0px)");BX.style(i,"transition","300ms")}}})},disableFieldsDragAndDrop:function(){if(BX.type.isArray(this.fieldsList)&&this.fieldsList.length){this.fieldsList.map(this.unregisterDragItem,this)}},enablePresetsDragAndDrop:function(){var t,e,s,i;t=this.getPreset();e=t.getPresets();this.presetsList=[];if(BX.type.isArray(e)&&e.length){e.forEach(function(e){i=t.getPresetId(e);if(!BX.hasClass(e,this.settings.classAddPresetField)&&i!=="default_filter"&&!BX.hasClass(e,this.settings.classDefaultFilter)){s=this.getDragButton(e);s.onbxdragstart=BX.delegate(this._onDragStart,this);s.onbxdragstop=BX.delegate(this._onDragStop,this);s.onbxdrag=BX.delegate(this._onDrag,this);jsDD.registerObject(s);jsDD.registerDest(s);this.presetsList.push(e)}},this)}},getDragButton:function(t){return BX.Filter.Utils.getByClass(t,this.settings.classPresetDragButton)},disablePresetsDragAndDrop:function(){if(BX.type.isArray(this.presetsList)&&this.presetsList.length){this.presetsList.forEach(function(t){if(!BX.hasClass(t,this.settings.classAddPresetField)){jsDD.unregisterObject(t);jsDD.unregisterDest(t)}},this)}},_onDragStart:function(){this.dragItem=this.getPreset().normalizePreset(jsDD.current_node);this.dragIndex=BX.Filter.Utils.getIndex(this.presetsList,this.dragItem);this.dragRect=this.dragItem.getBoundingClientRect();this.offset=this.dragRect.height;this.dragStartOffset=jsDD.start_y-(this.dragRect.top+BX.scrollTop(window));BX.Filter.Utils.styleForEach(this.list,{transition:"100ms"});BX.addClass(this.dragItem,this.settings.classPresetOndrag);BX.bind(document,"mousemove",BX.delegate(this._onMouseMove,this))},_onMouseMove:function(t){this.realX=t.clientX;this.realY=t.clientY},getDragOffset:function(){return jsDD.x-this.startDragOffset-this.dragRect.left},_onDragStop:function(){var t,e;BX.unbind(document,"mousemove",BX.delegate(this._onMouseMove,this));BX.removeClass(this.dragItem,this.settings.classPresetOndrag);BX.Filter.Utils.styleForEach(this.presetsList,{transition:"",transform:""});BX.Filter.Utils.collectionSort(this.dragItem,this.targetItem);t=this.getPreset();e=t.getPresets();this.presetsList=[];if(BX.type.isArray(e)&&e.length){e.forEach(function(t){if(!BX.hasClass(t,this.settings.classAddPresetField)&&!BX.hasClass(t,this.settings.classDefaultFilter)){this.presetsList.push(t)}},this)}},_onDrag:function(){var t=this;var e,s;this.dragOffset=this.realY-this.dragRect.top-this.dragStartOffset;this.sortOffset=t.realY+BX.scrollTop(window);BX.Filter.Utils.styleForEach([this.dragItem],{transition:"0ms",transform:"translate3d(0px, "+this.dragOffset+"px, 0px)"});this.presetsList.forEach(function(i,r){if(i){e=i.getBoundingClientRect();s=e.top+BX.scrollTop(window)+e.height/2;if(r>t.dragIndex&&t.sortOffset>s&&i.style.transform!=="translate3d(0px, "+-t.offset+"px, 0px)"&&i.style.transform!==""){t.targetItem=i;BX.style(i,"transform","translate3d(0px, "+-t.offset+"px, 0px)");BX.style(i,"transition","300ms")}if(r<t.dragIndex&&t.sortOffset<s&&i.style.transform!=="translate3d(0px, "+t.offset+"px, 0px)"&&i.style.transform!==""){t.targetItem=i;BX.style(i,"transform","translate3d(0px, "+t.offset+"px, 0px)");BX.style(i,"transition","300ms")}if((r<t.dragIndex&&t.sortOffset>s||r>t.dragIndex&&t.sortOffset<s)&&i.style.transform!=="translate3d(0px, 0px, 0px)"){if(i.style.transform!==""){t.targetItem=i}BX.style(i,"transform","translate3d(0px, 0px, 0px)");BX.style(i,"transition","300ms")}}})},getSidebarControlsContainer:function(){if(!BX.type.isDomNode(this.sidebarControlsContainer)){this.sidebarControlsContainer=BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classSidebarControlsContainer)}return this.sidebarControlsContainer},enableEdit:function(){var t=this.getPreset();var e=t.getPresets();var s;if(BX.type.isArray(e)&&e.length){e.forEach(function(e){s=t.getPresetId(e);if(!BX.hasClass(e,this.settings.classAddPresetField)&&s!=="default_filter"){BX.addClass(e,this.settings.classPresetEdit)}},this)}this.enablePresetsDragAndDrop();BX.show(this.getButtonsContainer());BX.hide(this.getPresetButtonsContainer());BX.addClass(this.getSidebarControlsContainer(),this.settings.classDisabled);this.editablePresets=BX.clone(this.getParam("PRESETS"));this.isEditEnabledState=true},disableEdit:function(){var t=this.getPreset();var e=t.getPresets();if(BX.type.isArray(e)&&e.length){e.forEach(function(t){if(!BX.hasClass(t,this.settings.classAddPresetField)){BX.removeClass(t,this.settings.classPresetEdit);this.getPreset().disableEditPresetName(t)}},this)}this.disablePresetsDragAndDrop();if(!this.isAddPresetEnabled()){BX.style(this.getButtonsContainer(),"display","")}BX.show(this.getPresetButtonsContainer());BX.removeClass(this.getSidebarControlsContainer(),this.settings.classDisabled);this.editablePresets=null;this.isEditEnabledState=false;this.applyFilter(null,true)},getPresetButtonsContainer:function(){if(!BX.type.isDomNode(this.presetButtonsContainer)){this.presetButtonsContainer=BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classPresetButtonsContainer)}return this.presetButtonsContainer},isEditEnabled:function(){return this.isEditEnabledState},getEditButton:function(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classEditButton)},getParam:function(t,e){return t in this.params?this.params[t]:e},getFilter:function(){return BX.Filter.Utils.getByClass(this.getPopup().contentContainer,this.settings.classFilterContainer)},getSearch:function(){if(!(this.search instanceof BX.Filter.Search)){this.search=new BX.Filter.Search(this)}return this.search},_onRestoreButtonClick:function(){var t={CONFIRM:true,CONFIRM_MESSAGE:this.getParam("CONFIRM_MESSAGE"),CONFIRM_APPLY_BUTTON:this.getParam("CONFIRM_APPLY"),CONFIRM_CANCEL_BUTTON:this.getParam("CONFIRM_CANCEL")};this.confirmDialog(t,BX.delegate(this.restoreFilter,this))},confirmDialog:function(t,e,s){if("CONFIRM"in t&&t.CONFIRM){var i=this.getParam("FILTER_ID")+"-confirm-dialog";var r='<div class="main-ui-filter-confirm-content">'+t.CONFIRM_MESSAGE+"</div>";var a="CONFIRM_TITLE"in t?t.CONFIRM_TITLE:"";var n=new BX.PopupWindowButton({text:t.CONFIRM_APPLY_BUTTON,events:{click:function(){BX.type.isFunction(e)?e():null;this.popupWindow.close();this.popupWindow.destroy()}}});var l=new BX.PopupWindowButtonLink({text:t.CONFIRM_CANCEL_BUTTON,events:{click:function(){BX.type.isFunction(s)?s():null;this.popupWindow.close();this.popupWindow.destroy()}}});var o=new BX.PopupWindow(i,null,{content:r,titleBar:a,autoHide:false,zIndex:9999,overlay:.4,offsetTop:-100,closeIcon:true,closeByEsc:true,buttons:[n,l]});BX.addCustomEvent(o,"onPopupClose",BX.delegate(function(){!!this.getSaveForAllCheckbox()&&(this.getSaveForAllCheckbox().checked=null)},this));if(!o.isShown()){o.show();var h=o.popupContainer;BX.removeClass(h,this.settings.classAnimationShow);BX.addClass(h,this.settings.classAnimationShow)}}else{BX.type.isFunction(e)?e():null}}}})();(function(){BX.Main.filterManager={data:{},push:function(t,e){if(BX.type.isNotEmptyString(t)&&e){this.data[t]=e}},getById:function(t){var e=null;if(t in this.data){e=this.data[t]}return e}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:87:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/api.min.js?1511316472586";s:6:"source";s:69:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/api.js";s:3:"min";s:73:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/api.min.js";s:3:"map";s:73:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/api.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Filter");BX.Filter.Api=function(t){this.parent=t};BX.Filter.Api.prototype={setFields:function(t){var e,i;if(BX.type.isPlainObject(t)){this.parent.getPopup();e=this.parent.getPreset();e.deactivateAllPresets();i={preset_id:"tmp_filter",fields:t};this.parent.updateParams(i);e.applyPreset("tmp_filter")}},apply:function(){if(!this.parent.isEditEnabled()){if(!this.parent.isEditEnabled()){this.parent.applyFilter()}this.parent.closePopup();if(this.parent.isAddPresetEnabled()){this.parent.disableAddPreset()}}}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:101:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/field-controller.min.js?15113164722703";s:6:"source";s:82:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/field-controller.js";s:3:"min";s:86:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/field-controller.min.js";s:3:"map";s:86:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/field-controller.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Filter");BX.Filter.FieldController=function(t,e){this.field=null;this.parent=null;this.type=null;this.input=null;this.deleteButton=null;this.init(t,e)};BX.Filter.FieldController.prototype={init:function(t,e){if(!BX.type.isDomNode(t)){throw"BX.Filter.FieldController.init: field isn't dom node"}if(!(e instanceof BX.Main.Filter)){throw"BX.Filter.FieldController.init: parent not instance of BX.Main.ui.Filter"}this.field=t;this.parent=e;this.bind();this.isShowDelete()?this.showDelete():this.hideDelete()},isShowDelete:function(){var t=this.getSquares();return this.getInputValue()||BX.type.isArray(t)&&t.length},getField:function(){return this.field},getInput:function(){var t,e;if(!BX.type.isDomNode(this.input)){t=this.getType();e=this.parent.types;if(t===e.DATE){this.input=BX.Filter.Utils.getByClass(this.getField(),this.parent.settings.classDateInput)}if(t===e.NUMBER||t==="number"){this.input=BX.Filter.Utils.getByClass(this.getField(),this.parent.settings.classNumberInput)}if(t===e.STRING){this.input=BX.Filter.Utils.getByClass(this.getField(),this.parent.settings.classStringInput)}if(t===e.CUSTOM_ENTITY){this.input=BX.Filter.Utils.getBySelector(this.getField(),'input[type="hidden"]')}}return this.input},getDeleteButton:function(){if(!BX.type.isDomNode(this.deleteButton)){this.deleteButton=BX.Filter.Utils.getByClass(this.getField(),this.parent.settings.classValueDelete)}return this.deleteButton},getSquares:function(){return BX.Filter.Utils.getByClass(this.getField(),this.parent.settings.classSquare)},bind:function(){if(this.getType()!==this.parent.types.MULTI_SELECT&&this.getType()!==this.parent.types.SELECT){BX.bind(this.getDeleteButton(),"click",BX.delegate(this._onDeleteClick,this));BX.bind(this.getInput(),"input",BX.delegate(this._onInput,this))}},clearInput:function(){var t=this.getInput();if(BX.type.isDomNode(t)){t.value=""}},hideDelete:function(){var t=this.getDeleteButton();if(BX.type.isDomNode(t)){BX.addClass(t,this.parent.settings.classHide)}},showDelete:function(){var t=this.getDeleteButton();if(BX.type.isDomNode(t)){BX.removeClass(t,this.parent.settings.classHide)}},removeSquares:function(){var t=this.getSquares();if(BX.type.isArray(t)&&t.length){t.forEach(function(t){BX.remove(t)})}},_onDeleteClick:function(){this.removeSquares();this.clearInput();this.hideDelete()},_onInput:function(){this.getInputValue()?this.showDelete():this.hideDelete()},getInputValue:function(){var t="";var e=this.getInput();if(BX.type.isDomNode(e)){t=e.value}return t},getType:function(){if(!BX.type.isNotEmptyString(this.type)){this.type=BX.data(this.getField(),"type")}return this.type}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:92:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/fields.min.js?151131647216599";s:6:"source";s:72:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/fields.js";s:3:"min";s:76:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/fields.min.js";s:3:"map";s:76:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/fields.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Filter");BX.Filter.Fields=function(t){this.parent=null;this.init(t)};BX.Filter.Fields.prototype={init:function(t){this.parent=t;BX.addCustomEvent(window,"UI::Select::change",BX.delegate(this._onDateTypeChange,this))},deleteField:function(t){BX.remove(t)},isFieldDelete:function(t){return BX.hasClass(t,this.parent.settings.classFieldDelete)},isFieldValueDelete:function(t){return BX.hasClass(t,this.parent.settings.classValueDelete)||BX.hasClass(t.parentNode,this.parent.settings.classValueDelete)},isDragButton:function(t){return t&&BX.hasClass(t,this.parent.settings.classPresetDragButton)},clearFieldValue:function(t){if(t){var e=BX.Filter.Utils.getByClass(t,this.parent.settings.classControl,true);var n=BX.Filter.Utils.getByClass(t,this.parent.settings.classSquare,true);(n||[]).forEach(BX.remove);(e||[]).forEach(function(t){t&&"value"in t&&(t.value="")},this)}},getField:function(t){var e;if(BX.type.isDomNode(t)){e=BX.findParent(t,{"class":this.parent.settings.classField},true,false);if(!BX.type.isDomNode(e)){e=BX.findParent(t,{"class":this.parent.settings.classFieldGroup},true,false)}}return e},render:function(t,e){var n,i,a,l;if(BX.type.isPlainObject(e)&&BX.type.isNotEmptyString(t)){n=Object.keys(e);n.forEach(function(n){l="{{"+n+"}}";t=t.replace(new RegExp(l,"g"),e[n])});a=BX.create("div",{html:t});i=BX.Filter.Utils.getByClass(a,this.parent.settings.classFieldGroup);if(!BX.type.isDomNode(i)){i=BX.Filter.Utils.getByClass(a,this.parent.settings.classField)}if(!BX.type.isDomNode(i)){i=BX.Filter.Utils.getByClass(a,this.parent.settings.classFieldLine)}}return i},createInputText:function(t){var e={block:"main-ui-control-field",mix:this.parent.getParam("ENABLE_LABEL")?[this.parent.settings.classFieldWithLabel]:null,deleteButton:true,valueDelete:true,name:t.NAME,type:t.TYPE,label:this.parent.getParam("ENABLE_LABEL")?t.LABEL:"",dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),content:[{block:"main-ui-control-string",name:t.NAME,placeholder:t.PLACEHOLDER||"",value:t.VALUE,tabindex:t.TABINDEX}]};return BX.decl(e)},createCustomEntity:function(t){var e,n;var i={block:"main-ui-control-field",mix:this.parent.getParam("ENABLE_LABEL")?[this.parent.settings.classFieldWithLabel]:null,deleteButton:true,valueDelete:true,name:t.NAME,type:t.TYPE,label:this.parent.getParam("ENABLE_LABEL")?t.LABEL:"",dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),content:{block:"main-ui-control-entity",mix:"main-ui-control",attrs:{"data-multiple":JSON.stringify(t.MULTIPLE)},content:[]}};if("_label"in t.VALUES&&!!t.VALUES._label){if(t.MULTIPLE){var a=!!t.VALUES._label?t.VALUES._label:[];if(BX.type.isPlainObject(a)){a=Object.keys(a).map(function(t){return a[t]})}a.forEach(function(e,n){i.content.content.push({block:"main-ui-square",tag:"span",name:e,item:{_label:e,_value:t.VALUES._value[n]}})})}else{i.content.content.push({block:"main-ui-square",tag:"span",name:"_label"in t.VALUES?t.VALUES["_label"]:"",item:t.VALUES})}}i.content.content.push({block:"main-ui-square-search",tag:"span",content:{block:"main-ui-control-string",name:t.NAME+"_label",tabindex:t.TABINDEX,type:"text",placeholder:t.PLACEHOLDER||""}},{block:"main-ui-control-string",name:t.NAME,type:"hidden",placeholder:t.PLACEHOLDER||"",value:"_value"in t.VALUES?t.VALUES["_value"]:"",tabindex:t.TABINDEX});i=BX.decl(i);e=BX.Filter.Utils.getBySelector(i,'.main-ui-control-string[type="text"]');BX.addClass(e,"main-ui-square-search-item");BX.bind(e,"focus",BX.proxy(this._onCustomEntityInputFocus,this));BX.bind(e,"click",BX.proxy(this._onCustomEntityInputClick,this));if(!this.bindDocument){BX.bind(document,"click",BX.proxy(this._onCustomEntityBlur,this));document.addEventListener("focus",BX.proxy(this._onDocumentFocus,this),true);this.bindDocument=true}BX.bind(e,"keydown",BX.proxy(this._onCustomEntityKeydown,this));BX.bind(i,"click",BX.proxy(this._onCustomEntityFieldClick,this));return i},_onCustomEntityInputFocus:function(t){BX.fireEvent(t.currentTarget,"click")},_onCustomEntityInputClick:function(t){var e,n,i,a;t.preventDefault();t.stopPropagation();if(t.isTrusted){this.trustTimestamp=t.timeStamp;this.notTrustTimestamp=this.notTrustTimestamp||t.timeStamp}else{this.notTrustTimestamp=t.timeStamp}e=new Date(this.trustTimestamp);n=new Date(this.notTrustTimestamp);i=e.getMinutes()+":"+e.getSeconds();a=n.getMinutes()+":"+n.getSeconds();if(i!==a){this._onCustomEntityFocus(t)}},_onDocumentFocus:function(t){var e=false;if(this.lastLabelInput&&t.target!==this.lastLabelInput){if(BX.type.isArray(this.popupInputs)&&this.popupInputs.length){e=this.popupInputs.some(function(e){return e===t.target})}if(!e){this._onCustomEntityBlur(t)}}},_onCustomEntityKeydown:function(t){var e=BX.Filter.Utils.getByClass(t.target.parentNode.parentNode,this.parent.settings.classSquare,true);var n=null;if(e.length){n=e[e.length-1]}if(BX.Filter.Utils.isKey(t,"backspace")&&t.currentTarget.selectionStart===0){if(BX.type.isDomNode(n)){if(BX.hasClass(n,this.parent.settings.classSquareSelected)){BX.remove(n);var i=BX.Filter.Utils.getBySelector(t.target.parentNode.parentNode,'input[type="hidden"]');i.value="";BX.fireEvent(i,"input")}else{BX.addClass(n,this.parent.settings.classSquareSelected)}}}else if(BX.type.isDomNode(n)&&BX.hasClass(n,this.parent.settings.classSquareSelected)){BX.removeClass(n,this.parent.settings.classSquareSelected)}},_onCustomEntityFieldClick:function(t){var e;if(BX.hasClass(t.target,this.parent.settings.classSquareDelete)){e=BX.findParent(t.target,{className:this.parent.settings.classSquare},true,false);if(BX.type.isDomNode(e)){var n=this.getCustomEntityInstance();BX.onCustomEvent(window,"BX.Main.Filter:customEntityRemove",[n]);BX.remove(e)}}else{var i=BX.Filter.Utils.getBySelector(t.target,'input[type="text"]');BX.fireEvent(i,"focus")}},_onCustomEntityBlur:function(t){var e={stopBlur:false};BX.onCustomEvent(window,"BX.Main.Filter:onGetStopBlur",[t,e]);if(typeof e.stopBlur=="undefined"||!e.stopBlur){var n=this.getCustomEntityInstance();this.lastLabelInput=null;BX.onCustomEvent(window,"BX.Main.Filter:customEntityBlur",[n]);BX.unbind(n.getPopupContainer(),"click",this._stopPropagation);this.popupInputs=null;BX.removeClass(n.getField(),this.parent.settings.classFocus)}},_stopPropagation:function(t){t.stopPropagation()},getCustomEntityInstance:function(){if(!(this.customEntityInstance instanceof BX.Main.ui.CustomEntity)){this.customEntityInstance=new BX.Main.ui.CustomEntity}return this.customEntityInstance},_onCustomEntityFocus:function(t){var e=BX.findParent(t.currentTarget,{className:"main-ui-control-entity"},true,false);var n=this.getCustomEntityInstance();t.stopPropagation();n.setField(e);this.lastLabelInput=n.getLabelNode();BX.onCustomEvent(window,"BX.Main.Filter:customEntityFocus",[n]);var i=n.getPopupContainer();if(BX.type.isElementNode(i)){BX.bind(i,"click",this._stopPropagation);this.popupInputs=i.querySelectorAll("input,a,div");this.popupInputs=Array.prototype.slice.call(this.popupInputs)}BX.addClass(e,this.parent.settings.classFocus)},createCustom:function(t){var e,n,i;var a=[];t.VALUE=BX.util.htmlspecialcharsback(t.VALUE);a.push("main-ui-control");a.push("main-ui-custom-style");i=BX.decl({block:"main-ui-control-field",mix:this.parent.getParam("ENABLE_LABEL")?[this.parent.settings.classFieldWithLabel]:null,name:t.NAME,type:t.TYPE,deleteButton:true,label:this.parent.getParam("ENABLE_LABEL")?t.LABEL:"",dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),content:{block:"main-ui-custom",mix:a,attrs:{"data-name":t.NAME},content:""}});n='name="'+t.NAME+'" value="'+("_VALUE"in t?t._VALUE:"")+'"';e=BX.Filter.Utils.getByClass(i,"main-ui-custom");try{t.VALUE=t.VALUE.replace('name="'+t.NAME+'"',n)}catch(l){}BX.html(e,t.VALUE);return i},createSelect:function(t){return BX.decl({block:"main-ui-control-field",mix:this.parent.getParam("ENABLE_LABEL")?[this.parent.settings.classFieldWithLabel]:null,name:t.NAME,type:t.TYPE,deleteButton:true,label:this.parent.getParam("ENABLE_LABEL")?t.LABEL:"",dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),content:{block:this.parent.settings.classSelect,name:t.NAME,items:t.ITEMS,value:"VALUE"in t?t.VALUE:t.ITEMS[0],params:t.PARAMS,tabindex:t.TABINDEX,valueDelete:false}})},createMultiSelect:function(t){return BX.decl({block:"main-ui-control-field",mix:this.parent.getParam("ENABLE_LABEL")?[this.parent.settings.classFieldWithLabel]:null,name:t.NAME,type:t.TYPE,deleteButton:true,label:this.parent.getParam("ENABLE_LABEL")?t.LABEL:"",dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),content:{block:"main-ui-multi-select",name:t.NAME,tabindex:"TABINDEX"in t?t.TABINDEX:"",placeholder:!this.parent.getParam("ENABLE_LABEL")&&"PLACEHOLDER"in t?t.PLACEHOLDER:"",items:"ITEMS"in t?t.ITEMS:[],value:"VALUE"in t?t.VALUE:[],params:"PARAMS"in t?t.PARAMS:{isMulti:true},valueDelete:true}})},_onDateTypeChange:function(t,e){var n={};var i=null;var a,l,s,r,E,o,u,c;if(BX.type.isPlainObject(e)&&"VALUE"in e){r=BX.data(t.getNode(),"name");l=t.getParams();if(!BX.type.isPlainObject(l)&&(r.indexOf("_datesel")!==-1||r.indexOf("_numsel")!==-1)){a=t.getNode().parentNode.parentNode;n.TABINDEX=t.getInput().getAttribute("tabindex");n.SUB_TYPES=t.getItems();n.SUB_TYPE=e;n.NAME=BX.data(a,"name");n.TYPE=BX.data(a,"type");o=this.parent.getPreset().getCurrentPresetData();if("FIELDS"in o&&o.FIELDS.length){u=o.FIELDS.filter(function(t){return t.NAME===n.NAME},this);if(u.length){u=u[0];if(r.indexOf("_datesel")!==-1){n.MONTHS=u.MONTHS;n.MONTH=u.MONTH;n.YEARS=u.YEARS;n.YEAR=u.YEAR;n.QUARTERS=u.QUARTERS;n.QUARTER=u.QUARTER;n.ENABLE_TIME=u.ENABLE_TIME}n.VALUES=u.VALUES}}if(this.parent.getParam("ENABLE_LABEL")){s=BX.Filter.Utils.getByClass(a,this.parent.settings.classFieldLabel);n.LABEL=s.innerText}if(r.indexOf("_datesel")!==-1){i=this.createDate(n)}else{i=this.createNumber(n)}if(BX.type.isArray(this.parent.fieldsList)){c=this.parent.fieldsList.indexOf(a);if(c!==-1){this.parent.fieldsList[c]=i;this.parent.registerDragItem(i)}}this.parent.unregisterDragItem(a);E=BX.Filter.Utils.getByClass(i,this.parent.settings.classField,true);if(BX.type.isArray(E)&&E.length){E.forEach(function(t){t.FieldController=new BX.Filter.FieldController(t,this.parent)},this)}BX.insertAfter(i,a);BX.remove(a)}}},createNumber:function(t){var e,n,i,a,l,s;var r=this.parent.numberTypes;var E=r.SINGLE;if("SUB_TYPE"in t&&BX.type.isPlainObject(t.SUB_TYPE)){E=t.SUB_TYPE.VALUE;i="PLACEHOLDER"in t.SUB_TYPE?t.SUB_TYPE.PLACEHOLDER:""}t.NAME=t.NAME.replace("_numsel","");e={block:"number-group",type:t.TYPE,mix:this.parent.getParam("ENABLE_LABEL")?[this.parent.settings.classFieldWithLabel,"main-ui-filter-number-group"]:["main-ui-filter-number-group"],label:this.parent.getParam("ENABLE_LABEL")?t.LABEL:"",dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),tabindex:"TABINDEX"in t?t.TABINDEX:"",value:"SUB_TYPE"in t?t.SUB_TYPE:{},items:"SUB_TYPES"in t?t.SUB_TYPES:[],name:"NAME"in t?t.NAME:"",deleteButton:true,content:[]};if(E!==r.LESS){a={block:"main-ui-control-field",type:t.TYPE,dragButton:false,content:{block:"main-ui-number",mix:["filter-type-single"],calendarButton:true,valueDelete:true,placeholder:i,name:"NAME"in t?t.NAME+"_from":"",tabindex:"TABINDEX"in t?t.TABINDEX:"",value:"VALUES"in t?t.VALUES._from:""}};e.content.push(a)}if(E===r.RANGE){l={block:"main-ui-filter-field-line",content:{block:"main-ui-filter-field-line-item",tag:"span"}};e.content.push(l)}if(E===r.RANGE||E===r.LESS){s={block:"main-ui-control-field",type:t.TYPE,dragButton:false,content:{block:"main-ui-number",calendarButton:true,valueDelete:true,name:"NAME"in t?t.NAME+"_to":"",tabindex:"TABINDEX"in t?t.TABINDEX:"",value:"VALUES"in t?t.VALUES._to:""}}}e.content.push(s);return BX.decl(e)},createDate:function(t){var e,n,i,a,l,s,r,E,o;var u=this.parent.dateTypes;var c=u.NONE;if("SUB_TYPE"in t&&BX.type.isPlainObject(t.SUB_TYPE)){c=t.SUB_TYPE.VALUE;s="PLACEHOLDER"in t.SUB_TYPE?t.SUB_TYPE.PLACEHOLDER:""}t.NAME=t.NAME.replace("_datesel","");if("VALUES"in t&&BX.type.isPlainObject(t.VALUES)){var A=Object.keys(t.VALUES);A.forEach(function(e){if(!t.VALUES[e]){t.VALUES[e]=""}})}e={block:"date-group",type:t.TYPE,mix:this.parent.getParam("ENABLE_LABEL")?[this.parent.settings.classFieldWithLabel,"main-ui-filter-date-group"]:["main-ui-filter-date-group"],label:this.parent.getParam("ENABLE_LABEL")?t.LABEL:"",dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),tabindex:"TABINDEX"in t?t.TABINDEX:"",value:"SUB_TYPE"in t?t.SUB_TYPE:{},items:"SUB_TYPES"in t?t.SUB_TYPES:[],name:"NAME"in t?t.NAME:"",enableTime:"ENABLE_TIME"in t?t.ENABLE_TIME:false,deleteButton:true,content:[]};t.NAME=t.NAME.replace("_datesel","");if(c===u.EXACT){a={block:"main-ui-control-field",type:t.TYPE,dragButton:false,content:{block:"main-ui-date",mix:["filter-type-single"],calendarButton:true,valueDelete:true,placeholder:s,name:"NAME"in t?t.NAME+"_from":"",tabindex:"TABINDEX"in t?t.TABINDEX:"",value:"VALUES"in t?t.VALUES._from:"",enableTime:t.ENABLE_TIME}};e.content.push(a)}if(c===u.NEXT_DAYS||c===u.PREV_DAYS){a={block:"main-ui-control-field",type:t.TYPE,dragButton:false,content:{block:"main-ui-number",mix:["filter-type-single"],calendarButton:true,valueDelete:true,placeholder:s,name:"NAME"in t?t.NAME+"_days":"",tabindex:"TABINDEX"in t?t.TABINDEX:"",value:"VALUES"in t?t.VALUES._days:""}};e.content.push(a)}if(c===u.RANGE){n={block:"main-ui-control-field",type:t.TYPE,dragButton:false,content:{block:"main-ui-date",calendarButton:true,valueDelete:true,name:"NAME"in t?t.NAME+"_from":"",tabindex:"TABINDEX"in t?t.TABINDEX:"",value:"VALUES"in t?t.VALUES._from:"",placeholder:s,enableTime:t.ENABLE_TIME}};l={block:"main-ui-filter-field-line",content:{block:"main-ui-filter-field-line-item",tag:"span"}};i={block:"main-ui-control-field",type:t.TYPE,dragButton:false,content:{block:"main-ui-date",calendarButton:true,valueDelete:true,name:"NAME"in t?t.NAME+"_to":"",tabindex:"TABINDEX"in t?t.TABINDEX:"",value:"VALUES"in t?t.VALUES._to:"",placeholder:s,enableTime:t.ENABLE_TIME}};e.content.push(n);e.content.push(l);e.content.push(i)}if(c===u.MONTH){if("_month"in t.VALUES&&t.VALUES._month){t.MONTH=t.MONTHS.filter(function(e){return e.VALUE===t.VALUES._month});t.MONTH=t.MONTH.length?t.MONTH[0]:null}if(!t.MONTH){t.MONTH=t.MONTHS[0]}o={block:"main-ui-control-field",dragButton:false,content:{block:"main-ui-select",tabindex:"tabindex"in t?t.tabindex:"",value:t.MONTH,items:t.MONTHS,name:t.NAME+"_month",valueDelete:false}};if("_year"in t.VALUES&&t.VALUES._year){t.YEAR=t.YEARS.filter(function(e){return e.VALUE===t.VALUES._year});t.YEAR=t.YEAR.length?t.YEAR[0]:null}if(!t.YEAR){t.YEAR=t.YEARS[0]}r={block:"main-ui-control-field",dragButton:false,content:{block:"main-ui-select",tabindex:"tabindex"in t?t.tabindex:"",value:t.YEAR,items:t.YEARS,name:t.NAME+"_year",valueDelete:false}};e.content.push(o);e.content.push(r)}if(c===u.QUARTER){if("_year"in t.VALUES&&t.VALUES._year){t.YEAR=t.YEARS.filter(function(e){return e.VALUE===t.VALUES._year});t.YEAR=t.YEAR.length?t.YEAR[0]:null}if(!t.YEAR){t.YEAR=t.YEARS[0]}r={block:"main-ui-control-field",dragButton:false,content:{block:"main-ui-select",tabindex:"tabindex"in t?t.tabindex:"",value:t.YEAR,items:t.YEARS,name:t.NAME+"_year",valueDelete:false}};if("_quarter"in t.VALUES&&t.VALUES._quarter){t.QUARTER=t.QUARTERS.filter(function(e){return e.VALUE===t.VALUES._quarter});t.QUARTER=t.QUARTER.length?t.QUARTER[0]:null}if(!t.QUARTER){t.QUARTER=t.QUARTERS[0]}E={block:"main-ui-control-field",dragButton:false,content:{block:"main-ui-select",tabindex:"tabindex"in t?t.tabindex:"",value:t.QUARTER,items:t.QUARTERS,name:t.NAME+"_quarter",params:t.PARAMS,valueDelete:false}};e.content.push(E);e.content.push(r)}if(c===u.YEAR){if("_year"in t.VALUES&&t.VALUES._year){t.YEAR=t.YEARS.filter(function(e){return e.VALUE===t.VALUES._year});t.YEAR=t.YEAR.length?t.YEAR[0]:null}if(!t.YEAR){t.YEAR=t.YEARS[0]}r={block:"main-ui-control-field",dragButton:false,content:{block:"main-ui-select",tabindex:"tabindex"in t?t.tabindex:"",value:t.YEAR,items:t.YEARS,name:t.NAME+"_year",valueDelete:false}};e.content.push(r)}return BX.decl(e)}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:114:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/main-ui-control-custom-entity.min.js?15113164722940";s:6:"source";s:95:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/main-ui-control-custom-entity.js";s:3:"min";s:99:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/main-ui-control-custom-entity.min.js";s:3:"map";s:99:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/main-ui-control-custom-entity.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Main.ui");BX.Main.ui.CustomEntity=function(){this.field=null;this.labelInput=null;this.hiddenInput=null;this.popupContainer=null;this.inputClass="main-ui-control-string";this.squareClass="main-ui-square";this.multiple=null};BX.Main.ui.CustomEntity.isMultiple=function(t){if(!!t&&!BX.hasClass(t,"main-ui-control-entity")){t=BX.Filter.Utils.getByClass(t,"main-ui-control-entity")}return!!t&&JSON.parse(BX.data(t,"multiple"))};BX.Main.ui.CustomEntity.prototype={setField:function(t){if(this.field!==t){this.field=t;this.reset()}},isMultiple:function(){if(this.multiple===null){this.multiple=BX.Main.ui.CustomEntity.isMultiple(this.getField())}return this.multiple},reset:function(){this.labelInput=null;this.hiddenInput=null},getField:function(){return this.field},getId:function(){var t=this.getHiddenNode();var e=null;if(BX.type.isDomNode(t)){e=t.name}return e},getLabelNode:function(){if(!BX.type.isDomNode(this.labelInput)){this.labelInput=BX.Filter.Utils.getBySelector(this.getField(),"."+this.inputClass+'[type="text"]')}return this.labelInput},getHiddenNode:function(){if(!BX.type.isDomNode(this.hiddenInput)){this.hiddenInput=BX.Filter.Utils.getBySelector(this.getField(),"."+this.inputClass+'[type="hidden"]')}return this.hiddenInput},getSquareByValue:function(t){return BX.Filter.Utils.getBySelector(this.getField(),'[data-item*=":'+t+'}"]')},getSquares:function(){return BX.Filter.Utils.getByClass(this.getField(),this.squareClass,true)},removeSquares:function(){this.getSquares().forEach(BX.remove)},setSquare:function(t,e){var i=this.getField();var n={block:"main-ui-square",name:t,item:{_label:t,_value:e}};var s=BX.decl(n);var u=this.getSquares();if(!u.length){BX.prepend(s,i)}else{BX.insertAfter(s,u[u.length-1])}},getCurrentValues:function(){var t=this.getSquares();var e;try{e=JSON.parse(BX.data(t,"item"));e={label:e._label,value:e._value}}catch(i){e={label:"",value:""}}return e},setData:function(t,e){return this.isMultiple()?this.setMultipleData(t,e):this.setSingleData(t,e)},setSingleData:function(t,e){var i=this.getHiddenNode();this.removeSquares();this.setSquare(t,e);if(BX.type.isDomNode(i)){i.value=e;BX.fireEvent(i,"input")}},setMultipleData:function(t,e){var i=[];var n=this.getHiddenNode();if(BX.type.isArray(t)){this.removeSquares();if(BX.type.isArray(t)){t.forEach(function(t){i.push(t.value);this.setSquare(t.label,t.value)},this);if(BX.type.isDomNode(n)){n.value=JSON.stringify(i);BX.fireEvent(n,"input")}}}if(!BX.type.isArray(t)&&e!==null){if(!this.getSquareByValue(e)){this.setSquare(t,e);this.getSquares().forEach(function(t){var e=JSON.parse(BX.data(t,"item"));if(BX.type.isPlainObject(e)){i.push(e._value)}});n.value=JSON.stringify(i);BX.fireEvent(n,"input")}}},setPopupContainer:function(t){if(BX.type.isDomNode(t)){this.popupContainer=t}},getPopupContainer:function(){return this.popupContainer}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:93:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/presets.min.js?151131647214223";s:6:"source";s:73:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/presets.js";s:3:"min";s:77:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/presets.min.js";s:3:"map";s:77:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/presets.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Filter");BX.Filter.Presets=function(e){this.parent=null;this.presets=null;this.container=null;this.init(e)};BX.Filter.Presets.prototype={init:function(e){this.parent=e},bindOnPresetClick:function(){var e=this.getPresets();var t=this;(e||[]).forEach(function(e){BX.bind(e,"click",BX.delegate(t._onPresetClick,t))})},getAddPresetField:function(){return BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classAddPresetField)},getAddPresetFieldInput:function(){return BX.Filter.Utils.getByClass(this.getAddPresetField(),this.parent.settings.classAddPresetFieldInput)},clearAddPresetFieldInput:function(){var e=this.getAddPresetFieldInput();e&&(e.value="")},normalizePreset:function(e){if(!BX.hasClass(e,this.parent.settings.classPreset)){e=BX.findParent(e,{"class":this.parent.settings.classPreset},true,false)}return e},deactivateAllPresets:function(){var e=this.getPresets();var t=this;(e||[]).forEach(function(e){if(BX.hasClass(e,t.parent.settings.classPresetCurrent)){BX.removeClass(e,t.parent.settings.classPresetCurrent)}})},createSidebarItem:function(e,t,s){return BX.decl({block:"sidebar-item",text:BX.util.htmlspecialcharsback(t),id:e,pinned:s,noEditPinTitle:this.parent.getParam("MAIN_UI_FILTER__IS_SET_AS_DEFAULT_PRESET"),editNameTitle:this.parent.getParam("MAIN_UI_FILTER__EDIT_PRESET_TITLE"),removeTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_PRESET"),editPinTitle:this.parent.getParam("MAIN_UI_FILTER__SET_AS_DEFAULT_PRESET"),dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_TITLE")})},activatePreset:function(e){this.deactivateAllPresets();if(BX.type.isNotEmptyString(e)){e=this.getPresetNodeById(e)}if(!BX.hasClass(e,this.parent.settings.classPresetCurrent)){BX.addClass(e,this.parent.settings.classPresetCurrent)}},getPresetNodeById:function(e){var t=this.getPresets();var s=t.filter(function(t){return BX.data(t,"id")===e},this);return s.length>0?s[0]:null},getPresetId:function(e){return BX.data(e,"id")},updatePresetName:function(e,t){var s;if(BX.type.isDomNode(e)&&BX.type.isNotEmptyString(t)){s=this.getPresetNameNode(e);if(BX.type.isDomNode(s)){BX.html(s,t)}}},removePreset:function(e,t,s){var i=this.getCurrentPresetId();var r=[];var a={preset_id:t,is_default:s};var n={FILTER_ID:this.parent.getParam("FILTER_ID"),action:"REMOVE_FILTER"};this.parent.saveOptions(a,n);BX.remove(e);if(BX.type.isArray(this.parent.params["PRESETS"])){r=this.parent.params["PRESETS"].filter(function(e){return e.ID!==t},this);this.parent.params["PRESETS"]=r}if(BX.type.isArray(this.parent.editablePresets)){r=this.parent.editablePresets.filter(function(e){return e.ID!==t},this);this.parent.editablePresets=r}if(t===i){this.parent.getSearch().removePreset();this.resetPreset()}},pinPreset:function(e){if(!BX.type.isNotEmptyString(e)){e="default_filter"}var t=this.getPresetNodeById(e);if(this.parent.getParam("VALUE_REQUIRED_MODE")){if(e=="default_filter"){return}}var s={FILTER_ID:this.parent.getParam("FILTER_ID"),GRID_ID:this.parent.getParam("GRID_ID"),action:"PIN_PRESET"};var i={preset_id:e};this.getPresets().forEach(function(e){BX.removeClass(e,this.parent.settings.classPinnedPreset)},this);BX.addClass(t,this.parent.settings.classPinnedPreset);this.parent.saveOptions(i,s)},_onPresetClick:function(e){var t,s,i,r,a,n,l;e.preventDefault();l=this.parent;n=l.settings;a=e.target;t=e.currentTarget;s=this.getPresetId(t);i=this.getPreset(s);if(BX.hasClass(a,n.classPinButton)){if(this.parent.isEditEnabled()){if(BX.hasClass(t,n.classPinnedPreset)){this.pinPreset("default_filter")}else{this.pinPreset(s)}}}if(BX.hasClass(a,n.classPresetEditButton)){this.enableEditPresetName(t,a)}if(BX.hasClass(a,n.classPresetDeleteButton)){r="IS_DEFAULT"in i?i.IS_DEFAULT:false;this.removePreset(t,s,r);return false}if(!BX.hasClass(a,n.classPresetDragButton)&&!BX.hasClass(a,n.classAddPresetFieldInput)){if(this.parent.isEditEnabled()){this.updateEditablePreset(this.getCurrentPresetId())}this.activatePreset(t);this.applyPreset(s);if(!this.parent.isEditEnabled()){l.applyFilter(null,true);if(e.isTrusted){l.closePopup()}if(l.isAddPresetEnabled()){l.disableAddPreset()}}}},applyPinnedPreset:function(){var e=this.parent;var t=this.isPinned(this.getCurrentPresetId());var s;if(!t){var i=this.getPinnedPresetId();var r=this.getPinnedPresetNode();var a=false;var n=true;this.deactivateAllPresets();this.activatePreset(r);this.applyPreset(i);s=e.applyFilter(a,n);e.closePopup()}else{s=e.resetFilter()}return s},updateEditablePreset:function(e){var t=this.parent.getFilterFieldsValues();var s=this.getFields().map(function(e){return BX.data(e,"name")});var i=this.parent.preparePresetFields(t,s);var r=this.getPreset(e);r.FIELDS=i;r.TITLE=this.getPresetInput(this.getPresetNodeById(e)).value;r.ROWS=s},getPresetInput:function(e){return BX.Filter.Utils.getByClass(e,this.parent.settings.classPresetEditInput)},enableEditPresetName:function(e){var t=this.getPresetInput(e);BX.addClass(e,this.parent.settings.classPresetNameEdit);t.focus();t.value=BX.util.htmlspecialcharsback(t.value);BX.bind(t,"input",BX.delegate(this._onPresetNameInput,this))},_onPresetNameInput:function(e){var t=this.parent.getSearch();var s=e.currentTarget.value;var i=BX.findParent(e.currentTarget,{className:this.parent.settings.classPreset},true,false);var r=this.getPresetId(i);var a=this.getCurrentPresetId();var n={ID:r,TITLE:s};if(r===a){t.updatePreset(n)}},getPresetNameNode:function(e){return BX.Filter.Utils.getByClass(e,this.parent.settings.classPresetName)},disableEditPresetName:function(e){var t=this.getPresetInput(e);BX.removeClass(e,this.parent.settings.classPresetNameEdit);if(BX.type.isDomNode(t)){t.blur();BX.unbind(t,"input",BX.delegate(this._onPresetNameInput,this))}},getPreset:function(e,t){var s=this.parent.getParam(t?"DEFAULT_PRESETS":"PRESETS",[]);if(this.parent.isEditEnabled()&&!t){s=this.parent.editablePresets}var i=s.filter(function(t){return t.ID===e});return i.length!==0?i[0]:null},getPresetField:function(e,t){var s=this.getPreset(e);var i=null;if(BX.type.isPlainObject(s)&&"FIELDS"in s&&BX.type.isArray(s.FIELDS)){i=s.FIELDS.filter(function(e){return e.NAME===t},this);i=i.length?i[0]:null}return i},applyPreset:function(e,t){var s;e=t?"default_filter":e||"default_filter";s=this.getPreset(e);if(e!=="default_preset"){s=this.extendPreset(s)}this.parent.getSearch().updatePreset(s);this.updatePresetFields(s,t)},extendPreset:function(e){var t=BX.clone(this.getPreset("default_filter"));if(BX.type.isPlainObject(e)){e=BX.clone(e);e.FIELDS.forEach(function(e,s){var i;var r=t.FIELDS.some(function(t,s){var r=false;if(t.NAME===e.NAME){i=s;r=true}return r},this);if(r&&i||r&&i===0){t.FIELDS[i]=e}else{if(!this.isEmptyField(e)){t.FIELDS.push(e)}}},this);e.FIELDS=t.FIELDS}return e},isEmptyField:function(e){var t=true;if(e.TYPE===this.parent.types.STRING){if(e.VALUE&&e.VALUE.length){t=false}}if(e.TYPE===this.parent.types.SELECT){if(BX.type.isPlainObject(e.VALUE)&&"VALUE"in e.VALUE&&e.VALUE.VALUE){t=false}}if(e.TYPE===this.parent.types.MULTI_SELECT){if(BX.type.isArray(e.VALUE)&&e.VALUE.length){t=false}}if(e.TYPE===this.parent.types.CUSTOM_ENTITY){if(BX.type.isPlainObject(e.VALUES)&&e.VALUES._label&&e.VALUES._value){t=false}}if(e.TYPE===this.parent.types.DATE){if(BX.type.isPlainObject(e.VALUES)&&(e.VALUES._from||e.VALUES._to||e.VALUES._month||e.VALUES._quarter||e.VALUES._year||e.VALUES._days)||(e.VALUES._datesel===this.parent.dateTypes.CURRENT_DAY||e.VALUES._datesel===this.parent.dateTypes.CURRENT_WEEK||e.VALUES._datesel===this.parent.dateTypes.CURRENT_MONTH||e.VALUES._datesel===this.parent.dateTypes.CURRENT_QUARTER||e.VALUES._datesel===this.parent.dateTypes.LAST_7_DAYS||e.VALUES._datesel===this.parent.dateTypes.LAST_30_DAYS||e.VALUES._datesel===this.parent.dateTypes.LAST_60_DAYS||e.VALUES._datesel===this.parent.dateTypes.LAST_90_DAYS||e.VALUES._datesel===this.parent.dateTypes.LAST_WEEK||e.VALUES._datesel===this.parent.dateTypes.LAST_MONTH)){t=false}}if(e.TYPE===this.parent.types.NUMBER){if(BX.type.isPlainObject(e.VALUES)&&(e.VALUES._from||e.VALUES._to)){t=false}}if(e.TYPE===this.parent.types.CHECKBOX){if(BX.type.isPlainObject(e.VALUE)&&e.VALUE.VALUE){t=false}}return t},resetPreset:function(e){this.applyPreset(null,e)},getFields:function(){var e=this.parent.getFieldListContainer();var t=null;if(BX.type.isDomNode(e)){t=BX.Filter.Utils.getBySelector(e.parentNode,"."+this.parent.settings.classFileldControlList+" > div",true)}return t},getField:function(e){var t=this.getFields();var s=null;var i,r;if(BX.type.isArray(t)&&t.length){r=t.filter(function(t){if(BX.type.isDomNode(t)){i=BX.data(t,"name")}return i===e.NAME},this);s=r.length>0?r[0]:null}return s},removeField:function(e){var t,s;if(BX.type.isPlainObject(e)){s=e.NAME;e=this.getField(e);if(BX.type.isArray(this.parent.fieldsList)){t=this.parent.fieldsList.indexOf(e);if(t!==-1){delete this.parent.fieldsList[t]}}this.parent.unregisterDragItem(e)}if(BX.type.isDomNode(e)){s=BX.data(e,"name");this.parent.getFields().deleteField(e)}if(!this.parent.isEditEnabled()&&!this.parent.isAddPresetEnabled()){var i=this.getCurrentPresetId();var r=this.getPresetField(i,s);if(r&&!this.isEmptyField(r)){this.deactivateAllPresets();this.parent.applyFilter()}}this.parent.saveFieldsSort()},addField:function(e){var t,s,i;if(BX.type.isPlainObject(e)){t=this.parent.getFieldListContainer();i=this.parent.getControls();s=BX.type.isArray(i)?i[i.length-1]:null;if(BX.type.isDomNode(s)){if(s.nodeName!=="INPUT"){s=BX.Filter.Utils.getByTag(s,"input")}if(BX.type.isDomNode(s)){e.TABINDEX=parseInt(s.getAttribute("tabindex"))+1}}else{e.TABINDEX=2}if(BX.type.isDomNode(t)){s=this.createControl(e);if(BX.type.isDomNode(s)){BX.append(s,t);if(BX.type.isArray(this.parent.fieldsList)){this.parent.fieldsList.push(s)}this.parent.registerDragItem(s)}}}if(!this.parent.isEditEnabled()&&!this.parent.isAddPresetEnabled()){var r=this.getCurrentPresetId();var a=this.getPresetField(r,e.NAME);if(a&&!this.isEmptyField(a)){this.parent.updatePreset("tmp_filter");this.deactivateAllPresets();this.parent.getSearch().updatePreset(this.getPreset("tmp_filter"))}}this.parent.saveFieldsSort()},createControl:function(e){var t;switch(e.TYPE){case this.parent.types.STRING:{t=this.parent.getFields().createInputText(e);break}case this.parent.types.SELECT:{t=this.parent.getFields().createSelect(e);break}case this.parent.types.MULTI_SELECT:{t=this.parent.getFields().createMultiSelect(e);break}case this.parent.types.NUMBER:{t=this.parent.getFields().createNumber(e);break}case this.parent.types.DATE:{t=this.parent.getFields().createDate(e);break}case this.parent.types.USER:{t=this.parent.getFields().createUser(e);break}case this.parent.types.ENTITY:{t=this.parent.getFields().createEntity(e);break}case this.parent.types.CUSTOM:{t=this.parent.getFields().createCustom(e);break}case this.parent.types.CUSTOM_ENTITY:{t=this.parent.getFields().createCustomEntity(e);break}default:{break}}if(BX.type.isDomNode(t)){t.dataset.name=e.NAME;t.FieldController=new BX.Filter.FieldController(t,this.parent)}return t},removeNotCompareVariables:function(e){if("FIND"in e){delete e.FIND}},isPresetValuesModified:function(e){var t=this.getPreset(e);var s=this.parent.preparePresetSettingsFields(t.FIELDS,t.ROWS);var i=this.parent.getFilterFieldsValues();this.removeNotCompareVariables(s);this.removeNotCompareVariables(i);var r=BX.Filter.Utils.sortObject(s);var a=BX.Filter.Utils.sortObject(i);return!BX.Filter.Utils.objectsIsEquails(r,a)},getAdditionalValues:function(e){var t=this.getPreset(e);var s=this.parent.preparePresetSettingsFields(t.FIELDS,t.ROWS);var i=this.parent.getFilterFieldsValues();this.removeNotCompareVariables(s);this.removeNotCompareVariables(i);this.removeSameProperties(i,s);return i},removeSameProperties:function(e,t){var s=Object.keys(e);s.forEach(function(s){if(s in t){if(BX.type.isPlainObject(e[s])){var i=BX.Filter.Utils.sortObject(e);var r=BX.Filter.Utils.sortObject(t);if(!BX.Filter.Utils.objectsIsEquails(i,r)){e[s]=this.removeSameProperties(e[s],t[s])}else{delete e[s]}}else{delete e[s]}}},this);return e},updatePresetFields:function(e,t){var s,i;var r=[];if(BX.type.isPlainObject(e)&&"FIELDS"in e){s=e.FIELDS;(s||[]).forEach(function(e,s){e.TABINDEX=s+1;if(t){switch(e.TYPE){case this.parent.types.SELECT:{e.VALUE=e.ITEMS[0];break}case this.parent.types.MULTI_SELECT:{e.VALUE=[];break}case this.parent.types.DATE:{e.SUB_TYPE=e.SUB_TYPES[0];e.VALUES={_from:"",_to:"",_days:""};break}case this.parent.types.NUMBER:{e.SUB_TYPE=e.SUB_TYPES[0];e.VALUES={_from:"",_to:""};break}case this.parent.types.CUSTOM_ENTITY:{e.VALUES={_label:"",_value:""};break}case this.parent.types.CUSTOM:{e._VALUE="";break}default:{if("VALUE"in e){if(BX.type.isArray(e.VALUE)){e.VALUE=[]}else{e.VALUE=""}}break}}}r.push(this.createControl(e))},this);this.parent.disableFieldsDragAndDrop();i=this.parent.getFieldListContainer();BX.cleanNode(i);if(r.length){r.forEach(function(e){if(BX.type.isDomNode(e)){BX.append(e,i)}});this.parent.enableFieldsDragAndDrop()}}},showCurrentPresetFields:function(){var e=this.getCurrentPresetData();this.updatePresetFields(e)},getCurrentPreset:function(){return BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classPresetCurrent)},getCurrentPresetId:function(){var e=this.getCurrentPreset();var t=null;if(BX.type.isDomNode(e)){t=this.getPresetId(e)}else{t="default_filter"}return t},getCurrentPresetData:function(){var e=this.getCurrentPresetId();var t=null;if(BX.type.isNotEmptyString(e)){t=this.getPreset(e);t=this.extendPreset(t)}return t},getContainer:function(){return BX.Filter.Utils.getByClass(this.parent.getFilter(),this.parent.settings.classPresetsContainer)},getPresets:function(){return BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classPreset,true)},getDefaultPresets:function(){return BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classDefaultFilter,true)},getPinnedPresetNode:function(){return BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classPinnedPreset)},isPinned:function(e){return this.getPinnedPresetId()===e},getPinnedPresetId:function(){var e=this.getPinnedPresetNode();var t="default_filter";if(!!e){var s=BX.data(e,"id");t=!!s?s:t}return t}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:92:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/search.min.js?151131647215840";s:6:"source";s:72:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/search.js";s:3:"min";s:76:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/search.min.js";s:3:"map";s:76:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/search.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Filter");BX.Filter.Search=function(t){this.parent=null;this.container=null;this.input=null;this.preset=null;this.buttonsContainer=null;this.delay=800;this.timeout=null;this.init(t)};BX.Filter.Search.prototype={init:function(t){this.parent=t;BX.bind(this.getInput(),"input",BX.delegate(this._onInputWithoutDebounce,this));if(this.parent.getParam("ENABLE_LIVE_SEARCH")){BX.bind(this.getInput(),"input",BX.debounce(this._onInput,this.delay,this))}BX.bind(this.getInput(),"keydown",BX.delegate(this._onKeyDown,this));BX.bind(this.getFindButton(),"click",BX.delegate(this._onSearchClick,this));BX.bind(this.getContainer(),"click",BX.delegate(this._onSearchContainerClick,this));this.firstInit=true},getFindButton:function(){if(!BX.type.isDomNode(this.findButton)){this.findButton=BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classSearchButton)}return this.findButton},_onSearchClick:function(){this.apply()},selectSquare:function(t){!!t&&BX.addClass(t,this.parent.settings.classSquareSelected)},selectSquares:function(){this.getSquares().forEach(this.selectSquare,this)},unselectSquare:function(t){!!t&&BX.removeClass(t,this.parent.settings.classSquareSelected)},unselectSquares:function(){this.getSquares().forEach(this.unselectSquare,this)},removeSquares:function(){this.getSquares().forEach(this.removeSquare,this)},isSquaresSelected:function(){return this.getSquares().every(this.isSquareSelected,this)},isSquareSelected:function(t){return!!t&&BX.hasClass(t,this.parent.settings.classSquareSelected)},getLastSquare:function(){var t=this.getSquares();return!!t?t[t.length-1]:null},isTextSelected:function(){var t=this.getSearchString().length;var e=this.getInput();var s=e.selectionStart;var i=e.selectionEnd;return s===0&&i===t},isSelectionStart:function(){var t=this.getInput();var e=t.selectionStart;var s=t.selectionEnd;return e===0&&s===0},isSquareRemoveButton:function(t){return!!t&&BX.hasClass(t,this.parent.settings.classSquareDelete)},isClearButton:function(t){return!!t&&BX.hasClass(t,this.parent.settings.classClearSearchValueButton)},isSearchButton:function(t){return!!t&&BX.hasClass(t,this.parent.settings.classSearchButton)},adjustFocus:function(){var t=this.getInput();if(document.activeElement!==t&&window.scrollY<BX.pos(t).top){t.value=t.value;t.blur();t.focus()}},findSquareByChild:function(t){return BX.findParent(t,{className:this.parent.settings.classSquare},true,false)},getSquareData:function(t){var e=BX.data(t,"item");return!!t&&!!e?JSON.parse(e):null},isSquareControl:function(t){var e=this.getSquareData(t);return!!e&&(e.type==="control"||BX.type.isArray(e))},onPresetSquareRemove:function(){var t=this.parent;var e=t.getPreset();var s=e.getCurrentPresetId();var i=t.getParam("RESET_TO_DEFAULT_MODE");var r=e.isPinned(s);if(i&&r||!i){var a=true;this.lastPromise=t.resetFilter(a);t.closePopup()}if(i&&!r){this.lastPromise=t.getPreset().applyPinnedPreset()}},onControlSquareRemove:function(t){var e=this.parent;var s=e.getParam("RESET_TO_DEFAULT_MODE");if(s&&this.getSquares().length===1){this.lastPromise=e.getPreset().applyPinnedPreset()}else{var i=this.getSquareData(t);e.clearControls(i);e.closePopup();this.apply()}},onValueRequiredSquareRemove:function(){var t=this.parent;t.getPreset().deactivateAllPresets();t.showPopup();this.adjustPlaceholder()},complexSquareRemove:function(t){var e=this.parent.getParam("VALUE_REQUIRED_MODE");var s=!this.isSquareControl(t);if(e){this.onValueRequiredSquareRemove()}else{if(s){this.onPresetSquareRemove()}else{this.onControlSquareRemove(t)}}this.removeSquare(t);this.adjustClearButton()},adjustClearButton:function(){!!this.getLastSquare()?this.showClearButton():this.hideClearButton()},removeSquare:function(t){!!t&&BX.remove(t)},_onSearchContainerClick:function(t){var e=this.parent;if(this.isClearButton(t.target)){if(!e.getParam("VALUE_REQUIRED_MODE")){if(e.getParam("RESET_TO_DEFAULT_MODE")){this.clearInput();this.lastPromise=e.getPreset().applyPinnedPreset()}else{e.resetFilter()}e.closePopup();this.adjustFocus()}else{this.removeSquares();e.showPopup();this.adjustPlaceholder();this.hideClearButton();e.getPreset().deactivateAllPresets()}}else if(this.isSearchButton(t.target)){this.apply();this.adjustFocus()}else if(this.isSquareRemoveButton(t.target)){var s=this.findSquareByChild(t.target);this.complexSquareRemove(s);this.adjustFocus()}else{if(!e.getPopup().isShown()){e.showPopup()}else{var i=this.getInput();var r=i.selectionStart;var a=i.selectionEnd;var n=this.getSearchString().length;if(!(n&&r===0&&a===n)){e.closePopup();if(e.getParam("VALUE_REQUIRED_MODE")){e.restoreRemovedPreset()}}}}},_onKeyDown:function(t){var e=BX.Filter.Utils;var s=this.parent;if(e.isKey(t,"enter")){this.apply();s.closePopup()}if(e.isKey(t,"tab")||e.isKey(t,"downArrow")){s.showPopup();s.adjustFocus();this.unselectSquares()}if(e.isKey(t,"upArrow")){s.closePopup();s.getParam("VALUE_REQUIRED_MODE")&&this.parent.restoreRemovedPreset()}if(e.isKey(t,"a")&&t.metaKey||e.isKey(t,"a")&&t.ctrlKey){this.selectSquares()}if(e.isKey(t,"backspace")&&this.isTextSelected()&&this.isSquaresSelected()){clearTimeout(this.timeout);if(this.parent.getParam("RESET_TO_DEFAULT_MODE")){this.lastPromise=this.parent.getPreset().applyPinnedPreset()}else{this.lastPromise=this.parent.resetFilter()}this.parent.closePopup()}if(e.isKey(t,"backspace")&&this.isSelectionStart()){clearTimeout(this.timeout);var i=this.getLastSquare();this.isSquareSelected(i)?this.complexSquareRemove(i):this.selectSquare(i)}if(!e.isKey(t,"backspace")&&!t.metaKey&&this.isSquaresSelected()){this.unselectSquares()}},getSearchString:function(){var t=this.getInput();return!!t?t.value:""},getSquares:function(){return BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classSquare,true)},adjustPlaceholder:function(){this.setInputPlaceholder(this.parent.getParam("MAIN_UI_FILTER__PLACEHOLDER"+(this.parent.getParam("DISABLE_SEARCH")||!this.parent.settings.get("SEARCH")?"":"_DEFAULT")))},isResolvedRequest:function(){return!this.lastPromise||!!this.lastPromise&&this.lastPromise.state},apply:function(){if(this.isResolvedRequest()){this.lastPromise=this.parent.applyFilter(null,true)}return this.lastPromise},reset:function(){if(this.isResolvedRequest()){this.parent.getSearch().removePreset();this.parent.getPreset().deactivateAllPresets();this.parent.getPreset().resetPreset(true);this.timeout=setTimeout(BX.delegate(function(){this.lastPromise=this.parent.resetFilter()},this),this.delay)}return this.lastPromise},_onInputWithoutDebounce:function(){clearTimeout(this.timeout);var t=this.getSearchString();this.lastSearchString=!!this.lastSearchString?this.lastSearchString:t;if(t!==this.lastSearchString&&(!this.parent.isIe()||!this.firstInit)){if(this.parent.getParam("ENABLE_LIVE_SEARCH")){this.parent.showGridAnimation();BX.onCustomEvent(window,"BX.Filter.Search:input",[this.parent.params.FILTER_ID,t])}this.parent.getPopup().isShown()&&this.parent.closePopup()}if(t){this.showClearButton()}else{if(!this.getSquares().length&&this.lastSearchString!==t){this.hideClearButton();this.adjustPlaceholder()}}},_onInput:function(){var t=this.getSearchString();if(t!==this.lastSearchString&&(!this.parent.isIe()||!this.firstInit)){this.apply()}this.firstInit=false;this.lastSearchString=t},getButtonsContainer:function(){if(!BX.type.isDomNode(this.buttonsContainer)){this.buttonsContainer=BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classSearchButtonsContainer)}return this.buttonsContainer},showClearButton:function(){BX.addClass(this.getButtonsContainer(),this.parent.settings.classShow)},hideClearButton:function(){BX.removeClass(this.getButtonsContainer(),this.parent.settings.classShow)},getInput:function(){var t;if(!BX.type.isDomNode(this.input)){t=[this.parent.getParam("FILTER_ID",""),"_search"].join("");this.input=BX(t)}return this.input},getContainer:function(){var t;if(!BX.type.isDomNode(this.container)){t=[this.parent.getParam("FILTER_ID"),"_search_container"].join("");this.container=BX(t)}return this.container},setInputPlaceholder:function(t){var e=this.getInput();e.placeholder=t},clearInput:function(){var t=this.getInput();if(BX.type.isDomNode(t)){t.value=null}},clearForm:function(){this.clearInput();this.removePreset()},makeSquares:function(t,e,s){var i;var r=null;var a=this.getContainer();var n={squares:[],moreSquares:[]};t.forEach(function(t,o){if(o<e){i=BX.decl(t);r=r||i;if(!s){if(o===0){BX.prepend(i,a)}else{BX.insertAfter(i,r)}}else{var u=BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classSquare);if(u){BX.insertAfter(i,u)}else{BX.prepend(i,a)}}r=i;n.squares.push(i)}else{n.moreSquares.push({type:"control",name:t.value,title:t.title})}},this);return n},squares:function(t,e,s){var i,r,a,n,o;var u=BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classSquare,true);if(s){u.forEach(function(t){var e=BX.data(t,"item");if(e){BX.remove(t)}})}else{u.forEach(BX.remove)}i=this.prepareSquaresData(t);r=this.makeSquares(i,e,s);n=0;o={squaresData:i,width:0};if(r.moreSquares.length){a={block:"main-ui-search-square",name:this.parent.getParam("MAIN_UI_FILTER__AND")+" "+this.parent.getParam("MAIN_UI_FILTER__MORE")+" "+r.moreSquares.length,item:r.moreSquares,title:r.moreSquares.map(function(t){return t.title}).join(", \n")};a=BX.decl(a);r.squares.push(a);BX.insertAfter(a,r.squares[r.squares.length-2]);n=r.squares.reduce(function(t,e){return t+BX.width(e)+(parseFloat(BX.style(e,"margin-right"))||0)},0)}o.width=n;return o},setPreset:function(t){var e=this.getContainer();var s,i;var r;if(BX.type.isPlainObject(t)){i=BX.Filter.Utils.getByClass(e,this.parent.settings.classSquare,true);i.forEach(BX.remove);t=BX.clone(t);t.ADDITIONAL=t.ADDITIONAL||[];BX.onCustomEvent(window,"BX.Filter.Search:beforeSquaresUpdate",[t,this]);if(t.ID!=="default_filter"&&t.ID!=="tmp_filter"){s=BX.decl({block:"main-ui-search-square",name:t.TITLE,value:t.ID,isPreset:true});BX.prepend(s,e);if("ADDITIONAL"in t&&BX.type.isArray(t.ADDITIONAL)&&t.ADDITIONAL.length){r=this.squares(t.ADDITIONAL,1,true);if(BX.width(e)-r.width<100){r=this.squares(t.ADDITIONAL,0,true)}}}else{if("ADDITIONAL"in t&&BX.type.isArray(t.ADDITIONAL)&&t.ADDITIONAL.length){t.ADDITIONAL.forEach(function(e,s){if(!("ID"in e)){e.ID="ADDITIONAL_ID_"+s}if(!("NAME"in e)){e.NAME="ADDITIONAL_NAME_"+s}if(!("TYPE"in e)){e.TYPE="STRING"}if("LABEL"in e&&"LABEL"in e){t.FIELDS.push(e)}})}if(BX.type.isArray(t.FIELDS)&&t.FIELDS.length){r=this.squares(t.FIELDS,2);if(BX.width(e)-r.width<100){r=this.squares(t.FIELDS,1)}}}if(r&&BX.type.isArray(r.squaresData)&&r.squaresData.length||t.ID!=="default_filter"&&t.ID!=="tmp_filter"){this.setInputPlaceholder(this.parent.getParam("MAIN_UI_FILTER__PLACEHOLDER_WITH_FILTER"));this.showClearButton()}else{if(this.parent.getParam("DISABLE_SEARCH")||!this.parent.settings.get("SEARCH")){this.setInputPlaceholder(this.parent.getParam("MAIN_UI_FILTER__PLACEHOLDER"))}else{this.setInputPlaceholder(this.parent.getParam("MAIN_UI_FILTER__PLACEHOLDER_DEFAULT"))}}if(BX.type.isNotEmptyString(this.parent.getSearch().getInput().value)){this.showClearButton()}}},prepareSquaresData:function(t){var e,s,i,r;var a=[];t.map(function(t){e=null;switch(t.TYPE){case this.parent.types.DATE:{e=t.LABEL+": "+t.SUB_TYPE.NAME;if(t.SUB_TYPE.VALUE===this.parent.dateTypes.QUARTER&&BX.type.isNotEmptyString(t.VALUES._quarter)){var r=t.QUARTERS.filter(function(e){return e.VALUE==t.VALUES._quarter}).map(function(t){return t.NAME});r=r.length?r.join(""):"";e=t.LABEL+": "+r+" "+this.parent.getParam("MAIN_UI_FILTER__QUARTER").toLocaleLowerCase()+" "+t.VALUES._year}if(t.SUB_TYPE.VALUE===this.parent.dateTypes.YEAR&&BX.type.isNotEmptyString(t.VALUES._year)){e=t.LABEL+": "+t.VALUES._year}if(t.SUB_TYPE.VALUE===this.parent.dateTypes.MONTH&&BX.type.isNotEmptyString(t.VALUES._month)){var n=t.MONTHS.filter(function(e){return e.VALUE==t.VALUES._month}).map(function(t){return t.NAME});n=n.length?n.join(""):"";e=t.LABEL+": "+n+" "+t.VALUES._year}if(t.SUB_TYPE.VALUE===this.parent.dateTypes.EXACT&&BX.type.isNotEmptyString(t.VALUES._from)){e=t.LABEL+": "+t.VALUES._from}if(t.SUB_TYPE.VALUE===this.parent.dateTypes.RANGE){if(BX.type.isNotEmptyString(t.VALUES._from)&&BX.type.isNotEmptyString(t.VALUES._to)){e=t.LABEL+": "+t.VALUES._from+"-"+t.VALUES._to}else if(!BX.type.isNotEmptyString(t.VALUES._from)&&BX.type.isNotEmptyString(t.VALUES._to)){e=t.LABEL+": "+this.parent.getParam("MAIN_UI_FILTER__BEFORE")+" "+t.VALUES._to}else if(BX.type.isNotEmptyString(t.VALUES._from)&&!BX.type.isNotEmptyString(t.VALUES._to)){e=t.LABEL+": "+this.parent.getParam("MAIN_UI_FILTER__AFTER")+" "+t.VALUES._from}}if((t.SUB_TYPE.VALUE===this.parent.dateTypes.NEXT_DAYS||t.SUB_TYPE.VALUE===this.parent.dateTypes.PREV_DAYS)&&!BX.type.isNumber(parseInt(t.VALUES._days))){e=null}if(t.SUB_TYPE.VALUE===this.parent.dateTypes.NEXT_DAYS&&BX.type.isNumber(parseInt(t.VALUES._days))){e=t.LABEL+": "+this.parent.getParam("MAIN_UI_FILTER__DATE_NEXT_DAYS_LABEL").replace("#N#",t.VALUES._days)}if(t.SUB_TYPE.VALUE===this.parent.dateTypes.PREV_DAYS&&BX.type.isNumber(parseInt(t.VALUES._days))){e=t.LABEL+": "+this.parent.getParam("MAIN_UI_FILTER__DATE_PREV_DAYS_LABEL").replace("#N#",t.VALUES._days)}if(t.SUB_TYPE.VALUE===this.parent.dateTypes.NONE){e=null}break}case this.parent.types.SELECT:{if(BX.type.isPlainObject(t.VALUE)&&t.VALUE.VALUE){e=t.LABEL+": "+t.VALUE.NAME}break}case this.parent.types.MULTI_SELECT:{if(BX.type.isArray(t.VALUE)&&t.VALUE.length){s=[];e=t.LABEL+": ";t.VALUE.forEach(function(t,e){if(e<2){s.push(t.NAME)}});e+=s.join(", ");if(t.VALUE.length>2){i=[];t.VALUE.forEach(function(t){i.push(t.NAME)});e=i.join(", ")}}break}case this.parent.types.NUMBER:{if(t.SUB_TYPE.VALUE==="exact"){if(BX.type.isNotEmptyString(t.VALUES._from)){e=t.LABEL+": "+t.VALUES._from}else{e=null}}if(t.SUB_TYPE.VALUE==="range"){if(BX.type.isNotEmptyString(t.VALUES._from)&&BX.type.isNotEmptyString(t.VALUES._to)){e=t.LABEL+": "+t.VALUES._from+"-"+t.VALUES._to}else if(!BX.type.isNotEmptyString(t.VALUES._from)&&BX.type.isNotEmptyString(t.VALUES._to)){e=t.LABEL+": "+this.parent.getParam("MAIN_UI_FILTER__NUMBER_LESS")+" "+t.VALUES._to}else if(BX.type.isNotEmptyString(t.VALUES._from)&&!BX.type.isNotEmptyString(t.VALUES._to)){e=t.LABEL+": "+this.parent.getParam("MAIN_UI_FILTER__NUMBER_MORE")+" "+t.VALUES._from}else{e=null}}if(t.SUB_TYPE.VALUE==="more"){if(BX.type.isNotEmptyString(t.VALUES._from)){e=t.LABEL+": > ";e+=t.VALUES._from}}if(t.SUB_TYPE.VALUE==="less"){if(BX.type.isNotEmptyString(t.VALUES._to)){e=t.LABEL+": < ";e+=t.VALUES._to}}break}case this.parent.types.CUSTOM_ENTITY:{if(t.MULTIPLE){var o=!!t.VALUES._label?t.VALUES._label:[];if(BX.type.isPlainObject(o)){o=Object.keys(o).map(function(t){return o[t]})}if(o.length){e=t.LABEL+": ";e+=o.join(", ")}}else{if(BX.type.isNotEmptyString(t.VALUES._value)&&BX.type.isNotEmptyString(t.VALUES._label)){e=t.LABEL+": ";e+=t.VALUES._label}}break}case this.parent.types.CUSTOM:{e="_VALUE"in t&&BX.type.isNotEmptyString(t._VALUE)?t.LABEL:null;break}default:{if(BX.type.isNotEmptyString(t.VALUE)){e=t.LABEL+": "+t.VALUE}break}}if(e!==null){a.push({block:"main-ui-search-square",name:e,value:t.NAME,item:{type:"control",name:t.NAME},title:e})}},this);return a},getPreset:function(){var t=this.getContainer();var e=this.parent.settings.classSquare;var s=null;if(BX.type.isDomNode(t)){s=BX.Filter.Utils.getByClass(t,e)}return s},removePreset:function(){var t=this.getPreset();if(BX.type.isDomNode(t)){BX.remove(t);if(this.parent.getParam("DISABLE_SEARCH")||!this.parent.settings.get("SEARCH")){this.setInputPlaceholder(this.parent.getParam("MAIN_UI_FILTER__PLACEHOLDER"))}else{this.setInputPlaceholder(this.parent.getParam("MAIN_UI_FILTER__PLACEHOLDER_DEFAULT"))}}this.hideClearButton()},updatePreset:function(t){this.removePreset();this.setPreset(t)}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:93:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/settings.min.js?15113164724325";s:6:"source";s:74:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/settings.js";s:3:"min";s:78:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/settings.min.js";s:3:"map";s:78:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/settings.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Filter");BX.Filter.Settings=function(i,t){this.classField="main-ui-control-field";this.classFieldGroup="main-ui-control-field-group";this.classFieldLine="main-ui-filter-field-line";this.classFieldDelete="main-ui-filter-field-delete";this.classFieldLabel="main-ui-control-field-label";this.classFieldWithLabel="main-ui-filter-wield-with-label";this.classPresetName="main-ui-filter-sidebar-item-text";this.classControl="main-ui-control";this.classDateInput="main-ui-date-input";this.classHide="main-ui-hide";this.classNumberInput="main-ui-number-input";this.classSelect="main-ui-select";this.classMultiSelect="main-ui-multi-select";this.classValueDelete="main-ui-control-value-delete";this.classStringInput="main-ui-control-string";this.classAddField="main-ui-filter-field-add-item";this.classAddPresetField="main-ui-filter-new-filter";this.classAddPresetFieldInput="main-ui-filter-sidebar-edit-control";this.classAddPresetButton="main-ui-filter-add-item";this.classButtonsContainer="main-ui-filter-field-button-container";this.classSaveButton="main-ui-filter-save";this.classCancelButton="main-ui-filter-cancel";this.classMenuItem="main-ui-select-inner-item";this.classMenuItemText="main-ui-select-inner-item-element";this.classMenuMultiItemText="main-ui-select-inner-label";this.classMenuItemChecked="main-ui-checked";this.classSearchContainer="main-ui-filter-search";this.classDefaultPopup="popup-window";this.classPopupFieldList="main-ui-filter-popup-field-list";this.classPopupFieldList1Column="main-ui-filter-field-list-1-column";this.classPopupFieldList2Column="main-ui-filter-field-list-2-column";this.classPopupFieldList3Column="main-ui-filter-field-list-3-column";this.classFieldListItem="main-ui-filter-field-list-item";this.classEditButton="main-ui-filter-add-edit";this.classPresetEdit="main-ui-filter-edit";this.classPresetNameEdit="main-ui-filter-edit-text";this.classPresetDeleteButton="main-ui-delete";this.classPresetDragButton="main-ui-filter-icon-grab";this.classPresetEditButton="main-ui-filter-icon-edit";this.classPresetEditInput="main-ui-filter-sidebar-item-input";this.classPresetOndrag="main-ui-filter-sidebar-item-ondrag";this.classSquare="main-ui-square";this.classSquareDelete="main-ui-square-delete";this.classSquareSelected="main-ui-square-selected";this.classPresetsContainer="main-ui-filter-sidebar-item-container";this.classPreset="main-ui-filter-sidebar-item";this.classPresetCurrent="main-ui-filter-current-item";this.classFilterContainer="main-ui-filter-wrapper";this.classFileldControlList="main-ui-filter-field-container-list";this.classRestoreFieldsButton="main-ui-filter-field-restore-items";this.classClearSearchValueButton="main-ui-delete";this.classSearchButtonsContainer="main-ui-item-icon-block";this.classSearchButton="main-ui-search";this.classDisabled="main-ui-disable";this.classAnimationShow="main-ui-popup-show-animation";this.classAnimationClose="main-ui-popup-close-animation";this.classSidebarControlsContainer="main-ui-filter-add-container";this.searchContainerPostfix="_search_container";this.classPresetButtonsContainer="main-ui-filter-field-preset-button-container";this.classFindButton="main-ui-filter-find";this.classResetButton="main-ui-filter-reset";this.classDefaultFilter="main-ui-filter-default-preset";this.classRestoreButton="main-ui-filter-reset-link";this.classPinButton="main-ui-filter-icon-pin";this.classPopupOverlay="popup-window-overlay";this.classPinnedPreset="main-ui-item-pin";this.classWaitButtonClass="webform-small-button-wait";this.classForAllCheckbox="main-ui-filter-save-for-all";this.classShow="main-ui-show";this.classFocus="main-ui-focus";this.numberPostfix="_numsel";this.datePostfix="_datesel";this.toPostfix="_to";this.fromPostfix="_from";this.daysPostfix="_days";this.monthPostfix="_month";this.quarterPostfix="_quarter";this.yearPostfix="_year";this.generalTemplateId="";this.init(i,t)};BX.Filter.Settings.prototype={init:function(i,t){this.generalTemplateId=t.getParam("FILTER_ID")+"_GENERAL_template";this.mergeSettings(i)},get:function(i,t){return i&&i in this&&!BX.type.isFunction(this[i])?this[i]:t},mergeSettings:function(i){if(BX.type.isPlainObject(i)){Object.keys(i).forEach(function(t){if(!BX.type.isFunction(this[t])){this[t]=i[t]}},this)}}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:90:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/utils.min.js?15113164722222";s:6:"source";s:71:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/utils.js";s:3:"min";s:75:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/utils.min.js";s:3:"map";s:75:"/bitrix/components/bitrix/main.ui.filter/templates/.default/js/utils.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Filter");BX.Filter.Utils={cache:{},styleForEach:function(e,t){var n;t=BX.type.isPlainObject(t)?t:null;n=Object.keys(t);[].forEach.call(e||[],function(e){n.forEach(function(n){BX.style(e,n,t[n])})})},closestParent:function(e,t){if(e){if(!t){return e.parentNode||null}else{return BX.findParent(e,{"class":t})}}},closestChilds:function(e){if(e){return e.children||null}},getNext:function(e){if(e){return e.nextElementSibling||null}},getPrev:function(e){if(e){return e.previousElementSibling||null}},collectionSort:function(e,t){var n,i,r,o,l;if(e&&t&&e!==t&&e.parentNode===t.parentNode){n=this.closestParent(t);i=this.closestChilds(n);r=i.length;o=this.getIndex(i,e);l=this.getIndex(i,t);if(r===l){n.appendChild(t)}if(o>l){n.insertBefore(e,t)}if(o<l&&r!==l){n.insertBefore(e,this.getNext(t))}}},getIndex:function(e,t){return[].indexOf.call(e||[],t)},getByClass:function(e,t,n){var i=[];if(t){i=(e||document.body).getElementsByClassName(t);if(!n){i=i.length?i[0]:null}else{i=[].slice.call(i)}}return i},getByTag:function(e,t,n){var i=[];if(t){i=(e||document.body).getElementsByTagName(t);if(!n){i=i.length?i[0]:null}else{i=[].slice.call(i)}}return i},getBySelector:function(e,t,n){var i=[];if(t){if(!n){i=(e||document.body).querySelector(t)}else{i=(e||document.body).querySelectorAll(t);i=[].slice.call(i)}}return i},requestAnimationFrame:function(){var e=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)};e.apply(window,arguments)},sortObject:function(e){var t={};Object.keys(e).sort().forEach(function(n){t[n]=e[n]});return t},objectsIsEquails:function(e,t){return JSON.stringify(e)===JSON.stringify(t)},isKey:function(e,t){var n={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",27:"escape",32:"space",37:"leftArrow",38:"upArrow",39:"rightArrow",40:"downArrow",46:"delete",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",65:"a"};var i=!!e?"keyCode"in e?e.keyCode:"which"in e?e.which:0:0;return i in n&&n[i]===t}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:99:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/date-group.min.js?15113164721428";s:6:"source";s:80:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/date-group.js";s:3:"min";s:84:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/date-group.min.js";s:3:"map";s:84:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/date-group.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Main.ui.block");BX.Main.ui.block["date-group"]=function(t){var e,n,i,a,l;e={block:"main-ui-control-field-group",name:"name"?t.name+"_datesel":"",mix:"mix"in t?t.mix:null,attrs:{"data-type":"type"in t?t.type:"","data-name":"name"in t?t.name:"","data-time":t.enableTime},content:[]};if("label"in t&&BX.type.isNotEmptyString(t.label)){a={block:"main-ui-control-field-label",tag:"span",content:t.label};e.content.push(a)}n={block:"main-ui-control-field",dragButton:false,content:{block:"main-ui-select",tabindex:"tabindex"in t?t.tabindex:"",value:"value"in t?t.value:"",items:"items"in t?t.items:"",name:"name"in t?t.name+"_datesel":"",params:"params"in t?t.params:"",valueDelete:false}};e.content.push(n);if("content"in t&&BX.type.isArray(t.content)){t.content.forEach(function(t){e.content.push(t)})}if("content"in t&&(BX.type.isPlainObject(t.content)||BX.type.isNotEmptyString(t.content))){e.content.push(t.content)}i={block:"main-ui-item-icon-container",content:{block:"main-ui-item-icon",mix:["main-ui-delete","main-ui-filter-field-delete"],tag:"span",attrs:{title:"deleteTitle"in t&&t.deleteTitle?t.deleteTitle:""}}};e.content.push(i);if(!("dragButton"in t)||t.dragButton!==false){l={block:"main-ui-filter-icon-grab",mix:["main-ui-item-icon"],tag:"span",attrs:{title:"dragTitle"in t&&t.dragTitle?t.dragTitle:""}};e.content.push(l)}return e}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:116:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-control-field-group.min.js?15113164721136";s:6:"source";s:97:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-control-field-group.js";s:3:"min";s:101:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-control-field-group.min.js";s:3:"map";s:101:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-control-field-group.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Main.ui.block");BX.Main.ui.block["main-ui-control-field-group"]=function(t){var n,e,i,a;n={block:"main-ui-control-field-group",mix:"mix"in t?t.mix:null,attrs:{"data-type":"type"in t?t.type:"","data-name":"name"in t?t.name:""},content:[]};if("label"in t&&BX.type.isNotEmptyString(t.label)){i={block:"main-ui-control-field-label",tag:"span",content:t.label};n.content.push(i)}if(BX.type.isArray(t.content)){t.content.forEach(function(t){n.content.push(t)})}else if(BX.type.isPlainObject(t.content)||BX.type.isNotEmptyString(t.content)){n.content.push(t.content)}if("deleteButton"in t&&t.deleteButton===true){e={block:"main-ui-item-icon-container",content:{block:"main-ui-item-icon",mix:["main-ui-delete","main-ui-filter-field-delete"],tag:"span",attrs:{title:"deleteTitle"in t&&t.deleteTitle?t.deleteTitle:""}}};n.content.push(e)}if(!("dragButton"in t)||t.dragButton!==false){a={block:"main-ui-filter-icon-grab",mix:["main-ui-item-icon"],tag:"span",attrs:{title:"dragTitle"in t&&t.dragTitle?t.dragTitle:""}};n.content.push(a)}return n}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:110:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-control-field.min.js?15113164721286";s:6:"source";s:91:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-control-field.js";s:3:"min";s:95:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-control-field.min.js";s:3:"map";s:95:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-control-field.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Main.ui.block");BX.Main.ui.block["main-ui-control-field"]=function(t){var e,n,i,l,a;e={block:"main-ui-control-field",mix:"mix"in t?t.mix:null,attrs:{"data-type":"type"in t?t.type:"","data-name":"name"in t?t.name:""},content:[]};if("label"in t&&BX.type.isNotEmptyString(t.label)){l={block:"main-ui-control-field-label",tag:"span",content:t.label};e.content.push(l)}if(BX.type.isArray(t.content)){t.content.forEach(function(t){e.content.push(t)})}else if(BX.type.isPlainObject(t.content)||BX.type.isNotEmptyString(t.content)){e.content.push(t.content)}if("valueDelete"in t&&t.valueDelete===true){i={block:"main-ui-control-value-delete",content:{block:"main-ui-control-value-delete-item",tag:"span"}};e.content.push(i)}if("deleteButton"in t&&t.deleteButton===true){n={block:"main-ui-item-icon-container",content:{block:"main-ui-item-icon",mix:["main-ui-delete","main-ui-filter-field-delete"],tag:"span",attrs:{title:"deleteTitle"in t&&t.deleteTitle?t.deleteTitle:""}}};e.content.push(n)}if(!("dragButton"in t)||t.dragButton!==false){a={block:"main-ui-filter-icon-grab",mix:["main-ui-item-icon"],tag:"span",attrs:{title:"dragTitle"in t&&t.dragTitle?t.dragTitle:""}};e.content.push(a)}return e}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:110:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-control-string.min.js?1511316472422";s:6:"source";s:92:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-control-string.js";s:3:"min";s:96:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-control-string.min.js";s:3:"map";s:96:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-control-string.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Main.ui.block");BX.Main.ui.block["main-ui-control-string"]=function(n){return{block:"main-ui-control-string",mix:["main-ui-control"],tag:"input",attrs:{type:"type"in n?n.type:"text",name:"name"in n?n.name:"",placeholder:"placeholder"in n?n.placeholder:"",tabindex:"tabindex"in n?n.tabindex:"",value:"value"in n?n.value:""}}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:118:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-filter-field-list-item.min.js?1511316472490";s:6:"source";s:100:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-filter-field-list-item.js";s:3:"min";s:104:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-filter-field-list-item.min.js";s:3:"map";s:104:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-filter-field-list-item.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Main.ui.block");BX.Main.ui.block["main-ui-filter-field-list-item"]=function(i){var e={block:"main-ui-select-inner-label",content:"label"in i?i.label:""};var n={block:"main-ui-filter-field-list-item",mix:"main-ui-select-inner-item",attrs:{"data-id":i.id,"data-name":i.name,"data-item":"item"in i?JSON.stringify(i.item):{}},events:{click:"onClick"in i?i.onClick:""},content:e};return n}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:107:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-filter-info.min.js?1511316472250";s:6:"source";s:89:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-filter-info.js";s:3:"min";s:93:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-filter-info.min.js";s:3:"map";s:93:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-filter-info.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Main.ui.block");BX.Main.ui.block["main-ui-filter-info"]=function(t){return{block:"main-ui-filter-info",tag:"span",content:t.content,attrs:{title:t.title}}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:102:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-number.min.js?1511316472754";s:6:"source";s:84:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-number.js";s:3:"min";s:88:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-number.min.js";s:3:"map";s:88:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-number.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Main.ui.block");BX.Main.ui.block["main-ui-number"]=function(e){var n,i,t;n={block:"main-ui-number",mix:["main-ui-control"],content:[]};if("mix"in e&&BX.type.isArray(e.mix)){e.mix.forEach(function(e){n.mix.push(e)})}i={block:"main-ui-number-input",mix:["main-ui-control-input"],tag:"input",attrs:{type:"number",name:"name"in e?e.name:"",tabindex:"tabindex"in e?e.tabindex:"",value:"value"in e?e.value:"",placeholder:"placeholder"in e?e.placeholder:"",autocomplete:"off"}};n.content.push(i);if("valueDelete"in e&&e.valueDelete===true){t={block:"main-ui-control-value-delete",content:{block:"main-ui-control-value-delete-item",tag:"span"}};n.content.push(t)}return n}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:109:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-search-square.min.js?1511316472563";s:6:"source";s:91:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-search-square.js";s:3:"min";s:95:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-search-square.min.js";s:3:"map";s:95:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-search-square.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Main.ui.block");BX.Main.ui.block["main-ui-search-square"]=function(i){var e=["main-ui-filter-search-square"];if("isPreset"in i&&i.isPreset){e.push("main-ui-filter-search-square-preset")}return{block:"main-ui-square",mix:e,attrs:{"data-item":"item"in i?JSON.stringify(i.item):"",title:"title"in i?i.title:""},content:[{block:"main-ui-square-item",content:"name"in i?BX.util.htmlspecialcharsback(i.name):""},{block:"main-ui-square-delete",mix:["main-ui-item-icon"]}]}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:101:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/number-group.min.js?15113164721409";s:6:"source";s:82:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/number-group.js";s:3:"min";s:86:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/number-group.min.js";s:3:"map";s:86:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/number-group.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Main.ui.block");BX.Main.ui.block["number-group"]=function(n){var t,e,i,a,l;t={block:"main-ui-control-field-group",name:"name"in n?n.name+"_numsel":"",mix:"mix"in n?n.mix:null,attrs:{"data-type":"type"in n?n.type:"","data-name":"name"in n?n.name:""},content:[]};if("label"in n&&BX.type.isNotEmptyString(n.label)){a={block:"main-ui-control-field-label",tag:"span",content:n.label};t.content.push(a)}e={block:"main-ui-control-field",dragButton:false,content:{block:"main-ui-select",tabindex:"tabindex"in n?n.tabindex:"",value:"value"in n?n.value:"",items:"items"in n?n.items:"",name:"name"in n?n.name+"_numsel":"",params:"params"in n?n.params:"",valueDelete:false}};t.content.push(e);if("content"in n&&BX.type.isArray(n.content)){n.content.forEach(function(n){t.content.push(n)})}if("content"in n&&(BX.type.isPlainObject(n.content)||BX.type.isNotEmptyString(n.content))){t.content.push(n.content)}i={block:"main-ui-item-icon-container",content:{block:"main-ui-item-icon",mix:["main-ui-delete","main-ui-filter-field-delete"],tag:"span",attrs:{title:"deleteTitle"in n&&n.deleteTitle?n.deleteTitle:""}}};t.content.push(i);if(!("dragButton"in n)||n.dragButton!==false){l={block:"main-ui-filter-icon-grab",mix:["main-ui-item-icon"],tag:"span",attrs:{title:"dragTitle"in n&&n.dragTitle?n.dragTitle:""}};t.content.push(l)}return t}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:101:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/sidebar-item.min.js?15113164721364";s:6:"source";s:82:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/sidebar-item.js";s:3:"min";s:86:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/sidebar-item.min.js";s:3:"map";s:86:"/bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/sidebar-item.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Main.ui.block");BX.Main.ui.block["sidebar-item"]=function(i){return{block:"main-ui-filter-sidebar-item"+("pinned"in i&&i.pinned?" main-ui-item-pin":""),attrs:{"data-id":"id"in i?i.id:""},content:[{block:"main-ui-filter-icon-grab",tag:"span",mix:["main-ui-item-icon"],attrs:{title:"dragTitle"in i&&i.dragTitle?i.dragTitle:""}},{block:"main-ui-filter-sidebar-item-text-container",tag:"span",content:[{block:"main-ui-filter-sidebar-item-input",tag:"input",attrs:{type:"text",placeholder:"placeholder"in i?i.placeholder:"",value:"text"in i?BX.util.htmlspecialchars(BX.util.htmlspecialcharsback(i.text)):""}},{block:"main-ui-filter-sidebar-item-text",tag:"span",content:"text"in i?i.text:""},{block:"main-ui-filter-icon-pin",tag:"span",mix:["main-ui-item-icon"],attrs:{title:"noEditPinTitle"in i&&i.noEditPinTitle?i.noEditPinTitle:""}}]},{block:"main-ui-filter-icon-edit",tag:"span",mix:["main-ui-item-icon"],attrs:{title:"editNameTitle"in i&&i.editNameTitle?i.editNameTitle:""}},{block:"main-ui-delete",tag:"span",mix:["main-ui-item-icon"],attrs:{title:"removeTitle"in i&&i.removeTitle?i.removeTitle:""}},{block:"main-ui-filter-icon-pin",tag:"span",mix:["main-ui-item-icon"],attrs:{title:"editPinTitle"in i&&i.editPinTitle?i.editPinTitle:""}},{block:"main-ui-filter-edit-mask"}]}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:97:"/bitrix/components/bitrix/tasks.interface.toolbar/templates/.default/script.min.js?15113165981339";s:6:"source";s:78:"/bitrix/components/bitrix/tasks.interface.toolbar/templates/.default/script.js";s:3:"min";s:82:"/bitrix/components/bitrix/tasks.interface.toolbar/templates/.default/script.min.js";s:3:"map";s:82:"/bitrix/components/bitrix/tasks.interface.toolbar/templates/.default/script.map.js";}"*/
BX.namespace("BX.Tasks");BX.Tasks.InterfaceToolbar=function(t){this.filterId=t.filterId;this.grid={};this.containerId=t.containerId;this.container={};this.itemSelector="a.tasks-counter-container";this.params=t||{};this.filterManager=null;this.filterApi=null;this.itemClickHandler=null;return this.init()};BX.Tasks.InterfaceToolbar.prototype={init:function(){this.itemClickHandler=BX.delegate(this.onItemClick,this);this.container=BX(this.containerId);if(!BX.type.isElementNode(this.container)){throw"BX.Tasks.InterfaceToolbar: Could not find container: "+this.containerId}var t=this.container.querySelectorAll(this.itemSelector);for(var e=0,i=t.length;e<i;e++){BX.bind(t[e],"click",this.itemClickHandler)}this.filterManager=BX.Main.filterManager.getById(this.filterId);if(!this.filterManager){alert("BX.Main.filterManager not initialised");return}this.filterApi=this.filterManager.getApi()},onItemClick:function(t){var e=BX.findParent(BX.getEventTarget(t),{tagName:"A",className:"tasks-counter-container"});if(e){var i=e.getAttribute("data-type-id");if(BX.type.isNotEmptyString(i)){var r={counterTypeId:i,cancel:false};this.applyFilter(r);if(r.cancel){return BX.PreventDefault(t)}}}return true},applyFilter:function(t){var e={PROBLEM:t.counterTypeId};this.filterApi.setFields(e);this.filterApi.apply()}};
/* End */
;
; /* Start:"a:4:{s:4:"full";s:101:"/bitrix/components/bitrix/tasks.interface.quick.form/templates/.default/script.min.js?151131659814423";s:6:"source";s:81:"/bitrix/components/bitrix/tasks.interface.quick.form/templates/.default/script.js";s:3:"min";s:85:"/bitrix/components/bitrix/tasks.interface.quick.form/templates/.default/script.min.js";s:3:"map";s:85:"/bitrix/components/bitrix/tasks.interface.quick.form/templates/.default/script.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Tasks");BX.Tasks.QuickForm=function(t,e){var i=BX(t);if(!i){throw"BX.Tasks.QuickForm: wrong container id"}this.parameters=e||{};this.layout={container:i,button:BX(this.parameters.button),form:BX("task-new-item-form"),responsible:BX("task-new-item-responsible"),responsibleId:BX("task-new-item-responsible-id"),deadline:BX("task-new-item-deadline"),title:BX("task-new-item-title"),projectLink:BX("task-new-item-project-link"),projectClearing:BX("task-new-item-project-clearing"),projectId:BX("task-new-item-project-id"),descriptionBlock:BX("task-new-item-description-block"),descriptionLink:BX("task-new-item-description-link"),description:BX("task-new-item-description"),saveButton:BX("task-new-item-save"),cancelButton:BX("task-new-item-cancel")};this.gridId=BX.type.isNotEmptyString(this.parameters.gridId)?this.parameters.gridId:null;this.messages=this.parameters.messages||{};this.canManageTask=this.parameters.canManageTask!==false;this.canAddMailUsers=this.parameters.canAddMailUsers===true;if(this.canManageTask){BX.bind(this.layout.title,"keypress",BX.proxy(this.fireEnterKey,this));if(this.layout.button){BX.bind(this.layout.button,"click",BX.proxy(this.handleButtonClick,this))}BX.bind(this.layout.cancelButton,"click",BX.proxy(this.hide,this));BX.bind(this.layout.saveButton,"click",BX.proxy(this.submit,this));BX.bind(this.layout.descriptionLink,"click",BX.proxy(this.toggleDescription,this));BX.bind(this.layout.deadline,"click",BX.proxy(this.calendar,this));BX.bind(this.layout.deadline,"focus",BX.proxy(this.calendar,this))}else{this.disable()}this.query=new BX.Tasks.Util.Query({url:"/bitrix/components/bitrix/tasks.task.list/ajax.php"});this.query.bindEvent("executed",BX.proxy(this.onQueryExecuted,this));this.operation="taskQuickAdd";this.errorPopup=null;this.notification=new BX.Tasks.QuickForm.Notification(this);this.projectSelector=new BX.Tasks.QuickForm.ProjectSelector("task-new-item-project-selector",this);this.userSelector=new BX.Tasks.QuickForm.UserSelector("task-new-item-user-selector",this)};BX.Tasks.QuickForm.prototype.submit=function(){var t=this.layout.title.value;if(BX.util.trim(t).length===0){return false}var e={title:t,deadline:this.layout.deadline.value,description:this.layout.description.value,project:this.layout.projectId.value,pathToTask:this.parameters.pathToTask,siteId:BX.message("SITE_ID"),nameTemplate:this.parameters.nameTemplate,getListParams:this.parameters.getListParams,ganttMode:this.parameters.ganttMode};var i=this.userSelector.getUserId();var s=this.userSelector.getUserEmail();if(i>0){e.responsibleId=i}else if(this.canAddMailUsers&&s.length){e.userEmail=s;e.userName=this.userSelector.getUserName();e.userLastName=this.userSelector.getUserLastName()}this.disable();this.fadeGrid();this.query.deleteAll();this.query.add("ui.listcontrols.add",{data:e,parameters:{}},{code:this.operation});this.query.execute()};BX.Tasks.QuickForm.prototype.onQueryExecuted=function(result){if(!result.success){return this.showError(result.clientProcessErrors,result.serverProcessErrors)}else if(!result.data[this.operation]){return this.showError("Could not process this operation.")}else if(!result.data[this.operation].SUCCESS){return this.showError(result.data[this.operation].ERRORS)}var data=result.data[this.operation].RESULT;var taskId=data["taskId"];var found=data.position&&data.position.found===true;if(found){var grid=this.getGrid();if(grid){return grid.reloadTable("GET",{},this.applyChanges.bind(this,data,found))}else if(data.task){var task=null;try{eval("result = "+data.task);task=result}catch(e){}this.insertIntoGantt(task,data.position)}}this.applyChanges(data,found)};BX.Tasks.QuickForm.prototype.applyChanges=function(t,e){var i=t["taskRaw"]&&t["taskRaw"]["TITLE"]?t["taskRaw"]["TITLE"]:"";var s=t["taskPath"];this.notification.show(t["taskId"],i,s,e);this.highlight(t["taskId"],false);this.unfadeGrid();this.enable();this.clear();this.focus()};BX.Tasks.QuickForm.prototype.insertIntoGantt=function(t,e){if(!window.ganttChart||!t){return}BX.onCustomEvent("onTaskListTaskAdd",[t]);if(t.projectId&&!ganttChart.getProjectById(t.projectId)){ganttChart.addProjectFromJSON({id:t.projectId,name:t.projectName,opened:true,canCreateTasks:t.projectCanCreateTasks,canEditTasks:t.projectCanEditTasks})}var i=ganttChart.addTaskFromJSON(t);if(i.parentTaskId){var s=ganttChart.getTaskById(i.parentTaskId);if(s){s.expand()}}var o=ganttChart.getTaskById(e.nextTaskId);var a=ganttChart.getTaskById(e.prevTaskId);if(o&&o.projectId===i.projectId){ganttChart.moveTask(i.id,o.id)}else if(a&&a.projectId===i.projectId){ganttChart.moveTask(i.id,a.id,true)}};BX.Tasks.QuickForm.prototype.getNextProject=function(t,e){var i=BX.findChildrenByClassName(t,"task-list-project-item");if(!e&&i.length){return i[0]}var s=null;for(var o=0;o<i.length;o++){if(parseInt(i[o].getAttribute("data-project-id"),10)>e){s=i[o];break}}return s};BX.Tasks.QuickForm.prototype.showError=function(){if(this.errorPopup===null){this.errorPopup=new BX.PopupWindow(this.operation,null,{lightShadow:true,buttons:[new BX.PopupWindowButton({text:BX.message("JS_CORE_WINDOW_CLOSE"),className:"",events:{click:BX.proxy(this.onPopupErrorClose,this)}})]})}var t=[];for(var e=0;e<arguments.length;e++){var i=arguments[e];if(BX.type.isArray(i)){t=BX.util.array_merge(t,i)}else if(BX.type.isString(i)){t.push(i)}}var s="";for(e=0;e<t.length;e++){s+=(typeof t[e].MESSAGE!=="undefined"?t[e].MESSAGE:t[e])+"<br>"}this.errorPopup.setContent("<div class='task-new-item-error-popup'>"+s+"</div>");this.errorPopup.show()};BX.Tasks.QuickForm.prototype.fadeGrid=function(){if(this.getGrid()){this.getGrid().tableFade()}};BX.Tasks.QuickForm.prototype.unfadeGrid=function(){if(this.getGrid()){this.getGrid().tableUnfade()}};BX.Tasks.QuickForm.prototype.onPopupErrorClose=function(){this.errorPopup.close();this.unfadeGrid();this.enable();this.clear();this.focus()};BX.Tasks.QuickForm.prototype.calendar=function(t){BX.PreventDefault(t);var e=this.layout.deadline;BX.calendar({node:e,field:e.name,bTime:true,bSetFocus:false,value:BX.CJSTask.ui.getInputDateTimeValue(e),bHideTimebar:false});BX.SocNetLogDestination.closeDialog()};BX.Tasks.QuickForm.prototype.show=function(){BX.addClass(this.layout.container,"task-top-panel-righttop-open");BX.addClass(this.layout.button,"tasks-quick-form-button-active");this.focus()};BX.Tasks.QuickForm.prototype.hide=function(){BX.removeClass(this.layout.container,"task-top-panel-righttop-open");BX.removeClass(this.layout.button,"tasks-quick-form-button-active");this.notification.hide();this.focus()};BX.Tasks.QuickForm.prototype.handleButtonClick=function(t){if(BX.hasClass(this.layout.container,"task-top-panel-righttop-open")){this.hide()}else{this.show()}};BX.Tasks.QuickForm.prototype.toggleDescription=function(t){BX.toggleClass(this.layout.descriptionBlock,"task-top-panel-leftmiddle-open");if(BX.hasClass(this.layout.descriptionBlock,"task-top-panel-leftmiddle-open")){this.layout.description.focus()}else{this.focus()}BX.PreventDefault(t)};BX.Tasks.QuickForm.prototype.fireEnterKey=function(t){t=t||window.event;if(t.keyCode===13){this.submit();BX.PreventDefault(t)}};BX.Tasks.QuickForm.prototype.getGrid=function(){if(this.gridId&&BX.Main&&BX.Main.gridManager){return BX.Main.gridManager.getInstanceById(this.gridId)}return null};BX.Tasks.QuickForm.prototype.disable=function(){this.layout.title.disabled=true;this.layout.deadline.disabled=true;this.layout.responsible.disabled=true;this.layout.description.disabled=true;BX.addClass(this.layout.saveButton,"webform-small-button-wait webform-button-disable")};BX.Tasks.QuickForm.prototype.enable=function(){this.layout.title.disabled=false;this.layout.deadline.disabled=false;this.layout.responsible.disabled=false;this.layout.description.disabled=false;BX.removeClass(this.layout.saveButton,"webform-small-button-wait webform-button-disable")};BX.Tasks.QuickForm.prototype.clear=function(){this.layout.title.value="";this.layout.deadline.value="";this.layout.description.value=""};BX.Tasks.QuickForm.prototype.focus=function(){this.layout.title.focus()};BX.Tasks.QuickForm.prototype.highlight=function(t,e){if(window.ganttChart){var i=ganttChart.getTaskById(t);if(i){i.highlight();if(e===true){i.scrollIntoView(false)}}}else if(this.getGrid()){var s=this.getGrid().getRows().getById(t);if(s){var o=s.getNode();BX.addClass(o,"task-list-item-highlighted");setTimeout(function(){BX.removeClass(o,"task-list-item-highlighted")},1e3);if(e===true){o.scrollIntoView(false)}}}};BX.Tasks.QuickForm.Notification=function(t){this.form=t;this.taskId=0;this.layout={block:BX("task-new-item-notification"),message:BX("task-new-item-message"),openLink:BX("task-new-item-open"),highlightLink:BX("task-new-item-highlight"),hideLink:BX("task-new-item-notification-hide")};BX.bind(this.layout.hideLink,"click",BX.proxy(this.hide,this));BX.bind(this.layout.highlightLink,"click",BX.proxy(this.highlight,this))};BX.Tasks.QuickForm.Notification.prototype.show=function(t,e,i,s){this.taskId=t;this.layout.message.innerHTML=e;this.layout.openLink.href=i;if(s){this.layout.highlightLink.style.display="inline"}else{this.layout.highlightLink.style.display="none"}BX.addClass(this.layout.block,"task-top-notification-active")};BX.Tasks.QuickForm.Notification.prototype.hide=function(){BX.removeClass(this.layout.block,"task-top-notification-active")};BX.Tasks.QuickForm.Notification.prototype.highlight=function(){this.form.highlight(this.taskId,true)};BX.Tasks.QuickForm.ProjectSelector=function(t,e){this.id=t;this.form=e;this.projectName=this.form.layout.projectLink.innerHTML;this.projectId=parseInt(this.form.layout.projectId.value,10);var i=this.form.parameters.destination||{};BX.SocNetLogDestination.init({name:t,showSearchInput:true,sendAjaxSearch:typeof i["SONETGROUPS_LIMITED"]!="undefined"&&i["SONETGROUPS_LIMITED"]=="Y",useClientDatabase:false,allowUserSearch:false,allowSonetGroupsAjaxSearch:typeof i["SONETGROUPS_LIMITED"]!="undefined"&&i["SONETGROUPS_LIMITED"]=="Y",departmentSelectDisable:true,bindMainPopup:{node:this.form.layout.projectLink},bindSearchPopup:{node:this.form.layout.projectLink},callback:{select:BX.proxy(this.onSelect,this)},items:{users:{},groups:{},department:{},departmentRelation:{},sonetgroups:i["SONETGROUPS"]||{}},itemsLast:{users:{},groups:{},department:{},sonetgroups:i["LAST"]&&i["LAST"]["SONETGROUPS"]?i["LAST"]["SONETGROUPS"]:{}},itemsSelected:{}});BX.bind(this.form.layout.projectLink,"click",BX.proxy(this.openDialog,this));BX.bind(this.form.layout.projectClearing,"click",BX.proxy(this.clearProject,this))};BX.Tasks.QuickForm.ProjectSelector.prototype.openDialog=function(t){if(!BX.SocNetLogDestination.isOpenDialog()){BX.SocNetLogDestination.openDialog(this.id)}if(t){BX.PreventDefault(t)}};BX.Tasks.QuickForm.ProjectSelector.prototype.onSelect=function(t){this.projectId=parseInt(t.entityId,10);this.projectName=t.name;this.form.layout.projectId.value=this.projectId;this.form.layout.projectLink.innerHTML=this.projectName;BX.addClass(this.form.layout.projectClearing,"task-top-panel-tab-close-active");BX.SocNetLogDestination.deleteLastItem(this.id);BX.SocNetLogDestination.closeDialog()};BX.Tasks.QuickForm.ProjectSelector.prototype.clearProject=function(){this.form.layout.projectLink.innerHTML=this.form.messages.taskInProject;this.form.layout.projectId.value=0;this.projectId=0;this.projectName="";BX.removeClass(this.form.layout.projectClearing,"task-top-panel-tab-close-active");BX.SocNetLogDestination.closeDialog()};BX.Tasks.QuickForm.UserSelector=function(t,e){this.id=t;this.form=e;this.userId=this.form.layout.responsibleId.value;this.userNameFormatted=this.form.layout.responsible.value;this.userEmail="";this.userName="";this.userLastName="";var i=this.form.parameters.destination||{};BX.SocNetLogDestination.init({name:t,searchInput:this.form.layout.responsible,departmentSelectDisable:true,bindMainPopup:{node:this.form.layout.responsible},bindSearchPopup:{node:this.form.layout.responsible},allowAddUser:this.form.canAddMailUsers,callback:{select:BX.proxy(this.onSelect,this)},items:{users:i["USERS"]||{},department:i["DEPARTMENT"]||{},departmentRelation:i["DEPARTMENT_RELATION"]||{}},itemsLast:{users:i["LAST"]&&i["LAST"]["USERS"]?i["LAST"]["USERS"]:{}},itemsSelected:i["SELECTED"]||{}});BX.addCustomEvent("BX.SocNetLogDestination:onBeforeSelectItemFocus",BX.proxy(this.onBeforeSelectItemFocus,this));BX.bind(this.form.layout.responsible,"focus",BX.proxy(this.openDialog,this));BX.bind(this.form.layout.responsible,"click",BX.proxy(this.openDialog,this));BX.bind(this.form.layout.responsible,"blur",BX.proxy(this.onBlur,this));var s={formName:this.id,inputName:this.form.layout.responsible.getAttribute("id")};BX.bind(this.form.layout.responsible,"keyup",BX.proxy(BX.SocNetLogDestination.BXfpSearch,s));BX.bind(this.form.layout.responsible,"keydown",BX.proxy(BX.SocNetLogDestination.BXfpSearchBefore,s))};BX.Tasks.QuickForm.UserSelector.prototype.getUserId=function(){return this.userId};BX.Tasks.QuickForm.UserSelector.prototype.getUserEmail=function(){return this.userEmail};BX.Tasks.QuickForm.UserSelector.prototype.getUserName=function(){return this.userName};BX.Tasks.QuickForm.UserSelector.prototype.getUserLastName=function(){return this.userLastName};BX.Tasks.QuickForm.UserSelector.prototype.openDialog=function(t){BX.calendar.get().Close();BX.PreventDefault(t);this.form.layout.responsible.value="";if(!BX.SocNetLogDestination.isOpenDialog()){BX.SocNetLogDestination.openDialog(this.id)}};BX.Tasks.QuickForm.UserSelector.prototype.onBeforeSelectItemFocus=function(t){if(t.id===this.id){t.blockFocus=true}};BX.Tasks.QuickForm.UserSelector.prototype.onSelect=function(t,e,i){this.userId=t.entityId||0;this.userNameFormatted=BX.util.htmlspecialcharsback(t.name);var s=t.params||{};this.userEmail=s.email||"";this.userName=s.name||"";this.userLastName=s.lastName||"";this.form.layout.responsible.value=this.userNameFormatted;this.form.layout.responsibleId.value=this.userId;BX.SocNetLogDestination.deleteLastItem(this.id);BX.SocNetLogDestination.closeDialog()};BX.Tasks.QuickForm.UserSelector.prototype.onBlur=function(){setTimeout(BX.proxy(function(){if(!BX.SocNetLogDestination.isOpenDialog()&&!BX.SocNetLogDestination.isOpenSearch()&&this.form.layout.responsible.value.length<=0){this.form.layout.responsible.value=this.userNameFormatted;this.form.layout.responsibleId.value=this.userId}},this),100)}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:87:"/bitrix/components/bitrix/main.ui.grid/templates/.default/script.min.js?151131647224497";s:6:"source";s:67:"/bitrix/components/bitrix/main.ui.grid/templates/.default/script.js";s:3:"min";s:71:"/bitrix/components/bitrix/main.ui.grid/templates/.default/script.min.js";s:3:"map";s:71:"/bitrix/components/bitrix/main.ui.grid/templates/.default/script.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Main");BX.Main.grid=function(t,e,i,n,s,o,r,a,l){this.settings=null;this.containerId="";this.container=null;this.wrapper=null;this.fadeContainer=null;this.scrollContainer=null;this.pagination=null;this.moreButton=null;this.table=null;this.rows=null;this.history=false;this.userOptions=null;this.checkAll=null;this.sortable=null;this.updater=null;this.data=null;this.fader=null;this.editor=null;this.isEditMode=null;this.pinHeader=null;this.pinPanel=null;this.arParams=null;this.resize=null;this.init(t,e,i,n,s,o,r,a,l)};BX.Main.grid.isNeedResourcesReady=function(t){return BX.hasClass(t,"main-grid-load-animation")};BX.Main.grid.prototype={init:function(t,e,i,n,s,o,r,a,l){this.initArguments=[].slice.call(arguments);this.container=BX(t);if(!BX.browser.IsSafari()&&BX.Main.grid.isNeedResourcesReady(this.container)){BX.bind(this.container,"animationend",BX.proxy(this._onResourcesReady,this))}else{this.initAfterResourcesReady.apply(this,this.initArguments)}},_onResourcesReady:function(t){if(t.animationName==="main-grid-load"){this.initAfterResourcesReady.apply(this,this.initArguments)}},initAfterResourcesReady:function(t,e,i,n,s,o,r,a,l){if(!BX.type.isNotEmptyString(t)){throw"BX.Main.grid.init: parameter containerId is empty"}if(BX.type.isPlainObject(e)){this.arParams=e}else{throw new Error("BX.Main.grid.init: arParams isn't object")}this.settings=new BX.Grid.Settings;this.containerId=t;this.userOptions=new BX.Grid.UserOptions(this,i,n,s);this.gridSettings=new BX.Grid.SettingsWindow(this);this.messages=new BX.Grid.Message(this,l);if(this.getParam("ALLOW_PIN_HEADER")){this.pinHeader=new BX.Grid.PinHeader(this);BX.addCustomEvent(window,"Grid::headerUpdated",BX.proxy(this.bindOnCheckAll,this))}this.bindOnCheckAll();if(this.getParam("ALLOW_HORIZONTAL_SCROLL")){this.fader=new BX.Grid.Fader(this)}this.pageSize=new BX.Grid.Pagesize(this);if(this.getParam("SHOW_ACTION_PANEL")){this.actionPanel=new BX.Grid.ActionPanel(this,o,r)}this.editor=new BX.Grid.InlineEditor(this,a);if(this.getParam("SHOW_ACTION_PANEL")){this.pinPanel=new BX.Grid.PinPanel(this)}this.isEditMode=false;if(!BX.type.isDomNode(this.getContainer())){throw"BX.Main.grid.init: Failed to find container with id "+this.getContainerId()}if(!BX.type.isDomNode(this.getTable())){throw"BX.Main.grid.init: Failed to find table"}this.bindOnRowEvents();if(this.getParam("ALLOW_COLUMNS_RESIZE")){this.resize=new BX.Grid.Resize(this)}this.bindOnMoreButtonEvents();this.bindOnClickPaginationLinks();this.bindOnClickHeader();if(this.getParam("ALLOW_ROWS_SORT")){this.initRowsDragAndDrop()}if(this.getParam("ALLOW_COLUMNS_SORT")){this.initColsDragAndDrop()}this.getRows().initSelected();this.adjustEmptyTable(this.getRows().getSourceBodyChild());BX.onCustomEvent(this.getContainer(),"Grid::ready",[this]);BX.addCustomEvent(window,"Grid::unselectRow",BX.proxy(this._onUnselectRows,this));BX.addCustomEvent(window,"Grid::unselectRows",BX.proxy(this._onUnselectRows,this));BX.addCustomEvent(window,"Grid::allRowsUnselected",BX.proxy(this._onUnselectRows,this))},destroy:function(){BX.removeCustomEvent(window,"Grid::unselectRow",BX.proxy(this._onUnselectRows,this));BX.removeCustomEvent(window,"Grid::unselectRows",BX.proxy(this._onUnselectRows,this));BX.removeCustomEvent(window,"Grid::allRowsUnselected",BX.proxy(this._onUnselectRows,this));BX.removeCustomEvent(window,"Grid::headerPinned",BX.proxy(this.bindOnCheckAll,this));this.getPinHeader()&&this.getPinHeader().destroy();this.getFader()&&this.getFader().destroy();this.getResize()&&this.getResize().destroy();this.getColsSortable()&&this.getColsSortable().destroy();this.getRowsSortable()&&this.getRowsSortable().destroy();this.getSettingsWindow()&&this.getSettingsWindow().destroy()},enableActionsPanel:function(){var t=this.getActionsPanel().getPanel();if(BX.type.isDomNode(t)){BX.removeClass(t,this.settings.get("classDisable"))}},disableActionsPanel:function(){var t=this.getActionsPanel().getPanel();if(BX.type.isDomNode(t)){BX.addClass(t,this.settings.get("classDisable"))}},getSettingsWindow:function(){return this.gridSettings},_onUnselectRows:function(){var t=this.getActionsPanel();var e;if(t instanceof BX.Grid.ActionPanel){e=t.getForAllCheckbox();if(BX.type.isDomNode(e)){e.checked=null;this.disableForAllCounter()}}},isIE:function(){if(!BX.type.isBoolean(this.ie)){this.ie=BX.hasClass(document.documentElement,"bx-ie")}return this.ie},isTouch:function(){if(!BX.type.isBoolean(this.touch)){this.touch=BX.hasClass(document.documentElement,"bx-touch")}return this.touch},getParam:function(t,e){if(e===undefined){e=null}return this.arParams.hasOwnProperty(t)?this.arParams[t]:e},getCounterTotal:function(){return BX.Grid.Utils.getByClass(this.getContainer(),this.settings.get("classCounterTotal"),true)},getActionKey:function(){return"action_button_"+this.getId()},getPinHeader:function(){if(this.getParam("ALLOW_PIN_HEADER")){this.pinHeader=this.pinHeader||new BX.Grid.PinHeader(this)}return this.pinHeader},getResize:function(){if(!(this.resize instanceof BX.Grid.Resize)&&this.getParam("ALLOW_COLUMNS_RESIZE")){this.resize=new BX.Grid.Resize(this)}return this.resize},confirmForAll:function(t){var e;var i=this;if(BX.type.isDomNode(t)){e=BX.Grid.Utils.getByTag(t,"input",true)}if(e.checked){this.getActionsPanel().confirmDialog({CONFIRM:true,CONFIRM_MESSAGE:this.arParams.CONFIRM_FOR_ALL_MESSAGE},function(){if(BX.type.isDomNode(e)){e.checked=true}i.selectAllCheckAllCheckboxes();i.getRows().selectAll();i.enableForAllCounter();i.updateCounterDisplayed();i.updateCounterSelected();i.enableActionsPanel();BX.onCustomEvent(window,"Grid::allRowsSelected",[])},function(){if(BX.type.isDomNode(e)){e.checked=null;i.disableForAllCounter();i.updateCounterDisplayed();i.updateCounterSelected()}})}else{this.unselectAllCheckAllCheckboxes();this.getRows().unselectAll();this.disableForAllCounter();this.updateCounterDisplayed();this.updateCounterSelected();this.disableActionsPanel();BX.onCustomEvent(window,"Grid::allRowsUnselected",[])}},editSelected:function(){this.getRows().editSelected()},editSelectedSave:function(){var t={FIELDS:this.getRows().getEditSelectedValues()};t[this.getActionKey()]="edit";this.reloadTable("POST",t)},getForAllKey:function(){return"action_all_rows_"+this.getId()},updateRow:function(t,e,i,n){var s=this.getRows().getById(t);if(s instanceof BX.Grid.Row){s.update(e,i,n)}},removeRow:function(t,e,i,n){var s=this.getRows().getById(t);if(s instanceof BX.Grid.Row){s.remove(e,i,n)}},addRow:function(t,e,i){var n=this.getUserOptions().getAction("GRID_ADD_ROW");var s={action:n,data:t};var o=this;this.tableFade();this.getData().request(e,"POST",s,null,function(){var e=this.getBodyRows();o.getUpdater().updateBodyRows();o.tableUnfade();o.getRows().reset();o.getUpdater().updateFootRows(this.getFootRows());o.getUpdater().updatePagination(this.getPagination());o.getUpdater().updateMoreButton(this.getMoreButton());o.getUpdater().updateCounterTotal(this.getCounterTotal());o.bindOnRowEvents();o.adjustEmptyTable(e);o.bindOnMoreButtonEvents();o.bindOnClickPaginationLinks();o.updateCounterDisplayed();o.updateCounterSelected();if(o.getParam("ALLOW_COLUMNS_SORT")){o.colsSortable.reinit()}if(o.getParam("ALLOW_ROWS_SORT")){o.rowsSortable.reinit()}BX.onCustomEvent(window,"Grid::rowAdded",[{data:t,grid:o,response:this}]);BX.onCustomEvent(window,"Grid::updated",[]);if(BX.type.isFunction(i)){i({data:t,grid:o,response:this})}})},editSelectedCancel:function(){this.getRows().editSelectedCancel()},removeSelected:function(){var t={ID:this.getRows().getSelectedIds()};var e=this.getActionsPanel().getValues();t[this.getActionKey()]="delete";t[this.getForAllKey()]=this.getForAllKey()in e?e[this.getForAllKey()]:"N";this.reloadTable("POST",t)},sendSelected:function(){var t=this.getActionsPanel().getValues();var e=this.getRows().getSelectedIds();var i={rows:e,controls:t};this.reloadTable("POST",i)},getActionsPanel:function(){return this.actionPanel},getApplyButton:function(){return BX.Grid.Utils.getByClass(this.getContainer(),this.settings.get("classPanelButton"),true)},getEditor:function(){return this.editor},reload:function(t){this.reloadTable("GET",{},null,t)},getPanels:function(){return BX.Grid.Utils.getByClass(this.getContainer(),this.settings.get("classPanels"),true)},getEmptyBlock:function(){return BX.Grid.Utils.getByClass(this.getContainer(),this.settings.get("classEmptyBlock"),true)},adjustEmptyTable:function(t){function e(t){var e=t.currentTarget;BX.Grid.Utils.requestAnimationFrame(function(){BX.style(r,"transform","translate3d("+BX.scrollLeft(e)+"px, 0px, 0")})}if(!BX.hasClass(document.documentElement,"bx-ie")&&BX.type.isArray(t)&&t.length===1&&BX.hasClass(t[0],this.settings.get("classEmptyRows"))){var i=BX.pos(this.getContainer());var n=BX.scrollTop(window)+BX.height(window);var s=i.bottom-n;var o=BX.height(this.getPanels());var r=this.getEmptyBlock();var a=BX.width(this.getContainer());BX.width(r,a);BX.style(r,"transform","translate3d("+BX.scrollLeft(this.getScrollContainer())+"px, 0px, 0");BX.unbind(this.getScrollContainer(),"scroll",e);BX.bind(this.getScrollContainer(),"scroll",e);if(s>0){BX.style(this.getTable(),"min-height",i.height-s-o+"px")}else{BX.style(this.getTable(),"min-height",i.height+Math.abs(s)-o+"px")}}else{BX.style(this.getTable(),"min-height","")}},reloadTable:function(t,e,i,n){var s;if(!BX.type.isNotEmptyString(t)){t="GET"}if(!BX.type.isPlainObject(e)){e={}}var o=this;this.tableFade();if(!BX.type.isString(n)){n=""}this.getData().request(n,t,e,"",function(){o.getRows().reset();s=this.getBodyRows();o.getUpdater().updateHeadRows(this.getHeadRows());o.getUpdater().updateBodyRows(s);o.getUpdater().updateFootRows(this.getFootRows());o.getUpdater().updatePagination(this.getPagination());o.getUpdater().updateMoreButton(this.getMoreButton());o.getUpdater().updateCounterTotal(this.getCounterTotal());o.adjustEmptyTable(s);o.bindOnRowEvents();o.bindOnMoreButtonEvents();o.bindOnClickPaginationLinks();o.bindOnClickHeader();o.bindOnCheckAll();o.updateCounterDisplayed();o.updateCounterSelected();o.disableActionsPanel();o.disableForAllCounter();o.getActionsPanel().resetForAllCheckbox();if(o.getParam("ALLOW_COLUMNS_SORT")){o.colsSortable.reinit()}if(o.getParam("ALLOW_ROWS_SORT")){o.rowsSortable.reinit()}o.tableUnfade();BX.onCustomEvent(window,"Grid::updated",[]);if(BX.type.isFunction(i)){i()}})},getGroupEditButton:function(){return BX.Grid.Utils.getByClass(this.getContainer(),this.settings.get("classGroupEditButton"),true)},getGroupDeleteButton:function(){return BX.Grid.Utils.getByClass(this.getContainer(),this.settings.get("classGroupDeleteButton"),true)},enableGroupActions:function(){var t=this.getGroupEditButton();var e=this.getGroupDeleteButton();if(BX.type.isDomNode(t)){BX.removeClass(t,this.settings.get("classGroupActionsDisabled"))}if(BX.type.isDomNode(e)){BX.removeClass(e,this.settings.get("classGroupActionsDisabled"))}},disableGroupActions:function(){var t=this.getGroupEditButton();var e=this.getGroupDeleteButton();if(BX.type.isDomNode(t)){BX.addClass(t,this.settings.get("classGroupActionsDisabled"))}if(BX.type.isDomNode(e)){BX.addClass(e,this.settings.get("classGroupActionsDisabled"))}},closeActionsMenu:function(){var t=this.getRows().getRows();for(var e=0,i=t.length;e<i;e++){t[e].closeActionsMenu()}},getPageSize:function(){return this.pageSize},getFader:function(){return this.fader},getData:function(){this.data=this.data||new BX.Grid.Data(this);return this.data},getUpdater:function(){this.updater=this.updater||new BX.Grid.Updater(this);return this.updater},isSortableHeader:function(t){return BX.hasClass(t,this.settings.get("classHeaderSortable"))},bindOnClickHeader:function(){var t=this;var e;BX.bind(this.getContainer(),"click",function(i){e=BX.findParent(i.target,{tag:"th"},true,false);if(e&&t.isSortableHeader(e)){t._clickOnSortableHeader(e,i)}})},enableEditMode:function(){this.isEditMode=true},disableEditMode:function(){this.isEditMode=false},isEditMode:function(){return this.isEditMode},getColumnHeaderCellByName:function(t){return BX.Grid.Utils.getBySelector(this.getContainer(),"#"+this.getId()+' th[data-name="'+t+'"]',true)},getColumnByName:function(t){var e=this.getParam("DEFAULT_COLUMNS");return!!t&&t in e?e[t]:null},sortByColumn:function(t){var e=null;var i=null;if(!BX.type.isPlainObject(t)){e=this.getColumnHeaderCellByName(t);i=this.getColumnByName(t)}else{i=t;i.sort_url=this.prepareSortUrl(t)}if(i&&(!!e&&!BX.hasClass(e,this.settings.get("classLoad"))||!e)){!!e&&BX.addClass(e,this.settings.get("classLoad"));this.tableFade();var n=this;this.getUserOptions().setSort(i.sort_by,i.sort_order,function(){n.getData().request(i.sort_url,null,null,"sort",function(){n.rows=null;n.getUpdater().updateHeadRows(this.getHeadRows());n.getUpdater().updateBodyRows(this.getBodyRows());n.getUpdater().updatePagination(this.getPagination());n.getUpdater().updateMoreButton(this.getMoreButton());n.bindOnRowEvents();n.bindOnMoreButtonEvents();n.bindOnClickPaginationLinks();n.bindOnClickHeader();n.bindOnCheckAll();n.updateCounterDisplayed();n.updateCounterSelected();n.disableActionsPanel();n.disableForAllCounter();n.getActionsPanel().resetForAllCheckbox();if(n.getParam("ALLOW_ROWS_SORT")){n.rowsSortable.reinit()}if(n.getParam("ALLOW_COLUMNS_SORT")){n.colsSortable.reinit()}BX.onCustomEvent(window,"BX.Main.grid:sort",[i,n]);BX.onCustomEvent(window,"Grid::updated",[]);n.tableUnfade()})})}},prepareSortUrl:function(t){var e=window.location.toString();if("sort_by"in t){e=BX.util.add_url_param(e,{by:t.sort_by})}if("sort_order"in t){e=BX.util.add_url_param(e,{order:t.sort_order})}return e},_clickOnSortableHeader:function(t,e){e.preventDefault();this.sortByColumn(BX.data(t,"name"))},getObserver:function(){return BX.Grid.observer},initRowsDragAndDrop:function(){this.rowsSortable=new BX.Grid.RowsSortable(this)},initColsDragAndDrop:function(){this.colsSortable=new BX.Grid.ColsSortable(this)},getRowsSortable:function(){return this.rowsSortable},getColsSortable:function(){return this.colsSortable},getUserOptionsHandlerUrl:function(){return this.userOptionsHandlerUrl||""},getUserOptions:function(){return this.userOptions},getCheckAllCheckboxes:function(){var t=BX.Grid.Utils.getByClass(this.getContainer(),this.settings.get("classCheckAllCheckboxes"));return t.map(function(t){return new BX.Grid.Element(t)})},selectAllCheckAllCheckboxes:function(){this.getCheckAllCheckboxes().forEach(function(t){t.getNode().checked=true})},unselectAllCheckAllCheckboxes:function(){this.getCheckAllCheckboxes().forEach(function(t){t.getNode().checked=false})},adjustCheckAllCheckboxes:function(){var t=this.getRows().getBodyChild().filter(function(t){return t.isShown()}).length;var e=this.getRows().getSelected().filter(function(t){return t.isShown()}).length;t===e?this.selectAllCheckAllCheckboxes():this.unselectAllCheckAllCheckboxes()},bindOnCheckAll:function(){var t=this;this.getCheckAllCheckboxes().forEach(function(e){e.getObserver().add(e.getNode(),"change",t._clickOnCheckAll,t)})},_clickOnCheckAll:function(t){t.preventDefault();if(t.target.checked){this.getRows().selectAll();this.selectAllCheckAllCheckboxes();this.enableActionsPanel();BX.onCustomEvent(window,"Grid::allRowsSelected",[])}else{this.getRows().unselectAll();this.unselectAllCheckAllCheckboxes();this.disableActionsPanel();BX.onCustomEvent(window,"Grid::allRowsUnselected",[])}this.updateCounterSelected()},bindOnClickPaginationLinks:function(){var t=this;this.getPagination().getLinks().forEach(function(e){e.getObserver().add(e.getNode(),"click",t._clickOnPaginationLink,t)})},bindOnMoreButtonEvents:function(){var t=this;this.getMoreButton().getObserver().add(this.getMoreButton().getNode(),"click",t._clickOnMoreButton,t)},bindOnRowEvents:function(){var t=this.getObserver();var e=this.getParam("SHOW_ROW_CHECKBOXES");var i=this.getParam("ENABLE_COLLAPSIBLE_ROWS");this.getRows().getBodyChild().forEach(function(n){e&&t.add(n.getNode(),"click",this._onClickOnRow,this);n.getDefaultAction()&&t.add(n.getNode(),"dblclick",this._onRowDblclick,this);n.getActionsButton()&&t.add(n.getActionsButton(),"click",this._clickOnRowActionsButton,this);i&&n.getCollapseButton()&&t.add(n.getCollapseButton(),"click",this._onCollapseButtonClick,this)},this)},_onCollapseButtonClick:function(t){t.preventDefault();t.stopPropagation();var e=this.getRows().get(t.currentTarget);e.toggleChildRows();if(e.isCustom()){this.getUserOptions().setCollapsedGroups(this.getRows().getIdsCollapsedGroups())}else{this.getUserOptions().setExpandedRows(this.getRows().getIdsExpandedRows())}BX.fireEvent(document.body,"click")},_clickOnRowActionsButton:function(t){var e=this.getRows().get(t.target);t.preventDefault();if(!e.actionsMenuIsShown()){e.showActionsMenu()}else{e.closeActionsMenu()}},_onRowDblclick:function(event){event.preventDefault();var row=this.getRows().get(event.target);var defaultJs="";if(!row.isEdit()){clearTimeout(this.clickTimer);this.clickPrevent=true;try{defaultJs=row.getDefaultAction();eval(defaultJs)}catch(err){console.warn(err)}}},_onClickOnRow:function(t){var e=50;var i=window.getSelection();if(t.target.nodeName==="LABEL"){t.preventDefault()}if(t.shiftKey||i.toString().length===0){i.removeAllRanges();this.clickTimer=setTimeout(BX.delegate(function(){if(!this.clickPrevent){n.apply(this,[t])}this.clickPrevent=false},this),e)}function n(t){var e,i,n,s,o,r;var a=true;if(t.target.nodeName!=="A"&&t.target.nodeName!=="INPUT"){i=this.getRows().get(t.target);r=i.getContentContainer(t.target);if(BX.type.isDomNode(r)&&t.target.nodeName!=="TD"&&t.target!==r){a=BX.data(r,"prevent-default")==="true"}if(a){if(i.getCheckbox()){e=[];this.currentIndex=i.getIndex();this.lastIndex=this.lastIndex||this.currentIndex;if(!t.shiftKey){if(!i.isSelected()){i.select();BX.onCustomEvent(window,"Grid::selectRow",[i,this])}else{i.unselect();BX.onCustomEvent(window,"Grid::unselectRow",[i,this])}}else{s=Math.min(this.currentIndex,this.lastIndex);o=Math.max(this.currentIndex,this.lastIndex);while(s<=o){e.push(this.getRows().getByIndex(s));s++}n=e.some(function(t){return!t.isSelected()});if(n){e.forEach(function(t){t.select()});BX.onCustomEvent(window,"Grid::selectRows",[e,this])}else{e.forEach(function(t){t.unselect()});BX.onCustomEvent(window,"Grid::unselectRows",[e,this])}}this.updateCounterSelected();this.lastIndex=this.currentIndex}this.adjustRows();this.adjustCheckAllCheckboxes()}}}},adjustRows:function(){if(this.getRows().isSelected()){BX.onCustomEvent(window,"Grid::thereSelectedRows",[]);this.enableActionsPanel()}else{BX.onCustomEvent(window,"Grid::noSelectedRows",[]);this.disableActionsPanel()}},getPagination:function(){return new BX.Grid.Pagination(this)},getState:function(){return window.history.state},tableFade:function(){BX.addClass(this.getTable(),this.settings.get("classTableFade"));this.getLoader().show()},tableUnfade:function(){BX.removeClass(this.getTable(),this.settings.get("classTableFade"));this.getLoader().hide()},_clickOnPaginationLink:function(t){t.preventDefault();var e=this;var i=this.getPagination().getLink(t.target);if(!i.isLoad()){this.getUserOptions().resetExpandedRows();i.load();this.tableFade();this.getData().request(i.getLink(),null,null,"pagination",function(){e.rows=null;e.getUpdater().updateBodyRows(this.getBodyRows());e.getUpdater().updateHeadRows(this.getHeadRows());e.getUpdater().updateMoreButton(this.getMoreButton());e.getUpdater().updatePagination(this.getPagination());e.bindOnRowEvents();e.bindOnMoreButtonEvents();e.bindOnClickPaginationLinks();e.bindOnClickHeader();e.bindOnCheckAll();e.updateCounterDisplayed();e.updateCounterSelected();e.disableActionsPanel();e.disableForAllCounter();e.getActionsPanel().resetForAllCheckbox();if(e.getParam("ALLOW_ROWS_SORT")){e.rowsSortable.reinit()}if(e.getParam("ALLOW_COLUMNS_SORT")){e.colsSortable.reinit()}i.unload();e.tableUnfade();BX.onCustomEvent(window,"Grid::updated",[])})}},_clickOnMoreButton:function(t){t.preventDefault();var e=this;var i=this.getMoreButton();i.load();this.getData().request(i.getLink(),null,null,"more",function(){e.getUpdater().appendBodyRows(this.getBodyRows());e.getUpdater().updateMoreButton(this.getMoreButton());e.getUpdater().updatePagination(this.getPagination());e.getRows().reset();e.bindOnRowEvents();e.bindOnMoreButtonEvents();e.bindOnClickPaginationLinks();e.bindOnClickHeader();e.bindOnCheckAll();e.updateCounterDisplayed();e.updateCounterSelected();if(e.getParam("ALLOW_ROWS_SORT")){e.rowsSortable.reinit()}if(e.getParam("ALLOW_COLUMNS_SORT")){e.colsSortable.reinit()}e.unselectAllCheckAllCheckboxes()})},getAjaxId:function(){return BX.data(this.getContainer(),this.settings.get("ajaxIdDataProp"))},update:function(t,e){var i,n,s,o,r,a;if(!BX.type.isNotEmptyString(t)){return}o=BX.Grid.Utils.getByTag(this.getTable(),"tbody",true);r=BX.Grid.Utils.getByTag(this.getTable(),"thead",true);a=BX.Grid.Utils.getByClass(this.getContainer(),this.settings.get("classNavPanel"),true);t=BX.create("div",{html:t});n=BX.Grid.Utils.getByClass(t,this.settings.get("classHeadRow"));i=BX.Grid.Utils.getByClass(t,this.settings.get("classDataRows"));s=BX.Grid.Utils.getByClass(t,this.settings.get("classNavPanel"),true);if(e===this.settings.get("updateActionMore")){this.getRows().addRows(i);this.unselectAllCheckAllCheckboxes()}if(e===this.settings.get("updateActionPagination")){BX.cleanNode(o);this.getRows().addRows(i);this.unselectAllCheckAllCheckboxes()}if(e===this.settings.get("updateActionSort")){BX.cleanNode(r);BX.cleanNode(o);r.appendChild(n[0]);this.getRows().addRows(i)}a.innerHTML=s.innerHTML;this.bindOnRowEvents();this.bindOnMoreButtonEvents();this.bindOnClickPaginationLinks();this.bindOnClickHeader();this.bindOnCheckAll();this.updateCounterDisplayed();this.updateCounterSelected();this.sortable.reinit()},getCounterDisplayed:function(){return BX.Grid.Utils.getByClass(this.getContainer(),this.settings.get("classCounterDisplayed"))},getCounterSelected:function(){return BX.Grid.Utils.getByClass(this.getContainer(),this.settings.get("classCounterSelected"))},updateCounterDisplayed:function(){var t=this.getCounterDisplayed();var e;if(BX.type.isArray(t)){e=this.getRows();t.forEach(function(t){if(BX.type.isDomNode(t)){t.innerText=e.getCountDisplayed()}},this)}},updateCounterSelected:function(){var t=this.getCounterSelected();var e;if(BX.type.isArray(t)){e=this.getRows();t.forEach(function(t){if(BX.type.isDomNode(t)){t.innerText=e.getCountSelected()}},this)}},getContainerId:function(){return this.containerId},getId:function(){return this.containerId},getContainer:function(){return BX(this.getContainerId())},getCounter:function(){if(!this.counter){this.counter=BX.Grid.Utils.getByClass(this.getContainer(),this.settings.get("classCounter"))}return this.counter},enableForAllCounter:function(){var t=this.getCounter();if(BX.type.isArray(t)){t.forEach(function(t){BX.addClass(t,this.settings.get("classForAllCounterEnabled"))},this)}},disableForAllCounter:function(){var t=this.getCounter();if(BX.type.isArray(t)){t.forEach(function(t){BX.removeClass(t,this.settings.get("classForAllCounterEnabled"))},this)}},getScrollContainer:function(){if(!this.scrollContainer){this.scrollContainer=BX.Grid.Utils.getByClass(this.getContainer(),this.settings.get("classScrollContainer"),true)}return this.scrollContainer},getWrapper:function(){if(!this.wrapper){this.wrapper=BX.Grid.Utils.getByClass(this.getContainer(),this.settings.get("classWrapper"),true)}return this.wrapper},getFadeContainer:function(){if(!this.fadeContainer){this.fadeContainer=BX.Grid.Utils.getByClass(this.getContainer(),this.settings.get("classFadeContainer"),true)}return this.fadeContainer},getTable:function(){return BX.Grid.Utils.getByClass(this.getContainer(),this.settings.get("classTable"),true)},getHeaders:function(){return BX.Grid.Utils.getBySelector(this.getWrapper(),'.main-grid-header[data-relative="'+this.getContainerId()+'"]')},getHead:function(){return BX.Grid.Utils.getByTag(this.getContainer(),"thead",true)},getBody:function(){return BX.Grid.Utils.getByTag(this.getContainer(),"tbody",true)},getFoot:function(){return BX.Grid.Utils.getByTag(this.getContainer(),"tfoot",true)},getRows:function(){if(!(this.rows instanceof BX.Grid.Rows)){this.rows=new BX.Grid.Rows(this)}return this.rows},getMoreButton:function(){var t=BX.Grid.Utils.getByClass(this.getContainer(),this.settings.get("classMoreButton"),true);return new BX.Grid.Element(t,this)},getLoader:function(){if(!(this.loader instanceof BX.Grid.Loader)){this.loader=new BX.Grid.Loader(this)}return this.loader}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:96:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/action-panel.min.js?151131647213009";s:6:"source";s:76:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/action-panel.js";s:3:"min";s:80:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/action-panel.min.js";s:3:"map";s:80:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/action-panel.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Grid");BX.Grid.ActionPanel=function(t,e,n){this.parent=null;this.rel={};this.actions=null;this.types=null;this.lastActivated=[];this.init(t,e,n)};BX.Grid.ActionPanel.prototype={init:function(parent,actions,types){this.parent=parent;this.actions=eval(actions);this.types=eval(types);BX.addCustomEvent(window,"Dropdown::change",BX.proxy(function(t,e,n,a){this.isPanelControl(BX(t))&&this._dropdownChange(t,e,n,a)},this));BX.addCustomEvent(window,"Dropdown::load",BX.proxy(function(t,e,n,a){this.isPanelControl(BX(t))&&this._dropdownChange(t,e,n,a)},this));var panel=this.getPanel();BX.bind(panel,"change",BX.delegate(this._checkboxChange,this));BX.bind(panel,"click",BX.delegate(this._clickOnButton,this));BX.addCustomEvent(window,"Grid::updated",function(){var t=BX("grid_cancel_button");t&&BX.fireEvent(BX.firstChild(t),"click")})},resetForAllCheckbox:function(){var t=this.getForAllCheckbox();if(BX.type.isDomNode(t)){t.checked=null}},getForAllCheckbox:function(){return BX.Grid.Utils.getByClass(this.getPanel(),this.parent.settings.get("classForAllCheckbox"),true)},getPanel:function(){return BX.Grid.Utils.getByClass(this.parent.getContainer(),this.parent.settings.get("classActionPanel"),true)},getApplyButton:function(){return BX.Grid.Utils.getByClass(this.getPanel(),this.parent.settings.get("classPanelApplyButton"),true)},isPanelControl:function(t){return BX.hasClass(t,this.parent.settings.get("classPanelControl"))},getTextInputs:function(){return BX.Grid.Utils.getBySelector(this.getPanel(),'input[type="text"]')},getHiddenInputs:function(){return BX.Grid.Utils.getBySelector(this.getPanel(),'input[type="hidden"]')},getDropdowns:function(){return BX.Grid.Utils.getByClass(this.getPanel(),this.parent.settings.get("classDropdown"))},getCheckboxes:function(){return BX.Grid.Utils.getByClass(this.getPanel(),this.parent.settings.get("classPanelCheckbox"))},getButtons:function(){return BX.Grid.Utils.getByClass(this.getPanel(),this.parent.settings.get("classPanelButton"))},isDropdown:function(t){return BX.hasClass(t,this.parent.settings.get("classDropdown"))},isCheckbox:function(t){return BX.hasClass(t,this.parent.settings.get("classPanelCheckbox"))},isTextInput:function(t){return t.type==="text"},isHiddenInput:function(t){return t.type==="hidden"},createDropdown:function(t,e){var n=this.createContainer(t.ID,e);var a=BX.create("div",{props:{className:"main-dropdown main-grid-panel-control",id:t.ID+"_control"},attrs:{name:t.NAME,"data-name":t.NAME,"data-items":JSON.stringify(t.ITEMS),"data-value":t.ITEMS[0].VALUE},children:[BX.create("span",{props:{className:"main-dropdown-inner"},html:t.ITEMS[0].NAME})]});n.appendChild(a);return n},createCheckbox:function(t,e){var n=this.createContainer(t.ID,e);var a=BX.create("span",{props:{className:"main-grid-checkbox-container"}});var i=BX.create("span",{props:{className:"main-grid-control-panel-content-title"}});var r=BX.create("input",{props:{type:"checkbox",className:this.parent.settings.get("classPanelCheckbox")+" main-grid-checkbox",id:t.ID+"_control"},attrs:{value:t.VALUE||"",title:t.TITLE||"",name:t.NAME||"","data-onchange":JSON.stringify(t.ONCHANGE)}});r.checked=t.CHECKED||null;n.appendChild(a);n.appendChild(i);a.appendChild(r);a.appendChild(BX.create("label",{props:{className:"main-grid-checkbox"},attrs:{"for":t.ID+"_control",title:t.TITLE}}));i.appendChild(BX.create("label",{attrs:{"for":t.ID+"_control",title:t.TITLE},html:t.LABEL}));return n},createText:function(t,e){var n=this.createContainer(t.ID,e);var a=BX.type.isNotEmptyString(t["TITLE"])?t["TITLE"]:"";if(a!==""){n.appendChild(BX.create("label",{attrs:{title:a,"for":t.ID+"_control"},text:a}))}n.appendChild(BX.create("input",{props:{className:"main-grid-control-panel-input-text main-grid-panel-control",id:t.ID+"_control"},attrs:{name:t.NAME,title:a,placeholder:t.PLACEHOLDER||"",value:t.VALUE||"",type:"text","data-onchange":JSON.stringify(t.ONCHANGE||[])}}));return n},createHidden:function(t,e){var n=this.createContainer(t.ID,e);n.appendChild(BX.create("input",{props:{id:t.ID+"_control",type:"hidden"},attrs:{name:t.NAME,value:t.VALUE||""}}));return n},createButton:function(t,e){var n=this.createContainer(t.ID,e);var a=BX.create("button",{props:{className:"main-grid-buttons"+(t.CLASS?" "+t.CLASS:""),id:t.id+"_control"},attrs:{name:t.NAME||"","data-onchange":JSON.stringify(t.ONCHANGE||[])},html:t.TEXT});n.appendChild(a);return n},createLink:function(t,e){var n=this.createContainer(t.ID,e);var a=BX.create("a",{props:{className:"main-grid-link"+(t.CLASS?" "+t.CLASS:""),id:t.ID+"_control"},attrs:{href:t.HREF||"","data-onchange":JSON.stringify(t.ONCHANGE||[])},html:t.TEXT});n.appendChild(a);return n},createCustom:function(t,e){},createContainer:function(t,e){t=t.replace("_control","");e=e.replace("_control","");return BX.create("span",{props:{className:this.parent.settings.get("classPanelControlContainer"),id:t},attrs:{"data-relative":e}})},removeItemsRelativeCurrent:function(t){var e=t;var n=t.id;var a=[];var i;while(e){i=BX.data(e,"relative");if(i===n||i===t.id){n=e.id;a.push(e)}e=e.nextElementSibling}a.forEach(function(t){BX.remove(t)})},validateData:function(t){return"ONCHANGE"in t&&BX.type.isArray(t.ONCHANGE)},activateControl:function(t){var e=BX(t);if(BX.type.isDomNode(e)){BX.removeClass(e,this.parent.settings.get("classDisable"));e.disabled=null}},deactivateControl:function(t){var e=BX(t);if(BX.type.isDomNode(e)){BX.addClass(e,this.parent.settings.get("classDisable"));e.disabled=true}},showControl:function(t){var e=BX(t);e&&BX.show(e)},hideControl:function(t){var e=BX(t);e&&BX.hide(e)},validateActionObject:function(t){return BX.type.isPlainObject(t)&&"ACTION"in t&&BX.type.isNotEmptyString(t.ACTION)&&(t.ACTION===this.actions.RESET_CONTROLS||"DATA"in t&&BX.type.isArray(t.DATA))},validateControlObject:function(t){return BX.type.isPlainObject(t)&&"TYPE"in t&&"ID"in t},createDate:function(t,e){var n=this.createContainer(t.ID,e);var a=BX.decl({block:"main-ui-date",mix:["main-grid-panel-date"],calendarButton:true,valueDelete:true,placeholder:"PLACEHOLDER"in t?t.PLACEHOLDER:"",name:"NAME"in t?t.NAME+"_from":"",tabindex:"TABINDEX"in t?t.TABINDEX:"",value:"VALUE"in t?t.VALUE:"",enableTime:"TIME"in t?t.TIME?"true":"false":"false"});n.appendChild(a);return n},createControl:function(t,e){var n=null;switch(t.TYPE){case this.types.DROPDOWN:n=this.createDropdown(t,e);break;case this.types.CHECKBOX:n=this.createCheckbox(t,e);break;case this.types.TEXT:n=this.createText(t,e);break;case this.types.HIDDEN:n=this.createHidden(t,e);break;case this.types.BUTTON:n=this.createButton(t,e);break;case this.types.LINK:n=this.createLink(t,e);break;case this.types.CUSTOM:n=this.createCustom(t,e);break;case this.types.DATE:n=this.createDate(t,e);break}return n},onChangeHandler:function(container,actions,isPseudo){var newElement,callback;var self=this;if(BX.type.isDomNode(container)&&BX.type.isArray(actions)){actions.forEach(function(action){if(self.validateActionObject(action)){if(action.ACTION===self.actions.CREATE){self.removeItemsRelativeCurrent(container);action.DATA.reverse();action.DATA.forEach(function(t){if(self.validateControlObject(t)){newElement=self.createControl(t,BX.data(container,"relative")||container.id);if(BX.type.isDomNode(newElement)){BX.insertAfter(newElement,container);if("ONCHANGE"in t&&t.TYPE===self.types.CHECKBOX&&"CHECKED"in t&&t.CHECKED){self.onChangeHandler(newElement,t.ONCHANGE)}if(t.TYPE===self.types.DROPDOWN&&BX.type.isArray(t.ITEMS)&&t.ITEMS.length&&"ONCHANGE"in t.ITEMS[0]&&BX.type.isArray(t.ITEMS[0].ONCHANGE)){self.onChangeHandler(newElement,t.ITEMS[0].ONCHANGE)}}}})}if(action.ACTION===self.actions.ACTIVATE){self.removeItemsRelativeCurrent(container);if(BX.type.isArray(action.DATA)){action.DATA.forEach(function(t){self.lastActivated.push(t.ID);self.activateControl(t.ID)})}}if(action.ACTION===self.actions.SHOW){if(BX.type.isArray(action.DATA)){action.DATA.forEach(function(t){self.showControl(t.ID)})}}if(action.ACTION===self.actions.HIDE){if(BX.type.isArray(action.DATA)){action.DATA.forEach(function(t){self.hideControl(t.ID)})}}if(action.ACTION===self.actions.HIDE_ALL_EXPECT){if(BX.type.isArray(action.DATA)){(self.getControls()||[]).forEach(function(t){if(!action.DATA.some(function(e){return e.ID===t.id})){self.hideControl(t.id)}})}}if(action.ACTION===self.actions.SHOW_ALL){(self.getControls()||[]).forEach(function(t){self.showControl(t.id)})}if(action.ACTION===self.actions.REMOVE){if(BX.type.isArray(action.DATA)){action.DATA.forEach(function(t){BX.remove(BX(t.ID))})}}if(action.ACTION===self.actions.CALLBACK){this.confirmDialog(action,BX.delegate(function(){if(BX.type.isArray(action.DATA)){action.DATA.forEach(function(currentCallback){if(currentCallback.JS.indexOf("Grid.")!==-1){callback=currentCallback.JS.replace("Grid","self.parent");callback=callback.replace("()","");callback+=".apply(self.parent, [container])";try{eval(callback)}catch(err){throw new Error(err)}}else if(BX.type.isNotEmptyString(currentCallback.JS)){try{eval(currentCallback.JS)}catch(err){throw new Error(err)}}})}},this))}if(action.ACTION===self.actions.RESET_CONTROLS){this.removeItemsRelativeCurrent(container)}}},this)}else{if(!isPseudo){this.removeItemsRelativeCurrent(container)}self.lastActivated.forEach(function(t){self.deactivateControl(t)});self.lastActivated=[]}},confirmDialog:function(t,e,n){var a,i,r,o;if("CONFIRM"in t&&t.CONFIRM){t.CONFIRM_MESSAGE=t.CONFIRM_MESSAGE||this.parent.arParams.CONFIRM_MESSAGE;t.CONFIRM_APPLY_BUTTON=t.CONFIRM_APPLY_BUTTON||this.parent.arParams.CONFIRM_APPLY;t.CONFIRM_CANCEL_BUTTON=t.CONFIRM_CANCEL_BUTTON||this.parent.arParams.CONFIRM_CANCEL;a=new BX.PopupWindow(this.parent.getContainerId()+"-confirm-dialog",null,{content:'<div class="main-grid-confirm-content">'+t.CONFIRM_MESSAGE+"</div>",titleBar:"CONFIRM_TITLE"in t?t.CONFIRM_TITLE:"",autoHide:false,zIndex:9999,overlay:.4,offsetTop:-100,closeIcon:true,closeByEsc:true,events:{onClose:function(){BX.unbind(window,"keydown",s)}},buttons:[new BX.PopupWindowButton({text:t.CONFIRM_APPLY_BUTTON,id:this.parent.getContainerId()+"-confirm-dialog-apply-button",events:{click:function(){BX.type.isFunction(e)?e():null;this.popupWindow.close();this.popupWindow.destroy();BX.onCustomEvent(window,"Grid::confirmDialogApply",[this]);BX.unbind(window,"keydown",s)}}}),new BX.PopupWindowButtonLink({text:t.CONFIRM_CANCEL_BUTTON,id:this.parent.getContainerId()+"-confirm-dialog-cancel-button",events:{click:function(){BX.type.isFunction(n)?n():null;this.popupWindow.close();this.popupWindow.destroy();BX.onCustomEvent(window,"Grid::confirmDialogCancel",[this]);BX.unbind(window,"keydown",s)}}})]});if(!a.isShown()){a.show();i=a.popupContainer;BX.removeClass(i,this.parent.settings.get("classCloseAnimation"));BX.addClass(i,this.parent.settings.get("classShowAnimation"));r=BX(this.parent.getContainerId()+"-confirm-dialog-apply-button");o=BX(this.parent.getContainerId()+"-confirm-dialog-cancel-button");BX.bind(window,"keydown",s)}}else{BX.type.isFunction(e)?e():null}function s(t){if(t.code==="Enter"){t.preventDefault();t.stopPropagation();BX.fireEvent(r,"click")}if(t.code==="Escape"){t.preventDefault();t.stopPropagation();BX.fireEvent(o,"click")}}},_dropdownChange:function(t,e,n,a){var i=BX(t);var r=i.parentNode;var o=a&&"ONCHANGE"in a?a.ONCHANGE:null;var s="PSEUDO"in a&&a.PSEUDO!==false;this.onChangeHandler(r,o,s)},_checkboxChange:function(event){var onChange;try{onChange=eval(BX.data(event.target,"onchange"))}catch(err){onChange=null}this.onChangeHandler(BX.findParent(event.target,{className:this.parent.settings.get("classPanelContainer")},true,false),event.target.checked||event.target.id.indexOf("actallrows_")!==-1?onChange:null)},_clickOnButton:function(event){var onChange;if(this.isButton(event.target)){event.preventDefault();try{onChange=eval(BX.data(event.target,"onchange"))}catch(err){onChange=null}this.onChangeHandler(BX.findParent(event.target,{className:this.parent.settings.get("classPanelContainer")},true,false),onChange)}},isButton:function(t){return BX.hasClass(t,this.parent.settings.get("classPanelButton"))},getSelectedIds:function(){var t=this.parent.getRows().getSelected().filter(function(t){return t.isShown()});return t.map(function(t){return t.getId()})},getControls:function(){return BX.findChild(this.getPanel(),{className:this.parent.settings.get("classPanelControlContainer")},true,true)},getValues:function(){var t={};var e=this;var n=[].concat(this.getDropdowns(),this.getTextInputs(),this.getHiddenInputs(),this.getCheckboxes(),this.getButtons());(n||[]).forEach(function(n){if(BX.type.isDomNode(n)){if(e.isDropdown(n)){var a=BX.data(n,"value");a=a!==null&&a!==undefined?a:"";t[BX.data(n,"name")]=a}if(e.isCheckbox(n)&&n.checked){t[n.getAttribute("name")]=n.value}if(e.isTextInput(n)||e.isHiddenInput(n)){t[n.getAttribute("name")]=n.value}if(e.isButton(n)){var i=BX.data(n,"name");var r=BX.data(n,"value");r=r!==null&&r!==undefined?r:"";if(i){t[i]=r}}}});return t}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:91:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/baseclass.min.js?1511316472207";s:6:"source";s:73:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/baseclass.js";s:3:"min";s:77:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/baseclass.min.js";s:3:"map";s:77:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/baseclass.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Grid");BX.Grid.BaseClass=function(t){this.parent=t};BX.Grid.BaseClass.prototype={getParent:function(){return this.parent}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:96:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/cols-sortable.min.js?15113164725340";s:6:"source";s:77:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/cols-sortable.js";s:3:"min";s:81:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/cols-sortable.min.js";s:3:"map";s:81:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/cols-sortable.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Grid");BX.Grid.ColsSortable=function(t){this.parent=null;this.dragItem=null;this.targetItem=null;this.rowsList=null;this.colsList=null;this.dragRect=null;this.offset=null;this.startDragOffset=null;this.dragColumn=null;this.targetColumn=null;this.isDrag=null;this.init(t)};BX.Grid.ColsSortable.prototype={init:function(t){this.parent=t;this.colsList=this.getColsList();this.rowsList=this.getRowsList();if(!this.inited){this.inited=true;BX.addCustomEvent("Grid::updated",BX.proxy(this.reinit,this));BX.addCustomEvent("Grid::headerUpdated",BX.proxy(this.reinit,this))}this.registerObjects()},destroy:function(){BX.removeCustomEvent("Grid::updated",BX.proxy(this.reinit,this));this.unregisterObjects()},reinit:function(){this.unregisterObjects();this.reset();this.init(this.parent)},reset:function(){this.dragItem=null;this.targetItem=null;this.rowsList=null;this.colsList=null;this.dragRect=null;this.offset=null;this.startDragOffset=null;this.dragColumn=null;this.targetColumn=null;this.isDrag=null;this.fixedTableColsList=null},isActive:function(){return this.isDrag},registerObjects:function(){this.unregisterObjects();this.getColsList().forEach(this.register,this);this.getFixedHeaderColsList().forEach(this.register,this)},unregisterObjects:function(){this.getColsList().forEach(this.unregister,this);this.getFixedHeaderColsList().forEach(this.unregister,this)},unregister:function(t){jsDD.unregisterObject(t)},register:function(t){t.onbxdragstart=BX.proxy(this._onDragStart,this);t.onbxdrag=BX.proxy(this._onDrag,this);t.onbxdragstop=BX.proxy(this._onDragEnd,this);jsDD.registerObject(t)},getColsList:function(){if(!this.colsList){this.colsList=BX.Grid.Utils.getByTag(this.parent.getRows().getHeadFirstChild().getNode(),"th");this.colsList=this.colsList.filter(function(t){return!this.isStatic(t)},this)}return this.colsList},getFixedHeaderColsList:function(){if(!this.fixedTableColsList&&this.parent.getParam("ALLOW_PIN_HEADER")){this.fixedTableColsList=BX.Grid.Utils.getByTag(this.parent.getPinHeader().getFixedTable(),"th");this.fixedTableColsList=this.fixedTableColsList.filter(function(t){return!this.isStatic(t)},this)}return this.fixedTableColsList||[]},getRowsList:function(){var t=this.parent.getRows().getSourceRows();if(this.parent.getParam("ALLOW_PIN_HEADER")){t=t.concat(BX.Grid.Utils.getByTag(this.parent.getPinHeader().getFixedTable(),"tr"))}return t},isStatic:function(t){return BX.hasClass(t,this.parent.settings.get("classCellStatic"))},getDragOffset:function(){return jsDD.x-this.startDragOffset-this.dragRect.left},getColumn:function(t){var i=[];if(t instanceof HTMLTableCellElement){i=this.rowsList.map(function(i){return i.cells[t.cellIndex]})}return i},_onDragStart:function(){if(this.parent.getParam("ALLOW_PIN_HEADER")&&this.parent.getPinHeader().isPinned()){this.colsList=this.getFixedHeaderColsList()}else{this.colsList=this.getColsList()}this.isDrag=true;this.dragItem=jsDD.current_node;this.dragRect=this.dragItem.getBoundingClientRect();this.offset=Math.ceil(this.dragRect.width);this.startDragOffset=jsDD.start_x-this.dragRect.left;this.dragColumn=this.getColumn(this.dragItem);this.dragIndex=BX.Grid.Utils.getIndex(this.colsList,this.dragItem)},isDragToRight:function(t,i){var s=t.getBoundingClientRect();var e=Math.ceil(s.left+s.width/2+BX.scrollLeft(window));var r=this.dragIndex;var n=jsDD.x;return i>r&&n>e},isDragToLeft:function(t,i){var s=t.getBoundingClientRect();var e=Math.ceil(s.left+s.width/2+BX.scrollLeft(window));var r=this.dragIndex;var n=jsDD.x;return i<r&&n<e},isDragToBack:function(t,i){var s=t.getBoundingClientRect();var e=Math.ceil(s.left+s.width/2+BX.scrollLeft(window));var r=this.dragIndex;var n=jsDD.x;return i>r&&n<e||i<r&&n>e},isMovedToRight:function(t){return t.style.transform==="translate3d("+-this.offset+"px, 0px, 0px)"},isMovedToLeft:function(t){return t.style.transform==="translate3d("+this.offset+"px, 0px, 0px)"},isMoved:function(t){return t.style.transform!=="translate3d(0px, 0px, 0px)"&&t.style.transform!==""},moveColumn:function(t,i,s){s=BX.type.isNumber(s)?s:300;BX.Grid.Utils.styleForEach(t,{transition:s+"ms",transform:"translate3d("+i+"px, 0px, 0px)"})},_onDrag:function(){this.dragOffset=this.getDragOffset();this.targetItem=this.targetItem||this.dragItem;this.targetColumn=this.targetColumn||this.dragColumn;var t=-this.offset;var i=this.offset;var s=0;var e=0;this.moveColumn(this.dragColumn,this.dragOffset,e);[].forEach.call(this.colsList,function(e,r){if(e){if(this.isDragToRight(e,r)&&!this.isMovedToRight(e)){this.targetColumn=this.getColumn(e);this.moveColumn(this.targetColumn,t)}if(this.isDragToLeft(e,r)&&!this.isMovedToLeft(e)){this.targetColumn=this.getColumn(e);this.moveColumn(this.targetColumn,i)}if(this.isDragToBack(e,r)&&this.isMoved(e)){this.targetColumn=this.getColumn(e);this.moveColumn(this.targetColumn,s)}}},this)},_onDragEnd:function(){[].forEach.call(this.dragColumn,function(t,i){BX.Grid.Utils.collectionSort(t,this.targetColumn[i])},this);this.rowsList.forEach(function(t){BX.Grid.Utils.styleForEach(t.cells,{transition:"",transform:""})});this.reinit();var t=this.colsList.map(function(t){return BX.data(t,"name")});this.parent.getUserOptions().setColumns(t);BX.onCustomEvent(this.parent.getContainer(),"Grid::columnMoved",[this.parent])}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:87:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/data.min.js?15113164725150";s:6:"source";s:68:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/data.js";s:3:"min";s:72:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/data.min.js";s:3:"map";s:72:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/data.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Grid");BX.Grid.Data=function(t){this.parent=t;this.reset()};BX.Grid.Data.prototype.reset=function(){this.response=null;this.xhr=null;this.headRows=null;this.bodyRows=null;this.footRows=null;this.moreButton=null;this.pagination=null;this.counterDisplayed=null;this.counterSelected=null;this.counterTotal=null;this.limit=null;this.actionPanel=null;this.rowsByParentId={};this.rowById={};this.isValidResponse=null};BX.Grid.Data.prototype.getParent=function(){return this.parent};BX.Grid.Data.prototype.validateResponse=function(){if(!BX.type.isBoolean(this.isValidResponse)){this.isValidResponse=!!this.getResponse()&&!!BX.Grid.Utils.getByClass(this.getResponse(),this.getParent().settings.get("classContainer"),true)}return this.isValidResponse};BX.Grid.Data.prototype.request=function(t,e,i,s,n,r){if(!BX.type.isString(t)){t=""}if(!BX.type.isNotEmptyString(e)){e="GET"}if(!BX.type.isPlainObject(i)){i={}}var o={gridId:this.parent.getId(),url:t,method:e,data:i};BX.onCustomEvent(window,"Grid::beforeRequest",[this,o]);t=o.url;if(!BX.type.isNotEmptyString(t)){t=window.location.pathname+window.location.search}t=BX.Grid.Utils.addUrlParams(t,{sessid:BX.bitrix_sessid(),internal:"true",grid_id:this.parent.getId()});if("apply_filter"in i&&i.apply_filter==="Y"){t=BX.Grid.Utils.addUrlParams(t,{apply_filter:"Y"})}else{t=BX.util.remove_url_param(t,"apply_filter")}if("clear_nav"in i&&i.clear_nav==="Y"){t=BX.Grid.Utils.addUrlParams(t,{clear_nav:"Y"})}else{t=BX.util.remove_url_param(t,"clear_nav")}t=BX.Grid.Utils.addUrlParams(t,{grid_action:s||"showpage"});e=o.method;i=o.data;this.reset();var a=this;setTimeout(function(){var o=BX.ajax({url:BX.Grid.Utils.ajaxUrl(t,a.getParent().getAjaxId()),data:i,method:e,dataType:"html",headers:[{name:"X-Ajax-Grid-UID",value:a.getParent().getAjaxId()},{name:"X-Ajax-Grid-Req",value:JSON.stringify({action:s||"showpage"})}],processData:true,scriptsRunFirst:false,onsuccess:function(t){a.response=BX.create("div",{html:t});a.response=a.response.querySelector("#"+a.parent.getContainerId());a.xhr=o;if(BX.type.isFunction(n)){BX.delegate(n,a)(t,o)}},onerror:function(t){a.error=r;a.xhr=o;if(BX.type.isFunction(r)){BX.delegate(r,a)(o,t)}}})},0)};BX.Grid.Data.prototype.getResponse=function(){return this.response};BX.Grid.Data.prototype.getHeadRows=function(){if(!this.headRows){this.headRows=BX.Grid.Utils.getByClass(this.getResponse(),this.getParent().settings.get("classHeadRow"))}return this.headRows};BX.Grid.Data.prototype.getBodyRows=function(){if(!this.bodyRows){this.bodyRows=BX.Grid.Utils.getByClass(this.getResponse(),this.getParent().settings.get("classBodyRow"))}return this.bodyRows};BX.Grid.Data.prototype.getRowsByParentId=function(t){if(!(t in this.rowsByParentId)){this.rowsByParentId[t]=BX.Grid.Utils.getBySelector(this.getResponse(),"."+this.getParent().settings.get("classBodyRow")+'[data-parent-id="'+t+'"]')}return this.rowsByParentId[t]};BX.Grid.Data.prototype.getRowById=function(t){if(!(t in this.rowById)){this.rowById[t]=BX.Grid.Utils.getBySelector(this.getResponse(),"."+this.getParent().settings.get("classBodyRow")+'[data-id="'+t+'"]',true)}return this.rowById[t]};BX.Grid.Data.prototype.getFootRows=function(){if(!this.footRows){this.footRows=BX.Grid.Utils.getByClass(this.getResponse(),this.getParent().settings.get("classFootRow"))}return this.footRows};BX.Grid.Data.prototype.getMoreButton=function(){if(!this.moreButton){this.moreButton=BX.Grid.Utils.getByClass(this.getResponse(),this.getParent().settings.get("classMoreButton"),true)}return this.moreButton};BX.Grid.Data.prototype.getPagination=function(){if(!this.pagination){this.pagination=BX.Grid.Utils.getByClass(this.getResponse(),this.getParent().settings.get("classPagination"),true);if(BX.type.isDomNode(this.pagination)){this.pagination=BX.firstChild(this.pagination)}}return this.pagination};BX.Grid.Data.prototype.getCounterDisplayed=function(){if(!this.counterDisplayed){this.counterDisplayed=BX.Grid.Utils.getByClass(this.getResponse(),this.getParent().settings.get("classCounterDisplayed"),true)}return this.counterDisplayed};BX.Grid.Data.prototype.getCounterSelected=function(){if(!this.counterSelected){this.counterSelected=BX.Grid.Utils.getByClass(this.getResponse(),this.getParent().settings.get("classCounterSelected"),true)}return this.counterSelected};BX.Grid.Data.prototype.getCounterTotal=function(){if(!BX.type.isDomNode(this.counterTotal)){var t="."+this.getParent().settings.get("classCounterTotal")+" ."+this.getParent().settings.get("classPanelCellContent");this.counterTotal=BX.Grid.Utils.getBySelector(this.getResponse(),t,true)}return this.counterTotal};BX.Grid.Data.prototype.getLimit=function(){if(!this.limit){this.limit=BX.Grid.Utils.getByClass(this.getResponse(),this.getParent().settings.get("classPageSize"),true)}return this.limit};BX.Grid.Data.prototype.getPageSize=function(){return this.getLimit()};BX.Grid.Data.prototype.getActionPanel=function(){if(!this.actionPanel){this.actionPanel=BX.Grid.Utils.getByClass(this.getResponse(),this.getParent().settings.get("classActionPanel"),true)}return this.actionPanel}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:98:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/dropdown-manager.min.js?1511316472996";s:6:"source";s:80:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/dropdown-manager.js";s:3:"min";s:84:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/dropdown-manager.min.js";s:3:"map";s:84:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/dropdown-manager.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Main");BX.Main.dropdownManager={dropdownClass:"main-dropdown",data:{},init:function(){var self=this;var result;var onLoadItems;var items;BX.bind(document,"click",BX.delegate(function(t){if(BX.hasClass(t.target,this.dropdownClass)){t.preventDefault();result=this.getById(t.target.id);if(result&&result.dropdown===t.target){self.push(t.target.id,this.getById(t.target.id))}else{self.push(t.target.id,new BX.Main.dropdown(t.target))}}},this));onLoadItems=BX.Grid.Utils.getByClass(document.body,this.dropdownClass);if(BX.type.isArray(onLoadItems)){onLoadItems.forEach(function(current){result=self.getById(current.id);try{items=eval(BX.data(current,"items"))}catch(err){}BX.onCustomEvent(window,"Dropdown::load",[current.id,{},null,BX.type.isArray(items)&&items.length?items[0]:[],BX.data(current,"value")])})}},push:function(t,e){this.data[t]=e},getById:function(t){return t in this.data?this.data[t]:null}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:91:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/dropdown.min.js?15113164723586";s:6:"source";s:72:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/dropdown.js";s:3:"min";s:76:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/dropdown.min.js";s:3:"map";s:76:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/dropdown.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Main");BX.Main.dropdown=function(t){this.id=null;this.dropdown=null;this.items=null;this.value=null;this.menuId=null;this.menu=null;this.menuItems=null;this.dataItems="items";this.dataValue="value";this.dataPseudo="pseudo";this.dropdownItemClass="main-dropdown-item";this.activeClass="main-dropdown-active";this.selectedClass="main-dropdown-item-selected";this.notSelectedClass="main-dropdown-item-not-selected";this.menuItemClass="menu-popup-item";this.init(t)};BX.Main.dropdown.prototype={init:function(t){this.id=t.id;this.dropdown=t;this.items=this.getItems();this.value=this.getValue();this.menuId=this.getMenuId();this.menu=this.createMenu();this.menu.popupWindow.show();BX.bind(this.dropdown,"click",BX.delegate(this.showMenu,this))},getMenuId:function(){return this.id+"_menu"},getItems:function(){var result;try{var str=BX.data(this.dropdown,this.dataItems);result=eval(str)}catch(err){result=[]}return result},getValue:function(){return BX.data(this.dropdown,this.dataValue)},prepareMenuItems:function(){var t=this;var e,s;var n=this.getValue();function i(a){return a.map(function(a){e={};e["data-"+t.dataValue]=a.VALUE;e["data-"+t.dataPseudo]="PSEUDO"in a&&a.PSEUDO?"true":"false";s=BX.create("div",{children:[BX.create("span",{props:{className:t.dropdownItemClass},attrs:e,text:a.NAME})]});return{text:s.innerHTML,className:n===a.VALUE?t.selectedClass:t.notSelectedClass,delimiter:a.DELIMITER,items:"ITEMS"in a?i(a.ITEMS):null}})}return i(this.getItems())},createMenu:function(){var t=this;return BX.PopupMenu.create(this.getMenuId(),this.dropdown,this.prepareMenuItems(),{autoHide:true,offsetTop:-8,offsetLeft:40,angle:{position:"bottom",offset:0},events:{onPopupClose:BX.delegate(this._onCloseMenu,this),onPopupShow:function(){t._onShowMenu()}}})},showMenu:function(){this.menu=BX.PopupMenu.getMenuById(this.menuId);if(!this.menu){this.menu=this.createMenu();this.menu.popupWindow.show()}},getSubItem:function(t){return BX.Grid.Utils.getByClass(t,this.dropdownItemClass,true)},refresh:function(t){var e=this.getSubItem(t);var s=BX.data(e,this.dataValue);BX.firstChild(this.dropdown).innerText=e.innerText;this.dropdown.dataset[this.dataValue]=s},selectItem:function(t){var e=this;(this.menu.menuItems||[]).forEach(function(s){BX.removeClass(s.layout.item,e.selectedClass);if(t!==s.layout.item){BX.addClass(s.layout.item,e.notSelectedClass)}else{BX.removeClass(s.layout.item,e.notSelectedClass)}});BX.addClass(t,this.selectedClass)},getDataItemIndexByValue:function(t,e){var s;if(BX.type.isArray(t)){t.map(function(t,n){if(t.VALUE===e){s=n;return false}})}return false},getDataItemByValue:function(t){var e=this.getItems().filter(function(e){return e.VALUE===t});return e.length>0?e[0]:null},_onShowMenu:function(){var t=this;BX.addClass(this.dropdown,this.activeClass);(this.menu.menuItems||[]).forEach(function(e){BX.bind(e.layout.item,"click",BX.delegate(t._onItemClick,t))})},_onCloseMenu:function(){BX.removeClass(this.dropdown,this.activeClass);BX.PopupMenu.destroy(this.menuId)},_onItemClick:function(t){var e=this.getMenuItem(t.target);var s,n;var i=this.getSubItem(e);var a=BX.data(i,"pseudo");if(!(a==="true")){this.refresh(e);this.selectItem(e);this.menu.popupWindow.close();s=this.getValue();n=this.getDataItemByValue(s)}else{s=BX.data(i,"value");n=this.getDataItemByValue(s)}BX.onCustomEvent(window,"Dropdown::change",[this.dropdown.id,t,e,n,s])},getMenuItem:function(t){var e=t;if(!BX.hasClass(e,this.menuItemClass)){e=BX.findParent(e,{"class":this.menuItemClass})}return e}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:89:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/element.min.js?1511316472857";s:6:"source";s:71:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/element.js";s:3:"min";s:75:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/element.min.js";s:3:"map";s:75:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/element.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Grid");BX.Grid.Element=function(t,e){this.node=null;this.href=null;this.parent=null;this.init(t,e)};BX.Grid.Element.prototype={init:function(t,e){this.node=t;this.parent=e;this.resetOnclickAttr()},getParent:function(){return this.parent},load:function(){BX.addClass(this.getNode(),this.getParent().settings.get("classLoad"))},unload:function(){BX.removeClass(this.getNode(),this.getParent().settings.get("classLoad"))},isLoad:function(){return BX.hasClass(this.getNode(),this.getParent().settings.get("classLoad"))},resetOnclickAttr:function(){if(BX.type.isDomNode(this.getNode())){this.getNode().onclick=null}},getObserver:function(){return BX.Grid.observer},getNode:function(){return this.node},getLink:function(){var t;try{t=this.getNode().href}catch(e){t=null}return t}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:88:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/fader.min.js?15113164725800";s:6:"source";s:69:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/fader.js";s:3:"min";s:73:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/fader.min.js";s:3:"map";s:73:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/fader.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Grid");BX.Grid.Fader=function(t){this.parent=null;this.table=null;this.container=null;this.init(t)};BX.Grid.Fader.prototype={init:function(t){this.parent=t;this.table=this.parent.getTable();this.container=this.table.parentNode;this.scrollStartEventName=this.parent.isTouch()?"touchstart":"mouseenter";this.scrollEndEventName=this.parent.isTouch()?"touchend":"mouseleave";if(this.parent.getParam("ALLOW_PIN_HEADER")){this.fixedTable=this.parent.getPinHeader().getFixedTable()}this.debounceScrollHandler=BX.debounce(this._onWindowScroll,400,this);BX.bind(window,"resize",BX.proxy(this.toggle,this));document.addEventListener("scroll",this.debounceScrollHandler,BX.Grid.Utils.listenerParams({passive:true}));this.container.addEventListener("scroll",BX.proxy(this.toggle,this),BX.Grid.Utils.listenerParams({passive:true}));BX.addCustomEvent(window,"Grid::updated",BX.proxy(this.toggle,this));BX.addCustomEvent(window,"Grid::headerUpdated",BX.proxy(this._onHeaderUpdated,this));BX.addCustomEvent(window,"Grid::columnResize",BX.proxy(this.toggle,this));BX.bind(this.getEarLeft(),this.scrollStartEventName,BX.proxy(this._onMouseoverLeft,this));BX.bind(this.getEarRight(),this.scrollStartEventName,BX.proxy(this._onMouseoverRight,this));BX.bind(this.getEarLeft(),this.scrollEndEventName,BX.proxy(this.stopScroll,this));BX.bind(this.getEarRight(),this.scrollEndEventName,BX.proxy(this.stopScroll,this));this.toggle();this.adjustEarOffset(true)},destroy:function(){BX.unbind(window,"resize",BX.proxy(this.toggle,this));document.removeEventListener("scroll",this.debounceScrollHandler,BX.Grid.Utils.listenerParams({passive:true}));this.container.removeEventListener("scroll",BX.proxy(this.toggle,this),BX.Grid.Utils.listenerParams({passive:true}));BX.removeCustomEvent(window,"Grid::updated",BX.proxy(this.toggle,this));BX.removeCustomEvent(window,"Grid::headerUpdated",BX.proxy(this._onHeaderUpdated,this));BX.removeCustomEvent(window,"Grid::columnResize",BX.proxy(this.toggle,this));BX.unbind(this.getEarLeft(),this.scrollStartEventName,BX.proxy(this._onMouseoverLeft,this));BX.unbind(this.getEarRight(),this.scrollStartEventName,BX.proxy(this._onMouseoverRight,this));BX.unbind(this.getEarLeft(),this.scrollEndEventName,BX.proxy(this.stopScroll,this));BX.unbind(this.getEarRight(),this.scrollEndEventName,BX.proxy(this.stopScroll,this));this.hideLeftEar();this.hideRightEar();this.stopScroll()},_onHeaderUpdated:function(){this.fixedTable=this.parent.getPinHeader().getFixedTable()},_onMouseoverLeft:function(t){this.parent.isTouch()&&t.preventDefault();this.startScrollByDirection("left")},_onMouseoverRight:function(t){this.parent.isTouch()&&t.preventDefault();this.startScrollByDirection("right")},stopScroll:function(){clearTimeout(this.scrollTimer);clearInterval(this.scrollInterval)},startScrollByDirection:function(t){var e=this.container;var i=e.scrollLeft;var s=this;var r=8;var o=1e3/60/2;this.scrollTimer=setTimeout(function(){s.scrollInterval=setInterval(function(){e.scrollLeft=t=="right"?i+=r:i-=r},o)},100)},getEarLeft:function(){if(!this.earLeft){this.earLeft=BX.Grid.Utils.getByClass(this.parent.getContainer(),this.parent.settings.get("classEarLeft"),true)}return this.earLeft},getEarRight:function(){if(!this.earRight){this.earRight=BX.Grid.Utils.getByClass(this.parent.getContainer(),this.parent.settings.get("classEarRight"),true)}return this.earRight},adjustEarOffset:function(t){if(t){this.windowHeight=BX.height(window);this.tbodyPos=BX.pos(this.table.tBodies[0]);this.headerPos=BX.pos(this.table.tHead)}var e=window.scrollY;if(this.parent.isIE()){e=document.documentElement.scrollTop}var i=e+this.windowHeight-this.tbodyPos.top;var s=e-this.tbodyPos.top;if(i>this.tbodyPos.bottom-this.tbodyPos.top){i=this.tbodyPos.bottom-this.tbodyPos.top}if(s<this.headerPos.height){s=this.headerPos.height}else{i-=s;i+=this.headerPos.height}BX.Grid.Utils.requestAnimationFrame(BX.proxy(function(){if(s!==this.lastPosTop){var t="translate3d(0px, "+s+"px, 0)";this.getEarLeft().style.transform=t;this.getEarRight().style.transform=t}if(i!==this.lastBottomPos){this.getEarLeft().style.height=i+"px";this.getEarRight().style.height=i+"px"}this.lastPosTop=s;this.lastBottomPos=i},this))},_onWindowScroll:function(){this.adjustEarOffset()},hasScroll:function(){return this.table.offsetWidth>this.container.clientWidth},hasScrollLeft:function(){return this.container.scrollLeft>0},hasScrollRight:function(){return this.table.offsetWidth>this.container.scrollLeft+this.container.clientWidth},showLeftEar:function(){BX.addClass(this.container.parentNode,this.parent.settings.get("classFadeContainerLeft"));BX.addClass(this.getEarLeft(),this.parent.settings.get("classShow"))},hideLeftEar:function(){BX.removeClass(this.container.parentNode,this.parent.settings.get("classFadeContainerLeft"));BX.removeClass(this.getEarLeft(),this.parent.settings.get("classShow"))},showRightEar:function(){BX.addClass(this.container.parentNode,this.parent.settings.get("classFadeContainerRight"));BX.addClass(this.getEarRight(),this.parent.settings.get("classShow"))},hideRightEar:function(){BX.removeClass(this.container.parentNode,this.parent.settings.get("classFadeContainerRight"));BX.removeClass(this.getEarRight(),this.parent.settings.get("classShow"))},adjustFixedTablePosition:function(){var t=this.container.scrollLeft;BX.Grid.Utils.requestAnimationFrame(BX.delegate(function(){this.fixedTable.style.transform="translate3d(-"+t+"px, 0px, 0)"},this))},toggle:function(){this.adjustEarOffset(true);this.fixedTable&&this.adjustFixedTablePosition();if(this.hasScroll()){this.hasScrollLeft()?this.showLeftEar():this.hideLeftEar();this.hasScrollRight()?this.showRightEar():this.hideRightEar()}else{this.hideLeftEar();this.hideRightEar()}}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:94:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/gridupdater.min.js?15113164722409";s:6:"source";s:75:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/gridupdater.js";s:3:"min";s:79:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/gridupdater.min.js";s:3:"map";s:79:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/gridupdater.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Grid");BX.Grid.Updater=function(t){this.parent=t};BX.Grid.Updater.prototype.getParent=function(){return this.parent};BX.Grid.Updater.prototype.updateHeadRows=function(t){var e;if(BX.type.isArray(t)&&t.length){e=this.getParent().getHeaders();e.forEach(function(e){e=BX.cleanNode(e);t.forEach(function(t){if(BX.type.isDomNode(t)){e.appendChild(BX.clone(t))}})})}};BX.Grid.Updater.prototype.appendHeadRows=function(t){var e;if(BX.type.isArray(t)&&t.length){e=this.getParent().getHeaders();e.forEach(function(e){t.forEach(function(t){if(BX.type.isDomNode(t)){e.appendChild(BX.clone(t))}})})}};BX.Grid.Updater.prototype.prependHeadRows=function(t){var e;if(BX.type.isArray(t)&&t.length){e=this.getParent().getHeaders();e.forEach(function(e){e=BX.cleanNode(e);t.forEach(function(t){if(BX.type.isDomNode(t)){e.prepend(BX.clone(t))}})})}};BX.Grid.Updater.prototype.updateBodyRowById=function(t,e){if((BX.type.isNumber(t)||BX.type.isNotEmptyString(t))&&BX.type.isDomNode(e)){var o=this.getParent().getRows().getById(t);if(o){var r=o.getNode();BX.insertAfter(e,r);BX.remove(r)}}};BX.Grid.Updater.prototype.updateBodyRows=function(t){if(BX.type.isArray(t)){var e=this.getParent().getBody();e.innerHTML="";t.forEach(function(t){!!t&&e.appendChild(t)})}};BX.Grid.Updater.prototype.appendBodyRows=function(t){var e;if(BX.type.isArray(t)){e=this.getParent().getBody();t.forEach(function(t){if(BX.type.isDomNode(t)){e.appendChild(t)}})}};BX.Grid.Updater.prototype.prependBodyRows=function(t){var e;if(BX.type.isArray(t)){e=this.getParent().getBody();t.forEach(function(t){if(BX.type.isDomNode(t)){BX.prepend(e,t)}})}};BX.Grid.Updater.prototype.updateFootRows=function(t){var e;if(BX.type.isArray(t)){e=BX.cleanNode(this.getParent().getFoot());t.forEach(function(t){if(BX.type.isDomNode(t)){e.appendChild(t)}})}};BX.Grid.Updater.prototype.updateCounterTotal=function(t){var e;if(BX.type.isDomNode(t)){e=BX.cleanNode(this.getParent().getCounterTotal());e.appendChild(t)}};BX.Grid.Updater.prototype.updatePagination=function(t){var e=this.getParent().getPagination().getContainer();if(!!e){e.innerHTML="";if(BX.type.isDomNode(t)){e.appendChild(t)}}};BX.Grid.Updater.prototype.updateMoreButton=function(t){if(BX.type.isDomNode(t)){var e=BX.Grid.Utils.closestParent(this.getParent().getMoreButton().getNode());e.innerHTML="";e.appendChild(t)}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:96:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/inline-editor.min.js?15113164724423";s:6:"source";s:77:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/inline-editor.js";s:3:"min";s:81:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/inline-editor.min.js";s:3:"map";s:81:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/inline-editor.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Grid");BX.Grid.InlineEditor=function(t,e){this.parent=null;this.types=null;this.init(t,e)};BX.Grid.InlineEditor.prototype={init:function(parent,types){this.parent=parent;try{this.types=eval(types)}catch(err){this.types=null}},createContainer:function(){return BX.create("div",{props:{className:this.parent.settings.get("classEditorContainer")}})},createTextarea:function(t,e){var n=BX.create("textarea",{props:{className:[this.parent.settings.get("classEditor"),this.parent.settings.get("classEditorTextarea")].join(" ")},attrs:{name:t.NAME,style:"height:"+e+"px"},html:t.VALUE});return n},createInput:function(t){var e=this.parent.settings.get("classEditorText");var n={value:t.VALUE!==undefined&&t.VALUE!==null?BX.util.htmlspecialcharsback(t.VALUE):"",name:t.NAME!==undefined&&t.NAME!==null?t.NAME:""};if(t.TYPE===this.types.CHECKBOX){e=[e,this.parent.settings.get("classEditorCheckbox")].join(" ");n.type="checkbox";n.checked=n.value=="Y"}if(t.TYPE===this.types.DATE){e=[e,this.parent.settings.get("classEditorDate")].join(" ")}if(t.TYPE===this.types.NUMBER){e=[e,this.parent.settings.get("classEditorNumber")].join(" ");n.type="number"}if(t.TYPE===this.types.RANGE){e=[e,this.parent.settings.get("classEditorRange")].join(" ");n.type="range";if(BX.type.isPlainObject(t.DATA)){n.min=t.DATA.MIN||"0";n.max=t.DATA.MAX||99999;n.step=t.DATA.STEP||""}}e=[this.parent.settings.get("classEditor"),e].join(" ");return BX.create("input",{props:{className:e,id:t.NAME+"_control"},attrs:n})},createOutput:function(t){return BX.create("output",{props:{className:this.parent.settings.get("classEditorOutput")||""},attrs:{"for":t.NAME+"_control"},text:t.VALUE||""})},getDropdownValueItemByValue:function(t,e){var n=t.filter(function(t){return t.VALUE===e});return n.length>0?n[0]:t[0]},createDropdown:function(t){var e=this.getDropdownValueItemByValue(t.DATA.ITEMS,t.VALUE);return BX.create("div",{props:{className:[this.parent.settings.get("classEditor"),"main-dropdown main-grid-editor-dropdown"].join(" "),id:t.NAME+"_control"},attrs:{name:t.NAME,"data-items":JSON.stringify(t.DATA.ITEMS),"data-value":e.VALUE},children:[BX.create("span",{props:{className:"main-dropdown-inner"},html:e.NAME})]})},validateEditObject:function(t){return BX.type.isPlainObject(t)&&"TYPE"in t&&"NAME"in t&&"VALUE"in t},initCalendar:function(t){BX.calendar({node:t.target,field:t.target})},bindOnRangeChange:function(t,e){function n(t,e){BX.html(e,t.value);var n=parseFloat(t.value);var i=parseFloat(t.getAttribute("max"));var a=parseFloat(t.getAttribute("min"));var s=16;var r=i-a;var o=(n-a)/r*100;var c=Math.round(s*o/100)-s/2;e.style.left=o+"%";e.style.marginLeft=-c+"px"}setTimeout(function(){n(t,e)},0);BX.bind(t,"input",function(){n(t,e)})},getEditor:function(t,e){var n,i;var a=this.createContainer();if(this.validateEditObject(t)){t.VALUE=t.VALUE===null?"":t.VALUE;switch(t.TYPE){case this.types.TEXT:{n=this.createInput(t);BX.bind(n,"click",function(t){t.stopPropagation()});BX.bind(n,"keydown",BX.delegate(this._onControlKeydown,this));break}case this.types.DATE:{n=this.createInput(t);BX.bind(n,"click",this.initCalendar);BX.bind(n,"click",function(t){t.stopPropagation()});BX.bind(n,"keydown",BX.delegate(this._onControlKeydown,this));break}case this.types.NUMBER:{n=this.createInput(t);BX.bind(n,"click",function(t){t.stopPropagation()});BX.bind(n,"keydown",BX.delegate(this._onControlKeydown,this));break}case this.types.RANGE:{n=this.createInput(t);i=this.createOutput(t);this.bindOnRangeChange(n,i);BX.bind(n,"click",function(t){t.stopPropagation()});BX.bind(n,"keydown",BX.delegate(this._onControlKeydown,this));break}case this.types.CHECKBOX:{n=this.createInput(t);BX.bind(n,"click",function(t){t.stopPropagation()});BX.bind(n,"keydown",BX.delegate(this._onControlKeydown,this));break}case this.types.TEXTAREA:{n=this.createTextarea(t,e);BX.bind(n,"click",function(t){t.stopPropagation()});BX.bind(n,"keydown",BX.delegate(this._onControlKeydown,this));break}case this.types.DROPDOWN:{n=this.createDropdown(t);break}default:{break}}}if(BX.type.isDomNode(i)){a.appendChild(i)}if(BX.type.isDomNode(n)){a.appendChild(n)}return a},_onControlKeydown:function(t){if(t.code==="Enter"){t.stopPropagation();t.preventDefault();var e=BX.Grid.Utils.getBySelector(this.parent.getContainer(),"#grid_save_button > button",true);if(e){BX.fireEvent(e,"click")}}}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:89:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/loader.min.js?15113164722372";s:6:"source";s:70:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/loader.js";s:3:"min";s:74:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/loader.min.js";s:3:"map";s:74:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/loader.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Grid");BX.Grid.Loader=function(t){this.parent=null;this.container=null;this.windowHeight=null;this.tbodyPos=null;this.headerPos=null;this.lastPosTop=null;this.lastBottomPos=null;this.table=null;this.init(t)};BX.Grid.Loader.prototype={init:function(t){this.parent=t;this.table=this.parent.getTable();BX.bind(this.getContainer(),"animationend",BX.proxy(this._onAnimationEnd,this));BX.bind(this.getContainer(),"webkitAnimationEnd",BX.proxy(this._onAnimationEnd,this));BX.bind(this.getContainer(),"oanimationend",BX.proxy(this._onAnimationEnd,this));BX.bind(this.getContainer(),"MSAnimationEnd",BX.proxy(this._onAnimationEnd,this))},adjustLoaderOffset:function(){this.windowHeight=BX.height(window);this.tbodyPos=BX.pos(this.table.tBodies[0]);this.headerPos=BX.pos(this.table.tHead);var t=window.scrollY;if(this.parent.isIE()){t=document.documentElement.scrollTop}var i=t+this.windowHeight-this.tbodyPos.top;var s=t-this.tbodyPos.top;if(i>this.tbodyPos.bottom-this.tbodyPos.top){i=this.tbodyPos.bottom-this.tbodyPos.top}if(s<this.headerPos.height){s=this.headerPos.height}else{i-=s;i+=this.headerPos.height}BX.Grid.Utils.requestAnimationFrame(BX.proxy(function(){if(s!==this.lastPosTop){this.getContainer().style.transform="translate3d(0px, "+s+"px, 0)"}if(i!==this.lastBottomPos){this.getContainer().style.height=i+"px"}this.lastPosTop=s;this.lastBottomPos=i},this))},getContainer:function(){if(!this.container){this.container=BX.Grid.Utils.getByClass(this.parent.getContainer(),this.parent.settings.get("classLoader"),true)}return this.container},show:function(){var t=this.getContainer();this.adjustLoaderOffset();BX.style(t,"display","block");BX.removeClass(t,this.parent.settings.get("classLoaderHide"));setTimeout(BX.delegate(function(){BX.addClass(t,this.parent.settings.get("classLoaderShow"))},this),0)},hide:function(){var t=this.getContainer();BX.removeClass(t,this.parent.settings.get("classLoaderShow"));BX.addClass(t,this.parent.settings.get("classLoaderHide"))},_onAnimationEnd:function(t){if("animationName"in t&&t.animationName&&t.animationName===this.parent.settings.get("loaderHideAnimationName")){var i=this.getContainer();BX.removeClass(i,this.parent.settings.get("classLoaderShow"));BX.removeClass(i,this.parent.settings.get("classLoaderHide"));BX.style(i,"display","")}}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:89:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/manager.min.js?1511316472903";s:6:"source";s:71:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/manager.js";s:3:"min";s:75:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/manager.min.js";s:3:"map";s:75:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/manager.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Main");if(BX.Main.gridManager){return}BX.Main.gridManager={data:[],push:function(t,n){if(BX.type.isNotEmptyString(t)&&n){var i={id:t,instance:n,old:null};if(this.getById(t)===null){this.data.push(i)}else{this.data[0]=i}}},getById:function(t){var n=this.data.filter(function(n){return n.id===t||n.id.replace("main_grid_","")===t});return n.length===1?n[0]:null},getInstanceById:function(t){var n=this.getById(t);return BX.type.isPlainObject(n)?n["instance"]:null},reload:function(t,n){var i=this.getInstanceById(t);if(i){i.reload(n)}},getDataIndex:function(t){var n=null;this.data.forEach(function(i,a){if(i.id===t){n=a}});return n},destroy:function(t){if(BX.type.isNotEmptyString(t)){var n=this.getInstanceById(t);if(n instanceof BX.Main.grid){n.destroy();var i=this.getDataIndex(t);if(i!==null){delete this.data[i]}}}}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:90:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/message.min.js?15113164721571";s:6:"source";s:71:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/message.js";s:3:"min";s:75:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/message.min.js";s:3:"map";s:75:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/message.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Grid");BX.Grid.Message=function(t,e){this.parent=null;this.types=null;this.messages=null;this.popup=null;this.init(t,e)};BX.Grid.Message.prototype={init:function(t,e){this.parent=t;this.types=e;this.show();BX.addCustomEvent("BX.Main.grid:paramsUpdated",BX.proxy(this.onUpdated,this))},onUpdated:function(){this.show()},getData:function(){return this.parent.arParams.MESSAGES},isNeedShow:function(){return this.getData().length>0},show:function(){if(this.isNeedShow()){this.getPopup().setContent(this.getContent());this.getPopup().show()}},getContent:function(){var t=this.getData();var e=null;if(BX.type.isArray(t)&&t.length){var n={block:"main-grid-messages",content:[]};t.forEach(function(t){var e={block:"main-grid-message",mix:"main-grid-message-"+t.TYPE.toLowerCase(),content:[]};if(BX.type.isNotEmptyString(t.TITLE)){e.content.push({block:"main-grid-message-title",content:t.TITLE})}if(BX.type.isNotEmptyString(t.TEXT)){e.content.push({block:"main-grid-message-text",content:t.TEXT})}n.content.push(e)});e=BX.decl(n)}return e},getPopup:function(){if(this.popup===null){this.popup=new BX.PopupWindow(this.getPopupId(),null,{autoHide:true,overlay:.3,width:400,contentNoPaddings:true,closeByEsc:true,buttons:[new BX.PopupWindowButton({text:this.parent.getParam("CLOSE"),className:"webform-small-button-blue webform-small-button",events:{click:function(){this.popupWindow.close()}}})]})}return this.popup},getPopupId:function(){return this.parent.getContainerId()+"-main-grid-message"}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:90:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/observer.min.js?1511316472175";s:6:"source";s:72:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/observer.js";s:3:"min";s:76:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/observer.min.js";s:3:"map";s:76:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/observer.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Grid");BX.Grid.observer={handlers:[],add:function(n,r,d,e){BX.bind(n,r,e?BX.proxy(d,e):d)}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:91:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/oldgrid.min.js?151131647237682";s:6:"source";s:71:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/oldgrid.js";s:3:"min";s:75:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/oldgrid.min.js";s:3:"map";s:75:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/oldgrid.map.js";}"*/
function BxUniversalGrid(e){"use strict";this.oColsMeta={};this.oColsNames={};this.customNames={};this.columnsSizes={};this.oEditData={};this.oSaveData={};this.oOptions={};this.oVisibleCols={};this.vars={};this.menu=null;this.settingsMenu=[];this.filterMenu=[];this.checkBoxCount=0;this.bColsChanged=false;this.bViewsChanged=false;this.oFilterRows={};this.activeRow=null;this.hasActions=false;this.editMode=false;this.resizeMeta={};this.table_id=e+"_table";this.grid_id=e;var t=this;var i=null;var s=false;this.InitTable=function(){i=BX.Main.gridManager.getById(t.grid_id).instance;this.checkBoxCount=0;var e=i.getTable();if(!e||e.rows.length<1||e.rows[0].cells.length<1){return}var s=e.rows[0].cells;for(var a=0;a<s.length;a++){if(BX.hasClass(s[a],"main-grid-cell-action")||BX.hasClass(s[a],"main-grid-cell-checkbox")){s[a].__fixed=true;continue}var n=BX.findChildByClassName(s[a],"main-grid-cell-head-container",false);BX.addClass(n,"main-grid-cell-head-dragable");BX.removeClass(s[a],"main-grid-cell-sortable")}this.initResizeMeta();this.toogleFader();BX.bind(window,"resize",BX.delegate(this.toogleFader,this));BX.bind(e.parentNode,"scroll",this.toogleFader);if(i.getParam("ALLOW_COLUMNS_RESIZE")){for(var a=0;a<s.length;a++){if(s[a].__fixed){continue}var l=BX.findChildByClassName(s[a],"main-grid-resize-button");if(l){l.onbxdragstart=t.resizeColumnStart;l.onbxdragstop=t.resizeColumnStop;l.onbxdrag=t.resizeColumn;jsDD.registerObject(l)}}var r=function(){var e=i.getPinHeader().getFixedTable();var s=BX.findChild(e,{"class":"main-grid-resize-button"},true,true);s.forEach(function(e){e.onbxdragstart=t.resizeColumnStart;e.onbxdragstop=t.resizeColumnStop;e.onbxdrag=t.resizeColumn;jsDD.registerObject(e)})};BX.addCustomEvent(window,"Grid::headerPinned",r);BX.addCustomEvent(window,"Grid::updated",r)}};this.CheckColumn=function(e,t){var s;var a=this.menu.GetMenuByItemId(t.id);var n=!(a.GetItemInfo(t).ICON=="checked");a.SetItemIcon(t,n?"checked":"");if(e){s=i.getUserOptions().getCurrentOptions().columns.split(",");if(BX.type.isArray(s)&&BX.type.isNotEmptyString(e)){if(s.some(function(t){return t===e})){s=s.filter(function(t){return t!==e});BX.removeClass("menu_"+i.getContainerId()+"_columns_item_","checked")}else{s.unshift(e);BX.addClass("menu_"+i.getContainerId()+"_columns_item_","checked")}}i.tableFade();i.getUserOptions().setColumns(s,function(){i.reloadTable();BX.onCustomEvent(i.getContainer(),"Grid::columnsChanged",[i])})}};this.reinitColumnSize=function(e,t){var i=this.GetColumnId(e);if(i!==false){var s=BX(this.table_id);var a=s.offsetWidth;var n=s.rows[0].cells[i];var l=BX.findChildByClassName(n,"main-grid-cell-head-container",false);l.style.height="";BX.removeClass(l,"main-grid-cell-head-dragable");n.style.width="";n.style.width=n.offsetWidth+"px";BX.addClass(l,"main-grid-cell-head-dragable");l.style.height=s.rows[0].cells[0].clientHeight+"px";if(t){n.setAttribute("data-resize",1)}}};this.initResizeMeta=function(){var e=i.getTable();var t=e.rows[0].cells;this.resizeMeta.fixed=0;this.resizeMeta.minPx=e.offsetWidth;var s=false;for(var a=0;a<t.length;a++){var n=BX.width(t[a]);if(t[a].__fixed){this.resizeMeta.fixed+=n;continue}if(n>0){var l=t[a].getAttribute("data-name");if(this.resizeMeta.columns[l]!=n){s=true}this.resizeMeta.columns[l]=n}}if(s){this.resizeMeta.expand=1}};this.reinitResizeMeta=function(){var e=BX(t.table_id);var i=e.rows[0].cells;for(var s=0;s<i.length;s++){if(i[s].__fixed){continue}if(i[s].offsetWidth>0){var a=i[s].getAttribute("data-name");t.resizeMeta.columns[a]=i[s].offsetWidth}}var n=e.offsetWidth;var l=e.parentNode.clientWidth;t.resizeMeta.minPx=n;t.resizeMeta.expand=n<l?n/l:1;t.saveColumnsSizes()};this.toogleFader=function(){var e=BX.Main.gridManager.getById(t.grid_id).instance;var i=e.getTable();var s=e.getScrollContainer();if(i.offsetWidth>s.clientWidth){if(s.scrollLeft>0){BX.addClass(s.parentNode,"main-grid-fade-left")}else{BX.removeClass(s.parentNode,"main-grid-fade-left")}if(i.offsetWidth>s.scrollLeft+s.clientWidth){BX.addClass(s.parentNode,"main-grid-fade-right")}else{BX.removeClass(s.parentNode,"main-grid-fade-right")}}else{BX.removeClass(s.parentNode,"main-grid-fade-left");BX.removeClass(s.parentNode,"main-grid-fade-right")}};this.OnRowContext=function(e){if(!t.menu){return}if(!e){e=window.event}if(!phpVars.opt_context_ctrl&&e.ctrlKey||phpVars.opt_context_ctrl&&!e.ctrlKey){return}var i;if(e.target){i=e.target}else if(e.srcElement){i=e.srcElement}var s=i;while(s&&!(s.tagName&&s.tagName.match(/(th|td)/i)&&s.oncontextmenu)){s=BX.findParent(s,{tagName:/(th|td)/i})}var a=null;if(s&&s.oncontextmenu){a=s.oncontextmenu();a[a.length]={SEPARATOR:true}}s=i;while(s&&!(s.tagName&&s.tagName.toUpperCase()==="TR"&&s.oncontextmenu)){s=jsUtils.FindParentObject(s,"tr")}var n=t.menu;n.PopupHide();t.activeRow=s;if(t.activeRow&&!BX.hasClass(s,"main-grid-row-head")){t.activeRow.className+=" active"}n.OnClose=function(){if(t.activeRow){t.activeRow.className=t.activeRow.className.replace(/\s*active/i,"");t.activeRow=null}};var l=BX.util.array_merge(a,s.oncontextmenu());if(l.length==0){return}n.SetItems(l);n.BuildItems();var r=jsUtils.GetWindowScrollPos();var o=e.clientX+r.scrollLeft;var d=e.clientY+r.scrollTop;var h={};h.left=h.right=o;h.top=h.bottom=d;n.PopupShow(h);e.returnValue=false;if(e.preventDefault){e.preventDefault()}};this.ShowActionMenu=function(e,i){t.menu.PopupHide();t.activeRow=jsUtils.FindParentObject(e,"tr");if(t.activeRow){t.activeRow.className+=" active"}var s=BX("datarow_"+this.table_id+"_"+i);var a=BX.data(s,"actions");if(s&&a){var n=JSON.parse(a);if(n&&n.length>0){t.menu.ShowMenu(e,n,false,false,function(){if(t.activeRow){t.activeRow.className=t.activeRow.className.replace(/\s*active/i,"");t.activeRow=null}})}}};this.SelectRow=function(e,t){t=t?t:window.event;var i=BX.findParent(e,{className:"main-grid-row"});var a=document.getElementById(this.table_id+"_selected_span");var n=parseInt(a.innerHTML);var l=[i];if(t&&t.shiftKey&&s&&s!==i){var r=document.getElementById(this.table_id);for(var o=Math.min(s.rowIndex,i.rowIndex)+1;o<Math.max(s.rowIndex,i.rowIndex);o++){l.push(r.rows[o])}if(BX.findChildByClassName(s.cells[0],"main-grid-checkbox").checked){l.push(s)}}for(var o in l){var d=BX.findChildByClassName(l[o].cells[0],"main-grid-checkbox");if(d&&(e===d||d.checked!==e.checked)){d.checked=e.checked;if(e.checked){BX.addClass(l[o],"main-grid-row-checked");n++}else{BX.removeClass(l[o],"main-grid-row-checked");n--}}}a.innerHTML=n.toString();var h=BX(this.table_id+"_check_all");h.checked=this.checkBoxCount>0&&n===this.checkBoxCount;s=i};this.SelectAllRows=function(e){};this.EnableActions=function(){var e=document.forms["form_"+this.table_id];if(!e)return;var t=this.IsActionEnabled();var i=this.IsActionEnabled("edit");var s=BX("edit_button_"+this.table_id);var a=BX("delete_button_"+this.table_id);if(e.apply){e.apply.disabled=!t;BX[t?"removeClass":"addClass"](e.apply,"webform-button-disable")}if(s)BX[i?"removeClass":"addClass"](s,"main-grid-control-panel-action-icon-disable");if(a)BX[t?"removeClass":"addClass"](a,"main-grid-control-panel-action-icon-disable")};this.IsActionEnabled=function(e){var t=document.forms["form_"+this.table_id];if(!t)return;var i=false;var s=document.getElementById(this.table_id+"_selected_span");if(s&&parseInt(s.innerHTML)>0)i=true;var a=t["action_all_rows_"+this.table_id];if(e=="edit")return!(a&&a.checked)&&i;else return a&&a.checked||i};this.SwitchActionButtons=function(e){var t=BX("bx_grid_"+this.table_id+"_action_buttons");var i=t;while(i=jsUtils.FindNextSibling(i,"div"))i.style.display=e?"none":"";t.style.display=e?"":"none"};this.ActionEdit=function(){if(this.IsActionEnabled("edit")){var e=document.forms["form_"+this.table_id];if(!e)return;this.editMode=true;this.SwitchActionButtons(true);var i=e["ID[]"];if(!i.length)i=new Array(i);for(var s=0;s<i.length;s++){var a=i[s];if(a.checked){var n=jsUtils.FindParentObject(a,"tr");BX.denyEvent(n,"dblclick");var l=jsUtils.FindParentObject(a,"td");l=jsUtils.FindNextSibling(l,"td");if(BX.hasClass(l,"main-grid-cell-action"))l=jsUtils.FindNextSibling(l,"td");var r=a.value;this.oSaveData[r]={};for(var o in this.oVisibleCols){if(this.oVisibleCols[o]==true&&this.oColsMeta[o].editable==true&&this.oEditData[r][o]!==false){this.oSaveData[r][o]=l.innerHTML;l.innerHTML="";var d=this.oEditData[r][o];var h="FIELDS["+r+"]["+o+"]";var c=BX.create("SPAN",{props:{className:"main-grid-cell-content"}});switch(this.oColsMeta[o].type){case"checkbox":c.appendChild(BX.create("INPUT",{props:{type:"hidden",name:h,value:"N"}}));c.appendChild(BX.create("INPUT",{props:{className:"main-grid-cell-content-edit",type:"checkbox",name:h,value:"Y",checked:d=="Y",defaultChecked:d=="Y"}}));break;case"list":var f=[];for(var v in this.oColsMeta[o].items){f[f.length]=BX.create("OPTION",{props:{value:v,selected:v==d},text:this.oColsMeta[o].items[v]})}c.appendChild(BX.create("SELECT",{props:{className:"main-grid-cell-content-edit",name:h},children:f}));break;case"date":var _={props:{className:"main-grid-cell-content-edit",type:"text",name:h,value:d,size:this.oColsMeta[o].size?this.oColsMeta[o].size:20},style:{paddingRight:"20px"}};if(this.oColsMeta[o].size)_.props.size=this.oColsMeta[o].size;else _.style.width="100%";c.appendChild(BX.create("INPUT",_));c.appendChild(BX.create("A",{props:{href:"javascript:void(0);",title:this.vars.mess.calend_title},style:{border:"none",position:"relative",right:"22px"},children:[BX.create("IMG",{props:{className:"calendar-icon",src:this.vars.calendar_image,alt:this.vars.mess.calend_title,onclick:function(e){return function(){BX.calendar({node:this,field:e,bTime:true,currentTime:t.vars.server_time})}}(h),onmouseover:function(){BX.addClass(this,"calendar-icon-hover")},onmouseout:function(){BX.removeClass(this,"calendar-icon-hover")}}})]}));BX.addClass(c,"main-grid-cell-text-line");break;case"textarea":var _={props:{className:"main-grid-cell-content-edit",name:h},text:d};if(this.oColsMeta[o].cols)_.props.cols=this.oColsMeta[o].cols;else _.style={width:"100%"};if(this.oColsMeta[o].rows)_.props.rows=this.oColsMeta[o].rows;if(this.oColsMeta[o].maxlength)_.props.maxLength=this.oColsMeta[o].maxlength;c.appendChild(BX.create("TEXTAREA",_));break;case"file":c.appendChild(BX.create("INPUT",{props:{className:"main-grid-cell-content-edit",type:"file",name:h}}));break;default:var _={props:{className:"main-grid-cell-content-edit",type:"text",name:h,value:d}};if(this.oColsMeta[o].size)_.props.size=this.oColsMeta[o].size;else _.style={width:"100%"};if(this.oColsMeta[o].maxlength)_.props.maxLength=this.oColsMeta[o].maxlength;c.appendChild(BX.create("INPUT",_));break}l.appendChild(c)}l=jsUtils.FindNextSibling(l,"td")}}a.disabled=true}BX(this.table_id+"_check_all").disabled=true;e.elements["action_button_"+this.table_id].value="edit"}};this.ActionCancel=function(){var e=document.forms["form_"+this.table_id];if(!e)return;this.editMode=false;this.SwitchActionButtons(false);var t=e["ID[]"];if(!t.length)t=new Array(t);for(var i=0;i<t.length;i++){var s=t[i];if(s.checked){var a=jsUtils.FindParentObject(s,"tr");BX.allowEvent(a,"dblclick");var n=jsUtils.FindParentObject(s,"td");n=jsUtils.FindNextSibling(n,"td");if(BX.hasClass(n,"main-grid-cell-action"))n=jsUtils.FindNextSibling(n,"td");var l=s.value;for(var r in this.oVisibleCols){if(typeof this.oSaveData[l][r]!="undefined")n.innerHTML=this.oSaveData[l][r];n=jsUtils.FindNextSibling(n,"td")}}}this.toggleCheckboxes();e.elements["action_button_"+this.table_id].value=""};this.ActionDelete=function(){var e=document.forms["form_"+this.table_id];if(!e)return;e.elements["action_button_"+this.table_id].value="delete";BX.submit(e)};this.ForAllClick=function(e){if(e.checked&&!confirm(this.vars.mess.for_all_confirm)){e.checked=false;return}var t=e.form["ID[]"];if(t){if(!t.length)t=new Array(t);for(var i=0;i<t.length;i++){if(t[i].getAttribute("data-disabled"))continue;t[i].disabled=e.checked}}BX(this.table_id+"_check_all").disabled=e.checked;this.editMode=e.checked;this.EnableActions()};this.Sort=function(e,i,s,a,n){var l;if(s==""){var r=null,o=false;if(n.length>0)r=n[0];if(!r)r=window.event;if(r)o=r.ctrlKey;l=o?a=="acs"?"desc":"asc":a}else if(s=="asc")l="desc";else l="asc";e+=l;BX.ajax.get("/bitrix/components"+t.vars.component_path+"/settings.ajax.php?GRID_ID="+t.table_id+"&action=savesort&by="+i+"&order="+l+"&sessid="+t.vars.sessid,function(){t.Reload(e)})};this.GetColumnId=function(e){var t=false;var i=BX(this.table_id);for(var s=0;s<i.rows[0].cells.length;s++){if(i.rows[0].cells[s].getAttribute("data-name")==e){t=s;break}}return t};this.animation=function(e,i,s,a){t.animation.stop(e);var n=function(){e.__animation.step++;var i=e.__animation;for(var s in i.props){var a=i.props[s];e.style[s]=a.from*1+(a.to-a.from)*i.step/i.steps+a.unit}if(i.step>=i.steps)t.animation.stop(e)};e.__animation={props:i,steps:Math.round(s/10),step:0,callback:a};e.__animation.interval=setInterval(n,s/e.__animation.steps)};this.animation.stop=function(e){if(e.__animation&&e.__animation.interval){e.__animation.interval=clearInterval(e.__animation.interval);if(e.__animation.callback)e.__animation.callback()}};this.toogleColumnCells=function(e,i,s){var a=BX(t.table_id);for(var n=0;n<a.rows.length;n++){var l=a.rows[n].cells;if(l[e]){l[e].style.display=i?"":"none";var r=BX.findChildByClassName(l[e],"main-grid-cell-content",false);if(r&&r.style)r.style.width=s?r.clientWidth+"px":""}}};this.toggleCheckboxes=function(){var e=BX(this.table_id);for(var t=1;t<e.rows.length;t++){if(BX.hasClass(e.rows[t],"main-grid-data-row")){var i=BX.findChildByClassName(e.rows[t].cells[0],"main-grid-checkbox");var s=i.value;var a=false;if(this.hasActions){if(!i.getAttribute("data-disabled"))a=true}else if(typeof this.oEditData[s]!="undefined"){for(var n in this.oVisibleCols){if(this.oVisibleCols[n]&&this.oColsMeta[n].editable&&this.oEditData[s][n]!==false)a=true}}if(a){if(i.getAttribute("data-disabled"))this.checkBoxCount++;i.disabled=this.editMode;i.removeAttribute("data-disabled")}else{if(!i.getAttribute("data-disabled"))this.checkBoxCount--;i.disabled=true;i.setAttribute("data-disabled",1)}}}if(this.checkBoxCount==0){BX(this.table_id+"_check_all").disabled=true;if(!this.editMode){for(var t=1;t<e.rows.length;t++){if(BX.hasClass(e.rows[t],"main-grid-data-row")){var i=BX.findChildByClassName(e.rows[t].cells[0],"main-grid-checkbox");if(i.checked){i.checked=false;this.SelectRow(i)}}}BX(this.table_id+"_action_bar_fade").style.display=""}}else{if(!this.editMode)BX(this.table_id+"_check_all").disabled=false;BX(this.table_id+"_action_bar_fade").style.display="none"}};this.SaveColumns=function(e,i){var s="";if(e){s=e}else{if(!t.bColsChanged)return;for(var a in t.oVisibleCols)if(t.oVisibleCols[a])s+=(s!=""?",":"")+a}t.oOptions.views[t.oOptions.current_view].columns=s;if(t.vars.user_authorized){BX.ajax.get("/bitrix/components"+t.vars.component_path+"/settings.ajax.php",{GRID_ID:t.table_id,action:"showcolumns",columns:s,sessid:t.vars.sessid},i)}};this.saveColumnsSizes=function(){i.getUserOptions().setColumnSizes(t.resizeMeta.columns,t.resizeMeta.expand)};this.Reload=function(e){var i=BX.Main.gridManager.getById(t.grid_id).instance;var s=i.getScrollContainer();var a;jsDD.Disable();if(!e){e=this.vars.current_url[this.vars.current_url.length-1]}if(this.vars.ajax.AJAX_ID!=""){a=BX.ajax.insertToNode(e+(e.indexOf("?")==-1?"?":"&")+"bxajaxid="+this.vars.ajax.AJAX_ID,"comp_"+this.vars.ajax.AJAX_ID);a.onprogress=function(){t.scrollContainerLeft=s.scrollLeft};a.onload=function(){i.getScrollContainer().scrollLeft=t.scrollContainerLeft;i.reloadTable()}}else{window.location=e}};this.SetView=function(e){var i=t.oOptions.views[e].saved_filter;var s=i&&t.oOptions.filters[i]?function(){t.ApplyFilter(i)}:function(){t.Reload()};BX.ajax.get("/bitrix/components"+t.vars.component_path+"/settings.ajax.php?GRID_ID="+t.table_id+"&action=setview&view_id="+e+"&sessid="+t.vars.sessid,s)};this.EditCurrentView=function(){this.ShowSettings(this.oOptions.views[this.oOptions.current_view],function(){t.SaveSettings(t.oOptions.current_view,true)})};this.AddView=function(){var e="view_"+Math.round(Math.random()*1e6);var i={};for(var s in this.oOptions.views[this.oOptions.current_view])i[s]=this.oOptions.views[this.oOptions.current_view][s];i.name=this.vars.mess.viewsNewView;this.ShowSettings(i,function(){var i=t.SaveSettings(e);t.oOptions.views[e]={name:i.name,columns:i.columns,sort_by:i.sort_by,sort_order:i.sort_order,page_size:i.page_size,saved_filter:i.saved_filter,custom_names:i.custom_names,columns_sizes:i.columns_sizes};t.bViewsChanged=true;var s=document["views_"+t.table_id];s.views_list.options[s.views_list.length]=new Option(i.name!=""?i.name:t.vars.mess.viewsNoName,e,true,true)})};this.EditView=function(e){this.ShowSettings(this.oOptions.views[e],function(){var i=t.SaveSettings(e);t.oOptions.views[e]={name:i.name,columns:i.columns,sort_by:i.sort_by,sort_order:i.sort_order,page_size:i.page_size,saved_filter:i.saved_filter,custom_names:i.custom_names,columns_sizes:i.columns_sizes};t.bViewsChanged=true;var s=document["views_"+t.table_id];s.views_list.options[s.views_list.selectedIndex].text=i.name!=""?i.name:t.vars.mess.viewsNoName})};this.DeleteView=function(e){if(!confirm(this.vars.mess.viewsDelete))return;var i=document["views_"+this.table_id];var s=i.views_list.selectedIndex;i.views_list.remove(s);i.views_list.selectedIndex=s<i.views_list.length?s:i.views_list.length-1;this.bViewsChanged=true;BX.ajax.get("/bitrix/components"+this.vars.component_path+"/settings.ajax.php?GRID_ID="+this.table_id+"&action=delview&view_id="+e+"&sessid="+t.vars.sessid)};this.ShowSettings=function(e,t){var i=false;if(!window["settingsDialog"+this.table_id]){window["settingsDialog"+this.table_id]=new BX.CDialog({content:'<form name="settings_'+this.table_id+'"></form>',title:this.vars.mess.settingsTitle,width:this.vars.settingWndSize.width,height:this.vars.settingWndSize.height,resize_id:"InterfaceGridSettingWnd"});i=true}window["settingsDialog"+this.table_id].ClearButtons();window["settingsDialog"+this.table_id].SetButtons([{title:this.vars.mess.settingsSave,action:function(){t();this.parentWindow.Close()}},BX.CDialog.prototype.btnCancel]);window["settingsDialog"+this.table_id].Show();var s=document["settings_"+this.table_id];if(i)s.appendChild(BX("view_settings_"+this.table_id));this.customNames=e.custom_names?e.custom_names:{};this.columnsSizes=e.columns_sizes?e.columns_sizes:{};s.view_name.focus();s.view_name.value=e.name;var a=[];if(e.columns!=""){a=e.columns.split(",")}else{for(var n in this.oVisibleCols){if(this.oVisibleCols[n])a[a.length]=n}}var l={},r;for(n=0,r=a.length;n<r;n++)l[a[n]]=true;jsSelectUtils.deleteAllOptions(s.view_all_cols);for(n in this.oColsNames){if(!l[n]){var o=this.customNames[n]?this.customNames[n]+" ("+this.oColsNames[n]+")":this.oColsNames[n];s.view_all_cols.options[s.view_all_cols.length]=new Option(o,n,false,false)}}jsSelectUtils.deleteAllOptions(s.view_cols);for(n in l){o=this.customNames[n]?this.customNames[n]+" ("+this.oColsNames[n]+")":this.oColsNames[n];s.view_cols.options[s.view_cols.length]=new Option(o,n,false,false)}s.reset_columns_sizes.checked=false;jsSelectUtils.selectOption(s.view_sort_by,e.sort_by);jsSelectUtils.selectOption(s.view_sort_order,e.sort_order);jsSelectUtils.selectOption(s.view_page_size,e.page_size);jsSelectUtils.deleteAllOptions(s.view_filters);s.view_filters.options[0]=new Option(this.vars.mess.viewsFilter,"");for(n in this.oOptions.filters)s.view_filters.options[s.view_filters.length]=new Option(this.oOptions.filters[n].name,n,n==e.saved_filter,n==e.saved_filter);if(s.set_default_settings){s.set_default_settings.checked=false;s.delete_users_settings.checked=false;s.delete_users_settings.disabled=true}s.up_btn.disabled=s.down_btn.disabled=s.rename_btn.disabled=s.add_btn.disabled=s.del_btn.disabled=true};this.RenameColumn=function(){var e=false;if(!window["renameDialog"+this.table_id]){window["renameDialog"+this.table_id]=new BX.CDialog({content:'<form name="rename_'+this.table_id+'"></form>',title:this.vars.mess.renameTitle,width:this.vars.renameWndSize.width,height:this.vars.renameWndSize.height,resize_id:"InterfaceGridRenameWnd",buttons:[{title:this.vars.mess.settingsSave,action:function(){var e=s.view_cols.value;var a=i.col_name.value;if(a.length>0){t.customNames[e]=a;a=a+" ("+t.oColsNames[e]+")"}else{a=t.oColsNames[e];delete t.customNames[e]}s.view_cols.options[s.view_cols.selectedIndex].text=a;this.parentWindow.Close()}},BX.CDialog.prototype.btnCancel]});e=true}window["renameDialog"+this.table_id].Show();var i=document["rename_"+this.table_id];var s=document["settings_"+this.table_id];if(e)i.appendChild(BX("rename_column_"+this.table_id));var a=s.view_cols.value;i.col_name.focus();i.col_name_def.value=this.oColsNames[a];i.col_name.value=this.customNames[a]?this.customNames[a]:this.oColsNames[a]};this.SaveSettings=function(e,s){var a=document["settings_"+this.table_id];var n="";var l=a.view_cols.length;for(var r=0;r<l;r++)n+=(n!=""?",":"")+a.view_cols[r].value;var o={GRID_ID:this.grid_id,view_id:e,action:i.getUserOptions().getAction("GRID_SAVE_SETTINGS"),sessid:this.vars.sessid,name:a.view_name.value,columns:n,sort_by:a.view_sort_by.value,sort_order:a.view_sort_order.value,page_size:a.view_page_size.value,saved_filter:a.view_filters.value,custom_names:this.customNames,columns_sizes:!a.reset_columns_sizes.checked?this.columnsSizes:{}};if(a.set_default_settings){o.set_default_settings=a.set_default_settings.checked?"Y":"N";o.delete_users_settings=a.delete_users_settings.checked?"Y":"N"}var d=null;if(s===true){d=function(){if(o.saved_filter&&t.oOptions.filters[o.saved_filter]){t.ApplyFilter(o.saved_filter)}else{i.reloadTable()}}}BX.ajax.post("/bitrix/components"+t.vars.component_path+"/settings.ajax.php",o,d);return o};this.ReloadViews=function(){if(t.bViewsChanged)t.Reload()};this.ShowViews=function(){this.bViewsChanged=false;var e=false;if(!window["viewsDialog"+this.table_id]){var i=new BX.CWindowButton({title:this.vars.mess.viewsApply,hint:this.vars.mess.viewsApplyTitle,action:function(){var e=document["views_"+t.table_id];if(e.views_list.selectedIndex!=-1)t.SetView(e.views_list.value);window["bxGrid_"+t.table_id].bViewsChanged=false;this.parentWindow.Close()}});window["viewsDialog"+this.table_id]=new BX.CDialog({content:'<form name="views_'+this.table_id+'"></form>',title:this.vars.mess.viewsTitle,buttons:[i,BX.CDialog.prototype.btnClose],width:this.vars.viewsWndSize.width,height:this.vars.viewsWndSize.height,resize_id:"InterfaceGridViewsWnd"});BX.addCustomEvent(window["viewsDialog"+this.table_id],"onWindowUnRegister",this.ReloadViews);e=true}window["viewsDialog"+this.table_id].Show();var s=document["views_"+this.table_id];if(e)s.appendChild(BX("views_list_"+this.table_id))};this.DragStart=function(){t.onDragStart(this);var e=BX.Main.gridManager.getById(t.grid_id).instance;var i=e.getContainer();var s=e.getTable();var a=e.getRows().getHeadChild()[0].getCells();var n=BX.pos(this);var l=BX.pos(i);var r=n.left-l.left;var o=BX.findChildByClassName(this,"main-grid-cell-head-container",false);this.__cursor=BX.create("div",{props:{className:e.settings.get("classCursor")}});i.appendChild(this.__cursor);o.style.width=this.clientWidth+"px";o.style.height=this.clientHeight+"px";this.__dragNode=document.createElement("DIV");this.__dragNode.className="main-grid-cell-head-drag";this.__dragNode.appendChild(o);BX.style(this.__dragNode,"left",r+"px");s.parentNode.insertBefore(this.__dragNode,s);this.style.height=n.height+"px";this.innerHTML='<span class="main-grid-cell-head-container" style="z-index: 25; "></span>';BX.addClass(this,"main-grid-cell-head-drag-dest");this.__dragDest=this.cellIndex;this.__dragX=r-jsDD.start_x;this.__dragCells=[];for(var d=0;d<a.length;d++){if(a[d].__fixed)continue;var h=BX.pos(a[d]);if(!h.width)continue;var c=BX.findChildByClassName(a[d],"main-grid-cell-head-container",false);BX.addClass(a[d],"main-grid-cell-head-ondrag");this.__cursor.style.left=h.left-l.left+"px";if(d==this.cellIndex){c.style.height=h.height-2+"px";this.__dragCells.ref=this.__dragCells.length}this.__dragCells.push({index:d,node:c,offset:h.left-l.left,width:h.width,move:0})}if(this.__dragCells.length>1&&this.__dragCells.ref==this.__dragCells.length-1){var f=this.__dragCells[this.__dragCells.length-2].index;BX.addClass(a[f],"main-grid-cell-last")}};this.Drag=function(e){var i=this;var s=BX.Main.gridManager.getById(t.grid_id).instance;var a=s.getContainer();var n=e+this.__dragX;var l=BX.pos(a);var r,o,d;this.__dragNode.style.left=n+"px";for(var h=this.__dragCells.length-1;h>=0;h--){if(e-l.left>this.__dragCells[h].offset){this.__dest=this.__dragCells[h].index;break}}r=this.__dragCells.filter(function(e){return e.index==i.__dragDest})[0];o=this.__dragCells.filter(function(e){return e.index==i.__dest})[0];d=o.offset;if(this.__dest>this.__dragDest){d=o.offset+o.width}r.node.style.left=d+"px";this.__cursor.style.left=d+"px"};this.DragStop=function(){t.onDragStop(this);var e=this;var i=BX.Main.gridManager.getById(t.grid_id).instance;var s=i.getRows().getList();var a,n,l,r,o;var d=BX.findChildByClassName(this.__dragNode,i.settings.get("classCellHeadContainer"),false);this.innerHTML="";this.appendChild(d);this.style.height="";BX.removeClass(this,"main-grid-cell-head-drag-dest");BX.remove(this.__cursor);BX.remove(this.__dragNode);s.map(function(t){a=t.getCells();n=a[e.__dragDest];l=a[e.__dest];if(t.isHeadChild()||t.isBodyChild()||t.isFootChild()){if(e.__dest<e.__dragDest){t.getNode().insertBefore(n,l)}if(e.__dest>e.__dragDest){if(BX.type.isDomNode(l.nextElementSibling)){t.getNode().insertBefore(n,l.nextElementSibling)}else{t.getNode().appendChild(n)}}for(var s=0;s<a.length;s++){var r=BX.findChildByClassName(a[s],i.settings.get("classCellHeadContainer"),false);if(r&&r.style){r.style.width="";r.style.left=""}BX.removeClass(a[s],i.settings.get("classCellHeadOndrag"))}}});if(this.__dest!==this.__dragDest){a=i.getRows().getHeadChild()[0].getCells();o=t.oVisibleCols;t.oVisibleCols={};[].forEach.call(a,function(e){r=BX.data(e,"name");if(r){t.oVisibleCols[r]=o[r]}});t.bColsChanged=true;t.SaveColumns()}};this.resizeColumnStart=function(){var e=BX.findParent(this,{className:"main-grid-cell-head"});var s=i.getRows().getHeadFirstChild().getCells();var a=Object.keys(s);var n;t.onDragStart(e);this.__overlay=BX.create("div",{props:{className:"main-grid-cell-overlay"}});BX.append(this.__overlay,e);this.__resizeCell=e.cellIndex;a.forEach(function(e){if(BX.hasClass(s[e],"main-grid-special-empty")){BX.style(s[e],"width","100%")}else{BX.width(s[e],BX.width(s[e]));n=BX.firstChild(s[e]);BX.width(n,BX.width(s[e]))}})};this.resizeColumn=function(e){var s=BX(t.table_id);var a=i.getPinHeader().getFixedTable();var n=s.rows[0].cells[this.__resizeCell];var l,r;var o=BX.pos(s);var d=BX.pos(n);var h=BX.firstChild(n);var c=parseFloat(n.style.width);var f;e-=d.left;f=e;if(d.width>c){e=d.width}e=f>e?f:e;if(e!==d.width){n.style.width=e+"px";h.style.width=e+"px";if(BX.type.isDomNode(a)&&BX.type.isDomNode(a.rows[0])){l=a.rows[0].cells[this.__resizeCell];r=BX.firstChild(l);r.style.width=e+"px";l.style.width=e+"px"}}t.toogleFader()};this.resizeColumnStop=function(){var e=BX(t.table_id);var i=e.rows[0].cells;t.reinitResizeMeta();t.toogleFader();t.onDragStop(i[this.__resizeCell]);BX.remove(this.__resizeCell)};this.onDragStart=function(e){if(e.getAttribute("onclick")){e.setAttribute("data-onclick",e.getAttribute("onclick"));e.removeAttribute("onclick")}};this.onDragStop=function(e){if(e.getAttribute("data-onclick")){setTimeout(function(){e.setAttribute("onclick",e.getAttribute("data-onclick"));e.removeAttribute("data-onclick")},10)}};this.InitFilter=function(){var e=BX("flt_header_"+this.table_id);if(e)jsUtils.addEvent(e,"contextmenu",this.OnRowContext)};this.SwitchFilterRow=function(e,t){if(t){var i=this.menu.GetMenuByItemId(t.id);i.SetItemIcon(t,this.oFilterRows[e]?"":"checked")}else{var s=this.filterMenu[0].MENU;for(var a=0;a<s.length;a++){if(s[a].ID=="flt_"+this.table_id+"_"+e){s[a].ICONCLASS=this.oFilterRows[e]?"":"checked";break}}}var n=BX("flt_row_"+this.table_id+"_"+e);n.style.display=this.oFilterRows[e]?"none":"";this.oFilterRows[e]=this.oFilterRows[e]?false:true;var l=BX("a_minmax_"+this.table_id);if(l&&l.className.indexOf("bx-filter-max")!=-1)this.SwitchFilter(l);this.SaveFilterRows()};this.SwitchFilterRows=function(e){this.menu.PopupHide();var t=0;for(var i in this.oFilterRows){t++;if(t==1&&e==false)continue;this.oFilterRows[i]=e;var s=BX("flt_row_"+this.table_id+"_"+i);s.style.display=e?"":"none"}var a=this.filterMenu[0].MENU;for(t=0;t<a.length;t++){if(t==0&&e==false)continue;if(a[t].SEPARATOR==true)break;a[t].ICONCLASS=e?"checked":""}var n=BX("a_minmax_"+this.table_id);if(n&&n.className.indexOf("bx-filter-max")!=-1)this.SwitchFilter(n);this.SaveFilterRows()};this.SaveFilterRows=function(){var e="";for(var t in this.oFilterRows)if(this.oFilterRows[t])e+=(e!=""?",":"")+t;BX.ajax.get("/bitrix/components"+this.vars.component_path+"/settings.ajax.php?GRID_ID="+this.table_id+"&action=filterrows&rows="+e+"&sessid="+this.vars.sessid)};this.SwitchFilter=function(e){var t=e.className.indexOf("bx-filter-min")!=-1;e.className=t?"bx-filter-btn bx-filter-max":"bx-filter-btn bx-filter-min";e.title=t?this.vars.mess.filterShow:this.vars.mess.filterHide;var i=BX("flt_content_"+this.table_id);i.style.display=t?"none":"";BX.ajax.get("/bitrix/components"+this.vars.component_path+"/settings.ajax.php?GRID_ID="+this.table_id+"&action=filterswitch&show="+(t?"N":"Y")+"&sessid="+this.vars.sessid)};this.ClearFilter=function(e){for(var t=0,i=e.elements.length;t<i;t++){var s=e.elements[t];switch(s.type.toLowerCase()){case"text":case"textarea":s.value="";break;case"select-one":s.selectedIndex=0;break;case"select-multiple":for(var a=0,n=s.options.length;a<n;a++)s.options[a].selected=false;break;case"checkbox":s.checked=false;break;default:break}if(s.onchange)s.onchange()}BX.onCustomEvent(e,"onGridClearFilter",[]);e.clear_filter.value="Y";BX.submit(e)};this.ShowFilters=function(){var e=false;if(!window["filtersDialog"+this.table_id]){var i=new BX.CWindowButton({title:this.vars.mess.filtersApply,hint:this.vars.mess.filtersApplyTitle,action:function(){var e=document["filters_"+t.table_id];if(e.filters_list.value)t.ApplyFilter(e.filters_list.value);this.parentWindow.Close()}});window["filtersDialog"+this.table_id]=new BX.CDialog({content:'<form name="filters_'+this.table_id+'"></form>',title:this.vars.mess.filtersTitle,buttons:[i,BX.CDialog.prototype.btnClose],width:this.vars.filtersWndSize.width,height:this.vars.filtersWndSize.height,resize_id:"InterfaceGridFiltersWnd"});e=true}window["filtersDialog"+this.table_id].Show();var s=document["filters_"+this.table_id];if(e)s.appendChild(BX("filters_list_"+this.table_id))};this.AddFilter=function(e){if(!e)e={};var i="filter_"+Math.round(Math.random()*1e6);var s={name:this.vars.mess.filtersNew,fields:e};this.ShowFilterSettings(s,function(){var e=t.SaveFilter(i);t.oOptions.filters[i]={name:e.name,fields:e.fields};var s=document["filters_"+t.table_id];s.filters_list.options[s.filters_list.length]=new Option(e.name!=""?e.name:t.vars.mess.viewsNoName,i,true,true);if(t.filterMenu.length==4)t.filterMenu=BX.util.insertIntoArray(t.filterMenu,1,{SEPARATOR:true});var a={ID:"mnu_"+t.table_id+"_"+i,TEXT:BX.util.htmlspecialchars(e.name),TITLE:t.vars.mess.ApplyTitle,ONCLICK:"bxGrid_"+t.table_id+".ApplyFilter('"+i+"')"};t.filterMenu=BX.util.insertIntoArray(t.filterMenu,2,a)})};this.AddFilterAs=function(){var e=document.forms["filter_"+this.table_id];var t=this.GetFilterFields(e);this.ShowFilters();this.AddFilter(t)};this.EditFilter=function(e){this.ShowFilterSettings(this.oOptions.filters[e],function(){var i=t.SaveFilter(e);t.oOptions.filters[e]={name:i.name,fields:i.fields};var s=document["filters_"+t.table_id];s.filters_list.options[s.filters_list.selectedIndex].text=i.name!=""?i.name:t.vars.mess.viewsNoName;for(var a=0,n=t.filterMenu.length;a<n;a++){if(t.filterMenu[a].ID&&t.filterMenu[a].ID=="mnu_"+t.table_id+"_"+e){
t.filterMenu[a].TEXT=BX.util.htmlspecialchars(i.name);break}}})};this.DeleteFilter=function(e){if(!confirm(this.vars.mess.filtersDelete))return;var i=document["filters_"+this.table_id];var s=i.filters_list.selectedIndex;i.filters_list.remove(s);i.filters_list.selectedIndex=s<i.filters_list.length?s:i.filters_list.length-1;for(var a=0,n=this.filterMenu.length;a<n;a++){if(t.filterMenu[a].ID&&t.filterMenu[a].ID=="mnu_"+t.table_id+"_"+e){this.filterMenu=BX.util.deleteFromArray(this.filterMenu,a);if(this.filterMenu.length==5)this.filterMenu=BX.util.deleteFromArray(this.filterMenu,1);break}}delete this.oOptions.filters[e];BX.ajax.get("/bitrix/components"+this.vars.component_path+"/settings.ajax.php?GRID_ID="+this.table_id+"&action=delfilter&filter_id="+e+"&sessid="+t.vars.sessid)};this.ShowFilterSettings=function(e,t){var i=false;if(!window["filterSettingsDialog"+this.table_id]){window["filterSettingsDialog"+this.table_id]=new BX.CDialog({content:'<form name="flt_settings_'+this.table_id+'"></form>',title:this.vars.mess.filterSettingsTitle,width:this.vars.filterSettingWndSize.width,height:this.vars.filterSettingWndSize.height,resize_id:"InterfaceGridFilterSettingWnd"});i=true}window["filterSettingsDialog"+this.table_id].ClearButtons();window["filterSettingsDialog"+this.table_id].SetButtons([{title:this.vars.mess.settingsSave,action:function(){t();this.parentWindow.Close()}},BX.CDialog.prototype.btnCancel]);window["filterSettingsDialog"+this.table_id].Show();var s=document["flt_settings_"+this.table_id];if(i)s.appendChild(BX("filter_settings_"+this.table_id));s.filter_name.focus();s.filter_name.value=e.name;this.SetFilterFields(s,e.fields)};this.SetFilterFields=function(e,t){for(var i=0,s=e.elements.length;i<s;i++){var a=e.elements[i];if(a.name=="filter_name")continue;var n=t[a.name]||"";switch(a.type.toLowerCase()){case"select-one":case"text":case"textarea":a.value=n;break;case"radio":case"checkbox":a.checked=a.value==n;break;case"select-multiple":var l=a.name.substr(0,a.name.length-2);var r=false;for(var o=0,d=a.options.length;o<d;o++){var h=t[l]?t[l]["sel"+a.options[o].value]:null;a.options[o].selected=a.options[o].value==h;if(a.options[o].value==h)r=true}if(!r&&a.options.length>0&&a.options[0].value=="")a.options[0].selected=true;break;default:break}if(a.onchange)a.onchange()}};this.GetFilterFields=function(e){var t={};for(var i=0,s=e.elements.length;i<s;i++){var a=e.elements[i];if(a.name=="filter_name")continue;switch(a.type.toLowerCase()){case"select-one":case"text":case"textarea":t[a.name]=a.value;break;case"radio":case"checkbox":if(a.checked)t[a.name]=a.value;break;case"select-multiple":var n=a.name.substr(0,a.name.length-2);t[n]={};for(var l=0,r=a.options.length;l<r;l++)if(a.options[l].selected)t[n]["sel"+a.options[l].value]=a.options[l].value;break;default:break}}return t};this.SaveFilter=function(e){var i=document["flt_settings_"+this.table_id];var s={GRID_ID:this.table_id,filter_id:e,action:"savefilter",sessid:this.vars.sessid,name:i.filter_name.value,fields:this.GetFilterFields(i)};BX.ajax.post("/bitrix/components"+t.vars.component_path+"/settings.ajax.php",s);return s};this.ApplyFilter=function(e){var t=document.forms["filter_"+this.table_id];this.SetFilterFields(t,this.oOptions.filters[e].fields);BX.submit(t)};this.OnDateChange=function(e){var t=false,i=false,s=false,a=false,n=false;if(e.value=="interval")n=t=i=s=true;else if(e.value=="before")i=true;else if(e.value=="after"||e.value=="exact")t=true;else if(e.value=="days")a=true;BX.findNextSibling(e,{tag:"span","class":"bx-filter-from"}).style.display=t?"":"none";BX.findNextSibling(e,{tag:"span","class":"bx-filter-to"}).style.display=i?"":"none";BX.findNextSibling(e,{tag:"span","class":"bx-filter-hellip"}).style.display=s?"":"none";BX.findNextSibling(e,{tag:"span","class":"bx-filter-days"}).style.display=a?"":"none";var l=BX.findNextSibling(e,{tag:"span","class":"bx-filter-br"});if(l)l.style.display=n?"":"none"};this.loadColumn=function(e){var i=BX(this.table_id);var s=this.GetColumnId(e);var a=i.rows[0].cells[s];a.removeAttribute("data-empty");if(a.getAttribute("data-resize"))jsDD.Disable();var n=[];var l=function(l){n.push(l);for(var r in l.edit){if(typeof l.edit[r][e]!="undefined"){if(typeof t.oEditData[r]=="undefined")t.oEditData[r]={};t.oEditData[r][e]=l.edit[r][e]}}if(n.length<t.vars.current_url.length)return;for(var r in n){for(var o in n[r].data){var d=BX("datarow_"+t.table_id+"_"+o).cells[s];BX.findChildByClassName(d,"main-grid-cell-content").innerHTML=n[r].data[o][e]}}if(a.getAttribute("data-resize")){a.removeAttribute("data-resize");var h=i.offsetWidth;var c=a.offsetWidth;t.animation.stop(a);if(a.offsetWidth>0){t.reinitColumnSize(e);var f=a.offsetWidth;a.style.width=c+"px";t.toogleColumnCells(s,true,true);var v={width:{from:c,to:f,unit:"px"}};t.animation(a,v,100,function(){t.toogleColumnCells(s,true,false);t.reinitResizeMeta();t.toogleFader()})}jsDD.Enable()}t.toggleCheckboxes()};for(var r in this.vars.current_url){BX.ajax({url:this.vars.current_url[r],method:"GET",dataType:"json",headers:[{name:"X-Ajax-Grid-UID",value:this.vars.ajax.GRID_AJAX_UID},{name:"X-Ajax-Grid-Req",value:JSON.stringify({action:"showcolumn",column:e})}],onsuccess:l,onfailure:function(){a.setAttribute("data-empty",1);jsDD.Enable()}})}};this.getData=function(e,t){BX.ajax({url:e+(e.indexOf("?")!==-1?"&":"?")+"bxajaxid="+this.vars.ajax.AJAX_ID,method:"GET",dataType:"html",headers:[{name:"X-Ajax-Grid-UID",value:this.vars.ajax.GRID_AJAX_UID},{name:"X-Ajax-Grid-Req",value:JSON.stringify({action:"showpage",columns:this.oVisibleCols})}],processData:true,scriptsRunFirst:true,onsuccess:function(e){t(e)}})}}
/* End */
;
; /* Start:"a:4:{s:4:"full";s:90:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/pagesize.min.js?1511316472593";s:6:"source";s:72:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/pagesize.js";s:3:"min";s:76:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/pagesize.min.js";s:3:"map";s:76:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/pagesize.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Grid");BX.Grid.Pagesize=function(t){this.parent=null;this.init(t)};BX.Grid.Pagesize.prototype={init:function(t){this.parent=t;BX.addCustomEvent("Dropdown::change",BX.delegate(this.onChange,this))},onChange:function(t,e,n,i,a){var s=this;if(t===this.parent.getContainerId()+"_"+this.parent.settings.get("pageSizeId")){if(a>=0){this.parent.tableFade();this.parent.getUserOptions().setPageSize(a,function(){s.parent.reloadTable();BX.onCustomEvent(s.parent.getContainer(),"Grid::pageSizeChanged",[s.parent])})}}}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:92:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/pagination.min.js?1511316472842";s:6:"source";s:74:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/pagination.js";s:3:"min";s:78:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/pagination.min.js";s:3:"map";s:78:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/pagination.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Grid");BX.Grid.Pagination=function(t){this.parent=null;this.container=null;this.links=null;this.init(t)};BX.Grid.Pagination.prototype={init:function(t){this.parent=t},getParent:function(){return this.parent},getContainer:function(){if(!this.container){this.container=BX.Grid.Utils.getByClass(this.getParent().getContainer(),this.getParent().settings.get("classPagination"),true)}return this.container},getLinks:function(){var t=this;var n=BX.Grid.Utils.getByTag(this.getContainer(),"a");this.links=[];if(n){this.links=n.map(function(n){return new BX.Grid.Element(n,t.getParent())})}return this.links},getLink:function(t){var n=null;var i;if(BX.type.isDomNode(t)){i=this.getLinks().filter(function(n){return t===n.getNode()});if(i.length){n=i[0]}}return n}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:93:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/pin-header.min.js?15113164722174";s:6:"source";s:74:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/pin-header.js";s:3:"min";s:78:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/pin-header.min.js";s:3:"map";s:78:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/pin-header.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Grid");BX.Grid.PinHeader=function(t){this.parent=null;this.table=null;this.header=null;this.container=null;this.init(t)};BX.Grid.PinHeader.prototype={init:function(t){this.parent=t;this.rect=BX.pos(this.parent.getHead());this.create();document.addEventListener("scroll",BX.proxy(this._onScroll,this),BX.Grid.Utils.listenerParams({passive:true}));document.addEventListener("resize",BX.proxy(this._onResize,this),BX.Grid.Utils.listenerParams({passive:true}));BX.addCustomEvent("Grid::updated",BX.proxy(this._onGridUpdate,this));BX.bind(window,"resize",BX.proxy(this._onGridUpdate,this))},_onGridUpdate:function(){var t=this.isPinned();BX.remove(this.getContainer());this.create();t&&this.pin();this.table=null;BX.onCustomEvent(window,"Grid::headerUpdated",[])},create:function(){var t=BX.Grid.Utils.getByTag(this.parent.getHead(),"th");var i=t.length-1;var e=BX.clone(this.parent.getHead());var n=BX.Grid.Utils.getByTag(e,"th");t.forEach(function(t,e){var r=BX.width(t);n[e].firstElementChild&&(n[e].firstElementChild.style.width=r+"px");if(i!==e){n[e].style.width=r+"px"}else{if(this.parent.getRows().getCountDisplayed()>0){n[e].style.width="100%"}}},this);this.container=BX.decl({block:"main-grid-fixed-bar",mix:"main-grid-fixed-top",attrs:{style:"width: "+BX.width(this.parent.getContainer())+"px"},content:{block:"main-grid-table",tag:"table",content:e}});this.container.hidden=true;this.parent.getWrapper().appendChild(this.container)},getContainer:function(){return this.container},getFixedTable:function(){return this.table||(this.table=BX.Grid.Utils.getByTag(this.getContainer(),"table",true))},pin:function(){!!this.getContainer()&&(this.getContainer().hidden=false);BX.onCustomEvent(window,"Grid::headerPinned",[])},unpin:function(){!!this.getContainer()&&(this.getContainer().hidden=true);BX.onCustomEvent(window,"Grid::headerUnpinned",[])},isPinned:function(){return!this.getContainer().hidden},_onScroll:function(){if(this.rect.top<=window.scrollY){!this.isPinned()&&this.pin()}else{this.isPinned()&&this.unpin()}},_onResize:function(){this.rect=BX.pos(this.parent.getHead())}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:92:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/pin-panel.min.js?15113164724993";s:6:"source";s:73:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/pin-panel.js";s:3:"min";s:77:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/pin-panel.min.js";s:3:"map";s:77:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/pin-panel.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Grid");BX.Grid.PinPanel=function(t){this.parent=null;this.panel=null;this.panelRect=null;this.isSelected=null;this.offset=null;this.animationDuration=null;this.lastIsSelected=null;this.init(t)};BX.Grid.PinPanel.prototype={init:function(t){this.parent=t;this.offset=10;this.animationDuration=200;this.panel=this.getPanel();this.bindOnRowsEvents()},bindOnRowsEvents:function(){BX.addCustomEvent("Grid::thereSelectedRows",BX.delegate(this._onThereSelectedRows,this));BX.addCustomEvent("Grid::allRowsSelected",BX.delegate(this._onThereSelectedRows,this));BX.addCustomEvent("Grid::noSelectedRows",BX.delegate(this._onNoSelectedRows,this));BX.addCustomEvent("Grid::allRowsUnselected",BX.delegate(this._onNoSelectedRows,this));BX.addCustomEvent("Grid::updated",BX.delegate(this._onNoSelectedRows,this))},bindOnWindowEvents:function(){BX.bind(window,"resize",BX.proxy(this._onResize,this));document.addEventListener("scroll",BX.proxy(this._onScroll,this),BX.Grid.Utils.listenerParams({passive:true}))},unbindOnWindowEvents:function(){BX.unbind(window,"resize",BX.proxy(this._onResize,this));document.removeEventListener("scroll",BX.proxy(this._onScroll,this),BX.Grid.Utils.listenerParams({passive:true}))},getPanel:function(){this.panel=this.panel||this.parent.getActionsPanel().getPanel();return this.panel},getScrollBottom:function(){return BX.scrollTop(window)+this.getWindowHeight()},getPanelRect:function(){if(!BX.type.isPlainObject(this.panelRect)){this.panelRect=BX.pos(this.getPanel())}return this.panelRect},getPanelPrevBottom:function(){var t=BX.previousSibling(this.getPanel());return BX.pos(t).bottom+parseFloat(BX.style(t,"margin-bottom"))},getWindowHeight:function(){this.windowHeight=this.windowHeight||BX.height(window);return this.windowHeight},pinPanel:function(){BX.style(this.getPanel(),"width",BX.width(this.getPanel().parentNode)+"px");BX.style(this.getPanel().parentNode,"height",BX.height(this.getPanel().parentNode)+"px");BX.addClass(this.getPanel(),"main-grid-fixed-bottom");BX.style(this.getPanel(),"bottom","");setTimeout(BX.delegate(function(){BX.style(this.getPanel(),"transition","none")},this),200)},unpinPanel:function(){BX.removeClass(this.getPanel(),"main-grid-fixed-bottom");BX.style(this.getPanel(),"width","");BX.style(this.getPanel().parentNode,"height","");BX.style(this.getPanel(),"bottom","");setTimeout(BX.delegate(function(){BX.style(this.getPanel(),"transition","")},this),200)},isSelectedRows:function(){return this.isSelected},isNeedPinAbsolute:function(){return BX.pos(this.parent.getBody()).top+this.getPanelRect().height>=this.getScrollBottom()},isNeedPin:function(){return this.getScrollBottom()-this.getPanelRect().height<=this.getPanelPrevBottom()},adjustPanelPosition:function(){var t=window.pageXOffset;this.lastScrollX=this.lastScrollX!==null?this.lastScrollX:t;BX.Grid.Utils.requestAnimationFrame(BX.proxy(function(){if(t!==this.lastScrollX){var e=this.getPanelRect();BX.style(this.getPanel(),"left",e.left-t+"px")}},this));this.lastScrollX=t},pinController:function(t){if(!this.getPanel()){return}var e=this;if(this.isNeedPin()&&this.isSelectedRows()){if(t){BX.style(this.getPanel(),"bottom",-this.getStartDiffPanelPosition()+"px");setTimeout(function(){e.pinPanel()},200)}else{this.pinPanel()}if(this.isNeedPinAbsolute()&&!this.absolutePin){this.absolutePin=true;BX.style(this.getPanel(),"transition","");BX.style(this.getPanel(),"top",BX.pos(this.parent.getBody()).top-parseFloat(BX.style(this.getPanel(),"margin-top"))+"px");BX.style(e.getPanel(),"position","absolute")}else if(!this.isNeedPinAbsolute()&&this.absolutePin){this.absolutePin=false;BX.style(this.getPanel(),"position","");BX.style(this.getPanel(),"top","")}this.adjustPanelPosition()}else{if(t){BX.style(this.getPanel(),"bottom",-this.getEndDiffPanelPosition()+"px");setTimeout(function(){e.unpinPanel()},200)}else{this.unpinPanel()}}},getEndDiffPanelPosition:function(){var t=BX.pos(this.getPanel());var e=BX.pos(BX.previousSibling(this.getPanel()));var i=BX.scrollTop(window);var n=i+BX.height(window);var s=t.height+this.offset;var o=e.bottom+parseFloat(BX.style(this.getPanel(),"margin-top"));if(o<n&&o+t.height>n){s=Math.abs(n-(o+t.height))}return s},getStartDiffPanelPosition:function(){var t=BX.pos(this.getPanel());var e=BX.scrollTop(window);var i=e+BX.height(window);var n=t.height+this.offset;if(t.bottom>i&&t.top<i){n=t.bottom-i}return n},_onThereSelectedRows:function(){this.bindOnWindowEvents();this.isSelected=true;if(this.lastIsSelected){this.pinController()}else{this.lastIsSelected=true;this.pinController(true)}},_onNoSelectedRows:function(){this.unbindOnWindowEvents();this.isSelected=false;this.pinController(true);this.lastIsSelected=false},_onScroll:function(){this.pinController()},_onResize:function(){this.windowHeight=BX.height(window);this.panel=this.parent.getActionsPanel().getPanel();this.panelRect=this.getPanel().getBoundingClientRect();this.pinController()}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:89:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/resize.min.js?15113164723275";s:6:"source";s:70:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/resize.js";s:3:"min";s:74:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/resize.min.js";s:3:"map";s:74:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/resize.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Grid");BX.Grid.Resize=function(t){this.parent=null;this.lastRegisterButtons=null;this.init(t)};BX.Grid.Resize.prototype={init:function(t){this.parent=t;BX.addCustomEvent(window,"Grid::updated",BX.proxy(this.registerTableButtons,this));BX.addCustomEvent(window,"Grid::headerUpdated",BX.proxy(this.registerPinnedTableButtons,this));this.registerTableButtons();this.registerPinnedTableButtons()},destroy:function(){BX.removeCustomEvent(window,"Grid::updated",BX.proxy(this.registerTableButtons,this));BX.removeCustomEvent(window,"Grid::headerUpdated",BX.proxy(this.registerPinnedTableButtons,this));BX.type.isArray(this.lastRegisterButtons)&&this.lastRegisterButtons.forEach(jsDD.unregisterObject);(this.getButtons()||[]).forEach(jsDD.unregisterObject)},registerTableButtons:function(){(this.getButtons()||[]).forEach(this.register,this);this.registerPinnedTableButtons()},register:function(t){if(BX.type.isDomNode(t)){t.onbxdragstart=BX.delegate(this._onDragStart,this);t.onbxdragstop=BX.delegate(this._onDragEnd,this);t.onbxdrag=BX.delegate(this._onDrag,this);jsDD.registerObject(t)}},registerPinnedTableButtons:function(){if(this.parent.getParam("ALLOW_PIN_HEADER")){var t=this.getPinnedTableButtons();if(BX.type.isArray(this.lastRegisterButtons)&&this.lastRegisterButtons.length){this.lastRegisterButtons.forEach(jsDD.unregisterObject)}this.lastRegisterButtons=t;(this.getPinnedTableButtons()||[]).forEach(this.register,this)}},getButtons:function(){return BX.Grid.Utils.getByClass(this.parent.getRows().getHeadFirstChild().getNode(),this.parent.settings.get("classResizeButton"))},getPinnedTableButtons:function(){return BX.Grid.Utils.getByClass(this.parent.getPinHeader().getFixedTable(),this.parent.settings.get("classResizeButton"))},_onDragStart:function(){var t=BX.findParent(jsDD.current_node,{className:this.parent.settings.get("classHeadCell")});var e=this.parent.getRows().getHeadFirstChild().getCells();var s=Object.keys(e);var i;this.__overlay=BX.create("div",{props:{className:"main-grid-cell-overlay"}});BX.append(this.__overlay,t);this.__resizeCell=t.cellIndex;s.forEach(function(t){if(BX.hasClass(e[t],"main-grid-special-empty")){BX.style(e[t],"width","100%")}else{BX.width(e[t],BX.width(e[t]));i=BX.firstChild(e[t]);BX.width(i,BX.width(e[t]))}})},_onDrag:function(t){var e=this.parent.getTable();var s=this.parent.getParam("ALLOW_PIN_HEADER")?this.parent.getPinHeader().getFixedTable():null;var i=e.rows[0].cells[this.__resizeCell];var r,n;var a=BX.pos(i);var o=BX.firstChild(i);var l=parseFloat(i.style.width);var d;t-=a.left;d=t;if(a.width>l){t=a.width}t=d>t?d:t;if(t!==a.width){i.style.width=t+"px";o.style.width=t+"px";if(BX.type.isDomNode(s)&&BX.type.isDomNode(s.rows[0])){r=s.rows[0].cells[this.__resizeCell];n=BX.firstChild(r);n.style.width=t+"px";r.style.width=t+"px"}}BX.onCustomEvent(window,"Grid::columnResize",[])},_onDragEnd:function(){this.saveSizes()},getColumnSizes:function(){var t=this.parent.getRows().getHeadFirstChild().getCells();var e={};var s;[].forEach.call(t,function(t){s=BX.data(t,"name");if(BX.type.isNotEmptyString(s)){e[s]=BX.width(t)}},this);return e},saveSizes:function(){this.parent.getUserOptions().setColumnSizes(this.getColumnSizes(),1)}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:87:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/row.min.js?151131647213741";s:6:"source";s:67:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/row.js";s:3:"min";s:71:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/row.min.js";s:3:"map";s:71:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/row.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Grid");BX.Grid.Row=function(t,e){this.node=null;this.checkbox=null;this.sort=null;this.actions=null;this.settings=null;this.index=null;this.actionsButton=null;this.parent=null;this.depth=null;this.parentId=null;this.editData=null;this.custom=null;this.init(t,e)};BX.Grid.Row.prototype={init:function(t,e){if(BX.type.isDomNode(e)){this.node=e;this.parent=t;this.settings=new BX.Grid.Settings;if(this.parent.getParam("ALLOW_CONTEXT_MENU")){BX.bind(this.getNode(),"contextmenu",BX.delegate(this._onRightClick,this))}}},isCustom:function(){if(this.custom===null){this.custom=BX.hasClass(this.getNode(),this.parent.settings.get("classRowCustom"))}return this.custom},_onRightClick:function(t){t.preventDefault();this.showActionsMenu(t)},getDefaultAction:function(){return BX.data(this.getNode(),"default-action")},editGetValues:function(){var t=this;var e=this.getCells();var s={};var i;[].forEach.call(e,function(e){i=t.getCellEditorValue(e);if(i){s[i.NAME]=i.VALUE!==undefined?i.VALUE:""}});return s},getCellEditorValue:function(t){var e=BX.Grid.Utils.getByClass(t,this.parent.settings.get("classEditor"),true);var s=null;if(BX.type.isDomNode(e)){if(BX.hasClass(e,"main-grid-editor-checkbox")){s={NAME:e.getAttribute("name"),VALUE:e.checked?"Y":"N"}}else{if(e.value){s={NAME:e.getAttribute("name"),VALUE:e.value}}else{s={NAME:e.getAttribute("name"),VALUE:BX.data(e,"value")}}}}return s},isEdit:function(){return BX.hasClass(this.getNode(),"main-grid-row-edit")},hide:function(){BX.addClass(this.getNode(),this.parent.settings.get("classHide"))},show:function(){BX.removeClass(this.getNode(),this.parent.settings.get("classHide"))},isShown:function(){return!BX.hasClass(this.getNode(),this.parent.settings.get("classHide"))},isNotCount:function(){return BX.hasClass(this.getNode(),this.parent.settings.get("classNotCount"))},getContentContainer:function(t){var e=null;if(!BX.hasClass(t,this.parent.settings.get("classCellContainer"))){if(t.nodeName==="TD"||t.nodeName==="TR"){e=BX.Grid.Utils.getByClass(t,this.parent.settings.get("classCellContainer"),true)}else{e=BX.findParent(t,{className:this.parent.settings.get("classCellContainer")},true,false)}}else{e=t}return e},getContent:function(t){var e=this.getContentContainer(t);var s;if(BX.type.isDomNode(e)){s=BX.html(e)}return s},getEditorContainer:function(t){return BX.Grid.Utils.getByClass(t,this.parent.settings.get("classEditorContainer"),true)},getCollapseButton:function(){if(!this.collapseButton){this.collapseButton=BX.Grid.Utils.getByClass(this.getNode(),this.parent.settings.get("classCollapseButton"),true)}return this.collapseButton},stateLoad:function(){BX.addClass(this.getNode(),this.parent.settings.get("classRowStateLoad"))},stateUnload:function(){BX.removeClass(this.getNode(),this.parent.settings.get("classRowStateLoad"))},stateExpand:function(){BX.addClass(this.getNode(),this.parent.settings.get("classRowStateExpand"))},stateCollapse:function(){BX.removeClass(this.getNode(),this.parent.settings.get("classRowStateExpand"))},getParentId:function(){if(this.parentId===null){this.parentId=BX.data(this.getNode(),"parent-id");if(typeof this.parentId!=="undefined"&&this.parentId!==null){this.parentId=this.parentId.toString()}}return this.parentId},getDataset:function(){return this.getNode().dataset},getDepth:function(){if(this.depth===null){this.depth=BX.data(this.getNode(),"depth")}return this.depth},setDepth:function(t){t=parseInt(t);if(BX.type.isNumber(t)){var e=t-parseInt(this.getDepth());var s=this.parent.getRows();this.getDataset().depth=t;this.getShiftCells().forEach(function(e){BX.data(e,"depth",t);BX.style(e,"padding-left",t*20+"px")},this);s.getRowsByParentId(this.getId(),true).forEach(function(t){var s=parseInt(e)+parseInt(t.getDepth());t.getDataset().depth=s;t.getShiftCells().forEach(function(t){BX.data(t,"depth",s);BX.style(t,"padding-left",s*20+"px")})})}},setParentId:function(t){t=t.toString();var e=this.getDataset();e["parentId"]=t},getShiftCells:function(){return BX.Grid.Utils.getBySelector(this.getNode(),'td[data-shift="true"]')},showChildRows:function(){var t=this.getChildren();var e=this.isCustom();t.forEach(function(t){t.show();if(!e&&t.isExpand()){t.showChildRows()}});this.parent.updateCounterDisplayed();this.parent.updateCounterSelected();this.parent.adjustCheckAllCheckboxes();this.parent.adjustRows()},getChildren:function(){var t=this.isCustom()?"getRowsByGroupId":"getRowsByParentId";var e=this.isCustom()?this.getGroupId():this.getId();return this.parent.getRows()[t](e,true)},hideChildRows:function(){var t=this.getChildren();t.forEach(function(t){t.hide()});this.parent.updateCounterDisplayed();this.parent.updateCounterSelected();this.parent.adjustCheckAllCheckboxes();this.parent.adjustRows()},isChildsLoaded:function(){if(!BX.type.isBoolean(this.childsLoaded)){this.childsLoaded=this.isCustom()||BX.data(this.getNode(),"child-loaded")==="true"}return this.childsLoaded},expand:function(){var t=this;this.stateExpand();if(this.isChildsLoaded()){this.showChildRows()}else{this.stateLoad();this.loadChildRows(function(e){e.reverse().forEach(function(e){BX.insertAfter(e,t.getNode())});t.parent.getRows().reset();t.parent.bindOnRowEvents();if(t.parent.getParam("ALLOW_ROWS_SORT")){t.parent.getRowsSortable().reinit()}if(t.parent.getParam("ALLOW_COLUMNS_SORT")){t.parent.getColsSortable().reinit()}t.stateUnload();BX.data(t.getNode(),"child-loaded","true");t.parent.updateCounterDisplayed();t.parent.updateCounterSelected();t.parent.adjustCheckAllCheckboxes()})}},collapse:function(){this.stateCollapse();this.hideChildRows()},isExpand:function(){return BX.hasClass(this.getNode(),this.parent.settings.get("classRowStateExpand"))},toggleChildRows:function(){if(!this.isExpand()){this.expand()}else{this.collapse()}},loadChildRows:function(t){if(BX.type.isFunction(t)){var e=this;var s=parseInt(this.getDepth());var i=this.parent.getUserOptions().getAction("GRID_GET_CHILD_ROWS");s=BX.type.isNumber(s)?s+1:1;this.parent.getData().request("","POST",{action:i,parent_id:this.getId(),depth:s},null,function(){var s=this.getRowsByParentId(e.getId());t.apply(null,[s])})}},update:function(t,e,s){t=!!t?t:"";var i=this.parent.getUserOptions().getAction("GRID_UPDATE_ROW");var n=this.getDepth();var a=this.getId();var o=this.getParentId();var r={id:a,parentId:o,action:i,depth:n,data:t};var d=this;this.stateLoad();this.parent.getData().request(e,"POST",r,null,function(){var e=this.getBodyRows();d.parent.getUpdater().updateBodyRows(e);d.stateUnload();d.parent.getRows().reset();d.parent.getUpdater().updateFootRows(this.getFootRows());d.parent.getUpdater().updatePagination(this.getPagination());d.parent.getUpdater().updateMoreButton(this.getMoreButton());d.parent.getUpdater().updateCounterTotal(this.getCounterTotal());d.parent.bindOnRowEvents();d.parent.adjustEmptyTable(e);d.parent.bindOnMoreButtonEvents();d.parent.bindOnClickPaginationLinks();d.parent.updateCounterDisplayed();d.parent.updateCounterSelected();if(d.parent.getParam("ALLOW_COLUMNS_SORT")){d.parent.colsSortable.reinit()}if(d.parent.getParam("ALLOW_ROWS_SORT")){d.parent.rowsSortable.reinit()}BX.onCustomEvent(window,"Grid::rowUpdated",[{id:a,data:t,grid:d.parent,response:this}]);BX.onCustomEvent(window,"Grid::updated",[]);if(BX.type.isFunction(s)){s({id:a,data:t,grid:d.parent,response:this})}})},remove:function(t,e,s){t=!!t?t:"";var i=this.parent.getUserOptions().getAction("GRID_DELETE_ROW");var n=this.getDepth();var a=this.getId();var o=this.getParentId();var r={id:a,parentId:o,action:i,depth:n,data:t};var d=this;this.stateLoad();this.parent.getData().request(e,"POST",r,null,function(){var e=this.getBodyRows();d.parent.getUpdater().updateBodyRows(e);d.stateUnload();d.parent.getRows().reset();d.parent.getUpdater().updateFootRows(this.getFootRows());d.parent.getUpdater().updatePagination(this.getPagination());d.parent.getUpdater().updateMoreButton(this.getMoreButton());d.parent.getUpdater().updateCounterTotal(this.getCounterTotal());d.parent.bindOnRowEvents();d.parent.adjustEmptyTable(e);d.parent.bindOnMoreButtonEvents();d.parent.bindOnClickPaginationLinks();d.parent.updateCounterDisplayed();d.parent.updateCounterSelected();if(d.parent.getParam("ALLOW_COLUMNS_SORT")){d.parent.colsSortable.reinit()}if(d.parent.getParam("ALLOW_ROWS_SORT")){d.parent.rowsSortable.reinit()}BX.onCustomEvent(window,"Grid::rowRemoved",[{id:a,data:t,grid:d.parent,response:this}]);BX.onCustomEvent(window,"Grid::updated",[]);if(BX.type.isFunction(s)){s({id:a,data:t,grid:d.parent,response:this})}})},editCancel:function(){var t=this.getCells();var e=this;var s;[].forEach.call(t,function(t){s=e.getEditorContainer(t);if(BX.type.isDomNode(s)){BX.remove(e.getEditorContainer(t));BX.show(e.getContentContainer(t))}});BX.removeClass(this.getNode(),"main-grid-row-edit")},getCellByIndex:function(t){return this.getCells()[t]},getEditDataByCellIndex:function(index){return eval(BX.data(this.getCellByIndex(index),"edit"))},getCellNameByCellIndex:function(t){return BX.data(this.getCellByIndex(t),"name")},getEditData:function(){if(this.editData===null){var t=this.parent.getParam("EDITABLE_DATA");var e=this.getId();if(BX.type.isPlainObject(t)&&e in t){this.editData=t[e]}else{this.editData={}}}return this.editData},getCellEditDataByCellIndex:function(t){var e=this.getEditData();var s=null;t=parseInt(t);if(BX.type.isNumber(t)&&BX.type.isPlainObject(e)){var i=this.parent.getRows().getHeadFirstChild().getEditDataByCellIndex(t);if(BX.type.isPlainObject(i)){s=i;s.VALUE=e[i.NAME]}}return s},edit:function(){var t=this.getCells();var e=this;var s,i,n,a;[].forEach.call(t,function(t,o){try{s=e.getCellEditDataByCellIndex(o)}catch(r){throw new Error(r)}if(e.parent.getEditor().validateEditObject(s)){a=e.getContentContainer(t);n=BX.height(a);i=e.parent.getEditor().getEditor(s,n);if(!e.getEditorContainer(t)&&BX.type.isDomNode(i)){t.appendChild(i);BX.hide(a)}}});BX.addClass(this.getNode(),"main-grid-row-edit")},setDraggable:function(t){if(!t){BX.addClass(this.getNode(),this.parent.settings.get("classDisableDrag"));this.parent.getRowsSortable().unregister(this.getNode())}else{BX.removeClass(this.getNode(),this.parent.settings.get("classDisableDrag"));this.parent.getRowsSortable().register(this.getNode())}},isDraggable:function(){return!BX.hasClass(this.getNode(),this.parent.settings.get("classDisableDrag"))},getNode:function(){return this.node},getIndex:function(){return this.getNode().rowIndex},getId:function(){return BX.data(this.getNode(),"id").toString()},getGroupId:function(){return BX.data(this.getNode(),"group-id").toString()},getObserver:function(){return BX.Grid.observer},getCheckbox:function(){if(!this.checkbox){this.checkbox=BX.Grid.Utils.getByClass(this.getNode(),this.settings.get("classRowCheckbox"),true)}return this.checkbox},getActionsMenu:function(){if(!this.actionsMenu){var t=this.getActionsButton().getBoundingClientRect();this.actionsMenu=BX.PopupMenu.create("main-grid-actions-menu-"+this.getIndex(),this.getActionsButton(),this.getMenuItems(),{autoHide:true,offsetTop:-(t.height/2+26),offsetLeft:30,angle:{position:"left",offset:t.height/2-8},events:{onPopupClose:BX.delegate(this._onCloseMenu,this)}});BX.bind(this.actionsMenu.popupWindow.popupContainer,"click",BX.delegate(function(){var t=this.getActionsMenu();if(t){t.close()}},this))}return this.actionsMenu},_onCloseMenu:function(){},actionsMenuIsShown:function(){return this.getActionsMenu().popupWindow.isShown()},showActionsMenu:function(t){var e=BX.pos(this.getActionsButton());BX.PopupMenu.destroy("main-grid-actions-menu-"+this.getIndex());this.actionsMenu=null;if(t){BX.fireEvent(document.body,"click");this.getActionsMenu().popupWindow.setOffset({offsetLeft:t.pageX-e.left+20,offsetTop:t.pageY-e.top-30})}else{this.getActionsMenu().popupWindow.adjustPosition(e)}this.getActionsMenu().popupWindow.show()},closeActionsMenu:function(){if(this.actionsMenu){if(this.actionsMenu.popupWindow){this.actionsMenu.popupWindow.close()}this.actionsMenu=null}},getMenuItems:function(){return this.getActions()||[]},getActions:function(){try{this.actions=this.actions||eval(BX.data(this.getActionsButton(),this.settings.get("dataActionsKey")))}catch(err){this.actions=null}return this.actions},getActionsButton:function(){if(!this.actionsButton){this.actionsButton=BX.Grid.Utils.getByClass(this.getNode(),this.settings.get("classRowActionButton"),true)}return this.actionsButton},initSelect:function(){if(this.isSelected()&&!BX.hasClass(this.getNode(),this.settings.get("classCheckedRow"))){BX.addClass(this.getNode(),this.settings.get("classCheckedRow"))}},getParentNode:function(){var t;try{t=this.getNode().parentNode}catch(e){t=null}return t},getParentNodeName:function(){var t;try{t=this.getParentNode().nodeName}catch(e){t=null}return t},select:function(){var t;if(!this.isEdit()){t=this.getCheckbox();if(t){if(!BX.data(t,"disabled")){BX.addClass(this.getNode(),this.settings.get("classCheckedRow"));t.checked=true}}}},unselect:function(){if(!this.isEdit()){BX.removeClass(this.getNode(),this.settings.get("classCheckedRow"));if(this.getCheckbox()){this.getCheckbox().checked=false}}},getCells:function(){return this.getNode().cells},isSelected:function(){return this.getCheckbox()&&this.getCheckbox().checked||BX.hasClass(this.getNode(),this.settings.get("classCheckedRow"))},isHeadChild:function(){return this.getParentNodeName()==="THEAD"&&BX.hasClass(this.getNode(),this.settings.get("classHeadRow"))},isBodyChild:function(){return BX.hasClass(this.getNode(),this.settings.get("classBodyRow"))&&!BX.hasClass(this.getNode(),this.settings.get("classEmptyRows"))},isFootChild:function(){return this.getParentNodeName()==="TFOOT"&&BX.hasClass(this.getNode(),this.settings.get("classFootRow"))}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:97:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/rows-sortable.min.js?151131647210600";s:6:"source";s:77:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/rows-sortable.js";s:3:"min";s:81:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/rows-sortable.min.js";s:3:"map";s:81:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/rows-sortable.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Grid");BX.Grid.RowDragEvent=function(t){this.allowMoveRow=true;this.allowInsertBeforeTarget=true;this.dragItem=null;this.targetItem=null;this.eventName=!!t?t:"";this.errorMessage=""};BX.Grid.RowDragEvent.prototype={allowMove:function(){this.allowMoveRow=true;this.errorMessage=""},allowInsertBefore:function(){this.allowInsertBeforeTarget=true},disallowMove:function(t){this.allowMoveRow=false;this.errorMessage=t||""},disallowInsertBefore:function(){this.allowInsertBeforeTarget=false},getDragItem:function(){return this.dragItem},getTargetItem:function(){return this.targetItem},getEventName:function(){return this.eventName},setDragItem:function(t){return this.dragItem=t},setTargetItem:function(t){return this.targetItem=t},setEventName:function(t){return this.eventName=t},isAllowedMove:function(){return this.allowMoveRow},isAllowedInsertBefore:function(){return this.allowInsertBeforeTarget},getErrorMessage:function(){return this.errorMessage}};BX.Grid.RowsSortable=function(t){this.parent=null;this.list=null;this.setDefaultProps();this.init(t)};BX.Grid.RowsSortable.prototype={init:function(t){this.parent=t;this.list=this.getList();this.prepareListItems();jsDD.Enable();if(!this.inited){this.inited=true;this.onscrollDebounceHandler=BX.debounce(this._onWindowScroll,300,this);BX.addCustomEvent("Grid::thereEditedRows",BX.proxy(this.disable,this));BX.addCustomEvent("Grid::noEditedRows",BX.proxy(this.enable,this));document.addEventListener("scroll",this.onscrollDebounceHandler,BX.Grid.Utils.listenerParams({passive:true}))}},destroy:function(){BX.removeCustomEvent("Grid::thereEditedRows",BX.proxy(this.disable,this));BX.removeCustomEvent("Grid::noEditedRows",BX.proxy(this.enable,this));document.removeEventListener("scroll",this.onscrollDebounceHandler,BX.Grid.Utils.listenerParams({passive:true}));this.unregisterObjects()},_onWindowScroll:function(){this.windowScrollTop=BX.scrollTop(window);this.rowsRectList=null},disable:function(){this.unregisterObjects()},enable:function(){this.reinit()},reinit:function(){this.unregisterObjects();this.setDefaultProps();this.init(this.parent)},getList:function(){return this.parent.getRows().getSourceBodyChild()},unregisterObjects:function(){this.list.forEach(this.unregister,this)},prepareListItems:function(){this.list.forEach(this.register,this)},register:function(t){var e=this.parent.getRows();if(e.get(t).isDraggable()){t.onbxdragstart=BX.delegate(this._onDragStart,this);t.onbxdrag=BX.delegate(this._onDrag,this);t.onbxdragstop=BX.delegate(this._onDragEnd,this);jsDD.registerObject(t)}},unregister:function(t){jsDD.unregisterObject(t)},getIndex:function(t){return BX.Grid.Utils.getIndex(this.list,t)},calcOffset:function(){var t=this.dragRect.height;if(this.additionalDragItems.length){this.additionalDragItems.forEach(function(e){t+=e.clientHeight})}return t},getTheadCells:function(t){return[].map.call(t,function(e,r){return{block:"",tag:"th",attrs:{style:"width: "+BX.width(t[r])+"px;"}}})},createFake:function(){var t=[];this.cloneDragItem=BX.clone(this.dragItem);this.cloneDragAdditionalDragItems=[];this.cloneDragAdditionalDragItemRows=[];var e=this.getTheadCells(this.dragItem.cells);t.push(this.cloneDragItem);this.additionalDragItems.forEach(function(e){var r=BX.clone(e);t.push(r);this.cloneDragAdditionalDragItems.push(r);this.cloneDragAdditionalDragItemRows.push(new BX.Grid.Row(this.parent,r))},this);var r=BX.width(this.parent.getTable());this.fake=BX.decl({block:"main-grid-fake-container",attrs:{style:"position: absolute; top: "+this.getDragStartRect().top+"px; width: "+r+"px"},content:{block:"main-grid-table",mix:"main-grid-table-fake",tag:"table",attrs:{style:"width: "+r+"px"},content:[{block:"main-grid-header",tag:"thead",content:{block:"main-grid-row-head",tag:"tr",content:e}},{block:"",tag:"tbody",content:t}]}});BX.insertAfter(this.fake,this.parent.getTable());this.cloneDragItem=new BX.Grid.Row(this.parent,this.cloneDragItem);return this.fake},getDragStartRect:function(){return BX.pos(this.dragItem,this.parent.getTable())},_onDragStart:function(){this.dragItem=jsDD.current_node;this.targetItem=this.dragItem;this.additionalDragItems=this.getAdditionalDragItems(this.dragItem);this.dragIndex=this.getIndex(this.dragItem);this.dragRect=this.getRowRect(this.dragItem,this.dragIndex);this.offset=this.calcOffset();this.dragStartOffset=jsDD.start_y-this.dragRect.top;this.dragEvent=new BX.Grid.RowDragEvent;this.dragEvent.setEventName("BX.Main.grid:rowDragStart");this.dragEvent.setDragItem(this.dragItem);this.dragEvent.setTargetItem(this.targetItem);this.dragEvent.allowInsertBefore();var t=this.parent.getRows().get(this.dragItem);this.startDragDepth=t.getDepth();this.startDragParentId=t.getParentId();this.createFake();BX.addClass(this.parent.getContainer(),this.parent.settings.get("classOnDrag"));BX.addClass(this.dragItem,this.parent.settings.get("classDragActive"));BX.onCustomEvent(window,"BX.Main.grid:rowDragStart",[this.dragEvent,this.parent])},getAdditionalDragItems:function(t){var e=this.parent.getRows();return e.getRowsByParentId(e.get(t).getId(),true).map(function(t){return t.getNode()})},moveRow:function(t,e,r){if(!!t){var i=BX.type.isNumber(r)?r:300;t.style.transition=i+"ms";t.style.transform="translate3d(0px, "+e+"px, 0px)"}},getDragOffset:function(){return jsDD.y-this.dragRect.top-this.dragStartOffset},getWindowScrollTop:function(){if(this.windowScrollTop===null){this.windowScrollTop=BX.scrollTop(window)}return this.windowScrollTop},getSortOffset:function(){return jsDD.y},getRowRect:function(t,e){if(!this.rowsRectList){this.rowsRectList={};this.list.forEach(function(t,e){this.rowsRectList[e]=t.getBoundingClientRect()},this)}return this.rowsRectList[e]},getRowCenter:function(t,e){var r=this.getRowRect(t,e);return r.top+this.getWindowScrollTop()+r.height/2},isDragToBottom:function(t,e){var r=this.getRowCenter(t,e);var i=this.getSortOffset();return e>this.dragIndex&&r<i},isMovedToBottom:function(t){return t.style.transform==="translate3d(0px, "+-this.offset+"px, 0px)"},isDragToTop:function(t,e){var r=this.getRowCenter(t,e);var i=this.getSortOffset();return e<this.dragIndex&&r>i},isMovedToTop:function(t){return t.style.transform==="translate3d(0px, "+this.offset+"px, 0px)"},isDragToBack:function(t,e){var r=this.getRowCenter(t,e);var i=this.dragIndex;var s=jsDD.y;return e>i&&s<r||e<i&&s>r},isMoved:function(t){return t.style.transform!=="translate3d(0px, 0px, 0px)"&&t.style.transform!==""},_onDrag:function(){var t=0;var e=0;this.moveRow(this.dragItem,this.getDragOffset(),t);this.moveRow(this.fake,this.getDragOffset(),t);BX.Grid.Utils.styleForEach(this.additionalDragItems,{transition:t+"ms",transform:"translate3d(0px, "+this.getDragOffset()+"px, 0px)"});this.list.forEach(function(t,r){if(!!t&&t!==this.dragItem&&this.additionalDragItems.indexOf(t)===-1){if(this.isDragToTop(t,r)&&!this.isMovedToTop(t)){this.targetItem=t;this.moveRow(t,this.offset);this.dragEvent.setEventName("BX.Main.grid:rowDragMove");this.dragEvent.setTargetItem(this.targetItem);BX.onCustomEvent(window,"BX.Main.grid:rowDragMove",[this.dragEvent,this.parent]);this.checkError(this.dragEvent);this.updateProperties(this.dragItem,this.targetItem);this.isDragetToTop=true}if(this.isDragToBottom(t,r)&&!this.isMovedToBottom(t)){this.targetItem=this.findNextVisible(this.list,r);this.moveRow(t,-this.offset);this.dragEvent.setEventName("BX.Main.grid:rowDragMove");this.dragEvent.setTargetItem(this.targetItem);BX.onCustomEvent(window,"BX.Main.grid:rowDragMove",[this.dragEvent,this.parent]);this.checkError(this.dragEvent);this.updateProperties(this.dragItem,this.targetItem);this.isDragetToTop=false}if(this.isDragToBack(t,r)&&this.isMoved(t)){this.moveRow(t,e);this.targetItem=t;if(this.isDragetToTop){this.targetItem=this.findNextVisible(this.list,r)}this.dragEvent.setEventName("BX.Main.grid:rowDragMove");this.dragEvent.setTargetItem(this.targetItem);BX.onCustomEvent(window,"BX.Main.grid:rowDragMove",[this.dragEvent,this.parent]);this.checkError(this.dragEvent);this.updateProperties(this.dragItem,this.targetItem)}}},this)},createError:function(t,e){var r=BX.decl({block:"main-grid-error",content:!!e?e:""});!!t&&t.appendChild(r);setTimeout(function(){BX.addClass(r,"main-grid-error-show")},0);return r},checkError:function(t){if(!t.isAllowedMove()&&!this.error){this.error=this.createError(this.fake,t.getErrorMessage())}if(t.isAllowedMove()&&this.error){BX.remove(this.error);this.error=null}},findNextVisible:function(t,e){var r=null;var i=this.parent.getRows();t.forEach(function(t,s){if(!r&&s>e){var n=i.get(t);if(n.isShown()){r=t}}});return r},updateProperties:function(t,e){var r=this.parent.getRows();var i=r.get(t);var s=0;var n=0;if(!!e){var a=r.get(e);s=a.getDepth();n=a.getParentId()}i.setDepth(s);i.setParentId(n);this.cloneDragItem.setDepth(s);this.cloneDragAdditionalDragItemRows.forEach(function(t,e){t.setDepth(BX.data(this.additionalDragItems[e],"depth"))},this)},resetDragProperties:function(){var t=this.parent.getRows().get(this.dragItem);t.setDepth(this.startDragDepth);t.setParentId(this.startDragParentId)},_onDragOver:function(){},_onDragLeave:function(){},_onDragEnd:function(){BX.onCustomEvent(window,"BX.Main.grid:rowDragEnd",[this.dragEvent,this.parent]);BX.removeClass(this.parent.getContainer(),this.parent.settings.get("classOnDrag"));BX.removeClass(this.dragItem,this.parent.settings.get("classDragActive"));BX.Grid.Utils.styleForEach(this.list,{transition:"",transform:""});if(this.dragEvent.isAllowedMove()){this.sortRows(this.dragItem,this.targetItem);this.sortAdditionalDragItems(this.dragItem,this.additionalDragItems);this.list=this.getList();this.parent.getRows().reset();var t=this.parent.getRows().get(this.dragItem);var e=this.parent.getRows().getBodyChild().map(function(t){return t.getId()});this.saveRowsSort(e);BX.onCustomEvent(window,"Grid::rowMoved",[e,t,this.parent])}else{this.resetDragProperties()}BX.remove(this.fake);this.setDefaultProps()},sortAdditionalDragItems:function(t,e){e.reduce(function(t,e){!!e&&BX.insertAfter(e,t);return e},t)},sortRows:function(t,e){if(!!e){e.parentNode.insertBefore(t,e)}else{t.parentNode.appendChild(t)}},saveRowsSort:function(t){var e={ids:t,action:this.parent.getUserOptions().getAction("GRID_SAVE_ROWS_SORT")};this.parent.getData().request(null,"POST",e)},setDefaultProps:function(){this.dragItem=null;this.targetItem=null;this.dragRect=null;this.dragIndex=null;this.offset=null;this.realX=null;this.realY=null;this.dragStartOffset=null;this.windowScrollTop=null;this.rowsRectList=null;this.error=false}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:87:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/rows.min.js?15113164725401";s:6:"source";s:68:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/rows.js";s:3:"min";s:72:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/rows.min.js";s:3:"map";s:72:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/rows.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Grid");BX.Grid.Rows=function(t){this.parent=null;this.rows=null;this.headChild=null;this.bodyChild=null;this.footChild=null;this.init(t)};BX.Grid.Rows.prototype={init:function(t){this.parent=t},reset:function(){this.rows=null;this.headChild=null;this.bodyChild=null;this.footChild=null},enableDragAndDrop:function(){this.parent.arParams["ALLOW_ROWS_SORT"]=true;if(!(this.parent.getRowsSortable()instanceof BX.Grid.RowsSortable)){this.parent.rowsSortable=new BX.Grid.RowsSortable(this.parent)}},disableDragAndDrop:function(){this.parent.arParams["ALLOW_ROWS_SORT"]=false;if(this.parent.getRowsSortable()instanceof BX.Grid.RowsSortable){this.parent.getRowsSortable().destroy();this.parent.rowsSortable=null}},getFootLastChild:function(){return this.getLast(this.getFootChild())},getFootFirstChild:function(){return this.getFirst(this.getFootChild())},getBodyLastChild:function(){return this.getLast(this.getBodyChild())},getBodyFirstChild:function(){return this.getFirst(this.getBodyChild())},getHeadLastChild:function(){return this.getLast(this.getHeadChild())},getHeadFirstChild:function(){return this.getFirst(this.getHeadChild())},getEditSelectedValues:function(){var t=this.getSelected();var e={};t.forEach(function(t){e[t.getId()]=t.editGetValues()});return e},getSelectedIds:function(){return this.getSelected().map(function(t){return t.getId()})},initSelected:function(){var t=this.getSelected();if(BX.type.isArray(t)&&t.length){t.forEach(function(t){t.initSelect()});this.parent.enableActionsPanel()}},editSelected:function(){this.getSelected().forEach(function(t){t.edit()});BX.onCustomEvent(window,"Grid::thereEditedRows",[])},editSelectedCancel:function(){this.getSelected().forEach(function(t){t.editCancel()});BX.onCustomEvent(window,"Grid::noEditedRows",[])},isSelected:function(){return this.getBodyChild().some(function(t){return t.isShown()&&t.isSelected()})},isAllSelected:function(){return!this.getBodyChild().some(function(t){return!t.isSelected()})},getParent:function(){return this.parent},getCountSelected:function(){var t;try{t=this.getSelected().filter(function(t){return!t.isNotCount()&&t.isShown()}).length}catch(e){t=0}return t},getCountDisplayed:function(){var t;try{t=this.getBodyChild().filter(function(t){return t.isShown()&&!t.isNotCount()}).length}catch(e){t=0}return t},addRows:function(t){var e=BX.findChild(this.getParent().getTable(),{tag:"TBODY"},true,false);t.forEach(function(t){e.appendChild(t)})},getRows:function(){var t;var e=this;if(!this.rows){t=BX.Grid.Utils.getByTag(this.getParent().getTable(),"tr");this.rows=t.map(function(t){return new BX.Grid.Row(e.parent,t)})}return this.rows},getSelected:function(){return this.getBodyChild().filter(function(t){return t.isShown()&&t.isSelected()})},normalizeNode:function(t){if(!BX.hasClass(t,this.getParent().settings.get("classBodyRow"))){t=BX.findParent(t,{className:this.getParent().settings.get("classBodyRow")},true,false)}return t},getById:function(t){t=t.toString();var e=this.getBodyChild();var n=e.filter(function(e){return e.getId()===t});return n.length===1?n[0]:null},get:function(t){var e=null;var n;if(BX.type.isDomNode(t)){t=this.normalizeNode(t);n=this.getRows().filter(function(e){return t===e.getNode()});if(n.length){e=n[0]}}return e},getLast:function(t){var e;try{e=t[t.length-1]}catch(n){e=null}return e},getFirst:function(t){var e;try{e=t[0]}catch(n){e=null}return e},getHeadChild:function(){this.headChild=this.headChild||this.getRows().filter(function(t){return t.isHeadChild()});return this.headChild},getBodyChild:function(){this.bodyChild=this.bodyChild||this.getRows().filter(function(t){return t.isBodyChild()});return this.bodyChild},getFootChild:function(){this.footChild=this.footChild||this.getRows().filter(function(t){return t.isFootChild()});return this.footChild},selectAll:function(){this.getRows().map(function(t){t.isShown()&&t.select()})},unselectAll:function(){this.getRows().map(function(t){t.unselect()})},getByIndex:function(t){var e=this.getBodyChild().filter(function(e){return e.getNode().rowIndex===t});return e.length?e[0]:null},getRowsByParentId:function(t,e){var n=[];var i=this;if(!t){return n}t=t.toString();function r(t){i.getBodyChild().forEach(function(i){if(i.getParentId()===t){n.push(i);e&&r(i.getId())}},i)}r(t);return n},getRowsByGroupId:function(t){var e=[];var n=this;if(!t){return e}t=t.toString();function i(t){n.getBodyChild().forEach(function(n){if(n.getGroupId()===t&&!n.isCustom()){e.push(n)}},n)}i(t);return e},getExpandedRows:function(){return this.getRows().filter(function(t){return t.isShown()&&t.isExpand()})},getIdsExpandedRows:function(){return this.getExpandedRows().map(function(t){return t.getId()})},getIdsCollapsedGroups:function(){return this.getRows().filter(function(t){return t.isCustom()&&!t.isExpand()}).map(function(t){return t.getId()})},getSourceRows:function(){return BX.Grid.Utils.getByTag(this.getParent().getTable(),"tr")},getSourceBodyChild:function(){return this.getSourceRows().filter(function(t){return BX.Grid.Utils.closestParent(t).nodeName==="TBODY"})},getSourceHeadChild:function(){return this.getSourceRows().filter(function(t){return BX.Grid.Utils.closestParent(t).nodeName==="THEAD"})},getSourceFootChild:function(){return this.getSourceRows().filter(function(t){return BX.Grid.Utils.closestParent(t).nodeName==="TFOOT"})}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:105:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/settings-window-column.min.js?15113164722888";s:6:"source";s:86:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/settings-window-column.js";s:3:"min";s:90:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/settings-window-column.min.js";s:3:"map";s:90:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/settings-window-column.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Grid");BX.Grid.SettingsWindowColumn=function(t,e){this.node=null;this.label=null;this.checkbox=null;this.editButton=null;this.settings=null;this.parent=null;this.default=null;this.defaultTitle=null;this.state=null;this.init(t,e)};BX.Grid.SettingsWindowColumn.prototype={init:function(t,e){this.parent=t;this.node=e;this.updateState();BX.bind(this.getEditButton(),"click",BX.proxy(this.onEditButtonClick,this))},onEditButtonClick:function(t){t.stopPropagation();this.isEditEnabled()?this.disableEdit():this.enableEdit()},setState:function(t){this.state=t},getState:function(){return this.state},updateState:function(){this.setState({selected:this.isSelected(),title:this.getTitle()})},restoreState:function(){var t=this.getState();t.selected?this.select():this.unselect();this.setTitle(t.title)},getId:function(){return this.getNode().dataset.name},getTitle:function(){return this.getLabel().innerText},setTitle:function(t){this.getLabel().innerText=t},getSettings:function(){if(this.settings===null){var t=this.parent.getParam("DEFAULT_COLUMNS");this.settings=this.getId()in t?t[this.getId()]:{}}return this.settings},isDefault:function(){if(this.default===null){var t=this.getSettings();this.default="default"in t?t.default:false}return this.default},restore:function(){this.isDefault()?this.select():this.unselect();this.setTitle(this.getDefaultTitle());this.disableEdit();this.updateState()},getDefaultTitle:function(){if(this.defaultTitle===null){var t=this.getSettings();this.defaultTitle="name"in t?t.name:""}return this.defaultTitle},getNode:function(){return this.node},getLabel:function(){if(this.label===null){this.label=BX.Grid.Utils.getByTag(this.getNode(),"label",true)}return this.label},getCheckbox:function(){if(this.checkbox===null){this.checkbox=BX.Grid.Utils.getBySelector(this.getNode(),'input[type="checkbox"]',true)}return this.checkbox},getEditButton:function(){if(this.editButton===null){this.editButton=BX.Grid.Utils.getByClass(this.getNode(),this.parent.settings.get("classSettingsWindowColumnEditButton"),true)}return this.editButton},enableEdit:function(){this.getLabel().contentEditable=true;this.getCheckbox().disabled=true;this.adjustCaret()},disableEdit:function(){this.getLabel().contentEditable=false;this.getCheckbox().disabled=false},isEditEnabled:function(){return this.getLabel().isContentEditable},isSelected:function(){return this.getCheckbox().checked},select:function(){this.getCheckbox().checked=true},unselect:function(){this.getCheckbox().checked=false},adjustCaret:function(){var t=document.createRange();var e=window.getSelection();var i=this.getLabel().innerText.length;var n=this.getLabel().childNodes;var s=n[n.length-1];t.setStart(s,i);t.setEnd(s,i);t.collapse(true);e.removeAllRanges();e.addRange(t);BX.fireEvent(this.getNode(),"focus")}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:98:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/settings-window.min.js?15113164727301";s:6:"source";s:79:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/settings-window.js";s:3:"min";s:83:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/settings-window.min.js";s:3:"map";s:83:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/settings-window.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Grid");BX.Grid.SettingsWindow=function(t){this.parent=null;this.popupItems=null;this.items=null;this.popup=null;this.sourceContent=null;this.applyButton=null;this.resetButton=null;this.cancelButton=null;this.init(t)};BX.Grid.SettingsWindow.prototype={init:function(t){this.parent=t;BX.bind(this.parent.getContainer(),"click",BX.proxy(this._onContainerClick,this));BX.addCustomEvent(window,"Grid::columnMoved",BX.proxy(this._onColumnMoved,this))},destroy:function(){BX.unbind(this.parent.getContainer(),"click",BX.proxy(this._onContainerClick,this));BX.removeCustomEvent(window,"Grid::columnMoved",BX.proxy(this._onColumnMoved,this));this.getPopup().close()},getSelectAllButton:function(){if(!this.selectAllButton){this.selectAllButton=BX.Grid.Utils.getByClass(this.getPopup().contentContainer,this.parent.settings.get("classSettingsWindowSelectAll"),true)}return this.selectAllButton},getUnselectAllButton:function(){if(!this.unselectAllButton){this.unselectAllButton=BX.Grid.Utils.getByClass(this.getPopup().contentContainer,this.parent.settings.get("classSettingsWindowUnselectAll"),true)}return this.unselectAllButton},reset:function(){this.popupItems=null;this.allColumns=null},_onContainerClick:function(t){if(BX.hasClass(t.target,this.parent.settings.get("classSettingsButton"))){this._onSettingsButtonClick(t)}},_onSettingsButtonClick:function(){this.getPopup().show()},getSourceContent:function(){if(!this.sourceContent){this.sourceContent=BX.Grid.Utils.getByClass(this.parent.getContainer(),this.parent.settings.get("classSettingsWindow"),true)}return this.sourceContent},getPopupItems:function(){var t;if(!this.popupItems){t=this.getPopup().contentContainer;this.popupItems=BX.Grid.Utils.getByClass(t,this.parent.settings.get("classSettingsWindowColumn"))}return this.popupItems},getSelectedColumns:function(){var t=[];this.getItems().forEach(function(e){e.isSelected()&&t.push(e.getId())});return t},restoreColumns:function(){this.getItems().forEach(function(t){t.restore()});this.sortItems();this.reset()},restoreLastColumns:function(){this.getItems().forEach(function(t){t.restoreState()})},updateColumnsState:function(){this.getItems().forEach(function(t){t.updateState()})},saveColumns:function(t,e){var n=this.parent.getUserOptions();var i=this.getColumnNames();var s=[];s.push({action:n.getAction("GRID_SET_COLUMNS"),columns:t.join(",")});s.push({action:n.getAction("SET_CUSTOM_NAMES"),custom_names:i});if(this.isForAll()){s.push({action:n.getAction("GRID_SAVE_SETTINGS"),view_id:"default",set_default_settings:"Y",delete_user_settings:"Y"})}n.batch(s,BX.delegate(function(){this.parent.reloadTable(null,null,e)},this));this.updateColumnsState()},disableAllColumnslabelEdit:function(){this.getItems().forEach(function(t){t.disableEdit()})},getAllColumns:function(){if(!this.allColumns){this.allColumns=this.getItems().map(function(t){return t.getId()})}return this.allColumns},isShowedColumn:function(t){return this.getSelectedColumns().some(function(e){return e===t})},sortItems:function(){var t=this.getSelectedColumns();var e={};this.getAllColumns().forEach(function(t){e[t]=t},this);var n=0;Object.keys(e).forEach(function(i){if(this.isShowedColumn(i)){e[i]=t[n];n++}var s=this.getColumnByName(e[i]);s&&s.parentNode.appendChild(s)},this)},getColumnNames:function(){var t={};this.getItems().map(function(e){t[e.getId()]=e.getTitle()});return t},getColumnByName:function(t){return BX.Grid.Utils.getBySelector(this.getPopup().popupContainer,"."+this.parent.settings.get("classSettingsWindowColumn")+'[data-name="'+t+'"]',true)},_onColumnMoved:function(){this.sortItems();this.reset()},onResetButtonClick:function(){this.parent.getActionsPanel().confirmDialog({CONFIRM:true,CONFIRM_MESSAGE:this.parent.arParams.CONFIRM_RESET_MESSAGE},BX.delegate(function(){this.enableWait(this.getApplyButton());this.parent.getUserOptions().reset(this.isForAll(),BX.delegate(function(){this.parent.reloadTable(null,null,BX.delegate(function(){this.restoreColumns();this.disableWait(this.getApplyButton());this.getPopup().close()},this))},this))},this))},getResetButtonId:function(){return this.parent.getContainerId()+"-grid-settings-reset-button"},onApplyButtonClick:function(){this.parent.getActionsPanel().confirmDialog({CONFIRM:this.isForAll(),CONFIRM_MESSAGE:this.parent.getParam("SETTINGS_FOR_ALL_CONFIRM_MESSAGE")},BX.delegate(function(){this.enableWait(this.getApplyButton());this.saveColumns(this.getSelectedColumns(),BX.delegate(function(){this.getPopup().close();this.disableWait(this.getApplyButton());this.unselectForAllCheckbox()},this))},this),BX.delegate(function(){this.unselectForAllCheckbox()},this))},getApplyButtonId:function(){return this.parent.getContainerId()+"-grid-settings-apply-button"},getApplyButton:function(){if(this.applyButton===null){this.applyButton=BX(this.getApplyButtonId())}return this.applyButton},getCancelButtonId:function(){return this.parent.getContainerId()+"-grid-settings-cancel-button"},getCancelButton:function(){if(this.cancelButton===null){this.cancelButton=BX(this.getCancelButtonId())}return this.cancelButton},unselectForAllCheckbox:function(){var t=this.getForAllCheckbox();t&&(t.checked=null)},enableWait:function(t){BX.addClass(t,"webform-small-button-wait");BX.removeClass(t,"popup-window-button")},disableWait:function(t){BX.removeClass(t,"webform-small-button-wait");BX.addClass(t,"popup-window-button")},createTitle:function(){var t=BX.create("div");var e=BX("pagetitle");var n=!!e?"&laquo;"+e.innerText+"&raquo;":"";t.innerHTML="<span>"+this.parent.getParam("SETTINGS_TITLE")+" "+n+"</span>";return t.firstChild.innerText},getPopupId:function(){return this.parent.getContainerId()+"-grid-settings-window"},createPopup:function(){this.popup=new BX.PopupWindow(this.getPopupId(),null,{titleBar:this.createTitle(),autoHide:false,overlay:.6,width:800,closeIcon:true,closeByEsc:true,contentNoPaddings:true,content:this.getSourceContent(),events:{onPopupClose:BX.delegate(this._onPopupClose,this)}});this.getItems();BX.bind(this.getResetButton(),"click",BX.proxy(this.onResetButtonClick,this));BX.bind(this.getApplyButton(),"click",BX.proxy(this.onApplyButtonClick,this));BX.bind(this.getCancelButton(),"click",BX.proxy(this.popup.close,this.popup));BX.bind(this.getSelectAllButton(),"click",BX.delegate(this.selectAll,this));BX.bind(this.getUnselectAllButton(),"click",BX.delegate(this.unselectAll,this));return this.popup},getItems:function(){if(this.items===null){this.items=this.getPopupItems().map(function(t){return new BX.Grid.SettingsWindowColumn(this.parent,t)},this)}return this.items},_onPopupClose:function(){this.restoreLastColumns();this.disableAllColumnslabelEdit()},getPopup:function(){return!!this.popup?this.popup:this.popup=this.createPopup()},selectAll:function(){this.getItems().forEach(function(t){t.select()})},unselectAll:function(){this.getItems().forEach(function(t){t.unselect()})},isForAll:function(){var t=this.getForAllCheckbox();return t&&!!t.checked},getForAllCheckbox:function(){return BX.Grid.Utils.getByClass(this.getPopup().popupContainer,"main-grid-settings-window-for-all-checkbox",true)},getResetButton:function(){if(this.resetButton===null){this.resetButton=BX(this.getResetButtonId())}return this.resetButton}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:91:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/settings.min.js?15113164725105";s:6:"source";s:72:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/settings.js";s:3:"min";s:76:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/settings.min.js";s:3:"map";s:76:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/settings.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Grid");BX.Grid.Settings=function(){this.settings={};this.defaultSettings={classContainer:"main-grid",classWrapper:"main-grid-wrapper",classTable:"main-grid-table",classScrollContainer:"main-grid-container",classFadeContainer:"main-grid-fade",classFadeContainerRight:"main-grid-fade-right",classFadeContainerLeft:"main-grid-fade-left",classNavPanel:"main-grid-nav-panel",classActionPanel:"main-grid-action-panel",classCursor:"main-grid-cursor",classRowCustom:"main-grid-row-custom",classMoreButton:"main-grid-more-btn",classRow:"main-grid-row",classHeadRow:"main-grid-row-head",classBodyRow:"main-grid-row-body",classFootRow:"main-grid-row-foot",classDataRows:"main-grid-row-data",classPanels:"main-grid-bottom-panels",classCellHeadContainer:"main-grid-cell-head-container",classCellHeadOndrag:"main-grid-cell-head-ondrag",classEmptyRows:"main-grid-row-empty",classEmptyBlock:"main-grid-empty-block",classCheckAllCheckboxes:"main-grid-check-all",classCheckedRow:"main-grid-row-checked",classRowCheckbox:"main-grid-row-checkbox",classPagination:"main-grid-panel-cell-pagination",classActionCol:"main-grid-cell-action",classCounterDisplayed:"main-grid-counter-displayed",classCounterSelected:"main-grid-counter-selected",classCounterTotal:"main-grid-panel-total",classTableFade:"main-grid-table-fade",classDragActive:"main-grid-on-row-drag",classResizeButton:"main-grid-resize-button",classOnDrag:"main-grid-ondrag",classDisableDrag:"main-grid-row-drag-disabled",classPanelCellContent:"main-grid-panel-content",classCollapseButton:"main-grid-plus-button",classRowStateLoad:"main-grid-load-row",classRowStateExpand:"main-grid-row-expand",classHeaderSortable:"main-grid-col-sortable",classCellStatic:"main-grid-cell-static",classHeadCell:"main-grid-cell-head",classPageSize:"main-grid-panel-select-pagesize",classGroupEditButton:"main-grid-control-panel-action-edit",classGroupDeleteButton:"main-grid-control-panel-action-remove",classGroupActionsDisabled:"main-grid-control-panel-action-icon-disable",classPanelButton:"main-grid-buttons",classPanelApplyButton:"main-grid-control-panel-apply-button",classPanelCheckbox:"main-grid-panel-checkbox",classEditor:"main-grid-editor",classEditorContainer:"main-grid-editor-container",classEditorText:"main-grid-editor-text",classEditorDate:"main-grid-editor-date",classEditorNumber:"main-grid-editor-number",classEditorRange:"main-grid-editor-range",classEditorCheckbox:"main-grid-editor-checkbox",classEditorTextarea:"main-grid-editor-textarea",classCellContainer:"main-grid-cell-content",classEditorOutput:"main-grid-editor-output",classSettingsWindow:"main-grid-settings-window",classSettingsWindowColumn:"main-grid-settings-window-list-item",classSettingsWindowColumnLabel:"main-grid-settings-window-list-item-label",classSettingsWindowColumnEditState:"main-grid-settings-window-list-item-edit",classSettingsWindowColumnEditInput:"main-grid-settings-window-list-item-edit-input",classSettingsWindowColumnEditButton:"main-grid-settings-window-list-item-edit-button",classSettingsWindowColumnCheckbox:"main-grid-settings-window-list-item-checkbox",classSettingsWindowShow:"main-grid-settings-window-show",classSettingsWindowSelectAll:"main-grid-settings-window-select-all",classSettingsWindowUnselectAll:"main-grid-settings-window-unselect-all",classSettingsButton:"main-grid-interface-settings-icon",classSettingsButtonActive:"main-grid-interface-settings-icon-active",classSettingsWindowClose:"main-grid-settings-window-actions-item-close",classSettingsWindowReset:"main-grid-settings-window-actions-item-reset",classSettingsWindowColumnChecked:"main-grid-settings-window-list-item-checked",classShowAnimation:"main-grid-show-popup-animation",classCloseAnimation:"main-grid-close-popup-animation",classLoader:"main-grid-loader-container",classLoaderShow:"main-grid-show-loader",classLoaderHide:"main-grid-hide-loader",classRowError:"main-grid-error",loaderHideAnimationName:"hideLoader",classHide:"main-grid-hide",classEar:"main-grid-ear",classEarLeft:"main-grid-ear-left",classEarRight:"main-grid-ear-right",classNotCount:"main-grid-not-count",classCounter:"main-grid-panel-counter",classForAllCounterEnabled:"main-grid-panel-counter-for-all-enable",classLoad:"load",classRowActionButton:"main-grid-row-action-button",classDropdown:"main-dropdown",classPanelControl:"main-grid-panel-control",classPanelControlContainer:"main-grid-panel-control-container",classForAllCheckbox:"main-grid-for-all-checkbox",classDisable:"main-grid-disable",dataActionsKey:"actions",updateActionMore:"more",classShow:"show",classGridShow:"main-grid-show",updateActionPagination:"pagination",updateActionSort:"sort",ajaxIdDataProp:"ajaxid",pageSizeId:"grid_page_size",sortableRows:true,sortableColumns:true,animationDuration:300};this.prepare()};BX.Grid.Settings.prototype={prepare:function(){this.settings=this.defaultSettings},getDefault:function(){return this.defaultSettings},get:function(i){var a;try{a=this.getDefault()[i]}catch(n){a=null}return a},getList:function(){return this.getDefault()}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:90:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/submenu.min.js?15113164721316";s:6:"source";s:71:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/submenu.js";s:3:"min";s:75:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/submenu.min.js";s:3:"map";s:75:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/submenu.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Main");BX.Main.submenu={data:[],init:function(t,n,i,o){this.id=n;this.anchor=t;this.menuItems=o;this.level=i;this.anchorRect=BX.pos(this.anchor);this.toggleMenu()},toggleMenu:function(){var t;var n;var i;var o=this.anchor.menu;var e=o?this.anchor.menu.popupWindow:null;if(o&&e.isShown()){t=e.bindOptions.left;this.data.forEach(function(o){i=o.popupWindow;n=i.bindOptions.left;if(t<=n){o.popupWindow.close()}})}else{BX.PopupMenu.destroy(this.id);this.anchor.menu=this.createMenu();this.pushMenu(this.anchor.menu);this.anchor.menu.popupWindow.adjustPosition(BX.pos(this.anchor));this.anchor.menu.popupWindow.show();o=this.anchor.menu;e=o.popupWindow;t=e.bindOptions.left;this.data.forEach(function(e){i=e.popupWindow;n=i.bindOptions.left;if(t<=n&&o.id!==e.id){e.popupWindow.close()}})}},pushMenu:function(t){var n=this.getMenu(t);if(t){if(n===null){this.data.push(t)}else{this.data[n]=t}}},getMenu:function(t){var n=null;this.data.forEach(function(i,o){if(i.id===t.id){n=o;return false}});return n},createMenu:function(){return BX.PopupMenu.create(this.id,this.anchor,this.menuItems,{autoHide:true,offsetTop:-(this.anchorRect.height/2+26),offsetLeft:this.anchorRect.width+4,angle:{position:"left",offset:this.anchorRect.height/2-8}})}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:94:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/useroptions.min.js?15113164722994";s:6:"source";s:75:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/useroptions.js";s:3:"min";s:79:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/useroptions.min.js";s:3:"map";s:79:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/useroptions.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Grid");BX.Grid.UserOptions=function(t,i,e,s){this.options=null;this.actions=null;this.parent=null;this.url=null;this.init(t,i,e,s)};BX.Grid.UserOptions.prototype={init:function(parent,userOptions,userOptionsActions,url){this.url=url;this.parent=parent;try{this.options=eval(userOptions)}catch(err){console.warn("BX.Grid.UserOptions.init: Failed parse user options json string")}try{this.actions=eval(userOptionsActions)}catch(err){console.warn("BX.Grid.UserOptions.init: Failed parse user options actions json string")}},getCurrentViewName:function(){var t=this.getOptions();return"current_view"in t?t.current_view:null},getViewsList:function(){var t=this.getOptions();return"views"in t?t.views:{}},getCurrentOptions:function(){var t=this.getCurrentViewName();var i=this.getViewsList();var e=null;if(t in i){e=i[t]}if(!BX.type.isPlainObject(e)){e={}}return e},getUrl:function(t){return BX.util.add_url_param(this.url,{GRID_ID:this.parent.getContainerId(),bxajaxid:this.parent.getAjaxId(),action:t})},getOptions:function(){return this.options||{}},getActions:function(){return this.actions},getAction:function(t){var i=null;try{i=this.getActions()[t]}catch(e){i=null}return i},update:function(t){this.options=t},setColumns:function(t,i){var e=this.getCurrentOptions();if(BX.type.isPlainObject(e)){e.columns=t.join(",");this.save(this.getAction("GRID_SET_COLUMNS"),{columns:e.columns},i)}return this},setColumnsNames:function(t,i){var e={view_id:"default"};if(BX.type.isPlainObject(e)){e.custom_names=t;this.save(this.getAction("SET_CUSTOM_NAMES"),e,i)}return this},setColumnSizes:function(t,i){this.save(this.getAction("GRID_SET_COLUMN_SIZES"),{sizes:t,expand:i})},reset:function(t,i){var e={};if(!!t){e={view_id:"default",set_default_settings:"Y",delete_user_settings:"Y",view_settings:this.getCurrentOptions()}}this.save(this.getAction("GRID_RESET"),e,i)},setSort:function(t,i,e){if(t&&i){this.save(this.getAction("GRID_SET_SORT"),{by:t,order:i},e)}return this},setPageSize:function(t,i){if(BX.type.isNumber(parseInt(t))){this.save(this.getAction("GRID_SET_PAGE_SIZE"),{pageSize:t},i)}},setExpandedRows:function(t,i){BX.type.isArray(t)&&this.save(this.getAction("GRID_SET_EXPANDED_ROWS"),{ids:t},i)},setCollapsedGroups:function(t,i){BX.type.isArray(t)&&this.save(this.getAction("GRID_SET_COLLAPSED_GROUPS"),{ids:t},i)},resetExpandedRows:function(){this.save(this.getAction("GRID_RESET_EXPANDED_ROWS"),{})},saveForAll:function(t){this.save(this.getAction("GRID_SAVE_SETTINGS"),{view_id:"default",set_default_settings:"Y",delete_user_settings:"Y",view_settings:this.getCurrentOptions()},t)},batch:function(t,i){this.save(this.getAction("GRID_SAVE_BATH"),{bath:t},i)},save:function(t,i,e){var s=this;BX.ajax.post(this.getUrl(t),i,function(t){try{t=JSON.parse(t);if(!t.error){s.update(t);if(BX.type.isFunction(e)){e(t)}BX.onCustomEvent(s.parent.getContainer(),"Grid::optionsChanged",[s.parent])}}catch(i){}})}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:88:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/utils.min.js?15113164722120";s:6:"source";s:69:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/utils.js";s:3:"min";s:73:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/utils.min.js";s:3:"map";s:73:"/bitrix/components/bitrix/main.ui.grid/templates/.default/js/utils.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Grid");BX.Grid.Utils={ajaxUrl:function(e,n){return this.addUrlParams(e,{bxajaxid:n})},addUrlParams:function(e,n){return BX.util.add_url_param(e,n)},arrayMove:function(e,n,t){if(t>=e.length){var i=t-e.length;while(i--+1){e.push(undefined)}}e.splice(t,0,e.splice(n,1)[0]);return e},getIndex:function(e,n){return[].indexOf.call(e||[],n)},getNext:function(e){if(e){return e.nextElementSibling||null}},getPrev:function(e){if(e){return e.previousElementSibling||null}},closestParent:function(e,n){if(e){if(!n){return e.parentNode||null}else{return BX.findParent(e,{className:n})}}},closestChilds:function(e){if(e){return e.children||null}},collectionSort:function(e,n){var t,i,l,r,a;if(e&&n&&e!==n&&e.parentNode===n.parentNode){t=this.closestParent(n);i=this.closestChilds(t);l=i.length;r=this.getIndex(i,e);a=this.getIndex(i,n);if(l===a){t.appendChild(n)}if(r>a){t.insertBefore(e,n)}if(r<a&&l!==a){t.insertBefore(e,this.getNext(n))}}},getColumn:function(e,n){var t=this.getIndex(this.closestChilds(this.closestParent(n)),n);var i=[];[].forEach.call(e.rows,function(e){i.push(e.cells[t])});return i},styleForEach:function(e,n){n=BX.type.isPlainObject(n)?n:null;var t=Object.keys(n);[].forEach.call(e||[],function(e){t.forEach(function(t){BX.style(e,t,n[t])})})},requestAnimationFrame:function(){var e=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)};e.apply(window,arguments)},getByClass:function(e,n,t){var i=[];if(n){i=e?e.getElementsByClassName(n):[];if(t){i=i.length?i[0]:null}else{i=[].slice.call(i)}}return i},getByTag:function(e,n,t){var i=[];if(n){i=e?e.getElementsByTagName(n):[];if(t){i=i.length?i[0]:null}else{i=[].slice.call(i)}}return i},getBySelector:function(e,n,t){var i=[];if(n){if(t){i=e?e.querySelector(n):null}else{i=e?e.querySelectorAll(n):[];i=[].slice.call(i)}}return i},listenerParams:function(e){try{window.addEventListener("test",null,e)}catch(n){e=false}return e}}})();
/* End */
;; /* /bitrix/components/bitrix/socialnetwork.admin.set/templates/.default/script.js?15113165822527*/
; /* /bitrix/components/bitrix/tasks.task.list/templates/.default/script.min.js?151131659810817*/
; /* /bitrix/components/bitrix/tasks.interface.header/templates/.default/script.min.js?15113165981742*/
; /* /bitrix/components/bitrix/tasks.interface.topmenu/templates/.default/script.min.js?151131659860*/
; /* /bitrix/components/bitrix/main.interface.buttons/templates/.default/script.min.js?151131647237595*/
; /* /bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.min.js?1511316472575*/
; /* /bitrix/components/bitrix/tasks.interface.filter/templates/.default/script.min.js?15113165983824*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/script.min.js?151131647240526*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/js/api.min.js?1511316472586*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/js/field-controller.min.js?15113164722703*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/js/fields.min.js?151131647216599*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/js/main-ui-control-custom-entity.min.js?15113164722940*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/js/presets.min.js?151131647214223*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/js/search.min.js?151131647215840*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/js/settings.min.js?15113164724325*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/js/utils.min.js?15113164722222*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/date-group.min.js?15113164721428*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-control-field-group.min.js?15113164721136*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-control-field.min.js?15113164721286*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-control-string.min.js?1511316472422*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-filter-field-list-item.min.js?1511316472490*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-filter-info.min.js?1511316472250*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-number.min.js?1511316472754*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/main-ui-search-square.min.js?1511316472563*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/number-group.min.js?15113164721409*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/blocks/sidebar-item.min.js?15113164721364*/
; /* /bitrix/components/bitrix/tasks.interface.toolbar/templates/.default/script.min.js?15113165981339*/
; /* /bitrix/components/bitrix/tasks.interface.quick.form/templates/.default/script.min.js?151131659814423*/
; /* /bitrix/components/bitrix/main.ui.grid/templates/.default/script.min.js?151131647224497*/
; /* /bitrix/components/bitrix/main.ui.grid/templates/.default/js/action-panel.min.js?151131647213009*/
; /* /bitrix/components/bitrix/main.ui.grid/templates/.default/js/baseclass.min.js?1511316472207*/
; /* /bitrix/components/bitrix/main.ui.grid/templates/.default/js/cols-sortable.min.js?15113164725340*/
; /* /bitrix/components/bitrix/main.ui.grid/templates/.default/js/data.min.js?15113164725150*/
; /* /bitrix/components/bitrix/main.ui.grid/templates/.default/js/dropdown-manager.min.js?1511316472996*/
; /* /bitrix/components/bitrix/main.ui.grid/templates/.default/js/dropdown.min.js?15113164723586*/
; /* /bitrix/components/bitrix/main.ui.grid/templates/.default/js/element.min.js?1511316472857*/
; /* /bitrix/components/bitrix/main.ui.grid/templates/.default/js/fader.min.js?15113164725800*/
; /* /bitrix/components/bitrix/main.ui.grid/templates/.default/js/gridupdater.min.js?15113164722409*/
; /* /bitrix/components/bitrix/main.ui.grid/templates/.default/js/inline-editor.min.js?15113164724423*/
; /* /bitrix/components/bitrix/main.ui.grid/templates/.default/js/loader.min.js?15113164722372*/
; /* /bitrix/components/bitrix/main.ui.grid/templates/.default/js/manager.min.js?1511316472903*/
; /* /bitrix/components/bitrix/main.ui.grid/templates/.default/js/message.min.js?15113164721571*/
; /* /bitrix/components/bitrix/main.ui.grid/templates/.default/js/observer.min.js?1511316472175*/
; /* /bitrix/components/bitrix/main.ui.grid/templates/.default/js/oldgrid.min.js?151131647237682*/
; /* /bitrix/components/bitrix/main.ui.grid/templates/.default/js/pagesize.min.js?1511316472593*/
; /* /bitrix/components/bitrix/main.ui.grid/templates/.default/js/pagination.min.js?1511316472842*/
; /* /bitrix/components/bitrix/main.ui.grid/templates/.default/js/pin-header.min.js?15113164722174*/
; /* /bitrix/components/bitrix/main.ui.grid/templates/.default/js/pin-panel.min.js?15113164724993*/
; /* /bitrix/components/bitrix/main.ui.grid/templates/.default/js/resize.min.js?15113164723275*/
; /* /bitrix/components/bitrix/main.ui.grid/templates/.default/js/row.min.js?151131647213741*/
; /* /bitrix/components/bitrix/main.ui.grid/templates/.default/js/rows-sortable.min.js?151131647210600*/
; /* /bitrix/components/bitrix/main.ui.grid/templates/.default/js/rows.min.js?15113164725401*/
; /* /bitrix/components/bitrix/main.ui.grid/templates/.default/js/settings-window-column.min.js?15113164722888*/
; /* /bitrix/components/bitrix/main.ui.grid/templates/.default/js/settings-window.min.js?15113164727301*/
; /* /bitrix/components/bitrix/main.ui.grid/templates/.default/js/settings.min.js?15113164725105*/
; /* /bitrix/components/bitrix/main.ui.grid/templates/.default/js/submenu.min.js?15113164721316*/
; /* /bitrix/components/bitrix/main.ui.grid/templates/.default/js/useroptions.min.js?15113164722994*/
; /* /bitrix/components/bitrix/main.ui.grid/templates/.default/js/utils.min.js?15113164722120*/

//# sourceMappingURL=page_b0dd9d974b82909e2ea7db47ce98c12c.map.js